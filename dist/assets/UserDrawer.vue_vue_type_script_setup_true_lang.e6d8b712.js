var S=Object.defineProperty;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var D=(i,s,r)=>s in i?S(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r,F=(i,s)=>{for(var r in s||(s={}))U.call(s,r)&&D(i,r,s[r]);if(v)for(var r of v(s))P.call(s,r)&&D(i,r,s[r]);return i};var y=(i,s,r)=>new Promise((w,c)=>{var h=o=>{try{d(r.next(o))}catch(p){c(p)}},g=o=>{try{d(r.throw(o))}catch(p){c(p)}},d=o=>o.done?w(o.value):Promise.resolve(o.value).then(h,g);d((r=r.apply(i,s)).next())});import{B as L}from"./BasicForm.5950e505.js";import"./componentMap.d3e1f736.js";import{u as k}from"./useForm.ee4b0bb8.js";import"./JAddInput.9b38307a.js";import{j as C,dW as O,C as m,m as W,H as t,s as j,Q as x,w as V,v as N,x as E,er as G}from"./index.2bb6f736.js";import{f as H}from"./user.data.fdc75497.js";import{u as K,B as Q}from"./index.268c82cc.js";import{g as $,a as q,b as z,c as J,s as M}from"./user.api.b2a67efe.js";import{useDrawerAdaptiveWidth as X}from"./useAdaptiveWidth.6f6329fb.js";const ce=C({__name:"UserDrawer",emits:["success","register"],setup(i,{emit:s}){O();const r=m(!0),w=m(""),c=m([]),[h,{setProps:g,resetFields:d,setFieldsValue:o,validate:p,updateSchema:A}]=k({labelWidth:90,schemas:H,showActionButtonGroup:!1}),u=m(!0),[b,{setDrawerProps:I,closeDrawer:B}]=K(e=>y(this,null,function*(){var l;if(yield d(),u.value=(l=e==null?void 0:e.showFooter)!=null?l:!0,I({confirmLoading:!1,showFooter:u.value}),r.value=!!(e!=null&&e.isUpdate),t(r)){w.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const n=yield $({userid:e.record.id});n&&n.length>0&&(e.record.selectedroles=n)}catch(n){}const a=yield q({userId:e.record.id});if(a&&a.length>0){e.record.selecteddeparts=a;let n=Array.from(a,({key:f})=>f);e.record.selecteddeparts=n.join(","),c.value=a.map(f=>({label:f.title,value:f.key}))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=e.record.departIds==""?[]:e.record.departIds}e.selectedroles&&(yield o({selectedroles:e.selectedroles})),A([{field:"password",show:!t(r)},{field:"confirmPassword",ifShow:!t(r)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:c}},{field:"selecteddeparts",show:!(e!=null&&e.departDisabled)},{field:"selectedroles",show:!(e!=null&&e.departDisabled),componentProps:{api:e.tenantSaas?z:J}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!t(r)&&e.tenantSaas&&(yield o({relTenantIds:G().toString()})),typeof e.record=="object"&&o(F({},e.record)),g({disabled:!u.value})})),R=W(()=>t(r)?"\u7F16\u8F91\u7528\u6237":"\u65B0\u589E\u7528\u6237"),{adaptiveWidth:T}=X();function _(){return y(this,null,function*(){try{let e=yield p();I({confirmLoading:!0}),e.userIdentity===1&&(e.departIds="");let l=t(r);yield M(e,l),B(),s("success",{isUpdateVal:l,values:e})}finally{I({confirmLoading:!1})}})}return(e,l)=>(j(),x(t(Q),E(e.$attrs,{onRegister:t(b),title:R.value,width:t(T),onOk:_,showFooter:u.value,destroyOnClose:""}),{default:V(()=>[N(t(L),{onRegister:t(h)},null,8,["onRegister"])]),_:1},16,["onRegister","title","width","showFooter"]))}});export{ce as _};
