import{B as se}from"./BasicForm.1ce98310.js";import"./helper.348d808b.js";import{u as ie}from"./useForm.aa443ff5.js";import"./JAddInput.26e96438.js";import{e$ as le,F as D,a7 as ue,H as P,ab as U,t as k,v as H,x as L,y as g,z as x,aV as B,C as M,D as ce,W as A,a1 as me,u as pe,dp as de,dq as fe}from"./index.48973554.js";import{c as q,F as N}from"./FormSchemaFactory.f484a823.js";import{g as he,e as ge,f as _e,h as ye,i as W}from"./useAutoForm.df9d0ddb.js";import"./JUpload.8a53d8d7.js";import"./JUploadModal.743de853.js";import"./OnlineSelectCascade.101fb571.js";import"./index.a8c318f8.js";import"./pick.dbff1c58.js";import"./_flatRest.ff1861ce.js";import"./isArray.40a4ed15.js";import"./toString.cf909882.js";import"./_arrayPush.8821345e.js";import"./BasicTable.e157d4b8.js";import"./TableImg.1804d2ee.js";import"./Area.b1c0f61d.js";import"./functional.a68fe013.js";import"./LinkTableListPiece.e8f6df24.js";import"./uniqBy.10a392dc.js";import"./BasicModal.6df5b388.js";import"./useWindowSizeFn.baf157d7.js";import"./useFormItem.418c264c.js";import"./download.305bc1f7.js";import"./base64Conver.030fa32c.js";import"./index.4b4d8231.js";import"./index.86092ee6.js";import"./useCountdown.ac3557a4.js";import"./index.3ffef931.js";import"./api.9360c22b.js";import"./props.ad377147.js";import"./index.cf18bacf.js";import"./bem.53c5c04d.js";import"./props.8a838016.js";import"./useContextMenu.4c508609.js";import"./index.9fa749d9.js";import"./onMountedOrActivated.77b2868b.js";import"./index.b47d33d0.js";import"./htmlmixed.7ebbe1b3.js";import"./vue.170e82bd.js";/* empty css             */import"./depart.api.fc69de8d.js";import"./user.api.a90ba791.js";import"./_commonjsHelpers.7ef9cff5.js";import"./customExpression.58041e91.js";import"./useListPage.79770376.js";import"./useTable.9e72b446.js";import"./index.4ec76882.js";import"./useContentHeight.a372c55d.js";import"./useContentViewHeight.9106942e.js";import"./usePageContext.3811348f.js";import"./RedoOutlined.05c3397a.js";import"./JModalTip.017629d7.js";var ve=Object.defineProperty,K=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable,z=(i,a,s)=>a in i?ve(i,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[a]=s,R=(i,a)=>{for(var s in a||(a={}))Fe.call(a,s)&&z(i,s,a[s]);if(K)for(var s of K(a))we.call(a,s)&&z(i,s,a[s]);return i},C=(i,a,s)=>new Promise((u,y)=>{var V=d=>{try{F(s.next(d))}catch(w){y(w)}},v=d=>{try{F(s.throw(d))}catch(w){y(w)}},F=d=>d.done?u(d.value):Promise.resolve(d.value).then(V,v);F((s=s.apply(i,a)).next())});const be={name:"OnlineQueryForm",components:{BasicForm:se},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(i,{emit:a}){const s="/online/cgform/api/getQueryInfoVue3/",u=D(null),y=D([]),V=D({xs:24,sm:24,md:12,lg:8,xl:8}),v=D(!1),F=D(!1),d=D({}),w=D([]),{createMessage:j}=pe(),m=ue({config:{},cache:{},param:{},status:!1});P(()=>m.status,e=>C(this,null,function*(){console.log("-------------defaultValues\u53D1\u751F\u6539\u53D8,\u9700\u8981\u91CD\u7F6E\u8868\u5355---------------");const{config:t,cache:n,param:_}=U(m);let b=Object.assign({},t,n,_);yield G(b)}),{immediate:!0,deep:!0});function l(e,t){return C(this,null,function*(){m.cache=R({},e),m.param=R({},t),m.status=!m.status})}P(()=>i.id,e=>{e?p():y.value=[]},{immediate:!0});function c(e){return C(this,null,function*(){let t=[],n={},_=Object.keys(e);for(let o of _){const r=e[o];let h=r.view;if(q[h]&&(r.view=q[h]),yield ge(o,r,n),r.mode=="group"&&(h=="date"||h=="datetime"||h=="number")){let S=N.createSlotFormSchema(o,r);t.push(S)}else if(r.view===_e){let S=ye(r,o);for(let O of S){let E=N.createFormSchema(O.key,O),I=W(t,O.key);I==-1?t.push(E):t[I]=E}}else if(W(t,o)==-1){let O=N.createFormSchema(o,r);t.push(O)}}t.sort(function(o,r){return o.order-r.order});let b=[];t.length>2&&(v.value=!0);let f=[];for(let o=0;o<t.length;o++){let r=t[o];r.setFormRef(u),r.noChange(),r.asSearchForm(),o>1&&(f.push(r.field),r.isHidden()),b.push(r.getFormItemSchema())}w.value=f,y.value=b,m.config=R({},n),m.status=!m.status})}function p(){return C(this,null,function*(){let e=yield Z(),t=X(e);a("loaded",e);let{formProperties:n,hasField:_}=J(t,e);if(_==!1){y.value=[];return}yield c(n)})}function G(e){return C(this,null,function*(){yield he(u),console.log("rawValues",e),yield T(e),Object.keys(e).length>0&&Y()})}function J(e,t){const{searchFieldList:n,joinQuery:_,table:b}=t;let f=!1,o={};return e&&Object.keys(e).map(r=>{n.indexOf(r)>=0&&(_==!0?r.indexOf("@")<0?(o[b+"@"+r]=e[r],f=!0):(o[r]=e[r],f=!0):r.indexOf("@")<0&&(o[r]=e[r],f=!0))}),{formProperties:o,hasField:f}}function X(e){const{properties:t,searchFieldList:n,joinQuery:_,table:b}=e;let f={},o=1;return Object.keys(t).map(r=>{let h=t[r];if(h.view=="table"){let S=h.properties,O=o*100;Object.keys(S).map(E=>{let I=S[E];I.order=O+Number(I.order);let ne=r+"@"+E;f[ne]=I}),o++}else h.order=Number(h.order),f[r]=h}),f}function Z(){let e=`${s}${i.id}`;return new Promise(t=>{me.get({url:e},{isTransformResponse:!1}).then(n=>{n.success?t(n.result):(t(!1),j.warning(n.message))}).catch(()=>{j.warning("\u83B7\u53D6\u67E5\u8BE2\u6761\u4EF6\u5931\u8D25!"),t(!1)})})}const[$,{resetFields:ee,setFieldsValue:T,updateSchema:te,getFieldsValue:re}]=ie({schemas:y,showActionButtonGroup:!1,baseColProps:V,autoSubmitOnEnter:!0,submitFunc(){Y()}});function Y(){let e=re(),t=Object.assign({},U(m.param),ae(e));a("search",t,!0)}function oe(){return C(this,null,function*(){yield ee();const{config:e,param:t}=U(m);let n=Object.assign({},e,t);Object.keys(n).length>0&&(yield T(n)),a("search",n,!1)})}function ae(e){return Object.keys(e).map(t=>{e[t]&&e[t]instanceof Array&&(e[t]=e[t].join(","))}),e}return P(()=>F.value,e=>{let t=w.value;if(t&&t.length>0){let n=[];for(let _ of t)n.push({field:_,show:e});te(n)}},{immediate:!1}),{onlineQueryFormRef:u,registerForm:$,initDefaultValues:l,toggleButtonShow:v,toggleSearchStatus:F,doSearch:Y,resetSearch:oe,queryParams:d,formSchemas:y}}},Q=i=>(de("data-v-01d37a80"),i=i(),fe(),i),Se={key:0,class:"jeecg-basic-table-form-container p-0"},Oe=Q(()=>B("span",{class:"group-query-string"},"~",-1)),De=Q(()=>B("span",{class:"group-query-string"},"~",-1)),xe=Q(()=>B("span",{class:"group-query-string"},"~",-1)),Ie={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function ke(i,a,s,u,y,V){const v=k("a-date-picker"),F=k("a-input-number"),d=k("a-button"),w=k("a-icon"),j=k("a-col"),m=k("BasicForm");return u.formSchemas&&u.formSchemas.length>0?(H(),L("div",Se,[g(m,{ref:"onlineQueryFormRef",onRegister:u.registerForm},{groupDate:x(({model:l,field:c})=>[g(v,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F",value:l[c+"_begin"],"onUpdate:value":p=>l[c+"_begin"]=p,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),Oe,g(v,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u7ED3\u675F\u65E5\u671F",value:l[c+"_end"],"onUpdate:value":p=>l[c+"_end"]=p,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),groupDatetime:x(({model:l,field:c})=>[g(v,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u5F00\u59CB\u65F6\u95F4",value:l[c+"_begin"],"onUpdate:value":p=>l[c+"_begin"]=p,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),De,g(v,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u7ED3\u675F\u65F6\u95F4",value:l[c+"_end"],"onUpdate:value":p=>l[c+"_end"]=p,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),groupNumber:x(({model:l,field:c})=>[g(F,{placeholder:"\u5F00\u59CB\u503C",value:l[c+"_begin"],"onUpdate:value":p=>l[c+"_begin"]=p,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),xe,g(F,{placeholder:"\u7ED3\u675F\u503C",value:l[c+"_end"],"onUpdate:value":p=>l[c+"_end"]=p,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),formFooter:x(()=>[g(j,{md:6,sm:8},{default:x(()=>[B("span",Ie,[g(d,{preIcon:"ant-design:search",type:"primary",onClick:u.doSearch},{default:x(()=>[M("\u67E5\u8BE2")]),_:1},8,["onClick"]),g(d,{preIcon:"ant-design:reload",type:"primary",onClick:u.resetSearch,style:{"margin-left":"8px"}},{default:x(()=>[M("\u91CD\u7F6E")]),_:1},8,["onClick"]),u.toggleButtonShow?(H(),L("a",{key:0,onClick:a[0]||(a[0]=l=>u.toggleSearchStatus=!u.toggleSearchStatus),style:{"margin-left":"8px"}},[M(ce(u.toggleSearchStatus?"\u6536\u8D77":"\u5C55\u5F00")+" ",1),g(w,{type:u.toggleSearchStatus?"up":"down"},null,8,["type"])])):A("",!0)])]),_:1})]),_:1},8,["onRegister"])])):A("",!0)}var Et=le(be,[["render",ke],["__scopeId","data-v-01d37a80"]]);export{Et as default};
