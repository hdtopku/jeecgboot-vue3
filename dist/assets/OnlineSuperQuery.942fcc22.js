import{y as e,av as t,f0 as a,cl as l,eU as n,b7 as o,bI as i,F as r,H as s,t as u,v as d,x as c,aW as f,V as p,z as v,C as m,W as h,E as y,R as g,S as b,ax as j,bc as O,D as _,ff as k,a8 as w,bH as C,b4 as S,dN as x,fg as M,ac as F,a5 as T,u as V,dp as R,dq as I}from"./index.435ab247.js";import{B as D}from"./index.e1e06dd6.js";import{c as H,F as z}from"./FormSchemaFactory.255c9043.js";import{_ as P}from"./OnlineSuperQueryValComponent.vue_vue_type_script_lang.8daeb482.js";import"./JUpload.e164672b.js";import"./JUploadModal.3912f1fd.js";import"./helper.1c9dc9a5.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import{M as Q}from"./JAddInput.8c125e2c.js";import"./BasicModal.c66de981.js";import"./useWindowSizeFn.3d5b1a05.js";import"./_baseSlice.23bb44df.js";import"./api.bc301b0f.js";import"./functional.be5901d6.js";import"./useFormItem.816007c4.js";import"./download.5dc68cfb.js";import"./base64Conver.030fa32c.js";import"./index.a5502478.js";import"./index.64086148.js";import"./useCountdown.adc4ab77.js";import"./index.cdc49bf1.js";import"./props.5467b933.js";import"./index.713dc63d.js";import"./bem.0e923c54.js";import"./props.37836c63.js";import"./useContextMenu.82ce6d89.js";import"./index.e1ec35e6.js";import"./onMountedOrActivated.e9ddbd41.js";import"./index.627c6cd3.js";import"./htmlmixed.749cbc8c.js";import"./vue.f62dfd4a.js";/* empty css             */import"./depart.api.c07add53.js";var q={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm52-668H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z",fill:e}},{tag:"path",attrs:{d:"M212 212h200v200H212zm400 0h200v200H612zM212 612h200v200H212zm400 0h200v200H612z",fill:t}}]}},name:"appstore",theme:"twotone"};function A(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){U(e,t,a[t])}))}return e}function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var B=function(a,l){var n=A({},a,l.attrs);return e(t,A({},n,{icon:q}),null)};B.displayName="AppstoreTwoTone",B.inheritAttrs=!1;var N=B,L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"};function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){E(e,t,a[t])}))}return e}function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var W=function(a,l){var n=J({},a,l.attrs);return e(t,J({},n,{icon:L}),null)};W.displayName="FileTextOutlined",W.inheritAttrs=!1;function K(){const{createMessage:e}=V(),t=r(),a=w({values:[]}),l=r("and"),[n,{setModalProps:o}]=C((()=>{o({confirmLoading:!1})})),i=Object.assign({},{link_down:"text"},H);const u=r({}),d=r([]);const c={field:"val",label:"测试",component:"Input"};const f=r(""),p=S(),v=w({visible:!1,title:"",content:"",saveCode:""}),m=r(!1),h=x();s((()=>h.fullPath),(e=>{g()}));const y=r([]);function g(){let e="JSuperQuerySaved_"+h.fullPath;v.saveCode=e;let t=p.get(e);t&&t instanceof Array&&(y.value=t)}function b(e){let t=y.value,a=-1;for(let l=0;l<t.length;l++)if(t[l].title==e){a=l;break}return a}function j(e=!1){let t=a.values;if(!t||0==t.length)return!1;let l=[],n=u.value;for(let a of t)if(a.field&&(a.val||0===a.val)&&a.rule){let t=F(a.val);t instanceof Array&&(t=t.join(","));let o={field:a.field,rule:a.rule,val:t};if(!0===e){let e=n[a.field];e&&(o.type=e.view,o.dbType=e.type)}l.push(o)}return 0!=l.length&&l}function O(e){e.children.sort((function(e,t){return e.order-t.order}))}return s((()=>y.value),(e=>{let t=[];e&&e.length>0&&e.map((e=>{let a=M(16);t.push({title:e.title,slots:{icon:"custom"},value:a})})),f.value=t}),{immediate:!0,deep:!0}),g(),{formRef:t,init:function(e){let{allFields:t,treeData:a}=function(e){const{properties:t,table:a,title:l}=e;let n={},o=1,i=[],r={title:l,value:a,disabled:!0,children:[]};return i.push(r),Object.keys(t).map((e=>{let l=t[e];if("table"==l.view){let t=l.properties,a=100*o,r={title:l.title,value:e,disabled:!0,children:[]};Object.keys(t).map((l=>{let o=t[l];o.order=a+o.order;let i=e+","+l;n[i]=o,r.children.push({title:o.title,value:i,isLeaf:!0,order:o.order})})),O(r),i.push(r),o++}else{let t=a+"@"+e;n[t]=l,r.children.push({title:l.title,value:t,isLeaf:!0,order:l.order})}})),O(r),{allFields:n,treeData:i}}(e);u.value=t,d.value=a},dynamicRowValues:a,matchType:l,registerModal:n,handleSubmit:function(){},handleCancel:function(){},handleSave:function(){let t=j();t?function(e){v.visible=!0,v.title="",v.content=e}(JSON.stringify(t)):e.warning("空条件不能保存")},doSaveQueryInfo:function(){let{title:e,content:t,saveCode:a}=v,n=b(e);n>=0?T.confirm({title:"提示",content:`${e} 已存在，是否覆盖？`,okText:"确认",cancelText:"取消",onOk:()=>{y.value.splice(n,1,{content:t,title:e,type:l.value}),p.set(a,y.value),v.visible=!1}}):(y.value.push({content:t,title:e,type:l.value}),p.set(a,y.value),v.visible=!1)},saveInfo:v,saveTreeData:f,handleRemoveSaveInfo:function(e){let t=b(e);t>=0&&(y.value.splice(t,1),p.set(v.saveCode,y.value))},handleTreeSelect:function(e,{node:t}){let n=t.dataRef.title,o=y.value.filter((e=>e.title==n));if(o&&o.length>0){let{content:e,type:t}=o[0],n=JSON.parse(e),i=[];for(let a of n)i.push(Object.assign({},{key:M(16)},a));a.values=i,l.value=t}},fieldTreeData:d,addOne:function(e){let t={field:void 0,rule:"eq",val:"",key:M(16)};!1===e?(a.values=[],a.values.push(t)):!0===e?0==a.values.length&&a.values.push(t):a.values.splice(++e,0,t)},removeOne:function(e){let t=F(a.values),l=-1;for(let a=0;a<t.length;a++)if(e.key==t[a].key){l=a;break}-1!=l&&a.values.splice(l,1)},setFormModel:function(e,t,a){a.val=t},getSchema:function(e,t){let a=u.value[e.field];if(!a)return c;i[a.view]&&(a.view=i[a.view]);let l=z.createFormSchema(e.field,a);return l.noChange(),l.asSearchForm(),l.updateField(e.field+t),l.setFunctionForFieldValue((t=>{e.val=t[e.field]})),l.getFormItemSchema()},loading:m,getQueryInfo:j,initDefaultValues:function(e){const{params:t,matchType:l}=e;if(t){let e=[];for(let a of t)e.push(Object.assign({},{key:M(16)},a));a.values=e,l.value=l}}}}const $={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1}},components:{BasicModal:D,MinusCircleOutlined:Q,PlusOutlined:l,OnlineSuperQueryValComponent:P,FileTextOutlined:W,CloseCircleOutlined:n,AppstoreTwoTone:N,Divider:o},emits:["search"],setup(e,{emit:t}){const[a,l]=i(),{createMessage:n}=V();const{formRef:o,init:u,dynamicRowValues:d,matchType:c,registerModal:f,handleSave:p,doSaveQueryInfo:v,saveInfo:m,saveTreeData:h,handleTreeSelect:y,handleRemoveSaveInfo:g,fieldTreeData:b,addOne:j,removeOne:O,setFormModel:_,getSchema:k,loading:w,getQueryInfo:C,initDefaultValues:S}=K(),x=r(!1);return s((()=>e.status),(e=>{x.value=e}),{immediate:!0}),{formRef:o,registerFormModal:a,init:u,handleChangeField:function(e){e.val=""},dynamicRowValues:d,matchType:c,registerModal:f,handleSubmit:function(){let e=C(!0);e&&e.length>0?t("search",e,c.value):n.warning("空条件无法查询！")},handleCancel:function(){l.closeModal()},handleSave:p,handleReset:function(){d.values=[],j(!1),t("search",[],c.value)},doSaveQueryInfo:v,saveInfo:m,saveTreeData:h,handleTreeSelect:y,handleRemoveSaveInfo:g,fieldTreeData:b,addOne:j,removeOne:O,setFormModel:_,getSchema:k,loading:w,onFinish:function(e){},getPopupContainer:function(){return document.getElementsByClassName("jee-super-query-form")[0]},superQueryFlag:x,handleOpen:function(){l.openModal(),j(!0)},initDefaultValues:S}}},G=e=>(R("data-v-2878ef8e"),e=e(),I(),e),X={class:"j-super-query-button"},Y=G((()=>f("span",null,"已有高级查询条件生效",-1))),Z=G((()=>f("span",null,"高级查询",-1))),ee={style:{float:"left"}},te={slot:"description"},ae=G((()=>f("span",null,"没有任何查询条件",-1))),le=G((()=>f("div",null,"保存的查询",-1))),ne=["title"],oe={class:"icon-cancle"},ie={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};var re=a($,[["render",function(t,a,l,n,o,i){const r=u("divider"),s=u("AppstoreTwoTone"),w=u("a-button"),C=u("a-button-group"),S=u("a-tooltip"),x=u("a-divider"),M=u("a-empty"),F=u("a-select-option"),T=u("a-select"),V=u("a-form-item"),R=u("a-col"),I=u("a-row"),D=u("a-tree-select"),H=u("online-super-query-val-component"),z=u("PlusOutlined"),P=u("MinusCircleOutlined"),Q=u("a-space"),q=u("a-form"),A=u("close-circle-outlined"),U=u("file-text-outlined"),B=u("a-tree"),N=u("a-card"),L=u("BasicModal"),J=u("a-input"),E=u("a-modal");return d(),c(j,null,[f("div",X,[n.superQueryFlag?(d(),p(S,{key:0,mouseLeaveDelay:.2},{title:v((()=>[Y,e(r,{type:"vertical",style:{"background-color":"#fff"}}),f("a",{onClick:a[0]||(a[0]=(...e)=>n.handleReset&&n.handleReset(...e))},"清空")])),default:v((()=>[e(C,null,{default:v((()=>[e(w,{type:"primary",onClick:n.handleOpen},{default:v((()=>[e(s,{spin:!0}),Z])),_:1},8,["onClick"])])),_:1})])),_:1},8,["mouseLeaveDelay"])):(d(),p(w,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:n.handleOpen},{default:v((()=>[m(" 高级查询 ")])),_:1},8,["onClick"]))]),(d(),p(k,{to:"body"},[e(L,{title:"高级查询构造器",canFullscreen:!1,width:1055,onRegister:n.registerFormModal,onOk:n.handleSubmit},{footer:v((()=>[f("div",ee,[e(w,{loading:n.loading,onClick:n.handleReset},{default:v((()=>[m("重置")])),_:1},8,["loading","onClick"]),e(w,{loading:n.loading,onClick:n.handleSave},{default:v((()=>[m("保存查询条件")])),_:1},8,["loading","onClick"])]),e(w,{key:"submit",type:"primary",onClick:n.handleSubmit},{default:v((()=>[m("确定")])),_:1},8,["onClick"]),e(w,{key:"back",onClick:n.handleCancel},{default:v((()=>[m("关闭")])),_:1},8,["onClick"])])),default:v((()=>[0==n.dynamicRowValues.values.length?(d(),p(M,{key:0},{default:v((()=>[f("div",te,[ae,e(x,{type:"vertical"}),f("a",{onClick:a[1]||(a[1]=e=>n.addOne(-1))},"点击新增")])])),_:1})):h("",!0),e(I,{class:y("j-super-query-modal-content")},{default:v((()=>[e(R,{sm:24,md:18},{default:v((()=>[g(e(I,null,{default:v((()=>[e(R,{md:12,xs:24},{default:v((()=>[e(V,{label:"过滤条件匹配",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:v((()=>[e(T,{value:n.matchType,"onUpdate:value":a[2]||(a[2]=e=>n.matchType=e),getPopupContainer:e=>e.parentNode,style:{width:"100%"}},{default:v((()=>[e(F,{value:"and"},{default:v((()=>[m("AND（所有条件都要求匹配）")])),_:1}),e(F,{value:"or"},{default:v((()=>[m("OR（条件中的任意一个匹配）")])),_:1})])),_:1},8,["value","getPopupContainer"])])),_:1})])),_:1})])),_:1},512),[[b,n.dynamicRowValues.values.length>0]]),g(e(q,{ref:"formRef",class:y("jee-super-query-form"),model:n.dynamicRowValues,onFinish:n.onFinish},{default:v((()=>[(d(!0),c(j,null,O(n.dynamicRowValues.values,((t,a)=>(d(),p(Q,{key:t.key,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:v((()=>[e(V,{name:["values",a,"field"],style:{width:"180px"}},{default:v((()=>[e(D,{style:{width:"100%"},placeholder:"请选择字段",value:t.field,"onUpdate:value":e=>t.field=e,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},onChange:e=>n.handleChangeField(t),"tree-data":n.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])])),_:2},1032,["name"]),e(V,{name:["values",a,"rule"],style:{width:"180px"}},{default:v((()=>[e(T,{style:{width:"100%"},placeholder:"请选择匹配规则",value:t.rule,"onUpdate:value":e=>t.rule=e},{default:v((()=>[e(F,{value:"eq"},{default:v((()=>[m("等于")])),_:1}),e(F,{value:"like"},{default:v((()=>[m("模糊")])),_:1}),e(F,{value:"right_like"},{default:v((()=>[m("以..开始")])),_:1}),e(F,{value:"left_like"},{default:v((()=>[m("以..结尾")])),_:1}),e(F,{value:"in"},{default:v((()=>[m("在...中")])),_:1}),e(F,{value:"ne"},{default:v((()=>[m("不等于")])),_:1}),e(F,{value:"gt"},{default:v((()=>[m("大于")])),_:1}),e(F,{value:"ge"},{default:v((()=>[m("大于等于")])),_:1}),e(F,{value:"lt"},{default:v((()=>[m("小于")])),_:1}),e(F,{value:"le"},{default:v((()=>[m("小于等于")])),_:1})])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["name"]),e(V,{name:["values",a,"val"],style:{width:"280px"}},{default:v((()=>[e(H,{style:{width:"100%"},schema:n.getSchema(t,a),formModel:t,setFormModel:(e,a)=>{n.setFormModel(e,a,t)}},null,8,["schema","formModel","setFormModel"])])),_:2},1032,["name"]),e(V,null,{default:v((()=>[e(w,{onClick:e=>n.addOne(a),style:{"margin-right":"6px"}},{default:v((()=>[e(z)])),_:2},1032,["onClick"]),e(w,{onClick:e=>n.removeOne(t)},{default:v((()=>[e(P)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["model","onFinish"]),[[b,n.dynamicRowValues.values.length>0]])])),_:1}),e(R,{sm:24,md:6},{default:v((()=>[e(N,{class:"j-super-query-history-card",bordered:!0},{title:v((()=>[le])),default:v((()=>[0===n.saveTreeData.length?(d(),p(M,{key:0,class:"j-super-query-history-empty",description:"没有保存任何查询"})):(d(),p(B,{key:1,class:"j-super-query-history-tree",treeData:n.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:n.handleTreeSelect},{title:v((({title:t})=>[f("div",null,[f("span",{title:t},_(t.length>10?t.substring(0,10)+"...":t),9,ne),f("span",oe,[e(A,{onClick:e=>n.handleRemoveSaveInfo(t)},null,8,["onClick"])])])])),custom:v((()=>[e(U)])),_:1},8,["treeData","onSelect"]))])),_:1})])),_:1})])),_:1})])),_:1},8,["onRegister","onOk"])])),e(E,{title:"请输入保存的名称",visible:n.saveInfo.visible,onCancel:a[4]||(a[4]=e=>n.saveInfo.visible=!1),onOk:n.doSaveQueryInfo},{default:v((()=>[f("div",ie,[e(J,{value:n.saveInfo.title,"onUpdate:value":a[3]||(a[3]=e=>n.saveInfo.title=e),style:{width:"90%"},placeholder:"请输入保存的名称"},null,8,["value"])])])),_:1},8,["visible","onOk"])],64)}],["__scopeId","data-v-2878ef8e"]]);export{re as default};
