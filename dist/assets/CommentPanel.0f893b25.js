var j=(t,n,a)=>new Promise((e,u)=>{var p=c=>{try{s(a.next(c))}catch(d){u(d)}},g=c=>{try{s(a.throw(c))}catch(d){u(d)}},s=c=>c.done?e(c.value):Promise.resolve(c.value).then(p,g);s((a=a.apply(t,n)).next())});import{fl as Te,l as Fe,bo as Me,y as i,bv as Ee,bp as Pe,cA as K,au as re,m as Ne,F,a7 as He,a1 as V,ab as Le,a as ee,L as $e,u as Re,q,e as X,fm as ue,fc as me,fd as oe,dG as fe,H as te,t as v,v as I,x,z as h,aV as l,aw as N,bb as le,Y as H,D as U,E as J,W as P,C as T,du as _e,aM as B,bH as ze,bi as ne,o as de,R as Ce,fn as Ve,S as qe,V as ae,eh as Ye,d7 as Oe,$ as We,a9 as ve,dp as Ge,dq as Je,cl as Xe,eq as Ze}from"./index.df6cbb3d.js";import{v as ge,U as Qe}from"./JAddInput.40436f5c.js";import"./index.696f9d2b.js";import{j as Ke}from"./api.1cb48a64.js";import{c as et}from"./functional.78b6c3eb.js";import{_ as tt}from"./JUpload.b938f4f4.js";var nt=function(){return{actions:Array,author:K.any,avatar:K.any,content:K.any,prefixCls:String,datetime:K.any}},at=Fe({name:"AComment",props:nt(),slots:["actions","author","avatar","content","datetime"],setup:function(n,a){var e=a.slots,u=Me("comment",n),p=u.prefixCls,g=u.direction,s=function(r,m){return i("div",{class:"".concat(r,"-nested")},[m])},c=function(r){if(!r||!r.length)return null;var m=r.map(function(_,C){return i("li",{key:"action-".concat(C)},[_])});return m};return function(){var d,r,m,_,C,w,o,f,y,O,D,L=p.value,E=(d=n.actions)!==null&&d!==void 0?d:(r=e.actions)===null||r===void 0?void 0:r.call(e),R=(m=n.author)!==null&&m!==void 0?m:(_=e.author)===null||_===void 0?void 0:_.call(e),z=(C=n.avatar)!==null&&C!==void 0?C:(w=e.avatar)===null||w===void 0?void 0:w.call(e),k=(o=n.content)!==null&&o!==void 0?o:(f=e.content)===null||f===void 0?void 0:f.call(e),S=(y=n.datetime)!==null&&y!==void 0?y:(O=e.datetime)===null||O===void 0?void 0:O.call(e),A=i("div",{class:"".concat(L,"-avatar")},[typeof z=="string"?i("img",{src:z,alt:"comment-avatar"},null):z]),Y=E?i("ul",{class:"".concat(L,"-actions")},[c(Array.isArray(E)?E:[E])]):null,W=i("div",{class:"".concat(L,"-content-author")},[R&&i("span",{class:"".concat(L,"-content-author-name")},[R]),S&&i("span",{class:"".concat(L,"-content-author-time")},[S])]),se=i("div",{class:"".concat(L,"-content")},[W,i("div",{class:"".concat(L,"-content-detail")},[k]),Y]),ie=i("div",{class:"".concat(L,"-inner")},[A,se]),Z=Ee((D=e.default)===null||D===void 0?void 0:D.call(e));return i("div",{class:[L,Pe({},"".concat(L,"-rtl"),g.value==="rtl")]},[ie,Z&&Z.length?s(L,Z):null])}}}),ot=Te(at),lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"},st=lt;function Ie(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){it(t,u,a[u])})}return t}function it(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var pe=function(n,a){var e=Ie({},n,a.attrs);return i(re,Ie({},e,{icon:st}),null)};pe.displayName="MessageOutlined";pe.inheritAttrs=!1;var ct=pe,dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},rt=dt;function we(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){ut(t,u,a[u])})}return t}function ut(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var he=function(n,a){var e=we({},n,a.attrs);return i(re,we({},e,{icon:rt}),null)};he.displayName="SmileOutlined";he.inheritAttrs=!1;var mt=he,ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},_t=ft;function ke(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){vt(t,u,a[u])})}return t}function vt(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var ye=function(n,a){var e=ke({},n,a.attrs);return i(re,ke({},e,{icon:_t}),null)};ye.displayName="UserAddOutlined";ye.inheritAttrs=!1;var gt=ye;var xe="/assets/excel.73e31c52.svg",pt="/assets/other.c9fbb14a.svg",ht="/assets/pdf.f8d68ae5.svg",yt="/assets/txt.8d556a18.svg",Se="/assets/word.9460f3fc.svg";const bt=Ne(),Ct=bt.uploadUrl;let G="";const It=()=>V.get({url:"/sys/comment/getFileViewDomain"}),wt=t=>V.get({url:"/sys/comment/listByForm",params:t}),kt=t=>{let n={id:t};return V.get({url:"/sys/comment/queryById",params:n},{isTransformResponse:!1})},xt=t=>V.get({url:"/sys/comment/fileList",params:t}),St=t=>V.delete({url:"/sys/comment/deleteOne",params:t},{joinParamsToUrl:!0}),Ft=t=>{let n="/sys/comment/addText";return V.post({url:n,params:t},{isTransformResponse:!1})},Lt=t=>V.get({url:"/sys/dataLog/queryDataVerList",params:t},{isTransformResponse:!1}),Ae=`${Ct}/sys/comment/addFile`;function je(t){let n={biz:"comment",commentId:""};const{createMessage:a}=Re(),e=F(!1);function u(c,d){return j(this,null,function*(){e.value=!0,setTimeout(()=>{e.value=!1},500),yield p(c),yield s(d)})}function p(c){return j(this,null,function*(){const{fromUserId:d,toUserId:r,commentId:m,commentContent:_}=c;let C={tableName:t.tableName,tableDataId:t.dataId,fromUserId:d,commentContent:_,toUserId:"",commentId:""};r&&(C.toUserId=r),m&&(C.commentId=m),n.commentId="";const w=yield Ft(C);if(w.success)n.commentId=w.result;else return a.warning(w.message),Promise.reject("\u4FDD\u5B58\u8BC4\u8BBA\u5931\u8D25")})}function g(c){return j(this,null,function*(){let d=Ae;const r=new FormData;return r.append("file",c),r.append("tableName",t.tableName),r.append("tableDataId",t.dataId),Object.keys(n).map(m=>{r.append(m,n[m])}),new Promise((m,_)=>{Ke(d,r).then(C=>{console.log("uploadMyFile",C),C&&C.data?C.data.result=="success"?m(1):(a.warning(C.data.message),_()):_()})})})}function s(c){return j(this,null,function*(){if(c&&c.length>0)for(let d=0;d<c.length;d++){let r=Le(c[d]);yield g(r.originFileObj)}})}return{saveCommentAndFiles:u,buttonLoading:e}}function be(){const t=He({}),n={xls:xe,xlsx:xe,pdf:ht,txt:yt,docx:Se,doc:Se};function a(o){if(console.log("\u83B7\u53D6\u6587\u4EF6\u80CC\u666F\u56FE",o),r(o))return"none";{const f=o.name;if(!f)return"none";const y=f.substring(f.lastIndexOf(".")+1);console.log("suffix",y);let O=n[y];return O||(O=pt),O}}function e(o,f){return new Promise((y,O)=>{let D=new FileReader;o?(D.readAsDataURL(o),D.onload=function(){let L=D.result;console.log("base",L),t[f]=L,console.log("imageSrcMap",t),y(L)}):O()})}function u(o){if(r(o)){let f=o.uid;e(o,f)}}function p(o){let f=ee(o.url);f&&window.open(f)}function g(o){let f=o.fileSize;return f?Math.round(f/1024)+" KB":"0B"}const s=F([]);function c(o){return u(o),s.value=[...s.value,o],console.log("selectFileList",$e(s)),!1}function d(o){const f=s.value.indexOf(o),y=s.value.slice();y.splice(f,1),s.value=y}function r(o){return(o.type||"").indexOf("image")>=0}function m(o){if(r(o)){let f=o.uid;if(f){if(t[f])return t[f]}else if(o.url)return ee(o.url)}return""}function _(o){let f=m(o);return f?{backgroundImage:"url('"+f+"')"}:{}}function C(o){return j(this,null,function*(){if(r(o)){let f=m(o);f&&et({imageList:[f]})}else if(o.url){let f=ee(o.url);yield w(),window.open(G+"?officePreviewType=pdf&url="+encodeURIComponent(f))}})}function w(){return j(this,null,function*(){G||(G=yield It()),G.startsWith("http")||(G="http://"+G)})}return{selectFileList:s,getBackground:a,getFileSize:g,downLoad:p,beforeUpload:c,handleRemove:d,isImage:r,getImageSrc:m,getImageAsBackground:_,viewImage:C}}function Ue(t){const n=new RegExp("([^:]+)?(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)","g");function a(p){return p?p.replace(n,function(g,s,c){const d=s||"";if(e(d,'alt="')||e(d,'data-text="'))return g;let r=t.findEmoji(c);return r?d+u(r):g}):""}function e(p,g){return p.endsWith(g)}function u(p){return`<span style="width: 24px" class="emoji-mart-emoji"><span class="my-emoji-icon emoji-set-apple emoji-type-image" style="${`position: absolute;top: -3px;left: 3px;width: 18px; height: 18px;background-position: ${p.getPosition()}`}"> </span> </span>`}return{globalEmojiIndex:t,getHtml:a}}function Ot(){return window.innerHeight}const At={name:"UploadChunk",components:{Tooltip:X,UploadOutlined:ge,FolderOutlined:ue,DownloadOutlined:me,PaperClipOutlined:oe,DeleteOutlined:fe},props:{visible:{type:Boolean,default:!1}},emits:["select"],setup(t,{emit:n}){const{selectFileList:a,beforeUpload:e,handleRemove:u,getBackground:p,isImage:g,getImageSrc:s,viewImage:c}=be();function d(){let m=Le(a.value);return console.log(m),m}function r(){a.value=[]}return te(()=>a.value,m=>{if(m&&m.length>0){let _=m[0].name;_&&n("select",_)}}),{selectFileList:a,beforeUpload:e,handleRemove:u,getBackground:p,getUploadFileList:d,clear:r,isImage:g,getImageSrc:s,viewImage:c}}},jt={key:0},Ut={class:"j-icon"},Bt={class:"inner-button"},Dt=T("\u4E0A\u4F20"),Tt={class:"j-icon"},Mt={class:"inner-button"},Et=T("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?"),Pt={key:0,class:"selected-file-warp"},Nt={class:"selected-file-list"},Ht={class:"item"},$t={class:"complex"},Rt={class:"content"},zt={key:0,class:"content-top",style:{height:"100%"}},Vt={class:"content-top"},qt=["title"],Yt=["onClick"],Wt={class:"text"},Gt={class:"buttons"},Jt={class:"opt-icon"},Xt=_e('<div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div> <div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div>',7);function Zt(t,n,a,e,u,p){const g=v("upload-outlined"),s=v("a-upload"),c=v("folder-outlined"),d=v("a-alert"),r=v("delete-outlined"),m=v("Tooltip");return a.visible?(I(),x("div",jt,[i(d,{type:"info",class:"jeecg-comment-files",style:{margin:"0"}},{message:h(()=>[l("span",Ut,[i(s,{multiple:"","file-list":e.selectFileList,"onUpdate:file-list":n[0]||(n[0]=_=>e.selectFileList=_),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[l("span",Bt,[i(g),Dt])]),_:1},8,["file-list","before-upload"])]),l("span",Tt,[l("span",Mt,[i(c),Et])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(I(),x("div",Pt,[l("div",Nt,[(I(!0),x(N,null,le(e.selectFileList,_=>(I(),x("div",Ht,[l("div",$t,[l("div",Rt,[e.isImage(_)?(I(),x("div",zt,[l("div",{class:"content-image",style:H({height:"100%",backgroundImage:"url("+e.getImageSrc(_)+")"})},null,4)])):(I(),x(N,{key:1},[l("div",Vt,[l("div",{class:"content-icon",style:H({background:"url("+e.getBackground(_)+")  no-repeat"})},null,4)]),l("div",{class:"content-bottom",title:_.name},[l("span",null,U(_.name),1)],8,qt)],64))]),l("div",{class:J(["layer",{"layer-image":e.isImage(_)}])},[l("div",{class:"next",onClick:C=>e.viewImage(_)},[l("div",Wt,U(_.name),1)],8,Yt),l("div",Gt,[l("div",Jt,[i(m,{title:"\u5220\u9664"},{default:h(()=>[i(r,{onClick:C=>e.handleRemove(_)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),Xt])])):P("",!0)])):P("",!0)}var Qt=q(At,[["render",Zt],["__scopeId","data-v-7abc3564"]]);const Kt={categories:{recent:"\u6700\u5E38\u7528\u7684",smileys:"\u8868\u60C5\u9009\u62E9",people:"\u4EBA\u7269&\u8EAB\u4F53",nature:"\u52A8\u7269&\u81EA\u7136",foods:"\u98DF\u7269&\u996E\u6599",activity:"\u6D3B\u52A8",places:"\u65C5\u884C&\u5730\u70B9",objects:"\u7269\u54C1",symbols:"\u7B26\u53F7",flags:"\u65D7\u5E1C"}},en={name:"MyComment",components:{UserAddOutlined:gt,Tooltip:X,UserSelectModal:Qe,PaperClipOutlined:oe,UploadChunk:Qt,SmileOutlined:mt},props:{inner:B.bool.def(!1),inputFocus:{type:Boolean,default:!1}},emits:["cancel","comment"],setup(t,{emit:n}){const a=F(!1),e=F(),[u,{openModal:p}]=ze(),g=F(!1),s=F("");function c(){console.log(s.value);let b=s.value;if(!b&&b!=="0")d.value=!0;else{g.value=!0;let M=[];a.value==!0&&(M=e.value.getUploadFileList()),n("comment",b,M),setTimeout(()=>{g.value=!1},350)}}const d=F(!1);te(s,()=>{let b=s.value;!b&&b!=="0"?d.value=!0:d.value=!1});function r(){n("cancel")}const m=F();te(()=>t.inputFocus,b=>{b==!0&&(s.value="",a.value==!0&&(e.value.clear(),a.value=!1))},{deep:!0,immediate:!0});function _(){p(!0,{isUpdate:!1})}function C(b){if(console.log("setValue",b),b&&b.length>0){const{label:M,value:$}=b[0];if(M&&$){let ce=`${M}[${$}]`,Q=s.value;Q?Q.endsWith("@")?s.value=Q+ce:s.value="@"+ce+" "+Q:s.value="@"+ce}}}function w(){}te(()=>s.value,b=>{b&&b.endsWith("@")&&_()});const o=F();function f(b){let M=s.value||"";M+=b,s.value=M,o.value.click()}const y=F(!1);function O(b){let M=s.value||"",$=b.colons;$.indexOf("::")>0&&($=$.substring(0,$.indexOf(":")+1)),s.value=M+$,y.value=!1,Y()}const D={width:"490px"};function L(b){console.log("handleClickBlank"),b.preventDefault(),b.stopPropagation(),y.value=!1,W.value=!0}function E(b){console.log("handleShowEmoji"),b.preventDefault(),b.stopPropagation(),y.value=!y.value}const R=ne("$globalEmojiIndex"),{getHtml:z}=Ue(R),k=de(()=>{let b=s.value;return b?z(b):"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"}),S=F(!1);function A(b){b.preventDefault(),b.stopPropagation(),S.value=!1,m.value.focus(),console.log(234),W.value=!0}function Y(){S.value=!0}const W=F(!1),se=de(()=>!(s.value.length>0));function ie(){s.value.length==0&&(W.value=!1,a.value=!1)}function Z(b){s.value.length==0&&(s.value=b)}return{myComment:s,sendComment:c,noComment:r,disabledButton:d,buttonLoading:g,commentRef:m,registerModal:u,openSelectUser:_,setValue:C,handleCommentChange:w,uploadRef:e,uploadVisible:a,onSelectEmoji:f,optionsName:Kt,emojiButton:o,emojiIndex:R,showEmoji:O,pickerStyles:D,visibleEmoji:y,handleClickBlank:L,handleShowEmoji:E,commentHtml:k,showHtml:S,handleClickHtmlShower:A,handleBlur:Y,commentActive:W,noConent:se,changeActive:ie,selectFirstFile:Z}}},tn=["innerHTML"],nn={key:0,class:"comment-buttons"},an={style:{cursor:"pointer"}},on={title:"\u8868\u60C5",style:{display:"inline-block"}},ln={style:{position:"relative"}},sn={key:0},cn=T("\u53D6\u6D88"),dn=T("\u53D1 \u9001"),rn=l("span",null,null,-1);function un(t,n,a,e,u,p){const g=v("user-add-outlined"),s=v("Tooltip"),c=v("PaperClipOutlined"),d=v("SmileOutlined"),r=v("a-button"),m=v("upload-chunk"),_=v("UserSelectModal"),C=v("Picker"),w=v("a-modal");return I(),x(N,null,[l("div",{class:J({"comment-active":e.commentActive}),style:{border:"1px solid #eee",margin:"0",position:"relative"},onClick:n[5]||(n[5]=(...o)=>e.handleClickBlank&&e.handleClickBlank(...o))},[Ce(l("textarea",{ref:"commentRef","onUpdate:modelValue":n[0]||(n[0]=o=>e.myComment=o),onInput:n[1]||(n[1]=(...o)=>e.handleCommentChange&&e.handleCommentChange(...o)),onBlur:n[2]||(n[2]=(...o)=>e.handleBlur&&e.handleBlur(...o)),class:"comment-content",rows:3,placeholder:"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"},null,544),[[Ve,e.myComment]]),l("div",{class:J(["comment-content comment-html-shower",{"no-content":e.noConent,"top-div":e.showHtml,"bottom-div":e.showHtml==!1}]),innerHTML:e.commentHtml,onClick:n[3]||(n[3]=(...o)=>e.handleClickHtmlShower&&e.handleClickHtmlShower(...o))},null,10,tn),e.commentActive?(I(),x("div",nn,[l("div",an,[i(s,{title:"\u9009\u62E9@\u7528\u6237"},{default:h(()=>[i(g,{onClick:e.openSelectUser},null,8,["onClick"])]),_:1}),i(s,{title:"\u4E0A\u4F20\u9644\u4EF6"},{default:h(()=>[i(c,{onClick:n[4]||(n[4]=o=>e.uploadVisible=!e.uploadVisible)})]),_:1}),l("span",on,[i(d,{ref:"emojiButton",onClick:e.handleShowEmoji},null,8,["onClick"]),Ce(l("div",ln,null,512),[[qe]])])]),e.commentActive?(I(),x("div",sn,[a.inner?(I(),ae(r,{key:0,onClick:e.noComment,style:{"margin-right":"10px"}},{default:h(()=>[cn]),_:1},8,["onClick"])):P("",!0),i(r,{type:"primary",onClick:e.sendComment,loading:e.buttonLoading,disabled:e.disabledButton},{default:h(()=>[dn]),_:1},8,["onClick","loading","disabled"])])):P("",!0)])):P("",!0),i(m,{ref:"uploadRef",visible:e.uploadVisible,onSelect:e.selectFirstFile},null,8,["visible","onSelect"])],2),i(_,{labelKey:"realname",rowKey:"username",onRegister:e.registerModal,onGetSelectResult:e.setValue,isRadioSelection:""},null,8,["onRegister","onGetSelectResult"]),i(w,{visible:e.visibleEmoji,"onUpdate:visible":n[6]||(n[6]=o=>e.visibleEmoji=o),footer:null,wrapClassName:"emoji-modal",closable:!1,width:490},{title:h(()=>[rn]),default:h(()=>[i(C,{pickerStyles:e.pickerStyles,i18n:e.optionsName,data:e.emojiIndex,emoji:"grinning",showPreview:!1,infiniteScroll:!1,showSearch:!1,showSkinTones:!1,set:"apple",onSelect:e.showEmoji},null,8,["pickerStyles","i18n","data","onSelect"])]),_:1},8,["visible"])],64)}var mn=q(en,[["render",un]]);const fn={name:"HistoryFileList",props:{dataList:{type:Array,default:()=>[]},isComment:{type:Boolean,default:!1}},components:{UploadOutlined:ge,FolderOutlined:ue,DownloadOutlined:me,PaperClipOutlined:oe,DeleteOutlined:fe,Tooltip:X},setup(){const{getBackground:t,getFileSize:n,downLoad:a,isImage:e,getImageAsBackground:u,viewImage:p}=be();return{getBackground:t,downLoad:a,getFileSize:n,isImage:e,getImageAsBackground:u,viewImage:p}}},_n={class:"selected-file-list"},vn={class:"item"},gn={class:"complex"},pn={class:"content"},hn={key:0,class:"content-top",style:{height:"100%"}},yn={class:"content-top"},bn=["title"],Cn=["onClick"],In={class:"text"},wn={class:"text"},kn={class:"buttons"},xn={class:"opt-icon"},Sn=_e('<div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div> <div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div>',7);function Fn(t,n,a,e,u,p){const g=v("download-outlined"),s=v("Tooltip");return I(),x("div",{class:J(["comment-file-his-list",a.isComment===!0?"in-comment":""])},[l("div",_n,[(I(!0),x(N,null,le(a.dataList,c=>(I(),x("div",vn,[l("div",gn,[l("div",pn,[e.isImage(c)?(I(),x("div",hn,[l("div",{class:"content-image",style:H(e.getImageAsBackground(c))},null,4)])):(I(),x(N,{key:1},[l("div",yn,[l("div",{class:"content-icon",style:H({background:"url("+e.getBackground(c)+")  no-repeat"})},null,4)]),l("div",{class:"content-bottom",title:c.name},[l("span",null,U(c.name),1)],8,bn)],64))]),l("div",{class:J(["layer",{"layer-image":e.isImage(c)}])},[l("div",{class:"next",onClick:d=>e.viewImage(c)},[l("div",In,U(c.name),1),l("div",wn,U(e.getFileSize(c)),1)],8,Cn),l("div",kn,[l("div",xn,[i(s,{title:"\u4E0B\u8F7D"},{default:h(()=>[i(g,{onClick:d=>e.downLoad(c)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),Sn])],2)}var Be=q(fn,[["render",Fn],["__scopeId","data-v-e4322150"]]);const Ln=Fe({name:"CommentList",components:{MessageOutlined:ct,AComment:ot,Tooltip:X,MyComment:mn,Popconfirm:Ye,HistoryFileList:Be},props:{tableName:B.string.def(""),dataId:B.string.def(""),datetime:B.number.def(1)},setup(t){const n=F([]),{userInfo:a}=Oe(),e=ne("$dayjs");function u(){return a.realname?a.realname.substr(0,2):""}function p(){return a.avatar}function g(k){return k.fromUserAvatar?ee(k.fromUserAvatar):""}function s(k){return k.fromUserId_dictText?k.fromUserId_dictText.substr(0,2):"\u672A\u77E5"}function c(k){return k.toUser?k.fromUserId_dictText+" \u56DE\u590D "+k.fromUserId_dictText:k.fromUserId_dictText}function d(k){return k.createTime?e(k.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}const r=F(300),m=F(300);We(()=>{r.value=window.innerHeight-57-46-70-160,m.value=window.innerHeight-57-46-53-20});function _(){return j(this,null,function*(){const k={tableName:t.tableName,tableDataId:t.dataId,column:"createTime",order:"desc"},S=yield wt(k);if(!S||!S.records||S.records.length==0)n.value=[];else{let A=S.records;console.log(123,A),n.value=A}})}const{saveCommentAndFiles:C}=je(t);function w(k,S,A){return j(this,null,function*(){console.log(S,k);let Y={fromUserId:a.id,toUserId:k.fromUserId,commentId:k.id,commentContent:S};yield C(Y,A),yield _()})}function o(k,S){return j(this,null,function*(){let A={fromUserId:a.id,commentContent:k};yield C(A,S),yield _(),y.value=!1,setTimeout(()=>{y.value=!0},100)})}function f(k){return j(this,null,function*(){const S={id:k.id};yield St(S),yield _()})}const y=F(!1);function O(k){let S=n.value;for(let A of S)A.commentStatus=!1;k.commentStatus=!0,y.value=!1,y.value=!0}ve(()=>{t.datetime&&t.tableName&&t.dataId&&_()});const D=ne("$globalEmojiIndex"),{getHtml:L}=Ue(D),E=F();function R(){E.value.changeActive()}function z(k,S){return j(this,null,function*(){if(k==!0&&!S.commentId_dictText){const A=yield kt(S.commentId);A.success==!0?S.commentId_dictText=A.result.commentContent:(console.error(A.message),S.commentId_dictText="\u8BE5\u8BC4\u8BBA\u5DF2\u88AB\u5220\u9664")}})}return{dataList:n,getAvatar:g,getAvatarText:s,getAuthor:c,getDateDiff:d,commentHeight:r,allHeight:m,replyComment:w,sendComment:o,getMyname:u,getMyAvatar:p,focusStatus:y,showReply:O,deleteComment:f,getHtml:L,handleClickItem:R,bottomCommentRef:E,visibleChange:z}}}),De=t=>(Ge("data-v-07e4cb61"),t=t(),Je(),t),On={class:"comment-author"},An=De(()=>l("span",null,"\u56DE\u590D",-1)),jn=["innerHTML"],Un=["onClick"],Bn=De(()=>l("span",null,"\u5220\u9664",-1)),Dn=["innerHTML"],Tn={key:0},Mn={key:0,class:"inner-comment"},En={style:{position:"absolute",bottom:"0",left:"0",width:"100%",background:"#fff","border-top":"1px solid #eee"}};function Pn(t,n,a,e,u,p){const g=v("a-avatar"),s=v("message-outlined"),c=v("Tooltip"),d=v("Popconfirm"),r=v("history-file-list"),m=v("a-comment"),_=v("my-comment"),C=v("a-list-item"),w=v("a-list");return I(),x("div",{style:H({position:"relative",height:t.allHeight+"px"})},[i(w,{class:"jeecg-comment-list",header:"","item-layout":"horizontal","data-source":t.dataList,style:H({height:t.commentHeight+"px"})},{renderItem:h(({item:o})=>[i(C,{style:{"padding-left":"10px","flex-direction":"column"},onClick:t.handleClickItem},{default:h(()=>[i(m,null,{avatar:h(()=>[i(g,{class:"tx",src:t.getAvatar(o),alt:t.getAvatarText(o)},{default:h(()=>[T(U(t.getAvatarText(o)),1)]),_:2},1032,["src","alt"])]),author:h(()=>[l("div",On,[l("span",null,U(o.fromUserId_dictText),1),o.toUserId?(I(),x(N,{key:0},[An,l("span",null,U(o.toUserId_dictText),1),i(c,{class:"comment-last-content",onVisibleChange:f=>t.visibleChange(f,o)},{title:h(()=>[l("div",{innerHTML:t.getHtml(o.commentId_dictText)},null,8,jn)]),default:h(()=>[i(s)]),_:2},1032,["onVisibleChange"])],64)):P("",!0)])]),datetime:h(()=>[l("div",null,[i(c,{title:o.createTime},{default:h(()=>[l("span",null,U(t.getDateDiff(o)),1)]),_:2},1032,["title"])])]),actions:h(()=>[l("span",{onClick:f=>t.showReply(o)},"\u56DE\u590D",8,Un),i(d,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:f=>t.deleteComment(o)},{default:h(()=>[Bn]),_:2},1032,["onConfirm"])]),content:h(()=>[l("div",{innerHTML:t.getHtml(o.commentContent),style:{"font-size":"15px"}},null,8,Dn),o.fileList&&o.fileList.length>0?(I(),x("div",Tn,[i(r,{dataList:o.fileList,isComment:""},null,8,["dataList"])])):P("",!0)]),_:2},1024),o.commentStatus?(I(),x("div",Mn,[i(_,{inner:"",onCancel:f=>o.commentStatus=!1,onComment:(f,y)=>t.replyComment(o,f,y),inputFocus:t.focusStatus},null,8,["onCancel","onComment","inputFocus"])])):P("",!0)]),_:2},1032,["onClick"])]),_:1},8,["data-source","style"]),l("div",En,[i(m,{style:{margin:"0 10px"}},{avatar:h(()=>[i(g,{class:"tx",src:t.getMyAvatar(),alt:t.getMyname()},{default:h(()=>[T(U(t.getMyname()),1)]),_:1},8,["src","alt"])]),content:h(()=>[i(_,{ref:"bottomCommentRef",onComment:t.sendComment,inputFocus:t.focusStatus},null,8,["onComment","inputFocus"])]),_:1})])],4)}var Nn=q(Ln,[["render",Pn],["__scopeId","data-v-07e4cb61"]]);const Hn={name:"CommentFiles",components:{UploadOutlined:ge,FolderOutlined:ue,JUpload:tt,DownloadOutlined:me,PaperClipOutlined:oe,DeleteOutlined:fe,Tooltip:X,HistoryFileList:Be},props:{tableName:B.string.def(""),dataId:B.string.def(""),datetime:B.number.def(1)},setup(t){const{userInfo:n}=Oe(),a=F([]),e=F("");function u(){return j(this,null,function*(){const f={tableName:t.tableName,tableDataId:t.dataId},y=yield xt(f);if(console.log("1111",y),!y||!y.records||y.records.length==0)a.value=[];else{let O=y.records;console.log(123,O),a.value=O}e.value=""})}ve(()=>{t.datetime&&t.tableName&&t.dataId&&u()});const{saveCommentAndFiles:p,buttonLoading:g}=je(t),{selectFileList:s,beforeUpload:c,handleRemove:d,getBackground:r,isImage:m,getImageAsBackground:_,viewImage:C}=be();function w(){s.value=[]}function o(){return j(this,null,function*(){let f={fromUserId:n.id,commentContent:"\u4E0A\u4F20\u4E86\u9644\u4EF6"};yield p(f,s.value),s.value=[],yield u()})}return{selectFileList:s,beforeUpload:c,handleRemove:d,getBackground:r,isImage:m,dataList:a,uploadFileUrl:Ae,quxiao:w,queding:o,buttonLoading:g,getImageAsBackground:_,viewImage:C}}},$n={class:"j-icon"},Rn={class:"inner-button"},zn=T("\u4E0A\u4F20"),Vn={class:"j-icon"},qn={class:"inner-button"},Yn=T("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?"),Wn={key:0,class:"selected-file-warp"},Gn={class:"selected-file-list"},Jn={class:"item"},Xn={class:"complex"},Zn={class:"content"},Qn={key:0,class:"content-top",style:{height:"100%"}},Kn={class:"content-top"},ea=["title"],ta=["onClick"],na={class:"text"},aa={class:"buttons"},oa={class:"opt-icon"},la=_e('<div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div> <div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div>',7),sa={style:{"margin-bottom":"24px","margin-top":"18px","text-align":"right"}},ia=T("\u53D6\u6D88"),ca=T("\u786E\u5B9A");function da(t,n,a,e,u,p){const g=v("upload-outlined"),s=v("a-upload"),c=v("folder-outlined"),d=v("a-alert"),r=v("delete-outlined"),m=v("Tooltip"),_=v("a-button"),C=v("history-file-list");return I(),x("div",null,[i(d,{type:"info",class:"jeecg-comment-files"},{message:h(()=>[l("span",$n,[i(s,{multiple:"","file-list":e.selectFileList,"onUpdate:file-list":n[0]||(n[0]=w=>e.selectFileList=w),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[l("span",Rn,[i(g),zn])]),_:1},8,["file-list","before-upload"])]),l("span",Vn,[l("span",qn,[i(c),Yn])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(I(),x("div",Wn,[l("div",Gn,[(I(!0),x(N,null,le(e.selectFileList,w=>(I(),x("div",Jn,[l("div",Xn,[l("div",Zn,[e.isImage(w)?(I(),x("div",Qn,[l("div",{class:"content-image",style:H(e.getImageAsBackground(w))},null,4)])):(I(),x(N,{key:1},[l("div",Kn,[l("div",{class:"content-icon",style:H({background:"url("+e.getBackground(w)+")  no-repeat"})},null,4)]),l("div",{class:"content-bottom",title:w.name},[l("span",null,U(w.name),1)],8,ea)],64))]),l("div",{class:J(["layer",{"layer-image":e.isImage(w)}])},[l("div",{class:"next",onClick:o=>e.viewImage(w)},[l("div",na,U(w.name),1)],8,ta),l("div",aa,[l("div",oa,[i(m,{title:"\u5220\u9664"},{default:h(()=>[i(r,{onClick:o=>e.handleRemove(w)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),la]),l("div",sa,[i(_,{onClick:e.quxiao},{default:h(()=>[ia]),_:1},8,["onClick"]),i(_,{type:"primary",style:{"margin-left":"10px"},onClick:e.queding,loading:e.buttonLoading},{default:h(()=>[ca]),_:1},8,["onClick","loading"])])])):P("",!0),i(C,{dataList:e.dataList},null,8,["dataList"])])}var ra=q(Hn,[["render",da],["__scopeId","data-v-8e4402d4"]]);const ua={name:"DataLogList",components:{PlusOutlined:Xe,EditOutlined:Ze,Tooltip:X},props:{tableName:B.string.def(""),dataId:B.string.def(""),datetime:B.number.def(1)},setup(t){const n=ne("$dayjs"),a=Ot(),e=F(300);e.value=a-46-57-53-30;const u=F([]),p=F(0);function g(){return j(this,null,function*(){const d={dataTable:t.tableName,dataId:t.dataId,type:"comment"},r=yield Lt(d);if(!r||!r.result||r.result.length==0)u.value=[],p.value=-1;else{let m=r.result;p.value=m.length-1,console.log("log-list",m),u.value=m}})}ve(()=>{t.datetime&&t.tableName&&t.dataId&&(console.log(t.tableName,t.dataId),g())});function s(d){return d.createTime?n(d.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}function c(){console.log("\u6B64\u529F\u80FD\u672A\u5F00\u653E")}return{height:e,lastIndex:p,dataList:u,getDateDiff:s,handleClickPerson:c}}},ma={class:"data-log-content"},fa={class:"logbox"},_a={class:"log-item"},va={class:"log-item-icon"},ga={class:"log-item-content"},pa={class:"log-item-date"};function ha(t,n,a,e,u,p){const g=v("plus-outlined"),s=v("edit-outlined"),c=v("Tooltip");return I(),x("div",{class:"data-log-scroll",style:H({height:e.height+"px"})},[l("div",ma,[l("div",fa,[(I(!0),x(N,null,le(e.dataList,(d,r)=>(I(),x("div",_a,[l("span",va,[e.lastIndex==r?(I(),ae(g,{key:0,style:{"margin-top":"3px"}})):(I(),ae(s,{key:1}))]),l("span",ga,[l("a",{onClick:n[0]||(n[0]=(...m)=>e.handleClickPerson&&e.handleClickPerson(...m))},"@"+U(d.createBy),1),T(" "+U(d.dataContent),1)]),l("div",pa,[i(c,{title:d.createTime},{default:h(()=>[l("span",null,U(e.getDateDiff(d)),1)]),_:2},1032,["title"])])]))),256))])])],4)}var ya=q(ua,[["render",ha],["__scopeId","data-v-10e1db0a"]]);const ba={name:"CommentPanel",components:{CommentList:Nn,CommentFiles:ra,DataLogList:ya},props:{tableName:B.string.def(""),dataId:B.string.def("")},setup(t){const n=de(()=>!!(t.dataId&&t.tableName)),a=F(1),e=F(1),u=F(1);function p(s){let c=new Date().getTime();s=="comment"?a.value=c:s=="file"?e.value=c:u.value=c}function g(){let s=new Date().getTime();a.value=s,e.value=s,u.value=s}return{showStatus:n,handleChange:p,datetime1:a,datetime2:e,datetime3:u,reload:g}}},Ca={key:0,class:"comment-tabs-warp"};function Ia(t,n,a,e,u,p){const g=v("comment-list"),s=v("a-tab-pane"),c=v("comment-files"),d=v("data-log-list"),r=v("a-tabs"),m=v("a-empty");return e.showStatus?(I(),x("div",Ca,[i(r,{onChange:e.handleChange,animated:!1},{default:h(()=>[i(s,{tab:"\u8BC4\u8BBA",key:"comment",class:"comment-list-tab"},{default:h(()=>[i(g,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime1},null,8,["tableName","dataId","datetime"])]),_:1}),i(s,{tab:"\u6587\u4EF6",key:"file"},{default:h(()=>[i(c,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime2},null,8,["tableName","dataId","datetime"])]),_:1}),i(s,{tab:"\u65E5\u5FD7",key:"log"},{default:h(()=>[i(d,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime3},null,8,["tableName","dataId","datetime"])]),_:1})]),_:1},8,["onChange"])])):(I(),ae(m,{key:1,description:"\u65B0\u589E\u9875\u9762\u4E0D\u652F\u6301\u8BC4\u8BBA"}))}var Aa=q(ba,[["render",Ia],["__scopeId","data-v-2a7eafbc"]]);export{Aa as C};
