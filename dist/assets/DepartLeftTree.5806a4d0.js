var d=(S,x,r)=>new Promise((A,g)=>{var B=l=>{try{a(r.next(l))}catch(s){g(s)}},p=l=>{try{a(r.throw(l))}catch(s){g(s)}},a=l=>l.done?A(l.value):Promise.resolve(l.value).then(B,p);a((r=r.apply(S,x)).next())});import"./index.c1c509d9.js";import{l as ye,bh as ve,F as c,bG as he,t as i,v as f,V as E,z as o,aU as m,y as n,W as q,x as K,D as P,av as W,L as I,ej as ge,C as _,Q as z,u as ke}from"./index.6c1aeca2.js";import{useMethods as Ce}from"./useMethods.eccfa16d.js";import{q as G,A as Q,d as De}from"./depart.api.c664bb73.js";import{s as Ee}from"./depart.user.api.9e1386a0.js";import xe from"./DepartFormModal.8850ee32.js";import"./BasicModal.2246c02b.js";import"./useWindowSizeFn.a6a246d2.js";import"./BasicForm.e500713f.js";import"./helper.15e1830a.js";import"./useFormItem.63b4eda3.js";import"./functional.32464814.js";import"./download.54491438.js";import"./base64Conver.030fa32c.js";import"./index.1785e33e.js";import"./index.9d763a26.js";import"./useCountdown.c7fbe84b.js";import"./JAddInput.5c78e955.js";import"./api.52ea4d1e.js";import"./props.0c0dfcc6.js";import"./index.5b79f8bf.js";import"./bem.8f063110.js";import"./props.ee552767.js";import"./useContextMenu.2ad8381d.js";import"./index.3803400c.js";import"./onMountedOrActivated.0e85db74.js";import"./index.2847d809.js";import"./htmlmixed.6fb02709.js";import"./vue.ab8c7c18.js";/* empty css             */import"./usePopBiz.651349c4.js";import"./JUpload.7c7f9634.js";import"./index.af09c9a6.js";import"./uniqBy.b316cd09.js";import"./useForm.f4b29e26.js";import"./depart.data.ff6c9320.js";const Ae={class:"j-table-operator",style:{width:"100%"}},Be=_("\u65B0\u589E"),Fe=_("\u6DFB\u52A0\u4E0B\u7EA7"),we=_("\u5BFC\u5165"),Te=_("\u5BFC\u51FA"),be=_("\u540C\u6B65\u4F01\u5FAE?"),Ke=_("\u540C\u6B65\u9489\u9489?"),Ie=m("span",null,"\u5220\u9664",-1),Se=m("span",null,"\u6279\u91CF\u64CD\u4F5C ",-1),Re={key:1},Ue=_("\u6DFB\u52A0\u5B50\u7EA7"),Le=m("span",{style:{color:"red"}},"\u5220\u9664",-1),kt=ye({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(S,{expose:x,emit:r}){ve("prefixCls");const{createMessage:A}=ke(),{handleImportXls:g,handleExportXls:B}=Ce(),p=c(!1),a=c([]),l=c([]),s=c([]),h=c([]),F=c(!1),H=c(!0),w=c(null),T=c(null),J=c(""),[O,{openModal:R}]=he();function y(){return d(this,null,function*(){try{p.value=!0,a.value=[];const e=yield G();if(Array.isArray(e)&&(a.value=e),s.value.length===0)U();else if(h.value.length===0){let t=a.value[0];t&&k(t.id,t)}else r("select",w.value);r("rootTreeData",a.value)}finally{p.value=!1}})}y();function Y(e){return d(this,null,function*(){try{const t=yield G({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,s.value.length>0){let u=[];for(let C of s.value)t.findIndex(D=>D.id===C)!==-1&&u.push(C);u.length>0&&(s.value=[...s.value])}a.value=[...a.value],r("rootTreeData",a.value)}catch(t){console.error(t)}return Promise.resolve()})}function U(){let e=a.value[0];e?(e.isLeaf||(s.value=[e.key]),k(e.id,e),Z()):r("select",null)}function Z(){return d(this,null,function*(){yield z(),F.value=!0,yield z(),F.value=!1})}function k(e,t){h.value=[e],t&&(w.value=t,r("select",t))}function ee(){R(!0,{isUpdate:!1,isChild:!1})}function L(e=w.value){if(e==null){A.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};R(!0,{isUpdate:!1,isChild:!0,record:t})}function te(e){return d(this,null,function*(){if(e)try{p.value=!0,a.value=[];let t=yield Ee({keyWord:e});Array.isArray(t)&&(a.value=t),U()}finally{p.value=!1}else y();J.value=e})}function oe(e){Array.isArray(e)?l.value=e:l.value=e.checked}function ne(e,t){console.log("select: ",e,t),e.length>0&&h.value[0]!==e[0]?k(e[0],t.selectedNodes[0]):k(h.value[0])}function M(e,t=!0){return d(this,null,function*(){const u=I(e);if(u.length>0)try{p.value=!0,yield De({ids:u.join(",")},t),yield y()}finally{p.value=!1}})}function ae(e){return d(this,null,function*(){e&&(V(!1),M([e.id],!1))})}function le(){return d(this,null,function*(){try{yield M(l),l.value=[]}finally{}})}function V(e){e||(T.value=null)}function ue(e){g(e,Q.importExcelUrl,()=>{y()})}function ie(){B("\u90E8\u95E8\u4FE1\u606F",Q.exportXlsUrl)}return x({loadRootTreeData:y}),(e,t)=>{const u=i("a-button"),C=i("a-upload"),D=i("icon"),b=i("a-menu-item"),$=i("a-menu"),X=i("a-dropdown"),se=i("a-divider"),re=i("a-alert"),ce=i("a-input-search"),pe=i("a-tree"),de=i("a-empty"),fe=i("a-spin"),me=i("a-card");return f(),E(me,{bordered:!1,style:{height:"100%"}},{default:o(()=>[m("div",Ae,[n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ee},{default:o(()=>[Be]),_:1}),n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>L())},{default:o(()=>[Fe]),_:1}),n(C,{name:"file",showUploadList:!1,customRequest:ue},{default:o(()=>[n(u,{type:"primary",preIcon:"ant-design:import-outlined"},{default:o(()=>[we]),_:1})]),_:1}),n(u,{type:"primary",preIcon:"ant-design:export-outlined",onClick:ie},{default:o(()=>[Te]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:o(()=>[be]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:o(()=>[Ke]),_:1}),l.value.length>0?(f(),E(X,{key:0},{overlay:o(()=>[n($,null,{default:o(()=>[n(b,{key:"1",onClick:le},{default:o(()=>[n(D,{icon:"ant-design:delete-outlined"}),Ie]),_:1})]),_:1})]),default:o(()=>[n(u,null,{default:o(()=>[Se,n(D,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):q("",!0)]),n(re,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:o(()=>[l.value.length>0?(f(),K(W,{key:0},[m("span",null,"\u5DF2\u9009\u4E2D "+P(l.value.length)+" \u6761\u8BB0\u5F55",1),n(se,{type:"vertical"}),m("a",{onClick:t[1]||(t[1]=v=>l.value=[])},"\u6E05\u7A7A")],64)):(f(),K("span",Re,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),n(fe,{spinning:p.value},{default:o(()=>[n(ce,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:te}),a.value.length>0?(f(),K(W,{key:0},[F.value?q("",!0):(f(),E(pe,{key:0,checkable:"",clickRowToExpand:!1,treeData:a.value,selectedKeys:h.value,checkStrictly:H.value,"load-data":Y,checkedKeys:l.value,expandedKeys:s.value,"onUpdate:expandedKeys":t[3]||(t[3]=v=>s.value=v),onCheck:oe,onSelect:ne},{title:o(({key:v,title:_e,dataRef:j})=>[n(X,{trigger:["contextmenu"]},{overlay:o(()=>[n($,{onClick:t[2]||(t[2]=()=>{})},{default:o(()=>[n(b,{key:"1",onClick:N=>L(j)},{default:o(()=>[Ue]),_:2},1032,["onClick"]),n(b,{key:"2",onClick:N=>T.value=v},{default:o(()=>[Le]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[n(I(ge),{visible:T.value===v,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:N=>ae(j),onVisibleChange:V},{default:o(()=>[m("span",null,P(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(f(),E(de,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["spinning"]),n(xe,{rootTreeData:a.value,onRegister:I(O),onSuccess:y},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{kt as default};
