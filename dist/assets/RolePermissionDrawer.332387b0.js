var D=(g,y,s)=>new Promise((d,u)=>{var m=o=>{try{r(s.next(o))}catch(n){u(n)}},i=o=>{try{r(s.throw(o))}catch(n){u(n)}},r=o=>o.done?d(o.value):Promise.resolve(o.value).then(m,i);r((s=s.apply(g,y)).next())});import{a as $,u as N,B as j}from"./index.5994cd01.js";import{_ as q}from"./index.e581f59f.js";import{j as L,C as l,K as t,r as C,s as x,Q as I,w as c,v as f,bD as V,y as _,z as A,R as z,x as O,q as Q}from"./index.e8262126.js";import{_ as G}from"./RoleDataRuleDrawer.vue_vue_type_script_setup_true_lang.23ead2e7.js";import{d as H,e as J,f as M}from"./role.api.0e3c1d38.js";import"./bem.2b41de62.js";import"./props.4e7ed37e.js";import"./useContextMenu.47922f51.js";const U=L({__name:"RolePermissionDrawer",emits:["register"],setup(g,{emit:y}){const s=l([]),d=l([]),u=l([]),m=l([]),i=l([]),r=l(""),o=l(null),n=l(!1),[K,{openDrawer:F}]=$(),[E,{setDrawerProps:w,closeDrawer:R}]=N(e=>D(this,null,function*(){yield T(),w({confirmLoading:!1,loading:!0}),r.value=e.roleId;const a=yield H();s.value=a.treeList,d.value=a.ids;const p=yield J({roleId:t(r)});u.value=p,m.value=p,w({loading:!1})}));function B(e){u.value=e.checked?e.checked:e}function P(e){e&&e.length>0&&(i.value=e),F(!0,{functionId:t(i)[0],roleId:t(r)})}function T(){s.value=[],d.value=[],u.value=[],m.value=[],i.value=[],r.value=""}function b(){const e=t(o);if(!e)throw new Error("tree is null!");return e}function k(e){return D(this,null,function*(){let a={roleId:t(r),permissionIds:t(b().getCheckedKeys()).join(","),lastpermissionIds:t(m).join(",")};n.value=!0,yield M(a),n.value=!1,e&&R()})}return(e,a)=>{const p=C("Icon"),h=C("a-button");return x(),I(t(j),O(e.$attrs,{onRegister:t(E),title:"\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:"650px",destroyOnClose:"",showFooter:""}),{footer:c(()=>[f(t(V),{title:"\u786E\u5B9A\u653E\u5F03\u7F16\u8F91\uFF1F",onConfirm:t(R),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:c(()=>[_("\u53D6\u6D88")]),_:1},8,["onConfirm"]),f(h,{onClick:a[0]||(a[0]=v=>k(!1)),type:"primary",loading:n.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:c(()=>[_("\u4EC5\u4FDD\u5B58")]),_:1},8,["loading"]),f(h,{onClick:a[1]||(a[1]=v=>k(!0)),type:"primary",loading:n.value},{default:c(()=>[_("\u4FDD\u5B58\u5E76\u5173\u95ED")]),_:1},8,["loading"])]),default:c(()=>[f(t(q),{ref_key:"treeRef",ref:o,checkable:"",toolbar:"",treeData:s.value,checkedKeys:u.value,expandedKeys:d.value,selectedKeys:i.value,checkStrictly:!0,clickRowToExpand:!1,title:"\u6240\u62E5\u6709\u7684\u7684\u6743\u9650",onCheck:B,onSelect:P},{title:c(({slotTitle:v,ruleFlag:S})=>[_(A(v)+" ",1),S?(x(),I(p,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):z("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys"]),f(G,{onRegister:t(K)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});const se=Q(U,[["__scopeId","data-v-387e25e0"]]);export{se as default};
