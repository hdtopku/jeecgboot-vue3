var e=(e,t,r)=>new Promise(((n,a)=>{var l=e=>{try{u(r.next(e))}catch(t){a(t)}},o=e=>{try{u(r.throw(e))}catch(t){a(t)}},u=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,o);u((r=r.apply(e,t)).next())}));import{F as t,a1 as r,L as n}from"./index.435ab247.js";import{validateFormModelAndTables as a,VALIDATE_FAILED as l}from"./vxeUtils.7581a51b.js";function o(e,o,u,i,s,c){const f=t();return[function(e){var t,r;null==(r=null==(t=u[e])?void 0:t.value)||r.resetScrollTop(0)},function(){(function(){let e=Object.values(u);return Promise.all(e)})().then((e=>{let t=f.value.getFieldsValue();return a(f.value.validate,t,e,f.value.getProps)})).then((e=>c&&"function"==typeof c?c(e):function(e){return new Promise((t=>{t(e)}))}(e))).then((t=>{if("function"!=typeof o)throw`${"classifyIntoFormData"} 未定义或不是一个函数`;let r=o(t);return e(r)})).catch((e=>{e.error===l&&(i.value=null==e.index?n(i):s.value[e.index])}))},function(e,t,n,a){n.loading=!0,r.get({url:e,params:t},{isTransformResponse:!1}).then((e=>{let{result:t}=e;e.success&&t&&(Array.isArray(t)?n.dataSource=t:Array.isArray(t.records)&&(n.dataSource=t.records)),"function"==typeof a&&a(e)})).finally((()=>{n.loading=!1}))},f]}function u(t,r){function n(e){return e&&Object.keys(e).map((t=>{e[t]instanceof Array&&(e[t]=e[t].join(","))})),e}function a(r,n){return e(this,null,(function*(){return(yield r.validateTable())?(t.value=n,r.resetScrollTop(0),Promise.reject(1)):r.getTableData()}))}function l(r,a){return e(this,null,(function*(){try{let e=yield r.getFormData();return n(e),e}catch(e){return t.value=a,Promise.reject(e)}}))}return{getSubFormAndTableData:function(){return e(this,null,(function*(){let e={},t=Object.keys(r),n="";for(let o=0;o<t.length;o++){n=t[o];let u=r[n].value;if(u.isForm){let t=yield l(u,n);t&&(e[n+"List"]=[t])}else{let t=yield a(u,n);t&&t.length>0&&(e[n+"List"]=t)}}return e}))},transformData:n}}export{o as useJvxeMethod,u as useValidateAntFormAndTable};
