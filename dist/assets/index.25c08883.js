var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i;import{B as n}from"./BasicTable.fa29c153.js";import{T as l}from"./helper.c50e6850.js";import"./TableImg.2942a3dc.js";import{u as d}from"./useTable.fb0dd6ed.js";import{a1 as p,l as m,m as c,r as u,o as f,t as b,v as j,x as h,y as g,z as y,L as w,C as x,u as v}from"./index.b2c24a42.js";import"./BasicForm.fb9b9310.js";import"./uniqBy.be1d69f1.js";import"./index.12c6f6d1.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./useForm.5a9ed278.js";import"./JAddInput.2ba637e0.js";import"./useFormItem.9110ec70.js";import"./api.e26748d3.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./index.7e26b7de.js";import"./useContentHeight.aae13605.js";import"./useContentViewHeight.879059d9.js";import"./usePageContext.174066c3.js";import"./RedoOutlined.4dd49301.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./index.be1c9e2b.js";const O=[{title:"文件名称",dataIndex:"fileName",width:120},{title:"文件地址",dataIndex:"url",width:100}],C=[{label:"文件名称",field:"fileName",component:"Input",colProps:{span:6}},{label:"文件地址",field:"url",component:"Input",colProps:{span:6}}],I=e=>p.get({url:"/sys/oss/file/list",params:e}),P=x("OSS文件上传"),T=x("MINIO文件上传"),S=m({name:"system-ossfile"}),U=m((F=((e,t)=>{for(var o in t||(t={}))r.call(t,o)&&a(e,o,t[o]);if(i)for(var o of i(t))s.call(t,o)&&a(e,o,t[o]);return e})({},S),t(F,o({setup(e){const{createMessage:t}=v(),o=c(),i={"X-Access-Token":u()},[r,{reload:s}]=d({api:I,rowKey:"id",columns:O,formConfig:{labelWidth:120,schemas:C,autoSubmitOnEnter:!0},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},beforeFetch:e=>Object.assign({column:"createTime",order:"desc"},e),actionColumn:{width:80,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),a=f((()=>`${o.uploadUrl}/sys/oss/file/upload`)),m=f((()=>`${o.uploadUrl}/sys/upload/uploadMinio`));function x(e){if(e&&e.url){let t=encodeURIComponent(e.url);(t.endsWith(".pdf")||t.endsWith(".doc")||t.endsWith(".docx"))&&(t+="&officePreviewType=pdf");let i=`${o.viewUrl}?url=`+t;window.open(i,"_blank")}}function S(e){return t=this,o=null,i=function*(){var t,o;yield(t={id:e.id},o=s,p.delete({url:"/sys/oss/file/delete",params:t},{joinParamsToUrl:!0}).then((()=>{o()})))},new Promise(((e,r)=>{var s=e=>{try{n(i.next(e))}catch(t){r(t)}},a=e=>{try{n(i.throw(e))}catch(t){r(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,a);n((i=i.apply(t,o)).next())}));var t,o,i}function U(e){var o=e.type;if("image"===o){if(o.indexOf("image")<0)return t.warning("请上传图片"),!1}else if("file"===o&&o.indexOf("image")>=0)return t.warning("请上传文件"),!1;return!0}function F(e){"done"===e.file.status?e.file.response.success?(s(),t.success(`${e.file.name} 上传成功!`)):t.error(`${e.file.response.message}`):"error"===e.file.status&&t.error(`${e.file.response.message}`)}function M(e){return[{label:"预览",onClick:x.bind(null,e)},{label:"删除",popConfirm:{title:"是否确认删除",confirm:S.bind(null,e)}}]}return(e,t)=>{const o=b("a-button"),s=b("a-upload");return j(),h("div",null,[g(w(n),{onRegister:w(r)},{tableTitle:y((()=>[g(s,{name:"file",showUploadList:!1,action:w(a),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[P])),_:1})])),_:1},8,["action"]),g(s,{name:"file",showUploadList:!1,action:w(m),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[T])),_:1})])),_:1},8,["action"])])),action:y((({record:e})=>[g(w(l),{actions:M(e)},null,8,["actions"])])),_:1},8,["onRegister"])])}}}))));var F;export{U as default};
