import{O as ONL_FORM_TABLE_NAME,F as FormSchemaFactory,a as ONL_AUTH_PRE,V as VALIDATE_FAILED,S as SUBMIT_FLOW_KEY}from"./FormSchemaFactory.fdca3cac.js";import{d as duplicateCheck}from"./user.api.acc2a86d.js";import{c as commonjsGlobal}from"./_commonjsHelpers.7ef9cff5.js";import{y as createVNode,au as AntdIcon,a7 as reactive,e$ as _export_sfc,F as ref,o as computed,L as unref,bG as useModalInner,l as defineComponent,cI as Button,H as watch,h,cl as PlusOutlined,eq as EditOutlined,aM as propTypes,bH as useModal,ak as useDebounceFn,dL as useRouter,ab as toRaw,eg as usePermissionStore,f5 as replaceAll,a1 as defHttp,Q as nextTick,a9 as watchEffect,j as filterMultiDictText,f6 as markRaw,f7 as defineAsyncComponent,f8 as importViewsFile,a as getFileAccessHttpUrl,d7 as useUserStore,ev as Loading,t as resolveComponent,v as openBlock,V as createBlock,x as createElementBlock,z as withCtx,C as createTextVNode,D as toDisplayString,W as createCommentVNode,B as mergeProps,aV as createBaseVNode,aw as Fragment,bb as renderList,E as normalizeClass,r as getToken,f9 as goJmReportViewPage,u as useMessage}from"./index.a86a095a.js";import{C as CustomExpression}from"./customExpression.58041e91.js";import{T as TableAction,l as add}from"./helper.df0282ae.js";import OnlineSelectCascade from"./OnlineSelectCascade.0be50d84.js";import{B as BasicModal}from"./index.6aad32b5.js";import{B as BasicForm}from"./BasicForm.638a5420.js";import{u as useForm}from"./useForm.e5081d00.js";import"./JAddInput.b3ef411a.js";import{p as pick$1}from"./pick.dbff1c58.js";import{B as BasicTable,F as FormOutlined}from"./BasicTable.f15f6361.js";import"./TableImg.1a54e7ea.js";import{useListPage}from"./useListPage.46dec680.js";import{g as getAreaTextByCode}from"./Area.dd974528.js";import{c as createImgPreview}from"./functional.748b14f4.js";import LinkTableListPiece from"./LinkTableListPiece.bd04460f.js";import JModalTip from"./JModalTip.bfbecb4e.js";var DiffOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"},DiffOutlinedSvg=DiffOutlined$2;function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable}))),l.forEach(function(d){_defineProperty$2(e,d,n[d])})}return e}function _defineProperty$2(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var DiffOutlined=function(t,n){var l=_objectSpread$2({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$2({},l,{icon:DiffOutlinedSvg}),null)};DiffOutlined.displayName="DiffOutlined";DiffOutlined.inheritAttrs=!1;var DiffOutlined$1=DiffOutlined,MinusCircleFilled$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"},MinusCircleFilledSvg=MinusCircleFilled$2;function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable}))),l.forEach(function(d){_defineProperty$1(e,d,n[d])})}return e}function _defineProperty$1(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MinusCircleFilled=function(t,n){var l=_objectSpread$1({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$1({},l,{icon:MinusCircleFilledSvg}),null)};MinusCircleFilled.displayName="MinusCircleFilled";MinusCircleFilled.inheritAttrs=!1;var MinusCircleFilled$1=MinusCircleFilled,PrinterOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},PrinterOutlinedSvg=PrinterOutlined$2;function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(d){return Object.getOwnPropertyDescriptor(n,d).enumerable}))),l.forEach(function(d){_defineProperty(e,d,n[d])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var PrinterOutlined=function(t,n){var l=_objectSpread({},t,n.attrs);return createVNode(AntdIcon,_objectSpread({},l,{icon:PrinterOutlinedSvg}),null)};PrinterOutlined.displayName="PrinterOutlined";PrinterOutlined.inheritAttrs=!1;var PrinterOutlined$1=PrinterOutlined,__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,n)=>new Promise((l,d)=>{var c=C=>{try{S(n.next(C))}catch(P){d(P)}},m=C=>{try{S(n.throw(C))}catch(P){d(P)}},S=C=>C.done?l(C.value):Promise.resolve(C.value).then(c,m);S((n=n.apply(e,t)).next())}),dayjs_min={exports:{}};(function(e,t){(function(n,l){e.exports=l()})(commonjsGlobal,function(){var n=1e3,l=6e4,d=36e5,c="millisecond",m="second",S="minute",C="hour",P="day",w="week",y="month",A="quarter",_="year",I="date",B="Invalid Date",x=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,V=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(r){var s=["th","st","nd","rd"],i=r%100;return"["+r+(s[(i-20)%10]||s[i]||s[0])+"]"}},M=function(r,s,i){var a=String(r);return!a||a.length>=s?r:""+Array(s+1-a.length).join(i)+r},j={s:M,z:function(r){var s=-r.utcOffset(),i=Math.abs(s),a=Math.floor(i/60),f=i%60;return(s<=0?"+":"-")+M(a,2,"0")+":"+M(f,2,"0")},m:function r(s,i){if(s.date()<i.date())return-r(i,s);var a=12*(i.year()-s.year())+(i.month()-s.month()),f=s.clone().add(a,y),T=i-f<0,E=s.clone().add(a+(T?-1:1),y);return+(-(a+(i-f)/(T?f-E:E-f))||0)},a:function(r){return r<0?Math.ceil(r)||0:Math.floor(r)},p:function(r){return{M:y,y:_,w,d:P,D:I,h:C,m:S,s:m,ms:c,Q:A}[r]||String(r||"").toLowerCase().replace(/s$/,"")},u:function(r){return r===void 0}},J="en",L={};L[J]=k;var N=function(r){return r instanceof F},p=function r(s,i,a){var f;if(!s)return J;if(typeof s=="string"){var T=s.toLowerCase();L[T]&&(f=T),i&&(L[T]=i,f=T);var E=s.split("-");if(!f&&E.length>1)return r(E[0])}else{var H=s.name;L[H]=s,f=H}return!a&&f&&(J=f),f||!a&&J},b=function(r,s){if(N(r))return r.clone();var i=typeof s=="object"?s:{};return i.date=r,i.args=arguments,new F(i)},v=j;v.l=p,v.i=N,v.w=function(r,s){return b(r,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var F=function(){function r(i){this.$L=p(i.locale,null,!0),this.parse(i)}var s=r.prototype;return s.parse=function(i){this.$d=function(a){var f=a.date,T=a.utc;if(f===null)return new Date(NaN);if(v.u(f))return new Date;if(f instanceof Date)return new Date(f);if(typeof f=="string"&&!/Z$/i.test(f)){var E=f.match(x);if(E){var H=E[2]-1||0,U=(E[7]||"0").substring(0,3);return T?new Date(Date.UTC(E[1],H,E[3]||1,E[4]||0,E[5]||0,E[6]||0,U)):new Date(E[1],H,E[3]||1,E[4]||0,E[5]||0,E[6]||0,U)}}return new Date(f)}(i),this.$x=i.x||{},this.init()},s.init=function(){var i=this.$d;this.$y=i.getFullYear(),this.$M=i.getMonth(),this.$D=i.getDate(),this.$W=i.getDay(),this.$H=i.getHours(),this.$m=i.getMinutes(),this.$s=i.getSeconds(),this.$ms=i.getMilliseconds()},s.$utils=function(){return v},s.isValid=function(){return this.$d.toString()!==B},s.isSame=function(i,a){var f=b(i);return this.startOf(a)<=f&&f<=this.endOf(a)},s.isAfter=function(i,a){return b(i)<this.startOf(a)},s.isBefore=function(i,a){return this.endOf(a)<b(i)},s.$g=function(i,a,f){return v.u(i)?this[a]:this.set(f,i)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(i,a){var f=this,T=!!v.u(a)||a,E=v.p(i),H=function(R,W){var Q=v.w(f.$u?Date.UTC(f.$y,W,R):new Date(f.$y,W,R),f);return T?Q:Q.endOf(P)},U=function(R,W){return v.w(f.toDate()[R].apply(f.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(W)),f)},z=this.$W,Y=this.$M,ee=this.$D,X="set"+(this.$u?"UTC":"");switch(E){case _:return T?H(1,0):H(31,11);case y:return T?H(1,Y):H(0,Y+1);case w:var te=this.$locale().weekStart||0,ne=(z<te?z+7:z)-te;return H(T?ee-ne:ee+(6-ne),Y);case P:case I:return U(X+"Hours",0);case C:return U(X+"Minutes",1);case S:return U(X+"Seconds",2);case m:return U(X+"Milliseconds",3);default:return this.clone()}},s.endOf=function(i){return this.startOf(i,!1)},s.$set=function(i,a){var f,T=v.p(i),E="set"+(this.$u?"UTC":""),H=(f={},f[P]=E+"Date",f[I]=E+"Date",f[y]=E+"Month",f[_]=E+"FullYear",f[C]=E+"Hours",f[S]=E+"Minutes",f[m]=E+"Seconds",f[c]=E+"Milliseconds",f)[T],U=T===P?this.$D+(a-this.$W):a;if(T===y||T===_){var z=this.clone().set(I,1);z.$d[H](U),z.init(),this.$d=z.set(I,Math.min(this.$D,z.daysInMonth())).$d}else H&&this.$d[H](U);return this.init(),this},s.set=function(i,a){return this.clone().$set(i,a)},s.get=function(i){return this[v.p(i)]()},s.add=function(i,a){var f,T=this;i=Number(i);var E=v.p(a),H=function(Y){var ee=b(T);return v.w(ee.date(ee.date()+Math.round(Y*i)),T)};if(E===y)return this.set(y,this.$M+i);if(E===_)return this.set(_,this.$y+i);if(E===P)return H(1);if(E===w)return H(7);var U=(f={},f[S]=l,f[C]=d,f[m]=n,f)[E]||1,z=this.$d.getTime()+i*U;return v.w(z,this)},s.subtract=function(i,a){return this.add(-1*i,a)},s.format=function(i){var a=this,f=this.$locale();if(!this.isValid())return f.invalidDate||B;var T=i||"YYYY-MM-DDTHH:mm:ssZ",E=v.z(this),H=this.$H,U=this.$m,z=this.$M,Y=f.weekdays,ee=f.months,X=function(W,Q,Z,D){return W&&(W[Q]||W(a,T))||Z[Q].slice(0,D)},te=function(W){return v.s(H%12||12,W,"0")},ne=f.meridiem||function(W,Q,Z){var D=W<12?"AM":"PM";return Z?D.toLowerCase():D},R={YY:String(this.$y).slice(-2),YYYY:this.$y,M:z+1,MM:v.s(z+1,2,"0"),MMM:X(f.monthsShort,z,ee,3),MMMM:X(ee,z),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:X(f.weekdaysMin,this.$W,Y,2),ddd:X(f.weekdaysShort,this.$W,Y,3),dddd:Y[this.$W],H:String(H),HH:v.s(H,2,"0"),h:te(1),hh:te(2),a:ne(H,U,!0),A:ne(H,U,!1),m:String(U),mm:v.s(U,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:E};return T.replace(V,function(W,Q){return Q||R[W]||E.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(i,a,f){var T,E=v.p(a),H=b(i),U=(H.utcOffset()-this.utcOffset())*l,z=this-H,Y=v.m(this,H);return Y=(T={},T[_]=Y/12,T[y]=Y,T[A]=Y/3,T[w]=(z-U)/6048e5,T[P]=(z-U)/864e5,T[C]=z/d,T[S]=z/l,T[m]=z/n,T)[E]||z,f?Y:v.a(Y)},s.daysInMonth=function(){return this.endOf(y).$D},s.$locale=function(){return L[this.$L]},s.locale=function(i,a){if(!i)return this.$L;var f=this.clone(),T=p(i,a,!0);return T&&(f.$L=T),f},s.clone=function(){return v.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},r}(),g=F.prototype;return b.prototype=g,[["$ms",c],["$s",m],["$m",S],["$H",C],["$W",P],["$M",y],["$y",_],["$D",I]].forEach(function(r){g[r[1]]=function(s){return this.$g(s,r[0],r[1])}}),b.extend=function(r,s){return r.$i||(r(s,F,b),r.$i=!0),b},b.locale=p,b.isDayjs=N,b.unix=function(r){return b(1e3*r)},b.en=L[J],b.Ls=L,b.p={},b})})(dayjs_min);var dayjs=dayjs_min.exports;const ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(e=>CustomExpression[e]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(e,t,n){hasEffectiveValue(t.defVal)&&n.push({field:e,type:t.type,value:t.defVal})}function initSubTableDefValueConfig(e,t){hasEffectiveValue(e.fieldDefaultValue)&&t.push({field:e.key,type:e.type,value:e.fieldDefaultValue})}function loadFormFieldsDefVal(e,t){return __async(this,null,function*(){if(Array.isArray(e)&&e.length>0){let n={};for(let l of e){let{value:d,type:c,field:m}=l;d=yield handleDefaultValue(d,ACTION_TYPES.ADD,{}),c==="number"&&d&&(d=Number.parseFloat(d)),n[m]=d}t(n)}})}function loadOneFieldDefVal(e,t,n){return __async(this,null,function*(){let{defVal:l,type:d}=t;if(hasEffectiveValue(l)){let c=yield handleDefaultValue(l,ACTION_TYPES.ADD,{});d==="number"&&c&&(c=Number.parseFloat(c)),n[e]=c}})}function hasEffectiveValue(e){return!!(e||e===0)}function handleDefaultValue(e,t,n){return __async(this,null,function*(){if(e!=null&&checkExpressionType(e)){let l=yield getDefaultValue(e,t,n);if(l!=null)return l}return e})}function checkExpressionType(e){let t=0,n=0,l=0;if(e.replace(fillRuleRegExp,()=>l++),l>1)return logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u53EA\u80FD\u540C\u65F6\u586B\u5199\u4E00\u4E2A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\uFF01`),!1;e.replace(normalRegExp,()=>t++),e.replace(customRegExp,()=>n++);let d=t+n;return l>0&&d>0?(logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\u4E0D\u80FD\u548C\u5176\u4ED6\u8868\u8FBE\u5F0F\u6DF7\u7528\uFF01`),!1):!0}function getRegExpMap(e,t){let n=new Map;return e.replace(t,function(l,d){return n.set(l,d.trim()),l}),n}function getDefaultValue(e,t,n){return __async(this,null,function*(){return(t===ACTION_TYPES.ADD||t===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(e)?yield executeRegExp(e,fillRuleRegExp,executeFillRuleExpression,[n]):t===ACTION_TYPES.ADD?(e=yield executeRegExp(e,normalRegExp,executeNormalExpression),e=yield executeRegExp(e,customRegExp,executeCustomExpression),e):null})}function executeRegExp(e,t,n){return __async(this,arguments,function*(l,d,c,m=[]){let S=getRegExpMap(l,d);for(let C of S.keys()){let P=S.get(C),w=yield c.apply(null,[P,C,...m]);if(C===l)return w;l=replaceAll(l,C,w)}return l})}function executeNormalExpression(e,t){return __async(this,null,function*(){switch(e){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let n=getUserInfoByExpression(e);return n!=null?n:t}})}function getUserInfoByExpression(e){let n=useUserStore().getUserInfo;if(n)switch(e){case"sysUserId":return n.id;case"sysUserCode":case"sys_user_code":return n.username;case"sysUserName":return n.realname;case"sysOrgCode":case"sys_org_code":return n.orgCode}return null}function executeCustomExpression(expression,origin){return __async(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(e){return logError(e),origin}})}function executeFillRuleExpression(e,t,n){return __async(this,null,function*(){let l=`/sys/fillRule/executeRuleByCode/${e}`,d={};typeof n=="function"&&(d=n());let{success:c,message:m,result:S}=yield defHttp.put({url:l,params:d},{isTransformResponse:!1});return c?S:(logError(`\u586B\u503C\u89C4\u5219\uFF08${e}\uFF09\u6267\u884C\u5931\u8D25\uFF1A${m}`),t)})}function logWarn(e){console.warn("[loadFieldDefVal]:",e)}function logError(e){console.error("[loadFieldDefVal]:",e)}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(e,t)=>defHttp.get({url:e,params:t},{isTransformResponse:!1}),postAction=(e,t)=>defHttp.post({url:e,params:t},{isTransformResponse:!1}),putAction=(e,t)=>defHttp.put({url:e,params:t},{isTransformResponse:!1}),deleteAction=(e,t)=>defHttp.delete({url:e,params:t},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(e,t){EnhanceJS&&EnhanceJS[t]&&EnhanceJS[t](e)}function customBeforeSubmit(e,t){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(e,t):Promise.resolve()}function beforeDelete(e,t){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(e,t):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeDelete?t.beforeDelete(onlineTableContext,e):Promise.resolve()},onlineTableContext.beforeEdit=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeEdit?t.beforeEdit(onlineTableContext,e):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(e,{emit:t}){console.log("\u8FDB\u5165online\u5B50\u8868\u8868\u5355\u9875\u9762\u300B\u300B\u300B\u300B"+e.table);const n=ref(null),l=ref(!1),{formSchemas:d,defaultValueFields:c,changeDataIfArray2String:m,tableName:S,dbData:C,checkOnlyFieldValue:P,fieldDisplayStatus:w,createFormSchemas:y,baseColProps:A}=useFormItems(e,n),[_,{setProps:I,validate:B,resetFields:x,setFieldsValue:V,getFieldsValue:k}]=useForm({schemas:d,showActionButtonGroup:!1,baseColProps:A});watch(()=>e.table,()=>{S.value=e.table},{immediate:!0}),watch(()=>e.properties,F=>{console.log("\u4E3B\u8868properties\u6539\u53D8",e.properties),l.value=!1,M(),y(e.properties,e.requiredFields,P),l.value=!0},{deep:!0,immediate:!0}),watch(()=>e.mainId,F=>{console.log("\u4E3B\u8868ID\u6539\u53D8",e.mainId),setTimeout(()=>{J()},100)},{immediate:!0}),watch(()=>e.disabled,F=>{I({disabled:F})});function M(){return __async(this,null,function*(){let F=yield getRefPromise(n);F.$formValueChange=(g,r)=>{let s={[g]:r};t("formChange",s)}})}function j(){if(unref(e.isUpdate)===!1){let F=toRaw(c[S.value]);loadFormFieldsDefVal(F,g=>{V(g)})}}function J(){return __async(this,null,function*(){yield getRefPromise(l),yield x(),j();const{table:F,mainId:g}=e;if(!F||!g)return;let r=yield L(F,g);C.value=r,yield V(r)})}function L(F,g){let r=`${baseUrl}/${F}/${g}`;return new Promise((s,i)=>{defHttp.get({url:r},{isTransformResponse:!1}).then(a=>{console.log(a),a.success?s(a.result):(console.log(a.message),i())})}).finally(()=>{C.value=""})}function N(){return new Promise((F,g)=>{B().then(()=>{let r=k();r=m(r),F(r)}).catch(r=>{g(r)})})}function p(){let F=k();return F.id||(F.id="sub-change-temp-id"),{row:F,target:v}}function b(F){V(F)}const v={onlineFormRef:n,baseColProps:A,formSchemas:d,registerForm:_,setFieldsValue:V,getFieldsValue:k,getFormEvent:p,setValues:b,getAll:N,sh:w};return v}};function _sfc_render$5(e,t,n,l,d,c){const m=resolveComponent("BasicForm");return openBlock(),createBlock(m,{ref:"onlineFormRef",onRegister:e.registerForm},null,8,["onRegister"])}var OnlineSubForm=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"}));const urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading,OnlineSubForm,PrinterOutlined:PrinterOutlined$1,DiffOutlined:DiffOutlined$1,FormOutlined},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0},isVxeTableData:{type:Boolean,default:!1}},emits:["success","rendered","dataChange"],setup(e,{emit:t}){console.log("onlineForm-setup\u300B\u300B");const{createMessage:n}=useMessage(),[l,{openModal:d}]=useModal(),c=ref(""),m=ref(null),S=ref(!0),C=ref(!1),P=ref(1),w=ref(!1),y=ref(!1),A=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:_,resetContext:I}=useOnlineFormContext(),{formSchemas:B,defaultValueFields:x,changeDataIfArray2String:V,tableName:k,dbData:M,checkOnlyFieldValue:j,hasSubTable:J,subTabInfo:L,refMap:N,subDataSource:p,baseColProps:b,createFormSchemas:v,fieldDisplayStatus:F}=useFormItems(e,m);let{EnhanceJS:g,initCgEnhanceJs:r}=useEnhance(_,!1);const[s,{setProps:i,validate:a,resetFields:f,setFieldsValue:T,updateSchema:E,getFieldsValue:H,scrollToField:U}]=useForm({schemas:B,showActionButtonGroup:!1,baseColProps:b}),z=ref(!1);function Y(){let o=e.disabled;z.value=o,i({disabled:o})}function ee(o,u,O){return __async(this,null,function*(){console.log("onlinepopform\u65B0\u589E\u7F16\u8F91\u8FDB\u5165\u8868\u5355\u300B\u300Bform",u),yield f(),M.value="";let $=unref(o);y.value=$,$&&(yield te(u)),yield nextTick(()=>{!$&&O&&T(O),X(),ue("js","loaded"),Y()})})}function X(){if(unref(y)===!1){let o=toRaw(x[k.value]);loadFormFieldsDefVal(o,u=>{T(u)})}}function te(o){return __async(this,null,function*(){let u=yield R(o.id);(!u||Object.keys(u).length==0)&&(u=__spreadValues({},toRaw(o))),M.value=Object.assign({},u);let O=ne.value,$=pick$1(u,...O);e.isVxeTableData===!0&&($=Object.assign({},$,o)),yield T($)})}let ne=computed(()=>{let o=B.value,u=[];for(let O of o)u.push(O.field);return u});function R(o){let u=`${urlObject.optPre}${e.id}/${o}`;return new Promise((O,$)=>{defHttp.get({url:u},{isTransformResponse:!1}).then(K=>{K.success?O(K.result):($(),n.warning(K.message))}).catch(()=>{$()})})}function W(o){return __async(this,null,function*(){P.value=o.head.tableType,k.value=o.head.tableName,S.value=o.head.tableType==1,Q(o.head.extConfigJson),v(o.schema.properties,o.schema.required,j),g=r(o.enhanceJs),t("rendered",A);let u=yield getRefPromise(m);u.$formValueChange=(O,$)=>{Te(O,$)}})}function Q(o){let u={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};o&&(u=JSON.parse(o)),Object.keys(u).map(O=>{A[O]=u[O]})}function Z(){S.value===!0?ae():D()}function D(){q().then(o=>{ie(o)})}function q(){let o={};return new Promise((u,O)=>{a().then($=>u($),({errorFields:$})=>{$&&$.length>0&&U($[0][0]),O(VALIDATE_FAILED)})}).then(u=>(Object.assign(o,V(u)),re())).then(u=>(Object.assign(o,u),Promise.resolve(o))).catch(u=>(u===VALIDATE_FAILED||(u==null?void 0:u.code)===VALIDATE_FAILED?(n.warning("\u6821\u9A8C\u672A\u901A\u8FC7"),u.key&&G(u.key)):console.error(u),Promise.reject(null)))}function G(o){let u=L.value;for(let O=0;O<u.length;O++)if(o==u[O].key){se.value=O+"";break}}function re(){return new Promise((o,u)=>__async(this,null,function*(){let O={};try{let $=L.value;for(let K=0;K<$.length;K++){let le=$[K].key,oe=N[le].value;if(oe instanceof Array&&(oe=oe[0]),$[K].relationType==1)try{let ce=yield oe.getAll();O[le]=[],O[le].push(ce)}catch(ce){throw{code:VALIDATE_FAILED,key:le}}else{if(yield oe.fullValidateTable())throw{code:VALIDATE_FAILED,key:le};O[le]=oe.getTableData()}}}catch($){u($)}o(O)}))}function ae(){return __async(this,null,function*(){try{let o=yield a();o=Object.assign({},M.value,o),o=V(o),C.value=!0,ie(o)}finally{C.value=!1}})}function ie(o){De(he,o).then(()=>{$e(o)}).catch(u=>{n.warning(u)})}function ge(o,u,O){u&&O?O.setValues?O.setValues(o):O.setValues([{rowKey:u,values:o}]):T(o)}function be(o,u){let O={};O[o]=u,T(O)}const se=ref("0"),de=ref(300),fe=ref(340);function ve(o){if(y.value===!0){let u=M.value;return _e(u,o)}return""}function _e(o,u){if(o){let O=o[u];return!O&&O!==0&&(O=o[u.toLowerCase()],!O&&O!==0&&(O=o[u.toUpperCase()])),O}return""}function ye(o,u){if(g&&g[u+"_onlChange"]){let O=g[u+"_onlChange"](),$=Object.keys(o)[0];if(O[$]){let K=N[u].value;K instanceof Array&&(K=K[0]);let le=K.getFormEvent(),oe=__spreadValues({column:{key:$},value:o[$]},le);O[$].call(_,_,oe)}}}function Ce(o,u){if(g&&g[u+"_onlChange"]){let O=g[u+"_onlChange"](_);O[o.column.key]&&O[o.column.key].call(_,_,o)}}function Fe(o,u){console.log("handleAdded",o,u)}function Se(o){return"online_"+o+":"}function Te(o,u){return __async(this,null,function*(){if(M.value[o]!=u&&t("dataChange",o),!g||!g.onlChange||!o)return!1;let $=g.onlChange();if($[o]){let le={row:yield H(),column:{key:o},value:u};$[o].call(_,_,le)}})}function ue(o,u){if(o=="js")g&&g[u]&&g[u].call(_,_);else if(o=="action"){let O=M.value,$={formId:e.id,buttonCode:u,dataId:O.id,uiFormData:Object.assign({},O)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:$},{isTransformResponse:!1}).then(K=>{K.success?n.success("\u5904\u7406\u5B8C\u6210!"):n.warning("\u5904\u7406\u5931\u8D25!")})}}function me(o){let u=N[o].value,O=[...u.getNewDataWithId(),...p.value[o]];if(!O||O.length==0)return!1;let $=[];for(let K of O)$.push(K.id);u.removeRowsById($)}function pe(o,u){if(!u)return!1;let O=N[o].value;typeof u=="object"?O.addRows(u,!0):n.error("\u6DFB\u52A0\u5B50\u8868\u6570\u636E,\u53C2\u6570\u4E0D\u8BC6\u522B!")}function Oe(o,u){me(o),pe(o,u)}function we(o,u){!u&&u.length<=0&&(u=[]),u.map(O=>{O.hasOwnProperty("label")||(O.label=O.text)}),E({field:o,componentProps:{options:u}})}function De(o,u){return g&&g.beforeSubmit?g.beforeSubmit(o,u):Promise.resolve()}function xe(o,u){let O=toRaw(F);o&&o.length>0?Object.keys(O).map($=>{!$.endsWith("_load")&&o.indexOf($)<0&&(F[$]=!1)}):u&&u.length>0&&Object.keys(O).map($=>{u.indexOf($)>=0&&(F[$]=!1)})}function Be(o){return __async(this,null,function*(){console.log("\u81EA\u5B9A\u4E49\u5F39\u7A97\u6253\u5F00online\u8868\u5355\u300B\u300Bform",o),yield f(),M.value="",y.value=!0,yield te(o),yield nextTick(()=>{ue("js","loaded")})})}function Me(o){let u=N[o].value;return u instanceof Array&&(u=u[0]),u}function Pe(){let o=A.reportPrintUrl,u=M.value.id,O=getToken();goJmReportViewPage(o,u,O)}function Ee(o){console.log(o),c.value=o.id,d(!0)}function ke(o){console.log(o)}function $e(o){if(Object.keys(o).map(u=>{Array.isArray(o[u])&&o[u].length==0&&(o[u]="")}),console.log("\u63D0\u4EA4pop\u8868\u5355\u6570\u636E\u300B\u300B\u300Bform:",o),e.request==!1)t("success",o);else{let u=`${urlObject.optPre}${e.id}?tabletype=${P.value}`;console.log("\u63D0\u4EA4pop\u8868\u5355url\u300B\u300B\u300Burl:",u),w.value===!0&&(o[SUBMIT_FLOW_KEY]=1);let O=y.value===!0?"put":"post";defHttp.request({url:u,method:O,params:o},{isTransformResponse:!1}).then($=>{$.success?($.result&&(o.id||(o.id=$.result)),t("success",o),M.value=o,y.value=!0,n.success("\u64CD\u4F5C\u6210\u529F!")):n.warning($.message)}).finally(()=>{C.value=!1})}}function Ae(){return __async(this,null,function*(){let o=M.value,u=ne.value,O=pick$1(o,...u);if(o)yield T(O);else{let $={};for(let K of u)$[K]="";yield T($)}})}let he={tableName:k,loading:C,subActiveKey:se,onlineFormRef:m,getFieldsValue:H,setFieldsValue:T,submitFlowFlag:w,subFormHeight:de,subTableHeight:fe,refMap:N,triggleChangeValues:ge,triggleChangeValue:be,sh:F,clearSubRows:me,addSubRows:pe,clearThenAddRows:Oe,changeOptions:we,isUpdate:y,getSubTableInstance:Me};return I(he),{tableName:k,onlineFormRef:m,registerForm:s,loading:C,subActiveKey:se,hasSubTable:J,subTabInfo:L,refMap:N,subFormHeight:de,getSubTableForeignKeyValue:ve,isUpdate:y,handleSubFormChange:ye,subTableHeight:fe,onlineFormDisabled:z,subDataSource:p,getSubTableAuthPre:Se,handleAdded:Fe,handleValueChange:Ce,openSubFormModalForAdd:Ee,openSubFormModalForEdit:ke,registerVxeFormModal:l,vxeTableId:c,show:ee,createRootProperties:W,handleSubmit:Z,sh:F,handleCgButtonClick:ue,handleCustomFormSh:xe,handleCustomFormEdit:Be,dbData:M,onOpenReportPrint:Pe,onlineExtConfigJson:A,recoverFormData:Ae}}},_hoisted_1$3=["id"];function _sfc_render$4(e,t,n,l,d,c){const m=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:l.tableName+"_form"},[createVNode(m,{ref:"onlineFormRef",onRegister:l.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}var OnlinePopForm=_export_sfc(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(e,{emit:t}={},n){const l=ref(null),d=ref(!1),c=ref(1),m=ref([]),S=ref(!1),C=ref(0),P=ref(!1),w=ref(""),y=ref(!1),A=ref(!1),_=ref(!0),I=reactive({}),B=ref(!0),x=ref(""),V=ref(!0),k=ref(!1),{popModalFixedWidth:M,resetBodyStyle:j,popBodyStyle:J}=useFixedHeightModal(),L=ref(!1),N={handleOpenModal:D=>{}},p=ref(""),b=ref(""),v=ref(!1);let F={};const g=computed(()=>{let D=x.value;return D||(unref(d)===!0?"\u8BE6\u60C5":unref(A)===!0?"\u7F16\u8F91":"\u65B0\u589E")}),[r,{setModalProps:s,closeModal:i}]=useModalInner(D=>__async(this,null,function*(){x.value="",k.value=!1,e===!0?yield N.handleOpenModal(D):yield T(D),j(),n&&n()})),a=ref(!1);function f(){return __async(this,null,function*(){return yield getRefPromise(a),L.value})}function T(D){return __async(this,null,function*(){s({confirmLoading:!1}),A.value=D.isUpdate,d.value=D.disableSubmit||!1,(D==null?void 0:D.hideSub)===!0&&(B.value=!1),D!=null&&D.title&&(x.value=D.title),D!=null&&D.record?b.value=D.record.id:b.value="",yield nextTick(()=>__async(this,null,function*(){yield getRefPromise(S),H(),yield l.value.show(D==null?void 0:D.isUpdate,D==null?void 0:D.record,D==null?void 0:D.param)}))})}function E(D){S.value=!0,C.value=D.modalMinWidth,D.modelFullscreen==1?s({defaultFullscreen:!0}):s({defaultFullscreen:!1}),F=D}function H(){let D=b.value;F.commentStatus==1&&D?(v.value=!0,s({defaultFullscreen:!0})):v.value=!1}const U=800,z=1100,Y=computed(()=>{let D=200*(c.value-1),q=(unref(_)?U:z)+D;q=ee(q);let G=C.value;return console.log({minWidth:G}),G&&q<G&&(q=G),console.log({width:q}),q});function ee(D){let q=I.modalMinWidth;if(q!=null&&q!=="")try{if(q=Number.parseInt(q),D<q)return q}catch(G){console.warn("error modalMinWidth value: ",q)}return D}function X(D,q){l.value.handleCgButtonClick(D,q)}function te(){y.value=!0,setTimeout(()=>{y.value=!1},1500),l.value.handleSubmit()}function ne(){i()}function R(D,q={}){let G=`/online/cgform/api/getFormItem/${D}`;return new Promise((re,ae)=>{defHttp.get({url:G,params:q},{isTransformResponse:!1}).then(ie=>{console.log("\u8868\u5355\u7ED3\u679C\u300B\u300Bmodal:",ie),ie.success?re(ie.result):ae(ie.message)}).catch(()=>{ae()})})}function W(D,q){return __async(this,null,function*(){let G=yield R(D,q),re=G.head.formTemplate;c.value=re?Number(re):1,m.value=G.cgButtonList,P.value=G.head.isTree==="Y",w.value=G.head.treeParentIdField||"",p.value=G.head.tableName,G.form_disable_update===!0?L.value=!0:L.value=!1,a.value=!0,t&&t("formConfig",G),yield nextTick(()=>__async(this,null,function*(){yield(yield getRefPromise(l)).createRootProperties(G)}))})}function Q(D){D[ONL_FORM_TABLE_NAME]=p.value,t("success",D),V.value==!0&&i(),k.value=!1,V.value=!0}function Z(){l.value&&l.value.onCloseModal()}return{title:g,modalWidth:Y,registerModal:r,closeModal:i,modalObject:N,onCloseEvent:Z,cgButtonList:m,handleCgButtonClick:X,disableSubmit:d,handleSubmit:te,submitLoading:y,handleCancel:ne,successThenClose:V,handleSuccess:Q,topTipVisible:k,handleFormConfig:W,onlineFormCompRef:l,formTemplate:c,isTreeForm:P,pidFieldName:w,renderSuccess:E,formRendered:S,isUpdate:A,showSub:B,tableName:p,formDataId:b,enableComment:v,popBodyStyle:J,popModalFixedWidth:M,getFormStatus:f}}function useFixedHeightModal(){const t=ref(800);let n=window.innerWidth-300;n<800&&(n=800),t.value=n;const l=ref({});function d(){let c=window.innerHeight-210;l.value={height:c+"px",overflowY:"auto"}}return{popModalFixedWidth:t,popBodyStyle:l,resetBodyStyle:d}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1},isVxeTableData:{type:Boolean,default:!1}},components:{BasicModal,OnlinePopForm,JModalTip,Button},emits:["success","register","formConfig"],setup(e,{emit:t}){console.log("\u8FDB\u5165\u8868\u5355\u5F39\u6846\u300B\u300B\u300B\u300Bmodal");const{title:n,registerModal:l,cgButtonList:d,handleCgButtonClick:c,disableSubmit:m,handleSubmit:S,submitLoading:C,handleCancel:P,handleFormConfig:w,onlineFormCompRef:y,formTemplate:A,isTreeForm:_,pidFieldName:I,renderSuccess:B,formRendered:x,handleSuccess:V,topTipVisible:k,successThenClose:M,isUpdate:j,popBodyStyle:J,popModalFixedWidth:L,getFormStatus:N}=useAutoModal(!1,{emit:t});watch(()=>e.id,p,{immediate:!0});function p(){return __async(this,null,function*(){x.value=!1,e.id&&(console.log("\u91CD\u65B0\u6E32\u67D3\u8868\u5355\u300B\u300B\u300B\u300Bmodal"),yield w(e.id,{}))})}function b(){e.saveClose===!1&&(M.value=!1),S()}function v(){k.value=!1,y.value.recoverFormData()}function F(){k.value=!0}const g=computed(()=>j.value?e.topTip:!1),r=computed(()=>{if(j.value==!0)return null;{let i=C.value;return[h(Button,{type:"primary",loading:i,onClick:S},()=>"\u786E\u5B9A"),h(Button,{onClick:P},()=>"\u5173\u95ED")]}});return{title:n,topTipVisible:k,handleSaveData:b,handleRecover:v,onlineFormCompRef:y,renderSuccess:B,registerModal:l,handleSubmit:S,handleSuccess:V,handleCancel:P,formTemplate:A,disableSubmit:m,cgButtonList:d,handleCgButtonClick:c,isTreeForm:_,pidFieldName:I,submitLoading:C,handleDataChange:F,isUpdate:j,showTopTip:g,modalFooter:r,popBodyStyle:J,popModalFixedWidth:L,getFormStatus:N}}});function _sfc_render$3(e,t,n,l,d,c){const m=resolveComponent("j-modal-tip"),S=resolveComponent("online-pop-form"),C=resolveComponent("BasicModal");return openBlock(),createBlock(C,mergeProps({width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle},e.$attrs,{footer:e.modalFooter,cancelText:"\u5173\u95ED",onRegister:e.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:e.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(e.title)+" ",1),e.showTopTip?(openBlock(),createBlock(m,{key:0,visible:e.topTipVisible,onSave:e.handleSaveData,onCancel:e.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(S,{ref:"onlineFormCompRef",id:e.id,disabled:e.disableSubmit,"form-template":e.formTemplate,isTree:e.isTreeForm,pidField:e.pidFieldName,request:e.request,isVxeTableData:e.isVxeTableData,onRendered:e.renderSuccess,onSuccess:e.handleSuccess,onDataChange:e.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","isVxeTableData","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}var OnlinePopModal=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(e,t){const n="/online/cgform/api/getData/"+e;return defHttp.get({url:n,params:t})}function queryTableColumns(e,t){const n="/online/cgform/api/getColumns/"+e;return defHttp.get({url:n,params:t})}function useLinkTable(e){const t=ref("1"),n=ref({}),l=ref({}),d=ref(""),c=reactive({add:!0,update:!0}),m=computed(()=>e.textField?e.textField.split(","):[]),S=ref([]),C=computed(()=>{let p=S.value;return e.multi==!0?p.slice(0,3):p.slice(0,6)});watchEffect(()=>__async(this,null,function*(){if(e.tableName){let b=e.valueField||"",v=e.textField||"",F=[];if(b&&F.push(b),v){let r=v.split(",");d.value=r[0];for(let s of r)F.push(s)}let g=e.imageField||"";g&&F.push(g),n.value={linkTableSelectFields:F.join(",")},yield _(),yield I()}}));const P=computed(()=>{let p=e.textField||"",b=[],v="";if(p){let F=p.split(",");v=F[0];for(let g=0;g<F.length;g++)g>0&&b.push(F[g])}return{others:b,labelField:v}}),w=ref([]),y=ref([]),A=ref({});function _(){return __async(this,null,function*(){let p=n.value;const b=yield queryTableColumns(e.tableName,p);if(y.value=b.columns,b.columns){let v=e.imageField,F=b.columns.filter(g=>g.dataIndex!=d.value&&g.dataIndex!=v);S.value=F}if(A.value=b.dictOptions,console.log("\u9690\u85CF\u7684\u6309\u94AE",b.hideColumns),b.hideColumns){let v=b.hideColumns;v.indexOf("add")>=0?c.add=!1:c.add=!0,v.indexOf("update")>=0?c.update=!1:c.update=!0}})}function I(){return __async(this,null,function*(){let p=x(),v=(yield queryTableData(e.tableName,p)).records,F=[],{others:g,labelField:r}=P.value,s=e.imageField;if(v&&v.length>0)for(let i of v){let a=__spreadValues({},i);B(a);let f=Object.assign({},pick$1(a,g),{id:a.id,label:a[r],value:a[e.valueField]});s&&(f[s]=a[s]),F.push(f)}F.push({}),w.value=F})}function B(p){let b=y.value,v=A.value;for(let F of b){const{dataIndex:g,customRender:r}=F;(p[g]||p[g]===0)&&r&&r==g&&v[r]&&(p[g]=filterMultiDictText(v[r],p[g]))}}function x(){return Object.assign({pageSize:10,pageNo:t.value},n.value,l.value)}function V(p){if(!p)l.value={};else{let b=m.value,v=[],F=[];for(let g=0;g<b.length;g++)g<=1&&(F.push(b[g]),v.push({field:b[g],rule:"like",val:p}));v.superQueryMatchType="or",v.superQueryParams=encodeURI(JSON.stringify(v)),l.value=v}}function k(p){return __async(this,null,function*(){if(!p)return[];let b=e.valueField,v=__spreadProps(__spreadValues({},n.value),{pageSize:10,pageNo:t.value});v.superQueryMatchType="and";let F=[{field:b,rule:"in",val:p}];v.superQueryParams=encodeURI(JSON.stringify(F));let r=(yield queryTableData(e.tableName,v)).records,s=[];if(r&&r.length>0)for(let i of r){let a=__spreadValues({},i);B(a),s.push(a)}return s})}function M(p,b){if(!p||p.length==0)return!1;let v=b.split(",");if(v.length!=p.length)return!1;let F=!0;for(let g of p){let r=g[e.valueField];v.indexOf(r)<0&&(F=!1)}return F}function j(p){Object.keys(p).map(b=>{p[b]instanceof Array&&(p[b]=p[b].join(","))})}function J(p,b,v){if(v||(v={}),b&&b.length>0)for(let F of b){let g=F.split(","),r=g[0],s=g[1];if(p[r])p[r].push(v[s]);else{let i=v[s]||"";p[r]=[i]}}}function L(p){if(e.imageField){let b=p[e.imageField];return getFileAccessHttpUrl(b)}return""}const N=computed(()=>!!e.imageField);return{pageNo:t,otherColumns:S,realShowColumns:C,selectOptions:w,reloadTableLinkOptions:I,textFieldArray:m,addQueryParams:V,tableColumns:y,transData:B,mainContentField:d,loadOne:k,compareData:M,formatData:j,initFormData:J,getImageSrc:L,showImage:N,auths:c}}const _sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def([])},emits:["change","update:value"],setup(e,{emit:t}){const n=ref([]),{auths:l,mainContentField:d,textFieldArray:c,selectOptions:m,reloadTableLinkOptions:S,addQueryParams:C,formatData:P,initFormData:w,getImageSrc:y,showImage:A}=useLinkTable(e),[_,{openModal:I}]=useModal(),B=computed(()=>e.tableName),x=computed(()=>e.multi===!0?{mode:"multiple"}:{});function V(p){p==null||p.stopPropagation(),p==null||p.preventDefault(),I(!0,{})}function k(p,b){if(p==null||p.stopPropagation(),p==null||p.preventDefault(),l.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}I(!0,{isUpdate:!0,record:b})}function M(p){return __async(this,null,function*(){yield S();let b=p[e.valueField];n.value=b})}function j(p){C(p),S()}function J(p){L(p),p||(C(),S())}function L(p){let b={},v=e.linkFields,F=[];if(!p)w(b,v);else{let g=toRaw(m.value);console.log("options>>",g);let r=toRaw(p);r instanceof Array?F=[...r]:e.multi==!0?F=r.split(","):F=[r];let s=g.filter(i=>F.indexOf(i[e.valueField])>=0);if(s&&s.length>0){let i=__spreadValues({},s[0]);if(s.length>1)for(let f=1;f<s.length;f++)i=N(i,s[f]);let a=d.value;i[a]=i.label,w(b,v,i)}}P(b),t("change",F.join(",")||"",b),t("update:value",F.join(",")||"")}function N(p,b){let v={};return Object.keys(p).map(F=>{v[F]=(p[F]||"")+","+(b[F]||"")}),v}return watch(()=>e.value,p=>__async(this,null,function*(){p?(e.multi==!0?n.value=p.split(","):n.value=p,e.linkFields&&e.linkFields.length>0&&L(p)):n.value=[]}),{immediate:!0}),watch(()=>m.value,p=>{p&&p.length>0&&e.linkFields&&e.linkFields.length>0&&n.value&&n.value.length>0&&L(n.value)}),{selectValue:n,selectOptions:m,registerPopModal:_,popTableName:B,textFieldArray:c,handleClickAdd:V,handleClickEdit:k,getFormData:M,handleSearch:useDebounceFn(j,800),handleChange:J,bindValue:x,showImage:A,getImageSrc:y,auths:l}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(e,t,n,l,d,c){const m=resolveComponent("PlusOutlined"),S=resolveComponent("EditOutlined"),C=resolveComponent("a-select"),P=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(C,mergeProps({value:l.selectValue,"onUpdate:value":t[1]||(t[1]=w=>l.selectValue=w),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},l.bindValue,{options:l.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:l.handleSearch,onChange:l.handleChange}),{option:withCtx(w=>[!w.value&&l.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:t[0]||(t[0]=(...y)=>l.handleClickAdd&&l.handleClickAdd(...y))},[createVNode(m),createTextVNode(" \u8BB0\u5F55 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[l.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[l.getImageSrc(w)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(w),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[l.auths.update?(openBlock(),createBlock(S,{key:0,onClick:y=>l.handleClickEdit(y,w)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(w.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.textFieldArray,y=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(w[y]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(P,{id:l.popTableName,onRegister:l.registerPopModal,onSuccess:l.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableSelect=_export_sfc(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-2f5e23a7"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(e){dictOptionInfo.value=e.dictOptions,e.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange}:rowSelection.value=null,enableScrollBar.value=e.scrollFlag==1;let t=e.columns;t.forEach(c=>{Object.keys(c).map(m=>{c[m]==null&&delete c[m]})});let n=e.fieldHrefSlots;const l={};n.forEach(c=>l[c.slotName]=c);let d=[];if(d=handleColumnHrefAndDict(t,l),bpmStatusFilter(d),console.log("-----\u5217\u8868\u5217\u914D\u7F6E----",d),onlineTableContext.isTree()===!0){let c=e.textField,m=-1;for(let S=0;S<d.length;S++)if(d[S].dataIndex==c){m=S;break}if(m>0){let S=d.splice(m,1);d.unshift(S[0])}d.length>0&&(d[0].align="left")}columns.value=d,onlineTableContext.reloadTable()}function onSelectChange(e,t){selectedKeys.value=e,onlineTableContext.selectedRows=toRaw(t),onlineTableContext.selectedRowKeys=toRaw(e)}function handleColumnHrefAndDict(e,t){for(let n of e){let{customRender:l,hrefSlotName:d,fieldType:c}=n;if(c=="date"||c=="Date")n.customRender=({text:m})=>m?m.length>10?m.substring(0,10):m:"";else if(c=="link_table")n.customRender=({text:m,record:S})=>{if(!m)return"";if(onlineTableContext.isPopList===!0)return S[n.dataIndex+"_dictText"];{let C=(m+"").split(","),P=S[n.dataIndex+"_dictText"].split(","),w=[];for(let y=0;y<C.length;y++){let A=h(LinkTableListPiece,{id:C[y],text:P[y],onTab:_=>handleClickLinkTable(_,d)});w.push(A)}return w.length==0?"":h("div",{style:{overflow:"hidden"}},w)}};else{if(!d&&n.scopedSlots&&n.scopedSlots.customRender&&t.hasOwnProperty(n.scopedSlots.customRender)&&(d=n.scopedSlots.customRender),l||d){let m=l,S="_replace_text_";n.ellipsis=!0,n.customRender=({text:C,record:P})=>{let w=C;if(m)if(m.startsWith(S)){let y=m.replace(S,"");w=P[y]}else w=filterMultiDictText(unref(dictOptionInfo)[m],C+"");if(n.showLength&&w&&w.length>n.showLength&&(w=w.substr(0,n.showLength)+"..."),d){let y=t[d];if(y)return h("a",{onClick:()=>handleClickFieldHref(y,P)},w)}return w}}if(n.scopedSlots){n.ellipsis=!0;let m=n.scopedSlots;n.slots=m,delete n.scopedSlots}}}return e}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let e=href.split(":");hrefMainTableId.value=e[1];let t=e[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[t]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(e,t)=>record[t]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(e){return console.error(e),text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"\u5173\u95ED",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(e){let t=e.indexOf("?"),n=e;if(t!==-1){n=e.substring(0,t);let d=e.substring(t+1,e.length).split("&"),c={};d.forEach(m=>{let S=m.split("=");c[S[0]]=S[1]}),hrefComponent.params=c}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="\u64CD\u4F5C",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(n)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var e,t;((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedAction)===1&&(actionColumn.fixed=((t=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:t.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(e){let t=!1;for(let n=0;n<e.length;n++)if(e[n].dataIndex.toLowerCase()=="bpm_status"){t=!0;break}return onlineTableContext.hasBpmStatus=t,t}function downloadRowFile(e){if(!e)return;e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(",")));let t=getFileAccessHttpUrl(e);window.open(t)}function getImgView(e){return e&&e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(","))),getFileAccessHttpUrl(e)}function getPcaText(e){return e?getAreaTextByCode(e):""}function getFormatDate(e){if(!e)return"";let t=e;return t.length>10&&(t=t.substring(0,10)),t}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(e){if(e){let t=[],n=e.split(",");for(let l of n)l&&t.push(getFileAccessHttpUrl(l));createImgPreview({imageList:t})}}const onlinePopModalRef=ref();function handleClickLinkTable(e,t){return __async(this,null,function*(){popTableId.value=t,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=t,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:e}})):openPopModal(!0,{isUpdate:!0,record:{id:e}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable,TableAction,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(e,{emit:t}){const{createMessage:n}=useMessage(),{popModalFixedWidth:l,resetBodyStyle:d,popBodyStyle:c}=useFixedHeightModal(),m=ref(""),S=ref(800),[C,{closeModal:P}]=useModalInner(()=>{m.value="",E.value=[],H.value=[],f({current:1}),a(),d()}),[w,{openModal:y}]=useModal();function A(){P()}const _=computed(()=>{const R=E.value;return!(R&&R.length>0)}),I=ref(!1);function B(){I.value=!0;let R=toRaw(H.value);R&&R.length>0&&(t("success",R),P()),setTimeout(()=>{I.value=!1},200)}function x(R){const W="/online/cgform/api/getData/"+e.id;return defHttp.get({url:W,params:R})}function V(R){return R.column="id",new Promise((W,Q)=>__async(this,null,function*(){const Z=yield x(R);W(Z)}))}const k={isPopList:!0,reloadTable(){console.log("reloadTable")},isTree(){return!1}},M=ref({}),{columns:j,downloadRowFile:J,getImgView:L,getPcaText:N,getFormatDate:p,handleColumnResult:b,hrefComponent:v,viewOnlineCellImage:F}=useTableColumns(k,M);function g(){const R="/online/cgform/api/getColumns/"+e.id;return new Promise((W,Q)=>{defHttp.get({url:R},{isTransformResponse:!1}).then(Z=>{Z.success?W(Z.result):(n.warning(Z.message),Q())})})}const r=ref("");watch(()=>e.id,()=>__async(this,null,function*(){let R=yield g();b(R),r.value=R.description}),{immediate:!0});const{tableContext:s}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:V,clickToRowSelect:!0,columns:j,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:R=>X(R)}}),[i,{reload:a,setPagination:f},{rowSelection:T,selectedRowKeys:E,selectedRows:H}]=s;watch(()=>e.multi,R=>{R==!0?T.type="checkbox":T.type="radio"},{immediate:!0});function U(R){return[{label:"\u7F16\u8F91",onClick:z.bind(null,R)}]}function z(R){console.log("handleUpdate",R)}function Y(){a()}const ee=["int","double","Date","Datetime","BigDecimal"];function X(R){let W=m.value;if(!W)return R.superQueryMatchType="or",R.superQueryParams="",R;let Q=j.value,Z=[];if(Q&&Q.length>0)for(let D of Q)D.dbType&&(D.dbType=="string"?Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"like",val:W}):D.dbType=="Date"?W.length==10&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:W}):D.dbType=="Datetime"?W.length==19&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:W}):ee.indexOf(D.dbType)&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:W}));return R.superQueryMatchType="or",R.superQueryParams=encodeURI(JSON.stringify(Z)),R}function te(){y(!0,{})}function ne(R){console.log("handleDateSave",R),t("success",[R]),P()}return{registerModal:C,modalWidth:S,handleCancel:A,submitDisabled:_,submitLoading:I,handleSubmit:B,registerTable:i,getTableAction:U,searchText:m,onSearch:Y,downloadRowFile:J,getImgView:L,getPcaText:N,getFormatDate:p,hrefComponent:v,viewOnlineCellImage:F,rowSelection:T,modalTitle:r,registerPopModal:w,handleAdd:te,reload:a,popModalFixedWidth:l,popBodyStyle:c,handleDataSave:ne}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(e,t,n,l,d,c){const m=resolveComponent("PlusOutlined"),S=resolveComponent("a-button"),C=resolveComponent("a-input-search"),P=resolveComponent("TableAction"),w=resolveComponent("BasicTable"),y=resolveComponent("BasicModal"),A=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(y,{onRegister:e.registerModal,width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle,title:e.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[e.addAuth?(openBlock(),createBlock(S,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:e.handleAdd},{default:withCtx(()=>[createVNode(m),createTextVNode("\u65B0\u589E\u8BB0\u5F55")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(S,{key:"back",onClick:e.handleCancel},{default:withCtx(()=>[createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),createVNode(S,{disabled:e.submitDisabled,key:"submit",type:"primary",onClick:e.handleSubmit,loading:e.submitLoading},{default:withCtx(()=>[createTextVNode("\u786E\u5B9A")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(w,{onRegister:e.registerTable,rowSelection:e.rowSelection},{title:withCtx(()=>[createVNode(C,{value:e.searchText,"onUpdate:value":t[0]||(t[0]=_=>e.searchText=_),onSearch:e.onSearch,placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD\uFF0C\u6309\u56DE\u8F66\u641C\u7D22",style:{width:"100%"}},null,8,["value","onSearch"])]),action:withCtx(({record:_})=>[createVNode(P,{actions:e.getTableAction(_)},null,8,["actions"])]),fileSlot:withCtx(({text:_})=>[_?(openBlock(),createBlock(S,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:I=>e.downloadRowFile(_)},{default:withCtx(()=>[createTextVNode(" \u4E0B\u8F7D ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"\u65E0\u6587\u4EF6"))]),imgSlot:withCtx(({text:_})=>[_?(openBlock(),createElementBlock("img",{key:1,src:e.getImgView(_),alt:"\u56FE\u7247\u4E0D\u5B58\u5728",class:"online-cell-image",onClick:I=>e.viewOnlineCellImage(_)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"\u65E0\u56FE\u7247"))]),htmlSlot:withCtx(({text:_})=>[createBaseVNode("div",{innerHTML:_},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:_})=>[createBaseVNode("div",{title:e.getPcaText(_)},toDisplayString(e.getPcaText(_)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:_})=>[createBaseVNode("span",null,toDisplayString(e.getFormatDate(_)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode(A,{id:e.id,onRegister:e.registerPopModal,onSuccess:e.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}var OnlinePopListModal=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"}));const _sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def([])},components:{PlusOutlined,MinusCircleFilled:MinusCircleFilled$1,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(e,{emit:t}){const n=computed(()=>e.tableName),[l,{openModal:d}]=useModal(),[c,{openModal:m}]=useModal(),S=ref([]),C=ref([]),P=computed(()=>!(e.disabled==!0||e.multi===!1&&C.value.length>0)),{auths:w,otherColumns:y,realShowColumns:A,tableColumns:_,textFieldArray:I,transData:B,loadOne:x,compareData:V,formatData:k,initFormData:M,getImageSrc:j,showImage:J}=useLinkTable(e),L=computed(()=>e.multi===!0?12:24),N=computed(()=>e.multi===!0?24:12);function p(a){if(a&&I.value.length>0){let f=I.value[0];return a[f]}}function b(a){a==null||a.stopPropagation(),a==null||a.preventDefault()}function v(a,f){if(b(a),w.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}e.disabled==!1&&m(!0,{isUpdate:!0,record:f})}function F(a){d(!0,{})}function g(a){let f=C.value;for(let T of a){let E=__spreadValues({},T);B(E),f.push(E)}C.value=f,i()}function r(a){let f=C.value;for(let T=0;T<f.length;T++)if(f[T].id===a.id){let E=__spreadValues({},a);B(E),f.splice(T,1,E)}C.value=f,i()}function s(a,f){b(a);let T=C.value;T&&T.length>f&&(T.splice(f,1),C.value=T),i()}function i(){let a=C.value,f=[],T={},E=e.linkFields;if(a.length>0)for(let U=0;U<a.length;U++)f.push(a[U][e.valueField]),M(T,E,a[U]);else M(T,E);let H=f.join(",");k(T),t("change",H,T),t("update:value",H)}return watch(()=>e.value,a=>__async(this,null,function*(){if(a){if(V(C.value,a)===!1){let T=yield x(a);C.value=T}e.linkFields&&e.linkFields.length>0&&i()}else C.value=[]}),{immediate:!0}),{popTableName:n,selectRecords:C,otherColumns:y,realShowColumns:A,showButton:P,selectValue:S,handleAddRecord:F,handleDeleteRecord:s,getMainContent:p,itemSpan:L,columnSpan:N,tableColumns:_,addCard:g,registerListModal:l,registerFormModal:c,handleClickEdit:v,updateCardData:r,getImageSrc:j,showImage:J,auths:w}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(e,t,n,l,d,c){const m=resolveComponent("PlusOutlined"),S=resolveComponent("a-button"),C=resolveComponent("minus-circle-filled"),P=resolveComponent("a-col"),w=resolveComponent("a-row"),y=resolveComponent("online-pop-list-modal"),A=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[l.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(S,{onClick:l.handleAddRecord},{default:withCtx(()=>[createVNode(m),createTextVNode("\u8BB0 \u5F55")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.selectRecords,(_,I)=>(openBlock(),createBlock(P,{span:l.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":n.detail==!0}]),onClick:B=>l.handleClickEdit(B,_)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":l.showImage}])},[n.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(C,{onClick:B=>l.handleDeleteRecord(B,I)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(l.getMainContent(_)),1),createBaseVNode("div",_hoisted_8,[createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.realShowColumns,B=>(openBlock(),createBlock(P,{span:l.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(B.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(_[B.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),l.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[l.getImageSrc(_)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(_),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(y,{onRegister:l.registerListModal,multi:n.multi,id:l.popTableName,addAuth:l.auths.add,onSuccess:l.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode(A,{id:l.popTableName,onRegister:l.registerFormModal,onSuccess:l.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableCard=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-f6bb6746"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"}));const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(e,t){add("OnlineSelectCascade",OnlineSelectCascade),add("LinkTableSelect",LinkTableSelect),add("LinkTableCard",LinkTableCard);const n=e.modalClass,l=ref([]),d=ref(""),c=ref({}),m=reactive({}),S=ref(!1),C=ref([]),P=ref({}),w={},y=ref([]),A=reactive({}),_=ref("");_.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function I(M,j,J){clearObj(A),A[d.value]=[];let L=[],N=[],p=[],b={},v={};Object.keys(M).map(g=>{const r=M[g];if(r.view=="tab"){S.value=!0,A[g]=[];let s={key:g,foreignKey:r.foreignKey,describe:r.describe,relationType:r.relationType,requiredFields:r.required||[],order:r.order,id:r.id};r.relationType==1?(w[g]=ref(null),s.properties=r.properties):(B(r),w[g]=ref(),s.columns=r.columns,b[g]=[]),L.push(s),handleSubTableButtonAuth(g,r)}else if(initDefValueConfig(g,r,A[d.value]),r.view===LINK_DOWN){let s=handleLinkDown(r,g);for(let i of s){m[i.key]=!0,m[i.key+"_load"]=!0;let a=FormSchemaFactory.createFormSchema(i.key,i);J&&a.setOnlyValidateFun(J),a.isRequired(j),a.setFormRef(t),a.handleWidgetAttr(r);let f=getFieldIndex(N,i.key);f==-1?N.push(a):N[f]=a}}else if(m[g]=!0,m[g+"_load"]=!0,getFieldIndex(N,g)==-1){let i=FormSchemaFactory.createFormSchema(g,r);if(J&&i.setOnlyValidateFun(J),i.isRequired(j),i.setFormRef(t),N.push(i),p.push(...i.getRelatedHideFields()),r.view===LINK_TABLE_FIELD){let a=i.getLinkFieldInfo();a&&(v[a[0]]?v[a[0]].push(a[1]):v[a[0]]=[a[1]])}}}),N.sort(function(g,r){return g.order-r.order});let F=[];F.push(FormSchemaFactory.createIdField());for(let g of N)g.view&&g.view==LINK_TABLE&&v[g.field]&&g.setOtherInfo(v[g.field]),p.indexOf(g.field)>=0&&g.isHidden(),n&&g.setCustomPopContainer(n),F.push(g.getFormItemSchema());l.value=F,L.sort(function(g,r){return g.order-r.order}),C.value=L,P.value=b}watch(m,M=>{let j=t.value,J=[],L=toRaw(M);Object.keys(L).map(N=>{if(!N.endsWith("_load")){let p={field:N,show:L[N]},b=N+"_load";L.hasOwnProperty(b)&&(p.ifShow=L[b]),J.push(p)}}),j&&j.updateSchema(J)},{immediate:!1});function B(M){useOnlineVxeTableColumns(M,j=>{initSubTableDefValueConfig(j,A[M.key])})}watch(()=>e.formTemplate,()=>{_.value=x()},{immediate:!0});function x(){let M=e.formTemplate;return M==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:M==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:M==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{span:24}}function V(M,j){return new Promise(J=>{j||J("");let N={tableName:d.value.replace(/\$\d+/,""),fieldName:M.field,fieldVal:j},p=c.value;p.id&&(N.dataId=p.id),duplicateCheck(N).then(b=>{b.success?J(""):J(b.message)}).catch(b=>{J(b)})})}function k(M){return Object.keys(M).map(j=>{M[j]&&M[j]instanceof Array&&(M[j]=M[j].join(","))}),M}return{formSchemas:l,defaultValueFields:A,tableName:d,dbData:c,checkOnlyFieldValue:V,createFormSchemas:I,fieldDisplayStatus:m,subTabInfo:C,hasSubTable:S,subDataSource:P,baseColProps:_,changeDataIfArray2String:k,linkDownList:y,refMap:w}}function useOnlineVxeTableColumns(e,t){const n={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};e.columns.forEach(c=>{c.type==="radio"?c.type="select":n[c.type]?c.type=n[c.type]:c.type==="popup"&&l(c),c.type==="depart-select"&&(c.checkStrictly=!0),c.type==="user-select"&&d(c),(c.width==120||c.width=="120px")&&(c.type=="image"||c.type=="file")&&(c.width="130px"),c.width||(c.width="200px"),t&&t(c)});function l(c){let{destFields:m,orgFields:S}=c,C=[];if(!(!m||m.length==0)){let P=m.split(","),w=S.split(",");for(let y=0;y<P.length;y++)C.push({target:P[y],source:w[y]})}c.fieldConfig=C}function d(c){let m=c.fieldExtendJson,S=!1;if(m)try{JSON.parse(m).multiSelect===!1&&(S=!0)}catch(C){console.log("\u5B50\u8868\u83B7\u53D6\u7528\u6237\u7EC4\u4EF6\u7684\u6269\u5C55\u914D\u7F6E\u51FA\u73B0\u9519\u8BEF",C)}c.isRadioSelection=S}}function useOnlineFormContext(){let e={};const t={},n=new Proxy(t,{get(c,m){return Reflect.get(e,m)}});function l(c,m){e[c]=m}function d(c){Object.keys(c).map(m=>{e[m]=c[m]})}return l("$nextTick",nextTick),l("addObject2Context",l),{onlineFormContext:n,addObject2Context:l,resetContext:d}}function handleLinkDown(e,t){const{config:{table:n,key:l,txt:d,linkField:c,idField:m,pidField:S,condition:C},others:P,order:w,title:y}=e;let A={dictTable:n,dictText:d,dictCode:l,pidField:S,idField:m,view:LINK_DOWN,type:e.type},_=[],I=__spreadValues({key:t,title:y,order:w,condition:C,origin:!0},A);if(c&&c.length>0){let B=c.split(",");I.next=B[0];for(let x=0;x<B.length;x++)for(let V of P)if(V.field==B[x]){let k=__spreadValues({key:V.field,title:V.title,order:V.order,origin:!1},A);x+1<B.length&&(k.next=B[x+1]),_.push(k)}}return _.push(I),_}function getFieldIndex(e,t){let n=-1;for(let l=0;l<e.length;l++)if(e[l].field===t){n=l;break}return n}function getRefPromise(e){return new Promise(t=>{(function n(){let l=e.value;l?t(l):setTimeout(()=>{n()},100)})()})}function clearObj(e){Object.keys(e).map(t=>{delete e[t]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(e,t){let n=t.hideButtons,l=ONL_AUTH_PRE+e+":";n||(n=[]),permissionStore.setOnlineSubTableAuth(l,n)}function getDetailFormSchemas(e){const t=ref([]),n={},l=ref(!1),d=ref([]),c=ref({}),m=computed(()=>{let y=e.formTemplate;return y=="2"?12:y=="3"?8:y=="4"?6:24});function S(y){let A=[];console.log("111",y);let _=[],I={};Object.keys(y).map(B=>{const x=y[B];if(x.view=="tab"){l.value=!0;let V={key:B,foreignKey:x.foreignKey,describe:x.describe,relationType:x.relationType,requiredFields:x.required||[],order:x.order};x.relationType==1?(n[B]=ref(null),V.properties=x.properties):(C(x),n[B]=ref(),V.columns=x.columns,I[B]=[]),A.push(V)}else if(x.view===LINK_DOWN){let V=w(x,B);for(let k of V){let M=P(_,k.key),j={field:k.key,label:k.title,view:k.view,order:k.order,dictTable:k.dictTable,linkField:k.linkField||""};M==-1?_.push(j):_[M]=j}}else if(x.view!="hidden"){if(P(_,B)==-1){let k=Object.assign({field:B,label:x.title},pick$1(x,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(x.view=="file"&&(k.span=24,k.isFile=!0),x.view=="image"&&(k.span=24,k.isImage=!0),x.view=="link_table"&&x.fieldExtendJson)try{let M=JSON.parse(x.fieldExtendJson);M.showType!="select"&&(k.isCard=!0),M.multiSelect==!0&&(k.multi=!0)}catch(M){console.error("\u89E3\u6790json\u5B57\u7B26\u4E32\u51FA\u9519",x.fieldExtendJson)}(x.view=="umeditor"||x.view=="markdown")&&(k.isHtml=!0,k.span=24),_.push(k)}}}),_.sort(function(B,x){return B.order-x.order}),A.sort(function(B,x){return B.order-x.order}),d.value=A;for(let B=0;B<_.length;B++){let x=_[B];if((x.isFile===!0||x.isImage===!0||x.isHtml===!0)&&B>0){let V=_[B-1],k=V.span||m.value;V.span=k}}t.value=_,c.value=I,console.log("adadad",_)}function C(y){useOnlineVxeTableColumns(y)}function P(y,A){let _=-1;for(let I=0;I<y.length;I++)if(y[I].field===A){_=I;break}return _}function w(y,A){let _=[];const{config:{table:I,key:B,txt:x,linkField:V},order:k,title:M,others:j}=y;let J={table:I,key:B,txt:x},L={view:"link_down",order:k,title:M,dictTable:JSON.stringify(J)};if(_.push(Object.assign({},{linkField:V,key:A},L)),V){let N=V.split(",");for(let p of N){let b="";for(let v of j)v.field==p&&(b=v.title);_.push(Object.assign({},{key:p},L,{title:b}))}}return _}return{detailFormSchemas:t,hasSubTable:l,subTabInfo:d,refMap:n,createFormSchemas:S,formSpan:m,subDataSource:c}}var useAutoForm=Object.freeze(Object.defineProperty({__proto__:null,L:LinkTableCard,O:OnlineSubForm,a:OnlinePopModal,b:useFormItems,c:useEnhance,d:getDetailFormSchemas,e:loadOneFieldDefVal,f:LINK_DOWN,g:getRefPromise,h:handleLinkDown,i:getFieldIndex,j:useTableColumns,k:useAutoModal,l:loadFormFieldsDefVal,m:OnlineSubForm$1,n:OnlinePopForm$1,o:OnlinePopModal$1,p:LinkTableSelect$1,q:OnlinePopListModal$1,r:LinkTableCard$1,u:useOnlineFormContext},Symbol.toStringTag,{value:"Module"}));export{DiffOutlined$1 as D,LinkTableCard as L,OnlineSubForm as O,PrinterOutlined$1 as P,OnlinePopModal as a,useFormItems as b,useEnhance as c,getDetailFormSchemas as d,loadOneFieldDefVal as e,LINK_DOWN as f,getRefPromise as g,handleLinkDown as h,getFieldIndex as i,useTableColumns as j,useAutoModal as k,loadFormFieldsDefVal as l,useAutoForm as m,useOnlineFormContext as u};
