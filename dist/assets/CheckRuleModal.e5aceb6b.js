var H=Object.defineProperty;var T=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var J=(r,a,u)=>a in r?H(r,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[a]=u,M=(r,a)=>{for(var u in a||(a={}))I.call(a,u)&&J(r,u,a[u]);if(T)for(var u of T(a))W.call(a,u)&&J(r,u,a[u]);return r};var b=(r,a,u)=>new Promise((f,C)=>{var B=m=>{try{y(u.next(m))}catch(c){C(c)}},w=m=>{try{y(u.throw(m))}catch(c){C(c)}},y=m=>m.done?f(m.value):Promise.resolve(m.value).then(B,w);y((u=u.apply(r,a)).next())});import{B as j}from"./index.ae4cc225.js";import{B as z}from"./BasicForm.2df818ee.js";import"./helper.add5f9b1.js";import{u as Q}from"./useForm.ecb34db0.js";import"./JAddInput.0a10a637.js";import{l as X,o as Y,L as n,F as p,bG as Z,dz as g,t as _,v as ee,V as ue,z as v,y as d,B as te,aQ as ae}from"./index.f119eb41.js";import{f as oe,u as re,s as se}from"./check.rule.data.c4c4db86.js";import"./BasicModal.25f98338.js";import"./useWindowSizeFn.54f80105.js";import"./uniqBy.444d4262.js";import"./useFormItem.913bfb84.js";import"./functional.64118705.js";import"./download.4fb97c32.js";import"./base64Conver.030fa32c.js";import"./index.614d058e.js";import"./index.017fdf05.js";import"./useCountdown.1f570c2c.js";import"./JUpload.af005edc.js";import"./api.41039c75.js";import"./index.1c608bee.js";import"./props.f3576fdb.js";import"./index.af72ff9f.js";import"./bem.a7e666a8.js";import"./props.df9c3d6a.js";import"./useContextMenu.981f0461.js";import"./index.68ae2cdf.js";import"./onMountedOrActivated.a32fcaaf.js";import"./index.8a2ad0af.js";import"./htmlmixed.9c9a62f3.js";import"./vue.b7b7bdb1.js";/* empty css             */import"./depart.api.0a168623.js";import"./renderUtils.5defbbbd.js";import"./user.api.7dd9353a.js";const Ue=X({__name:"CheckRuleModal",emits:["register","success"],setup(r,{emit:a}){const u=Y(()=>n(f)?"\u7F16\u8F91":"\u65B0\u589E"),f=p(!0),[C,{resetFields:B,setFieldsValue:w,validate:y,getFieldsValue:m}]=Q({schemas:oe,showActionButtonGroup:!1}),c=p("1");let D=p([]),k=p([]);const[O,{setModalProps:A,closeModal:L}]=Z(e=>b(this,null,function*(){if(yield B(),A({confirmLoading:!1}),f.value=!!(e!=null&&e.isUpdate),c.value="1",D.value=[],k.value=[],n(f)){yield w(M({},e.record));let o=e.record.ruleJson;if(o){let s=JSON.parse(o),t=[],i=[],l="1";s.forEach(F=>{F.digits==="*"?t.push(Object.assign(F,{priority:l})):(l="0",i.push(F))}),D.value=i,k.value=t}}})),R=p(),S=p();function V(e,o){return new Promise((s,t)=>{e.value.validateTable().then(i=>{if(i)c.value=o,t();else{const l=e.value.getTableData();s(l)}})})}function N(){return b(this,null,function*(){let e,o=[],s=[];y().then(t=>(e=t,V(R,"1"))).then(t=>(t&&t.length>0&&(s=t),V(S,"2"))).then(t=>{t&&t.length>0&&(o=t);let i=[],l=[];for(let h=0;h<o.length;h++){let E=o[h];E.digits="*",E.priority==="1"?i.push(E):l.push(E)}let K=i.concat(s).concat(l).map(h=>ae(h,"digits","pattern","message")),P=JSON.stringify(K),U=Object.assign({},e,{ruleJson:P});q(U)}).catch(()=>{A({confirmLoading:!1}),console.error("\u9A8C\u8BC1\u672A\u901A\u8FC7!")})})}function q(e){return b(this,null,function*(){try{console.log("\u8868\u5355\u63D0\u4EA4\u6570\u636E",e),A({confirmLoading:!0}),f.value?yield re(e):yield se(e),L(),a("success")}finally{A({confirmLoading:!1})}})}const x=({cellValue:e},o)=>{try{new RegExp(e),o(!0)}catch(s){o(!1,"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6B63\u5219\u8868\u8FBE\u5F0F")}},$=p([{title:"\u4F4D\u6570",key:"digits",type:g.inputNumber,minWidth:180,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[1-9]\d*$/,message:"\u8BF7\u8F93\u5165\u96F6\u4EE5\u4E0A\u7684\u6B63\u6574\u6570"}]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",minWidth:320,type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",minWidth:180,type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]),G=p([{title:"\u4F18\u5148\u7EA7",key:"priority",type:g.select,defaultValue:"1",options:[{title:"\u4F18\u5148\u8FD0\u884C",value:"1"},{title:"\u6700\u540E\u8FD0\u884C",value:"0"}],validateRules:[]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",width:"40%",type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",width:"20%",type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]);return(e,o)=>{const s=_("a-alert"),t=_("JVxeTable"),i=_("a-tab-pane"),l=_("a-tabs");return ee(),ue(n(j),te(e.$attrs,{onRegister:n(O),onOk:N,title:n(u),width:1200,destroyOnClose:""}),{default:v(()=>[d(n(z),{onRegister:n(C)},null,8,["onRegister"]),d(l,{activeKey:c.value,"onUpdate:activeKey":o[0]||(o[0]=F=>c.value=F),animated:""},{default:v(()=>[d(i,{tab:"\u5C40\u90E8\u89C4\u5219",key:"1",forceRender:!0},{default:v(()=>[d(t,{ref_key:"vTable1",ref:R,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:n(D),columns:$.value},{toolbarAfter:v(()=>[d(s,{type:"info",showIcon:"",message:"\u5C40\u90E8\u89C4\u5219\u6309\u7167\u4F60\u8F93\u5165\u7684\u4F4D\u6570\u6709\u5E8F\u7684\u6821\u9A8C",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1}),d(i,{tab:"\u5168\u5C40\u89C4\u5219",key:"2",forceRender:!0},{default:v(()=>[d(t,{ref_key:"vTable2",ref:S,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:n(k),addSetActive:!1,columns:G.value},{toolbarAfter:v(()=>[d(s,{type:"info",showIcon:"",message:"\u5168\u5C40\u89C4\u5219\u53EF\u6821\u9A8C\u7528\u6237\u8F93\u5165\u7684\u6240\u6709\u5B57\u7B26\uFF1B\u5168\u5C40\u89C4\u5219\u7684\u4F18\u5148\u7EA7\u6BD4\u5C40\u90E8\u89C4\u5219\u7684\u8981\u9AD8\u3002",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister","title"])}}});export{Ue as default};
