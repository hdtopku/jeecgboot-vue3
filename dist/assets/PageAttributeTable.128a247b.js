import{l as e,F as t,dz as l,bI as i,f0 as a,t as d,v as o,x as s,y as r,z as u,V as n,C as c,W as f,B as b,ax as p}from"./index.b2c24a42.js";import{u as m}from"./useTableSync.384f95b0.js";import y from"./LinkTableConfigModal.b99b5ead.js";import h from"./LinkTableFieldConfigModal.b5b5d1de.js";import"./index.12c6f6d1.js";import"./pick.dbff1c58.js";import"./_flatRest.ff1861ce.js";import"./isArray.40a4ed15.js";import"./toString.cf909882.js";import"./_arrayPush.8821345e.js";import"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import"./JAddInput.2ba637e0.js";import"./omit.d6518a29.js";import"./_baseClone.a8082016.js";import"./cgform.data.cfb4e3e8.js";import"./useForm.5a9ed278.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./uniqBy.be1d69f1.js";import"./useFormItem.9110ec70.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./api.e26748d3.js";import"./index.be1c9e2b.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./_baseSlice.23bb44df.js";var v=Object.defineProperty,g=Object.defineProperties,w=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,k=(e,t,l)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;const j=[{title:"文本框",value:"text"},{title:"密码",value:"password"},{title:"下拉框",value:"list"},{title:"单选框",value:"radio"},{title:"多选框",value:"checkbox"},{title:"开关",value:"switch"},{title:"日期(yyyy-MM-dd)",value:"date"},{title:"日期（yyyy-MM-dd HH:mm:ss）",value:"datetime"},{title:"时间（HH:mm:ss）",value:"time"},{title:"文件",value:"file"},{title:"图片",value:"image"},{title:"多行文本",value:"textarea"},{title:"下拉多选框",value:"list_multi"},{title:"下拉搜索框",value:"sel_search"},{title:"Popup弹框",value:"popup"},{title:"关联记录",value:"link_table"},{title:"他表字段",value:"link_table_field"},{title:"分类字典树",value:"cat_tree"},{title:"部门选择",value:"sel_depart"},{title:"用户选择",value:"sel_user"},{title:"富文本",value:"umeditor"},{title:"MarkDown",value:"markdown"},{title:"省市区组件",value:"pca"},{title:"联动组件",value:"link_down"},{title:"自定义树控件",value:"sel_tree"}],S=[{title:"文本框",value:"text"},{title:"单选框",value:"radio"},{title:"开关",value:"switch"},{title:"日期(yyyy-MM-dd)",value:"date"},{title:"日期（yyyy-MM-dd HH:mm:ss）",value:"datetime"},{title:"时间（HH:mm:ss）",value:"time"},{title:"文件",value:"file"},{title:"图片",value:"image"},{title:"下拉框",value:"list"},{title:"下拉多选框",value:"list_multi"},{title:"下拉搜索框",value:"sel_search"},{title:"popup弹出框",value:"popup"},{title:"部门选择",value:"sel_depart"},{title:"用户选择",value:"sel_user"},{title:"多行文本",value:"textarea"}];var _=a(e({name:"PageAttributeTable",components:{LinkTableConfigModal:y,LinkTableFieldConfigModal:h},setup(){const e=t([{title:"字段名称",key:"dbFieldName",width:100},{title:"字段备注",key:"dbFieldTxt",width:100},{title:"表单显示",key:"isShowForm",width:80,type:l.checkbox,align:"center",customValue:["1","0"],defaultChecked:!0},{title:"列表显示",key:"isShowList",width:80,type:l.checkbox,align:"center",customValue:["1","0"],defaultChecked:!0},{title:"是否排序",key:"sortFlag",width:80,type:l.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1},{title:"是否只读",key:"isReadOnly",width:80,type:l.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1},{title:"控件类型",key:"fieldShowType",width:170,type:l.select,options:j,defaultValue:"text",placeholder:"请选择${title}",validateRules:[{required:!0,message:"请选择${title}"},{handler:function({cellValue:e,row:t},l){let{dbTable:i}=o,a=i.value.tableRef.getTableData({rowIds:[t.id]})[0].dbType;"time"===e&&"string"!==a?l(!1,"当控件类型为时间时,数据库属性里的字段类型必须是String！"):"date"===e&&"Date"!==a&&"Datetime"!==a?l(!1,"当控件类型为日期时，数据库属性里的字段类型必须是Date或Datetime！"):"datetime"===e&&"Datetime"!==a?l(!1,"当控件类型为datetime时，数据库属性里的字段类型必须是Datetime！"):l(!0)}}]},{title:"控件长度",key:"fieldLength",width:120,type:l.inputNumber,defaultValue:120,placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"是否查询",key:"isQuery",width:80,type:l.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1},{title:"查询类型",key:"queryMode",width:110,type:l.select,options:[{title:"普通查询",value:"single"},{title:"范围查询",value:"group"}],defaultValue:"single",placeholder:"请选择${title}",validateRules:[{required:!0,message:"请选择${title}"}]},{title:"控件默认值",key:"fieldDefaultValue",width:120,type:l.input,defaultValue:""},{title:"扩展参数",key:"fieldExtendJson",width:120,type:l.input,defaultValue:""},{title:"定义转换器",key:"converter",width:150,type:l.input,defaultValue:""},{title:"个性配置",minWidth:100,key:"fieldConfig",type:l.slot,slotName:"fieldConfig"}]),a=m(e),{tableRef:d,tables:o}=a;const[s,{openModal:r}]=i(),[u,{openModal:n}]=i();return c=((e,t)=>{for(var l in t||(t={}))x.call(t,l)&&k(e,l,t[l]);if(T)for(var l of T(t))F.call(t,l)&&k(e,l,t[l]);return e})({},a),g(c,w({columns:e,enableQuery:function(e){d.value.setValues([{rowKey:e,values:{isQuery:"1"}}])},syncFieldShowType:function(e){let t="date";"Datetime"===e.dbType&&(t="datetime"),d.value.setValues([{rowKey:e.id,values:{fieldShowType:t}}])},changePageType:function(t){for(let l of e.value)if("fieldShowType"==l.key){l.options=t?S:j;break}},showConfigButton:function(e){return e.row.fieldShowType.indexOf("link_table")>=0},showFieldConfig:function(e){let{row:t}=e,{checkTable:l}=o;if(l){let i=l.value.tableRef.getTableData({rowIds:[t.id]})[0];if("link_table"==e.row.fieldShowType){let e=function(e,t){const{id:l,dbFieldTxt:i,fieldExtendJson:a}=e,{dictTable:d,dictText:o}=t;let s={rowKey:l,dbFieldTxt:i,dictTable:d};if(o){let e=o.split(",");s.titleField=e[0],e.length>1&&(s.otherFields=o.substring(o.indexOf(",")+1))}else s.titleField="",s.otherFields="";if(a)try{let e=JSON.parse(a);e.multiSelect?s.multiSelect=e.multiSelect:s.multiSelect=!1,e.showType?s.showType=e.showType:s.showType="card",e.imageField?s.imageField=e.imageField:s.imageField=""}catch(r){}return s}(t,i);r(!0,{record:e,fieldName:t.dbFieldName})}else if("link_table_field"==e.row.fieldShowType){let e=function(e,t){let l=d.value.getTableData().filter((e=>"link_table"==e.fieldShowType)),i={};if(l&&l.length>0){let e=o.checkTable.value.tableRef.getTableData();for(let t of l){let l=e.filter((e=>e.dbFieldName==t.dbFieldName));if(l&&l.length>0){let e=l[0];i[e.dbFieldName]={title:t.dbFieldTxt,table:e.dictTable,fields:e.dictText}}}}const{dictTable:a,dictText:s}=t,{id:r,dbFieldTxt:u}=e;return{record:{rowKey:r,dbFieldTxt:u,dictText:s,dictTable:a},tableAndFieldsMap:i}}(t,i);n(!0,e)}}},registerModal:s,handleConfigData:function(e){const{multiSelect:t,showType:l,imageField:i,fieldName:a}=e;let s={showType:l,multiSelect:t,imageField:i},r=[{rowKey:e.rowKey,values:{fieldExtendJson:JSON.stringify(s),dbFieldTxt:e.dbFieldTxt}}];d.value.setValues(r);let{checkTable:u,dbTable:n}=o;if(n){let t=[{rowKey:e.rowKey,values:{dbFieldTxt:e.dbFieldTxt}}];n.value.tableRef.setValues(t)}if(u){let t=e.titleField;e.otherFields&&(t+=","+e.otherFields);const{dictTable:l,dictField:i}=e;let d={dictTable:l,dictField:i,dictText:t,dbFieldName:a},o=[{rowKey:e.rowKey,values:d}];u.value.tableRef.setValues(o)}},registerFieldModal:u,handleFieldConfigData:function(e){const{dbFieldTxt:t,dictTable:l,dictText:i,rowKey:a}=e;let s=[{rowKey:a,values:{dbFieldTxt:t}}];d.value.setValues(s);let{checkTable:r,dbTable:u}=o;if(u){let e=[{rowKey:a,values:{dbFieldTxt:t,dbIsPersist:"0"}}];u.value.tableRef.setValues(e)}if(r){let e=[{rowKey:a,values:{dictTable:l,dictText:i}}];r.value.tableRef.setValues(e)}}}));var c}}),[["render",function(e,t,l,i,a,m){const y=d("a-button"),h=d("JVxeTable"),v=d("link-table-config-modal"),g=d("link-table-field-config-modal");return o(),s(p,null,[r(h,b({ref:"tableRef","row-class-name":"online-config-page",rowNumber:"",keyboardEdit:"",maxHeight:e.tableHeight.noToolbar,loading:e.loading,columns:e.columns,dataSource:e.dataSource,disabledRows:{dbFieldName:["id","has_child"]}},e.tableProps),{fieldConfig:u((t=>[e.showConfigButton(t)?(o(),n(y,{key:0,type:"primary",size:"small",ghost:"",onClick:l=>e.showFieldConfig(t)},{default:u((()=>[c("打开配置")])),_:2},1032,["onClick"])):f("",!0)])),_:1},16,["maxHeight","loading","columns","dataSource"]),r(v,{onRegister:e.registerModal,onSuccess:e.handleConfigData},null,8,["onRegister","onSuccess"]),r(g,{onRegister:e.registerFieldModal,onSuccess:e.handleFieldConfigData},null,8,["onRegister","onSuccess"])],64)}],["__scopeId","data-v-eb3d4aa4"]]);export{_ as default};
