import{B as e}from"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import{u as t}from"./useForm.5a9ed278.js";import"./JAddInput.2ba637e0.js";import{f0 as a,F as r,a8 as o,H as s,ac as i,t as n,v as l,x as u,y as c,z as m,aW as p,C as d,D as f,W as h,a1 as g,u as j,dp as b,dq as y}from"./index.b2c24a42.js";import{c as v,F as w}from"./FormSchemaFactory.c7393278.js";import{g as x,e as F,f as S,h as O,i as _}from"./useAutoForm.e6212621.js";import"./JUpload.152dd3a7.js";import"./JUploadModal.aa941b98.js";import"./OnlineSelectCascade.3bb41065.js";import"./index.12c6f6d1.js";import"./pick.dbff1c58.js";import"./_flatRest.ff1861ce.js";import"./isArray.40a4ed15.js";import"./toString.cf909882.js";import"./_arrayPush.8821345e.js";import"./BasicTable.fa29c153.js";import"./TableImg.2942a3dc.js";import"./Area.f37a4b8c.js";import"./functional.d6fe070d.js";import"./LinkTableListPiece.3767b554.js";import"./uniqBy.be1d69f1.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./useFormItem.9110ec70.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./index.be1c9e2b.js";import"./api.e26748d3.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./user.api.ceae0e75.js";import"./_commonjsHelpers.7ef9cff5.js";import"./customExpression.58041e91.js";import"./useListPage.ddd6479e.js";import"./useTable.fb0dd6ed.js";import"./index.7e26b7de.js";import"./useContentHeight.aae13605.js";import"./useContentViewHeight.879059d9.js";import"./usePageContext.174066c3.js";import"./RedoOutlined.4dd49301.js";import"./JModalTip.ebca1866.js";var k=Object.defineProperty,Y=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,P=(e,t,a)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,U=(e,t)=>{for(var a in t||(t={}))C.call(t,a)&&P(e,a,t[a]);if(Y)for(var a of Y(t))M.call(t,a)&&P(e,a,t[a]);return e},D=(e,t,a)=>new Promise(((r,o)=>{var s=e=>{try{n(a.next(e))}catch(t){o(t)}},i=e=>{try{n(a.throw(e))}catch(t){o(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,i);n((a=a.apply(e,t)).next())}));const B={name:"OnlineQueryForm",components:{BasicForm:e},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(e,{emit:a}){const n="/online/cgform/api/getQueryInfoVue3/",l=r(null),u=r([]),c=r({xs:24,sm:24,md:12,lg:8,xl:8}),m=r(!1),p=r(!1),d=r({}),f=r([]),{createMessage:h}=j(),b=o({config:{},cache:{},param:{},status:!1});s((()=>b.status),(e=>D(this,null,(function*(){const{config:e,cache:t,param:a}=i(b);let r=Object.assign({},e,t,a);yield function(e){return D(this,null,(function*(){yield x(l),yield Y(e),Object.keys(e).length>0&&P()}))}(r)}))),{immediate:!0,deep:!0}),s((()=>e.id),(t=>{t?function(){D(this,null,(function*(){let t=yield function(){let t=`${n}${e.id}`;return new Promise((e=>{g.get({url:t},{isTransformResponse:!1}).then((t=>{t.success?e(t.result):(e(!1),h.warning(t.message))})).catch((()=>{h.warning("获取查询条件失败!"),e(!1)}))}))}(),r=function(e){const{properties:t,searchFieldList:a,joinQuery:r,table:o}=e;let s={},i=1;return Object.keys(t).map((e=>{let a=t[e];if("table"==a.view){let t=a.properties,r=100*i;Object.keys(t).map((a=>{let o=t[a];o.order=r+Number(o.order),s[e+"@"+a]=o})),i++}else a.order=Number(a.order),s[e]=a})),s}(t);a("loaded",t);let{formProperties:o,hasField:s}=function(e,t){const{searchFieldList:a,joinQuery:r,table:o}=t;let s=!1,i={};e&&Object.keys(e).map((t=>{a.indexOf(t)>=0&&(1==r?t.indexOf("@")<0?(i[o+"@"+t]=e[t],s=!0):(i[t]=e[t],s=!0):t.indexOf("@")<0&&(i[t]=e[t],s=!0))}));return{formProperties:i,hasField:s}}(r,t);0!=s?yield function(e){return D(this,null,(function*(){let t=[],a={},r=Object.keys(e);for(let i of r){const r=e[i];let o=r.view;if(v[o]&&(r.view=v[o]),yield F(i,r,a),"group"!=r.mode||"date"!=o&&"datetime"!=o&&"number"!=o)if(r.view===S){let e=O(r,i);for(let a of e){let e=w.createFormSchema(a.key,a),r=_(t,a.key);-1==r?t.push(e):t[r]=e}}else{if(-1==_(t,i)){let e=w.createFormSchema(i,r);t.push(e)}}else{let e=w.createSlotFormSchema(i,r);t.push(e)}}t.sort((function(e,t){return e.order-t.order}));let o=[];t.length>2&&(m.value=!0);let s=[];for(let e=0;e<t.length;e++){let a=t[e];a.setFormRef(l),a.noChange(),a.asSearchForm(),e>1&&(s.push(a.field),a.isHidden()),o.push(a.getFormItemSchema())}f.value=s,u.value=o,b.config=U({},a),b.status=!b.status}))}(o):u.value=[]}))}():u.value=[]}),{immediate:!0});const[y,{resetFields:k,setFieldsValue:Y,updateSchema:C,getFieldsValue:M}]=t({schemas:u,showActionButtonGroup:!1,baseColProps:c,autoSubmitOnEnter:!0,submitFunc(){P()}});function P(){let e=M(),t=Object.assign({},i(b.param),function(e){return Object.keys(e).map((t=>{e[t]&&e[t]instanceof Array&&(e[t]=e[t].join(","))})),e}(e));a("search",t,!0)}return s((()=>p.value),(e=>{let t=f.value;if(t&&t.length>0){let a=[];for(let r of t)a.push({field:r,show:e});C(a)}}),{immediate:!1}),{onlineQueryFormRef:l,registerForm:y,initDefaultValues:function(e,t){return D(this,null,(function*(){b.cache=U({},e),b.param=U({},t),b.status=!b.status}))},toggleButtonShow:m,toggleSearchStatus:p,doSearch:P,resetSearch:function(){return D(this,null,(function*(){yield k();const{config:e,param:t}=i(b);let r=Object.assign({},e,t);Object.keys(r).length>0&&(yield Y(r)),a("search",r,!1)}))},queryParams:d,formSchemas:u}}},T=e=>(b("data-v-01d37a80"),e=e(),y(),e),H={key:0,class:"jeecg-basic-table-form-container p-0"},I=T((()=>p("span",{class:"group-query-string"},"~",-1))),R=T((()=>p("span",{class:"group-query-string"},"~",-1))),A=T((()=>p("span",{class:"group-query-string"},"~",-1))),q={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};var Q=a(B,[["render",function(e,t,a,r,o,s){const i=n("a-date-picker"),g=n("a-input-number"),j=n("a-button"),b=n("a-icon"),y=n("a-col"),v=n("BasicForm");return r.formSchemas&&r.formSchemas.length>0?(l(),u("div",H,[c(v,{ref:"onlineQueryFormRef",onRegister:r.registerForm},{groupDate:m((({model:e,field:t})=>[c(i,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"开始日期",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),I,c(i,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"结束日期",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])])),groupDatetime:m((({model:e,field:t})=>[c(i,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),R,c(i,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])])),groupNumber:m((({model:e,field:t})=>[c(g,{placeholder:"开始值",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),A,c(g,{placeholder:"结束值",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])])),formFooter:m((()=>[c(y,{md:6,sm:8},{default:m((()=>[p("span",q,[c(j,{preIcon:"ant-design:search",type:"primary",onClick:r.doSearch},{default:m((()=>[d("查询")])),_:1},8,["onClick"]),c(j,{preIcon:"ant-design:reload",type:"primary",onClick:r.resetSearch,style:{"margin-left":"8px"}},{default:m((()=>[d("重置")])),_:1},8,["onClick"]),r.toggleButtonShow?(l(),u("a",{key:0,onClick:t[0]||(t[0]=e=>r.toggleSearchStatus=!r.toggleSearchStatus),style:{"margin-left":"8px"}},[d(f(r.toggleSearchStatus?"收起":"展开")+" ",1),c(b,{type:r.toggleSearchStatus?"up":"down"},null,8,["type"])])):h("",!0)])])),_:1})])),_:1},8,["onRegister"])])):h("",!0)}],["__scopeId","data-v-01d37a80"]]);export{Q as default};
