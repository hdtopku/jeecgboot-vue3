var k=(e,i,o)=>new Promise((_,n)=>{var E=l=>{try{u(o.next(l))}catch(d){n(d)}},m=l=>{try{u(o.throw(l))}catch(d){n(d)}},u=l=>l.done?_(l.value):Promise.resolve(l.value).then(E,m);u((o=o.apply(e,i)).next())});import{j as x,A as ee,d9 as ae,C as p,a8 as te,bH as ue,m as se,K as r,Z as oe,u as ne,q as le,r as v,s as F,Q as B,w as t,v as g,y as h,bx as L,B as M,t as w,bc as T,z,ax as N,R as U,x as q,dr as re,ds as ie,aW as A}from"./index.e8262126.js";import{B as de}from"./index.188dd00a.js";import"./BasicModal.6904e9bc.js";import"./useWindowSizeFn.8000a74f.js";const ce=x({name:"loginSelect",components:{Avatar:ee,BasicModal:de},emits:["success","register"],setup(e,{emit:i}){const o=ae(),{notification:_}=ne(),n=p(!1),E=p([]),m=p(""),u=p(!1),l=p([]),d=p(""),C=p(!1),b=p(""),y=p(),c=te({orgCode:void 0,tenantId:null}),s={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},[H,{closeModal:V}]=ue(),$=se(()=>{if(r(u)&&r(n))return"\u8BF7\u9009\u62E9\u79DF\u6237\u548C\u90E8\u95E8";if(r(u)&&!r(n))return"\u8BF7\u9009\u62E9\u90E8\u95E8";if(!r(u)&&r(n))return"\u8BF7\u9009\u62E9\u79DF\u6237"}),P=p({tenantId:[{required:r(n),type:"number",message:"\u8BF7\u9009\u62E9\u79DF\u6237",trigger:"change"}],orgCode:[{required:r(u),message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:"change"}]}),j={labelCol:{span:4},wrapperCol:{span:18}};function K(a){let f=a.multi_depart;f==0?(_.warn({message:"\u63D0\u793A",description:"\u60A8\u5C1A\u672A\u5F52\u5C5E\u90E8\u95E8,\u8BF7\u786E\u8BA4\u8D26\u53F7\u4FE1\u606F",duration:3}),u.value=!1):f==2?(u.value=!0,l.value=a.departs):u.value=!1}function Q(a){let f=a.tenantList;Array.isArray(f)&&(f.length===0?(n.value=!1,o.setTenant(c.tenantId)):f.length===1?(c.tenantId=f[0].id,n.value=!1,o.setTenant(c.tenantId)):(n.value=!0,E.value=f))}function R(){if(r(n)&&!c.tenantId)return m.value="error",!1;if(r(u)&&!c.orgCode)return d.value="error",!1;y.value.validate().then(()=>{W().then(()=>{o.setTenant(c.tenantId),i("success")}).catch(a=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",a)}).finally(()=>{G()})}).catch(a=>{console.log("\u8868\u5355\u6821\u9A8C\u672A\u901A\u8FC7error",a)})}function W(){return new Promise((a,f)=>{if(!r(u))a();else{let Y={orgCode:c.orgCode,username:r(b)};oe.put({url:"/sys/selectDepart",params:Y}).then(I=>{I.userInfo?(o.setUserInfo(I.userInfo),a()):(Z(I),o.logout(),f())})}})}function Z(a){_.error({message:"\u767B\u5F55\u5931\u8D25",description:((a.response||{}).data||{}).message||a.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function G(){V(),S()}function J(a){return k(this,null,function*(){a&&(b.value=o.username,yield S(),yield K(a),yield Q(a),!r(u)&&!r(n)?i("success",o.getUserInfo):C.value=!0),a.isLogin=!1,o.setLoginInfo(a)})}function S(){E.value=[],m.value="",l.value=[],d.value=""}function O(a){m.value=""}function X(a){d.value=""}return{registerModal:H,visible:C,tenantList:E,isMultiTenant:n,validate_status:m,isMultiDepart:u,departList:l,validate_status1:d,formState:c,rules:P,layout:j,formRef:y,currTitle:$,config:s,handleTenantChange:O,handleDepartChange:X,show:J,handleSubmit:R}}});const D=e=>(re("data-v-425254e2"),e=e(),ie(),e),fe=D(()=>A("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),pe=D(()=>A("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),me=D(()=>A("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),ve=D(()=>A("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1));function ge(e,i,o,_,n,E){const m=v("a-avatar"),u=v("a-tooltip"),l=v("a-select-option"),d=v("a-select"),C=v("a-form-item"),b=v("a-form"),y=v("a-button"),c=v("BasicModal");return F(),B(c,q(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":i[2]||(i[2]=s=>e.visible=s)}),{footer:t(()=>[g(y,{onClick:e.handleSubmit,type:"primary"},{default:t(()=>[h("\u786E\u8BA4")]),_:1},8,["onClick"])]),default:t(()=>[g(b,q({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:t(()=>[e.isMultiTenant?(F(),B(C,{key:0,name:"tenantId","validate-status":e.validate_status},L({label:t(()=>[g(u,{placement:"topLeft"},{title:t(()=>[fe]),default:t(()=>[g(m,{style:{"background-color":"#87d068"},size:30},{default:t(()=>[h(" \u79DF\u6237 ")]),_:1})]),_:1})]),default:t(()=>[g(d,{value:e.formState.tenantId,"onUpdate:value":i[0]||(i[0]=s=>e.formState.tenantId=s),onChange:e.handleTenantChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",class:M({"valid-error":e.validate_status=="error"})},{default:t(()=>[(F(!0),w(N,null,T(e.tenantList,s=>(F(),B(l,{key:s.id,value:s.id},{default:t(()=>[h(z(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status=="error"?{name:"extra",fn:t(()=>[pe]),key:"0"}:void 0]),1032,["validate-status"])):U("",!0),e.isMultiDepart?(F(),B(C,{key:1,"validate-status":e.validate_status1,colon:!1},L({label:t(()=>[g(u,{placement:"topLeft"},{title:t(()=>[me]),default:t(()=>[g(m,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:t(()=>[h(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:t(()=>[g(d,{value:e.formState.orgCode,"onUpdate:value":i[1]||(i[1]=s=>e.formState.orgCode=s),onChange:e.handleDepartChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:M({"valid-error":e.validate_status1=="error"})},{default:t(()=>[(F(!0),w(N,null,T(e.departList,s=>(F(),B(l,{key:s.orgCode,value:s.orgCode},{default:t(()=>[h(z(s.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status1=="error"?{name:"extra",fn:t(()=>[ve]),key:"0"}:void 0]),1032,["validate-status"])):U("",!0)]),_:1},16,["model","rules"])]),_:1},16,["onRegister","title","visible"])}const he=le(ce,[["render",ge],["__scopeId","data-v-425254e2"]]);export{he as default};
