var y=(f,d,l)=>new Promise((r,g)=>{var u=t=>{try{o(l.next(t))}catch(p){g(p)}},c=t=>{try{o(l.throw(t))}catch(p){g(p)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(u,c);o((l=l.apply(f,d)).next())});import{j as T,C as i,bH as b,H as n,M as x,dZ as E,d_ as A,r as P,s as h,t as R,v as C,w as S,aW as N,Q as F,n as O,d$ as V,R as H,x as U,ax as W}from"./index.c1d8dbc8.js";import{q as $}from"./page.api.4b24c6a8.js";import{B as q}from"./index.5f6d2eec.js";import J from"./PasswordModal.5a7d72d7.js";const L={id:"dragEngineBox",style:{height:"100vh","overflow-y":"auto"}},Z=T({__name:"DragPageModal",props:{lowAppId:{type:String},isLowApp:{type:Boolean,default:!0}},emits:["success","register","close"],setup(f,{emit:d}){const l={padding:"0",height:window.innerHeight+"px"},r=i(""),g=i(""),u=i(!0),c=i(),o=i({componentData:[],name:"",coverUrl:"",backgroundColor:"",backgroundImage:"",designType:100,theme:"default",style:"default",updateCount:null}),[t,{setModalProps:p,closeModal:v}]=b(a=>y(this,null,function*(){p({showCancelBtn:!1,showOkBtn:!1}),u.value=!1,r.value=a.record.id,_(a.record),g.value=`\u9875\u9762\u8BBE\u8BA1 [${a.record.name}]`;const e=yield $({id:n(r)});if(e.success){o.value.name=e.result.name,o.value.coverUrl=e.result.coverUrl;let s=e.result.template?JSON.parse(e.result.template):[];o.value.componentData=s,o.value.backgroundColor=e.result.backgroundColor,o.value.backgroundImage=e.result.backgroundImage,o.value.designType=e.result.designType,o.value.style=e.result.style||"default",o.value.theme=e.result.theme||"default",o.value.updateCount=e.result.updateCount}setTimeout(()=>{x(()=>{u.value=!0})},300)}));function _(a){const e=a.protectionCode;let s=E(A.DRAG_CACHE_PREFIX+n(r));e&&e.length>0&&!s&&(c.value.showModal("design",a),c.value.extraMsg="")}function I(){v(),d("success"),d("close")}function k(a){d("success")}function B(a){let e=document.getElementById("dragEngineBox");D(e,a)}function D(a,e){let s=a.scrollTop;const m=()=>{let w=e-s;s=s+w/10,Math.abs(w)<1?a.scrollTo(0,e):(a.scrollTo(0,s),setTimeout(m,20))};m()}function M(a){window.open(a,"_blank")}return(a,e)=>{const s=P("DragEngine");return h(),R(W,null,[C(n(q),U(a.$attrs,{footer:null,wrapClassName:"drag-design-process-modal",style:{top:"0",padding:"0"},onRegister:n(t),bodyStyle:l,canFullscreen:!1,closable:!1,defaultFullscreen:"",destroyOnClose:""}),{default:S(()=>[N("div",L,[u.value?(h(),F(s,{key:0,dragData:o.value,pageId:r.value,token:n(O)(),tenantId:n(V)(),lowAppId:f.lowAppId,isLowApp:!1,onSave:k,onClose:I,onScroll:B,onOpenWindow:M},null,8,["dragData","pageId","token","tenantId","lowAppId"])):H("",!0)])]),_:1},16,["onRegister"]),C(J,{ref_key:"passwordRef",ref:c,onClosed:n(v)},null,8,["onClosed"])],64)}}});export{Z as _};
