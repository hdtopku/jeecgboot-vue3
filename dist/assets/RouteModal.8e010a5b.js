var e=(e,a,l)=>new Promise(((t,n)=>{var u=e=>{try{s(l.next(e))}catch(a){n(a)}},r=e=>{try{s(l.throw(e))}catch(a){n(a)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(u,r);s((l=l.apply(e,a)).next())}));import{a1 as a,l,a8 as t,dP as n,F as u,L as r,o as s,t as i,v as o,V as d,z as p,y as c,x as m,bc as f,ax as g,C as y,D as v,dG as k,aW as h,c8 as _,cl as b,W as x,dl as C,aJ as w,B as V,Q as R}from"./index.435ab247.js";import{u as U,B as z}from"./index.65c1cb1a.js";const B=e=>a.get({url:"/sys/gatewayRoute/list",params:e}),O=(e,l)=>a.delete({url:"/sys/gatewayRoute/delete",data:e},{joinParamsToUrl:!0}).then((()=>{l()})),I={key:0},j={key:1},P={key:2},L={key:3},A={class:"btn",style:{"padding-top":"10px"}},D=y(" 添加路由条件 "),H=y(" 添加参数 "),K={class:"btn",style:{"padding-top":"10px"}},q=y(" 添加过滤器 "),M=l({__name:"RouteModal",emits:["register","success"],setup(l,{emit:B}){const O=t({xs:{span:24},sm:{span:5}}),M=t({xs:{span:24},sm:{span:16}});n();const S=u(!0),J=u(),F=u();let N=t({inputVisible:!1,inputValue:""});const Q=u(0),T=u(-1),W={routerId:[{required:!0,message:"routerId不能为空",trigger:"blur"}],name:[{required:!0,message:"路由名称不能为空",trigger:"blur"}],uri:[{required:!0,message:"uri不能为空",trigger:"blur"}]},G=["Path","Host","Method","After","Before","Between","RemoteAddr"],$=[{key:1,name:"限流过滤器"}],E=u([{name:"Path",args:[]},{name:"Header",args:{header:"",regexp:""}},{name:"Query",args:{param:"",regexp:""}},{name:"Method",args:[]},{name:"Host",args:[]},{name:"Cookie",args:{name:"",regexp:""}},{name:"After",args:[]},{name:"Before",args:[]},{name:"Between",args:[]},{name:"RemoteAddr",args:[]}]),X=u();let Y=t({});const[Z,{setDrawerProps:ee,closeDrawer:ae}]=U((a=>e(this,null,(function*(){S.value=!!(null==a?void 0:a.isUpdate),ee({confirmLoading:!1}),Y=Object.assign(Y,{id:"",routerId:"",name:"",uri:"",status:1,predicates:[],filters:[]}),r(S)&&(Y=Object.assign(Y,a.record))})))),le=s((()=>r(S)?"编辑路由":"新增路由"));function te(e){}function ne(e,a){e.predicates.splice(a,1)}function ue(e){0==e.key&&Y.filters.push({args:[{key:"name",value:"default"},{key:"fallbackUri",value:"forward:/fallback"}],name:"Hystrix",title:$[0].name}),1==e.key&&Y.filters.push({args:[{key:"key-resolver",value:"#{@ipKeyResolver}"},{key:"redis-rate-limiter.replenishRate",value:20},{key:"redis-rate-limiter.burstCapacity",value:20}],name:"RequestRateLimiter",title:$[0].name})}function re(e){let a=e.args;const l=N.inputValue;l&&-1===a.indexOf(l)&&(e.args=[...a,N.inputValue]),N.inputVisible=!1,N.inputValue="",T.value=-1,Q.value=-1}function se(e,a,l){N.inputValue&&(e.args[l]=N.inputValue),T.value=-1,Q.value=-1}function ie(){return e(this,null,(function*(){yield X.value.validate().then((()=>{try{ee({confirmLoading:!0}),(e=>a.post({url:"/sys/gatewayRoute/updateAll",params:e}))({router:Object.assign({},Y,{predicates:JSON.stringify(Y.predicates),filters:JSON.stringify(Y.filters)})}).then((()=>{ae(),B("success")}))}finally{ee({confirmLoading:!1})}}))}))}return(e,a)=>{const l=i("a-input"),t=i("a-form-item"),n=i("a-switch"),u=i("a-divider"),s=i("a-tag"),U=i("a-col"),B=i("a-row"),S=i("a-menu-item"),ee=i("a-menu"),ae=i("a-button"),oe=i("a-dropdown"),de=i("a-form");return o(),d(r(z),V(e.$attrs,{onRegister:r(Z),title:r(le),width:"30%",onOk:ie,destroyOnClose:"",showFooter:""}),{default:p((()=>[c(de,{ref_key:"formRef",ref:X,"label-col":O,"wrapper-col":M,model:r(Y),rules:W},{default:p((()=>[c(t,{label:"路由ID",name:"routerId"},{default:p((()=>[c(l,{value:r(Y).routerId,"onUpdate:value":a[0]||(a[0]=e=>r(Y).routerId=e),placeholder:"路由唯一ID"},null,8,["value"])])),_:1}),c(t,{label:"路由名称",name:"name"},{default:p((()=>[c(l,{value:r(Y).name,"onUpdate:value":a[1]||(a[1]=e=>r(Y).name=e),placeholder:"路由名称"},null,8,["value"])])),_:1}),c(t,{label:"路由URI",name:"uri"},{default:p((()=>[c(l,{value:r(Y).uri,"onUpdate:value":a[2]||(a[2]=e=>r(Y).uri=e),placeholder:"路由URL"},null,8,["value"])])),_:1}),c(t,{label:"路由状态",name:"status"},{default:p((()=>[c(n,{"default-checked":"","checked-value":1,"un-checked-value":0,checked:r(Y).status,"onUpdate:checked":a[3]||(a[3]=e=>r(Y).status=e)},null,8,["checked"])])),_:1}),c(t,{name:"predicates",label:"路由条件"},{default:p((()=>[(o(!0),m(g,null,f(r(Y).predicates,((e,t)=>(o(),m("div",null,[G.includes(e.name)?(o(),m(g,{key:0},[c(u,null,{default:p((()=>[y(v(e.name)+" ",1),c(r(k),{size:"22",onClick:e=>ne(r(Y),t)},null,8,["onClick"])])),_:2},1024),h("div",null,[(o(!0),m(g,null,f(e.args,((n,u)=>(o(),m(g,null,[u==T.value&&t==Q.value?(o(),d(l,{key:0,ref_for:!0,ref_key:"inputRef2",ref:F,type:"text",size:"small",style:{width:"190px"},value:r(N).inputValue,"onUpdate:value":a[4]||(a[4]=e=>r(N).inputValue=e),onChange:te,onBlur:a=>se(e,0,u),onKeyup:_((a=>se(e,0,u)),["enter"])},null,8,["value","onBlur","onKeyup"])):(o(),d(s,{key:n,style:{"margin-bottom":"2px"},closable:!0,onClose:()=>function(e,a){let l=e.args.filter((e=>e!==a));e.args=l}(e,n),onClick:e=>function(e,a,l,t){Q.value=t,T.value=l,N.inputValue=a,R((()=>{F.value.focus()}))}(0,n,u,t)},{default:p((()=>[y(v(n),1)])),_:2},1032,["onClose","onClick"]))],64)))),256)),r(N).inputVisible&&t==Q.value?(o(),d(l,{key:0,ref_for:!0,ref_key:"inputRef",ref:J,type:"text",size:"small",style:{width:"100px"},value:r(N).inputValue,"onUpdate:value":a[5]||(a[5]=e=>r(N).inputValue=e),onChange:te,onBlur:a=>re(e),onKeyup:_((a=>re(e)),["enter"])},null,8,["value","onBlur","onKeyup"])):(o(),d(s,{key:1,style:{background:"#fff",borderstyle:"dashed","margin-bottom":"2px"},onClick:e=>function(e,a){N.inputValue="",N.inputVisible=!0,Q.value=a,R((()=>{J.value.focus()}))}(0,t)},{default:p((()=>[c(r(b),{size:"22"}),y(" 新建"+v(e.name),1)])),_:2},1032,["onClick"]))])],64)):x("",!0),G.includes(e.name)?x("",!0):(o(),m(g,{key:1},[c(u,null,{default:p((()=>[y(v(e.name)+" ",1),c(r(k),{size:"22",onClick:e=>ne(r(Y),t)},null,8,["onClick"])])),_:2},1024),h("div",null,[(o(!0),m(g,null,f(e.args,((a,t)=>(o(),d(B,null,{default:p((()=>[c(U,{span:5,style:{"margin-top":"8px"}},{default:p((()=>["header"==t?(o(),m("span",I,"Header名称")):x("",!0),"regexp"==t?(o(),m("span",j,"参数值")):x("",!0),"param"==t?(o(),m("span",P,"参数名")):x("",!0),"name"==t?(o(),m("span",L,"参数名")):x("",!0)])),_:2},1024),c(U,{span:18},{default:p((()=>[c(l,{defaultValue:a,placeholder:"参数值",style:{width:"70%","margin-right":"8px","margin-top":"3px"},onChange:a=>function(e,a,l){a[l]=e.target.value}(a,e.args,t)},null,8,["defaultValue","onChange"])])),_:2},1024)])),_:2},1024)))),256))])],64))])))),256)),h("p",A,[c(oe,null,{overlay:p((()=>[c(ee,null,{default:p((()=>[(o(!0),m(g,null,f(E.value,(e=>(o(),d(S,{key:e.name,onClick:a=>{return l=e,void Y.predicates.push({args:l.args,name:l.name});var l}},{default:p((()=>[y(v(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:p((()=>[c(ae,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:p((()=>[D,c(r(C),{size:22})])),_:1})])),_:1})])])),_:1}),c(t,{name:"predicates",label:"过滤器"},{default:p((()=>[(o(!0),m(g,null,f(r(Y).filters,((e,a)=>(o(),m("div",null,[c(u,null,{default:p((()=>[y(v(e.name)+" ",1),c(r(k),{size:"22",onClick:e=>function(e,a){e.filters.splice(a,1)}(r(Y),a)},null,8,["onClick"])])),_:2},1024),(o(!0),m(g,null,f(e.args,((a,t)=>(o(),m("div",{key:a.key},[c(l,{value:a.key,"onUpdate:value":e=>a.key=e,placeholder:"参数键",style:{width:"45%","margin-right":"8px"}},null,8,["value","onUpdate:value"]),c(l,{value:a.value,"onUpdate:value":e=>a.value=e,placeholder:"参数值",style:{width:"40%","margin-right":"8px","margin-top":"3px"}},null,8,["value","onUpdate:value"]),c(r(w),{size:22,onClick:a=>function(e,a){e.args.splice(a,1)}(e,t)},null,8,["onClick"])])))),128)),c(ae,{type:"dashed",style:{"margin-left":"28%",width:"37%","margin-top":"5px"},size:"small",onClick:a=>function(e){e.args.push({key:"key"+e.args.length+1,value:""})}(e)},{default:p((()=>[c(r(C),{size:22}),H])),_:2},1032,["onClick"])])))),256)),h("p",K,[c(oe,null,{overlay:p((()=>[c(ee,{onClick:ue},{default:p((()=>[(o(),m(g,null,f($,(e=>c(S,{key:e.key,name:e.name},{default:p((()=>[y(v(e.name),1)])),_:2},1032,["name"]))),64))])),_:1})])),default:p((()=>[c(ae,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:p((()=>[q,c(r(C))])),_:1})])),_:1})])])),_:1})])),_:1},8,["label-col","wrapper-col","model"])])),_:1},16,["onRegister","title"])}}});var S=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{S as R,M as _,O as d,B as g};
