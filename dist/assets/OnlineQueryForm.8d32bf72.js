import{B as ne}from"./BasicForm.431824e4.js";import"./componentMap.ca1e88f1.js";import{u as ie}from"./useForm.07b578c7.js";import"./JAddInput.0b4cc8b6.js";import{f2 as le,C as x,a8 as ue,E as Y,ac as U,r as E,s as L,t as A,v as g,w as D,aW as B,y as R,z as ce,R as H,Z as me,u as pe,dr as de,ds as fe}from"./index.e9d89356.js";import{c as q,F as M}from"./FormSchemaFactory.5b7ef58e.js";import{g as he,e as ge,f as _e,h as ye,i as W}from"./useAutoForm.a3a6122d.js";import"./JUpload.vue_vue_type_style_index_0_lang.d77c0d79.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang.b38c6274.js";import"./OnlineSelectCascade.08270f2f.js";import"./index.b8c49cb9.js";import"./pick.5c5b7fa5.js";import"./_flatRest.1893f573.js";import"./isArray.3186d40a.js";import"./toString.e0eec860.js";import"./_arrayPush.48fa8f83.js";import"./BasicTable.vue_vue_type_style_index_0_lang.a398320e.js";import"./TableImg.vue_vue_type_style_index_0_lang.0badb1fb.js";import"./Area.f855eaaf.js";import"./functional.46f94982.js";import"./LinkTableListPiece.87d9f947.js";import"./BasicForm.vue_vue_type_style_index_0_lang.b3d41efe.js";import"./uniqBy.f0537a28.js";import"./BasicModal.a8e1ecb1.js";import"./useWindowSizeFn.e88ece92.js";import"./useFormItem.ae9a1c11.js";import"./download.35d6481d.js";import"./base64Conver.030fa32c.js";import"./index.110cdc43.js";import"./index.05b8f207.js";import"./useCountdown.c008b414.js";import"./index.e133fdfd.js";import"./areaDataUtil.213c298c.js";import"./api.d922fd04.js";import"./props.2d04a406.js";import"./index.cb005028.js";import"./bem.5f529a0d.js";import"./props.1944dcd8.js";import"./useContextMenu.6c99b101.js";import"./index.96ff3a69.js";import"./onMountedOrActivated.47c33ec9.js";import"./index.b33fb0f2.js";import"./htmlmixed.84301632.js";import"./vue.a8bc1cc8.js";/* empty css             */import"./depart.api.61b9e361.js";import"./user.api.c10297c7.js";import"./_commonjsHelpers.dc2475b4.js";import"./customExpression.05dc2408.js";import"./BasicTable.590ce013.js";import"./index.3d97e2e6.js";import"./useContentHeight.636b77a9.js";import"./useContentViewHeight.2a9a8e9e.js";import"./usePageContext.bac96502.js";import"./RedoOutlined.6217f32a.js";import"./useListPage.417396b8.js";import"./useTable.0af1d575.js";import"./JModalTip.d42863d7.js";var ve=Object.defineProperty,K=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable,z=(i,a,n)=>a in i?ve(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n,N=(i,a)=>{for(var n in a||(a={}))Fe.call(a,n)&&z(i,n,a[n]);if(K)for(var n of K(a))we.call(a,n)&&z(i,n,a[n]);return i},k=(i,a,n)=>new Promise((u,y)=>{var V=f=>{try{F(n.next(f))}catch(w){y(w)}},v=f=>{try{F(n.throw(f))}catch(w){y(w)}},F=f=>f.done?u(f.value):Promise.resolve(f.value).then(V,v);F((n=n.apply(i,a)).next())});const be={name:"OnlineQueryForm",components:{BasicForm:ne},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(i,{emit:a}){const n="/online/cgform/api/getQueryInfoVue3/",u=x(null),y=x([]),V=x({xs:24,sm:24,md:12,lg:6,xl:6}),v=x(!1),F=x(!1),f=x({}),w=x([]),{createMessage:j}=pe(),p=ue({config:{},cache:{},param:{},status:!1});Y(()=>p.status,e=>k(this,null,function*(){console.log("-------------defaultValues\u53D1\u751F\u6539\u53D8,\u9700\u8981\u91CD\u7F6E\u8868\u5355---------------");const{config:t,cache:s,param:_}=U(p);let b=Object.assign({},t,s,_);yield G(b)}),{immediate:!0,deep:!0});function l(e,t){return k(this,null,function*(){p.cache=N({},e),p.param=N({},t),p.status=!p.status})}Y(()=>i.id,e=>{e?d():y.value=[]},{immediate:!0});function c(e){return k(this,null,function*(){let t=[],s={},_=Object.keys(e);for(let o of _){const r=e[o];let m=r.view;if(q[m]&&(r.view=q[m]),yield ge(o,r,s),r.mode=="group"&&(m=="date"||m=="datetime"||m=="number")){let S=M.createSlotFormSchema(o,r);t.push(S)}else if(r.view===_e){let S=ye(r,o);for(let O of S){let C=M.createFormSchema(O.key,O),I=W(t,O.key);I==-1?t.push(C):t[I]=C}}else if(W(t,o)==-1){let O=M.createFormSchema(o,r);t.push(O)}}t.sort(function(o,r){return o.order-r.order});let b=[];t.length>2&&(v.value=!0);let h=[];for(let o=0;o<t.length;o++){let r=t[o];r.setFormRef(u),r.noChange(),r.asSearchForm(),o>1&&(h.push(r.field),r.isHidden());let m=r.getFormItemSchema();r.slot=="groupDatetime"&&(m.colProps={xs:24,sm:24,md:12,lg:8,xl:8}),b.push(m)}w.value=h,y.value=b,p.config=N({},s),p.status=!p.status})}function d(){return k(this,null,function*(){let e=yield X(),t=J(e);a("loaded",e);let{formProperties:s,hasField:_}=Z(t,e);if(_==!1){y.value=[];return}yield c(s)})}function G(e){return k(this,null,function*(){yield he(u),console.log("rawValues",e),yield T(e),Object.keys(e).length>0&&P()})}function Z(e,t){const{searchFieldList:s,joinQuery:_,table:b}=t;let h=!1,o={};return e&&Object.keys(e).map(r=>{s.indexOf(r)>=0&&(_==!0?r.indexOf("@")<0?(o[b+"@"+r]=e[r],h=!0):(o[r]=e[r],h=!0):r.indexOf("@")<0&&(o[r]=e[r],h=!0))}),{formProperties:o,hasField:h}}function J(e){const{properties:t,searchFieldList:s,joinQuery:_,table:b}=e;let h={},o=1;return Object.keys(t).map(r=>{let m=t[r];if(m.view=="table"){let S=m.properties,O=o*100;Object.keys(S).map(C=>{let I=S[C];I.order=O+Number(I.order);let se=r+"@"+C;h[se]=I}),o++}else m.order=Number(m.order),h[r]=m}),h}function X(){let e=`${n}${i.id}`;return new Promise(t=>{me.get({url:e},{isTransformResponse:!1}).then(s=>{s.success?t(s.result):(t(!1),j.warning(s.message))}).catch(()=>{j.warning("\u83B7\u53D6\u67E5\u8BE2\u6761\u4EF6\u5931\u8D25!"),t(!1)})})}const[$,{resetFields:ee,setFieldsValue:T,updateSchema:te,getFieldsValue:re}]=ie({schemas:y,showActionButtonGroup:!1,baseColProps:V,autoSubmitOnEnter:!0,submitFunc(){P()}});function P(){let e=re(),t=Object.assign({},U(p.param),ae(e));a("search",t,!0)}function oe(){return k(this,null,function*(){yield ee();const{config:e,param:t}=U(p);let s=Object.assign({},e,t);Object.keys(s).length>0&&(yield T(s)),a("search",s,!1)})}function ae(e){return Object.keys(e).map(t=>{e[t]&&e[t]instanceof Array&&(e[t]=e[t].join(","))}),e}return Y(()=>F.value,e=>{let t=w.value;if(t&&t.length>0){let s=[];for(let _ of t)s.push({field:_,show:e});te(s)}},{immediate:!1}),{onlineQueryFormRef:u,registerForm:$,initDefaultValues:l,toggleButtonShow:v,toggleSearchStatus:F,doSearch:P,resetSearch:oe,queryParams:f,formSchemas:y}}},Q=i=>(de("data-v-716ddf4f"),i=i(),fe(),i),Se={key:0,class:"jeecg-basic-table-form-container p-0"},Oe=Q(()=>B("span",{class:"group-query-string"},"~",-1)),xe=Q(()=>B("span",{class:"group-query-string"},"~",-1)),De=Q(()=>B("span",{class:"group-query-string"},"~",-1)),Ie={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function Ee(i,a,n,u,y,V){const v=E("a-date-picker"),F=E("a-input-number"),f=E("a-button"),w=E("a-icon"),j=E("a-col"),p=E("BasicForm");return u.formSchemas&&u.formSchemas.length>0?(L(),A("div",Se,[g(p,{ref:"onlineQueryFormRef",onRegister:u.registerForm},{groupDate:D(({model:l,field:c})=>[g(v,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F",value:l[c+"_begin"],"onUpdate:value":d=>l[c+"_begin"]=d,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),Oe,g(v,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u7ED3\u675F\u65E5\u671F",value:l[c+"_end"],"onUpdate:value":d=>l[c+"_end"]=d,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),groupDatetime:D(({model:l,field:c})=>[g(v,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u5F00\u59CB\u65F6\u95F4",value:l[c+"_begin"],"onUpdate:value":d=>l[c+"_begin"]=d,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),xe,g(v,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u7ED3\u675F\u65F6\u95F4",value:l[c+"_end"],"onUpdate:value":d=>l[c+"_end"]=d,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),groupNumber:D(({model:l,field:c})=>[g(F,{placeholder:"\u5F00\u59CB\u503C",value:l[c+"_begin"],"onUpdate:value":d=>l[c+"_begin"]=d,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),De,g(F,{placeholder:"\u7ED3\u675F\u503C",value:l[c+"_end"],"onUpdate:value":d=>l[c+"_end"]=d,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),formFooter:D(()=>[g(j,{md:6,sm:8},{default:D(()=>[B("span",Ie,[g(f,{preIcon:"ant-design:search",type:"primary",onClick:u.doSearch},{default:D(()=>[R("\u67E5\u8BE2")]),_:1},8,["onClick"]),g(f,{preIcon:"ant-design:reload",type:"primary",onClick:u.resetSearch,style:{"margin-left":"8px"}},{default:D(()=>[R("\u91CD\u7F6E")]),_:1},8,["onClick"]),u.toggleButtonShow?(L(),A("a",{key:0,onClick:a[0]||(a[0]=l=>u.toggleSearchStatus=!u.toggleSearchStatus),style:{"margin-left":"8px"}},[R(ce(u.toggleSearchStatus?"\u6536\u8D77":"\u5C55\u5F00")+" ",1),g(w,{type:u.toggleSearchStatus?"up":"down"},null,8,["type"])])):H("",!0)])]),_:1})]),_:1},8,["onRegister"])])):H("",!0)}var Bt=le(be,[["render",Ee],["__scopeId","data-v-716ddf4f"]]);export{Bt as default};
