import{B as e}from"./index.934459b9.js";import{B as o}from"./BasicForm.5f094c03.js";import{T as t}from"./helper.7e5efd4b.js";import{u as a}from"./useForm.18cf269c.js";import"./JAddInput.a2bd8bfb.js";import{l as n,F as i,bH as r,bI as s,a8 as l,o as c,f0 as d,t as m,v as u,V as p,z as f,y as b,C as j,x as g,W as y,bl as h,bm as w,Q as v}from"./index.26a57b91.js";import{B as C}from"./BasicTable.8cbbb86a.js";import"./TableImg.f02873d7.js";import{useListPage as x}from"./useListPage.fd3526da.js";import{u as M}from"./useOnlineTest.697106d1.js";import{b as T,c as B}from"./enhance.data.40348255.js";import{c as S,e as F,f as R}from"./enhance.api.b7b7fa5d.js";import"./BasicModal.e5e1fb3e.js";import"./useWindowSizeFn.9ed8a10e.js";import"./uniqBy.006870c7.js";import"./useFormItem.efca0b58.js";import"./functional.c7818516.js";import"./download.4b98da42.js";import"./base64Conver.030fa32c.js";import"./index.608c7cf2.js";import"./index.b94b363f.js";import"./useCountdown.e60db803.js";import"./JUpload.7c63ef7b.js";import"./api.54a4ca84.js";import"./index.9c299300.js";import"./props.eaaadc91.js";import"./index.3e7bd500.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";import"./index.0d2a049f.js";import"./onMountedOrActivated.d719a17d.js";import"./index.6fce0e9a.js";import"./htmlmixed.fbaa0b47.js";import"./vue.38e13cef.js";/* empty css             */import"./depart.api.c295d6d2.js";import"./index.1a78ea68.js";import"./useContentHeight.3e69d770.js";import"./useContentViewHeight.34b8e2f1.js";import"./usePageContext.dd16d566.js";import"./RedoOutlined.48666e00.js";import"./useTable.98dbd6c0.js";import"./cgform.data.3f26a448.js";var k=Object.defineProperty,A=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,P=(e,o,t)=>o in e?k(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,_=(e,o,t)=>new Promise(((a,n)=>{var i=e=>{try{s(t.next(e))}catch(o){n(o)}},r=e=>{try{s(t.throw(e))}catch(o){n(o)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);s((t=t.apply(e,o)).next())}));const L=n({name:"EnhanceSqlModal",components:{BasicModal:e,BasicTable:C,BasicForm:o,TableAction:t},emits:["register"],setup(){const e=i(""),o=i(""),t=i([]),{columns:n}=B(t),{doRequest:d,doDeleteRecord:m,tableContext:u}=x({tableProps:{api:o=>_(this,null,(function*(){let{dataSource:a,btnList:n}=yield S(e.value,o);return t.value=n,a})),columns:n,canResize:!1,useSearchForm:!1,beforeFetch:e=>Object.assign(e,{column:"orderNum",order:"asc"})}}),[p,{reload:f},{rowSelection:b,selectedRowKeys:j}]=u,[g,{closeModal:y}]=r((t=>_(this,null,(function*(){e.value=t.row.id,o.value=t.row.tableName,f()})))),{aiTestMode:h,genEnhanceSqlData:w}=M(),[C,k]=s(),L=i(!1),q=l({onRegister:C,title:c((()=>(null==L?void 0:L.value)?"修改":"新增")),width:800,confirmLoading:!1,onOk:function(){return _(this,null,(function*(){try{q.confirmLoading=!0;let o=yield G();o=Object.assign({},I,o),yield R(e.value,o,L.value),f(),k.closeModal()}finally{q.confirmLoading=!1}}))},onCancel:k.closeModal});let I={};const{formSchemas:E}=T(t),[H,{resetFields:U,setFieldsValue:z,validate:G}]=a({schemas:E,showActionButtonGroup:!1});function K(e){return _(this,null,(function*(){var o;L.value=e.isUpdate,I=((e,o)=>{for(var t in o||(o={}))D.call(o,t)&&P(e,t,o[t]);if(A)for(var t of A(o))O.call(o,t)&&P(e,t,o[t]);return e})({},null!=(o=e.record)?o:{}),k.openModal(),yield v(),yield U(),z(I)}))}return{rowSelection:b,selectedRowKeys:j,aiTestMode:h,onCancel:function(){y()},onAdd:function(){K({isUpdate:!1})},onGenEnhanceSqlData:function(){w(e.value,o.value)},onBatchDelete:function(){return _(this,null,(function*(){d((()=>F(j.value)))}))},getTableAction:function(e){return[{label:"编辑",onClick:()=>function(e){K({isUpdate:!0,record:e})}(e)}]},getDropDownAction:function(e){return[{label:"删除",popConfirm:{title:"确定删除吗？",placement:"left",confirm:()=>m((()=>F([e.id])))}}]},formModalProps:q,registerModal:g,registerTable:p,registerForm:H}},computed:{tableScroll:()=>({y:window.innerHeight-320})}}),q={key:0,style:{float:"left"}};var I=d(L,[["render",function(e,o,t,a,n,i){const r=m("a-button"),s=m("a-icon"),l=m("a-menu-item"),c=m("a-menu"),d=m("a-dropdown"),v=m("TableAction"),C=m("BasicTable"),x=m("BasicForm"),M=m("a-spin"),T=m("BasicModal");return u(),p(T,{onRegister:e.registerModal,title:"SQL增强",width:1200,defaultFullscreen:"",onCancel:e.onCancel},{footer:f((()=>[b(r,{onClick:e.onCancel},{default:f((()=>[j("关闭")])),_:1},8,["onClick"]),e.aiTestMode?(u(),g("div",q,[b(r,{onClick:e.onGenEnhanceSqlData},{default:f((()=>[j("生成测试数据")])),_:1},8,["onClick"])])):y("",!0)])),default:f((()=>[b(C,{onRegister:e.registerTable,rowSelection:e.rowSelection},{tableTitle:f((()=>[b(r,{onClick:e.onAdd,type:"primary",preIcon:"ant-design:plus"},{default:f((()=>[j("新增")])),_:1},8,["onClick"]),e.selectedRowKeys.length>0?(u(),p(d,{key:0},{overlay:f((()=>[b(c,null,{default:f((()=>[b(l,{key:"1",onClick:e.onBatchDelete},{default:f((()=>[b(s,{type:"delete"}),j(" 删除 ")])),_:1},8,["onClick"])])),_:1})])),default:f((()=>[b(r,{style:{"margin-left":"8px"}},{default:f((()=>[j(" 批量操作 "),b(s,{type:"down"})])),_:1})])),_:1})):y("",!0)])),action:f((({record:o})=>[b(v,{actions:e.getTableAction(o),dropDownActions:e.getDropDownAction(o)},null,8,["actions","dropDownActions"])])),_:1},8,["onRegister","rowSelection"]),b(T,h(w(e.formModalProps)),{default:f((()=>[b(M,{spinning:e.formModalProps.confirmLoading},{default:f((()=>[b(x,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16)])),_:1},8,["onRegister","onCancel"])}]]);export{I as default};
