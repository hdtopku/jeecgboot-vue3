var w=(h,t,l)=>new Promise((i,r)=>{var s=a=>{try{u(l.next(a))}catch(d){r(d)}},c=a=>{try{u(l.throw(a))}catch(d){r(d)}},u=a=>a.done?i(a.value):Promise.resolve(a.value).then(s,c);u((l=l.apply(h,t)).next())});import{_ as P}from"./index.4e26ab6e.js";import{u as z,a as A,B as O}from"./index.8ce2f7e8.js";import{l as W,F as n,t as f,v as m,x as G,y,z as p,aV as F,V as E,D as H,W as J,L as D,aw as M,C as Q}from"./index.a86a095a.js";import U from"./DepartRoleDataRuleDrawer.3c0455c2.js";import{i as X,j as Y,k as Z}from"./depart.user.api.4bd2b9e7.js";import"./bem.58472782.js";import"./props.3a3564ad.js";import"./useContextMenu.3dd9697f.js";const ee=Q("\u4EC5\u4FDD\u5B58"),ce=W({__name:"DepartRoleAuthDrawer",emits:["register"],setup(h){const t=n(!1),l=n(""),i=n(""),r=n([]),s=n([]),c=n([]),u=n([]),a=n([]),d=n([]),I=n(!0),[K,{closeDrawer:R}]=z(e=>{i.value=e.record.id,l.value=e.record.departId,x()}),[B,S]=A();function x(){return w(this,null,function*(){try{t.value=!0;const{ids:e,treeList:o}=yield X({departId:l.value});e.length>0?(d.value=e,u.value=e,r.value=o,s.value=yield Y({roleId:i.value}),c.value=[s.value]):_()}finally{t.value=!1}})}function _(){r.value=[],u.value=[],s.value=[],c.value=[],t.value=!1}function V(e){I.value?s.value=e.checked:s.value=e}function b(e){u.value=e}function T(e,{selectedNodes:o}){var v;if((v=o[0])!=null&&v.ruleFlag){let g=e[0];S.openDrawer(!0,{roleId:i,departId:l,functionId:g})}a.value=[]}function N(){_(),R()}function $(){_()}function C(e){return w(this,null,function*(){try{t.value=!0;let o={roleId:i.value,permissionIds:s.value.join(","),lastpermissionIds:c.value.join(",")};yield Z(o),e&&N()}finally{t.value=!1,e||x()}})}return(e,o)=>{const v=f("Icon"),g=f("a-empty"),j=f("a-spin"),L=f("a-button");return m(),G(M,null,[y(D(O),{title:"\u90E8\u95E8\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:650,loading:t.value,showFooter:"",okText:"\u4FDD\u5B58\u5E76\u5173\u95ED",onOk:o[1]||(o[1]=k=>C(!0)),onClose:$,onRegister:D(K)},{centerFooter:p(()=>[y(L,{type:"primary",loading:t.value,ghost:"",onClick:o[0]||(o[0]=k=>C(!1))},{default:p(()=>[ee]),_:1},8,["loading"])]),default:p(()=>[F("div",null,[y(j,{spinning:t.value},{default:p(()=>[r.value.length>0?(m(),E(D(P),{key:0,title:"\u6240\u62E5\u6709\u7684\u90E8\u95E8\u6743\u9650",toolbar:"",checkable:"",treeData:r.value,checkedKeys:s.value,selectedKeys:a.value,expandedKeys:u.value,checkStrictly:I.value,clickRowToExpand:!1,onCheck:V,onExpand:b,onSelect:T},{title:p(({slotTitle:k,ruleFlag:q})=>[F("span",null,H(k),1),q?(m(),E(v,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):J("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(m(),E(g,{key:1,description:"\u65E0\u53EF\u914D\u7F6E\u90E8\u95E8\u6743\u9650"}))]),_:1},8,["spinning"])])]),_:1},8,["loading","onRegister"]),y(U,{onRegister:D(B)},null,8,["onRegister"])],64)}}});export{ce as default};
