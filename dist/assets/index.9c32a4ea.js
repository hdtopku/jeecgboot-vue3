var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(i)for(var s of i(t))a.call(t,s)&&r(e,s,t[s]);return e};import{s as c,l,a8 as u,F as d,am as p,o as m,H as g,aa as f,y as h,L as y,b0 as v,bh as w,aK as x,dB as T,B as b,dC as S,Z as P}from"./index.b3c93d64.js";const{t:D}=c(),M={value:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:[String],default:D("component.verify.dragText")},successText:{type:[String],default:D("component.verify.successText")},height:{type:[Number,String],default:40},width:{type:[Number,String],default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},O=(I=o({},M),t(I,s({src:{type:String},imgWidth:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}})));var I,$=l({name:"BaseDargVerify",props:M,emits:["success","update:value","change","start","move","end"],setup(e,{emit:t,slots:s,expose:i}){const n=u({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),a=d(null),r=d(null),c=d(null),l=d(null);p({el:document,name:"mouseup",listener:()=>{n.isMoving&&_()}});const b=m((()=>{const{height:t,actionStyle:s}=e,i=`${parseInt(t)}px`;return o({left:0,width:i,height:i},s)})),S=m((()=>{const{height:t,width:s,circle:i,wrapStyle:n}=e,a=parseInt(t),r=`${parseInt(s)}px`;return o({width:r,height:`${a}px`,lineHeight:`${a}px`,borderRadius:i?a/2+"px":0},n)})),P=m((()=>{const{height:t,circle:s,barStyle:i}=e,n=parseInt(t);return o({height:`${n}px`,borderRadius:s?n/2+"px 0 0 "+n/2+"px":0},i)})),D=m((()=>{const{height:t,width:s,contentStyle:i}=e,n=`${parseInt(t)}px`,a=`${parseInt(s)}px`;return o({height:n,width:a},i)}));function M(e){return e.pageX||e.touches[0].pageX}function O(e){if(n.isPassing)return;const s=y(l);s&&(t("start",e),n.moveDistance=M(e)-parseInt(s.style.left.replace("px",""),10),n.startTime=(new Date).getTime(),n.isMoving=!0)}function I(t){const s=parseInt(t.style.width),{width:i}=e,n=parseInt(i);return{offset:n-s-6,widthNum:n,actionWidth:s}}function $(s){const{isMoving:i,moveDistance:a}=n;if(i){const i=y(l),n=y(r);if(!i||!n)return;const{offset:o,widthNum:c,actionWidth:u}=I(i),d=M(s)-a;t("move",{event:s,moveDistance:a,moveX:d}),d>0&&d<=o?(i.style.left=`${d}px`,n.style.width=`${d+u/2}px`):d>o&&(i.style.left=c-u+"px",n.style.width=c-u/2+"px",e.isSlot||R())}}function j(s){const{isMoving:i,isPassing:a,moveDistance:o}=n;if(i&&!a){t("end",s);const i=y(l),a=y(r);if(!i||!a)return;const u=M(s)-o,{offset:d,widthNum:p,actionWidth:m}=I(i);u<d?e.isSlot?setTimeout((()=>{if(e.value){const e=y(c);e&&(e.style.width=`${parseInt(a.style.width)}px`)}else _()}),0):_():(i.style.left=p-m+"px",a.style.width=p-m/2+"px",R()),n.isMoving=!1}}function R(){e.isSlot?_():(n.endTime=(new Date).getTime(),n.isPassing=!0,n.isMoving=!1)}function _(){n.isMoving=!1,n.isPassing=!1,n.moveDistance=0,n.toLeft=!1,n.startTime=0,n.endTime=0;const e=y(l),t=y(r),s=y(c);e&&t&&s&&(n.toLeft=!0,v((()=>{n.toLeft=!1,e.style.left="0",t.style.width="0"}),300),s.style.width=y(D).width)}return g((()=>n.isPassing),(e=>{if(e){const{startTime:s,endTime:i}=n;t("success",{isPassing:e,time:((i-s)/1e3).toFixed(1)}),t("update:value",e),t("change",e)}})),f((()=>{n.isPassing=!!e.value})),i({resume:_}),()=>h("div",{class:"darg-verify",ref:a,style:y(S),onMousemove:$,onTouchmove:$,onMouseleave:j,onMouseup:j,onTouchend:j},[(()=>{const e=["darg-verify-bar"];return n.toLeft&&e.push("to-left"),h("div",{class:e,ref:r,style:y(P)},null)})(),(()=>{const t=["darg-verify-content"],{isPassing:i}=n,{text:a,successText:r}=e;return i&&t.push("success"),h("div",{class:t,ref:c,style:y(D)},[w(s,"text",i)||(i?r:a)])})(),(()=>{const e=["darg-verify-action"],{toLeft:t,isPassing:i}=n;return t&&e.push("to-left"),h("div",{class:e,onMousedown:O,onTouchstart:O,style:y(b),ref:l},[w(s,"actionIcon",i)||h(i?x:T,{class:"darg-verify-action__icon"},null)])})()])}}),j=l({name:"ImgRotateDragVerify",inheritAttrs:!1,props:O,emits:["success","change","update:value"],setup(e,{emit:t,attrs:s,expose:i}){const n=d(null),a=u({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:r}=c();g((()=>a.isPassing),(e=>{if(e){const{startTime:s,endTime:i}=a;t("success",{isPassing:e,time:((i-s)/1e3).toFixed(1)}),t("change",e),t("update:value",e)}}));const l=m((()=>{const{imgWrapStyle:t,imgWidth:s}=e;return o({width:`${s}px`,height:`${s}px`},t)})),p=m((()=>{const{minDegree:t,maxDegree:s}=e;return t===s?Math.floor(1+1*Math.random())/10+1:1}));function f(){a.startTime=(new Date).getTime()}function w(t){a.draged=!0;const{imgWidth:s,height:i,maxDegree:n}=e,{moveX:r}=t,o=Math.ceil(r/(s-parseInt(i))*n*y(p));a.currentRotate=o,a.imgStyle=S("transform",`rotateZ(${a.randomRotate-o}deg)`)}function x(){const{minDegree:t,maxDegree:s}=e,i=Math.floor(t+Math.random()*(s-t));a.randomRotate=i,a.imgStyle=S("transform",`rotateZ(${i}deg)`)}function T(){const{randomRotate:t,currentRotate:s}=a,{diffDegree:i}=e;Math.abs(t-s)>=(i||20)?(a.imgStyle=S("transform",`rotateZ(${t}deg)`),a.toOrigin=!0,v((()=>{a.toOrigin=!1,a.showTip=!0}),300)):(a.isPassing=!0,a.endTime=(new Date).getTime()),a.showTip=!0}function P(){a.showTip=!1;const e=y(n);e&&(a.isPassing=!1,e.resume(),x())}return i({resume:P}),()=>{const{src:t}=e,{toOrigin:i,isPassing:c,startTime:u,endTime:d}=a,p=[];i&&p.push("to-origin");const m=(d-u)/1e3;return h("div",{class:"ir-dv"},[h("div",{class:"ir-dv-img__wrap",style:y(l)},[h("img",{src:t,onLoad:x,width:parseInt(e.width),class:p,style:a.imgStyle,onClick:()=>{P()},alt:"verify"},null),a.showTip&&h("span",{class:["ir-dv-img__tip",a.isPassing?"success":"error"]},[a.isPassing?r("component.verify.time",{time:m.toFixed(1)}):r("component.verify.error")]),!a.showTip&&!a.draged&&h("span",{class:["ir-dv-img__tip","normal"]},[r("component.verify.redoTip")])]),h($,b({class:"ir-dv-drag__bar",onMove:w,onEnd:T,onStart:f,ref:n},o(o({},s),e),{value:c,isSlot:!0}),null)])}}});const R=P($),_=P(j);export{R as B,_ as R};
