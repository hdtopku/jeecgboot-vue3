import{dL as au,aN as iu,bH as r,F as g,h as p,f1 as su,bw as y,aA as ru}from"./index.df6cbb3d.js";import"./index.696f9d2b.js";import{a as cu}from"./index.b74fc315.js";import{useListPage as fu}from"./useListPage.d3c8405c.js";import{l as pu,d as Fu,a as v,b as w,c as du,e as hu}from"./CgformModal.04e7114f.js";import{useCopyModal as mu}from"./useCopyModal.1311b9a5.js";var D=(t,a,i)=>new Promise((d,h)=>{var n=l=>{try{s(i.next(l))}catch(c){h(c)}},F=l=>{try{s(i.throw(l))}catch(c){h(c)}},s=l=>l.done?d(l.value):Promise.resolve(l.value).then(n,F);s((i=i.apply(t,a)).next())}),M=(t=>(t[t.normal=0]="normal",t[t.copy=1]="copy",t))(M||{});function yu(t){const a=t.pageType===M.normal,i=au(),d=fu({designScope:t.designScope,tableProps:{api:pu,columns:t.columns,formConfig:{schemas:t.formSchemas},beforeFetch:u=>{let e=a?0:1,o=a?void 0:i.currentRoute.value.params.code;return iu(u.tableType_MultiString)&&(u.tableType_MultiString=u.tableType_MultiString.join(",")),Object.assign(u,{copyType:e,physicId:o})}}}),{tableContext:h,createMessage:n,createConfirm:F}=d,[,{reload:s,setLoading:l},{selectedRowKeys:c,selectedRows:f}]=h,[T,C]=r(),[S,A]=r(),[k,x]=r(),[L,$]=r(),[O,R]=r(),[P,I]=r(),[J,U]=r(),[Y,_]=cu(),[G,N]=r();function j(){C.openModal(!0,{isUpdate:!1})}function q(u){C.openModal(!0,{isUpdate:!0,record:u})}function H(){let u=c.value;if(u.length<=0){n.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u6761\u8BB0\u5F55\uFF01");return}F({title:"\u5220\u9664",content:"<p>\u79FB\u9664\u53EA\u4F1A\u5220\u9664\u8868\u5355\u914D\u7F6E\uFF1B<br>\u5220\u9664\u5219\u4F1A\u5220\u9664\u5BF9\u5E94\u7684\u6570\u636E\u5E93\u8868\u4EE5\u53CA\u5B50\u8868\u4E14\u4E0D\u80FD\u6062\u590D\u3002<br>\u8BF7\u786E\u8BA4\u60A8\u7684\u64CD\u4F5C\u2026</p>",iconType:"warning",closable:!0,okText:"\u79FB\u9664",cancelText:"\u5220\u9664",cancelButtonProps:{danger:!0},onOk:()=>D(this,null,function*(){return m(v,u,!0)}),onCancel(e){return e!=null&&e.triggerCancel?Promise.resolve():m(w,u,!0)}})}function m(u,e,o=!1){return D(this,null,function*(){try{l(!0);const b=yield u(e);return s(),o&&(c.value=[]),b}finally{l(!1)}return Promise.reject()})}function K(){B(([u])=>$.openModal(!0,{row:u}))}function V(){B(([u])=>R.openModal(!0,{row:u}))}function z(){B(([u])=>I.openModal(!0,{row:u}))}function Q(){B(([u])=>U.openModal(!0,{row:u}))}function W(){A.openModal(!0,{})}function B(u,e=1,o=1){f.value.length<e?n.warning(`\u8BF7\u5148\u81F3\u5C11\u9009\u4E2D ${e} \u6761\u8BB0\u5F55`):f.value.length>o?n.warning(`\u6700\u591A\u53EA\u80FD\u9009\u4E2D ${e} \u6761\u8BB0\u5F55`):u(f.value)}function X(){if(f.value.length===0)n.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55");else if(f.value.length>1)n.warning("\u4EE3\u7801\u751F\u6210\u53EA\u80FD\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55");else{let u=f.value[0];u?u.isDbSynch!="Y"?n.warning("\u8BF7\u5148\u540C\u6B65\u6570\u636E\u5E93\uFF01"):u.tableType==3?n.warning("\u8BF7\u9009\u4E2D\u8BE5\u8868\u5BF9\u5E94\u7684\u4E3B\u8868"):x.openModal(!0,{code:u.id}):n.warning("\u8BF7\u9009\u4E2D\u5F53\u524D\u9875\u7684\u6570\u636E\uFF01")}}function Z(u){console.log(u),u.isTree=="Y"?i.push({path:"/online/cgformTreeList/"+u.id}):i.push({path:"/online/cgformList/"+u.id})}function uu(u){const e=g("normal"),o=g(!1),b=F({iconType:"info",title:"\u540C\u6B65\u6570\u636E\u5E93",content:()=>p("div",{style:"margin: 20px 0;"},p(su,{value:e.value,disabled:o.value,"onUpdate:value":E=>e.value=E},()=>[p(y,{value:"normal"},()=>"\u666E\u901A\u540C\u6B65\uFF08\u4FDD\u7559\u8868\u6570\u636E\uFF09"),p(y,{value:"force"},()=>"\u5F3A\u5236\u540C\u6B65\uFF08\u5220\u9664\u8868\uFF0C\u91CD\u65B0\u751F\u6210\uFF09")])),maskClosable:!0,okText:"\u5F00\u59CB\u540C\u6B65",onOk(){return D(this,null,function*(){o.value=!0,b.update({maskClosable:!1,keyboard:!1,okText:"\u540C\u6B65\u4E2D\u2026",okButtonProps:{loading:o.value},cancelButtonProps:{disabled:o.value}});try{yield du(u.id,e.value)}catch(E){n.warn(E.message||E)}finally{s()}})}})}const{createCopyModal:eu}=mu();function nu(u){let e;u.themeTemplate==="erp"?e=`/online/cgformErpList/${u.id}`:u.themeTemplate==="innerTable"?e=`/online/cgformInnerTableList/${u.id}`:u.themeTemplate==="tab"?e=`/online/cgformTabList/${u.id}`:u.isTree=="Y"?e=`/online/cgformTreeList/${u.id}`:e=`/online/cgformList/${u.id}`,eu({title:`\u83DC\u5355\u94FE\u63A5\u3010${u.tableTxt}\u3011`,content:e,copyText:e})}function tu(u){const e=g(u.tableName+"_copy");F({title:"\u590D\u5236\u8868",content:()=>p("div",{style:"margin: 20px 0;"},["\u8BF7\u8F93\u5165\u65B0\u8868\u540D\uFF1A",p(ru,{value:e.value,"onUpdate:value":o=>e.value=o})]),iconType:"info",closable:!0,okText:"\u590D\u5236",onOk(){e.value?e.value===u.tableName?n.warning("\u65B0\u8868\u540D\u548C\u65E7\u8868\u540D\u4E0D\u80FD\u4E00\u81F4"):hu(u.id,e.value).then(s):n.warning("\u8BF7\u8F93\u5165\u65B0\u8868\u540D")}})}function lu(u){return[{label:"\u7F16\u8F91",onClick:()=>q(u)}]}function ou(u){return[{label:"\u540C\u6B65\u6570\u636E\u5E93",onClick:()=>uu(u),ifShow:()=>a&&u.isDbSynch!="Y"},{label:"\u529F\u80FD\u6D4B\u8BD5",class:["low-app-hide"],onClick:()=>Z(u),ifShow:()=>a?u.isDbSynch=="Y"&&u.tableType!==3:!0},{label:"\u914D\u7F6E\u5730\u5740",class:["low-app-hide"],onClick:()=>nu(u),ifShow:()=>a?u.isDbSynch=="Y"&&u.tableType!==3:!0},{label:"\u6743\u9650\u63A7\u5236",onClick:()=>_.openDrawer(!0,{cgformId:u.id})},{label:"\u89D2\u8272\u6388\u6743",onClick:()=>N.openModal(!0,{cgformId:u.id})},{label:"\u89C6\u56FE\u7BA1\u7406",class:["low-app-hide"],onClick:()=>i.push(`/online/copyform/${u.id}`),ifShow:()=>a&&u.hascopy==1},{label:"\u751F\u6210\u89C6\u56FE",class:["low-app-hide"],popConfirm:{title:"\u786E\u5B9A\u751F\u6210\u89C6\u56FE\u5417\uFF1F",placement:"left",confirm:()=>{l(!0),Fu(u.id).then(()=>{n.success("\u5DF2\u6210\u529F\u751F\u6210\u89C6\u56FE")}).finally(()=>{l(!1),s()})}},ifShow:()=>a},{label:"\u590D\u5236\u8868",onClick:()=>tu(u),ifShow:()=>a},{label:"\u79FB\u9664",popConfirm:{title:"\u786E\u5B9A\u79FB\u9664\u5417\uFF1F",placement:"left",confirm:()=>m(v,[u.id])}},{label:"\u5220\u9664",popConfirm:{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",placement:"left",confirm:()=>m(w,[u.id])},ifShow:()=>a}]}return{router:i,pageContext:d,onAdd:j,onDeleteBatch:H,onImportDbTable:W,onGenerateCode:X,onShowCustomButton:K,onShowEnhanceJs:V,onShowEnhanceSql:z,onShowEnhanceJava:Q,getTableAction:lu,getDropDownAction:ou,registerCustomButtonModal:L,registerEnhanceJsModal:O,registerEnhanceSqlModal:P,registerEnhanceJavaModal:J,registerAuthManagerDrawer:Y,registerAuthSetterModal:G,registerCgformModal:T,registerDbToOnlineModal:S,registerCodeGeneratorModal:k}}export{M as C,yu as u};
