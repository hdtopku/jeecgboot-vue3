var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,r=(e,r)=>{for(var l in r||(r={}))a.call(r,l)&&o(e,l,r[l]);if(t)for(var l of t(r))s.call(r,l)&&o(e,l,r[l]);return e},l=(e,t,a)=>new Promise(((s,o)=>{var r=e=>{try{n(a.next(e))}catch(t){o(t)}},l=e=>{try{n(a.throw(e))}catch(t){o(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,l);n((a=a.apply(e,t)).next())}));import{B as n}from"./index.934459b9.js";import{B as i}from"./BasicForm.5f094c03.js";import"./helper.7e5efd4b.js";import{u as d}from"./useForm.18cf269c.js";import"./JAddInput.a2bd8bfb.js";import{a1 as c,a5 as p,l as u,F as m,bH as y,o as f,L as g,v as b,V as h,z as v,y as x,B as j}from"./index.26a57b91.js";const P=[{title:"分类名称",dataIndex:"name",width:350,align:"left"},{title:"分类编码",dataIndex:"code"}],O=[{label:"名称",field:"name",component:"Input",colProps:{span:6}},{label:"编码",field:"code",component:"Input",colProps:{span:6}}],w=[{label:"",field:"id",component:"Input",show:!1},{label:"父级节点",field:"pid",component:"TreeSelect",componentProps:{replaceFields:{value:"key"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:()=>document.body},show:({values:e})=>"0"!==e.pid,dynamicDisabled:({values:e})=>!!e.id},{label:"分类名称",field:"name",required:!0,component:"Input"}],I="/sys/category/exportXls",T="/sys/category/importExcel",_=e=>c.get({url:"/sys/category/rootList",params:e}),B=(e,t)=>c.delete({url:"/sys/category/delete",params:e},{joinParamsToUrl:!0}).then((()=>{t()})),C=(e,t)=>{p.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>c.delete({url:"/sys/category/deleteBatch",data:e},{joinParamsToUrl:!0}).then((()=>{t()}))})},L=e=>c.get({url:"/sys/category/childList",params:e}),k=e=>c.get({url:"/sys/category/getChildListBatch",params:e},{isTransformResponse:!1}),F=u({__name:"CategoryModal",emits:["register","success"],setup(e,{emit:t}){const a=m(!0),s=m([]),o=m([]),[p,{resetFields:u,setFieldsValue:P,validate:O,updateSchema:I}]=d({schemas:w,showActionButtonGroup:!1,labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[T,{setModalProps:_,closeModal:B}]=y((e=>l(this,null,(function*(){var t;yield u(),s.value=[],_({confirmLoading:!1,minHeight:80}),a.value=!!(null==e?void 0:e.isUpdate),(null==e?void 0:e.record)&&(yield P(r({},e.record))),o.value=yield(t={async:!1,pcode:""},c.get({url:"/sys/category/loadTreeRoot",params:t})),I({field:"pid",componentProps:{treeData:o}})})))),C=f((()=>g(a)?"编辑字典":"新增字典"));function L(e,t){if(e&&t&&t.length>0)for(let a=0;a<t.length;a++)t[a].key==e&&g(s).indexOf(e)<0?(s.value.push(t[a].key),L(t[a].parentId,g(o))):L(e,t[a].children)}function k(){return l(this,null,(function*(){try{let e=yield O();_({confirmLoading:!0}),yield((e,t)=>{let a=t?"/sys/category/edit":"/sys/category/add";return c.post({url:a,params:e})})(e,a.value),B(),yield L(e.pid,g(o)),t("success",{isUpdate:g(a),values:r({},e),expandedArr:g(s).reverse()})}finally{_({confirmLoading:!1})}}))}return(e,t)=>(b(),h(g(n),j(e.$attrs,{onRegister:g(T),destroyOnClose:"",title:g(C),onOk:k}),{default:v((()=>[x(g(i),{onRegister:g(p)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});var R=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{R as C,F as _,T as a,C as b,P as c,k as d,L as e,B as f,I as g,_ as l,O as s};
