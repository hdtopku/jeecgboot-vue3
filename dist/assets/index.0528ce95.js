var e=Object.defineProperty,n=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(n,t,o)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,a=(e,n,t)=>new Promise(((o,s)=>{var i=e=>{try{a(t.next(e))}catch(n){s(n)}},r=e=>{try{a(t.throw(e))}catch(n){s(n)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,r);a((t=t.apply(e,n)).next())}));import{B as l}from"./BasicTable.fa29c153.js";import{T as c}from"./helper.c50e6850.js";import"./TableImg.2942a3dc.js";import p from"./UserDrawer.420d084d.js";import d from"./UserRecycleBinModal.54f16044.js";import u from"./PasswordModal.725d8750.js";import m from"./UserAgentModal.7cd3692b.js";import{a1 as y,en as f,l as b,t as g,v as j,V as w,z as h,y as k,C as T,D as C,W as x,q as v,F as A,o as _,a5 as S,eo as R,h as I,x as L,B as O,ep as B,L as P,ax as M,u as E,bI as F}from"./index.b2c24a42.js";import{a as z}from"./index.5cedb984.js";import{useListPage as D}from"./useListPage.ddd6479e.js";import"./index.12c6f6d1.js";import{c as U,s as $}from"./user.data.5bfe5d1b.js";import{l as q,k as H,m as J,n as W,o as K,q as V,r as X}from"./user.api.ceae0e75.js";import"./BasicForm.fb9b9310.js";import"./uniqBy.be1d69f1.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./useForm.5a9ed278.js";import"./JAddInput.2ba637e0.js";import"./useFormItem.9110ec70.js";import"./api.e26748d3.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./index.7e26b7de.js";import"./useContentHeight.aae13605.js";import"./useContentViewHeight.879059d9.js";import"./usePageContext.174066c3.js";import"./RedoOutlined.4dd49301.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./index.be1c9e2b.js";import"./useAdaptiveWidth.1b75f0a4.js";import"./validator.b4088ecf.js";import"./renderUtils.23b0f24e.js";import"./useTable.fb0dd6ed.js";const N={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let G=null;const Q=T("同步到本地"),Y=b({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(e,{emit:n}){const t=e;function o(e){n(e.key,{type:t.type})}return(n,t)=>{const s=g("a-button"),i=g("a-menu-item"),r=g("a-menu"),a=g("a-dropdown");return e.syncToApp&&e.syncToLocal?(j(),w(a,{key:0},{overlay:h((()=>[k(r,{onClick:o},{default:h((()=>[e.syncToApp?(j(),w(i,{key:"to-app"},{default:h((()=>[T("同步到"+C(e.name),1)])),_:1})):x("",!0),e.syncToLocal?(j(),w(i,{key:"to-local"},{default:h((()=>[Q])),_:1})):x("",!0)])),_:1})])),default:h((()=>[k(s,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:h((()=>[T("同步"+C(e.name),1)])),_:1})])),_:1})):e.syncToApp?(j(),w(s,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:t[0]||(t[0]=e=>o({key:"to-app"}))},{default:h((()=>[T("同步"+C(e.name),1)])),_:1})):(j(),w(s,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:t[1]||(t[1]=e=>o({key:"to-local"}))},{default:h((()=>[T("同步"+C(e.name)+"到本地",1)])),_:1}))}}});const Z=T("未设置任何同步方向");var ee=v(b({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(e,{emit:n}){const t=e,{createMessage:o,createWarningModal:s}=E(),i=A({}),r=_((()=>({syncToApp:t.syncToApp,syncToLocal:t.syncToLocal}))),l=_((()=>({"to-app":c,"to-local":p})));function c(e){d(e.type,"/toApp")}function p(e){d(e.type,"/toLocal")}function d(e,s){let i=N[e];if(!i||!i[t.bizType])return;let r=i[t.bizType]+s,a=t.selectedRowKeys,l="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(a)&&a.length>0?l=`确定要开始同步这 ${a.length} 项吗？`:a=[],new Promise(((t,i)=>{const c=S.confirm({icon:k(R),title:"同步",content:l,onOk:()=>{c.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let i={ids:a.join(",")};return y.get({url:r,params:i},{isTransformResponse:!1}).then((e=>{let t={};e.result&&(t={width:600,title:e.message,content:()=>{let n,t=["成功信息如下：",u(I,e.result.successInfo.map(((e,n)=>`${n+1}. ${e}`)).join("\n"))];return n=e.success?[...t,I("br"),"无失败信息！"]:["失败信息如下：",u(I,e.result.failInfo.map(((e,n)=>`${n+1}. ${e}`)).join("\n")),I("br"),...t],n}}),e.success?(null!=t?S.success(t):o.warning(e.message),n("sync-ok")):(null!=t?S.warning(t):o.warning(e.message),n("sync-error"))})).catch((()=>c.destroy())).finally((()=>{t(),n("sync-finally",{type:e,direction:s,isToApp:"/toApp"===s,isToLocal:"/toLocal"===s})}))},onCancel(){t()}})}))}function u(e,n){return e("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},n)}return function(){a(this,null,(function*(){i.value=yield a(void 0,null,(function*(){if(null!=G)return f(G);{let{success:e,result:n}=yield y.get({url:N.getEnabledType},{isTransformResponse:!1});if(e)return G=f(n),n}return{}}))}))}(),(n,t)=>e.syncToApp||e.syncToLocal?(j(),L(M,{key:0},[i.value.wechatEnterprise?(j(),w(Y,O({key:0,type:"wechatEnterprise",name:"企微"},P(r),B(P(l))),null,16)):x("",!0),i.value.dingtalk?(j(),w(Y,O({key:1,type:"dingtalk",name:"钉钉"},P(r),B(P(l))),null,16)):x("",!0)],64)):(j(),L(M,{key:1},[Z],64))}}),[["__scopeId","data-v-7ecd6fe9"]]);const ne=T(" 新增"),te=T(" 导出"),oe=T("导入"),se=T(" 同步流程"),ie=T(" 回收站"),re=T(" 删除 "),ae=T(" 冻结 "),le=T(" 解冻 "),ce=T("批量操作 "),pe=b({name:"system-user"}),de=b((ue=((e,n)=>{for(var t in n||(n={}))s.call(n,t)&&r(e,t,n[t]);if(o)for(var t of o(n))i.call(n,t)&&r(e,t,n[t]);return e})({},pe),n(ue,t({setup(e){const{createMessage:n,createConfirm:t}=E(),[o,{openDrawer:s}]=z(),[i,{openModal:r}]=F(),[y,{openModal:f}]=F(),[b,{openModal:T}]=F(),{prefixCls:C,tableContext:v,onExportXls:A,onImportXls:_}=D({designScope:"user-list",tableProps:{title:"用户列表",api:q,columns:U,size:"small",formConfig:{schemas:$},actionColumn:{width:120},beforeFetch:e=>Object.assign({column:"createTime",order:"desc"},e)},exportConfig:{name:"用户列表",url:H},importConfig:{url:J}}),[S,{reload:R,updateTableDataRecord:I},{rowSelection:O,selectedRows:B,selectedRowKeys:M}]=v;function N(){s(!0,{isUpdate:!1,showFooter:!0})}function G(e){return a(this,null,(function*(){s(!0,{record:e,isUpdate:!0,showFooter:!0})}))}function Q(e){return a(this,null,(function*(){s(!0,{record:e,isUpdate:!0,showFooter:!1})}))}function Y(e){return a(this,null,(function*(){"admin"!=e.username?yield X({id:e.id},R):n.warning("管理员账号不允许此操作！")}))}function Z(){return a(this,null,(function*(){let e=P(B).filter((e=>"admin"==e.username));P(e).length>0?n.warning("管理员账号不允许此操作！"):yield W({ids:M.value},(()=>{M.value=[],R()}))}))}function pe(){R()}function de(e){f(!0,{username:e})}function ue(e){T(!0,{userName:e})}function me(e,t){return a(this,null,(function*(){"admin"!=e.username?yield K({ids:e.id,status:t},R):n.warning("管理员账号不允许此操作！")}))}function ye(e){let o=B.value.filter((e=>"admin"==e.username));P(o).length>0?n.warning("管理员账号不允许此操作！"):t({iconType:"warning",title:"确认操作",content:"是否"+(1==e?"解冻":"冻结")+"选中账号?",onOk:()=>a(this,null,(function*(){yield K({ids:P(M).join(","),status:e},R)}))})}function fe(){V()}function be({isToLocal:e}){e&&R()}function ge(e){return[{label:"编辑",onClick:G.bind(null,e)}]}function je(e){return[{label:"详情",onClick:Q.bind(null,e)},{label:"密码",onClick:de.bind(null,e.username)},{label:"删除",popConfirm:{title:"是否确认删除",confirm:Y.bind(null,e)}},{label:"冻结",ifShow:1==e.status,popConfirm:{title:"确定冻结吗?",confirm:me.bind(null,e,2)}},{label:"解冻",ifShow:2==e.status,popConfirm:{title:"确定解冻吗?",confirm:me.bind(null,e,1)}},{label:"代理人",onClick:ue.bind(null,e.username)}]}return(e,n)=>{const t=g("a-button"),s=g("j-upload-button"),a=g("Icon"),f=g("a-menu-item"),T=g("a-menu"),C=g("a-dropdown");return j(),L("div",null,[k(P(l),{onRegister:P(S),rowSelection:P(O)},{tableTitle:h((()=>[k(t,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:h((()=>[ne])),_:1}),k(t,{type:"primary",preIcon:"ant-design:export-outlined",onClick:P(A)},{default:h((()=>[te])),_:1},8,["onClick"]),k(s,{type:"primary",preIcon:"ant-design:import-outlined",onClick:P(_)},{default:h((()=>[oe])),_:1},8,["onClick"]),k(t,{type:"primary",onClick:fe,preIcon:"ant-design:sync-outlined"},{default:h((()=>[se])),_:1}),k(t,{type:"primary",onClick:n[0]||(n[0]=e=>P(r)(!0,{})),preIcon:"ant-design:hdd-outlined"},{default:h((()=>[ie])),_:1}),k(ee,{"biz-type":"user","selected-row-keys":P(M),syncToApp:"",syncToLocal:"",onSyncFinally:be},null,8,["selected-row-keys"]),P(M).length>0?(j(),w(C,{key:0},{overlay:h((()=>[k(T,null,{default:h((()=>[k(f,{key:"1",onClick:Z},{default:h((()=>[k(a,{icon:"ant-design:delete-outlined"}),re])),_:1}),k(f,{key:"2",onClick:n[1]||(n[1]=e=>ye(2))},{default:h((()=>[k(a,{icon:"ant-design:lock-outlined"}),ae])),_:1}),k(f,{key:"3",onClick:n[2]||(n[2]=e=>ye(1))},{default:h((()=>[k(a,{icon:"ant-design:unlock-outlined"}),le])),_:1})])),_:1})])),default:h((()=>[k(t,null,{default:h((()=>[ce,k(a,{icon:"mdi:chevron-down"})])),_:1})])),_:1})):x("",!0)])),action:h((({record:e})=>[k(P(c),{actions:ge(e),dropDownActions:je(e)},null,8,["actions","dropDownActions"])])),_:1},8,["onRegister","rowSelection"]),k(p,{onRegister:P(o),onSuccess:pe},null,8,["onRegister"]),k(u,{onRegister:P(y),onSuccess:P(R)},null,8,["onRegister","onSuccess"]),k(m,{onRegister:P(b),onSuccess:P(R)},null,8,["onRegister","onSuccess"]),k(d,{onRegister:P(i),onSuccess:P(R)},null,8,["onRegister","onSuccess"])])}}}))));var ue;export{de as default};
