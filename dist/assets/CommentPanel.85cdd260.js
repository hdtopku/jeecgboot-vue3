var j=(t,n,a)=>new Promise((e,u)=>{var p=c=>{try{l(a.next(c))}catch(d){u(d)}},g=c=>{try{l(a.throw(c))}catch(d){u(d)}},l=c=>c.done?e(c.value):Promise.resolve(c.value).then(p,g);l((a=a.apply(t,n)).next())});import{fo as Pe,j as je,bn as Ne,v as i,bt as He,bo as Re,cq as ne,av as ve,k as ze,C as F,a8 as Ve,Z as V,ac as Ue,a as oe,K as qe,u as Ye,c as Z,fp as ge,ff as pe,fg as ie,el as he,E as ae,q,r as v,s as I,t as x,w as h,aW as o,y as B,ax as P,bc as ce,V as N,z as U,B as X,R as E,dr as de,ds as re,aN as $,bI as We,bj as se,m as _e,N as xe,fq as Ge,O as Xe,Q as le,ea as Ze,d9 as Be,X as Je,aa as ye,ca as Qe,dz as Ke}from"./index.366dce35.js";import{u as be,U as et}from"./JAddInput.842dcc4a.js";import"./index.0d476352.js";import{j as tt}from"./api.44809d32.js";import{c as nt}from"./functional.55549b16.js";import{_ as ot}from"./JUpload.vue_vue_type_style_index_0_lang.6b9e78fc.js";var at=function(){return{actions:Array,author:ne.any,avatar:ne.any,content:ne.any,prefixCls:String,datetime:ne.any}},st=je({compatConfig:{MODE:3},name:"AComment",props:at(),slots:["actions","author","avatar","content","datetime"],setup:function(n,a){var e=a.slots,u=Ne("comment",n),p=u.prefixCls,g=u.direction,l=function(r,m){return i("div",{class:"".concat(r,"-nested")},[m])},c=function(r){if(!r||!r.length)return null;var m=r.map(function(_,C){return i("li",{key:"action-".concat(C)},[_])});return m};return function(){var d,r,m,_,C,w,s,f,y,L,D,O=p.value,M=(d=n.actions)!==null&&d!==void 0?d:(r=e.actions)===null||r===void 0?void 0:r.call(e),R=(m=n.author)!==null&&m!==void 0?m:(_=e.author)===null||_===void 0?void 0:_.call(e),z=(C=n.avatar)!==null&&C!==void 0?C:(w=e.avatar)===null||w===void 0?void 0:w.call(e),k=(s=n.content)!==null&&s!==void 0?s:(f=e.content)===null||f===void 0?void 0:f.call(e),S=(y=n.datetime)!==null&&y!==void 0?y:(L=e.datetime)===null||L===void 0?void 0:L.call(e),A=i("div",{class:"".concat(O,"-avatar")},[typeof z=="string"?i("img",{src:z,alt:"comment-avatar"},null):z]),Y=M?i("ul",{class:"".concat(O,"-actions")},[c(Array.isArray(M)?M:[M])]):null,W=i("div",{class:"".concat(O,"-content-author")},[R&&i("span",{class:"".concat(O,"-content-author-name")},[R]),S&&i("span",{class:"".concat(O,"-content-author-time")},[S])]),ue=i("div",{class:"".concat(O,"-content")},[W,i("div",{class:"".concat(O,"-content-detail")},[k]),Y]),me=i("div",{class:"".concat(O,"-inner")},[A,ue]),ee=He((D=e.default)===null||D===void 0?void 0:D.call(e));return i("div",{class:[O,Re({},"".concat(O,"-rtl"),g.value==="rtl")]},[me,ee&&ee.length?l(O,ee):null])}}});const lt=Pe(st);var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};const ct=it;function Se(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){dt(t,u,a[u])})}return t}function dt(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var Ce=function(n,a){var e=Se({},n,a.attrs);return i(ve,Se({},e,{icon:ct}),null)};Ce.displayName="MessageOutlined";Ce.inheritAttrs=!1;const rt=Ce;var ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"};const mt=ut;function Fe(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){ft(t,u,a[u])})}return t}function ft(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var Ie=function(n,a){var e=Fe({},n,a.attrs);return i(ve,Fe({},e,{icon:mt}),null)};Ie.displayName="SmileOutlined";Ie.inheritAttrs=!1;const _t=Ie;var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};const gt=vt;function Oe(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?Object(arguments[n]):{},e=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(a).filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable}))),e.forEach(function(u){pt(t,u,a[u])})}return t}function pt(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var we=function(n,a){var e=Oe({},n,a.attrs);return i(ve,Oe({},e,{icon:gt}),null)};we.displayName="UserAddOutlined";we.inheritAttrs=!1;const ht=we;const Le="/assets/excel.73e31c52.svg",yt="/assets/other.c9fbb14a.svg",bt="/assets/pdf.f8d68ae5.svg",Ct="/assets/txt.8d556a18.svg",Ae="/assets/word.9460f3fc.svg",It=ze(),wt=It.uploadUrl;let G="";const kt=()=>V.get({url:"/sys/comment/getFileViewDomain"}),xt=t=>V.get({url:"/sys/comment/listByForm",params:t}),St=t=>{let n={id:t};return V.get({url:"/sys/comment/queryById",params:n},{isTransformResponse:!1})},Ft=t=>V.get({url:"/sys/comment/fileList",params:t}),Ot=t=>V.delete({url:"/sys/comment/deleteOne",params:t},{joinParamsToUrl:!0}),Lt=t=>{let n="/sys/comment/addText";return V.post({url:n,params:t},{isTransformResponse:!1})},At=t=>V.get({url:"/sys/dataLog/queryDataVerList",params:t},{isTransformResponse:!1}),$e=`${wt}/sys/comment/addFile`;function De(t){let n={biz:"comment",commentId:""};const{createMessage:a}=Ye(),e=F(!1);function u(c,d){return j(this,null,function*(){e.value=!0,setTimeout(()=>{e.value=!1},500),yield p(c),yield l(d)})}function p(c){return j(this,null,function*(){const{fromUserId:d,toUserId:r,commentId:m,commentContent:_}=c;let C={tableName:t.tableName,tableDataId:t.dataId,fromUserId:d,commentContent:_,toUserId:"",commentId:""};r&&(C.toUserId=r),m&&(C.commentId=m),n.commentId="";const w=yield Lt(C);if(w.success)n.commentId=w.result;else return a.warning(w.message),Promise.reject("\u4FDD\u5B58\u8BC4\u8BBA\u5931\u8D25")})}function g(c){return j(this,null,function*(){let d=$e;const r=new FormData;return r.append("file",c),r.append("tableName",t.tableName),r.append("tableDataId",t.dataId),Object.keys(n).map(m=>{r.append(m,n[m])}),new Promise((m,_)=>{tt(d,r).then(C=>{console.log("uploadMyFile",C),C&&C.data?C.data.result=="success"?m(1):(a.warning(C.data.message),_()):_()})})})}function l(c){return j(this,null,function*(){if(c&&c.length>0)for(let d=0;d<c.length;d++){let r=Ue(c[d]);yield g(r.originFileObj)}})}return{saveCommentAndFiles:u,buttonLoading:e}}function ke(){const t=Ve({}),n={xls:Le,xlsx:Le,pdf:bt,txt:Ct,docx:Ae,doc:Ae};function a(s){if(console.log("\u83B7\u53D6\u6587\u4EF6\u80CC\u666F\u56FE",s),r(s))return"none";{const f=s.name;if(!f)return"none";const y=f.substring(f.lastIndexOf(".")+1);console.log("suffix",y);let L=n[y];return L||(L=yt),L}}function e(s,f){return new Promise((y,L)=>{let D=new FileReader;s?(D.readAsDataURL(s),D.onload=function(){let O=D.result;console.log("base",O),t[f]=O,console.log("imageSrcMap",t),y(O)}):L()})}function u(s){if(r(s)){let f=s.uid;e(s,f)}}function p(s){let f=oe(s.url);f&&window.open(f)}function g(s){let f=s.fileSize;return f?Math.round(f/1024)+" KB":"0B"}const l=F([]);function c(s){return u(s),l.value=[...l.value,s],console.log("selectFileList",qe(l)),!1}function d(s){const f=l.value.indexOf(s),y=l.value.slice();y.splice(f,1),l.value=y}function r(s){return(s.type||"").indexOf("image")>=0}function m(s){if(r(s)){let f=s.uid;if(f){if(t[f])return t[f]}else if(s.url)return oe(s.url)}return""}function _(s){let f=m(s);return f?{backgroundImage:"url('"+f+"')"}:{}}function C(s){return j(this,null,function*(){if(r(s)){let f=m(s);f&&nt({imageList:[f]})}else if(s.url){let f=oe(s.url);yield w(),window.open(G+"?officePreviewType=pdf&url="+encodeURIComponent(f))}})}function w(){return j(this,null,function*(){G||(G=yield kt()),G.startsWith("http")||(G="http://"+G)})}return{selectFileList:l,getBackground:a,getFileSize:g,downLoad:p,beforeUpload:c,handleRemove:d,isImage:r,getImageSrc:m,getImageAsBackground:_,viewImage:C}}function Te(t){const n=new RegExp("([^:]+)?(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)","g");function a(p){return p?p.replace(n,function(g,l,c){const d=l||"";if(e(d,'alt="')||e(d,'data-text="'))return g;let r=t.findEmoji(c);return r?d+u(r):g}):""}function e(p,g){return p.endsWith(g)}function u(p){return`<span style="width: 24px" class="emoji-mart-emoji"><span class="my-emoji-icon emoji-set-apple emoji-type-image" style="${`position: absolute;top: -3px;left: 3px;width: 18px; height: 18px;background-position: ${p.getPosition()}`}"> </span> </span>`}return{globalEmojiIndex:t,getHtml:a}}function jt(){return window.innerHeight}const Ut={name:"UploadChunk",components:{Tooltip:Z,UploadOutlined:be,FolderOutlined:ge,DownloadOutlined:pe,PaperClipOutlined:ie,DeleteOutlined:he},props:{visible:{type:Boolean,default:!1}},emits:["select"],setup(t,{emit:n}){const{selectFileList:a,beforeUpload:e,handleRemove:u,getBackground:p,isImage:g,getImageSrc:l,viewImage:c}=ke();function d(){let m=Ue(a.value);return console.log(m),m}function r(){a.value=[]}return ae(()=>a.value,m=>{if(m&&m.length>0){let _=m[0].name;_&&n("select",_)}}),{selectFileList:a,beforeUpload:e,handleRemove:u,getBackground:p,getUploadFileList:d,clear:r,isImage:g,getImageSrc:l,viewImage:c}}};const J=t=>(de("data-v-bcc0a033"),t=t(),re(),t),Bt={key:0},$t={class:"j-icon"},Dt={class:"inner-button"},Tt={class:"j-icon"},Mt={class:"inner-button"},Et={key:0,class:"selected-file-warp"},Pt={class:"selected-file-list"},Nt={class:"item"},Ht={class:"complex"},Rt={class:"content"},zt={key:0,class:"content-top",style:{height:"100%"}},Vt={class:"content-top"},qt=["title"],Yt=["onClick"],Wt={class:"text"},Gt={class:"buttons"},Xt={class:"opt-icon"},Zt=J(()=>o("div",{class:"item empty"},null,-1)),Jt=J(()=>o("div",{class:"item empty"},null,-1)),Qt=J(()=>o("div",{class:"item empty"},null,-1)),Kt=J(()=>o("div",{class:"item empty"},null,-1)),en=J(()=>o("div",{class:"item empty"},null,-1)),tn=J(()=>o("div",{class:"item empty"},null,-1));function nn(t,n,a,e,u,p){const g=v("upload-outlined"),l=v("a-upload"),c=v("folder-outlined"),d=v("a-alert"),r=v("delete-outlined"),m=v("Tooltip");return a.visible?(I(),x("div",Bt,[i(d,{type:"info",class:"jeecg-comment-files",style:{margin:"0"}},{message:h(()=>[o("span",$t,[i(l,{multiple:"","file-list":e.selectFileList,"onUpdate:file-list":n[0]||(n[0]=_=>e.selectFileList=_),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[o("span",Dt,[i(g),B("\u4E0A\u4F20")])]),_:1},8,["file-list","before-upload"])]),o("span",Tt,[o("span",Mt,[i(c),B("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?")])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(I(),x("div",Et,[o("div",Pt,[(I(!0),x(P,null,ce(e.selectFileList,_=>(I(),x("div",Nt,[o("div",Ht,[o("div",Rt,[e.isImage(_)?(I(),x("div",zt,[o("div",{class:"content-image",style:N({height:"100%",backgroundImage:"url("+e.getImageSrc(_)+")"})},null,4)])):(I(),x(P,{key:1},[o("div",Vt,[o("div",{class:"content-icon",style:N({background:"url("+e.getBackground(_)+")  no-repeat"})},null,4)]),o("div",{class:"content-bottom",title:_.name},[o("span",null,U(_.name),1)],8,qt)],64))]),o("div",{class:X(["layer",{"layer-image":e.isImage(_)}])},[o("div",{class:"next",onClick:C=>e.viewImage(_)},[o("div",Wt,U(_.name),1)],8,Yt),o("div",Gt,[o("div",Xt,[i(m,{title:"\u5220\u9664"},{default:h(()=>[i(r,{onClick:C=>e.handleRemove(_)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),Zt,Jt,Qt,B(),Kt,en,tn])])):E("",!0)])):E("",!0)}const on=q(Ut,[["render",nn],["__scopeId","data-v-bcc0a033"]]);const an={categories:{recent:"\u6700\u5E38\u7528\u7684",smileys:"\u8868\u60C5\u9009\u62E9",people:"\u4EBA\u7269&\u8EAB\u4F53",nature:"\u52A8\u7269&\u81EA\u7136",foods:"\u98DF\u7269&\u996E\u6599",activity:"\u6D3B\u52A8",places:"\u65C5\u884C&\u5730\u70B9",objects:"\u7269\u54C1",symbols:"\u7B26\u53F7",flags:"\u65D7\u5E1C"}},sn={name:"MyComment",components:{UserAddOutlined:ht,Tooltip:Z,UserSelectModal:et,PaperClipOutlined:ie,UploadChunk:on,SmileOutlined:_t},props:{inner:$.bool.def(!1),inputFocus:{type:Boolean,default:!1}},emits:["cancel","comment"],setup(t,{emit:n}){const a=F(!1),e=F(),[u,{openModal:p}]=We(),g=F(!1),l=F("");function c(){console.log(l.value);let b=l.value;if(!b&&b!=="0")d.value=!0;else{g.value=!0;let T=[];a.value==!0&&(T=e.value.getUploadFileList()),n("comment",b,T),setTimeout(()=>{g.value=!1},350)}}const d=F(!1);ae(l,()=>{let b=l.value;!b&&b!=="0"?d.value=!0:d.value=!1});function r(){n("cancel")}const m=F();ae(()=>t.inputFocus,b=>{b==!0&&(l.value="",a.value==!0&&(e.value.clear(),a.value=!1))},{deep:!0,immediate:!0});function _(){p(!0,{isUpdate:!1})}function C(b){if(console.log("setValue",b),b&&b.length>0){const{label:T,value:H}=b[0];if(T&&H){let fe=`${T}[${H}]`,te=l.value;te?te.endsWith("@")?l.value=te+fe:l.value="@"+fe+" "+te:l.value="@"+fe}}}function w(){}ae(()=>l.value,b=>{b&&b.endsWith("@")&&_()});const s=F();function f(b){let T=l.value||"";T+=b,l.value=T,s.value.click()}const y=F(!1);function L(b){let T=l.value||"",H=b.colons;H.indexOf("::")>0&&(H=H.substring(0,H.indexOf(":")+1)),l.value=T+H,y.value=!1,Y()}const D={width:"490px"};function O(b){console.log("handleClickBlank"),b.preventDefault(),b.stopPropagation(),y.value=!1,W.value=!0}function M(b){console.log("handleShowEmoji"),b.preventDefault(),b.stopPropagation(),y.value=!y.value}const R=se("$globalEmojiIndex"),{getHtml:z}=Te(R),k=_e(()=>{let b=l.value;return b?z(b):"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"}),S=F(!1);function A(b){b.preventDefault(),b.stopPropagation(),S.value=!1,m.value.focus(),console.log(234),W.value=!0}function Y(){S.value=!0}const W=F(!1),ue=_e(()=>!(l.value.length>0));function me(){l.value.length==0&&(W.value=!1,a.value=!1)}function ee(b){l.value.length==0&&(l.value=b)}return{myComment:l,sendComment:c,noComment:r,disabledButton:d,buttonLoading:g,commentRef:m,registerModal:u,openSelectUser:_,setValue:C,handleCommentChange:w,uploadRef:e,uploadVisible:a,onSelectEmoji:f,optionsName:an,emojiButton:s,emojiIndex:R,showEmoji:L,pickerStyles:D,visibleEmoji:y,handleClickBlank:O,handleShowEmoji:M,commentHtml:k,showHtml:S,handleClickHtmlShower:A,handleBlur:Y,commentActive:W,noConent:ue,changeActive:me,selectFirstFile:ee}}};const ln=["innerHTML"],cn={key:0,class:"comment-buttons"},dn={style:{cursor:"pointer"}},rn={title:"\u8868\u60C5",style:{display:"inline-block"}},un={style:{position:"relative"}},mn={key:0},fn=o("span",null,null,-1);function _n(t,n,a,e,u,p){const g=v("user-add-outlined"),l=v("Tooltip"),c=v("PaperClipOutlined"),d=v("SmileOutlined"),r=v("a-button"),m=v("upload-chunk"),_=v("UserSelectModal"),C=v("Picker"),w=v("a-modal");return I(),x(P,null,[o("div",{class:X({"comment-active":e.commentActive}),style:{border:"1px solid #eee",margin:"0",position:"relative"},onClick:n[5]||(n[5]=(...s)=>e.handleClickBlank&&e.handleClickBlank(...s))},[xe(o("textarea",{ref:"commentRef","onUpdate:modelValue":n[0]||(n[0]=s=>e.myComment=s),onInput:n[1]||(n[1]=(...s)=>e.handleCommentChange&&e.handleCommentChange(...s)),onBlur:n[2]||(n[2]=(...s)=>e.handleBlur&&e.handleBlur(...s)),class:"comment-content",rows:3,placeholder:"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"},null,544),[[Ge,e.myComment]]),o("div",{class:X(["comment-content comment-html-shower",{"no-content":e.noConent,"top-div":e.showHtml,"bottom-div":e.showHtml==!1}]),innerHTML:e.commentHtml,onClick:n[3]||(n[3]=(...s)=>e.handleClickHtmlShower&&e.handleClickHtmlShower(...s))},null,10,ln),e.commentActive?(I(),x("div",cn,[o("div",dn,[i(l,{title:"\u9009\u62E9@\u7528\u6237"},{default:h(()=>[i(g,{onClick:e.openSelectUser},null,8,["onClick"])]),_:1}),i(l,{title:"\u4E0A\u4F20\u9644\u4EF6"},{default:h(()=>[i(c,{onClick:n[4]||(n[4]=s=>e.uploadVisible=!e.uploadVisible)})]),_:1}),o("span",rn,[i(d,{ref:"emojiButton",onClick:e.handleShowEmoji},null,8,["onClick"]),xe(o("div",un,null,512),[[Xe]])])]),e.commentActive?(I(),x("div",mn,[a.inner?(I(),le(r,{key:0,onClick:e.noComment,style:{"margin-right":"10px"}},{default:h(()=>[B("\u53D6\u6D88")]),_:1},8,["onClick"])):E("",!0),i(r,{type:"primary",onClick:e.sendComment,loading:e.buttonLoading,disabled:e.disabledButton},{default:h(()=>[B("\u53D1 \u9001")]),_:1},8,["onClick","loading","disabled"])])):E("",!0)])):E("",!0),i(m,{ref:"uploadRef",visible:e.uploadVisible,onSelect:e.selectFirstFile},null,8,["visible","onSelect"])],2),i(_,{labelKey:"realname",rowKey:"username",onRegister:e.registerModal,onGetSelectResult:e.setValue,isRadioSelection:""},null,8,["onRegister","onGetSelectResult"]),i(w,{visible:e.visibleEmoji,"onUpdate:visible":n[6]||(n[6]=s=>e.visibleEmoji=s),footer:null,wrapClassName:"emoji-modal",closable:!1,width:490},{title:h(()=>[fn]),default:h(()=>[i(C,{pickerStyles:e.pickerStyles,i18n:e.optionsName,data:e.emojiIndex,emoji:"grinning",showPreview:!1,infiniteScroll:!1,showSearch:!1,showSkinTones:!1,set:"apple",onSelect:e.showEmoji},null,8,["pickerStyles","i18n","data","onSelect"])]),_:1},8,["visible"])],64)}const vn=q(sn,[["render",_n]]);const gn={name:"HistoryFileList",props:{dataList:{type:Array,default:()=>[]},isComment:{type:Boolean,default:!1}},components:{UploadOutlined:be,FolderOutlined:ge,DownloadOutlined:pe,PaperClipOutlined:ie,DeleteOutlined:he,Tooltip:Z},setup(){const{getBackground:t,getFileSize:n,downLoad:a,isImage:e,getImageAsBackground:u,viewImage:p}=ke();return{getBackground:t,downLoad:a,getFileSize:n,isImage:e,getImageAsBackground:u,viewImage:p}}},Q=t=>(de("data-v-aedc2293"),t=t(),re(),t),pn={class:"selected-file-list"},hn={class:"item"},yn={class:"complex"},bn={class:"content"},Cn={key:0,class:"content-top",style:{height:"100%"}},In={class:"content-top"},wn=["title"],kn=["onClick"],xn={class:"text"},Sn={class:"text"},Fn={class:"buttons"},On={class:"opt-icon"},Ln=Q(()=>o("div",{class:"item empty"},null,-1)),An=Q(()=>o("div",{class:"item empty"},null,-1)),jn=Q(()=>o("div",{class:"item empty"},null,-1)),Un=Q(()=>o("div",{class:"item empty"},null,-1)),Bn=Q(()=>o("div",{class:"item empty"},null,-1)),$n=Q(()=>o("div",{class:"item empty"},null,-1));function Dn(t,n,a,e,u,p){const g=v("download-outlined"),l=v("Tooltip");return I(),x("div",{class:X(["comment-file-his-list",a.isComment===!0?"in-comment":""])},[o("div",pn,[(I(!0),x(P,null,ce(a.dataList,c=>(I(),x("div",hn,[o("div",yn,[o("div",bn,[e.isImage(c)?(I(),x("div",Cn,[o("div",{class:"content-image",style:N(e.getImageAsBackground(c))},null,4)])):(I(),x(P,{key:1},[o("div",In,[o("div",{class:"content-icon",style:N({background:"url("+e.getBackground(c)+")  no-repeat"})},null,4)]),o("div",{class:"content-bottom",title:c.name},[o("span",null,U(c.name),1)],8,wn)],64))]),o("div",{class:X(["layer",{"layer-image":e.isImage(c)}])},[o("div",{class:"next",onClick:d=>e.viewImage(c)},[o("div",xn,U(c.name),1),o("div",Sn,U(e.getFileSize(c)),1)],8,kn),o("div",Fn,[o("div",On,[i(l,{title:"\u4E0B\u8F7D"},{default:h(()=>[i(g,{onClick:d=>e.downLoad(c)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),Ln,An,jn,B(),Un,Bn,$n])],2)}const Me=q(gn,[["render",Dn],["__scopeId","data-v-aedc2293"]]);const Tn=je({name:"CommentList",components:{MessageOutlined:rt,AComment:lt,Tooltip:Z,MyComment:vn,Popconfirm:Ze,HistoryFileList:Me},props:{tableName:$.string.def(""),dataId:$.string.def(""),datetime:$.number.def(1)},setup(t){const n=F([]),{userInfo:a}=Be(),e=se("$dayjs");function u(){return a.realname?a.realname.substr(0,2):""}function p(){return a.avatar}function g(k){return k.fromUserAvatar?oe(k.fromUserAvatar):""}function l(k){return k.fromUserId_dictText?k.fromUserId_dictText.substr(0,2):"\u672A\u77E5"}function c(k){return k.toUser?k.fromUserId_dictText+" \u56DE\u590D "+k.fromUserId_dictText:k.fromUserId_dictText}function d(k){return k.createTime?e(k.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}const r=F(300),m=F(300);Je(()=>{r.value=window.innerHeight-57-46-70-160,m.value=window.innerHeight-57-46-53-20});function _(){return j(this,null,function*(){const k={tableName:t.tableName,tableDataId:t.dataId,column:"createTime",order:"desc"},S=yield xt(k);if(!S||!S.records||S.records.length==0)n.value=[];else{let A=S.records;console.log(123,A),n.value=A}})}const{saveCommentAndFiles:C}=De(t);function w(k,S,A){return j(this,null,function*(){console.log(S,k);let Y={fromUserId:a.id,toUserId:k.fromUserId,commentId:k.id,commentContent:S};yield C(Y,A),yield _()})}function s(k,S){return j(this,null,function*(){let A={fromUserId:a.id,commentContent:k};yield C(A,S),yield _(),y.value=!1,setTimeout(()=>{y.value=!0},100)})}function f(k){return j(this,null,function*(){const S={id:k.id};yield Ot(S),yield _()})}const y=F(!1);function L(k){let S=n.value;for(let A of S)A.commentStatus=!1;k.commentStatus=!0,y.value=!1,y.value=!0}ye(()=>{t.datetime&&t.tableName&&t.dataId&&_()});const D=se("$globalEmojiIndex"),{getHtml:O}=Te(D),M=F();function R(){M.value.changeActive()}function z(k,S){return j(this,null,function*(){if(k==!0&&!S.commentId_dictText){const A=yield St(S.commentId);A.success==!0?S.commentId_dictText=A.result.commentContent:(console.error(A.message),S.commentId_dictText="\u8BE5\u8BC4\u8BBA\u5DF2\u88AB\u5220\u9664")}})}return{dataList:n,getAvatar:g,getAvatarText:l,getAuthor:c,getDateDiff:d,commentHeight:r,allHeight:m,replyComment:w,sendComment:s,getMyname:u,getMyAvatar:p,focusStatus:y,showReply:L,deleteComment:f,getHtml:O,handleClickItem:R,bottomCommentRef:M,visibleChange:z}}}),Ee=t=>(de("data-v-7a68604d"),t=t(),re(),t),Mn={class:"comment-author"},En=Ee(()=>o("span",null,"\u56DE\u590D",-1)),Pn=["innerHTML"],Nn=["onClick"],Hn=Ee(()=>o("span",null,"\u5220\u9664",-1)),Rn=["innerHTML"],zn={key:0},Vn={key:0,class:"inner-comment"},qn={style:{position:"absolute",bottom:"0",left:"0",width:"100%",background:"#fff","border-top":"1px solid #eee"}};function Yn(t,n,a,e,u,p){const g=v("a-avatar"),l=v("message-outlined"),c=v("Tooltip"),d=v("Popconfirm"),r=v("history-file-list"),m=v("a-comment"),_=v("my-comment"),C=v("a-list-item"),w=v("a-list");return I(),x("div",{style:N({position:"relative",height:t.allHeight+"px"})},[i(w,{class:"jeecg-comment-list",header:"","item-layout":"horizontal","data-source":t.dataList,style:N({height:t.commentHeight+"px"})},{renderItem:h(({item:s})=>[i(C,{style:{"padding-left":"10px","flex-direction":"column"},onClick:t.handleClickItem},{default:h(()=>[i(m,null,{avatar:h(()=>[i(g,{class:"tx",src:t.getAvatar(s),alt:t.getAvatarText(s)},{default:h(()=>[B(U(t.getAvatarText(s)),1)]),_:2},1032,["src","alt"])]),author:h(()=>[o("div",Mn,[o("span",null,U(s.fromUserId_dictText),1),s.toUserId?(I(),x(P,{key:0},[En,o("span",null,U(s.toUserId_dictText),1),i(c,{class:"comment-last-content",onVisibleChange:f=>t.visibleChange(f,s)},{title:h(()=>[o("div",{innerHTML:t.getHtml(s.commentId_dictText)},null,8,Pn)]),default:h(()=>[i(l)]),_:2},1032,["onVisibleChange"])],64)):E("",!0)])]),datetime:h(()=>[o("div",null,[i(c,{title:s.createTime},{default:h(()=>[o("span",null,U(t.getDateDiff(s)),1)]),_:2},1032,["title"])])]),actions:h(()=>[o("span",{onClick:f=>t.showReply(s)},"\u56DE\u590D",8,Nn),i(d,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:f=>t.deleteComment(s)},{default:h(()=>[Hn]),_:2},1032,["onConfirm"])]),content:h(()=>[o("div",{innerHTML:t.getHtml(s.commentContent),style:{"font-size":"15px"}},null,8,Rn),s.fileList&&s.fileList.length>0?(I(),x("div",zn,[i(r,{dataList:s.fileList,isComment:""},null,8,["dataList"])])):E("",!0)]),_:2},1024),s.commentStatus?(I(),x("div",Vn,[i(_,{inner:"",onCancel:f=>s.commentStatus=!1,onComment:(f,y)=>t.replyComment(s,f,y),inputFocus:t.focusStatus},null,8,["onCancel","onComment","inputFocus"])])):E("",!0)]),_:2},1032,["onClick"])]),_:1},8,["data-source","style"]),o("div",qn,[i(m,{style:{margin:"0 10px"}},{avatar:h(()=>[i(g,{class:"tx",src:t.getMyAvatar(),alt:t.getMyname()},{default:h(()=>[B(U(t.getMyname()),1)]),_:1},8,["src","alt"])]),content:h(()=>[i(_,{ref:"bottomCommentRef",onComment:t.sendComment,inputFocus:t.focusStatus},null,8,["onComment","inputFocus"])]),_:1})])],4)}const Wn=q(Tn,[["render",Yn],["__scopeId","data-v-7a68604d"]]);const Gn={name:"CommentFiles",components:{UploadOutlined:be,FolderOutlined:ge,JUpload:ot,DownloadOutlined:pe,PaperClipOutlined:ie,DeleteOutlined:he,Tooltip:Z,HistoryFileList:Me},props:{tableName:$.string.def(""),dataId:$.string.def(""),datetime:$.number.def(1)},setup(t){const{userInfo:n}=Be(),a=F([]),e=F("");function u(){return j(this,null,function*(){const f={tableName:t.tableName,tableDataId:t.dataId},y=yield Ft(f);if(console.log("1111",y),!y||!y.records||y.records.length==0)a.value=[];else{let L=y.records;console.log(123,L),a.value=L}e.value=""})}ye(()=>{t.datetime&&t.tableName&&t.dataId&&u()});const{saveCommentAndFiles:p,buttonLoading:g}=De(t),{selectFileList:l,beforeUpload:c,handleRemove:d,getBackground:r,isImage:m,getImageAsBackground:_,viewImage:C}=ke();function w(){l.value=[]}function s(){return j(this,null,function*(){let f={fromUserId:n.id,commentContent:"\u4E0A\u4F20\u4E86\u9644\u4EF6"};yield p(f,l.value),l.value=[],yield u()})}return{selectFileList:l,beforeUpload:c,handleRemove:d,getBackground:r,isImage:m,dataList:a,uploadFileUrl:$e,quxiao:w,queding:s,buttonLoading:g,getImageAsBackground:_,viewImage:C}}},K=t=>(de("data-v-2dfba4e7"),t=t(),re(),t),Xn={class:"j-icon"},Zn={class:"inner-button"},Jn={class:"j-icon"},Qn={class:"inner-button"},Kn={key:0,class:"selected-file-warp"},eo={class:"selected-file-list"},to={class:"item"},no={class:"complex"},oo={class:"content"},ao={key:0,class:"content-top",style:{height:"100%"}},so={class:"content-top"},lo=["title"],io=["onClick"],co={class:"text"},ro={class:"buttons"},uo={class:"opt-icon"},mo=K(()=>o("div",{class:"item empty"},null,-1)),fo=K(()=>o("div",{class:"item empty"},null,-1)),_o=K(()=>o("div",{class:"item empty"},null,-1)),vo=K(()=>o("div",{class:"item empty"},null,-1)),go=K(()=>o("div",{class:"item empty"},null,-1)),po=K(()=>o("div",{class:"item empty"},null,-1)),ho={style:{"margin-bottom":"24px","margin-top":"18px","text-align":"right"}};function yo(t,n,a,e,u,p){const g=v("upload-outlined"),l=v("a-upload"),c=v("folder-outlined"),d=v("a-alert"),r=v("delete-outlined"),m=v("Tooltip"),_=v("a-button"),C=v("history-file-list");return I(),x("div",null,[i(d,{type:"info",class:"jeecg-comment-files"},{message:h(()=>[o("span",Xn,[i(l,{multiple:"","file-list":e.selectFileList,"onUpdate:file-list":n[0]||(n[0]=w=>e.selectFileList=w),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[o("span",Zn,[i(g),B("\u4E0A\u4F20")])]),_:1},8,["file-list","before-upload"])]),o("span",Jn,[o("span",Qn,[i(c),B("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?")])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(I(),x("div",Kn,[o("div",eo,[(I(!0),x(P,null,ce(e.selectFileList,w=>(I(),x("div",to,[o("div",no,[o("div",oo,[e.isImage(w)?(I(),x("div",ao,[o("div",{class:"content-image",style:N(e.getImageAsBackground(w))},null,4)])):(I(),x(P,{key:1},[o("div",so,[o("div",{class:"content-icon",style:N({background:"url("+e.getBackground(w)+")  no-repeat"})},null,4)]),o("div",{class:"content-bottom",title:w.name},[o("span",null,U(w.name),1)],8,lo)],64))]),o("div",{class:X(["layer",{"layer-image":e.isImage(w)}])},[o("div",{class:"next",onClick:s=>e.viewImage(w)},[o("div",co,U(w.name),1)],8,io),o("div",ro,[o("div",uo,[i(m,{title:"\u5220\u9664"},{default:h(()=>[i(r,{onClick:s=>e.handleRemove(w)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),mo,fo,_o,B(),vo,go,po]),o("div",ho,[i(_,{onClick:e.quxiao},{default:h(()=>[B("\u53D6\u6D88")]),_:1},8,["onClick"]),i(_,{type:"primary",style:{"margin-left":"10px"},onClick:e.queding,loading:e.buttonLoading},{default:h(()=>[B("\u786E\u5B9A")]),_:1},8,["onClick","loading"])])])):E("",!0),i(C,{dataList:e.dataList},null,8,["dataList"])])}const bo=q(Gn,[["render",yo],["__scopeId","data-v-2dfba4e7"]]);const Co={name:"DataLogList",components:{PlusOutlined:Qe,EditOutlined:Ke,Tooltip:Z},props:{tableName:$.string.def(""),dataId:$.string.def(""),datetime:$.number.def(1)},setup(t){const n=se("$dayjs"),a=jt(),e=F(300);e.value=a-46-57-53-30;const u=F([]),p=F(0);function g(){return j(this,null,function*(){const d={dataTable:t.tableName,dataId:t.dataId,type:"comment"},r=yield At(d);if(!r||!r.result||r.result.length==0)u.value=[],p.value=-1;else{let m=r.result;p.value=m.length-1,console.log("log-list",m),u.value=m}})}ye(()=>{t.datetime&&t.tableName&&t.dataId&&(console.log(t.tableName,t.dataId),g())});function l(d){return d.createTime?n(d.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}function c(){console.log("\u6B64\u529F\u80FD\u672A\u5F00\u653E")}return{height:e,lastIndex:p,dataList:u,getDateDiff:l,handleClickPerson:c}}},Io={class:"data-log-content"},wo={class:"logbox"},ko={class:"log-item"},xo={class:"log-item-icon"},So={class:"log-item-content"},Fo={class:"log-item-date"};function Oo(t,n,a,e,u,p){const g=v("plus-outlined"),l=v("edit-outlined"),c=v("Tooltip");return I(),x("div",{class:"data-log-scroll",style:N({height:e.height+"px"})},[o("div",Io,[o("div",wo,[(I(!0),x(P,null,ce(e.dataList,(d,r)=>(I(),x("div",ko,[o("span",xo,[e.lastIndex==r?(I(),le(g,{key:0,style:{"margin-top":"3px"}})):(I(),le(l,{key:1}))]),o("span",So,[o("a",{onClick:n[0]||(n[0]=(...m)=>e.handleClickPerson&&e.handleClickPerson(...m))},"@"+U(d.createBy),1),B(" "+U(d.dataContent),1)]),o("div",Fo,[i(c,{title:d.createTime},{default:h(()=>[o("span",null,U(e.getDateDiff(d)),1)]),_:2},1032,["title"])])]))),256))])])],4)}const Lo=q(Co,[["render",Oo],["__scopeId","data-v-fc975465"]]);const Ao={name:"CommentPanel",components:{CommentList:Wn,CommentFiles:bo,DataLogList:Lo},props:{tableName:$.string.def(""),dataId:$.string.def("")},setup(t){const n=_e(()=>!!(t.dataId&&t.tableName)),a=F(1),e=F(1),u=F(1);function p(l){let c=new Date().getTime();l=="comment"?a.value=c:l=="file"?e.value=c:u.value=c}function g(){let l=new Date().getTime();a.value=l,e.value=l,u.value=l}return{showStatus:n,handleChange:p,datetime1:a,datetime2:e,datetime3:u,reload:g}}},jo={key:0,class:"comment-tabs-warp"};function Uo(t,n,a,e,u,p){const g=v("comment-list"),l=v("a-tab-pane"),c=v("comment-files"),d=v("data-log-list"),r=v("a-tabs"),m=v("a-empty");return e.showStatus?(I(),x("div",jo,[i(r,{onChange:e.handleChange,animated:!1},{default:h(()=>[i(l,{tab:"\u8BC4\u8BBA",key:"comment",class:"comment-list-tab"},{default:h(()=>[i(g,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime1},null,8,["tableName","dataId","datetime"])]),_:1}),i(l,{tab:"\u6587\u4EF6",key:"file"},{default:h(()=>[i(c,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime2},null,8,["tableName","dataId","datetime"])]),_:1}),i(l,{tab:"\u65E5\u5FD7",key:"log"},{default:h(()=>[i(d,{tableName:a.tableName,dataId:a.dataId,datetime:e.datetime3},null,8,["tableName","dataId","datetime"])]),_:1})]),_:1},8,["onChange"])])):(I(),le(m,{key:1,description:"\u65B0\u589E\u9875\u9762\u4E0D\u652F\u6301\u8BC4\u8BBA"}))}const No=q(Ao,[["render",Uo],["__scopeId","data-v-2b78a147"]]);export{No as C};
