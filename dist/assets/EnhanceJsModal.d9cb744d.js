import{B as e}from"./index.ee0a0c33.js";import"./BasicForm.79466d99.js";import"./helper.ec3e26f3.js";import{l as a,F as t,a8 as n,bH as o,bI as s,f0 as i,t as l,v as r,V as u,z as c,y as d,C as m,W as p,u as f}from"./index.b3c93d64.js";import{k as h}from"./JAddInput.c8a1b05b.js";import{u as g}from"./useOnlineTest.06579696.js";import{E as v,u as y}from"./EnhanceJsHistory.0448dbe1.js";import{s as j,g as b}from"./enhance.api.a8ade277.js";import"./BasicModal.2a8ad889.js";import"./useWindowSizeFn.e6386ae5.js";import"./uniqBy.30d2558a.js";import"./useFormItem.d029403d.js";import"./functional.3bb51b91.js";import"./download.261c8978.js";import"./base64Conver.030fa32c.js";import"./index.d2e70b0d.js";import"./index.17ec2e33.js";import"./useCountdown.cb4ad478.js";import"./JUpload.6bcc6fce.js";import"./api.dced5d87.js";import"./index.ef2039b9.js";import"./props.a4f5d1ca.js";import"./index.c4683457.js";import"./bem.3d3e77ca.js";import"./props.c13d8268.js";import"./useContextMenu.de287960.js";import"./index.9bbe419b.js";import"./onMountedOrActivated.d3784e6c.js";import"./index.36d6c198.js";import"./htmlmixed.ba3cd961.js";import"./vue.8c416d71.js";/* empty css             */import"./depart.api.429e062c.js";var C=(e,a,t)=>new Promise(((n,o)=>{var s=e=>{try{l(t.next(e))}catch(a){o(a)}},i=e=>{try{l(t.throw(e))}catch(a){o(a)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,i);l((t=t.apply(e,a)).next())}));var J=i(a({name:"EnhanceJs",components:{BasicModal:e,JCodeEditor:h,EnhanceJsHistory:v},emits:["register"],setup(){const{createMessage:e}=f(),a=y(),i=t(),l=t(),r=n({form:{},list:{}}),u=t("list"),c=t(""),d=t(!1),m=t(!1),p=t(""),h=n({form:"",list:""}),v={form:!1,list:!1},J=t(!1),[E,{closeModal:x}]=o((e=>C(this,null,(function*(){!function(e){c.value=e.id,m.value=!1,p.value=e.tableName;let t=a.getEnhanceJs(c.value);(null==t?void 0:t.length)>0?(u.value=t[t.length-1].type,d.value=!0):d.value=!1;v.form=!1,v.list=!1,u.value?R(u.value):R("form");J.value=!0,setTimeout((()=>J.value=!1),150)}(e.row)})))),[T,k]=s(),{aiTestMode:M,genEnhanceJsData:w}=g();function H(e){return C(this,null,(function*(){let t=r[e],n={cgJs:h[e],cgJsType:e};if(!v[e]||t.cgJs===n.cgJs)return;let o=!!t.id;o&&(n=Object.assign({},t,n)),yield j(c.value,n,o),a.addEnhanceJs({code:c.value,str:n.cgJs,type:n.cgJsType,date:(new Date).getTime()})}))}function R(e){return C(this,null,(function*(){u.value=e;try{if(!v[e]){let a=yield b(c.value,e);Object.assign(r[e],{id:null},a),h[e]=r[e].cgJs,v[e]=!0}}catch(a){}setTimeout((()=>{"list"==e?l.value.refresh():i.value.refresh()}),150)}))}return{formEditorRef:i,listEditorRef:l,reloading:J,enhanceValues:h,enhanceType:u,showHistory:d,aiTestMode:M,tableName:p,genEnhanceJsData:w,onGenTestData:function(){"form"===u.value?w(p.value,u.value,i.value):w(p.value,u.value,l.value)},onChangeType:R,onCodeChange:function(e){h[u.value]!=e&&(m.value=!0,h[u.value]=e)},onShowHistory:function(){k.openModal(!0,{code:c.value,type:u.value})},onSubmit:function(){return C(this,null,(function*(){yield Promise.all([H("form"),H("list")]),x(),e.success("保存成功")}))},onCancel:function(){x()},registerModal:E,registerEnhanceJsHistory:T}}}),[["render",function(e,a,t,n,o,s){const i=l("JCodeEditor"),f=l("a-tab-pane"),h=l("a-tabs"),g=l("a-button"),v=l("a-space"),y=l("EnhanceJsHistory"),j=l("BasicModal");return r(),u(j,{onRegister:e.registerModal,title:"JS增强",width:800,bodyStyle:{height:"360px"}},{footer:c((()=>[d(v,null,{default:c((()=>[d(g,{onClick:e.onCancel},{default:c((()=>[m("关闭")])),_:1},8,["onClick"]),d(g,{type:"primary",onClick:e.onSubmit},{default:c((()=>[m("确定")])),_:1},8,["onClick"])])),_:1}),d(v,{style:{float:"left"}},{default:c((()=>[e.showHistory?(r(),u(g,{key:0,onClick:e.onShowHistory},{default:c((()=>[m("查看历史版本")])),_:1},8,["onClick"])):p("",!0),e.aiTestMode?(r(),u(g,{key:1,onClick:e.onGenTestData},{default:c((()=>[m("生成测试数据")])),_:1},8,["onClick"])):p("",!0)])),_:1})])),default:c((()=>[d(h,{activeKey:e.enhanceType,"onUpdate:activeKey":a[2]||(a[2]=a=>e.enhanceType=a),onChange:e.onChangeType},{default:c((()=>[d(f,{tab:"form",key:"form",forceRender:""},{default:c((()=>[e.reloading?p("",!0):(r(),u(i,{key:0,ref:"formEditorRef",value:e.enhanceValues.form,"onUpdate:value":a[0]||(a[0]=a=>e.enhanceValues.form=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1}),d(f,{tab:"list",key:"list",forceRender:""},{default:c((()=>[e.reloading?p("",!0):(r(),u(i,{key:0,ref:"listEditorRef",value:e.enhanceValues.list,"onUpdate:value":a[1]||(a[1]=a=>e.enhanceValues.list=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1})])),_:1},8,["activeKey","onChange"]),d(y,{onRegister:e.registerEnhanceJsHistory},null,8,["onRegister"])])),_:1},8,["onRegister"])}]]);export{J as default};
