import{B as e}from"./index.12c6f6d1.js";import"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import{l as a,F as t,a8 as n,bH as o,bI as s,f0 as i,t as l,v as r,V as u,z as c,y as d,C as f,W as m,u as p}from"./index.b2c24a42.js";import{k as h}from"./JAddInput.2ba637e0.js";import{u as g}from"./useOnlineTest.01d0c935.js";import{E as v,u as y}from"./EnhanceJsHistory.544b120c.js";import{s as j,g as b}from"./enhance.api.5067df3f.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./uniqBy.be1d69f1.js";import"./useFormItem.9110ec70.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./api.e26748d3.js";import"./index.be1c9e2b.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";var C=(e,a,t)=>new Promise(((n,o)=>{var s=e=>{try{l(t.next(e))}catch(a){o(a)}},i=e=>{try{l(t.throw(e))}catch(a){o(a)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,i);l((t=t.apply(e,a)).next())}));var J=i(a({name:"EnhanceJs",components:{BasicModal:e,JCodeEditor:h,EnhanceJsHistory:v},emits:["register"],setup(){const{createMessage:e}=p(),a=y(),i=t(),l=t(),r=n({form:{},list:{}}),u=t("list"),c=t(""),d=t(!1),f=t(!1),m=t(""),h=n({form:"",list:""}),v={form:!1,list:!1},J=t(!1),[E,{closeModal:x}]=o((e=>C(this,null,(function*(){!function(e){c.value=e.id,f.value=!1,m.value=e.tableName;let t=a.getEnhanceJs(c.value);(null==t?void 0:t.length)>0?(u.value=t[t.length-1].type,d.value=!0):d.value=!1;v.form=!1,v.list=!1,u.value?R(u.value):R("form");J.value=!0,setTimeout((()=>J.value=!1),150)}(e.row)})))),[T,k]=s(),{aiTestMode:M,genEnhanceJsData:w}=g();function H(e){return C(this,null,(function*(){let t=r[e],n={cgJs:h[e],cgJsType:e};if(!v[e]||t.cgJs===n.cgJs)return;let o=!!t.id;o&&(n=Object.assign({},t,n)),yield j(c.value,n,o),a.addEnhanceJs({code:c.value,str:n.cgJs,type:n.cgJsType,date:(new Date).getTime()})}))}function R(e){return C(this,null,(function*(){u.value=e;try{if(!v[e]){let a=yield b(c.value,e);Object.assign(r[e],{id:null},a),h[e]=r[e].cgJs,v[e]=!0}}catch(a){}setTimeout((()=>{"list"==e?l.value.refresh():i.value.refresh()}),150)}))}return{formEditorRef:i,listEditorRef:l,reloading:J,enhanceValues:h,enhanceType:u,showHistory:d,aiTestMode:M,tableName:m,genEnhanceJsData:w,onGenTestData:function(){"form"===u.value?w(m.value,u.value,i.value):w(m.value,u.value,l.value)},onChangeType:R,onCodeChange:function(e){h[u.value]!=e&&(f.value=!0,h[u.value]=e)},onShowHistory:function(){k.openModal(!0,{code:c.value,type:u.value})},onSubmit:function(){return C(this,null,(function*(){yield Promise.all([H("form"),H("list")]),x(),e.success("保存成功")}))},onCancel:function(){x()},registerModal:E,registerEnhanceJsHistory:T}}}),[["render",function(e,a,t,n,o,s){const i=l("JCodeEditor"),p=l("a-tab-pane"),h=l("a-tabs"),g=l("a-button"),v=l("a-space"),y=l("EnhanceJsHistory"),j=l("BasicModal");return r(),u(j,{onRegister:e.registerModal,title:"JS增强",width:800,bodyStyle:{height:"360px"}},{footer:c((()=>[d(v,null,{default:c((()=>[d(g,{onClick:e.onCancel},{default:c((()=>[f("关闭")])),_:1},8,["onClick"]),d(g,{type:"primary",onClick:e.onSubmit},{default:c((()=>[f("确定")])),_:1},8,["onClick"])])),_:1}),d(v,{style:{float:"left"}},{default:c((()=>[e.showHistory?(r(),u(g,{key:0,onClick:e.onShowHistory},{default:c((()=>[f("查看历史版本")])),_:1},8,["onClick"])):m("",!0),e.aiTestMode?(r(),u(g,{key:1,onClick:e.onGenTestData},{default:c((()=>[f("生成测试数据")])),_:1},8,["onClick"])):m("",!0)])),_:1})])),default:c((()=>[d(h,{activeKey:e.enhanceType,"onUpdate:activeKey":a[2]||(a[2]=a=>e.enhanceType=a),onChange:e.onChangeType},{default:c((()=>[d(p,{tab:"form",key:"form",forceRender:""},{default:c((()=>[e.reloading?m("",!0):(r(),u(i,{key:0,ref:"formEditorRef",value:e.enhanceValues.form,"onUpdate:value":a[0]||(a[0]=a=>e.enhanceValues.form=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1}),d(p,{tab:"list",key:"list",forceRender:""},{default:c((()=>[e.reloading?m("",!0):(r(),u(i,{key:0,ref:"listEditorRef",value:e.enhanceValues.list,"onUpdate:value":a[1]||(a[1]=a=>e.enhanceValues.list=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1})])),_:1},8,["activeKey","onChange"]),d(y,{onRegister:e.registerEnhanceJsHistory},null,8,["onRegister"])])),_:1},8,["onRegister"])}]]);export{J as default};
