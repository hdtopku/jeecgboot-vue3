import{B as e}from"./index.ee0a0c33.js";import{B as t}from"./BasicForm.79466d99.js";import"./helper.ec3e26f3.js";import{u as i}from"./useForm.ee23be26.js";import"./JAddInput.c8a1b05b.js";import{f0 as l,F as o,bH as a,o as n,t as r,v as s,V as d,z as c,y as p,B as m,a1 as u}from"./index.b3c93d64.js";import{o as b}from"./omit.d6518a29.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import"./_baseClone.a8082016.js";import"./_arrayPush.8821345e.js";import"./_flatRest.ff1861ce.js";import"./BasicModal.2a8ad889.js";import"./useWindowSizeFn.e6386ae5.js";import"./uniqBy.30d2558a.js";import"./useFormItem.d029403d.js";import"./functional.3bb51b91.js";import"./download.261c8978.js";import"./base64Conver.030fa32c.js";import"./index.d2e70b0d.js";import"./index.17ec2e33.js";import"./useCountdown.cb4ad478.js";import"./JUpload.6bcc6fce.js";import"./api.dced5d87.js";import"./index.ef2039b9.js";import"./props.a4f5d1ca.js";import"./index.c4683457.js";import"./bem.3d3e77ca.js";import"./props.c13d8268.js";import"./useContextMenu.de287960.js";import"./index.9bbe419b.js";import"./onMountedOrActivated.d3784e6c.js";import"./index.36d6c198.js";import"./htmlmixed.ba3cd961.js";import"./vue.8c416d71.js";/* empty css             */import"./depart.api.429e062c.js";import"./_baseSlice.23bb44df.js";var f=Object.defineProperty,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,v=(e,t,i)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,y=(e,t,i)=>new Promise(((l,o)=>{var a=e=>{try{r(i.next(e))}catch(t){o(t)}},n=e=>{try{r(i.throw(e))}catch(t){o(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,n);r((i=i.apply(e,t)).next())}));var F=l({name:"LinkTableConfigModal",emits:["success","register"],components:{BasicModal:e,BasicForm:t},setup(e,{emit:t}){const l=o(!1),r=o("");let s={};const[d,{closeModal:c}]=a((e=>y(this,null,(function*(){s=((e,t)=>{for(var i in t||(t={}))h.call(t,i)&&v(e,i,t[i]);if(g)for(var i of g(t))j.call(t,i)&&v(e,i,t[i]);return e})({},e.record),yield T({dictTable:e.record.dictTable}),setTimeout((()=>y(this,null,(function*(){let t=b(e.record,"dictTable");yield T(t),yield B()}))),200),r.value=e.fieldName})))),p=o(""),m=o(""),f=o([]),F=o([]);function x(e){return y(this,null,(function*(){p.value="",m.value="",yield function(e){return y(this,null,(function*(){if(e){const t="/online/cgform/field/listByHeadCode",i=yield u.get({url:t,params:{headCode:e}});if(i&&i.length>0){let e=i.filter((e=>"id"!=e.dbFieldName&&1==e.dbIsPersist));e.length>0?f.value=e.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):f.value=[];let t=i.filter((e=>"id"!=e.dbFieldName&&"image"==e.fieldShowType&&1==e.dbIsPersist));t.length>0?F.value=t.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}else f.value=[],F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}}))}(e)}))}const C=n((()=>{let e=f.value,t=p.value,i=m.value;return e.filter((e=>e.value!=t&&e.value!=i))})),w=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"dictField",field:"dictField",component:"Input",defaultValue:"id",show:!1},{label:"字段描述",field:"dbFieldTxt",component:"Input",required:!0},{label:"关联表",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({dict:"onl_cgform_head where copy_type = 0,table_txt,table_name",pageSize:10,async:!0,immediateChange:!0,popContainer:".link-table-config-modal",params:{order:"desc",column:"create_time"},onChange:t=>y(this,null,(function*(){(s.titleField||s.otherFields)&&(yield e.setFieldsValue({titleField:"",otherFields:"",imageField:""}),yield e.clearValidate()),yield x(t)}))})},{label:"标题字段",field:"titleField",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:f,immediateChange:!0,onChange:e=>{p.value=e,s.titleField=e}}},{label:"封面图片",field:"imageField",component:"JSearchSelect",componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:F,immediateChange:!0,onChange:e=>{m.value=e,s.imageFieldName=e}}},{label:"其他字段",field:"otherFields",component:"JSelectMultiple",componentProps:{popContainer:".link-table-config-modal",options:C,onChange:e=>{s.otherFields=e}}},{label:"显示方式",field:"showType",component:"Select",defaultValue:"card",componentProps:{options:[{label:"卡片",value:"card"},{label:"下拉框",value:"select"}]}},{label:"是否多选",field:"multiSelect",component:"RadioGroup",defaultValue:!1,componentProps:{options:[{label:"否",value:!1},{label:"是",value:!0}]}}],[S,{validate:P,setFieldsValue:T,clearValidate:B,resetFields:_}]=i({schemas:w,showActionButtonGroup:!1,labelAlign:"right"});return{registerModal:d,spinningLoading:l,registerForm:S,handleSubmit:function(){return y(this,null,(function*(){let e=yield P();e.fieldName=r.value,t("success",e),c()}))}}}},[["render",function(e,t,i,l,o,a){const n=r("BasicForm"),u=r("a-spin"),b=r("BasicModal");return s(),d(b,m({wrapClassName:"link-table-config-modal"},e.$attrs,{title:"关联记录配置",onRegister:l.registerModal,keyboard:"",canFullscreen:!1,cancelText:"关闭",onOk:l.handleSubmit}),{default:c((()=>[p(u,{spinning:l.spinningLoading},{default:c((()=>[p(n,{onRegister:l.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16,["onRegister","onOk"])}]]);export{F as default};
