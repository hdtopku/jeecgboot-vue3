import{O as ONL_FORM_TABLE_NAME,F as FormSchemaFactory,a as ONL_AUTH_PRE,V as VALIDATE_FAILED,S as SUBMIT_FLOW_KEY}from"./FormSchemaFactory.e2d6744d.js";import{d as duplicateCheck}from"./user.api.5f72a761.js";import{c as commonjsGlobal}from"./_commonjsHelpers.dc2475b4.js";import{v as createVNode,av as AntdIcon,a8 as reactive,f2 as _export_sfc,C as ref,m as computed,bH as useModalInner,j as defineComponent,cH as Button,E as watch,c9 as PlusOutlined,dz as EditOutlined,aN as propTypes,bI as useModal,al as useDebounceFn,e3 as useRouter,ej as usePermissionStore,fa as replaceAll,Z as defHttp,K as unref,G as nextTick,h,aa as watchEffect,f as filterMultiDictText,ac as toRaw,fb as markRaw,fc as defineAsyncComponent,fd as importViewsFile,a as getFileAccessHttpUrl,d9 as useUserStore,dJ as Loading,r as resolveComponent,s as openBlock,Q as createBlock,t as createElementBlock,w as withCtx,y as createTextVNode,z as toDisplayString,R as createCommentVNode,x as mergeProps,aW as createBaseVNode,ax as Fragment,bc as renderList,B as normalizeClass,n as getToken,fe as goJmReportViewPage,u as useMessage}from"./index.9f534f34.js";import{C as CustomExpression}from"./customExpression.05dc2408.js";import{T as TableAction,h as add}from"./componentMap.0d24ff89.js";import OnlineSelectCascade from"./OnlineSelectCascade.83439d92.js";import{B as BasicModal}from"./index.768f33bf.js";import{B as BasicForm}from"./BasicForm.0bf7a5f6.js";import{u as useForm}from"./useForm.2fdb3515.js";import"./JAddInput.6724421d.js";import{p as pick$1}from"./pick.5c5b7fa5.js";import BasicTable from"./BasicTable.9a709e60.js";import{F as FormOutlined}from"./BasicTable.vue_vue_type_style_index_0_lang.81932510.js";import"./TableImg.vue_vue_type_style_index_0_lang.e919a3b5.js";import{useListPage}from"./useListPage.a0752136.js";import{g as getAreaTextByCode}from"./Area.5d5b77fd.js";import{c as createImgPreview}from"./functional.440c3e35.js";import LinkTableListPiece from"./LinkTableListPiece.9f862c77.js";import JModalTip from"./JModalTip.e46f813a.js";var DiffOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"};const DiffOutlinedSvg=DiffOutlined$2;function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),l.forEach(function(g){_defineProperty$2(e,g,n[g])})}return e}function _defineProperty$2(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var DiffOutlined=function(t,n){var l=_objectSpread$2({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$2({},l,{icon:DiffOutlinedSvg}),null)};DiffOutlined.displayName="DiffOutlined";DiffOutlined.inheritAttrs=!1;const DiffOutlined$1=DiffOutlined;var MinusCircleFilled$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};const MinusCircleFilledSvg=MinusCircleFilled$2;function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),l.forEach(function(g){_defineProperty$1(e,g,n[g])})}return e}function _defineProperty$1(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MinusCircleFilled=function(t,n){var l=_objectSpread$1({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$1({},l,{icon:MinusCircleFilledSvg}),null)};MinusCircleFilled.displayName="MinusCircleFilled";MinusCircleFilled.inheritAttrs=!1;const MinusCircleFilled$1=MinusCircleFilled;var PrinterOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"};const PrinterOutlinedSvg=PrinterOutlined$2;function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable}))),l.forEach(function(g){_defineProperty(e,g,n[g])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var PrinterOutlined=function(t,n){var l=_objectSpread({},t,n.attrs);return createVNode(AntdIcon,_objectSpread({},l,{icon:PrinterOutlinedSvg}),null)};PrinterOutlined.displayName="PrinterOutlined";PrinterOutlined.inheritAttrs=!1;const PrinterOutlined$1=PrinterOutlined;var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,n)=>new Promise((l,g)=>{var s=F=>{try{y(n.next(F))}catch(P){g(P)}},m=F=>{try{y(n.throw(F))}catch(P){g(P)}},y=F=>F.done?l(F.value):Promise.resolve(F.value).then(s,m);y((n=n.apply(e,t)).next())}),dayjs_min={exports:{}};(function(e,t){(function(n,l){e.exports=l()})(commonjsGlobal,function(){var n=1e3,l=6e4,g=36e5,s="millisecond",m="second",y="minute",F="hour",P="day",O="week",C="month",$="quarter",_="year",I="date",B="Invalid Date",D=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,R=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var i=["th","st","nd","rd"],r=a%100;return"["+a+(i[(r-20)%10]||i[r]||i[0])+"]"}},M=function(a,i,r){var c=String(a);return!c||c.length>=i?a:""+Array(i+1-c.length).join(r)+a},j={s:M,z:function(a){var i=-a.utcOffset(),r=Math.abs(i),c=Math.floor(r/60),d=r%60;return(i<=0?"+":"-")+M(c,2,"0")+":"+M(d,2,"0")},m:function a(i,r){if(i.date()<r.date())return-a(r,i);var c=12*(r.year()-i.year())+(r.month()-i.month()),d=i.clone().add(c,C),S=r-d<0,E=i.clone().add(c+(S?-1:1),C);return+(-(c+(r-d)/(S?d-E:E-d))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:C,y:_,w:O,d:P,D:I,h:F,m:y,s:m,ms:s,Q:$}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},J="en",L={};L[J]=k;var N=function(a){return a instanceof x},p=function a(i,r,c){var d;if(!i)return J;if(typeof i=="string"){var S=i.toLowerCase();L[S]&&(d=S),r&&(L[S]=r,d=S);var E=i.split("-");if(!d&&E.length>1)return a(E[0])}else{var H=i.name;L[H]=i,d=H}return!c&&d&&(J=d),d||!c&&J},b=function(a,i){if(N(a))return a.clone();var r=typeof i=="object"?i:{};return r.date=a,r.args=arguments,new x(r)},v=j;v.l=p,v.i=N,v.w=function(a,i){return b(a,{locale:i.$L,utc:i.$u,x:i.$x,$offset:i.$offset})};var x=function(){function a(r){this.$L=p(r.locale,null,!0),this.parse(r)}var i=a.prototype;return i.parse=function(r){this.$d=function(c){var d=c.date,S=c.utc;if(d===null)return new Date(NaN);if(v.u(d))return new Date;if(d instanceof Date)return new Date(d);if(typeof d=="string"&&!/Z$/i.test(d)){var E=d.match(D);if(E){var H=E[2]-1||0,U=(E[7]||"0").substring(0,3);return S?new Date(Date.UTC(E[1],H,E[3]||1,E[4]||0,E[5]||0,E[6]||0,U)):new Date(E[1],H,E[3]||1,E[4]||0,E[5]||0,E[6]||0,U)}}return new Date(d)}(r),this.$x=r.x||{},this.init()},i.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},i.$utils=function(){return v},i.isValid=function(){return this.$d.toString()!==B},i.isSame=function(r,c){var d=b(r);return this.startOf(c)<=d&&d<=this.endOf(c)},i.isAfter=function(r,c){return b(r)<this.startOf(c)},i.isBefore=function(r,c){return this.endOf(c)<b(r)},i.$g=function(r,c,d){return v.u(r)?this[c]:this.set(d,r)},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this.$d.getTime()},i.startOf=function(r,c){var d=this,S=!!v.u(c)||c,E=v.p(r),H=function(V,W){var Q=v.w(d.$u?Date.UTC(d.$y,W,V):new Date(d.$y,W,V),d);return S?Q:Q.endOf(P)},U=function(V,W){return v.w(d.toDate()[V].apply(d.toDate("s"),(S?[0,0,0,0]:[23,59,59,999]).slice(W)),d)},z=this.$W,q=this.$M,ee=this.$D,X="set"+(this.$u?"UTC":"");switch(E){case _:return S?H(1,0):H(31,11);case C:return S?H(1,q):H(0,q+1);case O:var te=this.$locale().weekStart||0,ne=(z<te?z+7:z)-te;return H(S?ee-ne:ee+(6-ne),q);case P:case I:return U(X+"Hours",0);case F:return U(X+"Minutes",1);case y:return U(X+"Seconds",2);case m:return U(X+"Milliseconds",3);default:return this.clone()}},i.endOf=function(r){return this.startOf(r,!1)},i.$set=function(r,c){var d,S=v.p(r),E="set"+(this.$u?"UTC":""),H=(d={},d[P]=E+"Date",d[I]=E+"Date",d[C]=E+"Month",d[_]=E+"FullYear",d[F]=E+"Hours",d[y]=E+"Minutes",d[m]=E+"Seconds",d[s]=E+"Milliseconds",d)[S],U=S===P?this.$D+(c-this.$W):c;if(S===C||S===_){var z=this.clone().set(I,1);z.$d[H](U),z.init(),this.$d=z.set(I,Math.min(this.$D,z.daysInMonth())).$d}else H&&this.$d[H](U);return this.init(),this},i.set=function(r,c){return this.clone().$set(r,c)},i.get=function(r){return this[v.p(r)]()},i.add=function(r,c){var d,S=this;r=Number(r);var E=v.p(c),H=function(q){var ee=b(S);return v.w(ee.date(ee.date()+Math.round(q*r)),S)};if(E===C)return this.set(C,this.$M+r);if(E===_)return this.set(_,this.$y+r);if(E===P)return H(1);if(E===O)return H(7);var U=(d={},d[y]=l,d[F]=g,d[m]=n,d)[E]||1,z=this.$d.getTime()+r*U;return v.w(z,this)},i.subtract=function(r,c){return this.add(-1*r,c)},i.format=function(r){var c=this,d=this.$locale();if(!this.isValid())return d.invalidDate||B;var S=r||"YYYY-MM-DDTHH:mm:ssZ",E=v.z(this),H=this.$H,U=this.$m,z=this.$M,q=d.weekdays,ee=d.months,X=function(W,Q,Z,w){return W&&(W[Q]||W(c,S))||Z[Q].slice(0,w)},te=function(W){return v.s(H%12||12,W,"0")},ne=d.meridiem||function(W,Q,Z){var w=W<12?"AM":"PM";return Z?w.toLowerCase():w},V={YY:String(this.$y).slice(-2),YYYY:this.$y,M:z+1,MM:v.s(z+1,2,"0"),MMM:X(d.monthsShort,z,ee,3),MMMM:X(ee,z),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:X(d.weekdaysMin,this.$W,q,2),ddd:X(d.weekdaysShort,this.$W,q,3),dddd:q[this.$W],H:String(H),HH:v.s(H,2,"0"),h:te(1),hh:te(2),a:ne(H,U,!0),A:ne(H,U,!1),m:String(U),mm:v.s(U,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:E};return S.replace(R,function(W,Q){return Q||V[W]||E.replace(":","")})},i.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},i.diff=function(r,c,d){var S,E=v.p(c),H=b(r),U=(H.utcOffset()-this.utcOffset())*l,z=this-H,q=v.m(this,H);return q=(S={},S[_]=q/12,S[C]=q,S[$]=q/3,S[O]=(z-U)/6048e5,S[P]=(z-U)/864e5,S[F]=z/g,S[y]=z/l,S[m]=z/n,S)[E]||z,d?q:v.a(q)},i.daysInMonth=function(){return this.endOf(C).$D},i.$locale=function(){return L[this.$L]},i.locale=function(r,c){if(!r)return this.$L;var d=this.clone(),S=p(r,c,!0);return S&&(d.$L=S),d},i.clone=function(){return v.w(this.$d,this)},i.toDate=function(){return new Date(this.valueOf())},i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toISOString=function(){return this.$d.toISOString()},i.toString=function(){return this.$d.toUTCString()},a}(),u=x.prototype;return b.prototype=u,[["$ms",s],["$s",m],["$m",y],["$H",F],["$W",P],["$M",C],["$y",_],["$D",I]].forEach(function(a){u[a[1]]=function(i){return this.$g(i,a[0],a[1])}}),b.extend=function(a,i){return a.$i||(a(i,x,b),a.$i=!0),b},b.locale=p,b.isDayjs=N,b.unix=function(a){return b(1e3*a)},b.en=L[J],b.Ls=L,b.p={},b})})(dayjs_min);var dayjs=dayjs_min.exports;const ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(e=>CustomExpression[e]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(e,t,n){hasEffectiveValue(t.defVal)&&n.push({field:e,type:t.type,value:t.defVal})}function initSubTableDefValueConfig(e,t){hasEffectiveValue(e.fieldDefaultValue)&&t.push({field:e.key,type:e.type,value:e.fieldDefaultValue})}function loadFormFieldsDefVal(e,t,n){return __async(this,null,function*(){if(Array.isArray(e)&&e.length>0){let l={};for(let g of e){let{value:s,type:m,field:y}=g;s=yield handleDefaultValue(s,ACTION_TYPES.ADD,n||{}),m==="number"&&s&&(s=Number.parseFloat(s)),l[y]=s}t(l)}})}function loadOneFieldDefVal(e,t,n){return __async(this,null,function*(){let{defVal:l,type:g}=t;if(hasEffectiveValue(l)){let s=yield handleDefaultValue(l,ACTION_TYPES.ADD,{});g==="number"&&s&&(s=Number.parseFloat(s)),n[e]=s}})}function hasEffectiveValue(e){return!!(e||e===0)}function handleDefaultValue(e,t,n){return __async(this,null,function*(){if(e!=null&&checkExpressionType(e)){let l=yield getDefaultValue(e,t,n);if(l!=null)return l}return e})}function checkExpressionType(e){let t=0,n=0,l=0;if(e.replace(fillRuleRegExp,()=>l++),l>1)return logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u53EA\u80FD\u540C\u65F6\u586B\u5199\u4E00\u4E2A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\uFF01`),!1;e.replace(normalRegExp,()=>t++),e.replace(customRegExp,()=>n++);let g=t+n;return l>0&&g>0?(logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\u4E0D\u80FD\u548C\u5176\u4ED6\u8868\u8FBE\u5F0F\u6DF7\u7528\uFF01`),!1):!0}function getRegExpMap(e,t){let n=new Map;return e.replace(t,function(l,g){return n.set(l,g.trim()),l}),n}function getDefaultValue(e,t,n){return __async(this,null,function*(){return(t===ACTION_TYPES.ADD||t===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(e)?yield executeRegExp(e,fillRuleRegExp,executeFillRuleExpression,[n]):t===ACTION_TYPES.ADD?(e=yield executeRegExp(e,normalRegExp,executeNormalExpression),e=yield executeRegExp(e,customRegExp,executeCustomExpression),e):null})}function executeRegExp(e,t,n){return __async(this,arguments,function*(l,g,s,m=[]){let y=getRegExpMap(l,g);for(let F of y.keys()){let P=y.get(F),O=yield s.apply(null,[P,F,...m]);if(F===l)return O;l=replaceAll(l,F,O)}return l})}function executeNormalExpression(e,t){return __async(this,null,function*(){switch(e){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let n=getUserInfoByExpression(e);return n!=null?n:t}})}function getUserInfoByExpression(e){let n=useUserStore().getUserInfo;if(n)switch(e){case"sysUserId":return n.id;case"sysUserCode":case"sys_user_code":return n.username;case"sysUserName":return n.realname;case"sysOrgCode":case"sys_org_code":return n.orgCode}return null}function executeCustomExpression(expression,origin){return __async(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(e){return logError(e),origin}})}function executeFillRuleExpression(e,t,n){return __async(this,null,function*(){let l=`/sys/fillRule/executeRuleByCode/${e}`,g={};typeof n=="function"?g=n():n&&(g=__spreadValues({},n));let{success:s,message:m,result:y}=yield defHttp.put({url:l,params:g},{isTransformResponse:!1});return s?y:(logError(`\u586B\u503C\u89C4\u5219\uFF08${e}\uFF09\u6267\u884C\u5931\u8D25\uFF1A${m}`),t)})}function logWarn(e){console.warn("[loadFieldDefVal]:",e)}function logError(e){console.error("[loadFieldDefVal]:",e)}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(e,t)=>defHttp.get({url:e,params:t},{isTransformResponse:!1}),postAction=(e,t)=>defHttp.post({url:e,params:t},{isTransformResponse:!1}),putAction=(e,t)=>defHttp.put({url:e,params:t},{isTransformResponse:!1}),deleteAction=(e,t)=>defHttp.delete({url:e,params:t},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(e,t){EnhanceJS&&EnhanceJS[t]&&EnhanceJS[t](e)}function customBeforeSubmit(e,t){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(e,t):Promise.resolve()}function beforeDelete(e,t){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(e,t):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeDelete?t.beforeDelete(onlineTableContext,e):Promise.resolve()},onlineTableContext.beforeEdit=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeEdit?t.beforeEdit(onlineTableContext,e):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(e,{emit:t}){console.log("\u8FDB\u5165online\u5B50\u8868\u8868\u5355\u9875\u9762\u300B\u300B\u300B\u300B"+e.table);const n=ref(null),l=ref(!1),{formSchemas:g,defaultValueFields:s,changeDataIfArray2String:m,tableName:y,dbData:F,checkOnlyFieldValue:P,fieldDisplayStatus:O,createFormSchemas:C,baseColProps:$}=useFormItems(e,n),[_,{setProps:I,validate:B,resetFields:D,setFieldsValue:R,getFieldsValue:k}]=useForm({schemas:g,showActionButtonGroup:!1,baseColProps:$});watch(()=>e.table,()=>{y.value=e.table},{immediate:!0}),watch(()=>e.properties,u=>{console.log("\u4E3B\u8868properties\u6539\u53D8",e.properties),l.value=!1,M(),C(e.properties,e.requiredFields,P),l.value=!0},{deep:!0,immediate:!0}),watch(()=>e.mainId,u=>{console.log("\u4E3B\u8868ID\u6539\u53D8",e.mainId),setTimeout(()=>{J()},100)},{immediate:!0}),watch(()=>e.disabled,u=>{I({disabled:u})});function M(){return __async(this,null,function*(){let u=yield getRefPromise(n);u.$formValueChange=(a,i)=>{let r={[a]:i};t("formChange",r)}})}function j(){if(unref(e.isUpdate)===!1){let u=toRaw(s[y.value]);loadFormFieldsDefVal(u,a=>{R(a)})}}function J(){return __async(this,null,function*(){yield getRefPromise(l),yield D(),j();const{table:u,mainId:a}=e;if(!u||!a)return;let i=yield L(u,a);F.value=i,yield R(i)})}function L(u,a){let i=`${baseUrl}/${u}/${a}`;return new Promise((r,c)=>{defHttp.get({url:i},{isTransformResponse:!1}).then(d=>{console.log(d),d.success?r(d.result):(console.log(d.message),c())})}).finally(()=>{F.value=""})}function N(){return new Promise((u,a)=>{B().then(()=>{let i=k();i=m(i),u(i)}).catch(i=>{a(i)})})}function p(){let u=k();return u.id||(u.id="sub-change-temp-id"),{row:u,target:x}}function b(u){R(u)}function v(){let u=k(),a=toRaw(s[y.value]);loadFormFieldsDefVal(a,i=>{R(i)},u)}const x={onlineFormRef:n,baseColProps:$,formSchemas:g,registerForm:_,setFieldsValue:R,getFieldsValue:k,getFormEvent:p,setValues:b,getAll:N,executeFillRule:v,sh:O};return x}};function _sfc_render$5(e,t,n,l,g,s){const m=resolveComponent("BasicForm");return openBlock(),createBlock(m,{ref:"onlineFormRef",onRegister:e.registerForm},null,8,["onRegister"])}var OnlineSubForm=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"}));const urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading,OnlineSubForm,PrinterOutlined:PrinterOutlined$1,DiffOutlined:DiffOutlined$1,FormOutlined},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0},isVxeTableData:{type:Boolean,default:!1}},emits:["success","rendered","dataChange"],setup(e,{emit:t}){console.log("onlineForm-setup\u300B\u300B");const{createMessage:n}=useMessage(),[l,{openModal:g}]=useModal(),s=ref(""),m=ref(null),y=ref(!0),F=ref(!1),P=ref(1),O=ref(!1),C=ref(!1),$=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:_,resetContext:I}=useOnlineFormContext(),{formSchemas:B,defaultValueFields:D,changeDataIfArray2String:R,tableName:k,dbData:M,checkOnlyFieldValue:j,hasSubTable:J,subTabInfo:L,refMap:N,subDataSource:p,baseColProps:b,createFormSchemas:v,fieldDisplayStatus:x}=useFormItems(e,m);let{EnhanceJS:u,initCgEnhanceJs:a}=useEnhance(_,!1);const[i,{setProps:r,validate:c,resetFields:d,setFieldsValue:S,updateSchema:E,getFieldsValue:H,scrollToField:U}]=useForm({schemas:B,showActionButtonGroup:!1,baseColProps:b}),z=ref(!1);function q(){let o=e.disabled;z.value=o,r({disabled:o})}function ee(o,f,T){return __async(this,null,function*(){console.log("onlinepopform\u65B0\u589E\u7F16\u8F91\u8FDB\u5165\u8868\u5355\u300B\u300Bform",f),yield d(),M.value="";let A=unref(o);C.value=A,A&&(yield te(f)),yield nextTick(()=>{!A&&T&&S(T),X(),ue("js","loaded"),q()})})}function X(){if(unref(C)===!1){let o=toRaw(D[k.value]);loadFormFieldsDefVal(o,f=>{S(f)})}}function te(o){return __async(this,null,function*(){let f=yield V(o.id);(!f||Object.keys(f).length==0)&&(f=__spreadValues({},toRaw(o))),M.value=Object.assign({},f);let T=ne.value,A=pick$1(f,...T);e.isVxeTableData===!0&&(A=Object.assign({},A,o)),yield S(A)})}let ne=computed(()=>{let o=B.value,f=[];for(let T of o)f.push(T.field);return f});function V(o){let f=`${urlObject.optPre}${e.id}/${o}`;return new Promise((T,A)=>{defHttp.get({url:f},{isTransformResponse:!1}).then(Y=>{Y.success?T(Y.result):(A(),n.warning(Y.message))}).catch(()=>{A()})})}function W(o){return __async(this,null,function*(){P.value=o.head.tableType,k.value=o.head.tableName,y.value=o.head.tableType==1,Q(o.head.extConfigJson),v(o.schema.properties,o.schema.required,j),u=a(o.enhanceJs),t("rendered",$);let f=yield getRefPromise(m);f.$formValueChange=(T,A,Y)=>{Te(T,A),Y&&S(Y)}})}function Q(o){let f={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};o&&(f=JSON.parse(o)),Object.keys(f).map(T=>{$[T]=f[T]})}function Z(){y.value===!0?ae():w()}function w(){K().then(o=>{ie(o)})}function K(){let o={};return new Promise((f,T)=>{c().then(A=>f(A),({errorFields:A})=>{A&&A.length>0&&U(A[0][0]),T(VALIDATE_FAILED)})}).then(f=>(Object.assign(o,R(f)),re())).then(f=>(Object.assign(o,f),Promise.resolve(o))).catch(f=>(f===VALIDATE_FAILED||(f==null?void 0:f.code)===VALIDATE_FAILED?(n.warning("\u6821\u9A8C\u672A\u901A\u8FC7"),f.key&&G(f.key)):console.error(f),Promise.reject(null)))}function G(o){let f=L.value;for(let T=0;T<f.length;T++)if(o==f[T].key){se.value=T+"";break}}function re(){return new Promise((o,f)=>__async(this,null,function*(){let T={};try{let A=L.value;for(let Y=0;Y<A.length;Y++){let le=A[Y].key,oe=N[le].value;if(oe instanceof Array&&(oe=oe[0]),A[Y].relationType==1)try{let ce=yield oe.getAll();T[le]=[],T[le].push(ce)}catch(ce){throw{code:VALIDATE_FAILED,key:le}}else{if(yield oe.fullValidateTable())throw{code:VALIDATE_FAILED,key:le};T[le]=oe.getTableData()}}}catch(A){f(A)}o(T)}))}function ae(){return __async(this,null,function*(){try{let o=yield c();o=Object.assign({},M.value,o),o=R(o),F.value=!0,ie(o)}finally{F.value=!1}})}function ie(o){xe(he,o).then(()=>{Ae(o)}).catch(f=>{n.warning(f)})}function ge(o,f,T){f&&T?T.setValues?T.setValues(o):T.setValues([{rowKey:f,values:o}]):S(o)}function be(o,f){let T={};T[o]=f,S(T)}const se=ref("0"),de=ref(300),fe=ref(340);function ve(o){if(C.value===!0){let f=M.value;return _e(f,o)}return""}function _e(o,f){if(o){let T=o[f];return!T&&T!==0&&(T=o[f.toLowerCase()],!T&&T!==0&&(T=o[f.toUpperCase()])),T}return""}function ye(o,f){if(u&&u[f+"_onlChange"]){let T=u[f+"_onlChange"](),A=Object.keys(o)[0];if(T[A]){let Y=N[f].value;Y instanceof Array&&(Y=Y[0]);let le=Y.getFormEvent(),oe=__spreadValues({column:{key:A},value:o[A]},le);T[A].call(_,_,oe)}}}function Ce(o,f){if(u&&u[f+"_onlChange"]){let T=u[f+"_onlChange"](_);T[o.column.key]&&T[o.column.key].call(_,_,o)}}function Fe(o,f){console.log("handleAdded",o,f)}function Se(o){return"online_"+o+":"}function Te(o,f){return __async(this,null,function*(){if(M.value[o]!=f&&t("dataChange",o),!u||!u.onlChange||!o)return!1;let A=u.onlChange();if(A[o]){let le={row:yield H(),column:{key:o},value:f};A[o].call(_,_,le)}})}function ue(o,f){if(o=="js")u&&u[f]&&u[f].call(_,_);else if(o=="action"){let T=M.value,A={formId:e.id,buttonCode:f,dataId:T.id,uiFormData:Object.assign({},T)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:A},{isTransformResponse:!1}).then(Y=>{Y.success?n.success("\u5904\u7406\u5B8C\u6210!"):n.warning("\u5904\u7406\u5931\u8D25!")})}}function me(o){let f=N[o].value,T=[...f.getNewDataWithId(),...p.value[o]];if(!T||T.length==0)return!1;let A=[];for(let Y of T)A.push(Y.id);f.removeRowsById(A)}function pe(o,f){if(!f)return!1;let T=N[o].value;typeof f=="object"?T.addRows(f,!0):n.error("\u6DFB\u52A0\u5B50\u8868\u6570\u636E,\u53C2\u6570\u4E0D\u8BC6\u522B!")}function Oe(o,f){me(o),pe(o,f)}function we(o,f){!f&&f.length<=0&&(f=[]),f.map(T=>{T.hasOwnProperty("label")||(T.label=T.text)}),E({field:o,componentProps:{options:f}})}function xe(o,f){return u&&u.beforeSubmit?u.beforeSubmit(o,f):Promise.resolve()}function De(o,f){let T=toRaw(x);o&&o.length>0?Object.keys(T).map(A=>{!A.endsWith("_load")&&o.indexOf(A)<0&&(x[A]=!1)}):f&&f.length>0&&Object.keys(T).map(A=>{f.indexOf(A)>=0&&(x[A]=!1)})}function Be(o){return __async(this,null,function*(){console.log("\u81EA\u5B9A\u4E49\u5F39\u7A97\u6253\u5F00online\u8868\u5355\u300B\u300Bform",o),yield d(),M.value="",C.value=!0,yield te(o),yield nextTick(()=>{ue("js","loaded")})})}function Me(o){let f=N[o].value;return f instanceof Array&&(f=f[0]),f}function Pe(){let o=$.reportPrintUrl,f=M.value.id,T=getToken();goJmReportViewPage(o,f,T)}function Ee(o){console.log(o),s.value=o.id,g(!0)}function ke(o){console.log(o)}function Ae(o){if(Object.keys(o).map(f=>{Array.isArray(o[f])&&o[f].length==0&&(o[f]="")}),console.log("\u63D0\u4EA4pop\u8868\u5355\u6570\u636E\u300B\u300B\u300Bform:",o),e.request==!1)t("success",o);else{let f=`${urlObject.optPre}${e.id}?tabletype=${P.value}`;console.log("\u63D0\u4EA4pop\u8868\u5355url\u300B\u300B\u300Burl:",f),O.value===!0&&(o[SUBMIT_FLOW_KEY]=1);let T=C.value===!0?"put":"post";defHttp.request({url:f,method:T,params:o},{isTransformResponse:!1}).then(A=>{A.success?(A.result&&(o.id||(o.id=A.result)),t("success",o),M.value=o,C.value=!0,n.success("\u64CD\u4F5C\u6210\u529F!")):n.warning(A.message)}).finally(()=>{F.value=!1})}}function $e(){return __async(this,null,function*(){let o=M.value,f=ne.value,T=pick$1(o,...f);if(o)yield S(T);else{let A={};for(let Y of f)A[Y]="";yield S(A)}})}let he={tableName:k,loading:F,subActiveKey:se,onlineFormRef:m,getFieldsValue:H,setFieldsValue:S,submitFlowFlag:O,subFormHeight:de,subTableHeight:fe,refMap:N,triggleChangeValues:ge,triggleChangeValue:be,sh:x,clearSubRows:me,addSubRows:pe,clearThenAddRows:Oe,changeOptions:we,isUpdate:C,getSubTableInstance:Me};return I(he),{tableName:k,onlineFormRef:m,registerForm:i,loading:F,subActiveKey:se,hasSubTable:J,subTabInfo:L,refMap:N,subFormHeight:de,getSubTableForeignKeyValue:ve,isUpdate:C,handleSubFormChange:ye,subTableHeight:fe,onlineFormDisabled:z,subDataSource:p,getSubTableAuthPre:Se,handleAdded:Fe,handleValueChange:Ce,openSubFormModalForAdd:Ee,openSubFormModalForEdit:ke,registerVxeFormModal:l,vxeTableId:s,show:ee,createRootProperties:W,handleSubmit:Z,sh:x,handleCgButtonClick:ue,handleCustomFormSh:De,handleCustomFormEdit:Be,dbData:M,onOpenReportPrint:Pe,onlineExtConfigJson:$,recoverFormData:$e}}},_hoisted_1$3=["id"];function _sfc_render$4(e,t,n,l,g,s){const m=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:l.tableName+"_form"},[createVNode(m,{ref:"onlineFormRef",onRegister:l.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}var OnlinePopForm=_export_sfc(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(e,{emit:t}={},n){const l=ref(null),g=ref(!1),s=ref(1),m=ref([]),y=ref(!1),F=ref(0),P=ref(!1),O=ref(""),C=ref(!1),$=ref(!1),_=ref(!0),I=reactive({}),B=ref(!0),D=ref(""),R=ref(!0),k=ref(!1),{popModalFixedWidth:M,resetBodyStyle:j,popBodyStyle:J}=useFixedHeightModal(),L=ref(!1),N={handleOpenModal:w=>{}},p=ref(""),b=ref(""),v=ref(!1);let x={};const u=computed(()=>{let w=D.value;return w||(unref(g)===!0?"\u8BE6\u60C5":unref($)===!0?"\u7F16\u8F91":"\u65B0\u589E")}),[a,{setModalProps:i,closeModal:r}]=useModalInner(w=>__async(this,null,function*(){D.value="",k.value=!1,e===!0?yield N.handleOpenModal(w):yield S(w),j(),n&&n()})),c=ref(!1);function d(){return __async(this,null,function*(){return yield getRefPromise(c),L.value})}function S(w){return __async(this,null,function*(){i({confirmLoading:!1}),$.value=w.isUpdate,g.value=w.disableSubmit||!1,(w==null?void 0:w.hideSub)===!0&&(B.value=!1),w!=null&&w.title&&(D.value=w.title),w!=null&&w.record?b.value=w.record.id:b.value="",yield nextTick(()=>__async(this,null,function*(){yield getRefPromise(y),H(),yield l.value.show(w==null?void 0:w.isUpdate,w==null?void 0:w.record,w==null?void 0:w.param)}))})}function E(w){y.value=!0,F.value=w.modalMinWidth,w.modelFullscreen==1?i({defaultFullscreen:!0}):i({defaultFullscreen:!1}),x=w}function H(){let w=b.value;x.commentStatus==1&&w?(v.value=!0,i({defaultFullscreen:!0})):v.value=!1}const U=800,z=1100,q=computed(()=>{let w=200*(s.value-1),K=(unref(_)?U:z)+w;K=ee(K);let G=F.value;return console.log({minWidth:G}),G&&K<G&&(K=G),console.log({width:K}),K});function ee(w){let K=I.modalMinWidth;if(K!=null&&K!=="")try{if(K=Number.parseInt(K),w<K)return K}catch(G){console.warn("error modalMinWidth value: ",K)}return w}function X(w,K){l.value.handleCgButtonClick(w,K)}function te(){C.value=!0,setTimeout(()=>{C.value=!1},1500),l.value.handleSubmit()}function ne(){r()}function V(w,K={}){let G=`/online/cgform/api/getFormItem/${w}`;return new Promise((re,ae)=>{defHttp.get({url:G,params:K},{isTransformResponse:!1}).then(ie=>{console.log("\u8868\u5355\u7ED3\u679C\u300B\u300Bmodal:",ie),ie.success?re(ie.result):ae(ie.message)}).catch(()=>{ae()})})}function W(w,K){return __async(this,null,function*(){let G=yield V(w,K),re=G.head.formTemplate;s.value=re?Number(re):1,m.value=G.cgButtonList,P.value=G.head.isTree==="Y",O.value=G.head.treeParentIdField||"",p.value=G.head.tableName,G.form_disable_update===!0?L.value=!0:L.value=!1,c.value=!0,t&&t("formConfig",G),yield nextTick(()=>__async(this,null,function*(){yield(yield getRefPromise(l)).createRootProperties(G)}))})}function Q(w){w[ONL_FORM_TABLE_NAME]=p.value,t("success",w),R.value==!0&&r(),k.value=!1,R.value=!0}function Z(){l.value&&l.value.onCloseModal()}return{title:u,modalWidth:q,registerModal:a,closeModal:r,modalObject:N,onCloseEvent:Z,cgButtonList:m,handleCgButtonClick:X,disableSubmit:g,handleSubmit:te,submitLoading:C,handleCancel:ne,successThenClose:R,handleSuccess:Q,topTipVisible:k,handleFormConfig:W,onlineFormCompRef:l,formTemplate:s,isTreeForm:P,pidFieldName:O,renderSuccess:E,formRendered:y,isUpdate:$,showSub:B,tableName:p,formDataId:b,enableComment:v,popBodyStyle:J,popModalFixedWidth:M,getFormStatus:d}}function useFixedHeightModal(){const t=ref(800);let n=window.innerWidth-300;n<800&&(n=800),t.value=n;const l=ref({});function g(){let s=window.innerHeight-210;l.value={height:s+"px",overflowY:"auto"}}return{popModalFixedWidth:t,popBodyStyle:l,resetBodyStyle:g}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1},isVxeTableData:{type:Boolean,default:!1}},components:{BasicModal,OnlinePopForm,JModalTip,Button},emits:["success","register","formConfig"],setup(e,{emit:t}){console.log("\u8FDB\u5165\u8868\u5355\u5F39\u6846\u300B\u300B\u300B\u300Bmodal");const{title:n,registerModal:l,cgButtonList:g,handleCgButtonClick:s,disableSubmit:m,handleSubmit:y,submitLoading:F,handleCancel:P,handleFormConfig:O,onlineFormCompRef:C,formTemplate:$,isTreeForm:_,pidFieldName:I,renderSuccess:B,formRendered:D,handleSuccess:R,topTipVisible:k,successThenClose:M,isUpdate:j,popBodyStyle:J,popModalFixedWidth:L,getFormStatus:N}=useAutoModal(!1,{emit:t});watch(()=>e.id,p,{immediate:!0});function p(){return __async(this,null,function*(){D.value=!1,e.id&&(console.log("\u91CD\u65B0\u6E32\u67D3\u8868\u5355\u300B\u300B\u300B\u300Bmodal"),yield O(e.id,{}))})}function b(){e.saveClose===!1&&(M.value=!1),y()}function v(){k.value=!1,C.value.recoverFormData()}function x(){k.value=!0}const u=computed(()=>j.value?e.topTip:!1),a=computed(()=>{if(j.value==!0)return null;{let r=F.value;return[h(Button,{type:"primary",loading:r,onClick:y},()=>"\u786E\u5B9A"),h(Button,{onClick:P},()=>"\u5173\u95ED")]}});return{title:n,topTipVisible:k,handleSaveData:b,handleRecover:v,onlineFormCompRef:C,renderSuccess:B,registerModal:l,handleSubmit:y,handleSuccess:R,handleCancel:P,formTemplate:$,disableSubmit:m,cgButtonList:g,handleCgButtonClick:s,isTreeForm:_,pidFieldName:I,submitLoading:F,handleDataChange:x,isUpdate:j,showTopTip:u,modalFooter:a,popBodyStyle:J,popModalFixedWidth:L,getFormStatus:N}}});function _sfc_render$3(e,t,n,l,g,s){const m=resolveComponent("j-modal-tip"),y=resolveComponent("online-pop-form"),F=resolveComponent("BasicModal");return openBlock(),createBlock(F,mergeProps({width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle},e.$attrs,{footer:e.modalFooter,cancelText:"\u5173\u95ED",onRegister:e.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:e.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(e.title)+" ",1),e.showTopTip?(openBlock(),createBlock(m,{key:0,visible:e.topTipVisible,onSave:e.handleSaveData,onCancel:e.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(y,{ref:"onlineFormCompRef",id:e.id,disabled:e.disableSubmit,"form-template":e.formTemplate,isTree:e.isTreeForm,pidField:e.pidFieldName,request:e.request,isVxeTableData:e.isVxeTableData,onRendered:e.renderSuccess,onSuccess:e.handleSuccess,onDataChange:e.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","isVxeTableData","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}var OnlinePopModal=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(e,t){const n="/online/cgform/api/getData/"+e;return defHttp.get({url:n,params:t})}function queryTableColumns(e,t){const n="/online/cgform/api/getColumns/"+e;return defHttp.get({url:n,params:t})}function useLinkTable(e){const t=ref("1"),n=ref({}),l=ref({}),g=ref(""),s=reactive({add:!0,update:!0}),m=computed(()=>e.textField?e.textField.split(","):[]),y=ref([]),F=computed(()=>{let p=y.value;return e.multi==!0?p.slice(0,3):p.slice(0,6)});watchEffect(()=>__async(this,null,function*(){if(e.tableName){let b=e.valueField||"",v=e.textField||"",x=[];if(b&&x.push(b),v){let a=v.split(",");g.value=a[0];for(let i of a)x.push(i)}let u=e.imageField||"";u&&x.push(u),n.value={linkTableSelectFields:x.join(",")},yield _(),yield I()}}));const P=computed(()=>{let p=e.textField||"",b=[],v="";if(p){let x=p.split(",");v=x[0];for(let u=0;u<x.length;u++)u>0&&b.push(x[u])}return{others:b,labelField:v}}),O=ref([]),C=ref([]),$=ref({});function _(){return __async(this,null,function*(){let p=n.value;const b=yield queryTableColumns(e.tableName,p);if(C.value=b.columns,b.columns){let v=e.imageField,x=b.columns.filter(u=>u.dataIndex!=g.value&&u.dataIndex!=v);y.value=x}if($.value=b.dictOptions,console.log("\u9690\u85CF\u7684\u6309\u94AE",b.hideColumns),b.hideColumns){let v=b.hideColumns;v.indexOf("add")>=0?s.add=!1:s.add=!0,v.indexOf("update")>=0?s.update=!1:s.update=!0}})}function I(){return __async(this,null,function*(){let p=D(),v=(yield queryTableData(e.tableName,p)).records,x=[],{others:u,labelField:a}=P.value,i=e.imageField;if(v&&v.length>0)for(let r of v){let c=__spreadValues({},r);B(c);let d=Object.assign({},pick$1(c,u),{id:c.id,label:c[a],value:c[e.valueField]});i&&(d[i]=c[i]),x.push(d)}x.push({}),O.value=x})}function B(p){let b=C.value,v=$.value;for(let x of b){const{dataIndex:u,customRender:a}=x;(p[u]||p[u]===0)&&a&&a==u&&v[a]&&(p[u]=filterMultiDictText(v[a],p[u]))}}function D(){return Object.assign({pageSize:10,pageNo:t.value},n.value,l.value)}function R(p){if(!p)l.value={};else{let b=m.value,v=[],x=[];for(let u=0;u<b.length;u++)u<=1&&(x.push(b[u]),v.push({field:b[u],rule:"like",val:p}));v.superQueryMatchType="or",v.superQueryParams=encodeURI(JSON.stringify(v)),l.value=v}}function k(p){return __async(this,null,function*(){if(!p)return[];let b=e.valueField,v=__spreadProps(__spreadValues({},n.value),{pageSize:10,pageNo:t.value});v.superQueryMatchType="and";let x=[{field:b,rule:"in",val:p}];v.superQueryParams=encodeURI(JSON.stringify(x));let a=(yield queryTableData(e.tableName,v)).records,i=[];if(a&&a.length>0)for(let r of a){let c=__spreadValues({},r);B(c),i.push(c)}return i})}function M(p,b){if(!p||p.length==0)return!1;let v=b.split(",");if(v.length!=p.length)return!1;let x=!0;for(let u of p){let a=u[e.valueField];v.indexOf(a)<0&&(x=!1)}return x}function j(p){Object.keys(p).map(b=>{p[b]instanceof Array&&(p[b]=p[b].join(","))})}function J(p,b,v){if(v||(v={}),b&&b.length>0)for(let x of b){let u=x.split(","),a=u[0],i=u[1];if(p[a])p[a].push(v[i]);else{let r=v[i]||"";p[a]=[r]}}}function L(p){if(e.imageField){let b=p[e.imageField];return getFileAccessHttpUrl(b)}return""}const N=computed(()=>!!e.imageField);return{pageNo:t,otherColumns:y,realShowColumns:F,selectOptions:O,reloadTableLinkOptions:I,textFieldArray:m,addQueryParams:R,tableColumns:C,transData:B,mainContentField:g,loadOne:k,compareData:M,formatData:j,initFormData:J,getImageSrc:L,showImage:N,auths:s}}const _sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def([])},emits:["change","update:value"],setup(e,{emit:t}){const n=ref([]),{auths:l,mainContentField:g,textFieldArray:s,selectOptions:m,reloadTableLinkOptions:y,addQueryParams:F,formatData:P,initFormData:O,getImageSrc:C,showImage:$}=useLinkTable(e),[_,{openModal:I}]=useModal(),B=computed(()=>e.tableName),D=computed(()=>e.multi===!0?{mode:"multiple"}:{});function R(p){p==null||p.stopPropagation(),p==null||p.preventDefault(),I(!0,{})}function k(p,b){if(p==null||p.stopPropagation(),p==null||p.preventDefault(),l.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}I(!0,{isUpdate:!0,record:b})}function M(p){return __async(this,null,function*(){yield y();let b=p[e.valueField];n.value=b})}function j(p){F(p),y()}function J(p){L(p),p||(F(),y())}function L(p){let b={},v=e.linkFields,x=[];if(!p)O(b,v);else{let u=toRaw(m.value);console.log("options>>",u);let a=toRaw(p);a instanceof Array?x=[...a]:e.multi==!0?x=a.split(","):x=[a];let i=u.filter(r=>x.indexOf(r[e.valueField])>=0);if(i&&i.length>0){let r=__spreadValues({},i[0]);if(i.length>1)for(let d=1;d<i.length;d++)r=N(r,i[d]);let c=g.value;r[c]=r.label,O(b,v,r)}}P(b),t("change",x.join(",")||"",b),t("update:value",x.join(",")||"")}function N(p,b){let v={};return Object.keys(p).map(x=>{v[x]=(p[x]||"")+","+(b[x]||"")}),v}return watch(()=>e.value,p=>__async(this,null,function*(){p?(e.multi==!0?n.value=p.split(","):n.value=p,e.linkFields&&e.linkFields.length>0&&L(p)):n.value=[]}),{immediate:!0}),watch(()=>m.value,p=>{p&&p.length>0&&e.linkFields&&e.linkFields.length>0&&n.value&&n.value.length>0&&L(n.value)}),{selectValue:n,selectOptions:m,registerPopModal:_,popTableName:B,textFieldArray:s,handleClickAdd:R,handleClickEdit:k,getFormData:M,handleSearch:useDebounceFn(j,800),handleChange:J,bindValue:D,showImage:$,getImageSrc:C,auths:l}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(e,t,n,l,g,s){const m=resolveComponent("PlusOutlined"),y=resolveComponent("EditOutlined"),F=resolveComponent("a-select"),P=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(F,mergeProps({value:l.selectValue,"onUpdate:value":t[1]||(t[1]=O=>l.selectValue=O),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},l.bindValue,{options:l.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:l.handleSearch,onChange:l.handleChange}),{option:withCtx(O=>[!O.value&&l.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:t[0]||(t[0]=(...C)=>l.handleClickAdd&&l.handleClickAdd(...C))},[createVNode(m),createTextVNode(" \u8BB0\u5F55 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[l.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[l.getImageSrc(O)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(O),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[l.auths.update?(openBlock(),createBlock(y,{key:0,onClick:C=>l.handleClickEdit(C,O)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(O.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.textFieldArray,C=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(O[C]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(P,{id:l.popTableName,onRegister:l.registerPopModal,onSuccess:l.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableSelect=_export_sfc(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-2f5e23a7"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(e){dictOptionInfo.value=e.dictOptions,e.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange}:rowSelection.value=null,enableScrollBar.value=e.scrollFlag==1;let t=e.columns;t.forEach(s=>{Object.keys(s).map(m=>{s[m]==null&&delete s[m]})});let n=e.fieldHrefSlots;const l={};n.forEach(s=>l[s.slotName]=s);let g=[];if(g=handleColumnHrefAndDict(t,l),bpmStatusFilter(g),console.log("-----\u5217\u8868\u5217\u914D\u7F6E----",g),onlineTableContext.isTree()===!0){let s=e.textField,m=-1;for(let y=0;y<g.length;y++)if(g[y].dataIndex==s){m=y;break}if(m>0){let y=g.splice(m,1);g.unshift(y[0])}g.length>0&&(g[0].align="left")}columns.value=g,onlineTableContext.reloadTable()}function onSelectChange(e,t){selectedKeys.value=e,onlineTableContext.selectedRows=toRaw(t),onlineTableContext.selectedRowKeys=toRaw(e)}function handleColumnHrefAndDict(e,t){for(let n of e){let{customRender:l,hrefSlotName:g,fieldType:s}=n;if(s=="date"||s=="Date")n.customRender=({text:m})=>m?m.length>10?m.substring(0,10):m:"";else if(s=="link_table")n.customRender=({text:m,record:y})=>{if(!m)return"";if(onlineTableContext.isPopList===!0)return y[n.dataIndex+"_dictText"];{let F=(m+"").split(","),P=y[n.dataIndex+"_dictText"].split(","),O=[];for(let C=0;C<F.length;C++){let $=h(LinkTableListPiece,{id:F[C],text:P[C],onTab:_=>handleClickLinkTable(_,g)});O.push($)}return O.length==0?"":h("div",{style:{overflow:"hidden"}},O)}};else{if(!g&&n.scopedSlots&&n.scopedSlots.customRender&&t.hasOwnProperty(n.scopedSlots.customRender)&&(g=n.scopedSlots.customRender),l||g){let m=l,y="_replace_text_";n.ellipsis=!0,n.customRender=({text:F,record:P})=>{let O=F;if(m)if(m.startsWith(y)){let C=m.replace(y,"");O=P[C]}else O=filterMultiDictText(unref(dictOptionInfo)[m],F+"");if(n.showLength&&O&&O.length>n.showLength&&(O=O.substr(0,n.showLength)+"..."),g){let C=t[g];if(C)return h("a",{onClick:()=>handleClickFieldHref(C,P)},O)}return O}}if(n.scopedSlots){n.ellipsis=!0;let m=n.scopedSlots;n.slots=m,delete n.scopedSlots}}}return e}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let e=href.split(":");hrefMainTableId.value=e[1];let t=e[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[t]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(e,t)=>record[t]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(e){return console.error(e),text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"\u5173\u95ED",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(e){let t=e.indexOf("?"),n=e;if(t!==-1){n=e.substring(0,t);let g=e.substring(t+1,e.length).split("&"),s={};g.forEach(m=>{let y=m.split("=");s[y[0]]=y[1]}),hrefComponent.params=s}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="\u64CD\u4F5C",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(n)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var e,t;((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedAction)===1&&(actionColumn.fixed=((t=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:t.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(e){let t=!1;for(let n=0;n<e.length;n++)if(e[n].dataIndex.toLowerCase()=="bpm_status"){t=!0;break}return onlineTableContext.hasBpmStatus=t,t}function downloadRowFile(e){if(!e)return;e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(",")));let t=getFileAccessHttpUrl(e);window.open(t)}function getImgView(e){return e&&e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(","))),getFileAccessHttpUrl(e)}function getPcaText(e){return e?getAreaTextByCode(e):""}function getFormatDate(e){if(!e)return"";let t=e;return t.length>10&&(t=t.substring(0,10)),t}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(e){if(e){let t=[],n=e.split(",");for(let l of n)l&&t.push(getFileAccessHttpUrl(l));createImgPreview({imageList:t})}}const onlinePopModalRef=ref();function handleClickLinkTable(e,t){return __async(this,null,function*(){popTableId.value=t,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=t,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:e}})):openPopModal(!0,{isUpdate:!0,record:{id:e}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable,TableAction,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(e,{emit:t}){const{createMessage:n}=useMessage(),{popModalFixedWidth:l,resetBodyStyle:g,popBodyStyle:s}=useFixedHeightModal(),m=ref(""),y=ref(800),[F,{closeModal:P}]=useModalInner(()=>{m.value="",E.value=[],H.value=[],d({current:1}),c(),g()}),[O,{openModal:C}]=useModal();function $(){P()}const _=computed(()=>{const V=E.value;return!(V&&V.length>0)}),I=ref(!1);function B(){I.value=!0;let V=toRaw(H.value);V&&V.length>0&&(t("success",V),P()),setTimeout(()=>{I.value=!1},200)}function D(V){const W="/online/cgform/api/getData/"+e.id;return defHttp.get({url:W,params:V})}function R(V){return V.column="id",new Promise((W,Q)=>__async(this,null,function*(){const Z=yield D(V);W(Z)}))}const k={isPopList:!0,reloadTable(){console.log("reloadTable")},isTree(){return!1}},M=ref({}),{columns:j,downloadRowFile:J,getImgView:L,getPcaText:N,getFormatDate:p,handleColumnResult:b,hrefComponent:v,viewOnlineCellImage:x}=useTableColumns(k,M);function u(){const V="/online/cgform/api/getColumns/"+e.id;return new Promise((W,Q)=>{defHttp.get({url:V},{isTransformResponse:!1}).then(Z=>{Z.success?W(Z.result):(n.warning(Z.message),Q())})})}const a=ref("");watch(()=>e.id,()=>__async(this,null,function*(){let V=yield u();b(V),a.value=V.description}),{immediate:!0});const{tableContext:i}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:R,clickToRowSelect:!0,columns:j,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:V=>X(V)}}),[r,{reload:c,setPagination:d},{rowSelection:S,selectedRowKeys:E,selectedRows:H}]=i;watch(()=>e.multi,V=>{V==!0?S.type="checkbox":S.type="radio"},{immediate:!0});function U(V){return[{label:"\u7F16\u8F91",onClick:z.bind(null,V)}]}function z(V){console.log("handleUpdate",V)}function q(){c()}const ee=["int","double","Date","Datetime","BigDecimal"];function X(V){let W=m.value;if(!W)return V.superQueryMatchType="or",V.superQueryParams="",V;let Q=j.value,Z=[];if(Q&&Q.length>0)for(let w of Q)w.dbType&&(w.dbType=="string"?Z.push({field:w.dataIndex,type:w.dbType.toLowerCase(),rule:"like",val:W}):w.dbType=="Date"?W.length==10&&Z.push({field:w.dataIndex,type:w.dbType.toLowerCase(),rule:"eq",val:W}):w.dbType=="Datetime"?W.length==19&&Z.push({field:w.dataIndex,type:w.dbType.toLowerCase(),rule:"eq",val:W}):ee.indexOf(w.dbType)&&Z.push({field:w.dataIndex,type:w.dbType.toLowerCase(),rule:"eq",val:W}));return V.superQueryMatchType="or",V.superQueryParams=encodeURI(JSON.stringify(Z)),V}function te(){C(!0,{})}function ne(V){console.log("handleDateSave",V),t("success",[V]),P()}return{registerModal:F,modalWidth:y,handleCancel:$,submitDisabled:_,submitLoading:I,handleSubmit:B,registerTable:r,getTableAction:U,searchText:m,onSearch:q,downloadRowFile:J,getImgView:L,getPcaText:N,getFormatDate:p,hrefComponent:v,viewOnlineCellImage:x,rowSelection:S,modalTitle:a,registerPopModal:O,handleAdd:te,reload:c,popModalFixedWidth:l,popBodyStyle:s,handleDataSave:ne}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(e,t,n,l,g,s){const m=resolveComponent("PlusOutlined"),y=resolveComponent("a-button"),F=resolveComponent("a-input-search"),P=resolveComponent("TableAction"),O=resolveComponent("BasicTable"),C=resolveComponent("BasicModal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(C,{onRegister:e.registerModal,width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle,title:e.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[e.addAuth?(openBlock(),createBlock(y,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:e.handleAdd},{default:withCtx(()=>[createVNode(m),createTextVNode("\u65B0\u589E\u8BB0\u5F55")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(y,{key:"back",onClick:e.handleCancel},{default:withCtx(()=>[createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),createVNode(y,{disabled:e.submitDisabled,key:"submit",type:"primary",onClick:e.handleSubmit,loading:e.submitLoading},{default:withCtx(()=>[createTextVNode("\u786E\u5B9A")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(O,{onRegister:e.registerTable,rowSelection:e.rowSelection},{title:withCtx(()=>[createVNode(F,{value:e.searchText,"onUpdate:value":t[0]||(t[0]=_=>e.searchText=_),onSearch:e.onSearch,placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD\uFF0C\u6309\u56DE\u8F66\u641C\u7D22",style:{width:"100%"}},null,8,["value","onSearch"])]),action:withCtx(({record:_})=>[createVNode(P,{actions:e.getTableAction(_)},null,8,["actions"])]),fileSlot:withCtx(({text:_})=>[_?(openBlock(),createBlock(y,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:I=>e.downloadRowFile(_)},{default:withCtx(()=>[createTextVNode(" \u4E0B\u8F7D ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"\u65E0\u6587\u4EF6"))]),imgSlot:withCtx(({text:_})=>[_?(openBlock(),createElementBlock("img",{key:1,src:e.getImgView(_),alt:"\u56FE\u7247\u4E0D\u5B58\u5728",class:"online-cell-image",onClick:I=>e.viewOnlineCellImage(_)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"\u65E0\u56FE\u7247"))]),htmlSlot:withCtx(({text:_})=>[createBaseVNode("div",{innerHTML:_},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:_})=>[createBaseVNode("div",{title:e.getPcaText(_)},toDisplayString(e.getPcaText(_)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:_})=>[createBaseVNode("span",null,toDisplayString(e.getFormatDate(_)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode($,{id:e.id,onRegister:e.registerPopModal,onSuccess:e.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}var OnlinePopListModal=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"}));const _sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def([])},components:{PlusOutlined,MinusCircleFilled:MinusCircleFilled$1,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(e,{emit:t}){const n=computed(()=>e.tableName),[l,{openModal:g}]=useModal(),[s,{openModal:m}]=useModal(),y=ref([]),F=ref([]),P=computed(()=>!(e.disabled==!0||e.multi===!1&&F.value.length>0)),{auths:O,otherColumns:C,realShowColumns:$,tableColumns:_,textFieldArray:I,transData:B,loadOne:D,compareData:R,formatData:k,initFormData:M,getImageSrc:j,showImage:J}=useLinkTable(e),L=computed(()=>e.multi===!0?12:24),N=computed(()=>e.multi===!0?24:12);function p(c){if(c&&I.value.length>0){let d=I.value[0];return c[d]}}function b(c){c==null||c.stopPropagation(),c==null||c.preventDefault()}function v(c,d){if(b(c),O.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}e.disabled==!1&&m(!0,{isUpdate:!0,record:d})}function x(c){g(!0,{})}function u(c){let d=F.value;for(let S of c){let E=__spreadValues({},S);B(E),d.push(E)}F.value=d,r()}function a(c){let d=F.value;for(let S=0;S<d.length;S++)if(d[S].id===c.id){let E=__spreadValues({},c);B(E),d.splice(S,1,E)}F.value=d,r()}function i(c,d){b(c);let S=F.value;S&&S.length>d&&(S.splice(d,1),F.value=S),r()}function r(){let c=F.value,d=[],S={},E=e.linkFields;if(c.length>0)for(let U=0;U<c.length;U++)d.push(c[U][e.valueField]),M(S,E,c[U]);else M(S,E);let H=d.join(",");k(S),t("change",H,S),t("update:value",H)}return watch(()=>e.value,c=>__async(this,null,function*(){if(c){if(R(F.value,c)===!1){let S=yield D(c);F.value=S}e.linkFields&&e.linkFields.length>0&&r()}else F.value=[]}),{immediate:!0}),{popTableName:n,selectRecords:F,otherColumns:C,realShowColumns:$,showButton:P,selectValue:y,handleAddRecord:x,handleDeleteRecord:i,getMainContent:p,itemSpan:L,columnSpan:N,tableColumns:_,addCard:u,registerListModal:l,registerFormModal:s,handleClickEdit:v,updateCardData:a,getImageSrc:j,showImage:J,auths:O}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(e,t,n,l,g,s){const m=resolveComponent("PlusOutlined"),y=resolveComponent("a-button"),F=resolveComponent("minus-circle-filled"),P=resolveComponent("a-col"),O=resolveComponent("a-row"),C=resolveComponent("online-pop-list-modal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[l.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(y,{onClick:l.handleAddRecord},{default:withCtx(()=>[createVNode(m),createTextVNode("\u8BB0 \u5F55")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(O,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.selectRecords,(_,I)=>(openBlock(),createBlock(P,{span:l.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":n.detail==!0}]),onClick:B=>l.handleClickEdit(B,_)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":l.showImage}])},[n.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(F,{onClick:B=>l.handleDeleteRecord(B,I)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(l.getMainContent(_)),1),createBaseVNode("div",_hoisted_8,[createVNode(O,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.realShowColumns,B=>(openBlock(),createBlock(P,{span:l.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(B.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(_[B.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),l.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[l.getImageSrc(_)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(_),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(C,{onRegister:l.registerListModal,multi:n.multi,id:l.popTableName,addAuth:l.auths.add,onSuccess:l.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode($,{id:l.popTableName,onRegister:l.registerFormModal,onSuccess:l.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableCard=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-f6bb6746"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"}));const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(e,t){add("OnlineSelectCascade",OnlineSelectCascade),add("LinkTableSelect",LinkTableSelect),add("LinkTableCard",LinkTableCard);const n=e.modalClass,l=ref([]),g=ref(""),s=ref({}),m=reactive({}),y=ref(!1),F=ref([]),P=ref({}),O={},C=ref([]),$=reactive({}),_=ref("");_.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function I(M,j,J){clearObj($),$[g.value]=[];let L=[],N=[],p=[],b={},v={};Object.keys(M).map(u=>{const a=M[u];if(a.view=="tab"){y.value=!0,$[u]=[];let i={key:u,foreignKey:a.foreignKey,describe:a.describe,relationType:a.relationType,requiredFields:a.required||[],order:a.order,id:a.id};a.relationType==1?(O[u]=ref(null),i.properties=a.properties):(B(a),O[u]=ref(),i.columns=a.columns,b[u]=[]),L.push(i),handleSubTableButtonAuth(u,a)}else if(initDefValueConfig(u,a,$[g.value]),a.view===LINK_DOWN){let i=handleLinkDown(a,u);for(let r of i){m[r.key]=!0,m[r.key+"_load"]=!0;let c=FormSchemaFactory.createFormSchema(r.key,r);J&&c.setOnlyValidateFun(J),c.isRequired(j),c.setFormRef(t),c.handleWidgetAttr(a);let d=getFieldIndex(N,r.key);d==-1?N.push(c):N[d]=c}}else if(m[u]=!0,m[u+"_load"]=!0,getFieldIndex(N,u)==-1){let r=FormSchemaFactory.createFormSchema(u,a);if(J&&r.setOnlyValidateFun(J),r.isRequired(j),r.setFormRef(t),N.push(r),p.push(...r.getRelatedHideFields()),a.view===LINK_TABLE_FIELD){let c=r.getLinkFieldInfo();c&&(v[c[0]]?v[c[0]].push(c[1]):v[c[0]]=[c[1]])}}}),N.sort(function(u,a){return u.order-a.order});let x=[];x.push(FormSchemaFactory.createIdField());for(let u of N)u.view&&u.view==LINK_TABLE&&v[u.field]&&u.setOtherInfo(v[u.field]),p.indexOf(u.field)>=0&&u.isHidden(),n&&u.setCustomPopContainer(n),x.push(u.getFormItemSchema());l.value=x,L.sort(function(u,a){return u.order-a.order}),F.value=L,P.value=b}watch(m,M=>{let j=t.value,J=[],L=toRaw(M);Object.keys(L).map(N=>{if(!N.endsWith("_load")){let p={field:N,show:L[N]},b=N+"_load";L.hasOwnProperty(b)&&(p.ifShow=L[b]),J.push(p)}}),j&&j.updateSchema(J)},{immediate:!1});function B(M){useOnlineVxeTableColumns(M,j=>{initSubTableDefValueConfig(j,$[M.key])})}watch(()=>e.formTemplate,()=>{_.value=D()},{immediate:!0});function D(){let M=e.formTemplate;return M==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:M==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:M==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{span:24}}function R(M,j){return new Promise(J=>{j||J("");let N={tableName:g.value.replace(/\$\d+/,""),fieldName:M.field,fieldVal:j},p=s.value;p.id&&(N.dataId=p.id),duplicateCheck(N).then(b=>{b.success?J(""):J(b.message)}).catch(b=>{J(b)})})}function k(M){return Object.keys(M).map(j=>{M[j]&&M[j]instanceof Array&&(M[j]=M[j].join(","))}),M}return{formSchemas:l,defaultValueFields:$,tableName:g,dbData:s,checkOnlyFieldValue:R,createFormSchemas:I,fieldDisplayStatus:m,subTabInfo:F,hasSubTable:y,subDataSource:P,baseColProps:_,changeDataIfArray2String:k,linkDownList:C,refMap:O}}function useOnlineVxeTableColumns(e,t){const n={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};e.columns.forEach(s=>{s.type==="radio"?s.type="select":n[s.type]?s.type=n[s.type]:s.type==="popup"&&l(s),s.type==="depart-select"&&(s.checkStrictly=!0),s.type==="user-select"&&g(s),s.type==="pca"&&(s.width="230px"),(s.width==120||s.width=="120px")&&(s.type=="image"||s.type=="file")&&(s.width="130px"),s.width||(s.width="200px"),t&&t(s)});function l(s){let{destFields:m,orgFields:y}=s,F=[];if(!(!m||m.length==0)){let P=m.split(","),O=y.split(",");for(let C=0;C<P.length;C++)F.push({target:P[C],source:O[C]})}s.fieldConfig=F}function g(s){let m=s.fieldExtendJson,y=!1;if(m)try{JSON.parse(m).multiSelect===!1&&(y=!0)}catch(F){console.log("\u5B50\u8868\u83B7\u53D6\u7528\u6237\u7EC4\u4EF6\u7684\u6269\u5C55\u914D\u7F6E\u51FA\u73B0\u9519\u8BEF",F)}s.isRadioSelection=y}}function useOnlineFormContext(){let e={};const t={},n=new Proxy(t,{get(s,m){return Reflect.get(e,m)}});function l(s,m){e[s]=m}function g(s){Object.keys(s).map(m=>{e[m]=s[m]})}return l("$nextTick",nextTick),l("addObject2Context",l),{onlineFormContext:n,addObject2Context:l,resetContext:g}}function handleLinkDown(e,t){const{config:{table:n,key:l,txt:g,linkField:s,idField:m,pidField:y,condition:F},others:P,order:O,title:C}=e;let $={dictTable:n,dictText:g,dictCode:l,pidField:y,idField:m,view:LINK_DOWN,type:e.type},_=[],I=__spreadValues({key:t,title:C,order:O,condition:F,origin:!0},$);if(s&&s.length>0){let B=s.split(",");I.next=B[0];for(let D=0;D<B.length;D++)for(let R of P)if(R.field==B[D]){let k=__spreadValues({key:R.field,title:R.title,order:R.order,origin:!1},$);D+1<B.length&&(k.next=B[D+1]),_.push(k)}}return _.push(I),_}function getFieldIndex(e,t){let n=-1;for(let l=0;l<e.length;l++)if(e[l].field===t){n=l;break}return n}function getRefPromise(e){return new Promise(t=>{(function n(){let l=e.value;l?t(l):setTimeout(()=>{n()},100)})()})}function clearObj(e){Object.keys(e).map(t=>{delete e[t]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(e,t){let n=t.hideButtons,l=ONL_AUTH_PRE+e+":";n||(n=[]),permissionStore.setOnlineSubTableAuth(l,n)}function getDetailFormSchemas(e){const t=ref([]),n={},l=ref(!1),g=ref([]),s=ref({}),m=computed(()=>{let C=e.formTemplate;return C=="2"?12:C=="3"?8:C=="4"?6:24});function y(C){let $=[];console.log("111",C);let _=[],I={};Object.keys(C).map(B=>{const D=C[B];if(D.view=="tab"){l.value=!0;let R={key:B,foreignKey:D.foreignKey,describe:D.describe,relationType:D.relationType,requiredFields:D.required||[],order:D.order};D.relationType==1?(n[B]=ref(null),R.properties=D.properties):(F(D),n[B]=ref(),R.columns=D.columns,I[B]=[]),$.push(R)}else if(D.view===LINK_DOWN){let R=O(D,B);for(let k of R){let M=P(_,k.key),j={field:k.key,label:k.title,view:k.view,order:k.order,dictTable:k.dictTable,linkField:k.linkField||""};M==-1?_.push(j):_[M]=j}}else if(D.view!="hidden"){if(P(_,B)==-1){let k=Object.assign({field:B,label:D.title},pick$1(D,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(D.view=="file"&&(k.span=24,k.isFile=!0),D.view=="image"&&(k.span=24,k.isImage=!0),D.view=="link_table"&&D.fieldExtendJson)try{let M=JSON.parse(D.fieldExtendJson);M.showType!="select"&&(k.isCard=!0),M.multiSelect==!0&&(k.multi=!0)}catch(M){console.error("\u89E3\u6790json\u5B57\u7B26\u4E32\u51FA\u9519",D.fieldExtendJson)}(D.view=="umeditor"||D.view=="markdown")&&(k.isHtml=!0,k.span=24),_.push(k)}}}),_.sort(function(B,D){return B.order-D.order}),$.sort(function(B,D){return B.order-D.order}),g.value=$;for(let B=0;B<_.length;B++){let D=_[B];if((D.isFile===!0||D.isImage===!0||D.isHtml===!0)&&B>0){let R=_[B-1],k=R.span||m.value;R.span=k}}t.value=_,s.value=I,console.log("adadad",_)}function F(C){useOnlineVxeTableColumns(C)}function P(C,$){let _=-1;for(let I=0;I<C.length;I++)if(C[I].field===$){_=I;break}return _}function O(C,$){let _=[];const{config:{table:I,key:B,txt:D,linkField:R},order:k,title:M,others:j}=C;let J={table:I,key:B,txt:D},L={view:"link_down",order:k,title:M,dictTable:JSON.stringify(J)};if(_.push(Object.assign({},{linkField:R,key:$},L)),R){let N=R.split(",");for(let p of N){let b="";for(let v of j)v.field==p&&(b=v.title);_.push(Object.assign({},{key:p},L,{title:b}))}}return _}return{detailFormSchemas:t,hasSubTable:l,subTabInfo:g,refMap:n,createFormSchemas:y,formSpan:m,subDataSource:s}}const useAutoForm=Object.freeze(Object.defineProperty({__proto__:null,L:LinkTableCard,O:OnlineSubForm,a:OnlinePopModal,b:useFormItems,c:useEnhance,d:getDetailFormSchemas,e:loadOneFieldDefVal,f:LINK_DOWN,g:getRefPromise,h:handleLinkDown,i:getFieldIndex,j:useTableColumns,k:useAutoModal,l:loadFormFieldsDefVal,m:OnlineSubForm$1,n:OnlinePopForm$1,o:OnlinePopModal$1,p:LinkTableSelect$1,q:OnlinePopListModal$1,r:LinkTableCard$1,u:useOnlineFormContext},Symbol.toStringTag,{value:"Module"}));export{DiffOutlined$1 as D,LinkTableCard as L,OnlineSubForm as O,PrinterOutlined$1 as P,OnlinePopModal as a,useFormItems as b,useEnhance as c,getDetailFormSchemas as d,loadOneFieldDefVal as e,LINK_DOWN as f,getRefPromise as g,handleLinkDown as h,getFieldIndex as i,useTableColumns as j,useAutoModal as k,loadFormFieldsDefVal as l,useAutoForm as m,useOnlineFormContext as u};
