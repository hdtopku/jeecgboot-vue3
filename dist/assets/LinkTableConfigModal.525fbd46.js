import{B as e}from"./index.e1e06dd6.js";import{B as t}from"./BasicForm.d9f6c231.js";import"./helper.1c9dc9a5.js";import{u as i}from"./useForm.45d68074.js";import"./JAddInput.8c125e2c.js";import{f0 as l,F as o,bH as a,o as n,t as r,v as d,V as s,z as c,y as p,B as m,a1 as u}from"./index.435ab247.js";import{o as b}from"./omit.d6518a29.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import"./_baseClone.a8082016.js";import"./_arrayPush.8821345e.js";import"./_flatRest.ff1861ce.js";import"./BasicModal.c66de981.js";import"./useWindowSizeFn.3d5b1a05.js";import"./uniqBy.91f18935.js";import"./useFormItem.816007c4.js";import"./functional.be5901d6.js";import"./download.5dc68cfb.js";import"./base64Conver.030fa32c.js";import"./index.a5502478.js";import"./index.64086148.js";import"./useCountdown.adc4ab77.js";import"./JUpload.e164672b.js";import"./api.bc301b0f.js";import"./index.cdc49bf1.js";import"./props.5467b933.js";import"./index.713dc63d.js";import"./bem.0e923c54.js";import"./props.37836c63.js";import"./useContextMenu.82ce6d89.js";import"./index.e1ec35e6.js";import"./onMountedOrActivated.e9ddbd41.js";import"./index.627c6cd3.js";import"./htmlmixed.749cbc8c.js";import"./vue.f62dfd4a.js";/* empty css             */import"./depart.api.c07add53.js";import"./_baseSlice.23bb44df.js";var f=Object.defineProperty,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,v=(e,t,i)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,y=(e,t,i)=>new Promise(((l,o)=>{var a=e=>{try{r(i.next(e))}catch(t){o(t)}},n=e=>{try{r(i.throw(e))}catch(t){o(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,n);r((i=i.apply(e,t)).next())}));var F=l({name:"LinkTableConfigModal",emits:["success","register"],components:{BasicModal:e,BasicForm:t},setup(e,{emit:t}){const l=o(!1),r=o("");let d={};const[s,{closeModal:c}]=a((e=>y(this,null,(function*(){d=((e,t)=>{for(var i in t||(t={}))h.call(t,i)&&v(e,i,t[i]);if(g)for(var i of g(t))j.call(t,i)&&v(e,i,t[i]);return e})({},e.record),yield T({dictTable:e.record.dictTable}),setTimeout((()=>y(this,null,(function*(){let t=b(e.record,"dictTable");yield T(t),yield B()}))),200),r.value=e.fieldName})))),p=o(""),m=o(""),f=o([]),F=o([]);function x(e){return y(this,null,(function*(){p.value="",m.value="",yield function(e){return y(this,null,(function*(){if(e){const t="/online/cgform/field/listByHeadCode",i=yield u.get({url:t,params:{headCode:e}});if(i&&i.length>0){let e=i.filter((e=>"id"!=e.dbFieldName&&1==e.dbIsPersist));e.length>0?f.value=e.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):f.value=[];let t=i.filter((e=>"id"!=e.dbFieldName&&"image"==e.fieldShowType&&1==e.dbIsPersist));t.length>0?F.value=t.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}else f.value=[],F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}}))}(e)}))}const C=n((()=>{let e=f.value,t=p.value,i=m.value;return e.filter((e=>e.value!=t&&e.value!=i))})),w=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"dictField",field:"dictField",component:"Input",defaultValue:"id",show:!1},{label:"字段描述",field:"dbFieldTxt",component:"Input",required:!0},{label:"关联表",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({dict:"onl_cgform_head where copy_type = 0,table_txt,table_name",pageSize:10,async:!0,immediateChange:!0,popContainer:".link-table-config-modal",params:{order:"desc",column:"create_time"},onChange:t=>y(this,null,(function*(){(d.titleField||d.otherFields)&&(yield e.setFieldsValue({titleField:"",otherFields:"",imageField:""}),yield e.clearValidate()),yield x(t)}))})},{label:"标题字段",field:"titleField",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:f,immediateChange:!0,onChange:e=>{p.value=e,d.titleField=e}}},{label:"封面图片",field:"imageField",component:"JSearchSelect",componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:F,immediateChange:!0,onChange:e=>{m.value=e,d.imageFieldName=e}}},{label:"其他字段",field:"otherFields",component:"JSelectMultiple",componentProps:{popContainer:".link-table-config-modal",options:C,onChange:e=>{d.otherFields=e}}},{label:"显示方式",field:"showType",component:"Select",defaultValue:"card",componentProps:{options:[{label:"卡片",value:"card"},{label:"下拉框",value:"select"}]}},{label:"是否多选",field:"multiSelect",component:"RadioGroup",defaultValue:!1,componentProps:{options:[{label:"否",value:!1},{label:"是",value:!0}]}}],[S,{validate:P,setFieldsValue:T,clearValidate:B,resetFields:_}]=i({schemas:w,showActionButtonGroup:!1,labelAlign:"right"});return{registerModal:s,spinningLoading:l,registerForm:S,handleSubmit:function(){return y(this,null,(function*(){let e=yield P();e.fieldName=r.value,t("success",e),c()}))}}}},[["render",function(e,t,i,l,o,a){const n=r("BasicForm"),u=r("a-spin"),b=r("BasicModal");return d(),s(b,m({wrapClassName:"link-table-config-modal"},e.$attrs,{title:"关联记录配置",onRegister:l.registerModal,keyboard:"",canFullscreen:!1,cancelText:"关闭",onOk:l.handleSubmit}),{default:c((()=>[p(u,{spinning:l.spinningLoading},{default:c((()=>[p(n,{onRegister:l.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16,["onRegister","onOk"])}]]);export{F as default};
