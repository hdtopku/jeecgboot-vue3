import{j as be,aX as we,C as o,cF as _,dm as De,dn as Fe,X as xe,r as s,s as i,t as x,v as n,w as l,aW as Be,y as v,dp as Oe,N as Q,O as V,R as h,Q as k,H as B,dl as Ae,dq as Se,S as E,bx as Ne,ax as X,bc as ue,z as J,b5 as Ee,dr as se,ac as Pe}from"./index.086d23f2.js";import{g as Ue}from"./api.328d33f3.js";const $e=c=>{if(c==null)return"";const I=/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,b=c.match(I);return b!=null?b[0]:c},Me=()=>navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)!=null,je=()=>!Me(),ze={class:"flex flex-wrap justify-evenly"},Le={key:0,class:"flex flex-wrap justify-evenly"},Te={key:2},Ye={key:1,class:"flex flex-wrap justify-evenly"},He=be({__name:"Search",props:{placeholder:{type:String,default:"\u7C98\u8D34\u641C\u7D22"},showTop:{type:Boolean,default:!1},showCopy:{type:Boolean,default:!1},showPeople:{type:Boolean,default:!1},tabPane:{type:Object,default:()=>({tabs:[],activeKey:"0"})},switchName:{type:String,default:""}},emits:["queryList","changeAdvanced","confirmCopy"],setup(c,{expose:I,emit:b}){var te;const p=c,{hasPermission:W}=we(),f=o(_()),w=o(_()),u=o(),d=o(1),G=o(!0),P=o(!1),U=o(!1),K=o([]),m=o(0),D=o(!1),g=o(!1),oe=e=>e&&e>_().endOf("day"),ie=e=>e&&e>_().endOf("day")||e.isBefore(f.value),C=o(),O=(e,a=0)=>{m.value=e,m.value===365?f.value=_().startOf("year"):m.value===100?f.value=_().startOf("month"):f.value=_().subtract(e,"day"),w.value=_().subtract(a,"day"),C.value=!1,y()},Z=()=>{C.value=!0,y()},re=()=>{navigator.clipboard.readText().then(e=>{u.value=e,y()}).catch(e=>{e instanceof DOMException?se.error("\u8BF7\u624B\u52A8\u7C98\u8D34\uFF0C\u6216\u5141\u8BB8\u8BFB\u53D6\u526A\u8D34\u677F\uFF0C\u5931\u8D25\u539F\u56E0\uFF1A"+e):se.error("\u8BF7\u624B\u52A8\u7C98\u8D34\uFF0C\u5931\u8D25\u539F\u56E0\uFF1A"+e)})},R=()=>{var e;return G.value?g.value&&((e=p.switchName)==null?void 0:e.length)>0?"warning":"primary":"error"},ce=()=>{K.value.length===0&&(U.value=!0,Ue({}).then(e=>{K.value=e.records,U.value=!1}))},q=De(Fe),A=o();let{username:$,realname:de}=q==null?void 0:q.userInfo;const ve=$;A.value=de;const fe=e=>{$=e,G.value=ve===A.value,e==null&&(A.value="\u6240\u6709\u4EBA"),y()},M=o((te=p==null?void 0:p.tabPane)==null?void 0:te.activeKey),pe=e=>{M.value=e,y()},y=()=>{var a,r,F,S,j,z,L,T,Y;f.value.isAfter(w.value)&&(w.value=f.value),u.value=$e((a=u==null?void 0:u.value)==null?void 0:a.trim());let e=(r=u.value)==null?void 0:r.indexOf("/j/");e<0&&(e=(F=u.value)==null?void 0:F.indexOf("/c/")),e<0&&(e=(S=u.value)==null?void 0:S.indexOf("/d/")),e>=0&&(u.value=(j=u.value)==null?void 0:j.substring(e+3)),e<0&&(e=(z=u.value)==null?void 0:z.indexOf("/jb/"),e>=0&&(u.value=(L=u.value)==null?void 0:L.substring(e+4)),e=(T=u.value)==null?void 0:T.indexOf("/jc/"),e>=0&&(u.value=(Y=u.value)==null?void 0:Y.substring(e+4))),localStorage.setItem("searchSwitch:"+p.switchName,JSON.stringify(g.value)),b("queryList",{pageNo:1,pageSize:30,startTime:f.value.startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:w.value.endOf("day").format("YYYY-MM-DD HH:mm:ss"),keyword:u.value,username:$,checked:g.value,status:M.value})},me=()=>{D.value=!D.value,b("changeAdvanced")},ee=()=>{P.value=!0,b("confirmCopy",{count:d.value,username:$,checked:g.value})},{proxy:ae}=Pe();return I({queryFinish:(e="")=>{d.value===1?ae.tool.copy(e,e+"\u5DF2\u590D\u5236"):ae.tool.copy(e,d.value+"\u6761\u5DF2\u590D\u5236"),P.value=!1}}),xe(()=>{var e;g.value=JSON.parse((e=localStorage.getItem("searchSwitch:"+p.switchName))!=null?e:"false"),y()}),(e,a)=>{var le,ne;const r=s("a-button"),F=s("a-space"),S=s("a-date-picker"),j=s("a-select-option"),z=s("a-spin"),L=s("a-select"),T=s("a-switch"),Y=s("a-input"),ye=s("a-card"),H=s("a-col"),_e=s("a-slider"),ke=s("a-popconfirm"),ge=s("a-row"),Ce=s("a-tab-pane"),he=s("a-tabs");return i(),x(X,null,[n(ye,{size:"small"},{default:l(()=>[Be("div",ze,[c.showTop?(i(),x("div",Le,[n(F,{size:5,class:"mb-2"},{default:l(()=>[n(r,{type:!C.value&&m.value===365?"link":"",onClick:a[0]||(a[0]=t=>O(365,0))},{default:l(()=>[v("\u4ECA\u5E74 ")]),_:1},8,["type"]),n(r,{type:!C.value&&m.value===30?"link":"",onClick:a[1]||(a[1]=t=>O(30,0))},{default:l(()=>[v(" 30\u5929 ")]),_:1},8,["type"]),n(r,{type:!C.value&&m.value===100?"link":"",onClick:a[2]||(a[2]=t=>O(100))},{default:l(()=>[v(" \u672C\u6708 ")]),_:1},8,["type"]),n(r,{type:!C.value&&m.value===1?"link":"",onClick:a[3]||(a[3]=t=>O(1,1))},{default:l(()=>[v(" \u6628\u5929 ")]),_:1},8,["type"]),n(r,{type:!C.value&&m.value===0?"link":"",onClick:a[4]||(a[4]=t=>O(0,0))},{default:l(()=>[v(" \u4ECA\u5929 ")]),_:1},8,["type"])]),_:1}),n(Oe,{"enter-active-class":"animate__animated animate__flipInX","leave-active-class":"animate__animated animate__flipOutX animate__faster"},{default:l(()=>[Q(n(F,{class:"mb-2"},{default:l(()=>[n(S,{onChange:Z,allowClear:"",placeholder:"\u5F00\u59CB\u65E5\u671F","disabled-date":oe,value:f.value,"onUpdate:value":a[5]||(a[5]=t=>f.value=t)},null,8,["value"]),n(S,{onChange:Z,allowClear:"",placeholder:"\u7ED3\u675F\u65E5\u671F","disabled-date":ie,value:w.value,"onUpdate:value":a[6]||(a[6]=t=>w.value=t)},null,8,["value"])]),_:1},512),[[V,D.value]])]),_:1})])):h("",!0),n(Y,{size:"large",value:u.value,"onUpdate:value":a[10]||(a[10]=t=>u.value=t),onChange:y,placeholder:c.placeholder,allowClear:""},{prefix:l(()=>[n(r,{type:"link",onClick:me},{default:l(()=>[D.value?(i(),k(B(Ae),{key:0})):(i(),k(B(Se),{key:1}))]),_:1}),E(e.$slots,"prefix"),D.value?(i(),k(F,{key:0},{default:l(()=>[B(W)("am:selectUser")&&c.showPeople?(i(),k(L,{key:0,size:"",loading:U.value,allowClear:"",ref:"select",value:A.value,"onUpdate:value":a[7]||(a[7]=t=>A.value=t),style:{width:"90px"},onFocus:ce,onChange:fe},Ne({default:l(()=>[(i(!0),x(X,null,ue(K.value,t=>(i(),k(j,{key:t.id,value:t.username},{default:l(()=>[v(J(t.realname),1)]),_:2},1032,["value"]))),128))]),_:2},[U.value?{name:"notFoundContent",fn:l(()=>[n(z,{size:"small"})]),key:"0"}:void 0]),1032,["loading","value"])):h("",!0),B(je)()?(i(),k(r,{key:1,ghost:"",type:"success",onClick:re},{default:l(()=>[v("\u7C98\u8D34")]),_:1})):h("",!0)]),_:1})):h("",!0)]),suffix:l(()=>{var t;return[D.value?E(e.$slots,"suffix",{key:0}):E(e.$slots,"suffixInAdvanced",{key:1}),E(e.$slots,"suffixAdvanced"),((t=c.switchName)==null?void 0:t.length)>0&&B(W)("link:switch")?(i(),x("span",Te,[n(r,{class:"animate__animated animate__heartBeat animate__slower animate__repeat-3",onClick:a[8]||(a[8]=N=>B(Ee).push("/pms/am/link")),type:"link",danger:""},{default:l(()=>[v("\u6FC0\u6D3B\u94FE")]),_:1}),n(T,{onClick:y,checked:g.value,"onUpdate:checked":a[9]||(a[9]=N=>g.value=N)},null,8,["checked"])])):h("",!0)]}),_:3},8,["value","placeholder"])])]),_:3}),c.showCopy?(i(),k(ge,{key:0,class:"w-full mt-2"},{default:l(()=>[n(H,{span:4},{default:l(()=>[E(e.$slots,"left")]),_:3}),n(H,{span:14},{default:l(()=>[n(_e,{style:{display:"inline-block"},value:d.value,"onUpdate:value":a[11]||(a[11]=t=>d.value=t),min:1,max:500},null,8,["value"])]),_:1}),n(H,{class:"text-center",span:6},{default:l(()=>[Q(n(r,{onClick:ee,loading:P.value,type:R()},{default:l(()=>[v("\u590D\u5236"+J(d.value)+"\u6761 ",1)]),_:1},8,["loading","type"]),[[V,d.value===1]]),n(ke,{title:`\u786E\u5B9A\u590D\u5236${d.value}\u6761\u5417?`,"ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",onConfirm:ee},{default:l(()=>[Q(n(r,{loading:P.value,placeholder:"\u5F00\u59CB\u65E5\u671F",type:R()},{default:l(()=>[v("\u590D\u5236"+J(d.value)+"\u6761 ",1)]),_:1},8,["loading","type"]),[[V,d.value>1]])]),_:1},8,["title"])]),_:1})]),_:3})):h("",!0),((ne=(le=p.tabPane)==null?void 0:le.tabs)==null?void 0:ne.length)>0?(i(),x("div",Ye,[n(he,{animated:!1,activeKey:M.value,"onUpdate:activeKey":a[12]||(a[12]=t=>M.value=t),onTabClick:pe},{default:l(()=>{var t;return[(i(!0),x(X,null,ue((t=p.tabPane)==null?void 0:t.tabs,N=>(i(),k(Ce,{key:N.tabKey,tab:N.tabName},null,8,["tab"]))),128))]}),_:1},8,["activeKey"])])):h("",!0)],64)}}});export{He as _};
