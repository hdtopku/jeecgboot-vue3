var e=(e,a,l)=>new Promise(((t,n)=>{var o=e=>{try{s(l.next(e))}catch(a){n(a)}},r=e=>{try{s(l.throw(e))}catch(a){n(a)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);s((l=l.apply(e,a)).next())}));import{_ as a}from"./index.c4683457.js";import{u as l,a as t,B as n}from"./index.19984ae3.js";import{l as o,F as r,t as s,v as i,x as u,y as d,z as c,aW as v,V as p,D as y,W as f,L as m,ax as g,C as h}from"./index.b3c93d64.js";import k from"./DepartRoleDataRuleDrawer.355b49e4.js";import{i as x,j,k as D}from"./depart.user.api.c569e3bf.js";import"./bem.3d3e77ca.js";import"./props.c13d8268.js";import"./useContextMenu.de287960.js";const I=h("仅保存"),w=o({__name:"DepartRoleAuthDrawer",emits:["register"],setup(o){const h=r(!1),w=r(""),R=r(""),b=r([]),_=r([]),K=r([]),C=r([]),F=r([]),S=r([]),T=r(!0),[E,{closeDrawer:L}]=l((e=>{R.value=e.record.id,w.value=e.record.departId,z()})),[P,W]=t();function z(){return e(this,null,(function*(){try{h.value=!0;const{ids:e,treeList:a}=yield x({departId:w.value});e.length>0?(S.value=e,C.value=e,b.value=a,_.value=yield j({roleId:R.value}),K.value=[_.value]):A()}finally{h.value=!1}}))}function A(){b.value=[],C.value=[],_.value=[],K.value=[],h.value=!1}function B(e){T.value?_.value=e.checked:_.value=e}function M(e){C.value=e}function N(e,{selectedNodes:a}){var l;if(null==(l=a[0])?void 0:l.ruleFlag){let a=e[0];W.openDrawer(!0,{roleId:R,departId:w,functionId:a})}F.value=[]}function O(){A()}function V(a){return e(this,null,(function*(){try{h.value=!0;let e={roleId:R.value,permissionIds:_.value.join(","),lastpermissionIds:K.value.join(",")};yield D(e),a&&(A(),L())}finally{h.value=!1,a||z()}}))}return(e,l)=>{const t=s("Icon"),o=s("a-empty"),r=s("a-spin"),x=s("a-button");return i(),u(g,null,[d(m(n),{title:"部门角色权限配置",width:650,loading:h.value,showFooter:"",okText:"保存并关闭",onOk:l[1]||(l[1]=e=>V(!0)),onClose:O,onRegister:m(E)},{centerFooter:c((()=>[d(x,{type:"primary",loading:h.value,ghost:"",onClick:l[0]||(l[0]=e=>V(!1))},{default:c((()=>[I])),_:1},8,["loading"])])),default:c((()=>[v("div",null,[d(r,{spinning:h.value},{default:c((()=>[b.value.length>0?(i(),p(m(a),{key:0,title:"所拥有的部门权限",toolbar:"",checkable:"",treeData:b.value,checkedKeys:_.value,selectedKeys:F.value,expandedKeys:C.value,checkStrictly:T.value,clickRowToExpand:!1,onCheck:B,onExpand:M,onSelect:N},{title:c((({slotTitle:e,ruleFlag:a})=>[v("span",null,y(e),1),a?(i(),p(t,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):f("",!0)])),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(i(),p(o,{key:1,description:"无可配置部门权限"}))])),_:1},8,["spinning"])])])),_:1},8,["loading","onRegister"]),d(k,{onRegister:m(P)},null,8,["onRegister"])],64)}}});export{w as default};
