var k=(e,i,o)=>new Promise((E,n)=>{var F=l=>{try{u(o.next(l))}catch(d){n(d)}},m=l=>{try{u(o.throw(l))}catch(d){n(d)}},u=l=>l.done?E(l.value):Promise.resolve(l.value).then(F,m);u((o=o.apply(e,i)).next())});import{l as x,A as ee,d4 as ae,F as p,a7 as te,bG as ue,o as se,L as r,q as oe,a1 as ne,t as v,v as _,V as B,z as t,y as g,bj as L,E as M,x as w,bb as T,C as h,D as z,aw as N,W as U,B as V,u as le,dl as re,dm as ie,aV as D}from"./index.b3d2a891.js";import{B as de}from"./index.2d23bddf.js";import"./BasicModal.7efd78fc.js";import"./useWindowSizeFn.ab02708a.js";const ce=x({name:"loginSelect",components:{Avatar:ee,BasicModal:de},emits:["success","register"],setup(e,{emit:i}){const o=ae(),{notification:E}=le(),n=p(!1),F=p([]),m=p(""),u=p(!1),l=p([]),d=p(""),C=p(!1),b=p(""),y=p(),c=te({orgCode:void 0,tenantId:null}),s={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},[q,{closeModal:$}]=ue(),H=se(()=>{if(r(u)&&r(n))return"\u8BF7\u9009\u62E9\u79DF\u6237\u548C\u90E8\u95E8";if(r(u)&&!r(n))return"\u8BF7\u9009\u62E9\u90E8\u95E8";if(!r(u)&&r(n))return"\u8BF7\u9009\u62E9\u79DF\u6237"}),P=p({tenantId:[{required:r(n),type:"number",message:"\u8BF7\u9009\u62E9\u79DF\u6237",trigger:"change"}],orgCode:[{required:r(u),message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:"change"}]}),j={labelCol:{span:4},wrapperCol:{span:18}};function G(a){let f=a.multi_depart;f==0?(E.warn({message:"\u63D0\u793A",description:"\u60A8\u5C1A\u672A\u5F52\u5C5E\u90E8\u95E8,\u8BF7\u786E\u8BA4\u8D26\u53F7\u4FE1\u606F",duration:3}),u.value=!1):f==2?(u.value=!0,l.value=a.departs):u.value=!1}function W(a){let f=a.tenantList;Array.isArray(f)&&(f.length===0?(n.value=!1,o.setTenant(c.tenantId)):f.length===1?(c.tenantId=f[0].id,n.value=!1,o.setTenant(c.tenantId)):(n.value=!0,F.value=f))}function J(){if(r(n)&&!c.tenantId)return m.value="error",!1;if(r(u)&&!c.orgCode)return d.value="error",!1;y.value.validate().then(()=>{K().then(()=>{o.setTenant(c.tenantId),i("success")}).catch(a=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",a)}).finally(()=>{Q()})}).catch(a=>{console.log("\u8868\u5355\u6821\u9A8C\u672A\u901A\u8FC7error",a)})}function K(){return new Promise((a,f)=>{if(!r(u))a();else{let Z={orgCode:c.orgCode,username:r(b)};ne.put({url:"/sys/selectDepart",params:Z}).then(I=>{I.userInfo?(o.setUserInfo(I.userInfo),a()):(O(I),o.logout(),f())})}})}function O(a){E.error({message:"\u767B\u5F55\u5931\u8D25",description:((a.response||{}).data||{}).message||a.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function Q(){$(),S()}function R(a){return k(this,null,function*(){a&&(b.value=o.username,yield S(),yield G(a),yield W(a),!r(u)&&!r(n)?i("success",o.getUserInfo):C.value=!0),a.isLogin=!1,o.setLoginInfo(a)})}function S(){F.value=[],m.value="",l.value=[],d.value=""}function X(a){m.value=""}function Y(a){d.value=""}return{registerModal:q,visible:C,tenantList:F,isMultiTenant:n,validate_status:m,isMultiDepart:u,departList:l,validate_status1:d,formState:c,rules:P,layout:j,formRef:y,currTitle:H,config:s,handleTenantChange:X,handleDepartChange:Y,show:R,handleSubmit:J}}}),A=e=>(re("data-v-bfacad1e"),e=e(),ie(),e),fe=A(()=>D("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),pe=h(" \u79DF\u6237 "),me=A(()=>D("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),ve=A(()=>D("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),ge=h(" \u90E8\u95E8 "),_e=A(()=>D("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),Fe=h("\u786E\u8BA4");function Ee(e,i,o,E,n,F){const m=v("a-avatar"),u=v("a-tooltip"),l=v("a-select-option"),d=v("a-select"),C=v("a-form-item"),b=v("a-form"),y=v("a-button"),c=v("BasicModal");return _(),B(c,V(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":i[2]||(i[2]=s=>e.visible=s)}),{footer:t(()=>[g(y,{onClick:e.handleSubmit,type:"primary"},{default:t(()=>[Fe]),_:1},8,["onClick"])]),default:t(()=>[g(b,V({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:t(()=>[e.isMultiTenant?(_(),B(C,{key:0,name:"tenantId","validate-status":e.validate_status},L({label:t(()=>[g(u,{placement:"topLeft"},{title:t(()=>[fe]),default:t(()=>[g(m,{style:{"background-color":"#87d068"},size:30},{default:t(()=>[pe]),_:1})]),_:1})]),default:t(()=>[g(d,{value:e.formState.tenantId,"onUpdate:value":i[0]||(i[0]=s=>e.formState.tenantId=s),onChange:e.handleTenantChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",class:M({"valid-error":e.validate_status=="error"})},{default:t(()=>[(_(!0),w(N,null,T(e.tenantList,s=>(_(),B(l,{key:s.id,value:s.id},{default:t(()=>[h(z(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status=="error"?{name:"extra",fn:t(()=>[me]),key:"0"}:void 0]),1032,["validate-status"])):U("",!0),e.isMultiDepart?(_(),B(C,{key:1,"validate-status":e.validate_status1,colon:!1},L({label:t(()=>[g(u,{placement:"topLeft"},{title:t(()=>[ve]),default:t(()=>[g(m,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:t(()=>[ge]),_:1})]),_:1})]),default:t(()=>[g(d,{value:e.formState.orgCode,"onUpdate:value":i[1]||(i[1]=s=>e.formState.orgCode=s),onChange:e.handleDepartChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:M({"valid-error":e.validate_status1=="error"})},{default:t(()=>[(_(!0),w(N,null,T(e.departList,s=>(_(),B(l,{key:s.orgCode,value:s.orgCode},{default:t(()=>[h(z(s.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status1=="error"?{name:"extra",fn:t(()=>[_e]),key:"0"}:void 0]),1032,["validate-status"])):U("",!0)]),_:1},16,["model","rules"])]),_:1},16,["onRegister","title","visible"])}var De=oe(ce,[["render",Ee],["__scopeId","data-v-bfacad1e"]]);export{De as default};
