var d=(S,x,r)=>new Promise((A,g)=>{var B=l=>{try{a(r.next(l))}catch(i){g(i)}},p=l=>{try{a(r.throw(l))}catch(i){g(i)}},a=l=>l.done?A(l.value):Promise.resolve(l.value).then(B,p);a((r=r.apply(S,x)).next())});import"./index.2d23bddf.js";import{l as ye,bi as ve,F as c,bH as he,t as s,v as f,V as E,z as n,aV as m,y as o,W as q,x as K,D as P,aw as W,L as I,ee as ge,C as _,Q as z,u as ke,at as Ce}from"./index.b3d2a891.js";import{q as H,A as Q,d as De}from"./depart.api.7ce3d710.js";import{s as Ee}from"./depart.user.api.20049b4f.js";import xe from"./DepartFormModal.31b8f67e.js";import"./BasicModal.7efd78fc.js";import"./useWindowSizeFn.ab02708a.js";import"./BasicForm.2d2aa4ab.js";import"./helper.1b3fdfba.js";import"./useFormItem.c06072f5.js";import"./functional.4d8eb9e7.js";import"./download.2189cbe2.js";import"./base64Conver.030fa32c.js";import"./index.ea39cbd7.js";import"./index.792f7f1c.js";import"./useCountdown.a4eb9495.js";import"./JAddInput.43004d14.js";import"./api.1d3c1927.js";import"./props.eccfb3be.js";import"./index.7afb8201.js";import"./bem.8fd44f61.js";import"./props.9df65a00.js";import"./useContextMenu.2f0b587d.js";import"./index.bc22d773.js";import"./onMountedOrActivated.12413c39.js";import"./index.bcdb3c55.js";import"./htmlmixed.6d768be1.js";import"./vue.1e0c6574.js";/* empty css             */import"./JUpload.7bcd35c5.js";import"./index.96560ef2.js";import"./uniqBy.4cec2220.js";import"./useForm.96d1836c.js";import"./depart.data.ff6c9320.js";const Ae={class:"j-table-operator",style:{width:"100%"}},Be=_("\u65B0\u589E"),Fe=_("\u6DFB\u52A0\u4E0B\u7EA7"),we=_("\u5BFC\u5165"),Te=_("\u5BFC\u51FA"),be=_("\u540C\u6B65\u4F01\u5FAE?"),Ke=_("\u540C\u6B65\u9489\u9489?"),Ie=m("span",null,"\u5220\u9664",-1),Se=m("span",null,"\u6279\u91CF\u64CD\u4F5C ",-1),Re={key:1},Ve=_("\u6DFB\u52A0\u5B50\u7EA7"),Le=m("span",{style:{color:"red"}},"\u5220\u9664",-1),ht=ye({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(S,{expose:x,emit:r}){ve("prefixCls");const{createMessage:A}=ke(),{handleImportXls:g,handleExportXls:B}=Ce(),p=c(!1),a=c([]),l=c([]),i=c([]),h=c([]),F=c(!1),G=c(!0),w=c(null),T=c(null),J=c(""),[O,{openModal:R}]=he();function y(){return d(this,null,function*(){try{p.value=!0,a.value=[];const e=yield H();if(Array.isArray(e)&&(a.value=e),i.value.length===0)V();else if(h.value.length===0){let t=a.value[0];t&&k(t.id,t)}else r("select",w.value);r("rootTreeData",a.value)}finally{p.value=!1}})}y();function Y(e){return d(this,null,function*(){try{const t=yield H({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,i.value.length>0){let u=[];for(let C of i.value)t.findIndex(D=>D.id===C)!==-1&&u.push(C);u.length>0&&(i.value=[...i.value])}a.value=[...a.value],r("rootTreeData",a.value)}catch(t){console.error(t)}return Promise.resolve()})}function V(){let e=a.value[0];e?(e.isLeaf||(i.value=[e.key]),k(e.id,e),Z()):r("select",null)}function Z(){return d(this,null,function*(){yield z(),F.value=!0,yield z(),F.value=!1})}function k(e,t){h.value=[e],t&&(w.value=t,r("select",t))}function ee(){R(!0,{isUpdate:!1,isChild:!1})}function L(e=w.value){if(e==null){A.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};R(!0,{isUpdate:!1,isChild:!0,record:t})}function te(e){return d(this,null,function*(){if(e)try{p.value=!0,a.value=[];let t=yield Ee({keyWord:e});Array.isArray(t)&&(a.value=t),V()}finally{p.value=!1}else y();J.value=e})}function ne(e){Array.isArray(e)?l.value=e:l.value=e.checked}function oe(e,t){console.log("select: ",e,t),e.length>0&&h.value[0]!==e[0]?k(e[0],t.selectedNodes[0]):k(h.value[0])}function M(e,t=!0){return d(this,null,function*(){const u=I(e);if(u.length>0)try{p.value=!0,yield De({ids:u.join(",")},t),yield y()}finally{p.value=!1}})}function ae(e){return d(this,null,function*(){e&&(U(!1),M([e.id],!1))})}function le(){return d(this,null,function*(){try{yield M(l),l.value=[]}finally{}})}function U(e){e||(T.value=null)}function ue(e){g(e,Q.importExcelUrl,()=>{y()})}function se(){B("\u90E8\u95E8\u4FE1\u606F",Q.exportXlsUrl)}return x({loadRootTreeData:y}),(e,t)=>{const u=s("a-button"),C=s("a-upload"),D=s("icon"),b=s("a-menu-item"),$=s("a-menu"),X=s("a-dropdown"),ie=s("a-divider"),re=s("a-alert"),ce=s("a-input-search"),pe=s("a-tree"),de=s("a-empty"),fe=s("a-spin"),me=s("a-card");return f(),E(me,{bordered:!1,style:{height:"100%"}},{default:n(()=>[m("div",Ae,[o(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ee},{default:n(()=>[Be]),_:1}),o(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>L())},{default:n(()=>[Fe]),_:1}),o(C,{name:"file",showUploadList:!1,customRequest:ue},{default:n(()=>[o(u,{type:"primary",preIcon:"ant-design:import-outlined"},{default:n(()=>[we]),_:1})]),_:1}),o(u,{type:"primary",preIcon:"ant-design:export-outlined",onClick:se},{default:n(()=>[Te]),_:1}),o(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:n(()=>[be]),_:1}),o(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:n(()=>[Ke]),_:1}),l.value.length>0?(f(),E(X,{key:0},{overlay:n(()=>[o($,null,{default:n(()=>[o(b,{key:"1",onClick:le},{default:n(()=>[o(D,{icon:"ant-design:delete-outlined"}),Ie]),_:1})]),_:1})]),default:n(()=>[o(u,null,{default:n(()=>[Se,o(D,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):q("",!0)]),o(re,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:n(()=>[l.value.length>0?(f(),K(W,{key:0},[m("span",null,"\u5DF2\u9009\u4E2D "+P(l.value.length)+" \u6761\u8BB0\u5F55",1),o(ie,{type:"vertical"}),m("a",{onClick:t[1]||(t[1]=v=>l.value=[])},"\u6E05\u7A7A")],64)):(f(),K("span",Re,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),o(fe,{spinning:p.value},{default:n(()=>[o(ce,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:te}),a.value.length>0?(f(),K(W,{key:0},[F.value?q("",!0):(f(),E(pe,{key:0,checkable:"",clickRowToExpand:!1,treeData:a.value,selectedKeys:h.value,checkStrictly:G.value,"load-data":Y,checkedKeys:l.value,expandedKeys:i.value,"onUpdate:expandedKeys":t[3]||(t[3]=v=>i.value=v),onCheck:ne,onSelect:oe},{title:n(({key:v,title:_e,dataRef:N})=>[o(X,{trigger:["contextmenu"]},{overlay:n(()=>[o($,{onClick:t[2]||(t[2]=()=>{})},{default:n(()=>[o(b,{key:"1",onClick:j=>L(N)},{default:n(()=>[Ve]),_:2},1032,["onClick"]),o(b,{key:"2",onClick:j=>T.value=v},{default:n(()=>[Le]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(I(ge),{visible:T.value===v,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:j=>ae(N),onVisibleChange:U},{default:n(()=>[m("span",null,P(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(f(),E(de,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["spinning"]),o(xe,{rootTreeData:a.value,onRegister:I(O),onSuccess:y},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{ht as default};
