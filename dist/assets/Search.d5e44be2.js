import{l as e,aY as a,F as l,c3 as t,di as u,dj as n,$ as s,t as o,v as i,x as v,y as d,z as r,aW as c,dk as p,R as f,S as y,W as m,V as h,L as k,dl as _,dm as b,X as w,bk as g,ax as x,bc as C,C as O,D as S,b5 as B,dn as P,a6 as U}from"./index.435ab247.js";import{extractUrl as j}from"./urlUtil.a560444b.js";import{g as Y}from"./api.bc301b0f.js";const M=()=>!(null!=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)),z={class:"flex flex-wrap justify-evenly"},A={key:0,class:"flex flex-wrap justify-evenly"},D=O("今年 "),K=O(" 30天 "),T=O(" 本月 "),$=O(" 昨天 "),F=O(" 今天 "),I=O("粘贴"),N={key:1},H=O("激活链"),W={key:1,class:"flex flex-wrap justify-evenly"},q=e({__name:"Search",props:{placeholder:{type:String,default:"粘贴搜索"},showTop:{type:Boolean,default:!1},showCopy:{type:Boolean,default:!1},showSwitch:{type:Boolean,default:!1},showPeople:{type:Boolean,default:!1},tabPane:{type:Object,default:()=>({tabs:[],activeKey:"0"})}},emits:["queryList","changeAdvanced","confirmCopy"],setup(e,{expose:q,emit:J}){var L;const X=e,{hasPermission:E}=a(),Q=l(t()),G=l(t()),R=l(),V=l(1),Z=l(!0),ee=l(!1),ae=l(!1),le=l([]),te=l(0),ue=l(!1),ne=l(!1),se=e=>e&&e>t().endOf("day"),oe=e=>e&&e>t().endOf("day")||e.isBefore(Q.value),ie=l(),ve=(e,a=0)=>{te.value=e,365===te.value?Q.value=t().startOf("year"):100===te.value?Q.value=t().startOf("month"):Q.value=t().subtract(e,"day"),G.value=t().subtract(a,"day"),ie.value=!1,ge()},de=()=>{ie.value=!0,ge()},re=()=>{navigator.clipboard.readText().then((e=>{R.value=e,ge()})).catch((e=>{e instanceof DOMException?P.error("请手动粘贴，或允许读取剪贴板，失败原因："+e):P.error("请手动粘贴，失败原因："+e)}))},ce=()=>Z.value?ne.value&&X.showSwitch?"warning":"primary":"error",pe=()=>{0===le.value.length&&(ae.value=!0,Y({}).then((e=>{le.value=e.records,ae.value=!1})))},fe=u(n),ye=l();let{username:me,realname:he}=null==fe?void 0:fe.userInfo;const ke=me;ye.value=he;const _e=e=>{me=e,Z.value=ke===ye.value,null==e&&(ye.value="所有人"),ge()},be=l(null==(L=null==X?void 0:X.tabPane)?void 0:L.activeKey),we=e=>{be.value=e,ge()},ge=()=>{var e,a,l,t,u;Q.value.isAfter(G.value)&&(G.value=Q.value),R.value=j(null==(e=null==R?void 0:R.value)?void 0:e.trim());let n=null==(a=R.value)?void 0:a.indexOf("/j/");n<0&&(n=null==(l=R.value)?void 0:l.indexOf("/c/")),n<0&&(n=null==(t=R.value)?void 0:t.indexOf("/d/")),n>=0&&(R.value=null==(u=R.value)?void 0:u.substring(n+3)),localStorage.setItem("searchSwitch",JSON.stringify(ne.value)),J("queryList",{pageNo:1,pageSize:30,startTime:Q.value.startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:G.value.endOf("day").format("YYYY-MM-DD HH:mm:ss"),keyword:R.value,username:me,checked:ne.value,status:be.value})},xe=()=>{ue.value=!ue.value,J("changeAdvanced")},Ce=()=>{ee.value=!0,J("confirmCopy",{count:V.value,username:me,checked:ne.value})},{proxy:Oe}=U();return q({queryFinish:(e="")=>{1===V.value?Oe.tool.copy(e,e+"已复制"):Oe.tool.copy(e,V.value+"条已复制"),ee.value=!1}}),s((()=>{var e;ne.value=JSON.parse(null!=(e=localStorage.getItem("searchSwitch"))?e:"false"),ge()})),(a,l)=>{var t,u;const n=o("a-button"),s=o("a-space"),P=o("a-date-picker"),U=o("a-select-option"),j=o("a-spin"),Y=o("a-select"),q=o("a-switch"),J=o("a-input"),L=o("a-card"),Z=o("a-col"),fe=o("a-slider"),me=o("a-popconfirm"),he=o("a-row"),ke=o("a-tab-pane"),Oe=o("a-tabs");return i(),v(x,null,[d(L,{size:"small"},{default:r((()=>[c("div",z,[e.showTop?(i(),v("div",A,[d(s,{size:5,class:"mb-2"},{default:r((()=>[d(n,{type:ie.value||365!==te.value?"":"link",onClick:l[0]||(l[0]=e=>ve(365,0))},{default:r((()=>[D])),_:1},8,["type"]),d(n,{type:ie.value||30!==te.value?"":"link",onClick:l[1]||(l[1]=e=>ve(30,0))},{default:r((()=>[K])),_:1},8,["type"]),d(n,{type:ie.value||100!==te.value?"":"link",onClick:l[2]||(l[2]=e=>ve(100))},{default:r((()=>[T])),_:1},8,["type"]),d(n,{type:ie.value||1!==te.value?"":"link",onClick:l[3]||(l[3]=e=>ve(1,1))},{default:r((()=>[$])),_:1},8,["type"]),d(n,{type:ie.value||0!==te.value?"":"link",onClick:l[4]||(l[4]=e=>ve(0,0))},{default:r((()=>[F])),_:1},8,["type"])])),_:1}),d(p,{"enter-active-class":"animate__animated animate__flipInX","leave-active-class":"animate__animated animate__flipOutX animate__faster"},{default:r((()=>[f(d(s,{class:"mb-2"},{default:r((()=>[d(P,{onChange:de,allowClear:"",placeholder:"开始日期","disabled-date":se,value:Q.value,"onUpdate:value":l[5]||(l[5]=e=>Q.value=e)},null,8,["value"]),d(P,{onChange:de,allowClear:"",placeholder:"结束日期","disabled-date":oe,value:G.value,"onUpdate:value":l[6]||(l[6]=e=>G.value=e)},null,8,["value"])])),_:1},512),[[y,ue.value]])])),_:1})])):m("",!0),d(J,{size:"large",value:R.value,"onUpdate:value":l[10]||(l[10]=e=>R.value=e),onChange:ge,placeholder:e.placeholder,allowClear:""},{prefix:r((()=>[d(n,{type:"link",onClick:xe},{default:r((()=>[ue.value?(i(),h(k(_),{key:0})):(i(),h(k(b),{key:1}))])),_:1}),w(a.$slots,"prefix"),ue.value?(i(),h(s,{key:0},{default:r((()=>[k(E)("am:selectUser")&&e.showPeople?(i(),h(Y,{key:0,size:"",loading:ae.value,allowClear:"",ref:"select",value:ye.value,"onUpdate:value":l[7]||(l[7]=e=>ye.value=e),style:{width:"90px"},onFocus:pe,onChange:_e},g({default:r((()=>[(i(!0),v(x,null,C(le.value,(e=>(i(),h(U,{key:e.id,value:e.username},{default:r((()=>[O(S(e.realname),1)])),_:2},1032,["value"])))),128))])),_:2},[ae.value?{name:"notFoundContent",fn:r((()=>[d(j,{size:"small"})])),key:"0"}:void 0]),1032,["loading","value"])):m("",!0),k(M)()?(i(),h(n,{key:1,ghost:"",type:"success",onClick:re},{default:r((()=>[I])),_:1})):m("",!0)])),_:1})):m("",!0)])),suffix:r((()=>[ue.value?w(a.$slots,"suffix",{key:0}):m("",!0),w(a.$slots,"suffixAdvanced"),e.showSwitch&&k(E)("link:switch")?(i(),v("span",N,[d(n,{class:"animate__animated animate__heartBeat animate__slower animate__repeat-3",onClick:l[8]||(l[8]=e=>k(B).push("/pms/am/link")),type:"link",danger:""},{default:r((()=>[H])),_:1}),d(q,{onClick:ge,checked:ne.value,"onUpdate:checked":l[9]||(l[9]=e=>ne.value=e)},null,8,["checked"])])):m("",!0)])),_:3},8,["value","placeholder"])])])),_:3}),e.showCopy?(i(),h(he,{key:0,class:"w-full mt-2"},{default:r((()=>[d(Z,{span:4},{default:r((()=>[w(a.$slots,"left")])),_:3}),d(Z,{span:14},{default:r((()=>[d(fe,{style:{display:"inline-block"},value:V.value,"onUpdate:value":l[11]||(l[11]=e=>V.value=e),min:1,max:500},null,8,["value"])])),_:1}),d(Z,{class:"text-center",span:6},{default:r((()=>[f(d(n,{onClick:Ce,loading:ee.value,type:ce()},{default:r((()=>[O("复制"+S(V.value)+"条 ",1)])),_:1},8,["loading","type"]),[[y,1===V.value]]),d(me,{title:`确定复制${V.value}条吗?`,"ok-text":"确定","cancel-text":"取消",onConfirm:Ce},{default:r((()=>[f(d(n,{loading:ee.value,placeholder:"开始日期",type:ce()},{default:r((()=>[O("复制"+S(V.value)+"条 ",1)])),_:1},8,["loading","type"]),[[y,V.value>1]])])),_:1},8,["title"])])),_:1})])),_:3})):m("",!0),(null==(u=null==(t=X.tabPane)?void 0:t.tabs)?void 0:u.length)>0?(i(),v("div",W,[d(Oe,{animated:!1,activeKey:be.value,"onUpdate:activeKey":l[12]||(l[12]=e=>be.value=e),onTabClick:we},{default:r((()=>{var e;return[(i(!0),v(x,null,C(null==(e=X.tabPane)?void 0:e.tabs,(e=>(i(),h(ke,{key:e.tabKey,tab:e.tabName},null,8,["tab"])))),128))]})),_:1},8,["activeKey"])])):m("",!0)],64)}}});export{q as default};
