import{l as e,F as a,o as t,H as n,f0 as o,t as r,v as s,x as d,V as l,ax as u,aW as c,y as i,z as p,C as f,u as h}from"./index.b3c93d64.js";import{c as v}from"./auth.data.46f0b0ef.js";import{m as y,l as m,n as k}from"./auth.api.d1db9b41.js";var x=(e,a,t)=>new Promise(((n,o)=>{var r=e=>{try{d(t.next(e))}catch(a){o(a)}},s=e=>{try{d(t.throw(e))}catch(a){o(a)}},d=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,s);d((t=t.apply(e,a)).next())}));const g=e({name:"AuthButtonTree",props:{cgformId:{type:String,required:!0}},setup(e){const{createMessage:o}=h(),r=a(""),s=a(2),d=a(!0),l=a([]),u=a([]),c=a([]),i=a(""),p=t((()=>!r.value));function f(){return x(this,null,(function*(){if(!e.cgformId)return;let a=yield y(e.cgformId,s.value);a.forEach((e=>{for(const a of v)if(e.code==a.code){e.title=a.title;break}}));let t=[];for(let e of a){let a=I(e);t.push({key:e.id,title:a})}c.value=t}))}function g(a,t){return x(this,null,(function*(){r.value=a,i.value=t,u.value=[];let n=yield m({roleId:a,cgformId:e.cgformId,type:s.value,authMode:t});u.value=n.map((e=>e.authId))}))}function I(e){let a=e.title+"-";return 3==e.page?a+="列表可见":5==e.page&&(a+="表单可见"),a}return n((()=>e.cgformId),f,{immediate:!0}),{loadChecked:g,clear:function(){r.value="",u.value=[]},expandedKeys:l,autoExpandParent:d,checkedKeys:u,treeData:c,disabled:p,onSave:function(){return x(this,null,(function*(){yield k(r.value,e.cgformId,{authId:JSON.stringify(u.value),authMode:i.value}),o.success("保存成功")}))},onExpand:function(e){l.value=e,d.value=!1},onRefresh:function(){f(),g(r.value,i.value)},clearChecked:function(){r.value=""}}}}),I={class:"onl-auth-tree-btns"};var b=o(g,[["render",function(e,a,t,n,o,h){const v=r("a-empty"),y=r("a-button"),m=r("a-tree");return s(),d("div",null,[e.disabled?(s(),l(v,{key:0,description:"请先选中左侧角色/部门/用户"})):0===e.treeData.length?(s(),l(v,{key:1,description:"无权限信息"})):(s(),d(u,{key:2},[c("div",I,[i(y,{onClick:e.onRefresh,size:"small",type:"primary",preIcon:"ant-design:redo",ghost:""},{default:p((()=>[f("刷新")])),_:1},8,["onClick"]),i(y,{onClick:e.onSave,size:"small",type:"primary",preIcon:"ant-design:save",ghost:""},{default:p((()=>[f("保存")])),_:1},8,["onClick"])]),i(m,{checkable:"",checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[0]||(a[0]=a=>e.checkedKeys=a),expandedKeys:e.expandedKeys,autoExpandParent:e.autoExpandParent,treeData:e.treeData,onExpand:e.onExpand},null,8,["checkedKeys","expandedKeys","autoExpandParent","treeData","onExpand"])],64))])}],["__scopeId","data-v-0c1d5eb9"]]);export{b as default};
