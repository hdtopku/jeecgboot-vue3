import{B as e}from"./index.12c6f6d1.js";import{B as t}from"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import{u as i}from"./useForm.5a9ed278.js";import"./JAddInput.2ba637e0.js";import{f0 as l,F as o,bH as a,o as n,t as r,v as s,V as d,z as c,y as p,B as m,a1 as u}from"./index.b2c24a42.js";import{o as f}from"./omit.d6518a29.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import"./_baseClone.a8082016.js";import"./_arrayPush.8821345e.js";import"./_flatRest.ff1861ce.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./uniqBy.be1d69f1.js";import"./useFormItem.9110ec70.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./api.e26748d3.js";import"./index.be1c9e2b.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./_baseSlice.23bb44df.js";var b=Object.defineProperty,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,v=(e,t,i)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,y=(e,t,i)=>new Promise(((l,o)=>{var a=e=>{try{r(i.next(e))}catch(t){o(t)}},n=e=>{try{r(i.throw(e))}catch(t){o(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,n);r((i=i.apply(e,t)).next())}));var F=l({name:"LinkTableConfigModal",emits:["success","register"],components:{BasicModal:e,BasicForm:t},setup(e,{emit:t}){const l=o(!1),r=o("");let s={};const[d,{closeModal:c}]=a((e=>y(this,null,(function*(){s=((e,t)=>{for(var i in t||(t={}))h.call(t,i)&&v(e,i,t[i]);if(g)for(var i of g(t))j.call(t,i)&&v(e,i,t[i]);return e})({},e.record),yield T({dictTable:e.record.dictTable}),setTimeout((()=>y(this,null,(function*(){let t=f(e.record,"dictTable");yield T(t),yield B()}))),200),r.value=e.fieldName})))),p=o(""),m=o(""),b=o([]),F=o([]);function x(e){return y(this,null,(function*(){p.value="",m.value="",yield function(e){return y(this,null,(function*(){if(e){const t="/online/cgform/field/listByHeadCode",i=yield u.get({url:t,params:{headCode:e}});if(i&&i.length>0){let e=i.filter((e=>"id"!=e.dbFieldName&&1==e.dbIsPersist));e.length>0?b.value=e.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):b.value=[];let t=i.filter((e=>"id"!=e.dbFieldName&&"image"==e.fieldShowType&&1==e.dbIsPersist));t.length>0?F.value=t.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))):F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}else b.value=[],F.value=[{text:"无图片字段可以选择",value:"",key:"",disabled:!0}]}}))}(e)}))}const C=n((()=>{let e=b.value,t=p.value,i=m.value;return e.filter((e=>e.value!=t&&e.value!=i))})),w=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"dictField",field:"dictField",component:"Input",defaultValue:"id",show:!1},{label:"字段描述",field:"dbFieldTxt",component:"Input",required:!0},{label:"关联表",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({dict:"onl_cgform_head where copy_type = 0,table_txt,table_name",pageSize:10,async:!0,immediateChange:!0,popContainer:".link-table-config-modal",params:{order:"desc",column:"create_time"},onChange:t=>y(this,null,(function*(){(s.titleField||s.otherFields)&&(yield e.setFieldsValue({titleField:"",otherFields:"",imageField:""}),yield e.clearValidate()),yield x(t)}))})},{label:"标题字段",field:"titleField",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:b,immediateChange:!0,onChange:e=>{p.value=e,s.titleField=e}}},{label:"封面图片",field:"imageField",component:"JSearchSelect",componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:F,immediateChange:!0,onChange:e=>{m.value=e,s.imageFieldName=e}}},{label:"其他字段",field:"otherFields",component:"JSelectMultiple",componentProps:{popContainer:".link-table-config-modal",options:C,onChange:e=>{s.otherFields=e}}},{label:"显示方式",field:"showType",component:"Select",defaultValue:"card",componentProps:{options:[{label:"卡片",value:"card"},{label:"下拉框",value:"select"}]}},{label:"是否多选",field:"multiSelect",component:"RadioGroup",defaultValue:!1,componentProps:{options:[{label:"否",value:!1},{label:"是",value:!0}]}}],[S,{validate:P,setFieldsValue:T,clearValidate:B,resetFields:_}]=i({schemas:w,showActionButtonGroup:!1,labelAlign:"right"});return{registerModal:d,spinningLoading:l,registerForm:S,handleSubmit:function(){return y(this,null,(function*(){let e=yield P();e.fieldName=r.value,t("success",e),c()}))}}}},[["render",function(e,t,i,l,o,a){const n=r("BasicForm"),u=r("a-spin"),f=r("BasicModal");return s(),d(f,m({wrapClassName:"link-table-config-modal"},e.$attrs,{title:"关联记录配置",onRegister:l.registerModal,keyboard:"",canFullscreen:!1,cancelText:"关闭",onOk:l.handleSubmit}),{default:c((()=>[p(u,{spinning:l.spinningLoading},{default:c((()=>[p(n,{onRegister:l.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16,["onRegister","onOk"])}]]);export{F as default};
