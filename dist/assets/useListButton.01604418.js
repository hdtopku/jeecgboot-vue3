import{E as e,d as t}from"./FormSchemaFactory.936572ec.js";import{F as n,dN as r,J as o,bI as a,a8 as l,ac as s,r as i,fa as u,a1 as c,a5 as p,at as d,fi as f,fj as m,fk as g,fl as h,fg as b,u as y,b5 as v,Q as w,au as T}from"./index.b3c93d64.js";import{onMountedOrActivated as S}from"./onMountedOrActivated.d3784e6c.js";import"./index.ee0a0c33.js";import{p as C}from"./pick.dbff1c58.js";var x=Object.defineProperty,D=Object.defineProperties,P=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,R=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))F.call(t,n)&&R(e,n,t[n]);if(O)for(var n of O(t))j.call(t,n)&&R(e,n,t[n]);return e},I=(e,t)=>D(e,P(t)),E=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{s(n.next(e))}catch(t){o(t)}},l=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);s((n=n.apply(e,t)).next())}));const M={vue:f,"@":{hooks:{useMessage:m},utils:{axios:g,cache:h}}};const N={acceptHrefParams:"<p> 跳转时获取的参数信息",currentPage:"<p> 当前页数",currentTableName:"<p> 当前表名",description:"<p> 当前表描述",hasChildrenField:"<p> 是否有子节点的字段名，仅树形表单下有效",isDesForm:"<p> xx",isTree:"<m> 是否是树形表单 ",loadData:"<m> 加载列表数据",pageSize:"<p> 每一页显示条数",queryParam:"<p> 查询条件对象，每次点击查询后才会更新此数据",selectedRowKeys:"<p> 选中的行的id数组",sortField:"<p> 排序字段",sortType:"<p> 排序规则",total:"<p> 总页数"},U={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess"};let B={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const Q={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(e,t)=>t[0]+"-"+t[1]+" 共"+e+"条",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:$,createErrorModal:_}=y(),J=/(?:\/\*[\s\S]*?\*\/|\/\/.*?\r?\n|[^{])+\{([\s\S]*)\}$/;function L(){const l=n(""),i=r(),u=n(),p=n(),f=n(!1),m=n([]),g=n(!0),h=n();let y={};const T={execButtonEnhance:function(n,r){if(x[e][n]){if(t!==n){let t=s(r);return x[e][n].call(x,x,t)}C(n)}else x[e][n+"_hook"]&&C(n+"_hook")},isTree:function(e){return"boolean"==typeof e?(x.isTreeTable=e,e):x.isTreeTable}};function C(t){let n=x[e][t].toLocaleString().match(J);if(n.length>1){let e=n[1];D(e)}}const x=new Proxy(N,{get(e,t){if("function"==typeof T[t])return T[t];{let e=y[l.value];return Reflect.get(e,t)}},set(e,t,n){let r=function(){let e=y[l.value];if(!e){let t=Object.assign({},B,{onlineUrl:U});e=JSON.parse(JSON.stringify(t)),y[l.value]=e}return e}();return"function"==typeof n?Reflect.set(T,t,n):Reflect.set(r,t,n)},deleteProperty:(e,t)=>t===l.value&&(delete y[t],!0)}),{executeJsEnhanced:D}=function(e,t){const n=Object.assign({},M,e);function r(e){if(null!=e&&""!=e){let t=e.toString().split("/"),r=n[t[0]];for(let e=1;e<t.length;e++)r=r[t[e]];return r}return null}function o(){}return{executeJsEnhanced:function(e){let n=b(6);new Function(`return function (customImport, ${"__export_"+n}) {"use strict"; ${e}}`)().call(t,r,o)}}}({},x);function P(){return new Promise(((e,t)=>{let n=`${x.onlineUrl.getData}${l.value}`;!0===x.isTree()&&(n=`${x.onlineUrl.getTreeData}${l.value}`);let r=O();c.get({url:n,params:r},{isTransformResponse:!1}).then((n=>{n.success?(!function(e){let t=0;Number(e.total)>0?(!0===x.isTree()?(m.value=R(e.records),w((()=>{!function(e){let t=L.value;if(!(t.length>0))return Promise.resolve();{const{sortField:n,sortType:r,pidField:o}=x;let a=Object.assign({},{column:n,order:r});a.hasQuery="in";let s=Object.assign({});s.rule="in",s.type="text",s.val=t.join(","),s.field=o,s=[s],a.superQueryParams=encodeURI(JSON.stringify(s)),a.superQueryMatchType="and",a.batchFlag="true";let i=`${x.onlineUrl.getTreeData}${l.value}`;c.get({url:i,params:a},{isTransformResponse:!1}).then((n=>{if(n.success&&n.result.records&&n.result.records.length>0){let r=n.result.records;const a=new Map;for(let e of r){let n=e[o];if(t.join(",").includes(n)){let t=a.get(n);null==t&&(t=[]),t.push(e),a.set(n,t)}}let l=a,s=e=>{e&&e.forEach((e=>{t.includes(e.id)&&(e.children=R(l.get(e.id)),s(e.children))}))};s(e)}})).catch((()=>{let e="loadDataByExpandedRows请求列表数据异常!";$.warning(e)}))}}(m.value)}))):m.value=e.records,t=Number(e.total)):m.value=[];f.value&&(f.value=I(k({},f.value),{total:t}))}(n.result),e(!0)):("NO_DB_SYNC"===n.message?_({title:"数据库未同步",content:"请先同步数据库再查看此页面！",onOk:()=>v.back()}):$.warning(n.message),t(!1))})).catch((()=>{$.warning("请求列表数据异常!"),t(!1)}))}))}function O(){const{sortField:e,sortType:t,acceptHrefParams:n,queryParam:r}=x;let o={};!0===x.isTree()?o.hasQuery="false":o.hasQuery="true";let a=Object.assign({},o,n,r,{column:e,order:t});f.value?(a.pageNo=f.value.current,a.pageSize=f.value.pageSize):a.pageSize=-521;let l=function(){if(!x.superQuery)return{};const{superQuery:{params:e,matchType:t},currentTableName:n}=x;let r=n+"@",o=[];if(e.length>0)for(let l of e){let e=k({},l),t=e.field;t.startsWith(r)&&(e.field=t.replace(r,"")),o.push(e)}let a=o.length>0?JSON.stringify(o):"";return{params:encodeURIComponent(a),matchType:t}}();return a.superQueryMatchType=l.matchType||"",a.superQueryParams=l.params||"",d(a)}S((()=>{H()})),o((()=>{delete y[l.value]}));const F={loadData:P,getLoadDataParams:O,reloadTable:function(){return E(this,null,(function*(){g.value=!0,yield w(),g.value=!1}))}};Object.keys(F).map((e=>{x[e]=F[e]}));let j=n(!1);function R(e){if(e)return e.map((e=>{if("1"==e[x.hasChildrenField]){let t={id:e.id+"_loadChild",name:"loading...",isLoading:!0};t.jeecg_row_key=t.id,e.children=[t]}return e}))}const L=n([]);const z=n(!1);const[A,{openModal:q}]=a();function H(){let e=function(){let e=i.params.id;return e||(e=""),e}();l.value=e}return x.openCustomModal=function(e){if(e||(e={}),!e.row){let t=x.selectedRows;if(!t||0==t.length||t.length>1)return void $.warning("请选择一条数据");e.row=t[0]}e.code=l.value,q(!0,e)},H(),k({ID:l,onlineQueryFormOuter:u,superQueryButtonRef:p,loading:j,reload:function(){return E(this,null,(function*(){f.value&&(f.value=I(k({},f.value),{current:1})),x.clearSelectedRow(),yield P()}))},dataSource:m,pagination:f,tableReloading:g,handleSpecialConfig:function(e){x.description=e.description,x.currentTableName=e.currentTableName,x.isDesForm=e.isDesForm,x.desFormCode=e.desFormCode,x.ID=l.value;let{acceptHrefParams:t,queryParam:n,superQuery:r,currentPage:o,pageSize:a}=x;!function(){let e={},t=i.query;t&&(Object.keys(t).map((n=>{e[n]=t[n]})),x.acceptHrefParams=e)}(),n?u.value.initDefaultValues(n,t):x.queryParam={},r?p.value.initDefaultValues(r):x.superQuery={params:"",matchType:""},"Y"==e.paginationFlag?f.value=k(k({},Q),{current:o,pageSize:a}):f.value=!1},onlineTableContext:x,handleChangeInTable:function(e,t,n){n&&n.order?(x.sortField=n.field,x.sortType="ascend"==n.order?"asc":"desc"):(x.sortField="id",x.sortType="asc"),f.value&&(f.value=e),P()},getColumnList:function(){return new Promise(((e,t)=>{c.get({url:`${x.onlineUrl.getColumns}${l.value}`},{isTransformResponse:!1}).then((n=>{n.success?e(n.result):($.warning(n.message),t())})).catch((()=>{t()}))}))},getTreeDataByResult:R,expandedRowKeys:L,handleExpandedRowsChange:function(e){L.value=e},onlineExtConfigJson:h,handleFormConfig:function(e){let t=e.head.extConfigJson;t&&(h.value=JSON.parse(t))},superQueryStatus:z,handleSuperQuery:function(e,t){x.superQuery={params:e,matchType:t},0==e.length?z.value=!1:z.value=!0,P()},registerCustomModal:A},F)}function z(e,t){const[n,{openModal:r}]=a(),[o,{openModal:f}]=a(),[m,{openModal:g}]=a(),[h,{openModal:b}]=a(),{createMessage:v}=y(),w=l({add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0}),S=l([]),x=l([]);function D(t){e.beforeEdit(t).then((()=>{r(!0,{isUpdate:!0,record:t})})).catch((e=>{v.warning(e)}))}const P=e=>({label:"删除",popConfirm:{title:"是否删除？",confirm:O.bind(null,e)}});function O(t){e.beforeDelete(t).then((()=>{M(t.id)})).catch((e=>{v.warning(e)}))}function F(e){return{label:"提交流程",popConfirm:{title:"确认提交流程吗？",confirm:I.bind(null,e)}}}function j(t){const{currentTableName:n}=e;let r="onl_"+n,o=t.id;b(!0,{flowCode:r,dataId:o})}function R(e){const t="bpm_status";let n=e[t];return n||(n=e[t.toUpperCase()]),n}function k(e){g(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function I(t){return E(this,null,(function*(){yield function(t){const{currentTableName:n,onlineUrl:{startProcess:r}}=e;let o={url:r,params:{flowCode:"onl_"+n,id:t.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},a={isTransformResponse:!1};return new Promise(((e,t)=>{c.post(o,a).then((n=>{n.success?(e(n),v.success(n.message)):(t(),v.warning(n.message))}))}))}(t),e.loadData()}))}function M(t){let n=`${e.onlineUrl.optPre}${e.ID}/${t}`;return new Promise(((t,r)=>{c.delete({url:n},{isTransformResponse:!1}).then((n=>{n.success?(v.success(n.message),e.loadData(),t(!0)):(v.warning(n.message),r())}))}))}function N(t,n,r){if("js"==r)e.execButtonEnhance(n,t);else if("action"==r){let r={formId:e.ID,buttonCode:n,dataId:t.id},o=`${e.onlineUrl.buttonAction}`;c.post({url:o,params:r},{isTransformResponse:!1}).then((t=>{t.success?(e.loadData(),v.success("处理完成!")):v.warning(t.message)}))}}const{handleExportXlsx:U}=T();function B(e,t){if(!e||""==e)return!0;let n=e.split("#"),r=t[n[0]],o=n[1].toLowerCase();if("eq"===o)return r==n[2];if("ne"===o)return!(r==n[2]);if("empty"===o)return"true"===n[2]?!r||""==r:r&&r.length>0;if("in"===o){return n[2].split(",").indexOf(String(r))>=0}return!1}return{buttonSwitch:w,cgLinkButtonList:S,cgTopButtonList:x,importUrl:()=>`${e.onlineUrl.importXls}${e.ID}`,registerModal:n,handleAdd:function(e){let t={isUpdate:!1};e&&(t.param=e),r(!0,t)},handleEdit:D,handleBatchDelete:function(){let t=e.selectedRowKeys;if(t.length<=0)return v.warning("请选择一条记录！"),!1;{let n=[];t.forEach((function(e){let t=e;t&&t.endsWith("_loadChild")&&(t=t.replace("_loadChild","")),n.indexOf(t)<0&&n.push(t)}));let r=n.join(",");p.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>E(this,null,(function*(){yield M(r),e.clearSelectedRow()}))})}},registerImportModal:o,onImportExcel:function(){f(!0)},onExportExcel:function(){let t=e.getLoadDataParams(),n=e.selectedRowKeys;n&&n.length>0&&(t.selections=n.join(","));let r=JSON.stringify(d(t)),o=`${e.onlineUrl.exportXls}${e.ID}`;const a=e.description;U(a,o,{paramsStr:r})},getDropDownActions:function(n){let r=[];if(!0===s(w.detail)&&r.push({label:"详情",onClick:k.bind(null,n)}),!0===e.hasBpmStatus&&!0===s(w.bpm)){let e=R(n);e&&"1"!=e?r.push(function(e){return{label:"审批进度",onClick:j.bind(null,e)}}(n)):r.push(F(n))}if(t.value){let{reportPrintShow:e,reportPrintUrl:o}=t.value;e&&o&&r.push({label:"打印",onClick(){let e=o,t=n.id,r=i();u(e,t,r)}})}let o=R(n),a=o&&"1"==o||!o;!0===s(w.delete)&&a&&r.push(P(n));let l=S;if(l&&l.length>0)for(let e of l)!0===B(e.exp||"",n)&&r.push({label:e.buttonName,onClick:N.bind(null,n,e.buttonCode,e.optType)});return r},getActions:function(e){let t=R(e),n=t&&"1"==t||!t;return!0===s(w.update)&&n?[{label:"编辑",onClick:D.bind(null,e)}]:[]},cgButtonJsHandler:function(t){e.execButtonEnhance(t)},cgButtonActionHandler:function(t){let n=e.selectedRowKeys;if(!n||0==n.length)return v.warning("请先选中一条记录"),!1;let r=n.join(","),o={formId:e.ID,buttonCode:t,dataId:r},a=`${e.onlineUrl.buttonAction}`;c.post({url:a,params:o},{isTransformResponse:!1}).then((t=>{t.success?(e.loadData(),e.clearSelectedRow(),v.success("处理完成!")):v.warning(t.message)}))},cgButtonLinkHandler:N,initButtonList:function(e){if(S.length=0,x.length=0,e&&e.length>0)for(let t=0;t<e.length;t++){let n=C(e[t],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");"button"==n.buttonStyle?x.push(n):"link"==n.buttonStyle&&S.push(n)}},initButtonSwitch:function(e){Object.keys(w).forEach((e=>{w[e]=!0})),e&&e.length>0&&Object.keys(w).forEach((t=>{e.indexOf(t)>=0&&(w[t]=!1)}))},getDeleteButton:P,handleSubmitFlow:I,getSubmitFlowButton:F,registerDetailModal:m,registerBpmModal:h}}export{z as a,L as u};
