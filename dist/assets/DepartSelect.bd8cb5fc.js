var E=(v,k,c)=>new Promise((d,b)=>{var x=l=>{try{D(c.next(l))}catch(s){b(s)}},T=l=>{try{D(c.throw(l))}catch(s){b(s)}},D=l=>l.done?d(l.value):Promise.resolve(l.value).then(x,T);D((c=c.apply(v,k)).next())});import{B as ue}from"./index.7a625210.js";import{g as le,h as se}from"./depart.api.966b32da.js";import{c as oe}from"./tenant.api.550b6fcc.js";import{q as ne,l as re,d7 as ie,F as r,H as ce,t as p,v as m,V as y,z as a,y as i,E as P,x as R,bb as $,aw as W,W as j,B as G,L as e,C,D as J,dp as de,dq as fe,aV as K,u as pe}from"./index.bd2180ec.js";import"./BasicModal.1cb192e8.js";import"./useWindowSizeFn.881da297.js";const O=v=>(de("data-v-4adea91b"),v=v(),fe(),v),ve=O(()=>K("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5C5E\u79DF\u6237",-1)),_e=C(" \u79DF\u6237 "),me=O(()=>K("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5728\u90E8\u95E8",-1)),ge=C(" \u90E8\u95E8 "),Fe=C("\u5173\u95ED"),Ee=C("\u786E\u8BA4"),Ce=re({__name:"DepartSelect",props:{title:{type:String,default:"\u90E8\u95E8\u9009\u62E9"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(v,{expose:k}){const c=v,d=ie(),{createMessage:b,notification:x}=pe(),T={labelCol:{span:4},wrapperCol:{span:18}},D={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},l=r(""),s=r(!1),B=r(""),_=r(),N=r([]),S=r(""),f=r(!1),h=r(""),g=r(""),A=r([]),w=r(""),I=r(!1);function Q(){return E(this,null,function*(){yield L(),yield X(),e(s)&&e(f)?l.value="\u5207\u6362\u79DF\u6237\u548C\u90E8\u95E8":e(s)?l.value=e(B)&&e(B).length>0?`\u79DF\u6237\u5207\u6362\uFF08\u5F53\u524D\u79DF\u6237 :${e(B)}\uFF09`:c.title:e(f)&&(l.value=e(h)&&e(h).length>0?`\u90E8\u95E8\u5207\u6362\uFF08\u5F53\u524D\u90E8\u95E8 :${e(h)}\uFF09`:c.title),(e(s)||e(f))&&(I.value=!0)})}function L(){return E(this,null,function*(){const t=yield le();if(!t.list||t.list.length==0)return;let u=t.list.filter(n=>n.orgCode==t.orgCode);A.value=t.list,g.value=u&&u.length>0?t.orgCode:"",h.value=u&&u.length>0?u[0].departName:"",f.value=!0})}function X(){return E(this,null,function*(){const t=yield oe();if(!t.list||t.list.length==0)return;let u=d.getTenant,n=t.list.filter(F=>F.id==u);B.value=n&&n.length>0?n[0].name:"",N.value=t.list,_.value=u,s.value=!0})}function Y(){return E(this,null,function*(){if(e(s)&&!e(_))return S.value="error",!1;if(e(f)&&!e(g))return w.value="error",!1;Z().then(()=>{e(s)&&d.setTenant(e(_)),b.success("\u5207\u6362\u6210\u529F")}).catch(t=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",t)}).finally(()=>{e(s)&&d.setTenant(e(_)),U()})})}function Z(){return new Promise((t,u)=>E(this,null,function*(){if(!e(f))t();else{const n=yield se({username:d.getUserInfo.username,orgCode:e(g)});if(n.userInfo){const F=n.userInfo;d.setUserInfo(F),t()}else ee(n),d.logout(),u()}}))}function ee(t){x.error({message:"\u767B\u5F55\u5931\u8D25",description:((t.response||{}).data||{}).message||t.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function U(){te()}function te(){l.value="",s.value=!1,B.value="",_.value="",N.value=[],S.value="",f.value=!1,h.value="",g.value="",A.value=[],w.value="",I.value=!1}return ce(()=>c.username,t=>{t&&L()}),k({show:Q}),(t,u)=>{const n=p("a-avatar"),F=p("a-tooltip"),M=p("Icon"),V=p("a-select-option"),z=p("a-select"),q=p("a-form-item"),ae=p("a-form"),H=p("a-button");return m(),y(e(ue),G(D,{title:l.value,visible:I.value,"onUpdate:visible":u[2]||(u[2]=o=>I.value=o),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(H,{onClick:U},{default:a(()=>[Fe]),_:1}),i(H,{onClick:Y,type:"primary"},{default:a(()=>[Ee]),_:1})]),default:a(()=>[i(ae,G({ref:"formRef"},T,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[s.value?(m(),y(q,{key:0,"validate-status":S.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(n,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[_e]),_:1})]),_:1})]),default:a(()=>[i(z,{value:_.value,"onUpdate:value":u[0]||(u[0]=o=>_.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:P({"valid-error":S.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),R(W,null,$(N.value,o=>(m(),y(V,{key:o.id,value:o.id},{default:a(()=>[C(J(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):j("",!0),f.value?(m(),y(q,{key:1,"validate-status":w.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(n,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[ge]),_:1})]),_:1})]),default:a(()=>[i(z,{value:g.value,"onUpdate:value":u[1]||(u[1]=o=>g.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:P({"valid-error":w.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),R(W,null,$(A.value,o=>(m(),y(V,{key:o.orgCode,value:o.orgCode},{default:a(()=>[C(J(o.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):j("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});var Ie=ne(Ce,[["__scopeId","data-v-4adea91b"]]);export{Ie as default};
