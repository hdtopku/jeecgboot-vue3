import{l as e,F as t,H as l,a1 as a,f0 as n,u as i,t as s,v as o,V as r,z as u,x as d,bc as c,aW as p,D as f,ax as g}from"./index.26a57b91.js";const h="/online/cgform/api/querySelectOptions",v=e({name:"OnlineSelectCascade",props:{table:{type:String,default:""},txt:{type:String,default:""},store:{type:String,default:""},idField:{type:String,default:""},pidField:{type:String,default:""},pidValue:{type:String,default:"-1"},origin:{type:Boolean,default:!1},condition:{type:String,default:""},value:{type:String,default:""},isNumber:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"}},emits:["change","next"],setup(e,{emit:n}){const{createMessage:s}=i(),o=t(""),r=t([]),u=t(!0);function d(){let t=c();!0===e.origin?t.condition=e.condition:t.pidValue=e.pidValue,r.value=[],a.get({url:h,params:t},{isTransformResponse:!1}).then((e=>{e.success?r.value=[...e.result]:s.warning("联动组件数据加载失败,请检查配置!")}))}function c(){return{table:e.table,txt:e.txt,key:e.store,idField:e.idField,pidField:e.pidField}}function p(e,t=[]){if(e&&e.length>0){t&&0!=t.length||(t=r.value);let l=t.filter((t=>t.store===e));if(l&&l.length>0){let e=l[0].id;n("next",e)}}}return l((()=>e.condition),(e=>{u.value=!0,e&&d()}),{immediate:!0}),l((()=>e.pidValue),(e=>{"-1"===e?r.value=[]:d()})),l((()=>e.value),((t,l)=>{t?o.value=t:(o.value=[],l&&(n("change",""),n("next","-1"))),t&&!l&&function(t){return l=this,i=null,u=function*(){if(e.idField===e.store)n("next",t);else if(!0===e.origin)yield new Promise((e=>{!function t(l){l>10&&e([]);let a=r.value;a&&a.length>0?e(a):setTimeout((()=>{t(l++)}),300)}(0)})),p(t);else{let l=yield new Promise((t=>{if(e.value){let l=c();!0===e.isNumber?l.condition=`${e.store} = ${e.value}`:l.condition=`${e.store} = '${e.value}'`,a.get({url:h,params:l},{isTransformResponse:!1}).then((e=>{e.success?t(e.result):(s.warning("联动组件数据加载失败,请检查配置!"),t([]))}))}else o.value=[],t([])}));p(t,l)}},new Promise(((e,t)=>{var a=e=>{try{s(u.next(e))}catch(l){t(l)}},n=e=>{try{s(u.throw(e))}catch(l){t(l)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,n);s((u=u.apply(l,i)).next())}));var l,i,u}(t)}),{immediate:!0}),{selectedValue:o,dictOptions:r,handleChange:function(e){let t=e||"";n("change",t),p(t)}}}}),y=["title"];var m=n(v,[["render",function(e,t,l,a,n,i){const h=s("a-select-option"),v=s("a-select");return o(),r(v,{placeholder:e.placeholder,value:e.selectedValue,onChange:e.handleChange,allowClear:"",style:{width:"100%"}},{default:u((()=>[(o(!0),d(g,null,c(e.dictOptions,((e,t)=>(o(),r(h,{key:t,value:e.store},{default:u((()=>[p("span",{style:{display:"inline-block",width:"100%"},title:e.label},f(e.label),9,y)])),_:2},1032,["value"])))),128))])),_:1},8,["placeholder","value","onChange"])}]]);export{m as default};
