import{B as e}from"./index.12c6f6d1.js";import"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import{q as a,aJ as t,cl as s,F as l,a8 as n,bH as r,o as i,bI as o,t as c,v as d,x as u,y as p,z as m,aW as f,E as g,Y as v,D as b,V as h,ax as y,bc as k,W as x,L as C}from"./index.b2c24a42.js";import{b as j,U as D}from"./JAddInput.2ba637e0.js";import{F as M,B as S,E as R,S as w}from"./SysMessageList.a18d7257.js";import U from"./DetailModal.64b46625.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./uniqBy.be1d69f1.js";import"./useFormItem.9110ec70.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./api.e26748d3.js";import"./index.be1c9e2b.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./useSysMessage.bb156b89.js";const K={name:"SysMessageModal",components:{BasicModal:e,FilterOutlined:M,CloseOutlined:t,BellFilled:S,ExclamationOutlined:R,JSelectUser:j,SysMessageList:w,UserSelectModal:D,PlusOutlined:s,DetailModal:U},emits:["register","refresh"],setup(e,{emit:a}){const t=l(),s=l(),c=l("all");const d=n({fromUser:"",realname:"",rangeDateKey:"",rangeDate:[]});function u(){let e={fromUser:d.fromUser,rangeDateKey:d.rangeDateKey,rangeDate:d.rangeDate};"all"==c.value?t.value.reload(e):s.value.reload(e)}const[p,{closeModal:m}]=r((()=>{return e=this,a=null,t=function*(){u()},new Promise(((s,l)=>{var n=e=>{try{i(t.next(e))}catch(a){l(a)}},r=e=>{try{i(t.throw(e))}catch(a){l(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,r);i((t=t.apply(e,a)).next())}));var e,a,t})),f=l(!1);const g=n([{key:"jt",text:"今天",active:!1},{key:"zt",text:"昨天",active:!1},{key:"qt",text:"前天",active:!1},{key:"bz",text:"本周",active:!1},{key:"sz",text:"上周",active:!1},{key:"by",text:"本月",active:!1},{key:"sy",text:"上月",active:!1},{key:"zdy",text:"自定义",active:!1}]);const v=i((()=>{let e=g.filter((e=>1==e.active));return!!(e&&e.length>0&&"自定义"==e[0].text)})),b=l([]);const h=i((()=>{const{fromUser:e,rangeDateKey:a,realname:t}=d;if(!e&&!a)return"";let s=[];if(e&&s.push(t),a){let e=g.filter((e=>e.key==a));e&&e.length>0&&s.push(e[0].text)}return s.join("、")})),[y,{openModal:k}]=o();const[x,{openModal:j}]=o();return{conditionStr:h,regModal:y,getSelectedUser:function(e,a){e&&e.length>0&&(d.fromUser=a,d.realname=e[0].label)},openSelectPerson:function(){k(!0,{})},clearSearchParamsUser:function(){d.fromUser="",d.realname=""},clearAll:function(){d.fromUser="",d.realname="",d.rangeDateKey="",d.rangeDate=[];for(let e of g)e.active=!1},registerModal:p,activeKey:c,handleChangePanel:function(e){c.value=e},handleChangeTab:function(e,a){c.value=a,u()},showSearch:f,searchParams:d,handleChangeSearchPerson:function(e,a){f.value=!0},dateTags:g,handleClickDateTag:function(e){for(let a of g)a.key!=e.key&&(a.active=!1);e.active=!e.active,0==e.active?d.rangeDateKey="":d.rangeDateKey=e.key,"zdy"==e.key?0==e.active&&(d.rangeDate=[],u()):u()},showRangeDate:v,searchRangeDate:b,handleChangeSearchDate:function(e,a){d.rangeDate=[...a],u()},closeModal:m,hrefThenClose:function(e){a("refresh",e)},allMessageRef:t,starMessageRef:s,registerDetail:x,showDetailModal:function(e){j(!0,{record:C(e),isUpdate:!0})}}}},P={class:"sys-msg-modal-title"},T=f("div",{class:"title"},null,-1),z={class:"ant-tabs-nav-wrap"},B={class:"ant-tabs-nav-scroll"},F={class:"ant-tabs-nav ant-tabs-nav-animated"},O={class:"icon-right"},_={class:"icons"},A=f("span",{class:"search-label"},"回复、提到我的人?：",-1),J={style:{display:"inline-block"}},q={key:0,class:"selected-user"},E={class:"clear-user-icon"},I={class:"search-date"},L=f("div",{class:"date-label"},"时间：",-1),W={class:"date-tags"},G={class:"tags-container"},H=["onClick"],N={key:0,class:"cust-range-date"},V={key:0,class:"anticon filtera"},Y={style:{"font-size":"12px","margin-left":"3px"}},Q={style:{display:"flex",margin:"0 5px"}},X={class:"sys-message-card"},Z=f("div",null,null,-1);var $=a(K,[["render",function(e,a,t,s,l,n){const r=c("close-outlined"),i=c("plus-outlined"),o=c("a-button"),C=c("a-range-picker"),j=c("filter-outlined"),D=c("a-popover"),M=c("sys-message-list"),S=c("a-tab-pane"),R=c("a-tabs"),w=c("BasicModal"),U=c("user-select-modal"),K=c("DetailModal");return d(),u(y,null,[p(w,{canFullscreen:!1,draggable:!1,closable:!1,onRegister:s.registerModal,wrapClassName:"sys-msg-modal",width:800,footer:null,destroyOnClose:""},{title:m((()=>[f("div",P,[T,f("div",z,[f("div",B,[f("div",F,[f("div",null,[f("div",{onClick:a[0]||(a[0]=e=>s.handleChangeTab(e,"all")),role:"tab","aria-disabled":"false","aria-selected":"false",class:g(["ant-tabs-tab",{"ant-tabs-tab-active":"all"==s.activeKey}])}," 全部消息 ",2),f("div",{onClick:a[1]||(a[1]=e=>s.handleChangeTab(e,"star")),role:"tab","aria-disabled":"false","aria-selected":"true",class:g(["ant-tabs-tab",{"ant-tabs-tab-active":"star"==s.activeKey}])}," 标星消息 ",2)]),f("div",{class:"ant-tabs-ink-bar ant-tabs-ink-bar-animated",style:v({transform:"all"==s.activeKey?"translate3d(0px, 0px, 0px)":"translate3d(120px, 0px, 0px)",display:"block",width:"88px"})},null,4)])])]),f("div",O,[f("div",_,[p(D,{placement:"bottomRight",overlayStyle:{width:"400px"},trigger:"click",visible:s.showSearch,"onUpdate:visible":a[3]||(a[3]=e=>s.showSearch=e)},{content:m((()=>[f("div",null,[A,f("span",J,[s.searchParams.fromUser?(d(),u("div",q,[f("span",null,b(s.searchParams.realname),1),f("span",E,[p(r,{style:{"font-size":"12px"},onClick:s.clearSearchParamsUser},null,8,["onClick"])])])):(d(),h(o,{key:1,type:"dashed",shape:"circle",onClick:s.openSelectPerson},{default:m((()=>[p(i)])),_:1},8,["onClick"]))])]),f("div",I,[L,f("div",W,[f("div",G,[(d(!0),u(y,null,k(s.dateTags,(e=>(d(),u("div",{class:g(1==e.active?"tag active":"tag"),onClick:a=>s.handleClickDateTag(e)},b(e.text),11,H)))),256))]),s.showRangeDate?(d(),u("div",N,[p(C,{value:s.searchRangeDate,"onUpdate:value":a[2]||(a[2]=e=>s.searchRangeDate=e),onChange:s.handleChangeSearchDate},null,8,["value","onChange"])])):x("",!0)])])])),default:m((()=>[s.conditionStr?(d(),u("span",V,[p(j),f("span",Y,b(s.conditionStr),1),f("span",Q,[p(r,{style:{"font-size":"12px"},onClick:s.clearAll},null,8,["onClick"])])])):(d(),h(j,{key:1}))])),_:1},8,["visible"]),p(r,{onClick:s.closeModal},null,8,["onClick"])])])])])),default:m((()=>[f("div",X,[p(R,{activeKey:s.activeKey,center:"",onTabClick:s.handleChangePanel},{renderTabBar:m((()=>[Z])),default:m((()=>[p(S,{tab:"全部消息",key:"all",forceRender:""},{default:m((()=>[p(M,{ref:"allMessageRef",onClose:s.hrefThenClose,onDetail:s.showDetailModal},null,8,["onClose","onDetail"])])),_:1}),p(S,{tab:"标星消息",key:"star",forceRender:""},{default:m((()=>[p(M,{ref:"starMessageRef",star:"",onClose:s.hrefThenClose,onDetail:s.showDetailModal},null,8,["onClose","onDetail"])])),_:1})])),_:1},8,["activeKey","onTabClick"])])])),_:1},8,["onRegister"]),p(U,{isRadioSelection:"",showButton:!1,labelKey:"realname",rowKey:"username",onRegister:s.regModal,onGetSelectResult:s.getSelectedUser},null,8,["onRegister","onGetSelectResult"]),p(K,{onRegister:s.registerDetail},null,8,["onRegister"])],64)}]]);export{$ as default};
