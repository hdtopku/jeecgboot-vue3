import{u as e}from"./useOnlineTest.06579696.js";import{useListPage as t}from"./useListPage.4511beac.js";import{B as o}from"./BasicTable.cdd414e6.js";import{T as n}from"./helper.ec3e26f3.js";import"./TableImg.6cb3a734.js";import{B as a}from"./index.ee0a0c33.js";import{B as l}from"./BasicForm.79466d99.js";import{u as i}from"./useForm.ee23be26.js";import"./JAddInput.c8a1b05b.js";import{l as r,F as s,bH as d,bI as c,a8 as u,o as p,f0 as m,a1 as b,t as f,v as g,V as j,z as y,y as v,C as x,x as w,W as C,bl as h,bm as B,Q as I}from"./index.b3c93d64.js";import"./useTable.4670d269.js";import"./uniqBy.30d2558a.js";import"./BasicModal.2a8ad889.js";import"./useWindowSizeFn.e6386ae5.js";import"./useFormItem.d029403d.js";import"./api.dced5d87.js";import"./props.a4f5d1ca.js";import"./index.c4683457.js";import"./bem.3d3e77ca.js";import"./props.c13d8268.js";import"./useContextMenu.de287960.js";import"./index.9bbe419b.js";import"./onMountedOrActivated.d3784e6c.js";import"./index.36d6c198.js";import"./htmlmixed.ba3cd961.js";import"./vue.8c416d71.js";/* empty css             */import"./depart.api.429e062c.js";import"./index.4258d6df.js";import"./useContentHeight.7565ed37.js";import"./useContentViewHeight.d3266665.js";import"./usePageContext.f338fb2a.js";import"./RedoOutlined.c563bb0b.js";import"./functional.3bb51b91.js";import"./download.261c8978.js";import"./base64Conver.030fa32c.js";import"./index.d2e70b0d.js";import"./index.17ec2e33.js";import"./useCountdown.cb4ad478.js";import"./JUpload.6bcc6fce.js";import"./index.ef2039b9.js";var T=Object.defineProperty,P=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,k=(e,t,o)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,S=(e,t,o)=>new Promise(((n,a)=>{var l=e=>{try{r(o.next(e))}catch(t){a(t)}},i=e=>{try{r(o.throw(e))}catch(t){a(t)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,i);r((o=o.apply(e,t)).next())}));function F(e){return b.delete({url:"/online/cgform/button/deleteBatch",params:{ids:e.join(",")}},{joinParamsToUrl:!0})}const A=[{title:"按钮编码",align:"center",dataIndex:"buttonCode"},{title:"按钮名称",align:"center",dataIndex:"buttonName"},{title:"按钮样式",align:"center",dataIndex:"buttonStyle",customRender({text:e,record:t}){if("form"===e){return e+"("+("2"==t.optPosition?"底部":"侧面")+")"}return e}},{title:"按钮类型",align:"center",dataIndex:"optType"},{title:"排序",align:"center",dataIndex:"orderNum"},{title:"按钮图标",align:"center",dataIndex:"buttonIcon"},{title:"表达式",align:"center",dataIndex:"exp"},{title:"按钮状态",align:"center",dataIndex:"buttonStatus",customRender:({text:e})=>1==e?"激活":"未激活"}],O=[{label:"按钮编码",field:"buttonCode",component:"Input",required:!0},{label:"按钮名称",field:"buttonName",component:"Input",required:!0},{label:"按钮样式",field:"buttonStyle",component:"Select",componentProps:{options:[{label:"Link",value:"link"},{label:"Button",value:"button"},{label:"Form",value:"form"}]},defaultValue:"link"},{label:"按钮位置",field:"optPosition",component:"Select",componentProps:{options:[{label:"侧面",value:"1"},{label:"底部",value:"2"}]},defaultValue:"2",show:({model:e})=>"form"===e.buttonStyle},{label:"按钮类型",field:"optType",component:"Select",componentProps:{options:[{label:"Js",value:"js"},{label:"Action",value:"action"}]},defaultValue:"js"},{label:"排序",field:"orderNum",component:"InputNumber",componentProps:{style:"width: 100%"}},{label:"按钮图标",field:"buttonIcon",component:"Input",helpMessage:"a-icon type"},{label:"表达式",field:"exp",component:"Input"},{label:"按钮状态",field:"buttonStatus",component:"RadioButtonGroup",componentProps:{options:[{label:"激活",value:"1"},{label:"未激活",value:"0"}]},defaultValue:"1"}],_=r({name:"CustomButtonList",components:{BasicModal:a,BasicTable:o,TableAction:n,BasicForm:l},emits:["register"],setup(){const o=s(""),{doRequest:n,doDeleteRecord:a,tableContext:l}=t({tableProps:{api:e=>((e,t)=>b.get({url:"/online/cgform/button/list/"+e,params:t}))(o.value,e),columns:A,canResize:!1,useSearchForm:!1,beforeFetch:e=>Object.assign(e,{column:"orderNum",order:"asc"})}}),[r,{reload:m},{rowSelection:f,selectedRowKeys:g}]=l,[j,{closeModal:y}]=d((e=>S(this,null,(function*(){o.value=e.row.id,m()})))),{aiTestMode:v,genButtons:x}=e(),[w,C]=c(),h=s(!1),B=u({onRegister:w,title:p((()=>(null==h?void 0:h.value)?"修改":"新增")),width:800,confirmLoading:!1,onOk:function(){return S(this,null,(function*(){try{B.confirmLoading=!0;let e=yield V();e=Object.assign({cgformHeadId:o.value},T,e),yield((e,t)=>t?b.put({url:"/online/cgform/button/edit",params:e}):b.post({url:"/online/cgform/button/add",params:e}))(e,h.value),m(),C.closeModal()}finally{B.confirmLoading=!1}}))},onCancel:C.closeModal});let T={};const[_,{resetFields:D,setFieldsValue:L,validate:V}]=i({schemas:O,showActionButtonGroup:!1});function N(e){return S(this,null,(function*(){var t;h.value=e.isUpdate,T=((e,t)=>{for(var o in t||(t={}))M.call(t,o)&&k(e,o,t[o]);if(P)for(var o of P(t))R.call(t,o)&&k(e,o,t[o]);return e})({},null!=(t=e.record)?t:{}),C.openModal(),yield I(),yield D(),L(T)}))}return{onAdd:function(){N({isUpdate:!1})},onBatchDelete:function(){return S(this,null,(function*(){n((()=>F(g.value)))}))},aiTestMode:v,onGenButtons:function(){x(o.value)},registerModal:j,registerTable:r,selectedRowKeys:g,rowSelection:f,onCancel:function(){y()},getTableAction:function(e){return[{label:"编辑",onClick:()=>function(e){N({isUpdate:!0,record:e})}(e)}]},getDropDownAction:function(e){return[{label:"删除",popConfirm:{title:"确定删除吗？",placement:"left",confirm:()=>a((()=>F([e.id])))}}]},registerForm:_,formModalProps:B}}}),D={key:0,style:{float:"left"}};var L=m(_,[["render",function(e,t,o,n,a,l){const i=f("a-button"),r=f("a-icon"),s=f("a-menu-item"),d=f("a-menu"),c=f("a-dropdown"),u=f("TableAction"),p=f("BasicTable"),m=f("BasicForm"),b=f("a-spin"),I=f("BasicModal");return g(),j(I,{onRegister:e.registerModal,title:"自定义按钮",width:1200,defaultFullscreen:"",onCancel:e.onCancel},{footer:y((()=>[v(i,{onClick:e.onCancel},{default:y((()=>[x("关闭")])),_:1},8,["onClick"]),e.aiTestMode?(g(),w("div",D,[v(i,{onClick:e.onGenButtons},{default:y((()=>[x("生成测试数据")])),_:1},8,["onClick"])])):C("",!0)])),default:y((()=>[v(p,{onRegister:e.registerTable,rowSelection:e.rowSelection},{tableTitle:y((()=>[v(i,{onClick:e.onAdd,type:"primary",preIcon:"ant-design:plus"},{default:y((()=>[x("新增")])),_:1},8,["onClick"]),e.selectedRowKeys.length>0?(g(),j(c,{key:0},{overlay:y((()=>[v(d,null,{default:y((()=>[v(s,{key:"1",onClick:e.onBatchDelete},{default:y((()=>[v(r,{type:"delete"}),x(" 删除 ")])),_:1},8,["onClick"])])),_:1})])),default:y((()=>[v(i,{style:{"margin-left":"8px"}},{default:y((()=>[x(" 批量操作 "),v(r,{type:"down"})])),_:1})])),_:1})):C("",!0)])),action:y((({record:t})=>[v(u,{actions:e.getTableAction(t),dropDownActions:e.getDropDownAction(t)},null,8,["actions","dropDownActions"])])),_:1},8,["onRegister","rowSelection"]),v(I,h(B(e.formModalProps)),{default:y((()=>[v(b,{spinning:e.formModalProps.confirmLoading},{default:y((()=>[v(m,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16)])),_:1},8,["onRegister","onCancel"])}]]);export{L as default};
