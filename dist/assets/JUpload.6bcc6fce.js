var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;import{l,o as s,L as i,v as r,x as u,R as d,S as f,aW as c,y as m,I as p,ax as v,u as g,aN as b,n as h,by as y,a8 as w,r as x,F as C,H as L,t as j,z as O,B as U,E,cJ as k,D as P,W as T,V as N,Q as _,a as A}from"./index.b3c93d64.js";import{c as B}from"./api.dced5d87.js";import{c as I}from"./functional.3bb51b91.js";var z=(e=>(e.all="all",e.image="image",e.file="file",e))(z||{});const V={class:"upload-download-handler"},q={class:"upload-mover-handler"},R=l({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(e){const t=e,{createMessage:n}=g(),a=s((()=>i(t.fileList)));function o(){let e=h();-1!==e?b(e,0!==e?e-1:i(a).length-1):n.warn("移动失败："+e)}function l(){let e=h();-1!==e?e!=i(a).length-1?b(e,e+1):b(e,0):n.warn("移动失败："+e)}function b(e,n){if(e!==n){let o=[...i(a)],l=o[e];o[e]=o[n],o[n]=l,t.emitValue(o.map((e=>e.url)).join(","))}}function h(){var e,n;const o=null==(n=null==(e=t.element)?void 0:e.getElementsByTagName("img")[0])?void 0:n.src;if(o){const e=i(a);for(let t=0;t<e.length;t++){let n=e[t].url;const a=o.replace(window.location.origin,"");if(n===a||encodeURI(n)===a)return t}}return-1}function y(){var e,n;const a=null==(n=null==(e=t.element)?void 0:e.getElementsByTagName("img")[0])?void 0:n.src;window.open(a)}return(t,n)=>(r(),u(v,null,[d(c("div",V,[c("a",{class:"download",title:"下载",onClick:y},[m(i(p),{icon:"ant-design:download"})])],512),[[f,e.download]]),d(c("div",q,[c("a",{title:"向前移动",onClick:o},[m(i(p),{icon:"ant-design:arrow-left"})]),c("a",{title:"向后移动",onClick:l},[m(i(p),{icon:"ant-design:arrow-right"})])],512),[[f,e.mover&&i(a).length>1]])],64))}});const M={key:0},$={class:"ant-upload-text"},S=l({__name:"JUpload",props:{value:b.oneOfType([b.string,b.array]),text:b.string.def("上传"),fileType:b.string.def(z.all),bizPath:b.string.def("temp"),returnUrl:b.bool.def(!0),maxCount:b.number.def(0),buttonVisible:b.bool.def(!0),multiple:b.bool.def(!0),mover:b.bool.def(!0),download:b.bool.def(!0),removeConfirm:b.bool.def(!1),beforeUpload:b.func,disabled:b.bool.def(!1)},emits:["change","update:value"],setup(e,{expose:l,emit:d}){const f=e,{createMessage:b,createConfirm:V}=g(),{prefixCls:q}=h("j-upload"),S=y(),F=w({"X-Access-Token":x()}),H=C([]),J=C(!0),W=C(),D=s((()=>f.maxCount>0&&H.value.length>=f.maxCount)),Q=s((()=>f.fileType===z.image)),X=s((()=>{const e=Object.assign({},f,S);return e.name="file",e.listType=Q.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":f.disabled}],e.data=((e,l)=>{for(var s in l||(l={}))n.call(l,s)&&o(e,s,l[s]);if(t)for(var s of t(l))a.call(l,s)&&o(e,s,l[s]);return e})({biz:f.bizPath},e.data),e.beforeUpload||(e.beforeUpload=ee),Q.value&&!e.accept&&(e.accept="image/*"),e}));L((()=>f.value),(e=>{Array.isArray(e)?f.returnUrl?Z(e.join(",")):function(e){if(!e||0==e.length)return void(H.value=[]);let t=[];for(const n of e){let e=A(n.filePath);t.push({uid:le(),name:n.fileName,url:e,status:"done",response:{status:"history",message:n.filePath}})}H.value=t}(e):Z(e)}),{immediate:!0}),L(H,(()=>_((()=>K()))),{immediate:!0});const G="ant-upload-list-item";function K(){if(!Q.value)return;const e=W.value?W.value.getElementsByClassName(G):null;if(e&&0!==e.length)for(const t of e){"true"===t.getAttribute("data-has-actions")||t.addEventListener("mouseover",Y)}}function Y(e){const t=(()=>{for(const t of e.path){if(t.classList.contains(G))return t;if(t.classList.contains(`${q}-container`))return null}return null})();if(!t)return;const n=t.getElementsByClassName("ant-upload-list-item-actions");if(!n||0===n.length)return;const a=document.createElement("div");a.className="upload-actions-container",k(R,{element:t,fileList:H,mover:f.mover,download:f.download,emitValue:oe}).mount(a),n[0].appendChild(a),t.setAttribute("data-has-actions","true"),t.removeEventListener("mouseover",Y)}function Z(e){if(!e||0==e.length)return void(H.value=[]);let t=[];for(const n of e.split(",")){let e=A(n);t.push({uid:le(),name:se(n),status:"done",url:e,response:{status:"history",message:n}})}H.value=t}function ee(e){return J.value=!0,Q.value&&e.type.indexOf("image")<0?(b.warning("请上传图片"),J.value=!1,!1):"function"!=typeof f.beforeUpload||f.beforeUpload(e)}function te(){return!f.removeConfirm||new Promise((e=>{V({title:"删除",content:`确定要删除这${Q.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}))}function ne(e){e.file.status||!1!==J.value||e.fileList.pop();let t=e.fileList;if(f.maxCount>0){if(t.length>=f.maxCount){if(!(f.maxCount-t.length>=0))return;t=t.slice(-f.maxCount)}}if("done"===e.file.status?e.file.response.success&&(t=t.map((e=>{if(e.response){let t=e.response.message;e.url=A(t)}return e}))):"error"===e.file.status&&b.error(`${e.file.name} 上传失败.`),H.value=t,"done"===e.file.status||"removed"===e.file.status)if(f.returnUrl)!function(){let e=H.value,t="";e&&0!=e.length||(t="");let n=[];for(const a of e){if("done"!==a.status)return;n.push(a.response.message)}n.length>0&&(t=n.join(","));oe(t)}();else{let e=[];for(const n of t){if("done"!==n.status)return;{let t={fileName:n.name,filePath:n.response.message,fileSize:n.size};e.push(t)}}oe(e)}}function ae(e){Q.value?I({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function oe(e){d("change",e),d("update:value",e)}function le(){return"-"+parseInt(1e4*Math.random()+1,10)}function se(e){if(e.lastIndexOf("\\")>=0){let t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)}return l({addActionsListener:K}),(t,n)=>{const a=j("a-button"),o=j("a-upload");return r(),u("div",{ref_key:"containerRef",ref:W,class:E(`${i(q)}-container`)},[m(o,U({headers:F,multiple:e.multiple,action:i(B),fileList:H.value,disabled:e.disabled},i(X),{onRemove:te,onChange:ne,onPreview:ae}),{default:O((()=>[i(Q)?(r(),u(v,{key:0},[i(D)?T("",!0):(r(),u("div",M,[m(i(p),{icon:"ant-design:plus-outlined"}),c("div",$,P(e.text),1)]))],64)):e.buttonVisible?(r(),N(a,{key:1,disabled:i(D)||e.disabled},{default:O((()=>[m(i(p),{icon:"ant-design:upload-outlined"}),c("span",null,P(e.text),1)])),_:1},8,["disabled"])):T("",!0)])),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{z as U,S as _};
