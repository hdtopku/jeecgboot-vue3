var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i;import{B as n}from"./BasicTable.8cbbb86a.js";import{T as l}from"./helper.7e5efd4b.js";import"./TableImg.f02873d7.js";import{u as d}from"./useTable.98dbd6c0.js";import{a1 as p,l as c,m,r as u,o as f,t as b,v as j,x as h,y as g,z as y,L as w,C as x,u as v}from"./index.26a57b91.js";import"./BasicForm.5f094c03.js";import"./uniqBy.006870c7.js";import"./index.934459b9.js";import"./BasicModal.e5e1fb3e.js";import"./useWindowSizeFn.9ed8a10e.js";import"./useForm.18cf269c.js";import"./JAddInput.a2bd8bfb.js";import"./useFormItem.efca0b58.js";import"./api.54a4ca84.js";import"./props.eaaadc91.js";import"./index.3e7bd500.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";import"./index.0d2a049f.js";import"./onMountedOrActivated.d719a17d.js";import"./index.6fce0e9a.js";import"./htmlmixed.fbaa0b47.js";import"./vue.38e13cef.js";/* empty css             */import"./depart.api.c295d6d2.js";import"./index.1a78ea68.js";import"./useContentHeight.3e69d770.js";import"./useContentViewHeight.34b8e2f1.js";import"./usePageContext.dd16d566.js";import"./RedoOutlined.48666e00.js";import"./functional.c7818516.js";import"./download.4b98da42.js";import"./base64Conver.030fa32c.js";import"./index.608c7cf2.js";import"./index.b94b363f.js";import"./useCountdown.e60db803.js";import"./JUpload.7c63ef7b.js";import"./index.9c299300.js";const O=[{title:"文件名称",dataIndex:"fileName",width:120},{title:"文件地址",dataIndex:"url",width:100}],C=[{label:"文件名称",field:"fileName",component:"Input",colProps:{span:6}},{label:"文件地址",field:"url",component:"Input",colProps:{span:6}}],I=e=>p.get({url:"/sys/oss/file/list",params:e}),P=x("OSS文件上传"),T=x("MINIO文件上传"),S=c({name:"system-ossfile"}),U=c((F=((e,t)=>{for(var o in t||(t={}))r.call(t,o)&&a(e,o,t[o]);if(i)for(var o of i(t))s.call(t,o)&&a(e,o,t[o]);return e})({},S),t(F,o({setup(e){const{createMessage:t}=v(),o=m(),i={"X-Access-Token":u()},[r,{reload:s}]=d({api:I,rowKey:"id",columns:O,formConfig:{labelWidth:120,schemas:C,autoSubmitOnEnter:!0},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},beforeFetch:e=>Object.assign({column:"createTime",order:"desc"},e),actionColumn:{width:80,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),a=f((()=>`${o.uploadUrl}/sys/oss/file/upload`)),c=f((()=>`${o.uploadUrl}/sys/upload/uploadMinio`));function x(e){if(e&&e.url){let t=encodeURIComponent(e.url);(t.endsWith(".pdf")||t.endsWith(".doc")||t.endsWith(".docx"))&&(t+="&officePreviewType=pdf");let i=`${o.viewUrl}?url=`+t;window.open(i,"_blank")}}function S(e){return t=this,o=null,i=function*(){var t,o;yield(t={id:e.id},o=s,p.delete({url:"/sys/oss/file/delete",params:t},{joinParamsToUrl:!0}).then((()=>{o()})))},new Promise(((e,r)=>{var s=e=>{try{n(i.next(e))}catch(t){r(t)}},a=e=>{try{n(i.throw(e))}catch(t){r(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,a);n((i=i.apply(t,o)).next())}));var t,o,i}function U(e){var o=e.type;if("image"===o){if(o.indexOf("image")<0)return t.warning("请上传图片"),!1}else if("file"===o&&o.indexOf("image")>=0)return t.warning("请上传文件"),!1;return!0}function F(e){"done"===e.file.status?e.file.response.success?(s(),t.success(`${e.file.name} 上传成功!`)):t.error(`${e.file.response.message}`):"error"===e.file.status&&t.error(`${e.file.response.message}`)}function M(e){return[{label:"预览",onClick:x.bind(null,e)},{label:"删除",popConfirm:{title:"是否确认删除",confirm:S.bind(null,e)}}]}return(e,t)=>{const o=b("a-button"),s=b("a-upload");return j(),h("div",null,[g(w(n),{onRegister:w(r)},{tableTitle:y((()=>[g(s,{name:"file",showUploadList:!1,action:w(a),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[P])),_:1})])),_:1},8,["action"]),g(s,{name:"file",showUploadList:!1,action:w(c),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[T])),_:1})])),_:1},8,["action"])])),action:y((({record:e})=>[g(w(l),{actions:M(e)},null,8,["actions"])])),_:1},8,["onRegister"])])}}}))));var F;export{U as default};
