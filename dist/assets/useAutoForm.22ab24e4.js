import{O as ONL_FORM_TABLE_NAME,F as FormSchemaFactory,a as ONL_AUTH_PRE,V as VALIDATE_FAILED,S as SUBMIT_FLOW_KEY}from"./FormSchemaFactory.9ae4ff2e.js";import{d as duplicateCheck}from"./user.api.365c9555.js";import{c as commonjsGlobal}from"./_commonjsHelpers.7ef9cff5.js";import{y as createVNode,au as AntdIcon,a7 as reactive,eY as _export_sfc,F as ref,o as computed,L as unref,bG as useModalInner,l as defineComponent,cF as Button,H as watch,h,ci as PlusOutlined,en as EditOutlined,aM as propTypes,bH as useModal,ak as useDebounceFn,dI as useRouter,ab as toRaw,ed as usePermissionStore,f2 as replaceAll,a1 as defHttp,Q as nextTick,a9 as watchEffect,j as filterMultiDictText,f3 as markRaw,f4 as defineAsyncComponent,f5 as importViewsFile,a as getFileAccessHttpUrl,d4 as useUserStore,es as Loading,t as resolveComponent,v as openBlock,V as createBlock,x as createElementBlock,z as withCtx,C as createTextVNode,D as toDisplayString,W as createCommentVNode,B as mergeProps,aV as createBaseVNode,aw as Fragment,bb as renderList,E as normalizeClass,r as getToken,f6 as goJmReportViewPage,u as useMessage}from"./index.b3d2a891.js";import{C as CustomExpression}from"./customExpression.58041e91.js";import{T as TableAction,l as add,h as componentMap}from"./helper.1b3fdfba.js";import OnlineSelectCascade from"./OnlineSelectCascade.c7e8662f.js";import{B as BasicModal}from"./index.2d23bddf.js";import{B as BasicForm}from"./BasicForm.2d2aa4ab.js";import{u as useForm}from"./useForm.96d1836c.js";import"./JAddInput.43004d14.js";import{p as pick$1}from"./pick.dbff1c58.js";import{B as BasicTable,F as FormOutlined}from"./BasicTable.5ee1302a.js";import"./TableImg.7ccb5f8d.js";import{useListPage}from"./useListPage.c9ea079e.js";import{g as getAreaTextByCode}from"./Area.5314b018.js";import{c as createImgPreview}from"./functional.4d8eb9e7.js";import LinkTableListPiece from"./LinkTableListPiece.7d4741d4.js";import JModalTip from"./JModalTip.a4f047a6.js";var DiffOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"},DiffOutlinedSvg=DiffOutlined$2;function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),l.forEach(function(c){_defineProperty$2(e,c,n[c])})}return e}function _defineProperty$2(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var DiffOutlined=function(t,n){var l=_objectSpread$2({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$2({},l,{icon:DiffOutlinedSvg}),null)};DiffOutlined.displayName="DiffOutlined";DiffOutlined.inheritAttrs=!1;var DiffOutlined$1=DiffOutlined,MinusCircleFilled$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"},MinusCircleFilledSvg=MinusCircleFilled$2;function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),l.forEach(function(c){_defineProperty$1(e,c,n[c])})}return e}function _defineProperty$1(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MinusCircleFilled=function(t,n){var l=_objectSpread$1({},t,n.attrs);return createVNode(AntdIcon,_objectSpread$1({},l,{icon:MinusCircleFilledSvg}),null)};MinusCircleFilled.displayName="MinusCircleFilled";MinusCircleFilled.inheritAttrs=!1;var MinusCircleFilled$1=MinusCircleFilled,PrinterOutlined$2={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"},PrinterOutlinedSvg=PrinterOutlined$2;function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),l.forEach(function(c){_defineProperty(e,c,n[c])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var PrinterOutlined=function(t,n){var l=_objectSpread({},t,n.attrs);return createVNode(AntdIcon,_objectSpread({},l,{icon:PrinterOutlinedSvg}),null)};PrinterOutlined.displayName="PrinterOutlined";PrinterOutlined.inheritAttrs=!1;var PrinterOutlined$1=PrinterOutlined,__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,n)=>new Promise((l,c)=>{var u=C=>{try{S(n.next(C))}catch(P){c(P)}},m=C=>{try{S(n.throw(C))}catch(P){c(P)}},S=C=>C.done?l(C.value):Promise.resolve(C.value).then(u,m);S((n=n.apply(e,t)).next())}),dayjs_min={exports:{}};(function(e,t){(function(n,l){e.exports=l()})(commonjsGlobal,function(){var n=1e3,l=6e4,c=36e5,u="millisecond",m="second",S="minute",C="hour",P="day",w="week",y="month",$="quarter",_="year",I="date",B="Invalid Date",D=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,N=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},M=function(r,f,i){var a=String(r);return!a||a.length>=f?r:""+Array(f+1-a.length).join(i)+r},j={s:M,z:function(r){var f=-r.utcOffset(),i=Math.abs(f),a=Math.floor(i/60),d=i%60;return(f<=0?"+":"-")+M(a,2,"0")+":"+M(d,2,"0")},m:function r(f,i){if(f.date()<i.date())return-r(i,f);var a=12*(i.year()-f.year())+(i.month()-f.month()),d=f.clone().add(a,y),T=i-d<0,E=f.clone().add(a+(T?-1:1),y);return+(-(a+(i-d)/(T?d-E:E-d))||0)},a:function(r){return r<0?Math.ceil(r)||0:Math.floor(r)},p:function(r){return{M:y,y:_,w,d:P,D:I,h:C,m:S,s:m,ms:u,Q:$}[r]||String(r||"").toLowerCase().replace(/s$/,"")},u:function(r){return r===void 0}},W="en",L={};L[W]=k;var V=function(r){return r instanceof F},p=function r(f,i,a){var d;if(!f)return W;if(typeof f=="string"){var T=f.toLowerCase();L[T]&&(d=T),i&&(L[T]=i,d=T);var E=f.split("-");if(!d&&E.length>1)return r(E[0])}else{var J=f.name;L[J]=f,d=J}return!a&&d&&(W=d),d||!a&&W},b=function(r,f){if(V(r))return r.clone();var i=typeof f=="object"?f:{};return i.date=r,i.args=arguments,new F(i)},v=j;v.l=p,v.i=V,v.w=function(r,f){return b(r,{locale:f.$L,utc:f.$u,x:f.$x,$offset:f.$offset})};var F=function(){function r(i){this.$L=p(i.locale,null,!0),this.parse(i)}var f=r.prototype;return f.parse=function(i){this.$d=function(a){var d=a.date,T=a.utc;if(d===null)return new Date(NaN);if(v.u(d))return new Date;if(d instanceof Date)return new Date(d);if(typeof d=="string"&&!/Z$/i.test(d)){var E=d.match(D);if(E){var J=E[2]-1||0,z=(E[7]||"0").substring(0,3);return T?new Date(Date.UTC(E[1],J,E[3]||1,E[4]||0,E[5]||0,E[6]||0,z)):new Date(E[1],J,E[3]||1,E[4]||0,E[5]||0,E[6]||0,z)}}return new Date(d)}(i),this.$x=i.x||{},this.init()},f.init=function(){var i=this.$d;this.$y=i.getFullYear(),this.$M=i.getMonth(),this.$D=i.getDate(),this.$W=i.getDay(),this.$H=i.getHours(),this.$m=i.getMinutes(),this.$s=i.getSeconds(),this.$ms=i.getMilliseconds()},f.$utils=function(){return v},f.isValid=function(){return this.$d.toString()!==B},f.isSame=function(i,a){var d=b(i);return this.startOf(a)<=d&&d<=this.endOf(a)},f.isAfter=function(i,a){return b(i)<this.startOf(a)},f.isBefore=function(i,a){return this.endOf(a)<b(i)},f.$g=function(i,a,d){return v.u(i)?this[a]:this.set(d,i)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(i,a){var d=this,T=!!v.u(a)||a,E=v.p(i),J=function(R,U){var Q=v.w(d.$u?Date.UTC(d.$y,U,R):new Date(d.$y,U,R),d);return T?Q:Q.endOf(P)},z=function(R,U){return v.w(d.toDate()[R].apply(d.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(U)),d)},Y=this.$W,q=this.$M,X=this.$D,G="set"+(this.$u?"UTC":"");switch(E){case _:return T?J(1,0):J(31,11);case y:return T?J(1,q):J(0,q+1);case w:var ee=this.$locale().weekStart||0,te=(Y<ee?Y+7:Y)-ee;return J(T?X-te:X+(6-te),q);case P:case I:return z(G+"Hours",0);case C:return z(G+"Minutes",1);case S:return z(G+"Seconds",2);case m:return z(G+"Milliseconds",3);default:return this.clone()}},f.endOf=function(i){return this.startOf(i,!1)},f.$set=function(i,a){var d,T=v.p(i),E="set"+(this.$u?"UTC":""),J=(d={},d[P]=E+"Date",d[I]=E+"Date",d[y]=E+"Month",d[_]=E+"FullYear",d[C]=E+"Hours",d[S]=E+"Minutes",d[m]=E+"Seconds",d[u]=E+"Milliseconds",d)[T],z=T===P?this.$D+(a-this.$W):a;if(T===y||T===_){var Y=this.clone().set(I,1);Y.$d[J](z),Y.init(),this.$d=Y.set(I,Math.min(this.$D,Y.daysInMonth())).$d}else J&&this.$d[J](z);return this.init(),this},f.set=function(i,a){return this.clone().$set(i,a)},f.get=function(i){return this[v.p(i)]()},f.add=function(i,a){var d,T=this;i=Number(i);var E=v.p(a),J=function(q){var X=b(T);return v.w(X.date(X.date()+Math.round(q*i)),T)};if(E===y)return this.set(y,this.$M+i);if(E===_)return this.set(_,this.$y+i);if(E===P)return J(1);if(E===w)return J(7);var z=(d={},d[S]=l,d[C]=c,d[m]=n,d)[E]||1,Y=this.$d.getTime()+i*z;return v.w(Y,this)},f.subtract=function(i,a){return this.add(-1*i,a)},f.format=function(i){var a=this,d=this.$locale();if(!this.isValid())return d.invalidDate||B;var T=i||"YYYY-MM-DDTHH:mm:ssZ",E=v.z(this),J=this.$H,z=this.$m,Y=this.$M,q=d.weekdays,X=d.months,G=function(U,Q,x,H){return U&&(U[Q]||U(a,T))||x[Q].slice(0,H)},ee=function(U){return v.s(J%12||12,U,"0")},te=d.meridiem||function(U,Q,x){var H=U<12?"AM":"PM";return x?H.toLowerCase():H},R={YY:String(this.$y).slice(-2),YYYY:this.$y,M:Y+1,MM:v.s(Y+1,2,"0"),MMM:G(d.monthsShort,Y,X,3),MMMM:G(X,Y),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:G(d.weekdaysMin,this.$W,q,2),ddd:G(d.weekdaysShort,this.$W,q,3),dddd:q[this.$W],H:String(J),HH:v.s(J,2,"0"),h:ee(1),hh:ee(2),a:te(J,z,!0),A:te(J,z,!1),m:String(z),mm:v.s(z,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:E};return T.replace(N,function(U,Q){return Q||R[U]||E.replace(":","")})},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(i,a,d){var T,E=v.p(a),J=b(i),z=(J.utcOffset()-this.utcOffset())*l,Y=this-J,q=v.m(this,J);return q=(T={},T[_]=q/12,T[y]=q,T[$]=q/3,T[w]=(Y-z)/6048e5,T[P]=(Y-z)/864e5,T[C]=Y/c,T[S]=Y/l,T[m]=Y/n,T)[E]||Y,d?q:v.a(q)},f.daysInMonth=function(){return this.endOf(y).$D},f.$locale=function(){return L[this.$L]},f.locale=function(i,a){if(!i)return this.$L;var d=this.clone(),T=p(i,a,!0);return T&&(d.$L=T),d},f.clone=function(){return v.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},r}(),g=F.prototype;return b.prototype=g,[["$ms",u],["$s",m],["$m",S],["$H",C],["$W",P],["$M",y],["$y",_],["$D",I]].forEach(function(r){g[r[1]]=function(f){return this.$g(f,r[0],r[1])}}),b.extend=function(r,f){return r.$i||(r(f,F,b),r.$i=!0),b},b.locale=p,b.isDayjs=V,b.unix=function(r){return b(1e3*r)},b.en=L[W],b.Ls=L,b.p={},b})})(dayjs_min);var dayjs=dayjs_min.exports;const ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(e=>CustomExpression[e]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(e,t,n){hasEffectiveValue(t.defVal)&&n.push({field:e,type:t.type,value:t.defVal})}function initSubTableDefValueConfig(e,t){hasEffectiveValue(e.fieldDefaultValue)&&t.push({field:e.key,type:e.type,value:e.fieldDefaultValue})}function loadFormFieldsDefVal(e,t){return __async(this,null,function*(){if(Array.isArray(e)&&e.length>0){let n={};for(let l of e){let{value:c,type:u,field:m}=l;c=yield handleDefaultValue(c,ACTION_TYPES.ADD,{}),u==="number"&&c&&(c=Number.parseFloat(c)),n[m]=c}t(n)}})}function loadOneFieldDefVal(e,t,n){return __async(this,null,function*(){let{defVal:l,type:c}=t;if(hasEffectiveValue(l)){let u=yield handleDefaultValue(l,ACTION_TYPES.ADD,{});c==="number"&&u&&(u=Number.parseFloat(u)),n[e]=u}})}function hasEffectiveValue(e){return!!(e||e===0)}function handleDefaultValue(e,t,n){return __async(this,null,function*(){if(e!=null&&checkExpressionType(e)){let l=yield getDefaultValue(e,t,n);if(l!=null)return l}return e})}function checkExpressionType(e){let t=0,n=0,l=0;if(e.replace(fillRuleRegExp,()=>l++),l>1)return logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u53EA\u80FD\u540C\u65F6\u586B\u5199\u4E00\u4E2A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\uFF01`),!1;e.replace(normalRegExp,()=>t++),e.replace(customRegExp,()=>n++);let c=t+n;return l>0&&c>0?(logWarn(`\u8868\u8FBE\u5F0F[${e}]\u4E0D\u5408\u6CD5\uFF1A\u586B\u503C\u89C4\u5219\u8868\u8FBE\u5F0F\u4E0D\u80FD\u548C\u5176\u4ED6\u8868\u8FBE\u5F0F\u6DF7\u7528\uFF01`),!1):!0}function getRegExpMap(e,t){let n=new Map;return e.replace(t,function(l,c){return n.set(l,c.trim()),l}),n}function getDefaultValue(e,t,n){return __async(this,null,function*(){return(t===ACTION_TYPES.ADD||t===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(e)?yield executeRegExp(e,fillRuleRegExp,executeFillRuleExpression,[n]):t===ACTION_TYPES.ADD?(e=yield executeRegExp(e,normalRegExp,executeNormalExpression),e=yield executeRegExp(e,customRegExp,executeCustomExpression),e):null})}function executeRegExp(e,t,n){return __async(this,arguments,function*(l,c,u,m=[]){let S=getRegExpMap(l,c);for(let C of S.keys()){let P=S.get(C),w=yield u.apply(null,[P,C,...m]);if(C===l)return w;l=replaceAll(l,C,w)}return l})}function executeNormalExpression(e,t){return __async(this,null,function*(){switch(e){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let n=getUserInfoByExpression(e);return n!=null?n:t}})}function getUserInfoByExpression(e){let n=useUserStore().getUserInfo;if(n)switch(e){case"sysUserId":return n.id;case"sysUserCode":case"sys_user_code":return n.username;case"sysUserName":return n.realname;case"sysOrgCode":case"sys_org_code":return n.orgCode}return null}function executeCustomExpression(expression,origin){return __async(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(e){return logError(e),origin}})}function executeFillRuleExpression(e,t,n){return __async(this,null,function*(){let l=`/sys/fillRule/executeRuleByCode/${e}`,c={};typeof n=="function"&&(c=n());let{success:u,message:m,result:S}=yield defHttp.put({url:l,params:c},{isTransformResponse:!1});return u?S:(logError(`\u586B\u503C\u89C4\u5219\uFF08${e}\uFF09\u6267\u884C\u5931\u8D25\uFF1A${m}`),t)})}function logWarn(e){console.warn("[loadFieldDefVal]:",e)}function logError(e){console.error("[loadFieldDefVal]:",e)}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(e,t)=>defHttp.get({url:e,params:t},{isTransformResponse:!1}),postAction=(e,t)=>defHttp.post({url:e,params:t},{isTransformResponse:!1}),putAction=(e,t)=>defHttp.put({url:e,params:t},{isTransformResponse:!1}),deleteAction=(e,t)=>defHttp.delete({url:e,params:t},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(e,t){EnhanceJS&&EnhanceJS[t]&&EnhanceJS[t](e)}function customBeforeSubmit(e,t){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(e,t):Promise.resolve()}function beforeDelete(e,t){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(e,t):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeDelete?t.beforeDelete(onlineTableContext,e):Promise.resolve()},onlineTableContext.beforeEdit=e=>{const t=onlineTableContext.EnhanceJS;return t&&t.beforeEdit?t.beforeEdit(onlineTableContext,e):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(e,{emit:t}){console.log("\u8FDB\u5165online\u5B50\u8868\u8868\u5355\u9875\u9762\u300B\u300B\u300B\u300B"+e.table);const n=ref(null),l=ref(!1),{formSchemas:c,defaultValueFields:u,changeDataIfArray2String:m,tableName:S,dbData:C,checkOnlyFieldValue:P,fieldDisplayStatus:w,createFormSchemas:y,baseColProps:$}=useFormItems(e,n),[_,{setProps:I,validate:B,resetFields:D,setFieldsValue:N,getFieldsValue:k}]=useForm({schemas:c,showActionButtonGroup:!1,baseColProps:$});watch(()=>e.table,()=>{S.value=e.table},{immediate:!0}),watch(()=>e.properties,F=>{console.log("\u4E3B\u8868properties\u6539\u53D8",e.properties),l.value=!1,M(),y(e.properties,e.requiredFields,P),l.value=!0},{deep:!0,immediate:!0}),watch(()=>e.mainId,F=>{console.log("\u4E3B\u8868ID\u6539\u53D8",e.mainId),setTimeout(()=>{W()},100)},{immediate:!0}),watch(()=>e.disabled,F=>{I({disabled:F})});function M(){return __async(this,null,function*(){let F=yield getRefPromise(n);F.$formValueChange=(g,r)=>{let f={[g]:r};t("formChange",f)}})}function j(){if(unref(e.isUpdate)===!1){let F=toRaw(u[S.value]);loadFormFieldsDefVal(F,g=>{N(g)})}}function W(){return __async(this,null,function*(){yield getRefPromise(l),yield D(),j();const{table:F,mainId:g}=e;if(!F||!g)return;let r=yield L(F,g);C.value=r,yield N(r)})}function L(F,g){let r=`${baseUrl}/${F}/${g}`;return new Promise((f,i)=>{defHttp.get({url:r},{isTransformResponse:!1}).then(a=>{console.log(a),a.success?f(a.result):(console.log(a.message),i())})}).finally(()=>{C.value=""})}function V(){return new Promise((F,g)=>{B().then(()=>{let r=k();r=m(r),F(r)}).catch(r=>{g(r)})})}function p(){let F=k();return F.id||(F.id="sub-change-temp-id"),{row:F,target:v}}function b(F){N(F)}const v={onlineFormRef:n,baseColProps:$,formSchemas:c,registerForm:_,setFieldsValue:N,getFieldsValue:k,getFormEvent:p,setValues:b,getAll:V,sh:w};return v}};function _sfc_render$5(e,t,n,l,c,u){const m=resolveComponent("BasicForm");return openBlock(),createBlock(m,{ref:"onlineFormRef",onRegister:e.registerForm},null,8,["onRegister"])}var OnlineSubForm=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"}));const urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading,OnlineSubForm,PrinterOutlined:PrinterOutlined$1,DiffOutlined:DiffOutlined$1,FormOutlined},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0}},emits:["success","rendered","dataChange"],setup(e,{emit:t}){console.log("onlineForm-setup\u300B\u300B");const{createMessage:n}=useMessage(),[l,{openModal:c}]=useModal(),u=ref(""),m=ref(null),S=ref(!0),C=ref(!1),P=ref(1),w=ref(!1),y=ref(!1),$=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:_,resetContext:I}=useOnlineFormContext(),{formSchemas:B,defaultValueFields:D,changeDataIfArray2String:N,tableName:k,dbData:M,checkOnlyFieldValue:j,hasSubTable:W,subTabInfo:L,refMap:V,subDataSource:p,baseColProps:b,createFormSchemas:v,fieldDisplayStatus:F}=useFormItems(e,m);let{EnhanceJS:g,initCgEnhanceJs:r}=useEnhance(_,!1);const[f,{setProps:i,validate:a,resetFields:d,setFieldsValue:T,updateSchema:E,getFieldsValue:J,scrollToField:z}]=useForm({schemas:B,showActionButtonGroup:!1,baseColProps:b}),Y=ref(!1);function q(){let o=e.disabled;Y.value=o,i({disabled:o})}function X(o,s,O){return __async(this,null,function*(){console.log("onlinepopform\u65B0\u589E\u7F16\u8F91\u8FDB\u5165\u8868\u5355\u300B\u300Bform",s),yield d(),M.value="";let A=unref(o);y.value=A,A&&(yield ee(s)),yield nextTick(()=>{!A&&O&&T(O),G(),se("js","loaded"),q()})})}function G(){if(unref(y)===!1){let o=toRaw(D[k.value]);loadFormFieldsDefVal(o,s=>{T(s)})}}function ee(o){return __async(this,null,function*(){let s=yield R(o.id);(!s||Object.keys(s).length==0)&&(s=__spreadValues({},toRaw(o))),M.value=Object.assign({},s);let O=te.value,A=pick$1(s,...O);yield T(A)})}let te=computed(()=>{let o=B.value,s=[];for(let O of o)s.push(O.field);return s});function R(o){let s=`${urlObject.optPre}${e.id}/${o}`;return new Promise((O,A)=>{defHttp.get({url:s},{isTransformResponse:!1}).then(K=>{K.success?O(K.result):(A(),n.warning(K.message))}).catch(()=>{A()})})}function U(o){return __async(this,null,function*(){P.value=o.head.tableType,k.value=o.head.tableName,S.value=o.head.tableType==1,Q(o.head.extConfigJson),v(o.schema.properties,o.schema.required,j),g=r(o.enhanceJs),t("rendered",$);let s=yield getRefPromise(m);s.$formValueChange=(O,A)=>{Te(O,A)}})}function Q(o){let s={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};o&&(s=JSON.parse(o)),Object.keys(s).map(O=>{$[O]=s[O]})}function x(){S.value===!0?ie():H()}function H(){Z().then(o=>{ce(o)})}function Z(){let o={};return new Promise((s,O)=>{a().then(A=>s(A),({errorFields:A})=>{A&&A.length>0&&z(A[0][0]),O(VALIDATE_FAILED)})}).then(s=>(Object.assign(o,N(s)),re())).then(s=>(Object.assign(o,s),Promise.resolve(o))).catch(s=>(s===VALIDATE_FAILED||(s==null?void 0:s.code)===VALIDATE_FAILED?(n.warning("\u6821\u9A8C\u672A\u901A\u8FC7"),s.key&&oe(s.key)):console.error(s),Promise.reject(null)))}function oe(o){let s=L.value;for(let O=0;O<s.length;O++)if(o==s[O].key){ae.value=O+"";break}}function re(){return new Promise((o,s)=>__async(this,null,function*(){let O={};try{let A=L.value;for(let K=0;K<A.length;K++){let ne=A[K].key,le=V[ne].value;if(le instanceof Array&&(le=le[0]),A[K].relationType==1)try{let ue=yield le.getAll();O[ne]=[],O[ne].push(ue)}catch(ue){throw{code:VALIDATE_FAILED,key:ne}}else{if(yield le.fullValidateTable())throw{code:VALIDATE_FAILED,key:ne};O[ne]=le.getTableData()}}}catch(A){s(A)}o(O)}))}function ie(){return __async(this,null,function*(){try{let o=yield a();o=Object.assign({},M.value,o),o=N(o),C.value=!0,ce(o)}finally{C.value=!1}})}function ce(o){De(he,o).then(()=>{Ae(o)}).catch(s=>{n.warning(s)})}function ge(o,s,O){s&&O?O.setValues?O.setValues(o):O.setValues([{rowKey:s,values:o}]):T(o)}function be(o,s){let O={};O[o]=s,T(O)}const ae=ref("0"),de=ref(300),fe=ref(340);function ve(o){if(y.value===!0){let s=M.value;return _e(s,o)}return""}function _e(o,s){if(o){let O=o[s];return!O&&O!==0&&(O=o[s.toLowerCase()],!O&&O!==0&&(O=o[s.toUpperCase()])),O}return""}function ye(o,s){if(g&&g[s+"_onlChange"]){let O=g[s+"_onlChange"](),A=Object.keys(o)[0];if(O[A]){let K=V[s].value;K instanceof Array&&(K=K[0]);let ne=K.getFormEvent(),le=__spreadValues({column:{key:A},value:o[A]},ne);O[A].call(_,_,le)}}}function Ce(o,s){if(g&&g[s+"_onlChange"]){let O=g[s+"_onlChange"](_);O[o.column.key]&&O[o.column.key].call(_,_,o)}}function Fe(o,s){console.log("handleAdded",o,s)}function Se(o){return"online_"+o+":"}function Te(o,s){return __async(this,null,function*(){if(M.value[o]!=s&&t("dataChange",o),!g||!g.onlChange||!o)return!1;let A=g.onlChange();if(A[o]){let ne={row:yield J(),column:{key:o},value:s};A[o].call(_,_,ne)}})}function se(o,s){if(o=="js")g&&g[s]&&g[s].call(_,_);else if(o=="action"){let O=M.value,A={formId:e.id,buttonCode:s,dataId:O.id,uiFormData:Object.assign({},O)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:A},{isTransformResponse:!1}).then(K=>{K.success?n.success("\u5904\u7406\u5B8C\u6210!"):n.warning("\u5904\u7406\u5931\u8D25!")})}}function me(o){let s=V[o].value,O=[...s.getNewDataWithId(),...p.value[o]];if(!O||O.length==0)return!1;let A=[];for(let K of O)A.push(K.id);s.removeRowsById(A)}function pe(o,s){if(!s)return!1;let O=V[o].value;typeof s=="object"?O.addRows(s,!0):n.error("\u6DFB\u52A0\u5B50\u8868\u6570\u636E,\u53C2\u6570\u4E0D\u8BC6\u522B!")}function Oe(o,s){me(o),pe(o,s)}function we(o,s){!s&&s.length<=0&&(s=[]),s.map(O=>{O.hasOwnProperty("label")||(O.label=O.text)}),E({field:o,componentProps:{options:s}})}function De(o,s){return g&&g.beforeSubmit?g.beforeSubmit(o,s):Promise.resolve()}function xe(o,s){let O=toRaw(F);o&&o.length>0?Object.keys(O).map(A=>{!A.endsWith("_load")&&o.indexOf(A)<0&&(F[A]=!1)}):s&&s.length>0&&Object.keys(O).map(A=>{s.indexOf(A)>=0&&(F[A]=!1)})}function Be(o){return __async(this,null,function*(){console.log("\u81EA\u5B9A\u4E49\u5F39\u7A97\u6253\u5F00online\u8868\u5355\u300B\u300Bform",o),yield d(),M.value="",y.value=!0,yield ee(o),yield nextTick(()=>{se("js","loaded")})})}function Me(o){let s=V[o].value;return s instanceof Array&&(s=s[0]),s}function Pe(){let o=$.reportPrintUrl,s=M.value.id,O=getToken();goJmReportViewPage(o,s,O)}function Ee(o){console.log(o),u.value=o.id,c(!0)}function ke(o){console.log(o)}function Ae(o){if(Object.keys(o).map(s=>{Array.isArray(o[s])&&o[s].length==0&&(o[s]="")}),console.log("\u63D0\u4EA4pop\u8868\u5355\u6570\u636E\u300B\u300B\u300Bform:",o),e.request==!1)t("success",o);else{let s=`${urlObject.optPre}${e.id}?tabletype=${P.value}`;console.log("\u63D0\u4EA4pop\u8868\u5355url\u300B\u300B\u300Burl:",s),w.value===!0&&(o[SUBMIT_FLOW_KEY]=1);let O=y.value===!0?"put":"post";defHttp.request({url:s,method:O,params:o},{isTransformResponse:!1}).then(A=>{A.success?(A.result&&(o.id||(o.id=A.result)),t("success",o),M.value=o,y.value=!0,n.success("\u64CD\u4F5C\u6210\u529F!")):n.warning(A.message)}).finally(()=>{C.value=!1})}}function $e(){return __async(this,null,function*(){let o=M.value,s=te.value,O=pick$1(o,...s);if(o)yield T(O);else{let A={};for(let K of s)A[K]="";yield T(A)}})}let he={tableName:k,loading:C,subActiveKey:ae,onlineFormRef:m,getFieldsValue:J,setFieldsValue:T,submitFlowFlag:w,subFormHeight:de,subTableHeight:fe,refMap:V,triggleChangeValues:ge,triggleChangeValue:be,sh:F,clearSubRows:me,addSubRows:pe,clearThenAddRows:Oe,changeOptions:we,isUpdate:y,getSubTableInstance:Me};return I(he),{tableName:k,onlineFormRef:m,registerForm:f,loading:C,subActiveKey:ae,hasSubTable:W,subTabInfo:L,refMap:V,subFormHeight:de,getSubTableForeignKeyValue:ve,isUpdate:y,handleSubFormChange:ye,subTableHeight:fe,onlineFormDisabled:Y,subDataSource:p,getSubTableAuthPre:Se,handleAdded:Fe,handleValueChange:Ce,openSubFormModalForAdd:Ee,openSubFormModalForEdit:ke,registerVxeFormModal:l,vxeTableId:u,show:X,createRootProperties:U,handleSubmit:x,sh:F,handleCgButtonClick:se,handleCustomFormSh:xe,handleCustomFormEdit:Be,dbData:M,onOpenReportPrint:Pe,onlineExtConfigJson:$,recoverFormData:$e}}},_hoisted_1$3=["id"];function _sfc_render$4(e,t,n,l,c,u){const m=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:l.tableName+"_form"},[createVNode(m,{ref:"onlineFormRef",onRegister:l.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}var OnlinePopForm=_export_sfc(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(e,{emit:t}={},n){const l=ref(null),c=ref(!1),u=ref(1),m=ref([]),S=ref(!1),C=ref(0),P=ref(!1),w=ref(""),y=ref(!1),$=ref(!1),_=ref(!0),I=reactive({}),B=ref(!0),D=ref(""),N=ref(!0),k=ref(!1),{popModalFixedWidth:M,resetBodyStyle:j,popBodyStyle:W}=useFixedHeightModal(),L=ref(!1),V={handleOpenModal:x=>{}},p=ref(""),b=ref(""),v=ref(!1);let F={};const g=computed(()=>{let x=D.value;return x||(unref(c)===!0?"\u8BE6\u60C5":unref($)===!0?"\u7F16\u8F91":"\u65B0\u589E")}),[r,{setModalProps:f,closeModal:i}]=useModalInner(x=>__async(this,null,function*(){D.value="",k.value=!1,e===!0?yield V.handleOpenModal(x):yield T(x),j(),n&&n()})),a=ref(!1);function d(){return __async(this,null,function*(){return yield getRefPromise(a),L.value})}function T(x){return __async(this,null,function*(){f({confirmLoading:!1}),$.value=x.isUpdate,c.value=x.disableSubmit||!1,(x==null?void 0:x.hideSub)===!0&&(B.value=!1),x!=null&&x.title&&(D.value=x.title),x!=null&&x.record?b.value=x.record.id:b.value="",yield nextTick(()=>__async(this,null,function*(){yield getRefPromise(S),J(),yield l.value.show(x==null?void 0:x.isUpdate,x==null?void 0:x.record,x==null?void 0:x.param)}))})}function E(x){S.value=!0,C.value=x.modalMinWidth,x.modelFullscreen==1?f({defaultFullscreen:!0}):f({defaultFullscreen:!1}),F=x}function J(){let x=b.value;F.commentStatus==1&&x?(v.value=!0,f({defaultFullscreen:!0})):v.value=!1}const z=800,Y=1100,q=computed(()=>{let x=200*(u.value-1),H=(unref(_)?z:Y)+x;H=X(H);let Z=C.value;return console.log({minWidth:Z}),Z&&H<Z&&(H=Z),console.log({width:H}),H});function X(x){let H=I.modalMinWidth;if(H!=null&&H!=="")try{if(H=Number.parseInt(H),x<H)return H}catch(Z){console.warn("error modalMinWidth value: ",H)}return x}function G(x,H){l.value.handleCgButtonClick(x,H)}function ee(){y.value=!0,setTimeout(()=>{y.value=!1},1500),l.value.handleSubmit()}function te(){i()}function R(x,H={}){let Z=`/online/cgform/api/getFormItem/${x}`;return new Promise((oe,re)=>{defHttp.get({url:Z,params:H},{isTransformResponse:!1}).then(ie=>{console.log("\u8868\u5355\u7ED3\u679C\u300B\u300Bmodal:",ie),ie.success?oe(ie.result):re(ie.message)}).catch(()=>{re()})})}function U(x,H){return __async(this,null,function*(){let Z=yield R(x,H),oe=Z.head.formTemplate;u.value=oe?Number(oe):1,m.value=Z.cgButtonList,P.value=Z.head.isTree==="Y",w.value=Z.head.treeParentIdField||"",p.value=Z.head.tableName,Z.form_disable_update===!0?L.value=!0:L.value=!1,a.value=!0,t&&t("formConfig",Z),yield nextTick(()=>__async(this,null,function*(){yield(yield getRefPromise(l)).createRootProperties(Z)}))})}function Q(x){x[ONL_FORM_TABLE_NAME]=p.value,t("success",x),N.value==!0&&i(),k.value=!1,N.value=!0}return{title:g,modalWidth:q,registerModal:r,closeModal:i,modalObject:V,cgButtonList:m,handleCgButtonClick:G,disableSubmit:c,handleSubmit:ee,submitLoading:y,handleCancel:te,successThenClose:N,handleSuccess:Q,topTipVisible:k,handleFormConfig:U,onlineFormCompRef:l,formTemplate:u,isTreeForm:P,pidFieldName:w,renderSuccess:E,formRendered:S,isUpdate:$,showSub:B,tableName:p,formDataId:b,enableComment:v,popBodyStyle:W,popModalFixedWidth:M,getFormStatus:d}}function useFixedHeightModal(){const t=ref(800);let n=window.innerWidth-300;n<800&&(n=800),t.value=n;const l=ref({});function c(){let u=window.innerHeight-180;l.value={height:u+"px",overflowY:"auto"}}return{popModalFixedWidth:t,popBodyStyle:l,resetBodyStyle:c}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1}},components:{BasicModal,OnlinePopForm,JModalTip,Button},emits:["success","register","formConfig"],setup(e,{emit:t}){console.log("\u8FDB\u5165\u8868\u5355\u5F39\u6846\u300B\u300B\u300B\u300Bmodal");const{title:n,registerModal:l,cgButtonList:c,handleCgButtonClick:u,disableSubmit:m,handleSubmit:S,submitLoading:C,handleCancel:P,handleFormConfig:w,onlineFormCompRef:y,formTemplate:$,isTreeForm:_,pidFieldName:I,renderSuccess:B,formRendered:D,handleSuccess:N,topTipVisible:k,successThenClose:M,isUpdate:j,popBodyStyle:W,popModalFixedWidth:L,getFormStatus:V}=useAutoModal(!1,{emit:t});watch(()=>e.id,p,{immediate:!0});function p(){return __async(this,null,function*(){D.value=!1,e.id&&(console.log("\u91CD\u65B0\u6E32\u67D3\u8868\u5355\u300B\u300B\u300B\u300Bmodal"),yield w(e.id,{}))})}function b(){e.saveClose===!1&&(M.value=!1),S()}function v(){k.value=!1,y.value.recoverFormData()}function F(){k.value=!0}const g=computed(()=>j.value?e.topTip:!1),r=computed(()=>{if(j.value==!0)return null;{let i=C.value;return[h(Button,{type:"primary",loading:i,onClick:S},()=>"\u786E\u5B9A"),h(Button,{onClick:P},()=>"\u5173\u95ED")]}});return{title:n,topTipVisible:k,handleSaveData:b,handleRecover:v,onlineFormCompRef:y,renderSuccess:B,registerModal:l,handleSubmit:S,handleSuccess:N,handleCancel:P,formTemplate:$,disableSubmit:m,cgButtonList:c,handleCgButtonClick:u,isTreeForm:_,pidFieldName:I,submitLoading:C,handleDataChange:F,isUpdate:j,showTopTip:g,modalFooter:r,popBodyStyle:W,popModalFixedWidth:L,getFormStatus:V}}});function _sfc_render$3(e,t,n,l,c,u){const m=resolveComponent("j-modal-tip"),S=resolveComponent("online-pop-form"),C=resolveComponent("BasicModal");return openBlock(),createBlock(C,mergeProps({width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle},e.$attrs,{footer:e.modalFooter,cancelText:"\u5173\u95ED",onRegister:e.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:e.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(e.title)+" ",1),e.showTopTip?(openBlock(),createBlock(m,{key:0,visible:e.topTipVisible,onSave:e.handleSaveData,onCancel:e.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(S,{ref:"onlineFormCompRef",id:e.id,disabled:e.disableSubmit,"form-template":e.formTemplate,isTree:e.isTreeForm,pidField:e.pidFieldName,request:e.request,onRendered:e.renderSuccess,onSuccess:e.handleSuccess,onDataChange:e.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}var OnlinePopModal=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(e,t){const n="/online/cgform/api/getData/"+e;return defHttp.get({url:n,params:t})}function queryTableColumns(e,t){const n="/online/cgform/api/getColumns/"+e;return defHttp.get({url:n,params:t})}function useLinkTable(e){const t=ref("1"),n=ref({}),l=ref({}),c=ref(""),u=reactive({add:!0,update:!0}),m=computed(()=>e.textField?e.textField.split(","):[]),S=ref([]),C=computed(()=>{let p=S.value;return e.multi==!0?p.slice(0,3):p.slice(0,6)});watchEffect(()=>__async(this,null,function*(){if(e.tableName){let b=e.valueField||"",v=e.textField||"",F=[];if(b&&F.push(b),v){let r=v.split(",");c.value=r[0];for(let f of r)F.push(f)}let g=e.imageField||"";g&&F.push(g),n.value={linkTableSelectFields:F.join(",")},yield _(),yield I()}}));const P=computed(()=>{let p=e.textField||"",b=[],v="";if(p){let F=p.split(",");v=F[0];for(let g=0;g<F.length;g++)g>0&&b.push(F[g])}return{others:b,labelField:v}}),w=ref([]),y=ref([]),$=ref({});function _(){return __async(this,null,function*(){let p=n.value;const b=yield queryTableColumns(e.tableName,p);if(y.value=b.columns,b.columns){let v=e.imageField,F=b.columns.filter(g=>g.dataIndex!=c.value&&g.dataIndex!=v);S.value=F}if($.value=b.dictOptions,console.log("\u9690\u85CF\u7684\u6309\u94AE",b.hideColumns),b.hideColumns){let v=b.hideColumns;v.indexOf("add")>=0?u.add=!1:u.add=!0,v.indexOf("update")>=0?u.update=!1:u.update=!0}})}function I(){return __async(this,null,function*(){let p=D(),v=(yield queryTableData(e.tableName,p)).records,F=[],{others:g,labelField:r}=P.value,f=e.imageField;if(v&&v.length>0)for(let i of v){let a=__spreadValues({},i);B(a);let d=Object.assign({},pick$1(a,g),{id:a.id,label:a[r],value:a[e.valueField]});f&&(d[f]=a[f]),F.push(d)}F.push({}),w.value=F})}function B(p){let b=y.value,v=$.value;for(let F of b){const{dataIndex:g,customRender:r}=F;(p[g]||p[g]===0)&&r&&r==g&&v[r]&&(p[g]=filterMultiDictText(v[r],p[g]))}}function D(){return Object.assign({pageSize:10,pageNo:t.value},n.value,l.value)}function N(p){if(!p)l.value={};else{let b=m.value,v=[],F=[];for(let g=0;g<b.length;g++)g<=1&&(F.push(b[g]),v.push({field:b[g],rule:"like",val:p}));v.superQueryMatchType="or",v.superQueryParams=encodeURI(JSON.stringify(v)),l.value=v}}function k(p){return __async(this,null,function*(){if(!p)return[];let b=e.valueField,v=__spreadProps(__spreadValues({},n.value),{pageSize:10,pageNo:t.value});v.superQueryMatchType="and";let F=[{field:b,rule:"in",val:p}];v.superQueryParams=encodeURI(JSON.stringify(F));let r=(yield queryTableData(e.tableName,v)).records,f=[];if(r&&r.length>0)for(let i of r){let a=__spreadValues({},i);B(a),f.push(a)}return f})}function M(p,b){if(!p||p.length==0)return!1;let v=b.split(",");if(v.length!=p.length)return!1;let F=!0;for(let g of p){let r=g[e.valueField];v.indexOf(r)<0&&(F=!1)}return F}function j(p){Object.keys(p).map(b=>{p[b]instanceof Array&&(p[b]=p[b].join(","))})}function W(p,b,v){if(v||(v={}),b&&b.length>0)for(let F of b){let g=F.split(","),r=g[0],f=g[1];if(p[r])p[r].push(v[f]);else{let i=v[f]||"";p[r]=[i]}}}function L(p){if(e.imageField){let b=p[e.imageField];return getFileAccessHttpUrl(b)}return""}const V=computed(()=>!!e.imageField);return{pageNo:t,otherColumns:S,realShowColumns:C,selectOptions:w,reloadTableLinkOptions:I,textFieldArray:m,addQueryParams:N,tableColumns:y,transData:B,mainContentField:c,loadOne:k,compareData:M,formatData:j,initFormData:W,getImageSrc:L,showImage:V,auths:u}}const _sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def([])},emits:["change","update:value"],setup(e,{emit:t}){const n=ref([]),{auths:l,mainContentField:c,textFieldArray:u,selectOptions:m,reloadTableLinkOptions:S,addQueryParams:C,formatData:P,initFormData:w,getImageSrc:y,showImage:$}=useLinkTable(e),[_,{openModal:I}]=useModal(),B=computed(()=>e.tableName),D=computed(()=>e.multi===!0?{mode:"multiple"}:{});function N(p){p==null||p.stopPropagation(),p==null||p.preventDefault(),I(!0,{})}function k(p,b){if(p==null||p.stopPropagation(),p==null||p.preventDefault(),l.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}I(!0,{isUpdate:!0,record:b})}function M(p){return __async(this,null,function*(){yield S();let b=p[e.valueField];n.value=b})}function j(p){C(p),S()}function W(p){L(p),p||(C(),S())}function L(p){let b={},v=e.linkFields,F=[];if(!p)w(b,v);else{let g=toRaw(m.value);console.log("options>>",g);let r=toRaw(p);r instanceof Array?F=[...r]:e.multi==!0?F=r.split(","):F=[r];let f=g.filter(i=>F.indexOf(i[e.valueField])>=0);if(f&&f.length>0){let i=__spreadValues({},f[0]);if(f.length>1)for(let d=1;d<f.length;d++)i=V(i,f[d]);let a=c.value;i[a]=i.label,w(b,v,i)}}P(b),t("change",F.join(",")||"",b),t("update:value",F.join(",")||"")}function V(p,b){let v={};return Object.keys(p).map(F=>{v[F]=(p[F]||"")+","+(b[F]||"")}),v}return watch(()=>e.value,p=>__async(this,null,function*(){p?(e.multi==!0?n.value=p.split(","):n.value=p,e.linkFields&&e.linkFields.length>0&&L(p)):n.value=[]}),{immediate:!0}),watch(()=>m.value,p=>{p&&p.length>0&&e.linkFields&&e.linkFields.length>0&&n.value&&n.value.length>0&&L(n.value)}),{selectValue:n,selectOptions:m,registerPopModal:_,popTableName:B,textFieldArray:u,handleClickAdd:N,handleClickEdit:k,getFormData:M,handleSearch:useDebounceFn(j,800),handleChange:W,bindValue:D,showImage:$,getImageSrc:y,auths:l}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(e,t,n,l,c,u){const m=resolveComponent("PlusOutlined"),S=resolveComponent("EditOutlined"),C=resolveComponent("a-select"),P=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(C,mergeProps({value:l.selectValue,"onUpdate:value":t[1]||(t[1]=w=>l.selectValue=w),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},l.bindValue,{options:l.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:l.handleSearch,onChange:l.handleChange}),{option:withCtx(w=>[!w.value&&l.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:t[0]||(t[0]=(...y)=>l.handleClickAdd&&l.handleClickAdd(...y))},[createVNode(m),createTextVNode(" \u8BB0\u5F55 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[l.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[l.getImageSrc(w)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(w),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[l.auths.update?(openBlock(),createBlock(S,{key:0,onClick:y=>l.handleClickEdit(y,w)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(w.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.textFieldArray,y=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(w[y]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(P,{id:l.popTableName,onRegister:l.registerPopModal,onSuccess:l.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableSelect=_export_sfc(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-2f5e23a7"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(e){dictOptionInfo.value=e.dictOptions,e.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange}:rowSelection.value=null,enableScrollBar.value=e.scrollFlag==1;let t=e.columns;t.forEach(u=>{Object.keys(u).map(m=>{u[m]==null&&delete u[m]})});let n=e.fieldHrefSlots;const l={};n.forEach(u=>l[u.slotName]=u);let c=[];if(c=handleColumnHrefAndDict(t,l),bpmStatusFilter(c),console.log("-----\u5217\u8868\u5217\u914D\u7F6E----",c),onlineTableContext.isTree()===!0){let u=e.textField,m=-1;for(let S=0;S<c.length;S++)if(c[S].dataIndex==u){m=S;break}if(m>0){let S=c.splice(m,1);c.unshift(S[0])}c.length>0&&(c[0].align="left")}columns.value=c,onlineTableContext.reloadTable()}function onSelectChange(e,t){selectedKeys.value=e,onlineTableContext.selectedRows=toRaw(t),onlineTableContext.selectedRowKeys=toRaw(e)}function handleColumnHrefAndDict(e,t){for(let n of e){let{customRender:l,hrefSlotName:c,fieldType:u}=n;if(u=="date"||u=="Date")n.customRender=({text:m})=>m?m.length>10?m.substring(0,10):m:"";else if(u=="link_table")n.customRender=({text:m,record:S})=>{if(!m)return"";if(onlineTableContext.isPopList===!0)return S[n.dataIndex+"_dictText"];{let C=(m+"").split(","),P=S[n.dataIndex+"_dictText"].split(","),w=[];for(let y=0;y<C.length;y++){let $=h(LinkTableListPiece,{id:C[y],text:P[y],onTab:_=>handleClickLinkTable(_,c)});w.push($)}return w.length==0?"":h("div",{style:{overflow:"hidden"}},w)}};else{if(!c&&n.scopedSlots&&n.scopedSlots.customRender&&t.hasOwnProperty(n.scopedSlots.customRender)&&(c=n.scopedSlots.customRender),l||c){let m=l,S="_replace_text_";n.ellipsis=!0,n.customRender=({text:C,record:P})=>{let w=C;if(m)if(m.startsWith(S)){let y=m.replace(S,"");w=P[y]}else w=filterMultiDictText(unref(dictOptionInfo)[m],C+"");if(n.showLength&&w&&w.length>n.showLength&&(w=w.substr(0,n.showLength)+"..."),c){let y=t[c];if(y)return h("a",{onClick:()=>handleClickFieldHref(y,P)},w)}return w}}if(n.scopedSlots){n.ellipsis=!0;let m=n.scopedSlots;n.slots=m,delete n.scopedSlots}}}return e}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let e=href.split(":");hrefMainTableId.value=e[1];let t=e[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[t]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(e,t)=>record[t]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(e){return console.error(e),text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"\u5173\u95ED",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(e){let t=e.indexOf("?"),n=e;if(t!==-1){n=e.substring(0,t);let c=e.substring(t+1,e.length).split("&"),u={};c.forEach(m=>{let S=m.split("=");u[S[0]]=S[1]}),hrefComponent.params=u}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="\u64CD\u4F5C",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(n)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var e,t;((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedAction)===1&&(actionColumn.fixed=((t=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:t.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(e){let t=!1;for(let n=0;n<e.length;n++)if(e[n].dataIndex.toLowerCase()=="bpm_status"){t=!0;break}return onlineTableContext.hasBpmStatus=t,t}function downloadRowFile(e){if(!e)return;e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(",")));let t=getFileAccessHttpUrl(e);window.open(t)}function getImgView(e){return e&&e.indexOf(",")>0&&(e=e.substring(0,e.indexOf(","))),getFileAccessHttpUrl(e)}function getPcaText(e){return e?getAreaTextByCode(e):""}function getFormatDate(e){if(!e)return"";let t=e;return t.length>10&&(t=t.substring(0,10)),t}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(e){if(e){let t=[],n=e.split(",");for(let l of n)l&&t.push(getFileAccessHttpUrl(l));createImgPreview({imageList:t})}}const onlinePopModalRef=ref();function handleClickLinkTable(e,t){return __async(this,null,function*(){popTableId.value=t,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=t,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:e}})):openPopModal(!0,{isUpdate:!0,record:{id:e}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable,TableAction,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(e,{emit:t}){const{createMessage:n}=useMessage(),{popModalFixedWidth:l,resetBodyStyle:c,popBodyStyle:u}=useFixedHeightModal(),m=ref(""),S=ref(800),[C,{closeModal:P}]=useModalInner(()=>{m.value="",E.value=[],J.value=[],d({current:1}),a(),c()}),[w,{openModal:y}]=useModal();function $(){P()}const _=computed(()=>{const R=E.value;return!(R&&R.length>0)}),I=ref(!1);function B(){I.value=!0;let R=toRaw(J.value);R&&R.length>0&&(t("success",R),P()),setTimeout(()=>{I.value=!1},200)}function D(R){const U="/online/cgform/api/getData/"+e.id;return defHttp.get({url:U,params:R})}function N(R){return R.column="id",new Promise((U,Q)=>__async(this,null,function*(){const x=yield D(R);U(x)}))}const k={isPopList:!0,reloadTable(){console.log("reloadTable")},isTree(){return!1}},M=ref({}),{columns:j,downloadRowFile:W,getImgView:L,getPcaText:V,getFormatDate:p,handleColumnResult:b,hrefComponent:v,viewOnlineCellImage:F}=useTableColumns(k,M);function g(){const R="/online/cgform/api/getColumns/"+e.id;return new Promise((U,Q)=>{defHttp.get({url:R},{isTransformResponse:!1}).then(x=>{x.success?U(x.result):(n.warning(x.message),Q())})})}const r=ref("");watch(()=>e.id,()=>__async(this,null,function*(){let R=yield g();b(R),r.value=R.description}),{immediate:!0});const{tableContext:f}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:N,clickToRowSelect:!0,columns:j,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:R=>G(R)}}),[i,{reload:a,setPagination:d},{rowSelection:T,selectedRowKeys:E,selectedRows:J}]=f;watch(()=>e.multi,R=>{R==!0?T.type="checkbox":T.type="radio"},{immediate:!0});function z(R){return[{label:"\u7F16\u8F91",onClick:Y.bind(null,R)}]}function Y(R){console.log("handleUpdate",R)}function q(){a()}const X=["int","double","Date","Datetime","BigDecimal"];function G(R){let U=m.value;if(!U)return R.superQueryMatchType="or",R.superQueryParams="",R;let Q=j.value,x=[];if(Q&&Q.length>0)for(let H of Q)H.dbType&&(H.dbType=="string"?x.push({field:H.dataIndex,type:H.dbType.toLowerCase(),rule:"like",val:U}):H.dbType=="Date"?U.length==10&&x.push({field:H.dataIndex,type:H.dbType.toLowerCase(),rule:"eq",val:U}):H.dbType=="Datetime"?U.length==19&&x.push({field:H.dataIndex,type:H.dbType.toLowerCase(),rule:"eq",val:U}):X.indexOf(H.dbType)&&x.push({field:H.dataIndex,type:H.dbType.toLowerCase(),rule:"eq",val:U}));return R.superQueryMatchType="or",R.superQueryParams=encodeURI(JSON.stringify(x)),R}function ee(){y(!0,{})}function te(R){console.log("handleDateSave",R),t("success",[R]),P()}return{registerModal:C,modalWidth:S,handleCancel:$,submitDisabled:_,submitLoading:I,handleSubmit:B,registerTable:i,getTableAction:z,searchText:m,onSearch:q,downloadRowFile:W,getImgView:L,getPcaText:V,getFormatDate:p,hrefComponent:v,viewOnlineCellImage:F,rowSelection:T,modalTitle:r,registerPopModal:w,handleAdd:ee,reload:a,popModalFixedWidth:l,popBodyStyle:u,handleDataSave:te}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(e,t,n,l,c,u){const m=resolveComponent("PlusOutlined"),S=resolveComponent("a-button"),C=resolveComponent("a-input-search"),P=resolveComponent("TableAction"),w=resolveComponent("BasicTable"),y=resolveComponent("BasicModal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(y,{onRegister:e.registerModal,width:e.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:e.popBodyStyle,title:e.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[e.addAuth?(openBlock(),createBlock(S,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:e.handleAdd},{default:withCtx(()=>[createVNode(m),createTextVNode("\u65B0\u589E\u8BB0\u5F55")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(S,{key:"back",onClick:e.handleCancel},{default:withCtx(()=>[createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),createVNode(S,{disabled:e.submitDisabled,key:"submit",type:"primary",onClick:e.handleSubmit,loading:e.submitLoading},{default:withCtx(()=>[createTextVNode("\u786E\u5B9A")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(w,{onRegister:e.registerTable,rowSelection:e.rowSelection},{title:withCtx(()=>[createVNode(C,{value:e.searchText,"onUpdate:value":t[0]||(t[0]=_=>e.searchText=_),onSearch:e.onSearch,placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD\uFF0C\u6309\u56DE\u8F66\u641C\u7D22",style:{width:"100%"}},null,8,["value","onSearch"])]),action:withCtx(({record:_})=>[createVNode(P,{actions:e.getTableAction(_)},null,8,["actions"])]),fileSlot:withCtx(({text:_})=>[_?(openBlock(),createBlock(S,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:I=>e.downloadRowFile(_)},{default:withCtx(()=>[createTextVNode(" \u4E0B\u8F7D ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"\u65E0\u6587\u4EF6"))]),imgSlot:withCtx(({text:_})=>[_?(openBlock(),createElementBlock("img",{key:1,src:e.getImgView(_),alt:"\u56FE\u7247\u4E0D\u5B58\u5728",class:"online-cell-image",onClick:I=>e.viewOnlineCellImage(_)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"\u65E0\u56FE\u7247"))]),htmlSlot:withCtx(({text:_})=>[createBaseVNode("div",{innerHTML:_},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:_})=>[createBaseVNode("div",{title:e.getPcaText(_)},toDisplayString(e.getPcaText(_)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:_})=>[createBaseVNode("span",null,toDisplayString(e.getFormatDate(_)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode($,{id:e.id,onRegister:e.registerPopModal,onSuccess:e.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}var OnlinePopListModal=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"}));const _sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def([])},components:{PlusOutlined,MinusCircleFilled:MinusCircleFilled$1,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(e,{emit:t}){const n=computed(()=>e.tableName),[l,{openModal:c}]=useModal(),[u,{openModal:m}]=useModal(),S=ref([]),C=ref([]),P=computed(()=>!(e.disabled==!0||e.multi===!1&&C.value.length>0)),{auths:w,otherColumns:y,realShowColumns:$,tableColumns:_,textFieldArray:I,transData:B,loadOne:D,compareData:N,formatData:k,initFormData:M,getImageSrc:j,showImage:W}=useLinkTable(e),L=computed(()=>e.multi===!0?12:24),V=computed(()=>e.multi===!0?24:12);function p(a){if(a&&I.value.length>0){let d=I.value[0];return a[d]}}function b(a){a==null||a.stopPropagation(),a==null||a.preventDefault()}function v(a,d){if(b(a),w.update==!1){console.error("\u5F53\u524D\u7528\u6237\u65E0\u7F16\u8F91\u6743\u9650!");return}e.disabled==!1&&m(!0,{isUpdate:!0,record:d})}function F(a){c(!0,{})}function g(a){let d=C.value;for(let T of a){let E=__spreadValues({},T);B(E),d.push(E)}C.value=d,i()}function r(a){let d=C.value;for(let T=0;T<d.length;T++)if(d[T].id===a.id){let E=__spreadValues({},a);B(E),d.splice(T,1,E)}C.value=d,i()}function f(a,d){b(a);let T=C.value;T&&T.length>d&&(T.splice(d,1),C.value=T),i()}function i(){let a=C.value,d=[],T={},E=e.linkFields;if(a.length>0)for(let z=0;z<a.length;z++)d.push(a[z][e.valueField]),M(T,E,a[z]);else M(T,E);let J=d.join(",");k(T),t("change",J,T),t("update:value",J)}return watch(()=>e.value,a=>__async(this,null,function*(){if(a){if(N(C.value,a)===!1){let T=yield D(a);C.value=T}e.linkFields&&e.linkFields.length>0&&i()}else C.value=[]}),{immediate:!0}),{popTableName:n,selectRecords:C,otherColumns:y,realShowColumns:$,showButton:P,selectValue:S,handleAddRecord:F,handleDeleteRecord:f,getMainContent:p,itemSpan:L,columnSpan:V,tableColumns:_,addCard:g,registerListModal:l,registerFormModal:u,handleClickEdit:v,updateCardData:r,getImageSrc:j,showImage:W,auths:w}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(e,t,n,l,c,u){const m=resolveComponent("PlusOutlined"),S=resolveComponent("a-button"),C=resolveComponent("minus-circle-filled"),P=resolveComponent("a-col"),w=resolveComponent("a-row"),y=resolveComponent("online-pop-list-modal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[l.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(S,{onClick:l.handleAddRecord},{default:withCtx(()=>[createVNode(m),createTextVNode("\u8BB0 \u5F5511")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.selectRecords,(_,I)=>(openBlock(),createBlock(P,{span:l.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":n.detail==!0}]),onClick:B=>l.handleClickEdit(B,_)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":l.showImage}])},[n.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(C,{onClick:B=>l.handleDeleteRecord(B,I)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(l.getMainContent(_)),1),createBaseVNode("div",_hoisted_8,[createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.realShowColumns,B=>(openBlock(),createBlock(P,{span:l.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(B.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(_[B.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),l.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[l.getImageSrc(_)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(_),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(y,{onRegister:l.registerListModal,multi:n.multi,id:l.popTableName,addAuth:l.auths.add,onSuccess:l.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode($,{id:l.popTableName,onRegister:l.registerFormModal,onSuccess:l.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableCard=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-0fb2a14b"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"}));const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(e,t){add("OnlineSelectCascade",OnlineSelectCascade),add("LinkTableSelect",LinkTableSelect),add("LinkTableCard",LinkTableCard),console.log(" componentMap val =",componentMap);const n=e.modalClass,l=ref([]),c=ref(""),u=ref({}),m=reactive({}),S=ref(!1),C=ref([]),P=ref({}),w={},y=ref([]),$=reactive({}),_=ref("");_.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function I(M,j,W){clearObj($),$[c.value]=[];let L=[],V=[],p=[],b={},v={};Object.keys(M).map(g=>{const r=M[g];if(r.view=="tab"){S.value=!0,$[g]=[];let f={key:g,foreignKey:r.foreignKey,describe:r.describe,relationType:r.relationType,requiredFields:r.required||[],order:r.order,id:r.id};r.relationType==1?(w[g]=ref(null),f.properties=r.properties):(B(r),w[g]=ref(),f.columns=r.columns,b[g]=[]),L.push(f),handleSubTableButtonAuth(g,r)}else if(initDefValueConfig(g,r,$[c.value]),r.view===LINK_DOWN){let f=handleLinkDown(r,g);for(let i of f){m[i.key]=!0,m[i.key+"_load"]=!0;let a=FormSchemaFactory.createFormSchema(i.key,i);W&&a.setOnlyValidateFun(W),a.isRequired(j),a.setFormRef(t),a.handleWidgetAttr(r);let d=getFieldIndex(V,i.key);d==-1?V.push(a):V[d]=a}}else if(m[g]=!0,m[g+"_load"]=!0,getFieldIndex(V,g)==-1){let i=FormSchemaFactory.createFormSchema(g,r);if(W&&i.setOnlyValidateFun(W),i.isRequired(j),i.setFormRef(t),V.push(i),p.push(...i.getRelatedHideFields()),r.view===LINK_TABLE_FIELD){let a=i.getLinkFieldInfo();a&&(v[a[0]]?v[a[0]].push(a[1]):v[a[0]]=[a[1]])}}}),V.sort(function(g,r){return g.order-r.order});let F=[];F.push(FormSchemaFactory.createIdField());for(let g of V)g.view&&g.view==LINK_TABLE&&v[g.field]&&g.setOtherInfo(v[g.field]),p.indexOf(g.field)>=0&&g.isHidden(),n&&g.setCustomPopContainer(n),F.push(g.getFormItemSchema());l.value=F,L.sort(function(g,r){return g.order-r.order}),C.value=L,P.value=b}watch(m,M=>{let j=t.value,W=[],L=toRaw(M);Object.keys(L).map(V=>{if(!V.endsWith("_load")){let p={field:V,show:L[V]},b=V+"_load";L.hasOwnProperty(b)&&(p.ifShow=L[b]),W.push(p)}}),j&&j.updateSchema(W)},{immediate:!1});function B(M){useOnlineVxeTableColumns(M,j=>{initSubTableDefValueConfig(j,$[M.key])})}watch(()=>e.formTemplate,()=>{_.value=D()},{immediate:!0});function D(){let M=e.formTemplate;return M==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:M==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:M==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{span:24}}function N(M,j){return new Promise(W=>{j||W("");let V={tableName:c.value.replace(/\$\d+/,""),fieldName:M.field,fieldVal:j},p=u.value;p.id&&(V.dataId=p.id),duplicateCheck(V).then(b=>{b.success?W(""):W(b.message)}).catch(b=>{W(b)})})}function k(M){return Object.keys(M).map(j=>{M[j]&&M[j]instanceof Array&&(M[j]=M[j].join(","))}),M}return{formSchemas:l,defaultValueFields:$,tableName:c,dbData:u,checkOnlyFieldValue:N,createFormSchemas:I,fieldDisplayStatus:m,subTabInfo:C,hasSubTable:S,subDataSource:P,baseColProps:_,changeDataIfArray2String:k,linkDownList:y,refMap:w}}function useOnlineVxeTableColumns(e,t){const n={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};e.columns.forEach(u=>{u.type==="radio"?u.type="select":n[u.type]?u.type=n[u.type]:u.type==="popup"&&l(u),u.type==="depart-select"&&(u.checkStrictly=!0),u.type==="user-select"&&c(u),(u.width==120||u.width=="120px")&&(u.type=="image"||u.type=="file")&&(u.width="130px"),u.width||(u.width="200px"),t&&t(u)});function l(u){let{destFields:m,orgFields:S}=u,C=[];if(!(!m||m.length==0)){let P=m.split(","),w=S.split(",");for(let y=0;y<P.length;y++)C.push({target:P[y],source:w[y]})}u.fieldConfig=C}function c(u){let m=u.fieldExtendJson,S=!1;if(m)try{JSON.parse(m).multiSelect===!1&&(S=!0)}catch(C){console.log("\u5B50\u8868\u83B7\u53D6\u7528\u6237\u7EC4\u4EF6\u7684\u6269\u5C55\u914D\u7F6E\u51FA\u73B0\u9519\u8BEF",C)}u.isRadioSelection=S}}function useOnlineFormContext(){let e={};const t={},n=new Proxy(t,{get(u,m){return Reflect.get(e,m)}});function l(u,m){e[u]=m}function c(u){Object.keys(u).map(m=>{e[m]=u[m]})}return l("$nextTick",nextTick),l("addObject2Context",l),{onlineFormContext:n,addObject2Context:l,resetContext:c}}function handleLinkDown(e,t){const{config:{table:n,key:l,txt:c,linkField:u,idField:m,pidField:S,condition:C},others:P,order:w,title:y}=e;let $={dictTable:n,dictText:c,dictCode:l,pidField:S,idField:m,view:LINK_DOWN,type:e.type},_=[],I=__spreadValues({key:t,title:y,order:w,condition:C,origin:!0},$);if(u&&u.length>0){let B=u.split(",");I.next=B[0];for(let D=0;D<B.length;D++)for(let N of P)if(N.field==B[D]){let k=__spreadValues({key:N.field,title:N.title,order:N.order,origin:!1},$);D+1<B.length&&(k.next=B[D+1]),_.push(k)}}return _.push(I),_}function getFieldIndex(e,t){let n=-1;for(let l=0;l<e.length;l++)if(e[l].field===t){n=l;break}return n}function getRefPromise(e){return new Promise(t=>{(function n(){let l=e.value;l?t(l):setTimeout(()=>{n()},100)})()})}function clearObj(e){Object.keys(e).map(t=>{delete e[t]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(e,t){let n=t.hideButtons,l=ONL_AUTH_PRE+e+":";n||(n=[]),permissionStore.setOnlineSubTableAuth(l,n)}function getDetailFormSchemas(e){const t=ref([]),n={},l=ref(!1),c=ref([]),u=ref({}),m=computed(()=>{let y=e.formTemplate;return y=="2"?12:y=="3"?8:y=="4"?6:24});function S(y){let $=[];console.log("111",y);let _=[],I={};Object.keys(y).map(B=>{const D=y[B];if(D.view=="tab"){l.value=!0;let N={key:B,foreignKey:D.foreignKey,describe:D.describe,relationType:D.relationType,requiredFields:D.required||[],order:D.order};D.relationType==1?(n[B]=ref(null),N.properties=D.properties):(C(D),n[B]=ref(),N.columns=D.columns,I[B]=[]),$.push(N)}else if(D.view===LINK_DOWN){let N=w(D,B);for(let k of N){let M=P(_,k.key),j={field:k.key,label:k.title,view:k.view,order:k.order,dictTable:k.dictTable,linkField:k.linkField||""};M==-1?_.push(j):_[M]=j}}else if(D.view!="hidden"){if(P(_,B)==-1){let k=Object.assign({field:B,label:D.title},pick$1(D,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(D.view=="file"&&(k.span=24,k.isFile=!0),D.view=="image"&&(k.span=24,k.isImage=!0),D.view=="link_table"&&D.fieldExtendJson)try{let M=JSON.parse(D.fieldExtendJson);M.showType!="select"&&(k.isCard=!0),M.multiSelect==!0&&(k.multi=!0)}catch(M){console.error("\u89E3\u6790json\u5B57\u7B26\u4E32\u51FA\u9519",D.fieldExtendJson)}(D.view=="umeditor"||D.view=="markdown")&&(k.isHtml=!0,k.span=24),_.push(k)}}}),_.sort(function(B,D){return B.order-D.order}),$.sort(function(B,D){return B.order-D.order}),c.value=$;for(let B=0;B<_.length;B++){let D=_[B];if((D.isFile===!0||D.isImage===!0||D.isHtml===!0)&&B>0){let N=_[B-1],k=N.span||m.value;N.span=k}}t.value=_,u.value=I,console.log("adadad",_)}function C(y){useOnlineVxeTableColumns(y)}function P(y,$){let _=-1;for(let I=0;I<y.length;I++)if(y[I].field===$){_=I;break}return _}function w(y,$){let _=[];const{config:{table:I,key:B,txt:D,linkField:N},order:k,title:M,others:j}=y;let W={table:I,key:B,txt:D},L={view:"link_down",order:k,title:M,dictTable:JSON.stringify(W)};if(_.push(Object.assign({},{linkField:N,key:$},L)),N){let V=N.split(",");for(let p of V){let b="";for(let v of j)v.field==p&&(b=v.title);_.push(Object.assign({},{key:p},L,{title:b}))}}return _}return{detailFormSchemas:t,hasSubTable:l,subTabInfo:c,refMap:n,createFormSchemas:S,formSpan:m,subDataSource:u}}var useAutoForm=Object.freeze(Object.defineProperty({__proto__:null,L:LinkTableCard,O:OnlineSubForm,a:OnlinePopModal,b:useFormItems,c:useEnhance,d:getDetailFormSchemas,e:loadOneFieldDefVal,f:LINK_DOWN,g:getRefPromise,h:handleLinkDown,i:getFieldIndex,j:useTableColumns,k:useAutoModal,l:loadFormFieldsDefVal,m:OnlineSubForm$1,n:OnlinePopForm$1,o:OnlinePopModal$1,p:LinkTableSelect$1,q:OnlinePopListModal$1,r:LinkTableCard$1,u:useOnlineFormContext},Symbol.toStringTag,{value:"Module"}));export{DiffOutlined$1 as D,LinkTableCard as L,OnlineSubForm as O,PrinterOutlined$1 as P,OnlinePopModal as a,useFormItems as b,useEnhance as c,getDetailFormSchemas as d,loadOneFieldDefVal as e,LINK_DOWN as f,getRefPromise as g,handleLinkDown as h,getFieldIndex as i,useTableColumns as j,useAutoModal as k,loadFormFieldsDefVal as l,useAutoForm as m,useOnlineFormContext as u};
