var e=(e,t,a)=>new Promise(((o,l)=>{var r=e=>{try{n(a.next(e))}catch(t){l(t)}},s=e=>{try{n(a.throw(e))}catch(t){l(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,s);n((a=a.apply(e,t)).next())}));import{a as t,u as a,B as o}from"./index.5cedb984.js";import{_ as l}from"./index.27a29657.js";import{q as r,l as s,F as n,L as i,t as c,v as u,V as d,z as f,y as m,bD as v,C as p,D as y,W as g,B as h}from"./index.b2c24a42.js";import k from"./RoleDataRuleDrawer.7a53f8a7.js";import{q as x,c as w,e as _}from"./role.api.497c86df.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";const j=p("取消"),D=p("仅保存"),C=p("保存并关闭");var I=r(s({__name:"RolePermissionDrawer",emits:["register"],setup(r,{emit:s}){const I=n([]),R=n([]),b=n([]),K=n([]),P=n([]),T=n(""),F=n(null),L=n(!1),[q,{openDrawer:B}]=t(),[E,{setDrawerProps:S,closeDrawer:z}]=a((t=>e(this,null,(function*(){yield(I.value=[],R.value=[],b.value=[],K.value=[],P.value=[],void(T.value="")),S({confirmLoading:!1,loading:!0}),T.value=t.roleId;const e=yield x();I.value=e.treeList,R.value=e.ids;const a=yield w({roleId:i(T)});b.value=a,K.value=a,S({loading:!1})}))));function M(e){b.value=e.checked?e.checked:e}function O(e){e&&e.length>0&&(P.value=e),B(!0,{functionId:i(P)[0],roleId:i(T)})}function V(){const e=i(F);if(!e)throw new Error("tree is null!");return e}function W(t){return e(this,null,(function*(){let e={roleId:i(T),permissionIds:i(V().getCheckedKeys()).join(","),lastpermissionIds:i(K).join(",")};L.value=!0,yield _(e),L.value=!1,t&&z()}))}return(e,t)=>{const a=c("Icon"),r=c("a-button");return u(),d(i(o),h(e.$attrs,{onRegister:i(E),title:"角色权限配置",width:"650px",destroyOnClose:"",showFooter:""}),{footer:f((()=>[m(i(v),{title:"确定放弃编辑？",onConfirm:i(z),okText:"确定",cancelText:"取消"},{default:f((()=>[j])),_:1},8,["onConfirm"]),m(r,{onClick:t[0]||(t[0]=e=>W(!1)),type:"primary",loading:L.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:f((()=>[D])),_:1},8,["loading"]),m(r,{onClick:t[1]||(t[1]=e=>W(!0)),type:"primary",loading:L.value},{default:f((()=>[C])),_:1},8,["loading"])])),default:f((()=>[m(i(l),{ref_key:"treeRef",ref:F,checkable:"",toolbar:"",treeData:I.value,checkedKeys:b.value,expandedKeys:R.value,selectedKeys:P.value,checkStrictly:!0,clickRowToExpand:!1,title:"所拥有的的权限",onCheck:M,onSelect:O},{title:f((({slotTitle:e,ruleFlag:t})=>[p(y(e)+" ",1),t?(u(),d(a,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):g("",!0)])),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys"]),m(k,{onRegister:i(q)},null,8,["onRegister"])])),_:1},16,["onRegister"])}}}),[["__scopeId","data-v-5ab79653"]]);export{I as default};
