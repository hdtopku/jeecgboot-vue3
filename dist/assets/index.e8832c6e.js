var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i;import{B as n}from"./BasicTable.cdd414e6.js";import{T as d}from"./helper.ec3e26f3.js";import"./TableImg.6cb3a734.js";import{u as l}from"./useTable.4670d269.js";import{a1 as p,l as c,m,r as u,o as f,t as b,v as j,x as h,y as g,z as y,L as w,C as x,u as v}from"./index.b3c93d64.js";import"./BasicForm.79466d99.js";import"./uniqBy.30d2558a.js";import"./index.ee0a0c33.js";import"./BasicModal.2a8ad889.js";import"./useWindowSizeFn.e6386ae5.js";import"./useForm.ee23be26.js";import"./JAddInput.c8a1b05b.js";import"./useFormItem.d029403d.js";import"./api.dced5d87.js";import"./props.a4f5d1ca.js";import"./index.c4683457.js";import"./bem.3d3e77ca.js";import"./props.c13d8268.js";import"./useContextMenu.de287960.js";import"./index.9bbe419b.js";import"./onMountedOrActivated.d3784e6c.js";import"./index.36d6c198.js";import"./htmlmixed.ba3cd961.js";import"./vue.8c416d71.js";/* empty css             */import"./depart.api.429e062c.js";import"./index.4258d6df.js";import"./useContentHeight.7565ed37.js";import"./useContentViewHeight.d3266665.js";import"./usePageContext.f338fb2a.js";import"./RedoOutlined.c563bb0b.js";import"./functional.3bb51b91.js";import"./download.261c8978.js";import"./base64Conver.030fa32c.js";import"./index.d2e70b0d.js";import"./index.17ec2e33.js";import"./useCountdown.cb4ad478.js";import"./JUpload.6bcc6fce.js";import"./index.ef2039b9.js";const O=[{title:"文件名称",dataIndex:"fileName",width:120},{title:"文件地址",dataIndex:"url",width:100}],C=[{label:"文件名称",field:"fileName",component:"Input",colProps:{span:6}},{label:"文件地址",field:"url",component:"Input",colProps:{span:6}}],I=e=>p.get({url:"/sys/oss/file/list",params:e}),P=x("OSS文件上传"),T=x("MINIO文件上传"),S=c({name:"system-ossfile"}),U=c((F=((e,t)=>{for(var o in t||(t={}))r.call(t,o)&&a(e,o,t[o]);if(i)for(var o of i(t))s.call(t,o)&&a(e,o,t[o]);return e})({},S),t(F,o({setup(e){const{createMessage:t}=v(),o=m(),i={"X-Access-Token":u()},[r,{reload:s}]=l({api:I,rowKey:"id",columns:O,formConfig:{labelWidth:120,schemas:C,autoSubmitOnEnter:!0},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},beforeFetch:e=>Object.assign({column:"createTime",order:"desc"},e),actionColumn:{width:80,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),a=f((()=>`${o.uploadUrl}/sys/oss/file/upload`)),c=f((()=>`${o.uploadUrl}/sys/upload/uploadMinio`));function x(e){if(e&&e.url){let t=encodeURIComponent(e.url);(t.endsWith(".pdf")||t.endsWith(".doc")||t.endsWith(".docx"))&&(t+="&officePreviewType=pdf");let i=`${o.viewUrl}?url=`+t;window.open(i,"_blank")}}function S(e){return t=this,o=null,i=function*(){var t,o;yield(t={id:e.id},o=s,p.delete({url:"/sys/oss/file/delete",params:t},{joinParamsToUrl:!0}).then((()=>{o()})))},new Promise(((e,r)=>{var s=e=>{try{n(i.next(e))}catch(t){r(t)}},a=e=>{try{n(i.throw(e))}catch(t){r(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,a);n((i=i.apply(t,o)).next())}));var t,o,i}function U(e){var o=e.type;if("image"===o){if(o.indexOf("image")<0)return t.warning("请上传图片"),!1}else if("file"===o&&o.indexOf("image")>=0)return t.warning("请上传文件"),!1;return!0}function F(e){"done"===e.file.status?e.file.response.success?(s(),t.success(`${e.file.name} 上传成功!`)):t.error(`${e.file.response.message}`):"error"===e.file.status&&t.error(`${e.file.response.message}`)}function M(e){return[{label:"预览",onClick:x.bind(null,e)},{label:"删除",popConfirm:{title:"是否确认删除",confirm:S.bind(null,e)}}]}return(e,t)=>{const o=b("a-button"),s=b("a-upload");return j(),h("div",null,[g(w(n),{onRegister:w(r)},{tableTitle:y((()=>[g(s,{name:"file",showUploadList:!1,action:w(a),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[P])),_:1})])),_:1},8,["action"]),g(s,{name:"file",showUploadList:!1,action:w(c),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[T])),_:1})])),_:1},8,["action"])])),action:y((({record:e})=>[g(w(d),{actions:M(e)},null,8,["actions"])])),_:1},8,["onRegister"])])}}}))));var F;export{U as default};
