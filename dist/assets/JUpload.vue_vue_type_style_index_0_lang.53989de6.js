var se=Object.defineProperty;var M=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var O=(s,i,u)=>i in s?se(s,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[i]=u,j=(s,i)=>{for(var u in i||(i={}))oe.call(i,u)&&O(s,u,i[u]);if(M)for(var u of M(i))le.call(i,u)&&O(s,u,i[u]);return s};import{j as K,m as B,s as C,t as _,N as z,O as $,aW as v,v as h,K as m,I as F,ax as Q,u as W,aN as c,l as ie,bv as ue,a8 as re,n as ce,C as N,E as R,r as q,w as S,x as de,B as fe,cI as me,z as G,R as J,Q as pe,G as ge,a as I}from"./index.9ce08993.js";import{c as ve}from"./api.296f37ed.js";import{c as he}from"./functional.3edf4999.js";var P=(s=>(s.all="all",s.image="image",s.file="file",s))(P||{});const be={class:"upload-download-handler"},we={class:"upload-mover-handler"},Ce=K({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(s){const i=s,{createMessage:u}=W(),o=B(()=>m(i.fileList));function y(){let t=x();if(t===-1){u.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+t);return}if(t===0){p(t,m(o).length-1);return}p(t,t-1)}function E(){let t=x();if(t===-1){u.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+t);return}if(t==m(o).length-1){p(t,0);return}p(t,t+1)}function p(t,d){if(t!==d){let r=[...m(o)],g=r[t];r[t]=r[d],r[d]=g,i.emitValue(r.map(f=>f.url).join(","))}}function x(){var d,r;const t=(r=(d=i.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:r.src;if(t){const g=m(o);for(let f=0;f<g.length;f++){let A=g[f].url;const b=t.replace(window.location.origin,"");if(A===b||encodeURI(A)===b)return f}}return-1}function U(){var d,r;const t=(r=(d=i.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:r.src;window.open(t)}return(t,d)=>(C(),_(Q,null,[z(v("div",be,[v("a",{class:"download",title:"\u4E0B\u8F7D",onClick:U},[h(m(F),{icon:"ant-design:download"})])],512),[[$,s.download]]),z(v("div",we,[v("a",{title:"\u5411\u524D\u79FB\u52A8",onClick:y},[h(m(F),{icon:"ant-design:arrow-left"})]),v("a",{title:"\u5411\u540E\u79FB\u52A8",onClick:E},[h(m(F),{icon:"ant-design:arrow-right"})])],512),[[$,s.mover&&o.value.length>1]])],64))}}),Fe={key:0},ye={class:"ant-upload-text"},H="ant-upload-list-item",Ee=K({__name:"JUpload",props:{value:c.oneOfType([c.string,c.array]),text:c.string.def("\u4E0A\u4F20"),fileType:c.string.def(P.all),bizPath:c.string.def("temp"),returnUrl:c.bool.def(!0),maxCount:c.number.def(0),buttonVisible:c.bool.def(!0),multiple:c.bool.def(!0),mover:c.bool.def(!0),download:c.bool.def(!0),removeConfirm:c.bool.def(!1),beforeUpload:c.func,disabled:c.bool.def(!1)},emits:["change","update:value"],setup(s,{expose:i,emit:u}){const o=s,{createMessage:y,createConfirm:E}=W(),{prefixCls:p}=ie("j-upload"),x=ue(),U=re({"X-Access-Token":ce()}),t=N([]),d=N(!0),r=N(),g=B(()=>o.maxCount>0&&t.value.length>=o.maxCount),f=B(()=>o.fileType===P.image),A=B(()=>{const e=Object.assign({},o,m(x));return e.name="file",e.listType=f.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":o.disabled}],e.data=j({biz:o.bizPath},e.data),e.beforeUpload||(e.beforeUpload=Y),f.value&&!e.accept&&(e.accept="image/*"),e});R(()=>o.value,e=>{Array.isArray(e)?o.returnUrl?D(e.join(",")):X(e):D(e)},{immediate:!0}),R(t,()=>ge(()=>b()),{immediate:!0});function b(){if(!f.value)return;const e=r.value?r.value.getElementsByClassName(H):null;if(!(!e||e.length===0))for(const a of e)a.getAttribute("data-has-actions")==="true"||a.addEventListener("mouseover",T)}function T(e){const n=(()=>{for(const k of e.path){if(k.classList.contains(H))return k;if(k.classList.contains(`${p}-container`))return null}return null})();if(!n)return;const l=n.getElementsByClassName("ant-upload-list-item-actions");if(!l||l.length===0)return;const w=document.createElement("div");w.className="upload-actions-container",me(Ce,{element:n,fileList:t,mover:o.mover,download:o.download,emitValue:L}).mount(w),l[0].appendChild(w),n.setAttribute("data-has-actions","true"),n.removeEventListener("mouseover",T)}function D(e){if(!e||e.length==0){t.value=[];return}let a=[];for(const n of e.split(",")){let l=I(n);a.push({uid:V(),name:ae(n),status:"done",url:l,response:{status:"history",message:n}})}t.value=a}function X(e){if(!e||e.length==0){t.value=[];return}let a=[];for(const n of e){let l=I(n.filePath);a.push({uid:V(),name:n.fileName,url:l,status:"done",response:{status:"history",message:n.filePath}})}t.value=a}function Y(e){return d.value=!0,f.value&&e.type.indexOf("image")<0?(y.warning("\u8BF7\u4E0A\u4F20\u56FE\u7247"),d.value=!1,!1):typeof o.beforeUpload=="function"?o.beforeUpload(e):!0}function Z(){return o.removeConfirm?new Promise(e=>{E({title:"\u5220\u9664",content:`\u786E\u5B9A\u8981\u5220\u9664\u8FD9${f.value?"\u5F20\u56FE\u7247":"\u4E2A\u6587\u4EF6"}\u5417\uFF1F`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}):!0}function ee(e){!e.file.status&&d.value===!1&&e.fileList.pop();let a=e.fileList;if(o.maxCount>0&&a.length>=o.maxCount)if(o.maxCount-a.length>=0)a=a.slice(-o.maxCount);else return;if(e.file.status==="done"?e.file.response.success&&(a=a.map(n=>{if(n.response){let l=n.response.message;n.url=I(l)}return n})):e.file.status==="error"&&y.error(`${e.file.name} \u4E0A\u4F20\u5931\u8D25.`),t.value=a,e.file.status==="done"||e.file.status==="removed")if(o.returnUrl)te();else{let n=[];for(const l of a)if(l.status==="done"){let w={fileName:l.name,filePath:l.response.message,fileSize:l.size};n.push(w)}else return;L(n)}}function te(){let e=t.value,a="";(!e||e.length==0)&&(a="");let n=[];for(const l of e)if(l.status==="done")n.push(l.response.message);else return;n.length>0&&(a=n.join(",")),L(a)}function ne(e){f.value?he({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function L(e){u("change",e),u("update:value",e)}function V(){return"-"+parseInt(Math.random()*1e4+1,10)}function ae(e){if(e.lastIndexOf("\\")>=0){let a=new RegExp("\\\\","g");e=e.replace(a,"/")}return e.substring(e.lastIndexOf("/")+1)}return i({addActionsListener:b}),(e,a)=>{const n=q("a-button"),l=q("a-upload");return C(),_("div",{ref_key:"containerRef",ref:r,class:fe(`${m(p)}-container`)},[h(l,de({headers:U,multiple:s.multiple,action:m(ve),fileList:t.value,disabled:s.disabled},A.value,{onRemove:Z,onChange:ee,onPreview:ne}),{default:S(()=>[f.value?(C(),_(Q,{key:0},[g.value?J("",!0):(C(),_("div",Fe,[h(m(F),{icon:"ant-design:plus-outlined"}),v("div",ye,G(s.text),1)]))],64)):s.buttonVisible?(C(),pe(n,{key:1,disabled:g.value||s.disabled},{default:S(()=>[h(m(F),{icon:"ant-design:upload-outlined"}),v("span",null,G(s.text),1)]),_:1},8,["disabled"])):J("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{P as U,Ee as _};
