import{B as e}from"./index.934459b9.js";import"./BasicForm.5f094c03.js";import"./helper.7e5efd4b.js";import{l as a,F as t,a8 as n,bH as o,bI as s,f0 as i,t as l,v as r,V as u,z as c,y as d,C as f,W as m,u as p}from"./index.26a57b91.js";import{k as h}from"./JAddInput.a2bd8bfb.js";import{u as g}from"./useOnlineTest.697106d1.js";import{E as v,u as y}from"./EnhanceJsHistory.7dd248e3.js";import{s as b,g as j}from"./enhance.api.b7b7fa5d.js";import"./BasicModal.e5e1fb3e.js";import"./useWindowSizeFn.9ed8a10e.js";import"./uniqBy.006870c7.js";import"./useFormItem.efca0b58.js";import"./functional.c7818516.js";import"./download.4b98da42.js";import"./base64Conver.030fa32c.js";import"./index.608c7cf2.js";import"./index.b94b363f.js";import"./useCountdown.e60db803.js";import"./JUpload.7c63ef7b.js";import"./api.54a4ca84.js";import"./index.9c299300.js";import"./props.eaaadc91.js";import"./index.3e7bd500.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";import"./index.0d2a049f.js";import"./onMountedOrActivated.d719a17d.js";import"./index.6fce0e9a.js";import"./htmlmixed.fbaa0b47.js";import"./vue.38e13cef.js";/* empty css             */import"./depart.api.c295d6d2.js";var C=(e,a,t)=>new Promise(((n,o)=>{var s=e=>{try{l(t.next(e))}catch(a){o(a)}},i=e=>{try{l(t.throw(e))}catch(a){o(a)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,i);l((t=t.apply(e,a)).next())}));var J=i(a({name:"EnhanceJs",components:{BasicModal:e,JCodeEditor:h,EnhanceJsHistory:v},emits:["register"],setup(){const{createMessage:e}=p(),a=y(),i=t(),l=t(),r=n({form:{},list:{}}),u=t("list"),c=t(""),d=t(!1),f=t(!1),m=t(""),h=n({form:"",list:""}),v={form:!1,list:!1},J=t(!1),[E,{closeModal:x}]=o((e=>C(this,null,(function*(){!function(e){c.value=e.id,f.value=!1,m.value=e.tableName;let t=a.getEnhanceJs(c.value);(null==t?void 0:t.length)>0?(u.value=t[t.length-1].type,d.value=!0):d.value=!1;v.form=!1,v.list=!1,u.value?R(u.value):R("form");J.value=!0,setTimeout((()=>J.value=!1),150)}(e.row)})))),[T,k]=s(),{aiTestMode:M,genEnhanceJsData:w}=g();function H(e){return C(this,null,(function*(){let t=r[e],n={cgJs:h[e],cgJsType:e};if(!v[e]||t.cgJs===n.cgJs)return;let o=!!t.id;o&&(n=Object.assign({},t,n)),yield b(c.value,n,o),a.addEnhanceJs({code:c.value,str:n.cgJs,type:n.cgJsType,date:(new Date).getTime()})}))}function R(e){return C(this,null,(function*(){u.value=e;try{if(!v[e]){let a=yield j(c.value,e);Object.assign(r[e],{id:null},a),h[e]=r[e].cgJs,v[e]=!0}}catch(a){}setTimeout((()=>{"list"==e?l.value.refresh():i.value.refresh()}),150)}))}return{formEditorRef:i,listEditorRef:l,reloading:J,enhanceValues:h,enhanceType:u,showHistory:d,aiTestMode:M,tableName:m,genEnhanceJsData:w,onGenTestData:function(){"form"===u.value?w(m.value,u.value,i.value):w(m.value,u.value,l.value)},onChangeType:R,onCodeChange:function(e){h[u.value]!=e&&(f.value=!0,h[u.value]=e)},onShowHistory:function(){k.openModal(!0,{code:c.value,type:u.value})},onSubmit:function(){return C(this,null,(function*(){yield Promise.all([H("form"),H("list")]),x(),e.success("保存成功")}))},onCancel:function(){x()},registerModal:E,registerEnhanceJsHistory:T}}}),[["render",function(e,a,t,n,o,s){const i=l("JCodeEditor"),p=l("a-tab-pane"),h=l("a-tabs"),g=l("a-button"),v=l("a-space"),y=l("EnhanceJsHistory"),b=l("BasicModal");return r(),u(b,{onRegister:e.registerModal,title:"JS增强",width:800,bodyStyle:{height:"360px"}},{footer:c((()=>[d(v,null,{default:c((()=>[d(g,{onClick:e.onCancel},{default:c((()=>[f("关闭")])),_:1},8,["onClick"]),d(g,{type:"primary",onClick:e.onSubmit},{default:c((()=>[f("确定")])),_:1},8,["onClick"])])),_:1}),d(v,{style:{float:"left"}},{default:c((()=>[e.showHistory?(r(),u(g,{key:0,onClick:e.onShowHistory},{default:c((()=>[f("查看历史版本")])),_:1},8,["onClick"])):m("",!0),e.aiTestMode?(r(),u(g,{key:1,onClick:e.onGenTestData},{default:c((()=>[f("生成测试数据")])),_:1},8,["onClick"])):m("",!0)])),_:1})])),default:c((()=>[d(h,{activeKey:e.enhanceType,"onUpdate:activeKey":a[2]||(a[2]=a=>e.enhanceType=a),onChange:e.onChangeType},{default:c((()=>[d(p,{tab:"form",key:"form",forceRender:""},{default:c((()=>[e.reloading?m("",!0):(r(),u(i,{key:0,ref:"formEditorRef",value:e.enhanceValues.form,"onUpdate:value":a[0]||(a[0]=a=>e.enhanceValues.form=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1}),d(p,{tab:"list",key:"list",forceRender:""},{default:c((()=>[e.reloading?m("",!0):(r(),u(i,{key:0,ref:"listEditorRef",value:e.enhanceValues.list,"onUpdate:value":a[1]||(a[1]=a=>e.enhanceValues.list=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1})])),_:1},8,["activeKey","onChange"]),d(y,{onRegister:e.registerEnhanceJsHistory},null,8,["onRegister"])])),_:1},8,["onRegister"])}]]);export{J as default};
