var e=(e,t,a)=>new Promise(((l,n)=>{var i=e=>{try{r(a.next(e))}catch(t){n(t)}},o=e=>{try{r(a.throw(e))}catch(t){n(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,o);r((a=a.apply(e,t)).next())}));import"./index.934459b9.js";import{l as t,bj as a,F as l,bI as n,t as i,v as o,V as r,z as s,aW as u,y as d,W as c,x as p,D as f,ax as m,L as y,eh as v,C as h,Q as j,u as b,au as g}from"./index.26a57b91.js";import{q as k,A as x,d as _}from"./depart.api.c295d6d2.js";import{s as C}from"./depart.user.api.24442b65.js";import w from"./DepartFormModal.fe14caab.js";import"./BasicModal.e5e1fb3e.js";import"./useWindowSizeFn.9ed8a10e.js";import"./BasicForm.5f094c03.js";import"./helper.7e5efd4b.js";import"./useFormItem.efca0b58.js";import"./functional.c7818516.js";import"./download.4b98da42.js";import"./base64Conver.030fa32c.js";import"./index.608c7cf2.js";import"./index.b94b363f.js";import"./useCountdown.e60db803.js";import"./JAddInput.a2bd8bfb.js";import"./api.54a4ca84.js";import"./props.eaaadc91.js";import"./index.3e7bd500.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";import"./index.0d2a049f.js";import"./onMountedOrActivated.d719a17d.js";import"./index.6fce0e9a.js";import"./htmlmixed.fbaa0b47.js";import"./vue.38e13cef.js";/* empty css             */import"./JUpload.7c63ef7b.js";import"./index.9c299300.js";import"./uniqBy.006870c7.js";import"./useForm.18cf269c.js";import"./depart.data.ff6c9320.js";const I={class:"j-table-operator",style:{width:"100%"}},D=h("新增"),A=h("添加下级"),R=h("导入"),T=h("导出"),K=h("同步企微?"),U=h("同步钉钉?"),F=u("span",null,"删除",-1),M=u("span",null,"批量操作 ",-1),S={key:1},L=h("添加子级"),W=u("span",{style:{color:"red"}},"删除",-1),q=t({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(t,{expose:h,emit:q}){a("prefixCls");const{createMessage:B}=b(),{handleImportXls:E,handleExportXls:P}=g(),X=l(!1),z=l([]),J=l([]),V=l([]),N=l([]),O=l(!1),Q=l(!0),G=l(null),H=l(null),Y=l(""),[Z,{openModal:$}]=n();function ee(){return e(this,null,(function*(){try{X.value=!0,z.value=[];const e=yield k();if(Array.isArray(e)&&(z.value=e),0===V.value.length)ae();else if(0===N.value.length){let e=z.value[0];e&&le(e.id,e)}else q("select",G.value);q("rootTreeData",z.value)}finally{X.value=!1}}))}function te(t){return e(this,null,(function*(){try{const e=yield k({pid:t.dataRef.id});if(0==e.length)t.dataRef.isLeaf=!0;else if(t.dataRef.children=e,V.value.length>0){let t=[];for(let a of V.value)-1!==e.findIndex((e=>e.id===a))&&t.push(a);t.length>0&&(V.value=[...V.value])}z.value=[...z.value],q("rootTreeData",z.value)}catch(e){}return Promise.resolve()}))}function ae(){let t=z.value[0];t?(t.isLeaf||(V.value=[t.key]),le(t.id,t),function(){e(this,null,(function*(){yield j(),O.value=!0,yield j(),O.value=!1}))}()):q("select",null)}function le(e,t){N.value=[e],t&&(G.value=t,q("select",t))}function ne(){$(!0,{isUpdate:!1,isChild:!1})}function ie(e=G.value){if(null==e)return void B.warning("请先选择一个部门");const t={parentId:e.id};$(!0,{isUpdate:!1,isChild:!0,record:t})}function oe(t){return e(this,null,(function*(){if(t)try{X.value=!0,z.value=[];let e=yield C({keyWord:t});Array.isArray(e)&&(z.value=e),ae()}finally{X.value=!1}else ee();Y.value=t}))}function re(e){Array.isArray(e)?J.value=e:J.value=e.checked}function se(e,t){e.length>0&&N.value[0]!==e[0]?le(e[0],t.selectedNodes[0]):le(N.value[0])}function ue(t,a=!0){return e(this,null,(function*(){const e=y(t);if(e.length>0)try{X.value=!0,yield _({ids:e.join(",")},a),yield ee()}finally{X.value=!1}}))}function de(){return e(this,null,(function*(){try{yield ue(J),J.value=[]}finally{}}))}function ce(e){e||(H.value=null)}function pe(e){E(e,x.importExcelUrl,(()=>{ee()}))}function fe(){P("部门信息",x.exportXlsUrl)}return ee(),h({loadRootTreeData:ee}),(t,a)=>{const l=i("a-button"),n=i("a-upload"),h=i("icon"),j=i("a-menu-item"),b=i("a-menu"),g=i("a-dropdown"),k=i("a-divider"),x=i("a-alert"),_=i("a-input-search"),C=i("a-tree"),q=i("a-empty"),B=i("a-spin"),E=i("a-card");return o(),r(E,{bordered:!1,style:{height:"100%"}},{default:s((()=>[u("div",I,[d(l,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ne},{default:s((()=>[D])),_:1}),d(l,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:a[0]||(a[0]=e=>ie())},{default:s((()=>[A])),_:1}),d(n,{name:"file",showUploadList:!1,customRequest:pe},{default:s((()=>[d(l,{type:"primary",preIcon:"ant-design:import-outlined"},{default:s((()=>[R])),_:1})])),_:1}),d(l,{type:"primary",preIcon:"ant-design:export-outlined",onClick:fe},{default:s((()=>[T])),_:1}),d(l,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:s((()=>[K])),_:1}),d(l,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:s((()=>[U])),_:1}),J.value.length>0?(o(),r(g,{key:0},{overlay:s((()=>[d(b,null,{default:s((()=>[d(j,{key:"1",onClick:de},{default:s((()=>[d(h,{icon:"ant-design:delete-outlined"}),F])),_:1})])),_:1})])),default:s((()=>[d(l,null,{default:s((()=>[M,d(h,{icon:"akar-icons:chevron-down"})])),_:1})])),_:1})):c("",!0)]),d(x,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:s((()=>[J.value.length>0?(o(),p(m,{key:0},[u("span",null,"已选中 "+f(J.value.length)+" 条记录",1),d(k,{type:"vertical"}),u("a",{onClick:a[1]||(a[1]=e=>J.value=[])},"清空")],64)):(o(),p("span",S,"未选中任何数据"))])),_:1}),d(B,{spinning:X.value},{default:s((()=>[d(_,{placeholder:"按部门名称搜索…",style:{"margin-bottom":"10px"},onSearch:oe}),z.value.length>0?(o(),p(m,{key:0},[O.value?c("",!0):(o(),r(C,{key:0,checkable:"",clickRowToExpand:!1,treeData:z.value,selectedKeys:N.value,checkStrictly:Q.value,"load-data":te,checkedKeys:J.value,expandedKeys:V.value,"onUpdate:expandedKeys":a[3]||(a[3]=e=>V.value=e),onCheck:re,onSelect:se},{title:s((({key:t,title:l,dataRef:n})=>[d(g,{trigger:["contextmenu"]},{overlay:s((()=>[d(b,{onClick:a[2]||(a[2]=()=>{})},{default:s((()=>[d(j,{key:"1",onClick:e=>ie(n)},{default:s((()=>[L])),_:2},1032,["onClick"]),d(j,{key:"2",onClick:e=>H.value=t},{default:s((()=>[W])),_:2},1032,["onClick"])])),_:2},1024)])),default:s((()=>[d(y(v),{visible:H.value===t,title:"确定要删除吗？","ok-text":"确定","cancel-text":"取消",placement:"rightTop",onConfirm:t=>function(t){return e(this,null,(function*(){t&&(ce(!1),ue([t.id],!1))}))}(n),onVisibleChange:ce},{default:s((()=>[u("span",null,f(l),1)])),_:2},1032,["visible","onConfirm"])])),_:2},1024)])),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(o(),r(q,{key:1,description:"暂无数据"}))])),_:1},8,["spinning"]),d(w,{rootTreeData:z.value,onRegister:y(Z),onSuccess:ee},null,8,["rootTreeData","onRegister"])])),_:1})}}});export{q as default};
