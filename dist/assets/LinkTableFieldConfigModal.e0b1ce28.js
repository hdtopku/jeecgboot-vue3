import{B as E}from"./index.fa33ec21.js";import{B as L}from"./BasicForm.10d2bac8.js";import"./componentMap.bd60345c.js";import{u as A}from"./useForm.92846014.js";import"./JAddInput.2d4443c3.js";import{f6 as I,C as h,bH as D,r as B,s as R,Q as j,w as v,v as y,x as q,Z as H,u as N}from"./index.9d4ffdff.js";import{o as $}from"./omit.80ddddf5.js";import"./toString.e0eec860.js";import"./isArray.3186d40a.js";import"./_baseClone.d9404320.js";import"./_arrayPush.48fa8f83.js";import"./_flatRest.1893f573.js";import"./BasicModal.80fe5012.js";import"./useWindowSizeFn.722b7aaa.js";import"./BasicForm.vue_vue_type_style_index_0_lang.4e84674c.js";import"./uniqBy.144d64e1.js";import"./useFormItem.6cd3d92a.js";import"./functional.db9e0476.js";import"./download.70e251a6.js";import"./base64Conver.030fa32c.js";import"./index.fcb9611e.js";import"./index.4dc520b5.js";import"./useCountdown.11eac9c0.js";import"./JUpload.vue_vue_type_style_index_0_lang.3d564f34.js";import"./api.d12fe1c3.js";import"./index.28971d5a.js";import"./index.46008326.js";import"./areaDataUtil.d553b295.js";import"./props.b0f6852a.js";import"./index.0991c9be.js";import"./bem.393108ef.js";import"./props.2c136ce5.js";import"./useContextMenu.37312741.js";import"./index.94ebb6f8.js";import"./onMountedOrActivated.1516be09.js";import"./index.1cd463e1.js";import"./htmlmixed.e1e616a1.js";import"./vue.6aa3bd32.js";/* empty css             */import"./depart.api.57d85389.js";import"./MinusCircleOutlined.ffeee554.js";import"./_baseSlice.db64aae6.js";var J=Object.defineProperty,F=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,O=(i,o,t)=>o in i?J(i,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[o]=t,Q=(i,o)=>{for(var t in o||(o={}))K.call(o,t)&&O(i,t,o[t]);if(F)for(var t of F(o))G.call(o,t)&&O(i,t,o[t]);return i},m=(i,o,t)=>new Promise((n,a)=>{var s=r=>{try{p(t.next(r))}catch(d){a(d)}},u=r=>{try{p(t.throw(r))}catch(d){a(d)}},p=r=>r.done?n(r.value):Promise.resolve(r.value).then(s,u);p((t=t.apply(i,o)).next())});const Z={name:"LinkTableFieldConfigModal",emits:["success","register"],components:{BasicModal:E,BasicForm:L},setup(i,{emit:o}){const t=h(!1),n=h([]),a=h([]);let s={},u={};const{createMessage:p}=N(),[r,{closeModal:d}]=D(e=>m(this,null,function*(){console.log("data",e),u=Q({},e.record),s=e.tableAndFieldsMap,yield C(),yield _({dictTable:e.record.dictTable}),setTimeout(()=>m(this,null,function*(){let l=$(e.record,"dictTable");yield _(l),yield P()}),200)}));function C(){return m(this,null,function*(){let e=Object.keys(s);if(!e||e.length==0)n.value=[];else{let l=[];for(let c of e)l.push({text:s[c].title,value:c});n.value=l}})}function w(e){return m(this,null,function*(){if(e){const{table:l,fields:c}=s[e];if(!l){p.warning("\u8BF7\u5148\u5B8C\u5584\u5B57\u6BB5["+e+"]\u5173\u8054\u8BB0\u5F55\u7684\u914D\u7F6E");return}const S="/online/cgform/field/listByHeadCode",g=yield H.get({url:S,params:{headCode:l}});if(g&&g.length>0){let b=g.map(f=>({text:f.dbFieldTxt,value:f.dbFieldName}));console.log("\u5B57\u6BB5\u5B57\u5178",b);let V=c.split(",");a.value=b.filter(f=>V.indexOf(f.value)>0)}else a.value=[]}})}const T=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"\u5B57\u6BB5\u63CF\u8FF0",field:"dbFieldTxt",component:"Input",required:!0},{label:"\u5173\u8054\u8BB0\u5F55",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({async:!1,popContainer:".link-table-field-config-modal",dictOptions:n.value,immediateChange:!0,onChange:c=>m(this,null,function*(){u.dictText&&(yield e.setFieldsValue({dictText:""}),yield e.clearValidate()),w(c)})})},{label:"\u663E\u793A\u5B57\u6BB5",field:"dictText",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-field-config-modal",dictOptions:a,onChange:e=>{u.dictText=e}}}],[x,{validate:M,setFieldsValue:_,clearValidate:P}]=A({schemas:T,showActionButtonGroup:!1,labelAlign:"right"});function k(){return m(this,null,function*(){const e=yield M();console.log("handlesub",e),o("success",e),d()})}return{registerModal:r,spinningLoading:t,registerForm:x,handleSubmit:k}}};function z(i,o,t,n,a,s){const u=B("BasicForm"),p=B("a-spin"),r=B("BasicModal");return R(),j(r,q({wrapClassName:"link-table-field-config-modal"},i.$attrs,{title:"\u4ED6\u8868\u5B57\u6BB5\u914D\u7F6E",onRegister:n.registerModal,keyboard:"",canFullscreen:!1,cancelText:"\u5173\u95ED",onOk:n.handleSubmit}),{default:v(()=>[y(p,{spinning:n.spinningLoading},{default:v(()=>[y(u,{onRegister:n.registerForm},null,8,["onRegister"])]),_:1},8,["spinning"])]),_:1},16,["onRegister","onOk"])}var Re=I(Z,[["render",z]]);export{Re as default};
