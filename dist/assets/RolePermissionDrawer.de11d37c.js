var D=(g,y,s)=>new Promise((d,u)=>{var m=o=>{try{r(s.next(o))}catch(n){u(n)}},i=o=>{try{r(s.throw(o))}catch(n){u(n)}},r=o=>o.done?d(o.value):Promise.resolve(o.value).then(m,i);r((s=s.apply(g,y)).next())});import{a as $,u as q,B as L}from"./index.022ba35d.js";import{_ as N}from"./index.92474250.js";import{q as V,l as j,F as l,L as t,t as R,v as x,V as F,z as c,y as f,bC as A,C as _,D as z,W as O,B as W}from"./index.f142ecf1.js";import G from"./RoleDataRuleDrawer.1fe821d9.js";import{q as H,c as J,e as M}from"./role.api.fcf41af0.js";import"./bem.8c66d464.js";import"./props.c3db534b.js";import"./useContextMenu.f6b556fa.js";const Q=_("\u53D6\u6D88"),U=_("\u4EC5\u4FDD\u5B58"),X=_("\u4FDD\u5B58\u5E76\u5173\u95ED"),Y=j({__name:"RolePermissionDrawer",emits:["register"],setup(g,{emit:y}){const s=l([]),d=l([]),u=l([]),m=l([]),i=l([]),r=l(""),o=l(null),n=l(!1),[I,{openDrawer:K}]=$(),[B,{setDrawerProps:w,closeDrawer:h}]=q(e=>D(this,null,function*(){yield T(),w({confirmLoading:!1,loading:!0}),r.value=e.roleId;const a=yield H();s.value=a.treeList,d.value=a.ids;const p=yield J({roleId:t(r)});u.value=p,m.value=p,w({loading:!1})}));function E(e){u.value=e.checked?e.checked:e}function P(e){e&&e.length>0&&(i.value=e),K(!0,{functionId:t(i)[0],roleId:t(r)})}function T(){s.value=[],d.value=[],u.value=[],m.value=[],i.value=[],r.value=""}function b(){const e=t(o);if(!e)throw new Error("tree is null!");return e}function k(e){return D(this,null,function*(){let a={roleId:t(r),permissionIds:t(b().getCheckedKeys()).join(","),lastpermissionIds:t(m).join(",")};n.value=!0,yield M(a),n.value=!1,e&&h()})}return(e,a)=>{const p=R("Icon"),C=R("a-button");return x(),F(t(L),W(e.$attrs,{onRegister:t(B),title:"\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:"650px",destroyOnClose:"",showFooter:""}),{footer:c(()=>[f(t(A),{title:"\u786E\u5B9A\u653E\u5F03\u7F16\u8F91\uFF1F",onConfirm:t(h),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:c(()=>[Q]),_:1},8,["onConfirm"]),f(C,{onClick:a[0]||(a[0]=v=>k(!1)),type:"primary",loading:n.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:c(()=>[U]),_:1},8,["loading"]),f(C,{onClick:a[1]||(a[1]=v=>k(!0)),type:"primary",loading:n.value},{default:c(()=>[X]),_:1},8,["loading"])]),default:c(()=>[f(t(N),{ref_key:"treeRef",ref:o,checkable:"",toolbar:"",treeData:s.value,checkedKeys:u.value,expandedKeys:d.value,selectedKeys:i.value,checkStrictly:!0,clickRowToExpand:!1,title:"\u6240\u62E5\u6709\u7684\u7684\u6743\u9650",onCheck:E,onSelect:P},{title:c(({slotTitle:v,ruleFlag:S})=>[_(z(v)+" ",1),S?(x(),F(p,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):O("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys"]),f(G,{onRegister:t(I)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});var ue=V(Y,[["__scopeId","data-v-5ab79653"]]);export{ue as default};
