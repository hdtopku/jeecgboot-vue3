var E=Object.defineProperty;var C=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var v=(e,o,t)=>o in e?E(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,B=(e,o)=>{for(var t in o||(o={}))I.call(o,t)&&v(e,t,o[t]);if(C)for(var t of C(o))T.call(o,t)&&v(e,t,o[t]);return e};var x=(e,o,t)=>new Promise((i,l)=>{var m=n=>{try{d(t.next(n))}catch(p){l(p)}},f=n=>{try{d(t.throw(n))}catch(p){l(p)}},d=n=>n.done?i(n.value):Promise.resolve(n.value).then(m,f);d((t=t.apply(e,o)).next())});import{B as U}from"./index.a72c51e6.js";import{B as _}from"./BasicForm.5950e505.js";import"./componentMap.d3e1f736.js";import{u as k}from"./useForm.ee4b0bb8.js";import"./JAddInput.9b38307a.js";import{Z as u,a2 as L,j as S,C as g,bH as A,m as M,H as a,s as R,Q as H,w as O,v as j,x as K}from"./index.2bb6f736.js";const W=[{title:"\u5206\u7C7B\u540D\u79F0",dataIndex:"name",width:350,align:"left"},{title:"\u5206\u7C7B\u7F16\u7801",dataIndex:"code"}],Y=[{label:"\u540D\u79F0",field:"name",component:"Input",colProps:{span:6}},{label:"\u7F16\u7801",field:"code",component:"Input",colProps:{span:6}}],V=[{label:"",field:"id",component:"Input",show:!1},{label:"\u7236\u7EA7\u8282\u70B9",field:"pid",component:"TreeSelect",componentProps:{replaceFields:{value:"key"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:()=>document.body},show:({values:e})=>e.pid!=="0",dynamicDisabled:({values:e})=>!!e.id},{label:"\u5206\u7C7B\u540D\u79F0",field:"name",required:!0,component:"Input"}],ee="/sys/category/exportXls",te="/sys/category/importExcel",se=e=>u.get({url:"/sys/category/rootList",params:e}),oe=(e,o)=>u.delete({url:"/sys/category/delete",params:e},{joinParamsToUrl:!0}).then(()=>{o()}),ae=(e,o)=>{L.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>u.delete({url:"/sys/category/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{o()})})},q=(e,o)=>{let t=o?"/sys/category/edit":"/sys/category/add";return u.post({url:t,params:e})},G=e=>u.get({url:"/sys/category/loadTreeRoot",params:e}),ne=e=>u.get({url:"/sys/category/childList",params:e}),re=e=>u.get({url:"/sys/category/getChildListBatch",params:e},{isTransformResponse:!1}),le=S({__name:"CategoryModal",emits:["register","success"],setup(e,{emit:o}){const t=g(!0),i=g([]),l=g([]),m=g(!1),[f,{resetFields:d,setFieldsValue:n,validate:p,updateSchema:w}]=k({schemas:V,showActionButtonGroup:!1,labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[F,{setModalProps:y,closeModal:b}]=A(s=>x(this,null,function*(){yield d(),i.value=[],y({confirmLoading:!1,minHeight:80}),t.value=!!(s!=null&&s.isUpdate),m.value=!(s!=null&&s.isUpdate)&&s.record.id,s!=null&&s.record&&(yield n(B({},s.record))),l.value=yield G({async:!1,pcode:""}),w({field:"pid",componentProps:{treeData:l}})})),D=M(()=>a(t)?"\u7F16\u8F91\u5B57\u5178":"\u65B0\u589E\u5B57\u5178");function h(s,r){if(s&&r&&r.length>0)for(let c=0;c<r.length;c++)r[c].key==s&&a(i).indexOf(s)<0?(i.value.push(r[c].key),h(r[c].parentId,a(l))):h(s,r[c].children)}function P(){return x(this,null,function*(){try{let s=yield p();y({confirmLoading:!0}),yield q(s,t.value),b(),yield h(s.pid,a(l)),o("success",{isUpdate:a(t),isSubAdd:a(m),values:B({},s),expandedArr:a(i).reverse()})}finally{y({confirmLoading:!1})}})}return(s,r)=>(R(),H(a(U),K(s.$attrs,{onRegister:a(F),destroyOnClose:"",title:D.value,onOk:P}),{default:O(()=>[j(a(_),{onRegister:a(f)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{le as _,te as a,ae as b,W as c,re as d,ne as e,oe as f,ee as g,se as l,Y as s};
