var L=(h,x,E)=>new Promise((I,R)=>{var A=c=>{try{d(E.next(c))}catch(C){R(C)}},B=c=>{try{d(E.throw(c))}catch(C){R(C)}},d=c=>c.done?I(c.value):Promise.resolve(c.value).then(A,B);d((E=E.apply(h,x)).next())});import{a1 as M,l as Ce,a7 as U,dP as De,F as D,L as u,o as be,t as m,v as s,V as b,z as l,y as a,x as p,bb as F,aw as _,C as y,D as w,dG as T,aV as O,c8 as ee,cl as Fe,W as V,dl as K,aI as we,B as Ee,Q as te}from"./index.23784a6b.js";import{u as Re,B as Ve}from"./index.69ca9e44.js";const Ne=h=>M.get({url:"/sys/gatewayRoute/list",params:h}),xe=h=>M.post({url:"/sys/gatewayRoute/updateAll",params:h}),je=(h,x)=>M.delete({url:"/sys/gatewayRoute/delete",data:h},{joinParamsToUrl:!0}).then(()=>{x()}),Ae={key:0},Be={key:1},Ue={key:2},Oe={key:3},Ie={class:"btn",style:{"padding-top":"10px"}},$e=y(" \u6DFB\u52A0\u8DEF\u7531\u6761\u4EF6 "),ze=y(" \u6DFB\u52A0\u53C2\u6570 "),Pe={class:"btn",style:{"padding-top":"10px"}},He=y(" \u6DFB\u52A0\u8FC7\u6EE4\u5668 "),Le=Ce({__name:"RouteModal",emits:["register","success"],setup(h,{emit:x}){const E=U({xs:{span:24},sm:{span:5}}),I=U({xs:{span:24},sm:{span:16}});De();const R=D(!0),A=D(),B=D();let d=U({inputVisible:!1,inputValue:""});const c=D(0),C=D(-1),ae={routerId:[{required:!0,message:"routerId\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],name:[{required:!0,message:"\u8DEF\u7531\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],uri:[{required:!0,message:"uri\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},N=["Path","Host","Method","After","Before","Between","RemoteAddr"],$=[{key:1,name:"\u9650\u6D41\u8FC7\u6EE4\u5668"}],ue=D([{name:"Path",args:[]},{name:"Header",args:{header:"",regexp:""}},{name:"Query",args:{param:"",regexp:""}},{name:"Method",args:[]},{name:"Host",args:[]},{name:"Cookie",args:{name:"",regexp:""}},{name:"After",args:[]},{name:"Before",args:[]},{name:"Between",args:[]},{name:"RemoteAddr",args:[]}]),j=D();let r=U({});const[ne,{setDrawerProps:z,closeDrawer:le}]=Re(e=>L(this,null,function*(){R.value=!!(e!=null&&e.isUpdate),z({confirmLoading:!1}),oe(),u(R)&&(r=Object.assign(r,e.record))})),re=be(()=>u(R)?"\u7F16\u8F91\u8DEF\u7531":"\u65B0\u589E\u8DEF\u7531");function se(e,n){let i=e.args.filter(g=>g!==n);e.args=i}function oe(){r=Object.assign(r,{id:"",routerId:"",name:"",uri:"",status:1,predicates:[],filters:[]})}function ie(e){r.predicates.push({args:e.args,name:e.name})}function de(e,n,i){n[i]=e.target.value}function pe(e,n,i,g){c.value=g,C.value=i,d.inputValue=n,te(()=>{B.value.focus()})}function ce(e,n){d.inputValue="",d.inputVisible=!0,c.value=n,te(()=>{A.value.focus()})}function S(e){console.info("change",e),console.info("change",e.target.value)}function q(e,n){e.predicates.splice(n,1)}function fe(e,n){e.args.splice(n,1)}function me(e,n){e.filters.splice(n,1)}function ge(e){e.args.push({key:"key"+e.args.length+1,value:""})}function ve(e){e.key==0&&r.filters.push({args:[{key:"name",value:"default"},{key:"fallbackUri",value:"forward:/fallback"}],name:"Hystrix",title:$[0].name}),console.info("test",r),e.key==1&&r.filters.push({args:[{key:"key-resolver",value:"#{@ipKeyResolver}"},{key:"redis-rate-limiter.replenishRate",value:20},{key:"redis-rate-limiter.burstCapacity",value:20}],name:"RequestRateLimiter",title:$[0].name})}function J(e){let n=e.args;const i=d.inputValue;i&&n.indexOf(i)===-1&&(e.args=[...n,d.inputValue]),d.inputVisible=!1,d.inputValue="",C.value=-1,c.value=-1}function Q(e,n,i){d.inputValue&&(e.args[i]=d.inputValue),C.value=-1,c.value=-1}function _e(){return L(this,null,function*(){yield j.value.validate().then(()=>{try{z({confirmLoading:!0});let e=Object.assign({},r,{predicates:JSON.stringify(r.predicates),filters:JSON.stringify(r.filters)});xe({router:e}).then(()=>{le(),x("success")})}finally{z({confirmLoading:!1})}})})}return(e,n)=>{const i=m("a-input"),g=m("a-form-item"),ye=m("a-switch"),P=m("a-divider"),G=m("a-tag"),W=m("a-col"),ke=m("a-row"),X=m("a-menu-item"),Y=m("a-menu"),H=m("a-button"),Z=m("a-dropdown"),he=m("a-form");return s(),b(u(Ve),Ee(e.$attrs,{onRegister:u(ne),title:u(re),width:"30%",onOk:_e,destroyOnClose:"",showFooter:""}),{default:l(()=>[a(he,{ref_key:"formRef",ref:j,"label-col":E,"wrapper-col":I,model:u(r),rules:ae},{default:l(()=>[a(g,{label:"\u8DEF\u7531ID",name:"routerId"},{default:l(()=>[a(i,{value:u(r).routerId,"onUpdate:value":n[0]||(n[0]=t=>u(r).routerId=t),placeholder:"\u8DEF\u7531\u552F\u4E00ID"},null,8,["value"])]),_:1}),a(g,{label:"\u8DEF\u7531\u540D\u79F0",name:"name"},{default:l(()=>[a(i,{value:u(r).name,"onUpdate:value":n[1]||(n[1]=t=>u(r).name=t),placeholder:"\u8DEF\u7531\u540D\u79F0"},null,8,["value"])]),_:1}),a(g,{label:"\u8DEF\u7531URI",name:"uri"},{default:l(()=>[a(i,{value:u(r).uri,"onUpdate:value":n[2]||(n[2]=t=>u(r).uri=t),placeholder:"\u8DEF\u7531URL"},null,8,["value"])]),_:1}),a(g,{label:"\u8DEF\u7531\u72B6\u6001",name:"status"},{default:l(()=>[a(ye,{"default-checked":"","checked-value":1,"un-checked-value":0,checked:u(r).status,"onUpdate:checked":n[3]||(n[3]=t=>u(r).status=t)},null,8,["checked"])]),_:1}),a(g,{name:"predicates",label:"\u8DEF\u7531\u6761\u4EF6"},{default:l(()=>[(s(!0),p(_,null,F(u(r).predicates,(t,k)=>(s(),p("div",null,[N.includes(t.name)?(s(),p(_,{key:0},[a(P,null,{default:l(()=>[y(w(t.name)+" ",1),a(u(T),{size:"22",onClick:o=>q(u(r),k)},null,8,["onClick"])]),_:2},1024),O("div",null,[(s(!0),p(_,null,F(t.args,(o,f)=>(s(),p(_,null,[f==C.value&&k==c.value?(s(),b(i,{key:0,ref_for:!0,ref_key:"inputRef2",ref:B,type:"text",size:"small",style:{width:"190px"},value:u(d).inputValue,"onUpdate:value":n[4]||(n[4]=v=>u(d).inputValue=v),onChange:S,onBlur:v=>Q(t,o,f),onKeyup:ee(v=>Q(t,o,f),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),b(G,{key:o,style:{"margin-bottom":"2px"},closable:!0,onClose:()=>se(t,o),onClick:v=>pe(t,o,f,k)},{default:l(()=>[y(w(o),1)]),_:2},1032,["onClose","onClick"]))],64))),256)),u(d).inputVisible&&k==c.value?(s(),b(i,{key:0,ref_for:!0,ref_key:"inputRef",ref:A,type:"text",size:"small",style:{width:"100px"},value:u(d).inputValue,"onUpdate:value":n[5]||(n[5]=o=>u(d).inputValue=o),onChange:S,onBlur:o=>J(t),onKeyup:ee(o=>J(t),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),b(G,{key:1,style:{background:"#fff",borderstyle:"dashed","margin-bottom":"2px"},onClick:o=>ce(t,k)},{default:l(()=>[a(u(Fe),{size:"22"}),y(" \u65B0\u5EFA"+w(t.name),1)]),_:2},1032,["onClick"]))])],64)):V("",!0),N.includes(t.name)?V("",!0):(s(),p(_,{key:1},[a(P,null,{default:l(()=>[y(w(t.name)+" ",1),a(u(T),{size:"22",onClick:o=>q(u(r),k)},null,8,["onClick"])]),_:2},1024),O("div",null,[(s(!0),p(_,null,F(t.args,(o,f)=>(s(),b(ke,null,{default:l(()=>[a(W,{span:5,style:{"margin-top":"8px"}},{default:l(()=>[f=="header"?(s(),p("span",Ae,"Header\u540D\u79F0")):V("",!0),f=="regexp"?(s(),p("span",Be,"\u53C2\u6570\u503C")):V("",!0),f=="param"?(s(),p("span",Ue,"\u53C2\u6570\u540D")):V("",!0),f=="name"?(s(),p("span",Oe,"\u53C2\u6570\u540D")):V("",!0)]),_:2},1024),a(W,{span:18},{default:l(()=>[a(i,{defaultValue:o,placeholder:"\u53C2\u6570\u503C",style:{width:"70%","margin-right":"8px","margin-top":"3px"},onChange:v=>de(v,t.args,f)},null,8,["defaultValue","onChange"])]),_:2},1024)]),_:2},1024))),256))])],64))]))),256)),O("p",Ie,[a(Z,null,{overlay:l(()=>[a(Y,null,{default:l(()=>[(s(!0),p(_,null,F(ue.value,t=>(s(),b(X,{key:t.name,onClick:k=>ie(t)},{default:l(()=>[y(w(t.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:l(()=>[a(H,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:l(()=>[$e,a(u(K),{size:22})]),_:1})]),_:1})])]),_:1}),a(g,{name:"predicates",label:"\u8FC7\u6EE4\u5668"},{default:l(()=>[(s(!0),p(_,null,F(u(r).filters,(t,k)=>(s(),p("div",null,[a(P,null,{default:l(()=>[y(w(t.name)+" ",1),a(u(T),{size:"22",onClick:o=>me(u(r),k)},null,8,["onClick"])]),_:2},1024),(s(!0),p(_,null,F(t.args,(o,f)=>(s(),p("div",{key:o.key},[a(i,{value:o.key,"onUpdate:value":v=>o.key=v,placeholder:"\u53C2\u6570\u952E",style:{width:"45%","margin-right":"8px"}},null,8,["value","onUpdate:value"]),a(i,{value:o.value,"onUpdate:value":v=>o.value=v,placeholder:"\u53C2\u6570\u503C",style:{width:"40%","margin-right":"8px","margin-top":"3px"}},null,8,["value","onUpdate:value"]),a(u(we),{size:22,onClick:v=>fe(t,f)},null,8,["onClick"])]))),128)),a(H,{type:"dashed",style:{"margin-left":"28%",width:"37%","margin-top":"5px"},size:"small",onClick:o=>ge(t)},{default:l(()=>[a(u(K),{size:22}),ze]),_:2},1032,["onClick"])]))),256)),O("p",Pe,[a(Z,null,{overlay:l(()=>[a(Y,{onClick:ve},{default:l(()=>[(s(),p(_,null,F($,t=>a(X,{key:t.key,name:t.name},{default:l(()=>[y(w(t.name),1)]),_:2},1032,["name"])),64))]),_:1})]),default:l(()=>[a(H,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:l(()=>[He,a(u(K))]),_:1})]),_:1})])]),_:1})]),_:1},8,["label-col","wrapper-col","model"])]),_:1},16,["onRegister","title"])}}});var Se=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Se as R,Le as _,je as d,Ne as g};
