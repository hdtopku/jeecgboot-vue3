var e=Object.defineProperty,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(s,n,r)=>n in s?e(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;import{s as i,m as a,d7 as t,F as l,a1 as u,L as d,d8 as c,u as h}from"./index.b3c93d64.js";function g(){const{createMessage:e,notification:g}=h(),{t:f}=i(),p=a(),m=t(),v=l(""),b=l({}),w=l(!1),y=l(!1),L=l(""),P=l(!1),O=l(!1),j=l(""),T=l(""),C=l(!1),U=l(""),I=l("");function S(e){!1===d(w)&&(w.value=!0,m.ThirdLogin({token:e,thirdType:d(v)}).then((e=>{var s;e&&e.userInfo?g.success({message:f("sys.login.loginSuccessTitle"),description:`${f("sys.login.loginSuccessDesc")}: ${e.userInfo.realname}`,duration:3}):(s=e,g.error({message:"登录失败",description:((s.response||{}).data||{}).message||s.message||"请求出现错误，请稍后再试",duration:4}))})))}function $(){O.value=!1,j.value="",T.value=""}function k(e){g.error({message:"登录失败",description:e,duration:4})}return{thirdPasswordShow:O,thirdLoginCheckPassword:function(){let s=Object.assign({},d(b),{password:d(j)});u.post({url:"/sys/third/user/checkPassword",params:s},{isTransformResponse:!1}).then((s=>{s.success?($(),S(s.result)):e.warning(s.message)}))},thirdLoginNoPassword:$,thirdLoginPassword:j,thirdConfirmShow:P,thirdCreateUserLoding:C,thirdLoginUserCreate:function(){C.value=!0,b.value.suffix=parseInt(98*Math.random()+1),u.post({url:"/sys/third/user/create",params:{thirdLoginInfo:d(b)}},{isTransformResponse:!1}).then((s=>{if(s.success){S(s.result),P.value=!1}else e.warning(s.message)})).finally((()=>{C.value=!1}))},thirdLoginUserBind:function(){j.value="",T.value=b.value.uuid,P.value=!1,O.value=!0},bindingPhoneModal:y,thirdHandleOk:function(){d(U)||k("请输入手机号"),d(I)||k("请输入验证码");let s={mobile:d(U),captcha:d(I),thirdUserUuid:d(L)};u.post({url:"/sys/thirdLogin/bindingThirdPhone",params:s},{isTransformResponse:!1}).then((s=>{s.success?(y.value=!1,S(s.result)):e.warning(s.message)}))},thirdPhone:U,thirdCaptcha:I,onThirdLogin:function(i){let a=`${p.uploadUrl}/sys/thirdLogin/render/${i}`;window.open(a,`login ${i}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),v.value=i,b.value={},w.value=!1,window.addEventListener("message",(function(i){let a=i.data;if("string"==typeof a)if("登录失败"===a)e.warning(a);else if(a.includes("绑定手机号")){y.value=!0;let e=a.split(",");L.value=e[1]}else S(a);else"object"==typeof a?!0===a.isObj&&(P.value=!0,b.value=((e,i)=>{for(var a in i||(i={}))n.call(i,a)&&o(e,a,i[a]);if(s)for(var a of s(i))r.call(i,a)&&o(e,a,i[a]);return e})({},a)):e.warning("不识别的信息传递")}),!1)},sendCodeApi:function(){return c({mobile:d(U),smsmode:"0"})}}}export{g as useThirdLogin};
