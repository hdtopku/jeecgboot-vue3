import{B as R}from"./index.c1c509d9.js";import{l as q,bF as z,m as N,bw as J,F as c,L as n,a9 as O,o as K,q as W,a1 as j,t as m,v as k,x as E,y as u,z as d,C as F,D as x,aU as w,W as G,B as H,u as P}from"./index.6c1aeca2.js";const X=q({name:"JImportModal",components:{BasicModal:R},props:{url:{type:String,default:"",required:!1},biz:{type:String,default:"",required:!1},online:{type:Boolean,default:!1,required:!1}},emits:["ok","register"],setup(e,{emit:b,refs:D}){const{createMessage:g,createWarningModal:B}=P(),[_,{closeModal:h}]=z(a=>{v(a)}),l=N(),C=J(),i=c(!1),o=c([]),M=c(""),p=c(""),f=c(0),S=Object.assign({},n(e),n(C));O(()=>{e.url&&(M.value=`${l.uploadUrl}${e.url}`)});const L=K(()=>!(n(o).length>0));function y(){h()&&v()}function $(a){f.value=a?1:0}function I(a){const r=n(o).indexOf(a),t=n(o).slice();t.splice(r,1),o.value=t}function U(a){return o.value=[...n(o),a],!1}function V(){let{biz:a,online:r}=e;const t=new FormData;a&&t.append("isSingleTableImport",a),n(p)&&n(p).length>0&&t.append("foreignKeys",n(p)),r&&t.append("validateStatus",n(f)),n(o).forEach(s=>{t.append("files[]",s)}),i.value=!0;let A={"Content-Type":"multipart/form-data;boundary = "+new Date().getTime()};j.post({url:e.url,params:t,headers:A},{isTransformResponse:!1}).then(s=>{i.value=!1,s.success?(s.code==201?T(s.message,s.result):g.success(s.message),y(),v(),b("ok")):g.warning(s.message)})}function T(a,r){let t=l.uploadUrl+r;B({title:"\u5BFC\u5165\u6210\u529F,\u4F46\u662F\u6709\u9519\u8BEF\u6570\u636E!",centered:!1,content:`<div>
                        <span>${a}</span><br/>
                        <span>\u5177\u4F53\u8BE6\u60C5\u8BF7<a href = ${t} target="_blank"> \u70B9\u51FB\u4E0B\u8F7D </a> </span>
                      </div>`})}function v(a){o.value=[],i.value=!1,p.value=a,f.value=0}return{register:_,getBindValue:S,uploadDisabled:L,fileList:o,uploading:i,validateStatus:f,handleClose:y,handleChangeValidateStatus:$,handleRemove:I,beforeUpload:U,handleImport:V}}}),Q={key:0,style:{margin:"0 5px 1px"}},Y=w("span",{style:{display:"inline-block",height:"32px","line-height":"32px","vertical-align":"middle"}},"\u662F\u5426\u5F00\u542F\u6821\u9A8C:",-1),Z={style:{"margin-left":"6px"}},ee=F("\u9009\u62E9\u5BFC\u5165\u6587\u4EF6"),ae=F("\u5173\u95ED");function ne(e,b,D,g,B,_){const h=m("a-switch"),l=m("a-button"),C=m("a-upload"),i=m("BasicModal");return k(),E("div",null,[u(i,H(e.$attrs,{onRegister:e.register,title:"\u5BFC\u5165EXCEL",width:600,onCancel:e.handleClose,confirmLoading:e.uploading,destroyOnClose:""}),{footer:d(()=>[u(l,{onClick:e.handleClose},{default:d(()=>[ae]),_:1},8,["onClick"]),u(l,{type:"primary",onClick:e.handleImport,disabled:e.uploadDisabled,loading:e.uploading},{default:d(()=>[F(x(e.uploading?"\u4E0A\u4F20\u4E2D...":"\u5F00\u59CB\u4E0A\u4F20"),1)]),_:1},8,["onClick","disabled","loading"])]),default:d(()=>[e.online?(k(),E("div",Q,[Y,w("span",Z,[u(h,{checked:e.validateStatus==1,onChange:e.handleChangeValidateStatus,"checked-children":"\u662F","un-checked-children":"\u5426",size:"small"},null,8,["checked","onChange"])])])):G("",!0),u(C,{name:"file",accept:".xls,.xlsx",multiple:!0,fileList:e.fileList,remove:e.handleRemove,beforeUpload:e.beforeUpload},{default:d(()=>[u(l,{preIcon:"ant-design:upload-outlined"},{default:d(()=>[ee]),_:1})]),_:1},8,["fileList","remove","beforeUpload"])]),_:1},16,["onRegister","onCancel","confirmLoading"])])}var se=W(X,[["render",ne]]);export{se as J};
