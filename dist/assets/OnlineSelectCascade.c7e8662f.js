import{l as D,F as y,H as C,a1 as F,eY as O,u as $,t as v,v as p,x as _,C as w,y as T,z as E,aw as S,bb as N,V,aV as k,D as P}from"./index.b3d2a891.js";var A=(t,u,i)=>new Promise((d,a)=>{var g=l=>{try{c(i.next(l))}catch(s){a(s)}},f=l=>{try{c(i.throw(l))}catch(s){a(s)}},c=l=>l.done?d(l.value):Promise.resolve(l.value).then(g,f);c((i=i.apply(t,u)).next())});const x="/online/cgform/api/querySelectOptions",L=D({name:"OnlineSelectCascade",props:{table:{type:String,default:""},txt:{type:String,default:""},store:{type:String,default:""},idField:{type:String,default:""},pidField:{type:String,default:""},pidValue:{type:String,default:"-1"},origin:{type:Boolean,default:!1},condition:{type:String,default:""},value:{type:String,default:""},isNumber:{type:Boolean,default:!1},placeholder:{type:String,default:"\u8BF7\u9009\u62E91"}},emits:["change","next"],setup(t,{emit:u}){const{createMessage:i}=$(),d=y(""),a=y([]),g=y(!0);function f(e){console.log("handleChange",e);let n=e||"";u("change",n),h(n)}C(()=>t.condition,e=>{g.value=!0,e&&l()},{immediate:!0}),C(()=>t.pidValue,e=>{e==="-1"?a.value=[]:l()}),C(()=>t.value,(e,n)=>{console.log("\u503C\u6539\u53D8\u4E8B\u4EF6",e,n),e?d.value=e:(d.value=[],n&&(u("change",""),u("next","-1"))),e&&!n&&c(e)},{immediate:!0});function c(e){return A(this,null,function*(){if(t.idField===t.store)u("next",e);else if(t.origin===!0)yield b(),h(e);else{let n=yield B();h(e,n)}})}function l(){let e=s();t.origin===!0?e.condition=t.condition:e.pidValue=t.pidValue,console.log("\u8BF7\u6C42\u53C2\u6570",e),a.value=[],F.get({url:x,params:e},{isTransformResponse:!1}).then(n=>{n.success?(a.value=[...n.result],console.log("\u8BF7\u6C42\u7ED3\u679C",n.result,a)):i.warning("\u8054\u52A8\u7EC4\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25,\u8BF7\u68C0\u67E5\u914D\u7F6E!")})}function s(){return{table:t.table,txt:t.txt,key:t.store,idField:t.idField,pidField:t.pidField}}function B(){return new Promise(e=>{if(!t.value)d.value=[],e([]);else{let n=s();t.isNumber===!0?n.condition=`${t.store} = ${t.value}`:n.condition=`${t.store} = '${t.value}'`,F.get({url:x,params:n},{isTransformResponse:!1}).then(o=>{o.success?e(o.result):(i.warning("\u8054\u52A8\u7EC4\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25,\u8BF7\u68C0\u67E5\u914D\u7F6E!"),e([]))})}})}function b(){return new Promise(e=>{(function o(r){r>10&&e([]);let m=a.value;m&&m.length>0?e(m):setTimeout(()=>{o(r++)},300)})(0)})}function h(e,n=[]){if(e&&e.length>0){(!n||n.length==0)&&(n=a.value);let o=n.filter(r=>r.store===e);if(o&&o.length>0){let r=o[0].id;u("next",r)}}}return{selectedValue:d,dictOptions:a,handleChange:f}}}),R=["title"];function H(t,u,i,d,a,g){const f=v("a-select-option"),c=v("a-select");return p(),_(S,null,[w(" 111 "),T(c,{placeholder:t.placeholder,value:t.selectedValue,onChange:t.handleChange,allowClear:"",style:{width:"100%"}},{default:E(()=>[(p(!0),_(S,null,N(t.dictOptions,(l,s)=>(p(),V(f,{key:s,value:l.store},{default:E(()=>[k("span",{style:{display:"inline-block",width:"100%"},title:l.label},P(l.label),9,R)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onChange"])],64)}var q=O(L,[["render",H]]);export{q as default};
