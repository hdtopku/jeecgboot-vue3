var e=(e,t,a)=>new Promise(((o,l)=>{var r=e=>{try{n(a.next(e))}catch(t){l(t)}},s=e=>{try{n(a.throw(e))}catch(t){l(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,s);n((a=a.apply(e,t)).next())}));import{a as t,u as a,B as o}from"./index.32c2f26d.js";import{_ as l}from"./index.3e7bd500.js";import{q as r,l as s,F as n,L as i,t as d,v as u,V as c,z as m,y as v,bD as f,C as p,D as y,W as g,B as h}from"./index.26a57b91.js";import k from"./RoleDataRuleDrawer.9b60da8a.js";import{q as x,c as w,e as _}from"./role.api.0ee3530c.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";const b=p("取消"),j=p("仅保存"),D=p("保存并关闭");var C=r(s({__name:"RolePermissionDrawer",emits:["register"],setup(r,{emit:s}){const C=n([]),I=n([]),R=n([]),K=n([]),P=n([]),T=n(""),F=n(null),L=n(!1),[q,{openDrawer:B}]=t(),[E,{setDrawerProps:S,closeDrawer:z}]=a((t=>e(this,null,(function*(){yield(C.value=[],I.value=[],R.value=[],K.value=[],P.value=[],void(T.value="")),S({confirmLoading:!1,loading:!0}),T.value=t.roleId;const e=yield x();C.value=e.treeList,I.value=e.ids;const a=yield w({roleId:i(T)});R.value=a,K.value=a,S({loading:!1})}))));function M(e){R.value=e.checked?e.checked:e}function O(e){e&&e.length>0&&(P.value=e),B(!0,{functionId:i(P)[0],roleId:i(T)})}function V(){const e=i(F);if(!e)throw new Error("tree is null!");return e}function W(t){return e(this,null,(function*(){let e={roleId:i(T),permissionIds:i(V().getCheckedKeys()).join(","),lastpermissionIds:i(K).join(",")};L.value=!0,yield _(e),L.value=!1,t&&z()}))}return(e,t)=>{const a=d("Icon"),r=d("a-button");return u(),c(i(o),h(e.$attrs,{onRegister:i(E),title:"角色权限配置",width:"650px",destroyOnClose:"",showFooter:""}),{footer:m((()=>[v(i(f),{title:"确定放弃编辑？",onConfirm:i(z),okText:"确定",cancelText:"取消"},{default:m((()=>[b])),_:1},8,["onConfirm"]),v(r,{onClick:t[0]||(t[0]=e=>W(!1)),type:"primary",loading:L.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:m((()=>[j])),_:1},8,["loading"]),v(r,{onClick:t[1]||(t[1]=e=>W(!0)),type:"primary",loading:L.value},{default:m((()=>[D])),_:1},8,["loading"])])),default:m((()=>[v(i(l),{ref_key:"treeRef",ref:F,checkable:"",toolbar:"",treeData:C.value,checkedKeys:R.value,expandedKeys:I.value,selectedKeys:P.value,checkStrictly:!0,clickRowToExpand:!1,title:"所拥有的的权限",onCheck:M,onSelect:O},{title:m((({slotTitle:e,ruleFlag:t})=>[p(y(e)+" ",1),t?(u(),c(a,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):g("",!0)])),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys"]),v(k,{onRegister:i(q)},null,8,["onRegister"])])),_:1},16,["onRegister"])}}}),[["__scopeId","data-v-5ab79653"]]);export{C as default};
