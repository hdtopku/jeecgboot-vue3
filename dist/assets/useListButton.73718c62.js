import{E as z,d as he}from"./FormSchemaFactory.b9ba920c.js";import{F as y,dN as Ee,J as Fe,bH as $,a7 as le,ab as x,r as Be,f9 as ye,a1 as S,a5 as De,as as me,fh as we,fi as ve,fj as Pe,fk as Se,ff as Oe,u as ge,b4 as be,Q as ie,at as Ce}from"./index.df6cbb3d.js";import{onMountedOrActivated as _e}from"./onMountedOrActivated.52712096.js";import"./index.696f9d2b.js";import{p as Re}from"./pick.dbff1c58.js";var Me=Object.defineProperty,Te=Object.defineProperties,Ae=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,fe=(r,i,f)=>i in r?Me(r,i,{enumerable:!0,configurable:!0,writable:!0,value:f}):r[i]=f,C=(r,i)=>{for(var f in i||(i={}))Ie.call(i,f)&&fe(r,f,i[f]);if(ce)for(var f of ce(i))Ne.call(i,f)&&fe(r,f,i[f]);return r},pe=(r,i)=>Te(r,Ae(i)),X=(r,i,f)=>new Promise((D,p)=>{var F=d=>{try{h(f.next(d))}catch(m){p(m)}},E=d=>{try{h(f.throw(d))}catch(m){p(m)}},h=d=>d.done?D(d.value):Promise.resolve(d.value).then(F,E);h((f=f.apply(r,i)).next())});const Ue={vue:we,"@":{hooks:{useMessage:ve},utils:{axios:Pe,cache:Se}}};function ke(r,i){const f=Object.assign({},Ue,r);function D(E){if(E!=null&&E!=""){let h=E.toString().split("/"),d=f[h[0]];for(let m=1;m<h.length;m++)d=d[h[m]];return d}return null}function p(){}function F(E){let h=Oe(6);const m=`return function (customImport, ${"__export_"+h}) {"use strict"; ${E}}`;console.group("executeJsEnhanced"),console.log(m),console.groupEnd(),new Function(m)().call(i,D,p)}return{executeJsEnhanced:F}}const $e={acceptHrefParams:"<p> \u8DF3\u8F6C\u65F6\u83B7\u53D6\u7684\u53C2\u6570\u4FE1\u606F",currentPage:"<p> \u5F53\u524D\u9875\u6570",currentTableName:"<p> \u5F53\u524D\u8868\u540D",description:"<p> \u5F53\u524D\u8868\u63CF\u8FF0",hasChildrenField:"<p> \u662F\u5426\u6709\u5B50\u8282\u70B9\u7684\u5B57\u6BB5\u540D\uFF0C\u4EC5\u6811\u5F62\u8868\u5355\u4E0B\u6709\u6548",isDesForm:"<p> xx",isTree:"<m> \u662F\u5426\u662F\u6811\u5F62\u8868\u5355 ",loadData:"<m> \u52A0\u8F7D\u5217\u8868\u6570\u636E",pageSize:"<p> \u6BCF\u4E00\u9875\u663E\u793A\u6761\u6570",queryParam:"<p> \u67E5\u8BE2\u6761\u4EF6\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u70B9\u51FB\u67E5\u8BE2\u540E\u624D\u4F1A\u66F4\u65B0\u6B64\u6570\u636E",selectedRowKeys:"<p> \u9009\u4E2D\u7684\u884C\u7684id\u6570\u7EC4",sortField:"<p> \u6392\u5E8F\u5B57\u6BB5",sortType:"<p> \u6392\u5E8F\u89C4\u5219",total:"<p> \u603B\u9875\u6570"},xe={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess"};let Qe={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const je={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(r,i)=>i[0]+"-"+i[1]+" \u5171"+r+"\u6761",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:k,createErrorModal:Le}=ge(),He=/(?:\/\*[\s\S]*?\*\/|\/\/.*?\r?\n|[^{])+\{([\s\S]*)\}$/;function qe(){console.log("-------------------------useOnlineTableContext----------------------->");const r=y(""),i=Ee(),f=y(),D=y(),p=y(!1),F=y([]),E=y(!0),h=y();let d={};const m={execButtonEnhance:function(t,a){if(s[z][t])if(he===t)_(t);else{let e=x(a);return s[z][t].call(s,s,e)}else s[z][t+"_hook"]?_(t+"_hook"):console.log("\u589E\u5F3A\u6CA1\u627E\u5230!",t)},isTree:function(t){return typeof t=="boolean"?(s.isTreeTable=t,t):s.isTreeTable}};function _(t){let e=s[z][t].toLocaleString().match(He);if(e.length>1){let u=e[1];B(u)}}const s=new Proxy($e,{get(t,a){if(typeof m[a]=="function")return m[a];{let e=d[r.value];return Reflect.get(e,a)}},set(t,a,e){let u=R();return Reflect.set(typeof e=="function"?m:u,a,e)},deleteProperty(t,a){return a===r.value?(delete d[a],!0):!1}}),{executeJsEnhanced:B}=ke({},s);function O(){let t=i.params.id;return t||(t=""),t}_e(()=>{console.log("-------------------onMountedOrActivated-------------------"),V()}),Fe(()=>{console.log("-------------------onBeforeUnmount-------------------"),delete d[r.value]});function R(){let t=d[r.value];if(!t){let a=Object.assign({},Qe,{onlineUrl:xe});t=JSON.parse(JSON.stringify(a)),d[r.value]=t}return t}function q(){let t={},a=i.query;a&&(Object.keys(a).map(e=>{t[e]=a[e]}),s.acceptHrefParams=t)}function G(){return new Promise((t,a)=>{S.get({url:`${s.onlineUrl.getColumns}${r.value}`},{isTransformResponse:!1}).then(e=>{e.success?t(e.result):(k.warning(e.message),a())}).catch(()=>{a()})})}function b(){return new Promise((t,a)=>{let e=`${s.onlineUrl.getData}${r.value}`;s.isTree()===!0&&(e=`${s.onlineUrl.getTreeData}${r.value}`);let u=M();console.log("------\u67E5\u8BE2\u53C2\u6570-----",u),S.get({url:e,params:u},{isTransformResponse:!1}).then(n=>{console.log("--onlineList-\u67E5\u8BE2\u5217\u8868\u6570\u636E",n),n.success?(Q(n.result),t(!0)):(n.message==="NO_DB_SYNC"?Le({title:"\u6570\u636E\u5E93\u672A\u540C\u6B65",content:"\u8BF7\u5148\u540C\u6B65\u6570\u636E\u5E93\u518D\u67E5\u770B\u6B64\u9875\u9762\uFF01",onOk:()=>be.back()}):k.warning(n.message),a(!1))}).catch(()=>{let n="\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";k.warning(n),a(!1)})})}function M(){const{sortField:t,sortType:a,acceptHrefParams:e,queryParam:u}=s;let n={};s.isTree()===!0?n.hasQuery="false":n.hasQuery="true";let o=Object.assign({},n,e,u,{column:t,order:a});p.value?(o.pageNo=p.value.current,o.pageSize=p.value.pageSize):o.pageSize=-521;let l=H();return o.superQueryMatchType=l.matchType||"",o.superQueryParams=l.params||"",me(o)}function Q(t){let a=0;Number(t.total)>0?(s.isTree()===!0?(F.value=P(t.records),ie(()=>{L(F.value)})):F.value=t.records,a=Number(t.total)):F.value=[],p.value&&(p.value=pe(C({},p.value),{total:a}))}function W(t,a,e){e&&e.order?(s.sortField=e.field,s.sortType=e.order=="ascend"?"asc":"desc"):(s.sortField="id",s.sortType="asc"),p.value&&(p.value=t),b()}function Y(t){s.description=t.description,s.currentTableName=t.currentTableName,s.isDesForm=t.isDesForm,s.desFormCode=t.desFormCode,s.ID=r.value;let{acceptHrefParams:a,queryParam:e,superQuery:u,currentPage:n,pageSize:o}=s;q(),e?f.value.initDefaultValues(e,a):s.queryParam={},u?D.value.initDefaultValues(u):s.superQuery={params:"",matchType:""},t.paginationFlag=="Y"?p.value=C(C({},je),{current:n,pageSize:o}):p.value=!1}function j(){return X(this,null,function*(){E.value=!0,yield ie(),E.value=!1})}const T={loadData:b,getLoadDataParams:M,reloadTable:j};Object.keys(T).map(t=>{s[t]=T[t]});let Z=y(!1);function ee(){return X(this,null,function*(){p.value&&(p.value=pe(C({},p.value),{current:1})),s.clearSelectedRow(),yield b()})}function P(t){if(t)return t.map(a=>{let e=s.hasChildrenField;if(a[e]=="1"){let u={id:a.id+"_loadChild",name:"loading...",isLoading:!0};u.jeecg_row_key=u.id,a.children=[u]}return a})}const A=y([]);function te(t){A.value=t}function L(t){let a=A.value;if(a.length>0){const{sortField:e,sortType:u,pidField:n}=s;let o=Object.assign({},{column:e,order:u});o.hasQuery="in";let l=Object.assign({});l.rule="in",l.type="text",l.val=a.join(","),l.field=n,l=[l],o.superQueryParams=encodeURI(JSON.stringify(l)),o.superQueryMatchType="and",o.batchFlag="true";let c=`${s.onlineUrl.getTreeData}${r.value}`;console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u53C2\u6570",l),S.get({url:c,params:o},{isTransformResponse:!1}).then(g=>{if(console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u5217\u8868\u6570\u636E",g),g.success&&g.result.records&&g.result.records.length>0){let w=g.result.records;const N=new Map;for(let U of w){let v=U[n];if(a.join(",").includes(v)){let K=N.get(v);K==null&&(K=[]),K.push(U),N.set(v,K)}}let se=N,oe=U=>{U&&U.forEach(v=>{a.includes(v.id)&&(v.children=P(se.get(v.id)),oe(v.children))})};oe(t)}}).catch(()=>{let g="loadDataByExpandedRows\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";k.warning(g)})}else return Promise.resolve()}function H(){if(!s.superQuery)return{};const{superQuery:{params:t,matchType:a},currentTableName:e}=s;let u=e+"@",n=[];if(t.length>0)for(let l of t){let c=C({},l),g=c.field;g.startsWith(u)&&(c.field=g.replace(u,"")),n.push(c)}let o=n.length>0?JSON.stringify(n):"";return console.log("\u9AD8\u7EA7\u67E5\u8BE2\u6761\u4EF6",n,a),{params:encodeURIComponent(o),matchType:a}}const I=y(!1);function J(t,a){s.superQuery={params:t,matchType:a},t.length==0?I.value=!1:I.value=!0,b()}const[ue,{openModal:re}]=$();function ne(t){if(t||(t={}),!t.row){let a=s.selectedRows;if(!a||a.length==0||a.length>1){k.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E");return}t.row=a[0]}t.code=r.value,re(!0,t)}s.openCustomModal=ne;function V(){let t=O();r.value=t}V();function ae(t){let a=t.head.extConfigJson;a&&(h.value=JSON.parse(a))}return C({ID:r,onlineQueryFormOuter:f,superQueryButtonRef:D,loading:Z,reload:ee,dataSource:F,pagination:p,tableReloading:E,handleSpecialConfig:Y,onlineTableContext:s,handleChangeInTable:W,getColumnList:G,getTreeDataByResult:P,expandedRowKeys:A,handleExpandedRowsChange:te,onlineExtConfigJson:h,handleFormConfig:ae,superQueryStatus:I,handleSuperQuery:J,registerCustomModal:ue},T)}const de="onl_";function Ge(r,i){const f={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[D,{openModal:p}]=$(),[F,{openModal:E}]=$(),[h,{openModal:d}]=$(),[m,{openModal:_}]=$(),{createMessage:s}=ge(),B=le(f),O=le([]),R=le([]);function q(e){if(O.length=0,R.length=0,e&&e.length>0)for(let u=0;u<e.length;u++){let n=Re(e[u],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");n.buttonStyle=="button"?R.push(n):n.buttonStyle=="link"&&O.push(n)}}function G(e){Object.keys(B).forEach(u=>{B[u]=!0}),e&&e.length>0&&Object.keys(B).forEach(u=>{e.indexOf(u)>=0&&(B[u]=!1)})}function b(e){let u={isUpdate:!1};e&&(u.param=e),p(!0,u)}function M(e){r.beforeEdit(e).then(()=>{p(!0,{isUpdate:!0,record:e})}).catch(u=>{s.warning(u)})}const Q=e=>({label:"\u5220\u9664",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:W.bind(null,e)}});function W(e){r.beforeDelete(e).then(()=>{H(e.id)}).catch(u=>{s.warning(u)})}function Y(e){let u=P(e),n=u&&u=="1"||!u;return x(B.update)===!0&&n?[{label:"\u7F16\u8F91",onClick:M.bind(null,e)}]:[]}function j(e){return{label:"\u63D0\u4EA4\u6D41\u7A0B",popConfirm:{title:"\u786E\u8BA4\u63D0\u4EA4\u6D41\u7A0B\u5417\uFF1F",confirm:L.bind(null,e)}}}function T(e){return{label:"\u5BA1\u6279\u8FDB\u5EA6",onClick:Z.bind(null,e)}}function Z(e){const{currentTableName:u}=r;let n=de+u,o=e.id;_(!0,{flowCode:n,dataId:o})}function ee(e){let u=[];if(x(B.detail)===!0&&u.push({label:"\u8BE6\u60C5",onClick:A.bind(null,e)}),r.hasBpmStatus===!0&&x(B.bpm)===!0){let c=P(e);!c||c=="1"?u.push(j(e)):u.push(T(e))}if(i.value){let{reportPrintShow:c,reportPrintUrl:g}=i.value;c&&g&&u.push({label:"\u6253\u5370",onClick(){let w=g,N=e.id,se=Be();ye(w,N,se)}})}let n=P(e),o=n&&n=="1"||!n;x(B.delete)===!0&&o&&u.push(Q(e));let l=O;if(l&&l.length>0)for(let c of l)a(c.exp||"",e)===!0&&u.push({label:c.buttonName,onClick:J.bind(null,e,c.buttonCode,c.optType)});return u}function P(e){const u="bpm_status";let n=e[u];return n||(n=e[u.toUpperCase()]),n}function A(e){d(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function te(e){const{currentTableName:u,onlineUrl:{startProcess:n}}=r;let o={url:n,params:{flowCode:de+u,id:e.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},l={isTransformResponse:!1};return new Promise((c,g)=>{S.post(o,l).then(w=>{w.success?(c(w),s.success(w.message)):(g(),s.warning(w.message))})})}function L(e){return X(this,null,function*(){yield te(e),r.loadData()})}function H(e){console.log("\u5220\u9664\u6570\u636Eid\u503C",e);let u=`${r.onlineUrl.optPre}${r.ID}/${e}`;return new Promise((n,o)=>{S.delete({url:u},{isTransformResponse:!1}).then(l=>{l.success?(s.success(l.message),r.loadData(),n(!0)):(s.warning(l.message),o())})})}function I(){let e=r.selectedRowKeys;if(e.length<=0)return s.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u8BB0\u5F55\uFF01"),!1;{let u=[];e.forEach(function(o){let l=o;l&&l.endsWith("_loadChild")&&(l=l.replace("_loadChild","")),u.indexOf(l)<0&&u.push(l)});let n=u.join(",");De.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>X(this,null,function*(){yield H(n),r.clearSelectedRow()})})}}function J(e,u,n){if(n=="js")r.execButtonEnhance(u,e);else if(n=="action"){let o={formId:r.ID,buttonCode:u,dataId:e.id},l=`${r.onlineUrl.buttonAction}`;S.post({url:l,params:o},{isTransformResponse:!1}).then(c=>{c.success?(r.loadData(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(c.message)})}}function ue(e){r.execButtonEnhance(e)}function re(e){let u=r.selectedRowKeys;if(!u||u.length==0)return s.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55"),!1;let n=u.join(","),o={formId:r.ID,buttonCode:e,dataId:n},l=`${r.onlineUrl.buttonAction}`;S.post({url:l,params:o},{isTransformResponse:!1}).then(c=>{c.success?(r.loadData(),r.clearSelectedRow(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(c.message)})}function ne(){E(!0)}const V=()=>`${r.onlineUrl.importXls}${r.ID}`,{handleExportXlsx:ae}=Ce();function t(){let e=r.getLoadDataParams(),u=r.selectedRowKeys;u&&u.length>0&&(e.selections=u.join(","));let n=JSON.stringify(me(e)),o=`${r.onlineUrl.exportXls}${r.ID}`;const l=r.description;ae(l,o,{paramsStr:n})}function a(e,u){if(!e||e=="")return!0;let n=e.split("#"),o=u[n[0]],l=n[1].toLowerCase();return l==="eq"?o==n[2]:l==="ne"?o!=n[2]:l==="empty"?n[2]==="true"?!o||o=="":o&&o.length>0:l==="in"?n[2].split(",").indexOf(String(o))>=0:!1}return{buttonSwitch:B,cgLinkButtonList:O,cgTopButtonList:R,importUrl:V,registerModal:D,handleAdd:b,handleEdit:M,handleBatchDelete:I,registerImportModal:F,onImportExcel:ne,onExportExcel:t,getDropDownActions:ee,getActions:Y,cgButtonJsHandler:ue,cgButtonActionHandler:re,cgButtonLinkHandler:J,initButtonList:q,initButtonSwitch:G,getDeleteButton:Q,handleSubmitFlow:L,getSubmitFlowButton:j,registerDetailModal:h,registerBpmModal:m}}export{Ge as a,qe as u};
