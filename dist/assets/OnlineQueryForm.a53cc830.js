import{B as e}from"./BasicForm.5f094c03.js";import"./helper.7e5efd4b.js";import{u as t}from"./useForm.18cf269c.js";import"./JAddInput.a2bd8bfb.js";import{f0 as a,F as r,a8 as o,H as s,ac as i,t as n,v as l,x as c,y as u,z as m,aW as p,C as d,D as f,W as h,a1 as b,u as g,dp as j,dq as y}from"./index.26a57b91.js";import{c as v,F as w}from"./FormSchemaFactory.00db1169.js";import{g as x,e as F,f as S,h as O,i as _}from"./useAutoForm.67b4b6d8.js";import"./JUpload.7c63ef7b.js";import"./JUploadModal.4b0dd4d4.js";import"./OnlineSelectCascade.2c5f6973.js";import"./index.934459b9.js";import"./pick.dbff1c58.js";import"./_flatRest.ff1861ce.js";import"./isArray.40a4ed15.js";import"./toString.cf909882.js";import"./_arrayPush.8821345e.js";import"./BasicTable.8cbbb86a.js";import"./TableImg.f02873d7.js";import"./Area.5f50cf87.js";import"./functional.c7818516.js";import"./LinkTableListPiece.ee26873b.js";import"./uniqBy.006870c7.js";import"./BasicModal.e5e1fb3e.js";import"./useWindowSizeFn.9ed8a10e.js";import"./useFormItem.efca0b58.js";import"./download.4b98da42.js";import"./base64Conver.030fa32c.js";import"./index.608c7cf2.js";import"./index.b94b363f.js";import"./useCountdown.e60db803.js";import"./index.9c299300.js";import"./api.54a4ca84.js";import"./props.eaaadc91.js";import"./index.3e7bd500.js";import"./bem.73404aba.js";import"./props.d9d42440.js";import"./useContextMenu.7af190c4.js";import"./index.0d2a049f.js";import"./onMountedOrActivated.d719a17d.js";import"./index.6fce0e9a.js";import"./htmlmixed.fbaa0b47.js";import"./vue.38e13cef.js";/* empty css             */import"./depart.api.c295d6d2.js";import"./user.api.c522f7b9.js";import"./_commonjsHelpers.7ef9cff5.js";import"./customExpression.58041e91.js";import"./useListPage.fd3526da.js";import"./useTable.98dbd6c0.js";import"./index.1a78ea68.js";import"./useContentHeight.3e69d770.js";import"./useContentViewHeight.34b8e2f1.js";import"./usePageContext.dd16d566.js";import"./RedoOutlined.48666e00.js";import"./JModalTip.6a90f9c1.js";var k=Object.defineProperty,Y=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,P=(e,t,a)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,U=(e,t)=>{for(var a in t||(t={}))C.call(t,a)&&P(e,a,t[a]);if(Y)for(var a of Y(t))M.call(t,a)&&P(e,a,t[a]);return e},D=(e,t,a)=>new Promise(((r,o)=>{var s=e=>{try{n(a.next(e))}catch(t){o(t)}},i=e=>{try{n(a.throw(e))}catch(t){o(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,i);n((a=a.apply(e,t)).next())}));const B={name:"OnlineQueryForm",components:{BasicForm:e},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(e,{emit:a}){const n="/online/cgform/api/getQueryInfoVue3/",l=r(null),c=r([]),u=r({xs:24,sm:24,md:12,lg:8,xl:8}),m=r(!1),p=r(!1),d=r({}),f=r([]),{createMessage:h}=g(),j=o({config:{},cache:{},param:{},status:!1});s((()=>j.status),(e=>D(this,null,(function*(){const{config:e,cache:t,param:a}=i(j);let r=Object.assign({},e,t,a);yield function(e){return D(this,null,(function*(){yield x(l),yield Y(e),Object.keys(e).length>0&&P()}))}(r)}))),{immediate:!0,deep:!0}),s((()=>e.id),(t=>{t?function(){D(this,null,(function*(){let t=yield function(){let t=`${n}${e.id}`;return new Promise((e=>{b.get({url:t},{isTransformResponse:!1}).then((t=>{t.success?e(t.result):(e(!1),h.warning(t.message))})).catch((()=>{h.warning("获取查询条件失败!"),e(!1)}))}))}(),r=function(e){const{properties:t,searchFieldList:a,joinQuery:r,table:o}=e;let s={},i=1;return Object.keys(t).map((e=>{let a=t[e];if("table"==a.view){let t=a.properties,r=100*i;Object.keys(t).map((a=>{let o=t[a];o.order=r+Number(o.order),s[e+"@"+a]=o})),i++}else a.order=Number(a.order),s[e]=a})),s}(t);a("loaded",t);let{formProperties:o,hasField:s}=function(e,t){const{searchFieldList:a,joinQuery:r,table:o}=t;let s=!1,i={};e&&Object.keys(e).map((t=>{a.indexOf(t)>=0&&(1==r?t.indexOf("@")<0?(i[o+"@"+t]=e[t],s=!0):(i[t]=e[t],s=!0):t.indexOf("@")<0&&(i[t]=e[t],s=!0))}));return{formProperties:i,hasField:s}}(r,t);0!=s?yield function(e){return D(this,null,(function*(){let t=[],a={},r=Object.keys(e);for(let i of r){const r=e[i];let o=r.view;if(v[o]&&(r.view=v[o]),yield F(i,r,a),"group"!=r.mode||"date"!=o&&"datetime"!=o&&"number"!=o)if(r.view===S){let e=O(r,i);for(let a of e){let e=w.createFormSchema(a.key,a),r=_(t,a.key);-1==r?t.push(e):t[r]=e}}else{if(-1==_(t,i)){let e=w.createFormSchema(i,r);t.push(e)}}else{let e=w.createSlotFormSchema(i,r);t.push(e)}}t.sort((function(e,t){return e.order-t.order}));let o=[];t.length>2&&(m.value=!0);let s=[];for(let e=0;e<t.length;e++){let a=t[e];a.setFormRef(l),a.noChange(),a.asSearchForm(),e>1&&(s.push(a.field),a.isHidden()),o.push(a.getFormItemSchema())}f.value=s,c.value=o,j.config=U({},a),j.status=!j.status}))}(o):c.value=[]}))}():c.value=[]}),{immediate:!0});const[y,{resetFields:k,setFieldsValue:Y,updateSchema:C,getFieldsValue:M}]=t({schemas:c,showActionButtonGroup:!1,baseColProps:u,autoSubmitOnEnter:!0,submitFunc(){P()}});function P(){let e=M(),t=Object.assign({},i(j.param),function(e){return Object.keys(e).map((t=>{e[t]&&e[t]instanceof Array&&(e[t]=e[t].join(","))})),e}(e));a("search",t,!0)}return s((()=>p.value),(e=>{let t=f.value;if(t&&t.length>0){let a=[];for(let r of t)a.push({field:r,show:e});C(a)}}),{immediate:!1}),{onlineQueryFormRef:l,registerForm:y,initDefaultValues:function(e,t){return D(this,null,(function*(){j.cache=U({},e),j.param=U({},t),j.status=!j.status}))},toggleButtonShow:m,toggleSearchStatus:p,doSearch:P,resetSearch:function(){return D(this,null,(function*(){yield k();const{config:e,param:t}=i(j);let r=Object.assign({},e,t);Object.keys(r).length>0&&(yield Y(r)),a("search",r,!1)}))},queryParams:d,formSchemas:c}}},T=e=>(j("data-v-01d37a80"),e=e(),y(),e),H={key:0,class:"jeecg-basic-table-form-container p-0"},I=T((()=>p("span",{class:"group-query-string"},"~",-1))),R=T((()=>p("span",{class:"group-query-string"},"~",-1))),A=T((()=>p("span",{class:"group-query-string"},"~",-1))),q={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};var Q=a(B,[["render",function(e,t,a,r,o,s){const i=n("a-date-picker"),b=n("a-input-number"),g=n("a-button"),j=n("a-icon"),y=n("a-col"),v=n("BasicForm");return r.formSchemas&&r.formSchemas.length>0?(l(),c("div",H,[u(v,{ref:"onlineQueryFormRef",onRegister:r.registerForm},{groupDate:m((({model:e,field:t})=>[u(i,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"开始日期",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),I,u(i,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"结束日期",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])])),groupDatetime:m((({model:e,field:t})=>[u(i,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),R,u(i,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])])),groupNumber:m((({model:e,field:t})=>[u(b,{placeholder:"开始值",value:e[t+"_begin"],"onUpdate:value":a=>e[t+"_begin"]=a,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),A,u(b,{placeholder:"结束值",value:e[t+"_end"],"onUpdate:value":a=>e[t+"_end"]=a,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])])),formFooter:m((()=>[u(y,{md:6,sm:8},{default:m((()=>[p("span",q,[u(g,{preIcon:"ant-design:search",type:"primary",onClick:r.doSearch},{default:m((()=>[d("查询")])),_:1},8,["onClick"]),u(g,{preIcon:"ant-design:reload",type:"primary",onClick:r.resetSearch,style:{"margin-left":"8px"}},{default:m((()=>[d("重置")])),_:1},8,["onClick"]),r.toggleButtonShow?(l(),c("a",{key:0,onClick:t[0]||(t[0]=e=>r.toggleSearchStatus=!r.toggleSearchStatus),style:{"margin-left":"8px"}},[d(f(r.toggleSearchStatus?"收起":"展开")+" ",1),u(j,{type:r.toggleSearchStatus?"up":"down"},null,8,["type"])])):h("",!0)])])),_:1})])),_:1},8,["onRegister"])])):h("",!0)}],["__scopeId","data-v-01d37a80"]]);export{Q as default};
