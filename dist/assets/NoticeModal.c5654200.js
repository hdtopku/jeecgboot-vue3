var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,n=(e,t,r)=>new Promise(((o,a)=>{var n=e=>{try{l(r.next(e))}catch(t){a(t)}},s=e=>{try{l(r.throw(e))}catch(t){a(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,s);l((r=r.apply(e,t)).next())}));import{B as s}from"./index.ee0a0c33.js";import{B as l}from"./BasicForm.79466d99.js";import"./helper.ec3e26f3.js";import{u as d}from"./useForm.ee23be26.js";import"./JAddInput.c8a1b05b.js";import{a1 as i,l as c,F as m,bH as u,L as p,o as y,v as g,V as f,z as b,y as h,B as x}from"./index.b3c93d64.js";import{rules as I}from"./validator.08db3aa9.js";import{render as w}from"./renderUtils.864e5731.js";const v=[{title:"标题",width:150,dataIndex:"titile"},{title:"消息类型",dataIndex:"msgCategory",width:100,customRender:({text:e})=>w.renderDict(e,"msg_category")},{title:"发布人",width:100,dataIndex:"sender"},{title:"优先级",dataIndex:"priority",width:70,customRender:({text:e})=>{const t="L"==e?"blue":"M"==e?"yellow":"red";return w.renderTag(w.renderDict(e,"priority"),t)}},{title:"通告对象",dataIndex:"msgType",width:100,customRender:({text:e})=>w.renderDict(e,"msg_type")},{title:"发布状态",dataIndex:"sendStatus",width:70,customRender:({text:e})=>{const t="0"==e?"red":"1"==e?"green":"gray";return w.renderTag(w.renderDict(e,"send_status"),t)}},{title:"发布时间",width:100,dataIndex:"sendTime"},{title:"撤销时间",width:100,dataIndex:"cancelTime"}],T=[{field:"titile",label:"标题",component:"JInput",colProps:{span:8}}],P=[{field:"id",label:"id",component:"Input",show:!1},{field:"msgCategory",label:"消息类型",required:!0,component:"JDictSelectTag",defaultValue:"1",componentProps:{type:"radio",dictCode:"msg_category",placeholder:"请选择类型"}},{field:"titile",label:"标题",component:"Input",required:!0,componentProps:{placeholder:"请输入标题"}},{field:"msgAbstract",label:"摘要",component:"InputTextArea",required:!0},{field:"endTime",label:"截至日期",component:"DatePicker",componentProps:{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择截至日期"},dynamicRules:({model:e})=>I.endTime(e.startTime,!0)},{field:"msgType",label:"接收用户",defaultValue:"ALL",component:"JDictSelectTag",required:!0,componentProps:{type:"radio",dictCode:"msg_type",placeholder:"请选择发布范围"}},{field:"userIds",label:"指定用户",component:"JSelectUser",required:!0,componentProps:{rowKey:"id",labelKey:"username"},ifShow:({values:e})=>"USER"==e.msgType},{field:"priority",label:"优先级",defaultValue:"H",component:"JDictSelectTag",componentProps:{dictCode:"priority",type:"radio",placeholder:"请选择优先级"}},{field:"msgContent",label:"内容",component:"Input",render:w.renderTinymce}],j="/sys/annountCement/exportXls",C="/sys/annountCement/importExcel",_=e=>i.get({url:"/sys/annountCement/list",params:e}),D=(e,t)=>i.delete({url:"/sys/annountCement/delete",data:e},{joinParamsToUrl:!0}).then((()=>{t()})),R=e=>i.delete({url:"/sys/annountCement/deleteBatch",data:e},{joinParamsToUrl:!0}),O=e=>i.get({url:"/sys/annountCement/doReleaseData",params:e}),S=e=>i.get({url:"/sys/annountCement/doReovkeData",params:e}),L=c({__name:"NoticeModal",emits:["register","success"],setup(e,{emit:c}){const I=m(!0),[w,{resetFields:v,setFieldsValue:T,validate:j}]=d({schemas:P,showActionButtonGroup:!1}),[C,{setModalProps:_,closeModal:D}]=u((e=>n(this,null,(function*(){yield v(),_({confirmLoading:!1}),I.value=!!(null==e?void 0:e.isUpdate),p(I)&&(e.record.userIds&&(e.record.userIds=e.record.userIds.substring(0,e.record.userIds.length-1)),yield T(((e,n)=>{for(var s in n||(n={}))r.call(n,s)&&a(e,s,n[s]);if(t)for(var s of t(n))o.call(n,s)&&a(e,s,n[s]);return e})({},e.record)))})))),R=y((()=>p(I)?"编辑":"新增"));function O(e){return n(this,null,(function*(){try{let e=yield j();_({confirmLoading:!0}),e.userIds+=",",yield((e,t)=>{let r=t?"/sys/annountCement/edit":"/sys/annountCement/add";return i.post({url:r,params:e})})(e,I.value),D(),c("success")}finally{_({confirmLoading:!1})}}))}return(e,t)=>(g(),f(p(s),x(e.$attrs,{onRegister:p(C),title:p(R),onOk:O,width:"900px",destroyOnClose:""}),{default:b((()=>[h(p(l),{onRegister:p(w)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});var M=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{M as N,L as _,j as a,C as b,v as c,R as d,D as e,O as f,_ as g,S as h,T as s};
