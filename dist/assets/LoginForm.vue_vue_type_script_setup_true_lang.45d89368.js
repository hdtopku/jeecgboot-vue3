var A=(D,n,d)=>new Promise((i,w)=>{var S=c=>{try{p(d.next(c))}catch(y){w(y)}},o=c=>{try{p(d.throw(c))}catch(y){w(y)}},p=c=>c.done?i(c.value):Promise.resolve(c.value).then(S,o);p((d=d.apply(D,n)).next())});import{j,a7 as q,aB as R,l as Q,cL as X,ex as Y,ey as H,C,a8 as N,m as J,X as Z,s as B,t as b,N as U,O as G,v as s,w as a,K as e,aF as ee,y as f,z as g,cG as k,eD as v,b7 as se,aW as x,B as te,bY as ae,ax as oe,cu as le,cF as ne,o as ie,ac as re,eI as ue,u as de,eB as ce}from"./index.9d4ffdff.js";import{c as me}from"./checkcode.26910ff2.js";import{_ as fe}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang.e56a9db9.js";import ge from"./ThirdModal.5a530bb4.js";import{c as pe,D as Ce}from"./IconFont.f8ab5522.js";import{G as ye}from"./GithubFilled.f25d0978.js";import{W as ke}from"./WechatFilled.bb7a4faa.js";const ve=["src"],Re=j({__name:"LoginForm",setup(D){const n=le,d=ne,i=q.Item,w=R.Password,S=pe({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:o}=ie(),{notification:p,createErrorModal:c}=de(),{prefixCls:y}=Q("login"),O=X(),{setLoginState:F,getLoginState:P}=Y(),{getFormRules:V}=H(),$=C(),L=C(),E=C(!1),T=C(!1),r=N({account:"",password:"",inputCode:""}),m=N({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:W}=ce($),M=J(()=>e(P)===v.LOGIN),I=C(),z=C();function K(){return A(this,null,function*(){const u=yield W();if(!!u)try{E.value=!0;const{userInfo:t}=yield O.login(re({password:u.password,username:u.account,captcha:u.inputCode,checkKey:m.checkKey,mode:"none"}));t&&p.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${t.realname}`,duration:3})}catch(t){p.error({message:o("sys.api.errorTip"),description:t.message||o("sys.api.networkExceptionMsg"),duration:3}),E.value=!1,t.message==="\u9A8C\u8BC1\u7801\u9519\u8BEF"?(r.inputCode="",I.value.focus(),_()):(t.message==="\u8BE5\u7528\u6237\u4E0D\u5B58\u5728\uFF0C\u8BF7\u6CE8\u518C"||t.message==="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF")&&z.value.focus()}})}function _(){r.inputCode="",m.checkKey=1629428467008,ue(m.checkKey).then(u=>{m.randCodeImage=u,m.requestCodeSuccess=!0,I.value.focus()})}function h(u){L.value.onThirdLogin(u)}return Z(()=>{_()}),(u,t)=>(B(),b(oe,null,[U(s(fe,{class:"enter-x"},null,512),[[G,M.value]]),U(s(e(q),{class:"p-4 enter-x",model:r,rules:e(V),ref_key:"formRef",ref:$,onKeypress:ae(K,["enter"])},{default:a(()=>[s(e(i),{name:"account",class:"enter-x"},{default:a(()=>[s(e(R),{ref_key:"usernameRef",ref:z,allowClear:"",size:"large",value:r.account,"onUpdate:value":t[0]||(t[0]=l=>r.account=l),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:a(()=>[s(e(w),{allowClear:"",size:"large",visibilityToggle:"",value:r.password,"onUpdate:value":t[1]||(t[1]=l=>r.password=l),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x",gutter:4},{default:a(()=>[s(e(n),{span:16},{default:a(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:a(()=>[s(e(R),{allowClear:"",ref_key:"inputCodeRef",ref:I,autocomplete:"off",size:"large",value:r.inputCode,"onUpdate:value":t[2]||(t[2]=l=>r.inputCode=l),placeholder:e(o)("sys.login.inputCode")},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(n),{span:8},{default:a(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:a(()=>[m.requestCodeSuccess?(B(),b("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:_},null,8,ve)):(B(),b("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:me,onClick:_}))]),_:1})]),_:1})]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(n),{span:12},{default:a(()=>[s(e(i),null,{default:a(()=>[s(e(ee),{checked:T.value,"onUpdate:checked":t[3]||(t[3]=l=>T.value=l),size:"small"},{default:a(()=>[f(g(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(n),{span:12},{default:a(()=>[s(e(i),{style:{"text-align":"right"}},{default:a(()=>[s(e(k),{type:"link",size:"small",onClick:t[4]||(t[4]=l=>e(F)(e(v).RESET_PASSWORD))},{default:a(()=>[f(g(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:a(()=>[s(e(k),{type:"primary",size:"large",block:"",onClick:K,loading:E.value},{default:a(()=>[f(g(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(n),{md:8,xs:24},{default:a(()=>[s(e(k),{block:"",onClick:t[5]||(t[5]=l=>e(F)(e(v).MOBILE))},{default:a(()=>[f(g(e(o)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:a(()=>[s(e(k),{block:"",onClick:t[6]||(t[6]=l=>e(F)(e(v).QR_CODE))},{default:a(()=>[f(g(e(o)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:7,xs:24},{default:a(()=>[s(e(k),{block:"",onClick:t[7]||(t[7]=l=>e(F)(e(v).REGISTER))},{default:a(()=>[f(g(e(o)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(se),{class:"enter-x"},{default:a(()=>[f(g(e(o)("sys.login.otherSignIn")),1)]),_:1}),x("div",{class:te(["flex justify-evenly enter-x",`${e(y)}-sign-in-way`])},[x("a",{onClick:t[8]||(t[8]=l=>h("github")),title:"github"},[s(e(ye))]),x("a",{onClick:t[9]||(t[9]=l=>h("wechat_enterprise")),title:"\u4F01\u4E1A\u5FAE\u4FE1"},[s(e(S),{class:"item-icon",type:"icon-qiyeweixin3"})]),x("a",{onClick:t[10]||(t[10]=l=>h("dingtalk")),title:"\u9489\u9489"},[s(e(Ce))]),x("a",{onClick:t[11]||(t[11]=l=>h("wechat_open")),title:"\u5FAE\u4FE1"},[s(e(ke))])],2)]),_:1},8,["model","rules","onKeypress"]),[[G,M.value]]),s(ge,{ref_key:"thirdModalRef",ref:L},null,512)],64))}});export{Re as _};
