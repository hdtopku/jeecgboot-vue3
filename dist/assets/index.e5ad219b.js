var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i;import{B as n}from"./BasicTable.0748ea8a.js";import{T as l}from"./helper.1c9dc9a5.js";import"./TableImg.e204e8e3.js";import{u as d}from"./useTable.6359f662.js";import{a1 as p,l as c,m,r as u,o as f,t as b,v as j,x as h,y as g,z as y,L as w,C as x,u as v}from"./index.435ab247.js";import"./BasicForm.d9f6c231.js";import"./uniqBy.91f18935.js";import"./index.e1e06dd6.js";import"./BasicModal.c66de981.js";import"./useWindowSizeFn.3d5b1a05.js";import"./useForm.45d68074.js";import"./JAddInput.8c125e2c.js";import"./useFormItem.816007c4.js";import"./api.bc301b0f.js";import"./props.5467b933.js";import"./index.713dc63d.js";import"./bem.0e923c54.js";import"./props.37836c63.js";import"./useContextMenu.82ce6d89.js";import"./index.e1ec35e6.js";import"./onMountedOrActivated.e9ddbd41.js";import"./index.627c6cd3.js";import"./htmlmixed.749cbc8c.js";import"./vue.f62dfd4a.js";/* empty css             */import"./depart.api.c07add53.js";import"./index.4cdbd2ab.js";import"./useContentHeight.60ff243a.js";import"./useContentViewHeight.f55d8457.js";import"./usePageContext.56c44530.js";import"./RedoOutlined.9fc7613c.js";import"./functional.be5901d6.js";import"./download.5dc68cfb.js";import"./base64Conver.030fa32c.js";import"./index.a5502478.js";import"./index.64086148.js";import"./useCountdown.adc4ab77.js";import"./JUpload.e164672b.js";import"./index.cdc49bf1.js";const O=[{title:"文件名称",dataIndex:"fileName",width:120},{title:"文件地址",dataIndex:"url",width:100}],C=[{label:"文件名称",field:"fileName",component:"Input",colProps:{span:6}},{label:"文件地址",field:"url",component:"Input",colProps:{span:6}}],I=e=>p.get({url:"/sys/oss/file/list",params:e}),P=x("OSS文件上传"),T=x("MINIO文件上传"),S=c({name:"system-ossfile"}),U=c((F=((e,t)=>{for(var o in t||(t={}))r.call(t,o)&&a(e,o,t[o]);if(i)for(var o of i(t))s.call(t,o)&&a(e,o,t[o]);return e})({},S),t(F,o({setup(e){const{createMessage:t}=v(),o=m(),i={"X-Access-Token":u()},[r,{reload:s}]=d({api:I,rowKey:"id",columns:O,formConfig:{labelWidth:120,schemas:C,autoSubmitOnEnter:!0},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},beforeFetch:e=>Object.assign({column:"createTime",order:"desc"},e),actionColumn:{width:80,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),a=f((()=>`${o.uploadUrl}/sys/oss/file/upload`)),c=f((()=>`${o.uploadUrl}/sys/upload/uploadMinio`));function x(e){if(e&&e.url){let t=encodeURIComponent(e.url);(t.endsWith(".pdf")||t.endsWith(".doc")||t.endsWith(".docx"))&&(t+="&officePreviewType=pdf");let i=`${o.viewUrl}?url=`+t;window.open(i,"_blank")}}function S(e){return t=this,o=null,i=function*(){var t,o;yield(t={id:e.id},o=s,p.delete({url:"/sys/oss/file/delete",params:t},{joinParamsToUrl:!0}).then((()=>{o()})))},new Promise(((e,r)=>{var s=e=>{try{n(i.next(e))}catch(t){r(t)}},a=e=>{try{n(i.throw(e))}catch(t){r(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,a);n((i=i.apply(t,o)).next())}));var t,o,i}function U(e){var o=e.type;if("image"===o){if(o.indexOf("image")<0)return t.warning("请上传图片"),!1}else if("file"===o&&o.indexOf("image")>=0)return t.warning("请上传文件"),!1;return!0}function F(e){"done"===e.file.status?e.file.response.success?(s(),t.success(`${e.file.name} 上传成功!`)):t.error(`${e.file.response.message}`):"error"===e.file.status&&t.error(`${e.file.response.message}`)}function M(e){return[{label:"预览",onClick:x.bind(null,e)},{label:"删除",popConfirm:{title:"是否确认删除",confirm:S.bind(null,e)}}]}return(e,t)=>{const o=b("a-button"),s=b("a-upload");return j(),h("div",null,[g(w(n),{onRegister:w(r)},{tableTitle:y((()=>[g(s,{name:"file",showUploadList:!1,action:w(a),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[P])),_:1})])),_:1},8,["action"]),g(s,{name:"file",showUploadList:!1,action:w(c),headers:i,beforeUpload:U,onChange:F},{default:y((()=>[g(o,{type:"primary",preIcon:"ant-design:upload-outlined"},{default:y((()=>[T])),_:1})])),_:1},8,["action"])])),action:y((({record:e})=>[g(w(l),{actions:M(e)},null,8,["actions"])])),_:1},8,["onRegister"])])}}}))));var F;export{U as default};
