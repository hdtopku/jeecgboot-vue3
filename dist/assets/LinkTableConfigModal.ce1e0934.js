import{B as N}from"./index.ea6d1b33.js";import{B as M}from"./BasicForm.77adc039.js";import"./helper.6c15aaa9.js";import{u as I}from"./useForm.db279587.js";import"./JAddInput.20a0408b.js";import{eY as L,F as m,bG as R,o as J,t as v,v as q,V as A,z as _,y,B as D,a1 as G}from"./index.a1b4e527.js";import{o as j}from"./omit.d6518a29.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import"./_baseClone.a8082016.js";import"./_arrayPush.8821345e.js";import"./_flatRest.ff1861ce.js";import"./BasicModal.6dc4adbe.js";import"./useWindowSizeFn.cf93ddee.js";import"./uniqBy.cec7465a.js";import"./useFormItem.f45f8681.js";import"./functional.011cfa3e.js";import"./download.6d07b2c0.js";import"./base64Conver.030fa32c.js";import"./index.865ad11c.js";import"./index.0200dbc3.js";import"./useCountdown.0ec6a702.js";import"./JUpload.5aa10044.js";import"./api.d480aed7.js";import"./index.b1e57df7.js";import"./props.3048bd74.js";import"./index.8c0f1045.js";import"./bem.ff3a25b6.js";import"./props.40d423fa.js";import"./useContextMenu.259c847c.js";import"./index.bb17d202.js";import"./onMountedOrActivated.e88e16f1.js";import"./index.96e08025.js";import"./htmlmixed.37684b60.js";import"./vue.a9bc7c21.js";/* empty css             */import"./depart.api.546ee79f.js";import"./_baseSlice.23bb44df.js";var z=Object.defineProperty,C=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,E=(i,l,t)=>l in i?z(i,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[l]=t,$=(i,l)=>{for(var t in l||(l={}))H.call(l,t)&&E(i,t,l[t]);if(C)for(var t of C(l))K.call(l,t)&&E(i,t,l[t]);return i},f=(i,l,t)=>new Promise((n,r)=>{var g=o=>{try{u(t.next(o))}catch(s){r(s)}},F=o=>{try{u(t.throw(o))}catch(s){r(s)}},u=o=>o.done?n(o.value):Promise.resolve(o.value).then(g,F);u((t=t.apply(i,l)).next())});const Y={name:"LinkTableConfigModal",emits:["success","register"],components:{BasicModal:N,BasicForm:M},setup(i,{emit:l}){const t=m(!1),n=m("");let r={};const[g,{closeModal:F}]=R(e=>f(this,null,function*(){console.log("data",e),r=$({},e.record),yield B({dictTable:e.record.dictTable}),setTimeout(()=>f(this,null,function*(){let d=j(e.record,"dictTable");yield B(d),yield k()}),200),n.value=e.fieldName})),u=m(""),o=m(""),s=m([]),h=m([]);function P(e){return f(this,null,function*(){if(e){const d="/online/cgform/field/listByHeadCode",c=yield G.get({url:d,params:{headCode:e}});if(c&&c.length>0){let p=c.filter(a=>a.dbFieldName!="id"&&a.dbIsPersist==1);console.log("\u5B57\u6BB5\u5B57\u5178",p),p.length>0?s.value=p.map(a=>({text:a.dbFieldTxt,value:a.dbFieldName})):s.value=[];let b=c.filter(a=>a.dbFieldName!="id"&&a.fieldShowType=="image"&&a.dbIsPersist==1);console.log("\u56FE\u7247\u5B57\u6BB5",b),b.length>0?h.value=b.map(a=>({text:a.dbFieldTxt,value:a.dbFieldName})):h.value=[{text:"\u65E0\u56FE\u7247\u5B57\u6BB5\u53EF\u4EE5\u9009\u62E9",value:"",key:"",disabled:!0}]}else s.value=[],h.value=[{text:"\u65E0\u56FE\u7247\u5B57\u6BB5\u53EF\u4EE5\u9009\u62E9",value:"",key:"",disabled:!0}]}})}function w(e){return f(this,null,function*(){u.value="",o.value="",yield P(e)})}const O=J(()=>{let e=s.value,d=u.value,c=o.value;return e.filter(p=>p.value!=d&&p.value!=c)}),S=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"dictField",field:"dictField",component:"Input",defaultValue:"id",show:!1},{label:"\u5B57\u6BB5\u63CF\u8FF0",field:"dbFieldTxt",component:"Input",required:!0},{label:"\u5173\u8054\u8868",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({dict:"onl_cgform_head,table_txt,table_name",pageSize:10,async:!0,immediateChange:!0,popContainer:".link-table-config-modal",params:{order:"desc",column:"create_time"},onChange:d=>f(this,null,function*(){(r.titleField||r.otherFields)&&(yield e.setFieldsValue({titleField:"",otherFields:"",imageField:""}),yield e.clearValidate()),yield w(d)})})},{label:"\u6807\u9898\u5B57\u6BB5",field:"titleField",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:s,immediateChange:!0,onChange:e=>{u.value=e,r.titleField=e}}},{label:"\u5C01\u9762\u56FE\u7247",field:"imageField",component:"JSearchSelect",componentProps:{async:!1,popContainer:".link-table-config-modal",dictOptions:h,immediateChange:!0,onChange:e=>{o.value=e,r.imageFieldName=e}}},{label:"\u5176\u4ED6\u5B57\u6BB5",field:"otherFields",component:"JSelectMultiple",componentProps:{popContainer:".link-table-config-modal",options:O,onChange:e=>{r.otherFields=e,console.error("oldValue",r)}}},{label:"\u663E\u793A\u65B9\u5F0F",field:"showType",component:"Select",defaultValue:"card",componentProps:{options:[{label:"\u5361\u7247",value:"card"},{label:"\u4E0B\u62C9\u6846",value:"select"}]}},{label:"\u662F\u5426\u591A\u9009",field:"multiSelect",component:"RadioGroup",defaultValue:!1,componentProps:{options:[{label:"\u5426",value:!1},{label:"\u662F",value:!0}]}}],[T,{validate:V,setFieldsValue:B,clearValidate:k,resetFields:U}]=I({schemas:S,showActionButtonGroup:!1,labelAlign:"right"});function x(){return f(this,null,function*(){let e=yield V();e.fieldName=n.value,l("success",e),F()})}return{registerModal:g,spinningLoading:t,registerForm:T,handleSubmit:x}}};function Q(i,l,t,n,r,g){const F=v("BasicForm"),u=v("a-spin"),o=v("BasicModal");return q(),A(o,D({wrapClassName:"link-table-config-modal"},i.$attrs,{title:"\u5173\u8054\u8BB0\u5F55\u914D\u7F6E",onRegister:n.registerModal,keyboard:"",canFullscreen:!1,cancelText:"\u5173\u95ED",onOk:n.handleSubmit}),{default:_(()=>[y(u,{spinning:n.spinningLoading},{default:_(()=>[y(F,{onRegister:n.registerForm},null,8,["onRegister"])]),_:1},8,["spinning"])]),_:1},16,["onRegister","onOk"])}var Ie=L(Y,[["render",Q]]);export{Ie as default};
