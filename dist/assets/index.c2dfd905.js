var Ie=Object.defineProperty,Me=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var se=(e,i,c)=>i in e?Ie(e,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[i]=c,U=(e,i)=>{for(var c in i||(i={}))Oe.call(i,c)&&se(e,c,i[c]);if(ce)for(var c of ce(i))Pe.call(i,c)&&se(e,c,i[c]);return e},re=(e,i)=>Me(e,Ue(i));var ie=(e,i,c)=>new Promise((g,v)=>{var b=S=>{try{y(c.next(S))}catch(_){v(_)}},l=S=>{try{y(c.throw(S))}catch(_){v(_)}},y=S=>S.done?g(S.value):Promise.resolve(S.value).then(b,l);y((c=c.apply(e,i)).next())});import{cT as me,cU as He,cV as Re,cW as Ye,cX as je,cY as Ve,cZ as Xe,c_ as de,c$ as $e,j as Ke,C as xe,d0 as ze,m as M,E as P,s as I,t as H,H as r,S as Ge,R as O,Q as W,w as R,y as oe,z as he,bg as Qe,B as ue,v as A,d1 as We,ax as q,bc as Ze,be as qe,I as J,d2 as Je,bd as et,o as tt,d3 as nt,by as at,bz as lt,d4 as ct,al as st,d5 as rt,h as it,aY as ee,d6 as fe,a7 as ye,a9 as Y,X as dt,cO as ot,aL as ht,N as ke,O as ge,b6 as ut,d7 as ft,x as yt,d8 as pe,cz as kt,ab as $,aO as gt,aP as pt,aQ as Z,d9 as St,aU as Kt,da as xt,b1 as Lt,i as Ct,ay as Se,bh as At}from"./index.4c230d5e.js";import{createBEM as Le}from"./bem.563bc896.js";import{buildProps as bt}from"./props.e1ca7390.js";import{useContextMenu as Et}from"./useContextMenu.d23c1113.js";var Tt=200;function vt(e,i,c,g){var v=-1,b=Ye,l=!0,y=e.length,S=[],_=i.length;if(!y)return S;c&&(i=me(i,He(c))),g?(b=je,l=!1):i.length>=Tt&&(b=Ve,l=!1,i=new Re(i));e:for(;++v<y;){var C=e[v],h=c==null?C:c(C);if(C=g||C!==0?C:0,l&&h===h){for(var t=_;t--;)if(i[t]===h)continue e;S.push(C)}else b(i,h,g)||S.push(C)}return S}var _t=Xe(function(e,i){return de(e)?vt(e,$e(i,1,de,!0)):[]});const Bt=_t;var T=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(T||{});const Dt=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Ft=bt({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),wt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},Nt=Ke({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:i}){const c=e,g=xe(""),[v]=Le("tree-header"),b=ze(),{t:l}=tt(),y=M(()=>{const t=b.headerTitle||c.title;return["mr-1","w-full",{["ml-5"]:t}]}),S=M(()=>{const{checkable:t}=c,a=[{label:l("component.tree.expandAll"),value:T.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:T.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:T.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:T.UN_SELECT_ALL,divider:t},...a,{label:l("component.tree.checkStrictly"),value:T.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:T.CHECK_UN_STRICTLY}]:a});function _(t){var s,d,u,o;const{key:a}=t;switch(a){case T.SELECT_ALL:(s=c.checkAll)==null||s.call(c,!0);break;case T.UN_SELECT_ALL:(d=c.checkAll)==null||d.call(c,!1);break;case T.EXPAND_ALL:(u=c.expandAll)==null||u.call(c,!0);break;case T.UN_EXPAND_ALL:(o=c.expandAll)==null||o.call(c,!1);break;case T.CHECK_STRICTLY:i("strictly-change",!1);break;case T.CHECK_UN_STRICTLY:i("strictly-change",!0);break}}function C(t){i("search",t)}const h=st(C,200);return P(()=>g.value,t=>{h(t)}),P(()=>c.searchText,t=>{t!==g.value&&(g.value=t)}),(t,a)=>(I(),H("div",{class:ue([r(v)(),"flex px-2 py-1.5 items-center"])},[r(b).headerTitle?Ge(t.$slots,"headerTitle",{key:0}):O("",!0),!r(b).headerTitle&&t.title?(I(),W(r(Qe),{key:1,helpMessage:t.helpMessage},{default:R(()=>[oe(he(t.title),1)]),_:1},8,["helpMessage"])):O("",!0),t.search||t.toolbar?(I(),H("div",wt,[t.search?(I(),H("div",{key:0,class:ue(y.value)},[A(r(We),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:g.value,"onUpdate:value":a[0]||(a[0]=s=>g.value=s),onSearch:a[1]||(a[1]=s=>t.$emit("clickSearch",s))},null,8,["placeholder","value"])],2)):O("",!0),t.toolbar?(I(),W(r(et),{key:1,onClick:a[2]||(a[2]=Je(()=>{},["prevent"]))},{overlay:R(()=>[A(r(qe),{onClick:_},{default:R(()=>[(I(!0),H(q,null,Ze(S.value,s=>(I(),H(q,{key:s.value},[A(r(nt),at(lt({key:s.value})),{default:R(()=>[oe(he(s.label),1)]),_:2},1040),s.divider?(I(),W(r(ct),{key:0})):O("",!0)],64))),128))]),_:1})]),default:R(()=>[A(r(J),{icon:"ion:ellipsis-vertical"})]),_:1})):O("",!0)])):O("",!0)],2))}}),It=({icon:e})=>e?rt(e)?it(J,{icon:e,class:"mr-1"}):J:null;function Mt(e,i){function c(h){const t=[],a=h||r(e),{key:s,children:d}=r(i);if(!d||!s)return t;for(let u=0;u<a.length;u++){const o=a[u];t.push(o[s]);const k=o[d];k&&k.length&&t.push(...c(k))}return t}function g(h){const t=[],a=h||r(e),{key:s,children:d}=r(i);if(!d||!s)return t;for(let u=0;u<a.length;u++){const o=a[u];o.disabled!==!0&&o.selectable!==!1&&t.push(o[s]);const k=o[d];k&&k.length&&t.push(...g(k))}return t}function v(h,t){const a=[],s=t||r(e),{key:d,children:u}=r(i);if(!u||!d)return a;for(let o=0;o<s.length;o++){const k=s[o],E=k[u];h===k[d]?(a.push(k[d]),E&&E.length&&a.push(...c(E))):E&&E.length&&a.push(...v(h,E))}return a}function b(h,t,a){if(!h)return;const s=a||r(e),{key:d,children:u}=r(i);if(!(!u||!d))for(let o=0;o<s.length;o++){const k=s[o],E=k[u];if(k[d]===h){s[o]=U(U({},s[o]),t);break}else E&&E.length&&b(h,t,k[u])}}function l(h=1,t,a=1){if(!h)return[];const s=[],d=t||r(e)||[];for(let u=0;u<d.length;u++){const o=d[u],{key:k,children:E}=r(i),z=k?o[k]:"",m=E?o[E]:[];s.push(z),m&&m.length&&a<h&&(a+=1,s.push(...l(h,m,a)))}return s}function y({parentKey:h=null,node:t,push:a="push"}){const s=ee(r(e));if(!h){s[a](t),e.value=s;return}const{key:d,children:u}=r(i);!u||!d||(fe(s,o=>{if(o[d]===h)return o[u]=o[u]||[],o[u][a](t),!0}),e.value=s)}function S({parentKey:h=null,list:t,push:a="push"}){const s=ee(r(e));if(!(!t||t.length<1))if(h){const{key:d,children:u}=r(i);if(!u||!d)return;fe(s,o=>{if(o[d]===h){o[u]=o[u]||[];for(let k=0;k<t.length;k++)o[u][a](t[k]);return e.value=s,!0}})}else for(let d=0;d<t.length;d++)s[a](t[d])}function _(h,t){if(!h)return;const a=t||r(e),{key:s,children:d}=r(i);if(!(!d||!s))for(let u=0;u<a.length;u++){const o=a[u],k=o[d];if(o[s]===h){a.splice(u,1);break}else k&&k.length&&_(h,o[d])}}function C(h,t,a){return!h&&h!==0?null:((t||r(e)).forEach(d=>{if((a==null?void 0:a.key)||(a==null?void 0:a.key)===0)return a;if(d.key===h){a=d;return}d.children&&d.children.length&&(a=C(h,d.children,a))}),a||null)}return{deleteNodeByKey:_,insertNodeByKey:y,insertNodesByKey:S,filterByLevel:l,updateNodeByKey:b,getAllKeys:c,getChildrenKeys:v,getEnabledKeys:g,getSelectedNode:C}}function Ut(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!kt(e)}const Yt=Ke({name:"BasicTree",inheritAttrs:!1,props:Ft,emits:Dt,setup(e,{attrs:i,slots:c,emit:g,expose:v}){const[b]=Le("tree"),l=ye({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),y=ye({startSearch:!1,searchText:"",searchData:[]}),S=xe([]),[_]=Et(),C=M(()=>{const{fieldNames:n}=e;return U({children:"children",title:"title",key:"key"},n)}),h=M(()=>{let n=re(U(U({blockNode:!0},i),e),{expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(C),"onUpdate:expandedKeys":f=>{l.expandedKeys=f,g("update:expandedKeys",f)},"onUpdate:selectedKeys":f=>{l.selectedKeys=f,g("update:selectedKeys",f)},onCheck:(f,x)=>{let p=$(l.checkedKeys);if(gt(p)&&y.startSearch){const L=x.node.eventKey;p=Bt(p,z(L)),x.checked&&p.push(L),l.checkedKeys=p}else l.checkedKeys=f;const K=$(l.checkedKeys);g("update:value",K),g("check",K,x)},onRightClick:be});return pt(n,"treeData","class")}),t=M(()=>y.startSearch?y.searchData:r(S)),a=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:s,insertNodeByKey:d,insertNodesByKey:u,filterByLevel:o,updateNodeByKey:k,getAllKeys:E,getChildrenKeys:z,getEnabledKeys:m,getSelectedNode:Ce}=Mt(S,C);function Ae(n,f){return!f&&e.renderIcon&&Z(e.renderIcon)?e.renderIcon(n):f}function be(x){return ie(this,arguments,function*({event:n,node:f}){var w;const{rightMenuList:p=[],beforeRightClick:K}=e;let L={event:n,items:[]};if(K&&Z(K)){let B=yield K(f,n);Array.isArray(B)?L.items=B:Object.assign(L,B)}else L.items=p;!((w=L.items)!=null&&w.length)||(L.items=L.items.filter(B=>!B.hidden),_(L))})}function j(n){l.expandedKeys=n}function Ee(){return l.expandedKeys}function te(n){l.selectedKeys=n}function Te(){return l.selectedKeys}function ne(n){l.checkedKeys=n}function ve(){return l.checkedKeys}function ae(n){l.checkedKeys=n?m():[]}function G(n){l.expandedKeys=n?E():[]}function _e(n){l.checkStrictly=n}P(()=>e.searchValue,n=>{n!==y.searchText&&(y.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&Q(y.searchText)});function Q(n){if(n!==y.searchText&&(y.searchText=n),g("update:searchValue",n),!n){y.startSearch=!1;return}const{filterFn:f,checkable:x,expandOnSearch:p,checkOnSearch:K,selectedOnSearch:L}=r(e);y.startSearch=!0;const{title:w,key:B}=r(C),F=[];if(y.searchData=St(r(S),D=>{var V,X;const N=f?f(n,D,r(C)):(X=(V=D[w])==null?void 0:V.includes(n))!=null?X:!1;return N&&F.push(D[B]),N},r(C)),p){const D=Kt(y.searchData).map(N=>N[B]);D&&D.length&&j(D)}K&&x&&F.length&&ne(F),L&&F.length&&te(F)}function Be(n,f){if(!(!e.clickRowToExpand||!f||f.length===0))if(!l.expandedKeys.includes(n))j([...l.expandedKeys,n]);else{const x=[...l.expandedKeys],p=x.findIndex(K=>K===n);p!==-1&&x.splice(p,1),j(x)}}Y(()=>{S.value=e.treeData}),dt(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=o(n):e.defaultExpandAll&&G(!0)}),Y(()=>{l.expandedKeys=e.expandedKeys}),Y(()=>{l.selectedKeys=e.selectedKeys}),Y(()=>{l.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{l.checkedKeys=$(e.value||[])},{immediate:!0}),P(()=>l.checkedKeys,()=>{const n=$(l.checkedKeys);g("update:value",n),g("change",n)}),Y(()=>{l.checkStrictly=e.checkStrictly});const De={setExpandedKeys:j,getExpandedKeys:Ee,setSelectedKeys:te,getSelectedKeys:Te,setCheckedKeys:ne,getCheckedKeys:ve,insertNodeByKey:d,insertNodesByKey:u,deleteNodeByKey:s,updateNodeByKey:k,getSelectedNode:Ce,checkAll:ae,expandAll:G,filterByLevel:n=>{l.expandedKeys=o(n)},setSearchValue:n=>{Q(n)},getSearchValue:()=>y.searchText};function Fe(n){const{actionList:f}=e;if(!(!f||f.length===0))return f.map((x,p)=>{var L;let K=!0;return Z(x.show)?K=(L=x.show)==null?void 0:L.call(x,n):Se(x.show)&&(K=x.show),K?A("span",{key:p,class:b("action")},[x.render(n)]):null})}const we=M(()=>{const n=ee(t.value);return xt(n,(f,x)=>{var le;const p=y.searchText,{highlight:K}=r(e),{title:L,key:w,children:B}=r(C),F=Ae(f,f.icon),D=Lt(f,L),N=p?D.indexOf(p):-1,V=y.startSearch&&!Ct(p)&&K&&N!==-1,X=`color: ${Se(K)?"#f50":K}`,Ne=V?A("span",{class:(le=r(h))!=null&&le.blockNode?`${b("content")}`:""},[A("span",null,[D.substr(0,N)]),A("span",{style:X},[p]),A("span",null,[D.substr(N+p.length)])]):D;return f[L]=A("span",{class:`${b("title")} pl-2`,onClick:Be.bind(null,f[w],f[B])},[c!=null&&c.title?At(c,"title",f):A(q,null,[F&&A(It,{icon:F},null),Ne,A("span",{class:b("actions")},[Fe(f)])])]),f}),n});return v(De),()=>{let n;const{title:f,helpMessage:x,toolbar:p,search:K,checkable:L}=e,w=f||p||K||c.headerTitle,B={height:"calc(100% - 38px)"};return A("div",{class:[b(),"h-full",i.class]},[w&&A(Nt,{checkable:L,checkAll:ae,expandAll:G,title:f,search:K,toolbar:p,helpMessage:x,onStrictlyChange:_e,onSearch:Q,onClickSearch:F=>g("search",F),searchText:y.searchText},Ut(n=ot(c))?n:{default:()=>[n]}),A(ht,{spinning:r(e.loading),tip:"\u52A0\u8F7D\u4E2D..."},{default:()=>[ke(A(ut,{style:B},{default:()=>[A(ft,yt(r(h),{showIcon:!1,treeData:we.value}),null)]}),[[ge,!r(a)]]),ke(A(pe,{image:pe.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[ge,r(a)]])]})])}}});export{Yt as _};
