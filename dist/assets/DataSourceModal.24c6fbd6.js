var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,d=(r,t,a)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,o=(e,r,t)=>new Promise(((a,d)=>{var o=e=>{try{s(t.next(e))}catch(r){d(r)}},l=e=>{try{s(t.throw(e))}catch(r){d(r)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((t=t.apply(e,r)).next())}));import{B as l}from"./index.ee0a0c33.js";import{B as s}from"./BasicForm.79466d99.js";import"./helper.ec3e26f3.js";import{u as i}from"./useForm.ee23be26.js";import"./JAddInput.c8a1b05b.js";import{a1 as c,a5 as n,l as b,F as u,bH as p,L as m,o as v,t as g,v as f,V as j,z as y,y as h,B as D,C as U,u as S}from"./index.b3c93d64.js";const q={1:{dbDriver:"com.mysql.jdbc.Driver"},4:{dbDriver:"com.mysql.cj.jdbc.Driver"},2:{dbDriver:"oracle.jdbc.OracleDriver"},3:{dbDriver:"com.microsoft.sqlserver.jdbc.SQLServerDriver"},5:{dbDriver:"org.mariadb.jdbc.Driver"},6:{dbDriver:"org.postgresql.Driver"},7:{dbDriver:"dm.jdbc.driver.DmDriver"},8:{dbDriver:"com.kingbase8.Driver"},9:{dbDriver:"com.oscar.Driver"},10:{dbDriver:"org.sqlite.JDBC"},11:{dbDriver:"com.ibm.db2.jcc.DB2Driver"},12:{dbDriver:"org.hsqldb.jdbc.JDBCDriver"},13:{dbDriver:"org.apache.derby.jdbc.ClientDriver"},14:{dbDriver:"org.h2.Driver"},15:{dbDriver:""}},w={1:{dbUrl:"jdbc:mysql://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useUnicode=true&useSSL=false"},4:{dbUrl:"jdbc:mysql://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useUnicode=true&useSSL=false&tinyInt1isBit=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai"},2:{dbUrl:"jdbc:oracle:thin:@127.0.0.1:1521:ORCL"},3:{dbUrl:"jdbc:sqlserver://127.0.0.1:1433;SelectMethod=cursor;DatabaseName=jeecgboot"},5:{dbUrl:"jdbc:mariadb://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useSSL=false"},6:{dbUrl:"jdbc:postgresql://127.0.0.1:5432/jeecg-boot"},7:{dbUrl:"jdbc:dm://127.0.0.1:5236/?jeecg-boot&zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=utf-8"},8:{dbUrl:"jdbc:kingbase8://127.0.0.1:54321/jeecg-boot"},9:{dbUrl:"jdbc:oscar://192.168.1.125:2003/jeecg-boot"},10:{dbUrl:"jdbc:sqlite://opt/test.db"},11:{dbUrl:"jdbc:db2://127.0.0.1:50000/jeecg-boot"},12:{dbUrl:"jdbc:hsqldb:hsql://127.0.0.1/jeecg-boot"},13:{dbUrl:"jdbc:derby://127.0.0.1:1527/jeecg-boot"},14:{dbUrl:"jdbc:h2:tcp://127.0.0.1:8082/jeecg-boot"},15:{dbUrl:""}},T=[{title:"数据源名称",dataIndex:"name",width:200,align:"left"},{title:"数据库类型",dataIndex:"dbType_dictText",width:200},{title:"驱动类",dataIndex:"dbDriver",width:200},{title:"数据源地址",dataIndex:"dbUrl"},{title:"用户名",dataIndex:"dbUsername",width:200}],x=[{field:"name",label:"数据源名称",component:"Input",colProps:{span:8}},{field:"dbType",label:"数据库类型",component:"JDictSelectTag",colProps:{span:8},componentProps:()=>({dictCode:"database_type"})}],I=[{field:"id",label:"id",component:"Input",show:!1},{field:"code",label:"数据源编码",component:"Input",required:!0,dynamicDisabled:({values:e})=>!!e.id},{field:"name",label:"数据源名称",component:"Input",required:!0},{field:"dbType",label:"数据库类型",component:"JDictSelectTag",required:!0,componentProps:({formModel:e})=>({dictCode:"database_type",onChange:r=>{e=Object.assign(e,q[r],w[r])}})},{field:"dbDriver",label:"驱动类",required:!0,component:"Input"},{field:"dbUrl",label:"数据源地址",required:!0,component:"Input"},{field:"dbUsername",label:"用户名",required:!0,component:"Input"},{field:"dbPassword",label:"密码",required:!0,component:"InputPassword",slot:"pwd"},{field:"remark",label:"备注",component:"InputTextArea"}],P="sys/dataSource/exportXls",_="sys/dataSource/importExcel",O=e=>c.get({url:"/sys/dataSource/list",params:e}),B=(e,r)=>c.delete({url:"/sys/dataSource/delete",data:e},{joinParamsToUrl:!0}).then((()=>{r()})),C=(e,r)=>{n.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>c.delete({url:"/sys/dataSource/deleteBatch",data:e},{joinParamsToUrl:!0}).then((()=>{r()}))})},F=U("测试"),L=b({__name:"DataSourceModal",emits:["register","success"],setup(e,{emit:n}){const{createMessage:b}=S(),U=u(!0),[q,{getFieldsValue:w,resetFields:T,validateFields:x,setFieldsValue:P,validate:_}]=i({schemas:I,showActionButtonGroup:!1}),[O,{setModalProps:B,closeModal:C}]=p((e=>o(this,null,(function*(){var o;yield T(),B({confirmLoading:!1}),U.value=!!(null==e?void 0:e.isUpdate),m(U)&&(e.record=yield(o={id:e.record.id},c.get({url:"/sys/dataSource/queryById",params:o})),yield P(((e,o)=>{for(var l in o||(o={}))t.call(o,l)&&d(e,l,o[l]);if(r)for(var l of r(o))a.call(o,l)&&d(e,l,o[l]);return e})({},e.record)))})))),L=v((()=>m(U)?"编辑数据源":"新增数据源"));function k(){return o(this,null,(function*(){let e=["dbType","dbDriver","dbUrl","dbName","dbUsername","dbPassword"],r=w(e);e.forEach((e=>({value:r[e],errors:null}))),yield x(e).then((e=>{let r=b.loading("连接中....",0);var t;(t=e,c.post({url:"/online/cgreport/api/testConnection",params:t})).then((e=>{e.success&&b.success("连接成功")})).catch((e=>{})).finally((()=>r()))}))}))}function E(e){return o(this,null,(function*(){try{let e=yield _();B({confirmLoading:!0}),yield((e,r)=>{let t=r?"/sys/dataSource/edit":"/sys/dataSource/add";return c.post({url:t,params:e})})(e,U.value),C(),n("success")}finally{B({confirmLoading:!1})}}))}return(e,r)=>{const t=g("a-input-password"),a=g("a-col"),d=g("a-button"),o=g("a-row");return f(),j(m(l),D(e.$attrs,{onRegister:m(O),title:m(L),onOk:E,width:"40%"}),{default:y((()=>[h(m(s),{onRegister:m(q)},{pwd:y((({model:e,field:r})=>[h(o,{gutter:8},{default:y((()=>[h(a,{sm:15,md:16,lg:17,xl:19},{default:y((()=>[h(t,{value:e[r],"onUpdate:value":t=>e[r]=t,placeholder:"请输入密码"},null,8,["value","onUpdate:value"])])),_:2},1024),h(a,{sm:9,md:7,lg:7,xl:5},{default:y((()=>[h(d,{type:"primary",style:{width:"100%"},onClick:k},{default:y((()=>[F])),_:1})])),_:1})])),_:2},1024)])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});var k=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{k as D,L as _,P as a,_ as b,T as c,B as d,C as e,O as g,x as s};
