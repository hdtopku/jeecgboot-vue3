var J=Object.defineProperty,W=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var F=(a,t,i)=>t in a?J(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,I=(a,t)=>{for(var i in t||(t={}))Z.call(t,i)&&F(a,i,t[i]);if(D)for(var i of D(t))ee.call(t,i)&&F(a,i,t[i]);return a},T=(a,t)=>W(a,Y(t));var d=(a,t,i)=>new Promise((g,x)=>{var B=p=>{try{_(i.next(p))}catch(m){x(m)}},R=p=>{try{_(i.throw(p))}catch(m){x(m)}},_=p=>p.done?g(p.value):Promise.resolve(p.value).then(B,R);_((i=i.apply(a,t)).next())});import te from"./BasicTable.1f9db63f.js";import{T as ne}from"./componentMap.402f8d06.js";import"./BasicTable.vue_vue_type_style_index_0_lang.7002ba29.js";import"./TableImg.vue_vue_type_style_index_0_lang.e550a269.js";import{l as oe,c as ie,s as le,g as ae,a as re,_ as se,b as ue,d as pe,e as A,f as ce}from"./CategoryModal.vue_vue_type_script_setup_true_lang.48f3405f.js";import"./index.942ae64c.js";import{j as M,C as de,bI as me,r as h,s as L,t as fe,v as r,w as u,y as b,K as l,Q as he,R as ge}from"./index.241c886f.js";import{useListPage as _e}from"./useListPage.5ed5bcb5.js";import"./BasicForm.85dd04b6.js";import"./BasicForm.vue_vue_type_style_index_0_lang.ae157906.js";import"./uniqBy.57f60d92.js";import"./BasicModal.cfab584a.js";import"./useWindowSizeFn.01c7b19f.js";import"./useFormItem.f1fb85ce.js";import"./functional.a3a4ffc3.js";import"./download.21653b1e.js";import"./base64Conver.030fa32c.js";import"./index.ba19cec8.js";import"./index.67d46494.js";import"./useCountdown.fad41293.js";import"./JAddInput.2d42a71c.js";import"./areaDataUtil.5ccd89d2.js";import"./api.cd27fbef.js";import"./props.10f1db43.js";import"./index.a2e27c18.js";import"./bem.d4d59b92.js";import"./props.394b99ec.js";import"./useContextMenu.37ec29c7.js";import"./index.63c54a6a.js";import"./onMountedOrActivated.7d12d100.js";import"./index.96da7ff0.js";import"./htmlmixed.4a3ad425.js";import"./vue.93346669.js";/* empty css             */import"./depart.api.4991cabc.js";import"./MinusCircleOutlined.99343ef9.js";import"./JUpload.vue_vue_type_style_index_0_lang.67ed2e27.js";import"./index.5c569bac.js";import"./index.1ca4599c.js";import"./useForm.8e4ea63f.js";import"./index.b05a25ac.js";import"./useContentHeight.77e84762.js";import"./useContentViewHeight.2c1193bb.js";import"./usePageContext.bb3e692a.js";import"./RedoOutlined.507a2036.js";import"./useTable.5cd37444.js";const Ce=M({name:"system-category"}),mt=M(T(I({},Ce),{setup(a){const t=de([]),[i,{openModal:g}]=me(),{prefixCls:x,onExportXls:B,onImportXls:R,tableContext:_}=_e({designScope:"category-template",tableProps:{title:"\u5206\u7C7B\u5B57\u5178",api:oe,columns:ie,actionColumn:{width:180},formConfig:{schemas:le}},exportConfig:{name:"\u5206\u7C7B\u5B57\u5178\u5217\u8868",url:ae},importConfig:{url:re}}),[p,{reload:m,collapseAll:ye,updateTableDataRecord:k,findTableDataRecord:K,getDataSource:U},{rowSelection:j,selectedRowKeys:E}]=_;function N(){g(!0,{isUpdate:!1})}function V(e){return d(this,null,function*(){g(!0,{record:e,isUpdate:!0})})}function P(e){return d(this,null,function*(){yield ce({id:e.id},S)})}function X(){return d(this,null,function*(){const e=E.value.filter(n=>!n.includes("loading"));yield ue({ids:e},S)})}function S(){(E.value=[])&&m()}function H(e){g(!0,{record:e,isUpdate:!1})}function O(y){return d(this,arguments,function*({isUpdate:e,isSubAdd:n,values:o,expandedArr:C}){if(e)k(o.id,o);else if(!o.pid)m();else if(n)yield v(o.pid);else{t.value=[];for(let c of l(C))yield v(c)}})}function Q(e){w(e.items)&&$()}function $(){return d(this,null,function*(){if(l(t).length>0){const e=yield pe({parentIds:l(t).join(",")});if(e.success&&e.result.records.length>0){let n=e.result.records;const o=new Map;for(let c of n){let s=c.pid;if(l(t).includes(s)){let f=o.get(s);f==null&&(f=[]),f.push(c),o.set(s,f)}}let C=o,y=c=>{c&&c.forEach(s=>{l(t).includes(s.id)&&(s.children=w(C.get(s.id)),y(s.children))})};y(U())}}})}function w(e){if(e&&e.length>0)return e.map(n=>{if(n.hasChild=="1"){let o={id:n.id+"_loadChild",name:"loading...",isLoading:!0};n.children=[o]}return n})}function q(e,n){return d(this,null,function*(){if(e){if(t.value.push(n.id),n.children.length>0&&!!n.children[0].isLoading){let o=yield A({pid:n.id});o&&o.length>0?n.children=w(o):(n.children=null,n.hasChild="0")}}else{let o=t.value.indexOf(n.id);o>=0&&t.value.splice(o,1)}})}function v(e){return d(this,null,function*(){let n=K(e);t.value.includes(e)||t.value.push(e);let o=yield A({pid:e});o&&o.length>0?n.children=w(o):(n.children=null,n.hasChild="0"),k(e,n)})}function z(e){return[{label:"\u7F16\u8F91",onClick:V.bind(null,e)},{label:"\u5220\u9664",popConfirm:{title:"\u786E\u5B9A\u5220\u9664\u5417?",confirm:P.bind(null,e)}},{label:"\u6DFB\u52A0\u4E0B\u7EA7",onClick:H.bind(null,{pid:e.id})}]}return(e,n)=>{const o=h("a-button"),C=h("j-upload-button"),y=h("Icon"),c=h("a-menu-item"),s=h("a-menu"),f=h("a-dropdown");return L(),fe("div",null,[r(l(te),{onRegister:l(p),rowSelection:l(j),expandedRowKeys:t.value,onExpand:q,onFetchSuccess:Q},{tableTitle:u(()=>[r(o,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:u(()=>[b(" \u65B0\u589E")]),_:1}),r(o,{type:"primary",preIcon:"ant-design:export-outlined",onClick:l(B)},{default:u(()=>[b(" \u5BFC\u51FA")]),_:1},8,["onClick"]),r(C,{type:"primary",preIcon:"ant-design:import-outlined",onClick:l(R)},{default:u(()=>[b("\u5BFC\u5165")]),_:1},8,["onClick"]),l(E).length>0?(L(),he(f,{key:0},{overlay:u(()=>[r(s,null,{default:u(()=>[r(c,{key:"1",onClick:X},{default:u(()=>[r(y,{icon:"ant-design:delete-outlined"}),b(" \u5220\u9664 ")]),_:1})]),_:1})]),default:u(()=>[r(o,null,{default:u(()=>[b("\u6279\u91CF\u64CD\u4F5C "),r(y,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):ge("",!0)]),action:u(({record:G})=>[r(l(ne),{actions:z(G)},null,8,["actions"])]),_:1},8,["onRegister","rowSelection","expandedRowKeys"]),r(se,{onRegister:l(i),onSuccess:O},null,8,["onRegister"])])}}}));export{mt as default};
