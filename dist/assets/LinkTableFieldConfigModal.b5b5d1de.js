import{B as e}from"./index.12c6f6d1.js";import{B as t}from"./BasicForm.fb9b9310.js";import"./helper.c50e6850.js";import{u as i}from"./useForm.5a9ed278.js";import"./JAddInput.2ba637e0.js";import{f0 as o,F as a,bH as n,t as r,v as s,V as l,z as d,y as c,B as p,a1 as m,u}from"./index.b2c24a42.js";import{o as f}from"./omit.d6518a29.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import"./_baseClone.a8082016.js";import"./_arrayPush.8821345e.js";import"./_flatRest.ff1861ce.js";import"./BasicModal.c95a44ff.js";import"./useWindowSizeFn.6c0c5931.js";import"./uniqBy.be1d69f1.js";import"./useFormItem.9110ec70.js";import"./functional.d6fe070d.js";import"./download.0dd0b191.js";import"./base64Conver.030fa32c.js";import"./index.de682914.js";import"./index.fb0e3f73.js";import"./useCountdown.cfa41944.js";import"./JUpload.152dd3a7.js";import"./api.e26748d3.js";import"./index.be1c9e2b.js";import"./props.4a0f18d3.js";import"./index.27a29657.js";import"./bem.a0439036.js";import"./props.d4c4f199.js";import"./useContextMenu.0c34a59e.js";import"./index.9872fa51.js";import"./onMountedOrActivated.bfdd028b.js";import"./index.d802f44f.js";import"./htmlmixed.8e042aa6.js";import"./vue.bbfa1b85.js";/* empty css             */import"./depart.api.2d5bb309.js";import"./_baseSlice.23bb44df.js";var b=Object.defineProperty,j=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,h=(e,t,i)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,v=(e,t,i)=>new Promise(((o,a)=>{var n=e=>{try{s(i.next(e))}catch(t){a(t)}},r=e=>{try{s(i.throw(e))}catch(t){a(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,r);s((i=i.apply(e,t)).next())}));var x=o({name:"LinkTableFieldConfigModal",emits:["success","register"],components:{BasicModal:e,BasicForm:t},setup(e,{emit:t}){const o=a(!1),r=a([]),s=a([]);let l={},d={};const{createMessage:c}=u(),[p,{closeModal:b}]=n((e=>v(this,null,(function*(){d=((e,t)=>{for(var i in t||(t={}))g.call(t,i)&&h(e,i,t[i]);if(j)for(var i of j(t))y.call(t,i)&&h(e,i,t[i]);return e})({},e.record),l=e.tableAndFieldsMap,yield function(){return v(this,null,(function*(){let e=Object.keys(l);if(e&&0!=e.length){let t=[];for(let i of e)t.push({text:l[i].title,value:i});r.value=t}else r.value=[]}))}(),yield T({dictTable:e.record.dictTable}),setTimeout((()=>v(this,null,(function*(){let t=f(e.record,"dictTable");yield T(t),yield C()}))),200)}))));const x=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"字段描述",field:"dbFieldTxt",component:"Input",required:!0},{label:"关联记录",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({async:!1,popContainer:".link-table-field-config-modal",dictOptions:r.value,immediateChange:!0,onChange:t=>v(this,null,(function*(){d.dictText&&(yield e.setFieldsValue({dictText:""}),yield e.clearValidate()),function(e){v(this,null,(function*(){if(e){const{table:t,fields:i}=l[e];if(!t)return void c.warning("请先完善字段["+e+"]关联记录的配置");const o="/online/cgform/field/listByHeadCode",a=yield m.get({url:o,params:{headCode:t}});if(a&&a.length>0){let e=a.map((e=>({text:e.dbFieldTxt,value:e.dbFieldName}))),t=i.split(",");s.value=e.filter((e=>t.indexOf(e.value)>0))}else s.value=[]}}))}(t)}))})},{label:"显示字段",field:"dictText",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-field-config-modal",dictOptions:s,onChange:e=>{d.dictText=e}}}],[F,{validate:w,setFieldsValue:T,clearValidate:C}]=i({schemas:x,showActionButtonGroup:!1,labelAlign:"right"});return{registerModal:p,spinningLoading:o,registerForm:F,handleSubmit:function(){return v(this,null,(function*(){const e=yield w();t("success",e),b()}))}}}},[["render",function(e,t,i,o,a,n){const m=r("BasicForm"),u=r("a-spin"),f=r("BasicModal");return s(),l(f,p({wrapClassName:"link-table-field-config-modal"},e.$attrs,{title:"他表字段配置",onRegister:o.registerModal,keyboard:"",canFullscreen:!1,cancelText:"关闭",onOk:o.handleSubmit}),{default:d((()=>[c(u,{spinning:o.spinningLoading},{default:d((()=>[c(m,{onRegister:o.registerForm},null,8,["onRegister"])])),_:1},8,["spinning"])])),_:1},16,["onRegister","onOk"])}]]);export{x as default};
