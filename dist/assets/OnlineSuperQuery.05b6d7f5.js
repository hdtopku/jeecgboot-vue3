import{y as l,au as he,eY as Fe,ci as be,eQ as Ee,b6 as Ce,bH as De,F as T,H as ae,t as d,v as S,x as ie,aV as g,V as I,z as n,C as m,W as Oe,E as se,R as ce,S as de,aw as fe,bb as we,D as Se,fb as ke,a7 as pe,bG as Be,b3 as Te,dK as Ae,fc as ee,ab as me,a5 as Me,u as ye,dl as Ve,dm as xe}from"./index.b3d2a891.js";import{B as Ie}from"./index.2d23bddf.js";import{c as Re,F as Pe}from"./FormSchemaFactory.9ae4ff2e.js";import{_ as je}from"./OnlineSuperQueryValComponent.vue_vue_type_script_lang.a779f33b.js";import"./JUpload.7bcd35c5.js";import"./JUploadModal.bcdb9954.js";import"./helper.1b3fdfba.js";import"./toString.cf909882.js";import"./isArray.40a4ed15.js";import{M as He}from"./JAddInput.43004d14.js";import"./BasicModal.7efd78fc.js";import"./useWindowSizeFn.ab02708a.js";import"./_baseSlice.23bb44df.js";import"./api.1d3c1927.js";import"./functional.4d8eb9e7.js";import"./useFormItem.c06072f5.js";import"./download.2189cbe2.js";import"./base64Conver.030fa32c.js";import"./index.ea39cbd7.js";import"./index.792f7f1c.js";import"./useCountdown.a4eb9495.js";import"./index.96560ef2.js";import"./props.eccfb3be.js";import"./index.7afb8201.js";import"./bem.8fd44f61.js";import"./props.9df65a00.js";import"./useContextMenu.2f0b587d.js";import"./index.bc22d773.js";import"./onMountedOrActivated.12413c39.js";import"./index.bcdb3c55.js";import"./htmlmixed.6d768be1.js";import"./vue.1e0c6574.js";/* empty css             */import"./depart.api.7ce3d710.js";var ze={icon:function(o,u){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 144H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm52-668H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z",fill:o}},{tag:"path",attrs:{d:"M212 212h200v200H212zm400 0h200v200H612zM212 612h200v200H212zm400 0h200v200H612z",fill:u}}]}},name:"appstore",theme:"twotone"},Qe=ze;function ve(c){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?Object(arguments[o]):{},e=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(u).filter(function(_){return Object.getOwnPropertyDescriptor(u,_).enumerable}))),e.forEach(function(_){Ne(c,_,u[_])})}return c}function Ne(c,o,u){return o in c?Object.defineProperty(c,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[o]=u,c}var ne=function(o,u){var e=ve({},o,u.attrs);return l(he,ve({},e,{icon:Qe}),null)};ne.displayName="AppstoreTwoTone";ne.inheritAttrs=!1;var qe=ne,Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},Ue=Le;function _e(c){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?Object(arguments[o]):{},e=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(u).filter(function(_){return Object.getOwnPropertyDescriptor(u,_).enumerable}))),e.forEach(function(_){Je(c,_,u[_])})}return c}function Je(c,o,u){return o in c?Object.defineProperty(c,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[o]=u,c}var oe=function(o,u){var e=_e({},o,u.attrs);return l(he,_e({},e,{icon:Ue}),null)};oe.displayName="FileTextOutlined";oe.inheritAttrs=!1;var We=oe;const Ye="JSuperQuerySaved_";function Ge(){const{createMessage:c}=ye(),o=T(),u=pe({values:[]}),e=T("and"),[_,{setModalProps:$}]=Be(()=>{$({confirmLoading:!1})}),R=Object.assign({},{link_down:"text"},Re);function L(){console.log("handleSubmit",u.values)}function F(){}function U(t,a,s){console.log("setFormModel",t,a),s.val=a}const O=T({}),k=T([]);function P(t){let{allFields:a,treeData:s}=i(t);O.value=a,k.value=s}function v(t){let a={field:void 0,rule:"eq",val:"",key:ee(16)};t===!1?(u.values=[],u.values.push(a)):t===!0?u.values.length==0&&u.values.push(a):u.values.splice(++t,0,a)}function j(t){let a=me(u.values),s=-1;for(let r=0;r<a.length;r++)if(t.key==a[r].key){s=r;break}s!=-1&&u.values.splice(s,1)}const w={field:"val",label:"\u6D4B\u8BD5",component:"Input"};function A(t,a){let r=O.value[t.field];if(!r)return w;R[r.view]&&(r.view=R[r.view]);let f=Pe.createFormSchema(t.field,r);f.noChange(),f.asSearchForm(),f.updateField(t.field+a);const E=b=>{t.val=b[t.field]};return f.setFunctionForFieldValue(E),f.getFormItemSchema()}const M=T(""),B=Te(),y=pe({visible:!1,title:"",content:"",saveCode:""}),V=T(!1),H=Ae();ae(()=>H.fullPath,t=>{console.log("fullpath",t),z()});const h=T([]);ae(()=>h.value,t=>{let a=[];t&&t.length>0&&t.map(s=>{let r=ee(16);a.push({title:s.title,slots:{icon:"custom"},value:r})}),M.value=a},{immediate:!0,deep:!0});function z(){let t=Ye+H.fullPath;y.saveCode=t;let a=B.get(t);a&&a instanceof Array&&(h.value=a)}z();function J(){let t=Q();if(!t){c.warning("\u7A7A\u6761\u4EF6\u4E0D\u80FD\u4FDD\u5B58");return}let a=JSON.stringify(t);W(a)}function W(t){y.visible=!0,y.title="",y.content=t}function Y(){let{title:t,content:a,saveCode:s}=y,r=x(t);r>=0?Me.confirm({title:"\u63D0\u793A",content:`${t} \u5DF2\u5B58\u5728\uFF0C\u662F\u5426\u8986\u76D6\uFF1F`,okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>{h.value.splice(r,1,{content:a,title:t,type:e.value}),B.set(s,h.value),y.visible=!1}}):(h.value.push({content:a,title:t,type:e.value}),B.set(s,h.value),y.visible=!1)}function x(t){let a=h.value,s=-1;for(let r=0;r<a.length;r++)if(a[r].title==t){s=r;break}return s}function Q(t=!1){let a=u.values;if(!a||a.length==0)return!1;let s=[],r=O.value;for(let f of a)if(f.field&&(f.val||f.val===0)&&f.rule){let E=me(f.val);E instanceof Array&&(E=E.join(","));let D={field:f.field,rule:f.rule,val:E};if(t===!0){let b=r[f.field];b&&(D.type=b.view,D.dbType=b.type)}s.push(D)}return s.length==0?!1:s}function G(t,{node:a}){console.log(t,a);let s=a.dataRef.title,r=h.value.filter(f=>f.title==s);if(r&&r.length>0){let{content:f,type:E}=r[0],D=JSON.parse(f),b=[];for(let N of D)b.push(Object.assign({},{key:ee(16)},N));u.values=b,e.value=E}}function K(t){console.log(t);let a=x(t);a>=0&&(h.value.splice(a,1),B.set(y.saveCode,h.value))}function i(t){const{properties:a,table:s,title:r}=t;let f={},E=1,D=[],b={title:r,value:s,disabled:!0,children:[]};return D.push(b),Object.keys(a).map(N=>{let q=a[N];if(q.view=="table"){let X=q.properties,ge=E*100,le={title:q.title,value:N,disabled:!0,children:[]};Object.keys(X).map(ue=>{let Z=X[ue];Z.order=ge+Z.order;let re=N+","+ue;f[re]=Z,le.children.push({title:Z.title,value:re,isLeaf:!0,order:Z.order})}),p(le),D.push(le),E++}else{let X=s+"@"+N;f[X]=q,b.children.push({title:q.title,value:X,isLeaf:!0,order:q.order})}}),p(b),{allFields:f,treeData:D}}function p(t){t.children.sort(function(s,r){return s.order-r.order})}function C(t){const{params:a,matchType:s}=t;if(a){let r=[];for(let f of a)r.push(Object.assign({},{key:ee(16)},f));u.values=r,s.value=s}}return{formRef:o,init:P,dynamicRowValues:u,matchType:e,registerModal:_,handleSubmit:L,handleCancel:F,handleSave:J,doSaveQueryInfo:Y,saveInfo:y,saveTreeData:M,handleRemoveSaveInfo:K,handleTreeSelect:G,fieldTreeData:k,addOne:v,removeOne:j,setFormModel:U,getSchema:A,loading:V,getQueryInfo:Q,initDefaultValues:C}}const Ke={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1}},components:{BasicModal:Ie,MinusCircleOutlined:He,PlusOutlined:be,OnlineSuperQueryValComponent:je,FileTextOutlined:We,CloseCircleOutlined:Ee,AppstoreTwoTone:qe,Divider:Ce},emits:["search"],setup(c,{emit:o}){const[u,e]=De(),{createMessage:_}=ye();function $(){e.closeModal()}function R(){console.log("handleSubmit",O.values);let p=W(!0);p&&p.length>0?o("search",p,k.value):_.warning("\u7A7A\u6761\u4EF6\u65E0\u6CD5\u67E5\u8BE2\uFF01")}function L(){O.values=[],V(!1),o("search",[],k.value)}const{formRef:F,init:U,dynamicRowValues:O,matchType:k,registerModal:P,handleSave:v,doSaveQueryInfo:j,saveInfo:w,saveTreeData:A,handleTreeSelect:M,handleRemoveSaveInfo:B,fieldTreeData:y,addOne:V,removeOne:H,setFormModel:h,getSchema:z,loading:J,getQueryInfo:W,initDefaultValues:Y}=Ge(),x=T(!1);ae(()=>c.status,p=>{x.value=p},{immediate:!0});function Q(){e.openModal(),V(!0)}function G(){return document.getElementsByClassName("jee-super-query-form")[0]}function K(p){console.log("onfinish",p)}function i(p){p.val=""}return{formRef:F,registerFormModal:u,init:U,handleChangeField:i,dynamicRowValues:O,matchType:k,registerModal:P,handleSubmit:R,handleCancel:$,handleSave:v,handleReset:L,doSaveQueryInfo:j,saveInfo:w,saveTreeData:A,handleTreeSelect:M,handleRemoveSaveInfo:B,fieldTreeData:y,addOne:V,removeOne:H,setFormModel:h,getSchema:z,loading:J,onFinish:K,getPopupContainer:G,superQueryFlag:x,handleOpen:Q,initDefaultValues:Y}}},te=c=>(Ve("data-v-6b47b90c"),c=c(),xe(),c),Xe={class:"j-super-query-button"},Ze=te(()=>g("span",null,"\u5DF2\u6709\u9AD8\u7EA7\u67E5\u8BE2\u6761\u4EF6\u751F\u6548",-1)),$e=te(()=>g("span",null,"\u9AD8\u7EA7\u67E5\u8BE2",-1)),et={style:{float:"left"}},tt={slot:"description"},lt=te(()=>g("span",null,"\u6CA1\u6709\u4EFB\u4F55\u67E5\u8BE2\u6761\u4EF6",-1)),at=te(()=>g("div",null,"\u4FDD\u5B58\u7684\u67E5\u8BE2",-1)),nt=["title"],ot={class:"icon-cancle"},ut={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function rt(c,o,u,e,_,$){const R=d("divider"),L=d("AppstoreTwoTone"),F=d("a-button"),U=d("a-button-group"),O=d("a-tooltip"),k=d("a-divider"),P=d("a-empty"),v=d("a-select-option"),j=d("a-select"),w=d("a-form-item"),A=d("a-col"),M=d("a-row"),B=d("a-tree-select"),y=d("online-super-query-val-component"),V=d("PlusOutlined"),H=d("MinusCircleOutlined"),h=d("a-space"),z=d("a-form"),J=d("close-circle-outlined"),W=d("file-text-outlined"),Y=d("a-tree"),x=d("a-card"),Q=d("BasicModal"),G=d("a-input"),K=d("a-modal");return S(),ie(fe,null,[g("div",Xe,[e.superQueryFlag?(S(),I(O,{key:0,mouseLeaveDelay:.2},{title:n(()=>[Ze,l(R,{type:"vertical",style:{"background-color":"#fff"}}),g("a",{onClick:o[0]||(o[0]=(...i)=>e.handleReset&&e.handleReset(...i))},"\u6E05\u7A7A")]),default:n(()=>[l(U,null,{default:n(()=>[l(F,{type:"primary",onClick:e.handleOpen},{default:n(()=>[l(L,{spin:!0}),$e]),_:1},8,["onClick"])]),_:1})]),_:1},8,["mouseLeaveDelay"])):(S(),I(F,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:e.handleOpen},{default:n(()=>[m(" \u9AD8\u7EA7\u67E5\u8BE2 ")]),_:1},8,["onClick"]))]),(S(),I(ke,{to:"body"},[l(Q,{title:"\u9AD8\u7EA7\u67E5\u8BE2\u6784\u9020\u5668",canFullscreen:!1,width:1050,onRegister:e.registerFormModal,onOk:e.handleSubmit},{footer:n(()=>[g("div",et,[l(F,{loading:e.loading,onClick:e.handleReset},{default:n(()=>[m("\u91CD\u7F6E")]),_:1},8,["loading","onClick"]),l(F,{loading:e.loading,onClick:e.handleSave},{default:n(()=>[m("\u4FDD\u5B58\u67E5\u8BE2\u6761\u4EF6")]),_:1},8,["loading","onClick"])]),l(F,{key:"submit",type:"primary",onClick:e.handleSubmit},{default:n(()=>[m("\u786E\u5B9A")]),_:1},8,["onClick"]),l(F,{key:"back",onClick:e.handleCancel},{default:n(()=>[m("\u5173\u95ED")]),_:1},8,["onClick"])]),default:n(()=>[e.dynamicRowValues.values.length==0?(S(),I(P,{key:0},{default:n(()=>[g("div",tt,[lt,l(k,{type:"vertical"}),g("a",{onClick:o[1]||(o[1]=i=>e.addOne(-1))},"\u70B9\u51FB\u65B0\u589E")])]),_:1})):Oe("",!0),l(M,{class:se("j-super-query-modal-content")},{default:n(()=>[l(A,{sm:24,md:18},{default:n(()=>[ce(l(M,null,{default:n(()=>[l(A,{md:12,xs:24},{default:n(()=>[l(w,{label:"\u8FC7\u6EE4\u6761\u4EF6\u5339\u914D",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:n(()=>[l(j,{value:e.matchType,"onUpdate:value":o[2]||(o[2]=i=>e.matchType=i),getPopupContainer:i=>i.parentNode,style:{width:"100%"}},{default:n(()=>[l(v,{value:"and"},{default:n(()=>[m("AND\uFF08\u6240\u6709\u6761\u4EF6\u90FD\u8981\u6C42\u5339\u914D\uFF09")]),_:1}),l(v,{value:"or"},{default:n(()=>[m("OR\uFF08\u6761\u4EF6\u4E2D\u7684\u4EFB\u610F\u4E00\u4E2A\u5339\u914D\uFF09")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[de,e.dynamicRowValues.values.length>0]]),ce(l(z,{ref:"formRef",class:se("jee-super-query-form"),model:e.dynamicRowValues,onFinish:e.onFinish},{default:n(()=>[(S(!0),ie(fe,null,we(e.dynamicRowValues.values,(i,p)=>(S(),I(h,{key:i.key,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:n(()=>[l(w,{name:["values",p,"field"],style:{width:"180px"}},{default:n(()=>[l(B,{style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5",value:i.field,"onUpdate:value":C=>i.field=C,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},onChange:C=>e.handleChangeField(i),"tree-data":e.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),l(w,{name:["values",p,"rule"],style:{width:"180px"}},{default:n(()=>[l(j,{style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u5339\u914D\u89C4\u5219",value:i.rule,"onUpdate:value":C=>i.rule=C},{default:n(()=>[l(v,{value:"eq"},{default:n(()=>[m("\u7B49\u4E8E")]),_:1}),l(v,{value:"like"},{default:n(()=>[m("\u6A21\u7CCA")]),_:1}),l(v,{value:"right_like"},{default:n(()=>[m("\u4EE5..\u5F00\u59CB")]),_:1}),l(v,{value:"left_like"},{default:n(()=>[m("\u4EE5..\u7ED3\u5C3E")]),_:1}),l(v,{value:"in"},{default:n(()=>[m("\u5728...\u4E2D")]),_:1}),l(v,{value:"ne"},{default:n(()=>[m("\u4E0D\u7B49\u4E8E")]),_:1}),l(v,{value:"gt"},{default:n(()=>[m("\u5927\u4E8E")]),_:1}),l(v,{value:"ge"},{default:n(()=>[m("\u5927\u4E8E\u7B49\u4E8E")]),_:1}),l(v,{value:"lt"},{default:n(()=>[m("\u5C0F\u4E8E")]),_:1}),l(v,{value:"le"},{default:n(()=>[m("\u5C0F\u4E8E\u7B49\u4E8E")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),l(w,{name:["values",p,"val"],style:{width:"280px"}},{default:n(()=>[l(y,{style:{width:"100%"},schema:e.getSchema(i,p),formModel:i,setFormModel:(C,t)=>{e.setFormModel(C,t,i)}},null,8,["schema","formModel","setFormModel"])]),_:2},1032,["name"]),l(w,null,{default:n(()=>[l(F,{onClick:C=>e.addOne(p),style:{"margin-right":"6px"}},{default:n(()=>[l(V)]),_:2},1032,["onClick"]),l(F,{onClick:C=>e.removeOne(i)},{default:n(()=>[l(H)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["model","onFinish"]),[[de,e.dynamicRowValues.values.length>0]])]),_:1}),l(A,{sm:24,md:6},{default:n(()=>[l(x,{class:"j-super-query-history-card",bordered:!0},{title:n(()=>[at]),default:n(()=>[e.saveTreeData.length===0?(S(),I(P,{key:0,class:"j-super-query-history-empty",description:"\u6CA1\u6709\u4FDD\u5B58\u4EFB\u4F55\u67E5\u8BE2"})):(S(),I(Y,{key:1,class:"j-super-query-history-tree",treeData:e.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:e.handleTreeSelect},{title:n(({title:i})=>[g("div",null,[g("span",{title:i},Se(i.length>10?i.substring(0,10)+"...":i),9,nt),g("span",ot,[l(J,{onClick:p=>e.handleRemoveSaveInfo(i)},null,8,["onClick"])])])]),custom:n(()=>[l(W)]),_:1},8,["treeData","onSelect"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["onRegister","onOk"])])),l(K,{title:"\u8BF7\u8F93\u5165\u4FDD\u5B58\u7684\u540D\u79F0",visible:e.saveInfo.visible,onCancel:o[4]||(o[4]=i=>e.saveInfo.visible=!1),onOk:e.doSaveQueryInfo},{default:n(()=>[g("div",ut,[l(G,{value:e.saveInfo.title,"onUpdate:value":o[3]||(o[3]=i=>e.saveInfo.title=i),style:{width:"90%"},placeholder:"\u8BF7\u8F93\u5165\u4FDD\u5B58\u7684\u540D\u79F0"},null,8,["value"])])]),_:1},8,["visible","onOk"])],64)}var Nt=Fe(Ke,[["render",rt],["__scopeId","data-v-6b47b90c"]]);export{Nt as default};
