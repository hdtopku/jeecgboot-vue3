import{B as e}from"./index.e1e06dd6.js";import"./BasicForm.d9f6c231.js";import"./helper.1c9dc9a5.js";import{l as a,F as t,a8 as n,bH as o,bI as s,f0 as i,t as l,v as r,V as c,z as u,y as d,C as m,W as p,u as f}from"./index.435ab247.js";import{k as h}from"./JAddInput.8c125e2c.js";import{u as g}from"./useOnlineTest.be6b6d71.js";import{E as v,u as y}from"./EnhanceJsHistory.252c03e8.js";import{s as j,g as b}from"./enhance.api.098e203b.js";import"./BasicModal.c66de981.js";import"./useWindowSizeFn.3d5b1a05.js";import"./uniqBy.91f18935.js";import"./useFormItem.816007c4.js";import"./functional.be5901d6.js";import"./download.5dc68cfb.js";import"./base64Conver.030fa32c.js";import"./index.a5502478.js";import"./index.64086148.js";import"./useCountdown.adc4ab77.js";import"./JUpload.e164672b.js";import"./api.bc301b0f.js";import"./index.cdc49bf1.js";import"./props.5467b933.js";import"./index.713dc63d.js";import"./bem.0e923c54.js";import"./props.37836c63.js";import"./useContextMenu.82ce6d89.js";import"./index.e1ec35e6.js";import"./onMountedOrActivated.e9ddbd41.js";import"./index.627c6cd3.js";import"./htmlmixed.749cbc8c.js";import"./vue.f62dfd4a.js";/* empty css             */import"./depart.api.c07add53.js";var C=(e,a,t)=>new Promise(((n,o)=>{var s=e=>{try{l(t.next(e))}catch(a){o(a)}},i=e=>{try{l(t.throw(e))}catch(a){o(a)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,i);l((t=t.apply(e,a)).next())}));var J=i(a({name:"EnhanceJs",components:{BasicModal:e,JCodeEditor:h,EnhanceJsHistory:v},emits:["register"],setup(){const{createMessage:e}=f(),a=y(),i=t(),l=t(),r=n({form:{},list:{}}),c=t("list"),u=t(""),d=t(!1),m=t(!1),p=t(""),h=n({form:"",list:""}),v={form:!1,list:!1},J=t(!1),[E,{closeModal:x}]=o((e=>C(this,null,(function*(){!function(e){u.value=e.id,m.value=!1,p.value=e.tableName;let t=a.getEnhanceJs(u.value);(null==t?void 0:t.length)>0?(c.value=t[t.length-1].type,d.value=!0):d.value=!1;v.form=!1,v.list=!1,c.value?R(c.value):R("form");J.value=!0,setTimeout((()=>J.value=!1),150)}(e.row)})))),[T,k]=s(),{aiTestMode:M,genEnhanceJsData:w}=g();function H(e){return C(this,null,(function*(){let t=r[e],n={cgJs:h[e],cgJsType:e};if(!v[e]||t.cgJs===n.cgJs)return;let o=!!t.id;o&&(n=Object.assign({},t,n)),yield j(u.value,n,o),a.addEnhanceJs({code:u.value,str:n.cgJs,type:n.cgJsType,date:(new Date).getTime()})}))}function R(e){return C(this,null,(function*(){c.value=e;try{if(!v[e]){let a=yield b(u.value,e);Object.assign(r[e],{id:null},a),h[e]=r[e].cgJs,v[e]=!0}}catch(a){}setTimeout((()=>{"list"==e?l.value.refresh():i.value.refresh()}),150)}))}return{formEditorRef:i,listEditorRef:l,reloading:J,enhanceValues:h,enhanceType:c,showHistory:d,aiTestMode:M,tableName:p,genEnhanceJsData:w,onGenTestData:function(){"form"===c.value?w(p.value,c.value,i.value):w(p.value,c.value,l.value)},onChangeType:R,onCodeChange:function(e){h[c.value]!=e&&(m.value=!0,h[c.value]=e)},onShowHistory:function(){k.openModal(!0,{code:u.value,type:c.value})},onSubmit:function(){return C(this,null,(function*(){yield Promise.all([H("form"),H("list")]),x(),e.success("保存成功")}))},onCancel:function(){x()},registerModal:E,registerEnhanceJsHistory:T}}}),[["render",function(e,a,t,n,o,s){const i=l("JCodeEditor"),f=l("a-tab-pane"),h=l("a-tabs"),g=l("a-button"),v=l("a-space"),y=l("EnhanceJsHistory"),j=l("BasicModal");return r(),c(j,{onRegister:e.registerModal,title:"JS增强",width:800,bodyStyle:{height:"360px"}},{footer:u((()=>[d(v,null,{default:u((()=>[d(g,{onClick:e.onCancel},{default:u((()=>[m("关闭")])),_:1},8,["onClick"]),d(g,{type:"primary",onClick:e.onSubmit},{default:u((()=>[m("确定")])),_:1},8,["onClick"])])),_:1}),d(v,{style:{float:"left"}},{default:u((()=>[e.showHistory?(r(),c(g,{key:0,onClick:e.onShowHistory},{default:u((()=>[m("查看历史版本")])),_:1},8,["onClick"])):p("",!0),e.aiTestMode?(r(),c(g,{key:1,onClick:e.onGenTestData},{default:u((()=>[m("生成测试数据")])),_:1},8,["onClick"])):p("",!0)])),_:1})])),default:u((()=>[d(h,{activeKey:e.enhanceType,"onUpdate:activeKey":a[2]||(a[2]=a=>e.enhanceType=a),onChange:e.onChangeType},{default:u((()=>[d(f,{tab:"form",key:"form",forceRender:""},{default:u((()=>[e.reloading?p("",!0):(r(),c(i,{key:0,ref:"formEditorRef",value:e.enhanceValues.form,"onUpdate:value":a[0]||(a[0]=a=>e.enhanceValues.form=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1}),d(f,{tab:"list",key:"list",forceRender:""},{default:u((()=>[e.reloading?p("",!0):(r(),c(i,{key:0,ref:"listEditorRef",value:e.enhanceValues.list,"onUpdate:value":a[1]||(a[1]=a=>e.enhanceValues.list=a),language:"javascript",fullScreen:!0,lineNumbers:!1,height:"240px","language-change":!1,onChange:e.onCodeChange},null,8,["value","onChange"]))])),_:1})])),_:1},8,["activeKey","onChange"]),d(y,{onRegister:e.registerEnhanceJsHistory},null,8,["onRegister"])])),_:1},8,["onRegister"])}]]);export{J as default};
