import{l as e,a7 as s,s as a,dY as l,dZ as o,d7 as i,F as n,a8 as t,o as r,L as c,e2 as m,v as u,x as d,y as f,z as p,aB as g,cI as y,C as v,D as b,ax as x,W as h,ac as k,d8 as _,d$ as C,u as F,e0 as L}from"./index.b2c24a42.js";import{C as S}from"./index.fb0e3f73.js";import j from"./LoginFormTitle.76a6cde8.js";import"./useCountdown.cfa41944.js";import"./useFormItem.9110ec70.js";const z=e({__name:"MobileForm",setup(e){const z=s.Item,{t:I}=a(),{handleBackLogin:w,getLoginState:B}=l(),{getFormRules:E}=o(),{notification:M,createErrorModal:R}=F(),T=i(),D=n(),O=n(!1),P=t({mobile:"",sms:""}),{validForm:$}=L(D),A=r((()=>c(B)===m.MOBILE));function U(){return e=this,s=null,a=function*(){const e=yield $();if(e)try{O.value=!0;const s=yield T.phoneLogin(k({mobile:e.mobile,captcha:e.sms,mode:"none"}));s&&M.success({message:I("sys.login.loginSuccessTitle"),description:`${I("sys.login.loginSuccessDesc")}: ${s.realname}`,duration:3})}catch(s){M.error({message:I("sys.api.errorTip"),description:s.message||I("sys.api.networkExceptionMsg"),duration:3})}finally{O.value=!1}},new Promise(((l,o)=>{var i=e=>{try{t(a.next(e))}catch(s){o(s)}},n=e=>{try{t(a.throw(e))}catch(s){o(s)}},t=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,n);t((a=a.apply(e,s)).next())}));var e,s,a}function W(){return _({mobile:P.mobile,smsmode:C.FORGET_PASSWORD})}return(e,a)=>c(A)?(u(),d(x,{key:0},[f(j,{class:"enter-x"}),f(c(s),{class:"p-4 enter-x",model:P,rules:c(E),ref_key:"formRef",ref:D},{default:p((()=>[f(c(z),{name:"mobile",class:"enter-x"},{default:p((()=>[f(c(g),{size:"large",value:P.mobile,"onUpdate:value":a[0]||(a[0]=e=>P.mobile=e),placeholder:c(I)("sys.login.mobile"),class:"fix-auto-fill"},null,8,["value","placeholder"])])),_:1}),f(c(z),{name:"sms",class:"enter-x"},{default:p((()=>[f(c(S),{size:"large",class:"fix-auto-fill",value:P.sms,"onUpdate:value":a[1]||(a[1]=e=>P.sms=e),placeholder:c(I)("sys.login.smsCode"),sendCodeApi:W},null,8,["value","placeholder"])])),_:1}),f(c(z),{class:"enter-x"},{default:p((()=>[f(c(y),{type:"primary",size:"large",block:"",onClick:U,loading:O.value},{default:p((()=>[v(b(c(I)("sys.login.loginButton")),1)])),_:1},8,["loading"]),f(c(y),{size:"large",block:"",class:"mt-4",onClick:c(w)},{default:p((()=>[v(b(c(I)("sys.login.backSignIn")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])],64)):h("",!0)}});export{z as default};
