import{E as V,d as he}from"./FormSchemaFactory.9ae4ff2e.js";import{F as y,dK as Ee,J as Fe,bH as k,a7 as se,ab as $,r as Be,f6 as ye,a1 as P,a5 as De,as as de,fe as we,ff as ve,fg as Pe,fh as Oe,fc as Se,u as ge,b4 as Ce,Q as le,at as be}from"./index.b3d2a891.js";import{onMountedOrActivated as _e}from"./onMountedOrActivated.12413c39.js";import"./index.2d23bddf.js";import{p as Re}from"./pick.dbff1c58.js";var Me=Object.defineProperty,Te=Object.defineProperties,Ae=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,ce=(r,i,c)=>i in r?Me(r,i,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[i]=c,C=(r,i)=>{for(var c in i||(i={}))Ie.call(i,c)&&ce(r,c,i[c]);if(ie)for(var c of ie(i))Ue.call(i,c)&&ce(r,c,i[c]);return r},fe=(r,i)=>Te(r,Ae(i)),z=(r,i,c)=>new Promise((D,f)=>{var F=p=>{try{m(c.next(p))}catch(d){f(d)}},E=p=>{try{m(c.throw(p))}catch(d){f(d)}},m=p=>p.done?D(p.value):Promise.resolve(p.value).then(F,E);m((c=c.apply(r,i)).next())});const Ne={vue:we,"@":{hooks:{useMessage:ve},utils:{axios:Pe,cache:Oe}}};function ke(r,i){const c=Object.assign({},Ne,r);function D(E){if(E!=null&&E!=""){let m=E.toString().split("/"),p=c[m[0]];for(let d=1;d<m.length;d++)p=p[m[d]];return p}return null}function f(){}function F(E){let m=Se(6);const d=`return function (customImport, ${"__export_"+m}) {"use strict"; ${E}}`;console.group("executeJsEnhanced"),console.log(d),console.groupEnd(),new Function(d)().call(i,D,f)}return{executeJsEnhanced:F}}const $e={acceptHrefParams:"<p> \u8DF3\u8F6C\u65F6\u83B7\u53D6\u7684\u53C2\u6570\u4FE1\u606F",currentPage:"<p> \u5F53\u524D\u9875\u6570",currentTableName:"<p> \u5F53\u524D\u8868\u540D",description:"<p> \u5F53\u524D\u8868\u63CF\u8FF0",hasChildrenField:"<p> \u662F\u5426\u6709\u5B50\u8282\u70B9\u7684\u5B57\u6BB5\u540D\uFF0C\u4EC5\u6811\u5F62\u8868\u5355\u4E0B\u6709\u6548",isDesForm:"<p> xx",isTree:"<m> \u662F\u5426\u662F\u6811\u5F62\u8868\u5355 ",loadData:"<m> \u52A0\u8F7D\u5217\u8868\u6570\u636E",pageSize:"<p> \u6BCF\u4E00\u9875\u663E\u793A\u6761\u6570",queryParam:"<p> \u67E5\u8BE2\u6761\u4EF6\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u70B9\u51FB\u67E5\u8BE2\u540E\u624D\u4F1A\u66F4\u65B0\u6B64\u6570\u636E",selectedRowKeys:"<p> \u9009\u4E2D\u7684\u884C\u7684id\u6570\u7EC4",sortField:"<p> \u6392\u5E8F\u5B57\u6BB5",sortType:"<p> \u6392\u5E8F\u89C4\u5219",total:"<p> \u603B\u9875\u6570"},xe={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess"};let Qe={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const je={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(r,i)=>i[0]+"-"+i[1]+" \u5171"+r+"\u6761",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:N,createErrorModal:Le}=ge(),He=/(?:\/\*[\s\S]*?\*\/|\/\/.*?\r?\n|[^{])+\{([\s\S]*)\}$/;function qe(){console.log("-------------------------useOnlineTableContext----------------------->");const r=y(""),i=Ee(),c=y(),D=y(),f=y(!1),F=y([]),E=y(!0),m=y();let p={};const d={execButtonEnhance:function(t,n){if(s[V][t])if(he===t)b(t);else{let e=$(n);return s[V][t].call(s,s,e)}else s[V][t+"_hook"]?b(t+"_hook"):console.log("\u589E\u5F3A\u6CA1\u627E\u5230!",t)},isTree:function(t){return typeof t=="boolean"?(s.isTreeTable=t,t):s.isTreeTable}};function b(t){let e=s[V][t].toLocaleString().match(He);if(e.length>1){let u=e[1];B(u)}}const s=new Proxy($e,{get(t,n){if(typeof d[n]=="function")return d[n];{let e=p[r.value];return Reflect.get(e,n)}},set(t,n,e){let u=_();return Reflect.set(typeof e=="function"?d:u,n,e)},deleteProperty(t,n){return n===r.value?(delete p[n],!0):!1}}),{executeJsEnhanced:B}=ke({},s);function O(){let t=i.params.id;return t||(t=""),t}_e(()=>{console.log("-------------------onMountedOrActivated-------------------"),J()}),Fe(()=>{console.log("-------------------onBeforeUnmount-------------------"),delete p[r.value]});function _(){let t=p[r.value];if(!t){let n=Object.assign({},Qe,{onlineUrl:xe});t=JSON.parse(JSON.stringify(n)),p[r.value]=t}return t}function X(){let t={},n=i.query;n&&(Object.keys(n).map(e=>{t[e]=n[e]}),s.acceptHrefParams=t)}function q(){return new Promise((t,n)=>{P.get({url:`${s.onlineUrl.getColumns}${r.value}`},{isTransformResponse:!1}).then(e=>{e.success?t(e.result):(N.warning(e.message),n())}).catch(()=>{n()})})}function S(){return new Promise((t,n)=>{let e=`${s.onlineUrl.getData}${r.value}`;s.isTree()===!0&&(e=`${s.onlineUrl.getTreeData}${r.value}`);let u=R();console.log("------\u67E5\u8BE2\u53C2\u6570-----",u),P.get({url:e,params:u},{isTransformResponse:!1}).then(a=>{console.log("--onlineList-\u67E5\u8BE2\u5217\u8868\u6570\u636E",a),a.success?(x(a.result),t(!0)):(a.message==="NO_DB_SYNC"?Le({title:"\u6570\u636E\u5E93\u672A\u540C\u6B65",content:"\u8BF7\u5148\u540C\u6B65\u6570\u636E\u5E93\u518D\u67E5\u770B\u6B64\u9875\u9762\uFF01",onOk:()=>Ce.back()}):N.warning(a.message),n(!1))}).catch(()=>{let a="\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";N.warning(a),n(!1)})})}function R(){const{sortField:t,sortType:n,acceptHrefParams:e,queryParam:u}=s;let a={};s.isTree()===!0?a.hasQuery="false":a.hasQuery="true";let o=Object.assign({},a,e,u,{column:t,order:n});f.value?(o.pageNo=f.value.current,o.pageSize=f.value.pageSize):o.pageSize=-521;let l=L();return o.superQueryMatchType=l.matchType||"",o.superQueryParams=l.params||"",de(o)}function x(t){let n=0;Number(t.total)>0?(s.isTree()===!0?(F.value=T(t.records),le(()=>{j(F.value)})):F.value=t.records,n=Number(t.total)):F.value=[],f.value&&(f.value=fe(C({},f.value),{total:n}))}function G(t,n,e){e&&e.order?(s.sortField=e.field,s.sortType=e.order=="ascend"?"asc":"desc"):(s.sortField="id",s.sortType="asc"),f.value&&(f.value=t),S()}function W(t){s.description=t.description,s.currentTableName=t.currentTableName,s.isDesForm=t.isDesForm,s.desFormCode=t.desFormCode,s.ID=r.value;let{acceptHrefParams:n,queryParam:e,superQuery:u,currentPage:a,pageSize:o}=s;X(),e?c.value.initDefaultValues(e,n):s.queryParam={},u?D.value.initDefaultValues(u):s.superQuery={params:"",matchType:""},t.paginationFlag=="Y"?f.value=C(C({},je),{current:a,pageSize:o}):f.value=!1}function Q(){return z(this,null,function*(){E.value=!0,yield le(),E.value=!1})}const M={loadData:S,getLoadDataParams:R,reloadTable:Q};Object.keys(M).map(t=>{s[t]=M[t]});let Y=y(!1);function Z(){return z(this,null,function*(){f.value&&(f.value=fe(C({},f.value),{current:1})),s.clearSelectedRow(),yield S()})}function T(t){if(t)return t.map(n=>{let e=s.hasChildrenField;if(n[e]=="1"){let u={id:n.id+"_loadChild",name:"loading...",isLoading:!0};u.jeecg_row_key=u.id,n.children=[u]}return n})}const A=y([]);function ee(t){A.value=t}function j(t){let n=A.value;if(n.length>0){const{sortField:e,sortType:u,pidField:a}=s;let o=Object.assign({},{column:e,order:u});o.hasQuery="in";let l=Object.assign({});l.rule="in",l.type="text",l.val=n.join(","),l.field=a,l=[l],o.superQueryParams=encodeURI(JSON.stringify(l)),o.superQueryMatchType="and",o.batchFlag="true";let g=`${s.onlineUrl.getTreeData}${r.value}`;console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u53C2\u6570",l),P.get({url:g,params:o},{isTransformResponse:!1}).then(h=>{if(console.log("--onlineList-\u67E5\u8BE2\u5B50\u8282\u70B9\u5217\u8868\u6570\u636E",h),h.success&&h.result.records&&h.result.records.length>0){let w=h.result.records;const ae=new Map;for(let U of w){let v=U[a];if(n.join(",").includes(v)){let K=ae.get(v);K==null&&(K=[]),K.push(U),ae.set(v,K)}}let me=ae,oe=U=>{U&&U.forEach(v=>{n.includes(v.id)&&(v.children=T(me.get(v.id)),oe(v.children))})};oe(t)}}).catch(()=>{let h="loadDataByExpandedRows\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";N.warning(h)})}else return Promise.resolve()}function L(){if(!s.superQuery)return{};const{superQuery:{params:t,matchType:n},currentTableName:e}=s;let u=e+"@",a=[];if(t.length>0)for(let l of t){let g=C({},l),h=g.field;h.startsWith(u)&&(g.field=h.replace(u,"")),a.push(g)}let o=a.length>0?JSON.stringify(a):"";return console.log("\u9AD8\u7EA7\u67E5\u8BE2\u6761\u4EF6",a,n),{params:encodeURIComponent(o),matchType:n}}const I=y(!1);function H(t,n){s.superQuery={params:t,matchType:n},t.length==0?I.value=!1:I.value=!0,S()}const[te,{openModal:ue}]=k();function re(t){if(t||(t={}),!t.row){let n=s.selectedRows;if(!n||n.length==0||n.length>1){N.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E");return}t.row=n[0]}t.code=r.value,ue(!0,t)}s.openCustomModal=re;function J(){let t=O();r.value=t}J();function ne(t){let n=t.head.extConfigJson;n&&(m.value=JSON.parse(n))}return C({ID:r,onlineQueryFormOuter:c,superQueryButtonRef:D,loading:Y,reload:Z,dataSource:F,pagination:f,tableReloading:E,handleSpecialConfig:W,onlineTableContext:s,handleChangeInTable:G,getColumnList:q,getTreeDataByResult:T,expandedRowKeys:A,handleExpandedRowsChange:ee,onlineExtConfigJson:m,handleFormConfig:ne,superQueryStatus:I,handleSuperQuery:H,registerCustomModal:te},M)}const pe="onl_";function Ge(r,i){const c={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[D,{openModal:f}]=k(),[F,{openModal:E}]=k(),[m,{openModal:p}]=k(),[d,{openModal:b}]=k(),{createMessage:s}=ge(),B=se(c),O=se([]),_=se([]);function X(e){if(O.length=0,_.length=0,e&&e.length>0)for(let u=0;u<e.length;u++){let a=Re(e[u],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");a.buttonStyle=="button"?_.push(a):a.buttonStyle=="link"&&O.push(a)}}function q(e){Object.keys(B).forEach(u=>{B[u]=!0}),e&&e.length>0&&Object.keys(B).forEach(u=>{e.indexOf(u)>=0&&(B[u]=!1)})}function S(e){let u={isUpdate:!1};e&&(u.param=e),f(!0,u)}function R(e){r.beforeEdit(e).then(()=>{f(!0,{isUpdate:!0,record:e})}).catch(u=>{s.warning(u)})}const x=e=>({label:"\u5220\u9664",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:G.bind(null,e)}});function G(e){r.beforeDelete(e).then(()=>{L(e.id)}).catch(u=>{s.warning(u)})}function W(e){return $(B.update)===!0?[{label:"\u7F16\u8F91",onClick:R.bind(null,e)}]:[]}function Q(e){return{label:"\u63D0\u4EA4\u6D41\u7A0B",popConfirm:{title:"\u786E\u8BA4\u63D0\u4EA4\u6D41\u7A0B\u5417\uFF1F",confirm:j.bind(null,e)}}}function M(e){return{label:"\u5BA1\u6279\u8FDB\u5EA6",onClick:Y.bind(null,e)}}function Y(e){const{currentTableName:u}=r;let a=pe+u,o=e.id;b(!0,{flowCode:a,dataId:o})}function Z(e){let u=[];if($(B.detail)===!0&&u.push({label:"\u8BE6\u60C5",onClick:A.bind(null,e)}),r.hasBpmStatus===!0&&$(B.bpm)===!0){let o=T(e);!o||o=="1"?u.push(Q(e)):u.push(M(e))}if(i.value){let{reportPrintShow:o,reportPrintUrl:l}=i.value;o&&l&&u.push({label:"\u6253\u5370",onClick(){let g=l,h=e.id,w=Be();ye(g,h,w)}})}$(B.delete)===!0&&u.push(x(e));let a=O;if(a&&a.length>0)for(let o of a)n(o.exp||"",e)===!0&&u.push({label:o.buttonName,onClick:H.bind(null,e,o.buttonCode,o.optType)});return u}function T(e){const u="bpm_status";let a=e[u];return a||(a=e[u.toUpperCase()]),a}function A(e){p(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function ee(e){const{currentTableName:u,onlineUrl:{startProcess:a}}=r;let o={url:a,params:{flowCode:pe+u,id:e.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},l={isTransformResponse:!1};return new Promise((g,h)=>{P.post(o,l).then(w=>{w.success?(g(w),s.success(w.message)):(h(),s.warning(w.message))})})}function j(e){return z(this,null,function*(){yield ee(e),r.loadData()})}function L(e){console.log("\u5220\u9664\u6570\u636Eid\u503C",e);let u=`${r.onlineUrl.optPre}${r.ID}/${e}`;return new Promise((a,o)=>{P.delete({url:u},{isTransformResponse:!1}).then(l=>{l.success?(s.success(l.message),r.loadData(),a(!0)):(s.warning(l.message),o())})})}function I(){let e=r.selectedRowKeys;if(e.length<=0)return s.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u8BB0\u5F55\uFF01"),!1;{let u=[];e.forEach(function(o){let l=o;l&&l.endsWith("_loadChild")&&(l=l.replace("_loadChild","")),u.indexOf(l)<0&&u.push(l)});let a=u.join(",");De.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>z(this,null,function*(){yield L(a),r.clearSelectedRow()})})}}function H(e,u,a){if(a=="js")r.execButtonEnhance(u,e);else if(a=="action"){let o={formId:r.ID,buttonCode:u,dataId:e.id},l=`${r.onlineUrl.buttonAction}`;P.post({url:l,params:o},{isTransformResponse:!1}).then(g=>{g.success?(r.loadData(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(g.message)})}}function te(e){r.execButtonEnhance(e)}function ue(e){let u=r.selectedRowKeys;if(!u||u.length==0)return s.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55"),!1;let a=u.join(","),o={formId:r.ID,buttonCode:e,dataId:a},l=`${r.onlineUrl.buttonAction}`;P.post({url:l,params:o},{isTransformResponse:!1}).then(g=>{g.success?(r.loadData(),r.clearSelectedRow(),s.success("\u5904\u7406\u5B8C\u6210!")):s.warning(g.message)})}function re(){E(!0)}const J=()=>`${r.onlineUrl.importXls}${r.ID}`,{handleExportXlsx:ne}=be();function t(){let e=r.getLoadDataParams(),u=r.selectedRowKeys;u&&u.length>0&&(e.selections=u.join(","));let a=JSON.stringify(de(e)),o=`${r.onlineUrl.exportXls}${r.ID}`;const l=r.description;ne(l,o,{paramsStr:a})}function n(e,u){if(!e||e=="")return!0;let a=e.split("#"),o=u[a[0]],l=a[1].toLowerCase();return l==="eq"?o==a[2]:l==="ne"?o!=a[2]:l==="empty"?a[2]==="true"?!o||o=="":o&&o.length>0:l==="in"?a[2].split(",").indexOf(String(o))>=0:!1}return{buttonSwitch:B,cgLinkButtonList:O,cgTopButtonList:_,importUrl:J,registerModal:D,handleAdd:S,handleEdit:R,handleBatchDelete:I,registerImportModal:F,onImportExcel:re,onExportExcel:t,getDropDownActions:Z,getActions:W,cgButtonJsHandler:te,cgButtonActionHandler:ue,cgButtonLinkHandler:H,initButtonList:X,initButtonSwitch:q,getDeleteButton:x,handleSubmitFlow:j,getSubmitFlowButton:Q,registerDetailModal:m,registerBpmModal:d}}export{Ge as a,qe as u};
