import{B as e}from"./index.12c6f6d1.js";import{l as a,bH as n,m as l,by as t,F as s,L as i,aa as o,o as d,q as r,a1 as u,t as p,v as c,x as f,y as g,z as m,C as h,D as v,aW as b,W as C,B as y,u as k}from"./index.b2c24a42.js";const x=a({name:"JImportModal",components:{BasicModal:e},props:{url:{type:String,default:"",required:!1},biz:{type:String,default:"",required:!1},online:{type:Boolean,default:!1,required:!1}},emits:["ok","register"],setup(e,{emit:a,refs:r}){const{createMessage:p,createWarningModal:c}=k(),[f,{closeModal:g}]=n((e=>{B(e)})),m=l(),h=t(),v=s(!1),b=s([]),C=s(""),y=s(""),x=s(0),L=Object.assign({},i(e),i(h));o((()=>{e.url&&(C.value=`${m.uploadUrl}${e.url}`)}));function S(){g()&&B()}function B(e){b.value=[],v.value=!1,y.value=e,x.value=0}return{register:f,getBindValue:L,uploadDisabled:d((()=>!(i(b).length>0))),fileList:b,uploading:v,validateStatus:x,handleClose:S,handleChangeValidateStatus:function(e){x.value=e?1:0},handleRemove:function(e){const a=i(b).indexOf(e),n=i(b).slice();n.splice(a,1),b.value=n},beforeUpload:function(e){return b.value=[...i(b),e],!1},handleImport:function(){let{biz:n,online:l}=e;const t=new FormData;n&&t.append("isSingleTableImport",n),i(y)&&i(y).length>0&&t.append("foreignKeys",i(y)),l&&t.append("validateStatus",i(x)),i(b).forEach((e=>{t.append("files[]",e)})),v.value=!0;let s={"Content-Type":"multipart/form-data;boundary = "+(new Date).getTime()};u.post({url:e.url,params:t,headers:s},{isTransformResponse:!1}).then((e=>{v.value=!1,e.success?(201==e.code?function(e,a){let n=m.uploadUrl+a;c({title:"导入成功,但是有错误数据!",centered:!1,content:`<div>\n                        <span>${e}</span><br/>\n                        <span>具体详情请<a href = ${n} target="_blank"> 点击下载 </a> </span>\n                      </div>`})}(e.message,e.result):p.success(e.message),S(),B(),a("ok")):p.warning(e.message)}))}}}}),L={key:0,style:{margin:"0 5px 1px"}},S=b("span",{style:{display:"inline-block",height:"32px","line-height":"32px","vertical-align":"middle"}},"是否开启校验:",-1),B={style:{"margin-left":"6px"}},M=h("选择导入文件"),U=h("关闭");var _=r(x,[["render",function(e,a,n,l,t,s){const i=p("a-switch"),o=p("a-button"),d=p("a-upload"),r=p("BasicModal");return c(),f("div",null,[g(r,y(e.$attrs,{onRegister:e.register,title:"导入EXCEL",width:600,onCancel:e.handleClose,confirmLoading:e.uploading,destroyOnClose:""}),{footer:m((()=>[g(o,{onClick:e.handleClose},{default:m((()=>[U])),_:1},8,["onClick"]),g(o,{type:"primary",onClick:e.handleImport,disabled:e.uploadDisabled,loading:e.uploading},{default:m((()=>[h(v(e.uploading?"上传中...":"开始上传"),1)])),_:1},8,["onClick","disabled","loading"])])),default:m((()=>[e.online?(c(),f("div",L,[S,b("span",B,[g(i,{checked:1==e.validateStatus,onChange:e.handleChangeValidateStatus,"checked-children":"是","un-checked-children":"否",size:"small"},null,8,["checked","onChange"])])])):C("",!0),g(d,{name:"file",accept:".xls,.xlsx",multiple:!0,fileList:e.fileList,remove:e.handleRemove,beforeUpload:e.beforeUpload},{default:m((()=>[g(o,{preIcon:"ant-design:upload-outlined"},{default:m((()=>[M])),_:1})])),_:1},8,["fileList","remove","beforeUpload"])])),_:1},16,["onRegister","onCancel","confirmLoading"])])}]]);export{_ as J};
