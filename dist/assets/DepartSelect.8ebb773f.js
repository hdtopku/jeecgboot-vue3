var e=(e,a,l)=>new Promise(((t,s)=>{var n=e=>{try{o(l.next(e))}catch(a){s(a)}},u=e=>{try{o(l.throw(e))}catch(a){s(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,u);o((l=l.apply(e,a)).next())}));import{B as a}from"./index.ee0a0c33.js";import{g as l,h as t}from"./depart.api.429e062c.js";import{c as s}from"./tenant.api.e9076c03.js";import{q as n,l as u,d7 as o,F as r,H as i,t as d,v,V as c,z as f,y as p,E as m,x as g,bc as h,ax as y,W as _,B as b,L as C,C as x,D as k,dp as w,dq as I,aW as j,u as S}from"./index.b3c93d64.js";import"./BasicModal.2a8ad889.js";import"./useWindowSizeFn.e6386ae5.js";const U=e=>(w("data-v-defac4f0"),e=e(),I(),e),z=U((()=>j("span",null,"您隶属于多租户，请选择当前所属租户",-1))),B=x(" 租户 "),F=U((()=>j("span",null,"您隶属于多部门，请选择当前所在部门",-1))),H=x(" 部门 "),L=x("关闭"),M=x("确认");var N=n(u({__name:"DepartSelect",props:{title:{type:String,default:"部门选择"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(n,{expose:u}){const w=n,I=o(),{createMessage:j,notification:U}=S(),N={labelCol:{span:4},wrapperCol:{span:18}},P={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},T=r(""),W=r(!1),q=r(""),D=r(),$=r([]),E=r(""),R=r(!1),V=r(""),A=r(""),G=r([]),J=r(""),K=r(!1);function O(){return e(this,null,(function*(){const e=yield l();if(!e.list||0==e.list.length)return;let a=e.list.filter((a=>a.orgCode==e.orgCode));G.value=e.list,A.value=a&&a.length>0?e.orgCode:"",V.value=a&&a.length>0?a[0].departName:"",R.value=!0}))}function Q(){return e(this,null,(function*(){return C(W)&&!C(D)?(E.value="error",!1):C(R)&&!C(A)?(J.value="error",!1):void function(){return new Promise(((a,l)=>e(this,null,(function*(){if(C(R)){const s=yield t({username:I.getUserInfo.username,orgCode:C(A)});if(s.userInfo){const e=s.userInfo;I.setUserInfo(e),a()}else e=s,U.error({message:"登录失败",description:((e.response||{}).data||{}).message||e.message||"请求出现错误，请稍后再试",duration:4}),I.logout(),l()}else a();var e}))))}().then((()=>{C(W)&&I.setTenant(C(D)),j.success("切换成功")})).catch((e=>{})).finally((()=>{C(W)&&I.setTenant(C(D)),X()}))}))}function X(){T.value="",W.value=!1,q.value="",D.value="",$.value=[],E.value="",R.value=!1,V.value="",A.value="",G.value=[],J.value="",K.value=!1}return i((()=>w.username),(e=>{e&&O()})),u({show:function(){return e(this,null,(function*(){yield O(),yield function(){return e(this,null,(function*(){const e=yield s();if(!e.list||0==e.list.length)return;let a=I.getTenant,l=e.list.filter((e=>e.id==a));q.value=l&&l.length>0?l[0].name:"",$.value=e.list,D.value=a,W.value=!0}))}(),C(W)&&C(R)?T.value="切换租户和部门":C(W)?T.value=C(q)&&C(q).length>0?`租户切换（当前租户 :${C(q)}）`:w.title:C(R)&&(T.value=C(V)&&C(V).length>0?`部门切换（当前部门 :${C(V)}）`:w.title),(C(W)||C(R))&&(K.value=!0)}))}}),(e,l)=>{const t=d("a-avatar"),s=d("a-tooltip"),n=d("Icon"),u=d("a-select-option"),o=d("a-select"),r=d("a-form-item"),i=d("a-form"),w=d("a-button");return v(),c(C(a),b(P,{title:T.value,visible:K.value,"onUpdate:visible":l[2]||(l[2]=e=>K.value=e),wrapClassName:"loginSelectModal"}),{footer:f((()=>[p(w,{onClick:X},{default:f((()=>[L])),_:1}),p(w,{onClick:Q,type:"primary"},{default:f((()=>[M])),_:1})])),default:f((()=>[p(i,b({ref:"formRef"},N,{colon:!1,class:"loginSelectForm"}),{default:f((()=>[W.value?(v(),c(r,{key:0,"validate-status":E.value},{label:f((()=>[p(s,{placement:"topLeft"},{title:f((()=>[z])),default:f((()=>[p(t,{style:{"background-color":"#87d068"},size:30},{default:f((()=>[B])),_:1})])),_:1})])),default:f((()=>[p(o,{value:D.value,"onUpdate:value":l[0]||(l[0]=e=>D.value=e),placeholder:"请选择登录部门",class:m({"valid-error":"error"==E.value})},{suffixIcon:f((()=>[p(n,{icon:"ant-design:gold-outline"})])),default:f((()=>[(v(!0),g(y,null,h($.value,(e=>(v(),c(u,{key:e.id,value:e.id},{default:f((()=>[x(k(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","class"])])),_:1},8,["validate-status"])):_("",!0),R.value?(v(),c(r,{key:1,"validate-status":J.value},{label:f((()=>[p(s,{placement:"topLeft"},{title:f((()=>[F])),default:f((()=>[p(t,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:f((()=>[H])),_:1})])),_:1})])),default:f((()=>[p(o,{value:A.value,"onUpdate:value":l[1]||(l[1]=e=>A.value=e),placeholder:"请选择登录部门",class:m({"valid-error":"error"==J.value})},{suffixIcon:f((()=>[p(n,{icon:"ant-design:gold-outline"})])),default:f((()=>[(v(!0),g(y,null,h(G.value,(e=>(v(),c(u,{key:e.orgCode,value:e.orgCode},{default:f((()=>[x(k(e.departName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","class"])])),_:1},8,["validate-status"])):_("",!0)])),_:1},16)])),_:1},16,["title","visible"])}}}),[["__scopeId","data-v-defac4f0"]]);export{N as default};
