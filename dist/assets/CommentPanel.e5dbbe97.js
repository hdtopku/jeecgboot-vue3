var e=(e,t,n)=>new Promise(((a,l)=>{var i=e=>{try{s(n.next(e))}catch(t){l(t)}},o=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,o);s((n=n.apply(e,t)).next())}));import{fm as t,l as n,bp as a,y as l,bw as i,bq as o,cA as s,av as c,m as d,F as r,a8 as u,a1 as m,ac as v,a as f,L as p,u as g,q as h,e as y,fn as b,fd as C,fe as I,dG as k,H as w,t as x,v as L,x as j,z as O,aW as S,ax as U,bc as _,Y as T,D as A,E as F,W as B,C as D,du as P,aN as N,bI as H,bj as M,o as R,R as z,fo as E,S as V,V as q,eh as Y,d7 as $,$ as W,aa as G,dp as J,dq as K,cl as Z,er as Q}from"./index.b3c93d64.js";import{v as X,U as ee}from"./JAddInput.c8a1b05b.js";import"./index.ee0a0c33.js";import{j as te}from"./api.dced5d87.js";import{c as ne}from"./functional.3bb51b91.js";import{_ as ae}from"./JUpload.6bcc6fce.js";var le=t(n({name:"AComment",props:{actions:Array,author:s.any,avatar:s.any,content:s.any,prefixCls:String,datetime:s.any},slots:["actions","author","avatar","content","datetime"],setup:function(e,t){var n=t.slots,s=a("comment",e),c=s.prefixCls,d=s.direction,r=function(e,t){return l("div",{class:"".concat(e,"-nested")},[t])},u=function(e){return e&&e.length?e.map((function(e,t){return l("li",{key:"action-".concat(t)},[e])})):null};return function(){var t,a,s,m,v,f,p,g,h,y,b,C=c.value,I=null!==(t=e.actions)&&void 0!==t?t:null===(a=n.actions)||void 0===a?void 0:a.call(n),k=null!==(s=e.author)&&void 0!==s?s:null===(m=n.author)||void 0===m?void 0:m.call(n),w=null!==(v=e.avatar)&&void 0!==v?v:null===(f=n.avatar)||void 0===f?void 0:f.call(n),x=null!==(p=e.content)&&void 0!==p?p:null===(g=n.content)||void 0===g?void 0:g.call(n),L=null!==(h=e.datetime)&&void 0!==h?h:null===(y=n.datetime)||void 0===y?void 0:y.call(n),j=l("div",{class:"".concat(C,"-avatar")},["string"==typeof w?l("img",{src:w,alt:"comment-avatar"},null):w]),O=I?l("ul",{class:"".concat(C,"-actions")},[u(Array.isArray(I)?I:[I])]):null,S=l("div",{class:"".concat(C,"-content-author")},[k&&l("span",{class:"".concat(C,"-content-author-name")},[k]),L&&l("span",{class:"".concat(C,"-content-author-time")},[L])]),U=l("div",{class:"".concat(C,"-content")},[S,l("div",{class:"".concat(C,"-content-detail")},[x]),O]),_=l("div",{class:"".concat(C,"-inner")},[j,U]),T=i(null===(b=n.default)||void 0===b?void 0:b.call(n));return l("div",{class:[C,o({},"".concat(C,"-rtl"),"rtl"===d.value)]},[_,T&&T.length?r(C,T):null])}}})),ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){se(e,t,n[t])}))}return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ce=function(e,t){var n=oe({},e,t.attrs);return l(c,oe({},n,{icon:ie}),null)};ce.displayName="MessageOutlined",ce.inheritAttrs=!1;var de=ce,re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"};function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){me(e,t,n[t])}))}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(e,t){var n=ue({},e,t.attrs);return l(c,ue({},n,{icon:re}),null)};ve.displayName="SmileOutlined",ve.inheritAttrs=!1;var fe=ve,pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){he(e,t,n[t])}))}return e}function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ye=function(e,t){var n=ge({},e,t.attrs);return l(c,ge({},n,{icon:pe}),null)};ye.displayName="UserAddOutlined",ye.inheritAttrs=!1;var be=ye,Ce="/assets/excel.73e31c52.svg",Ie="/assets/word.9460f3fc.svg";const ke=d().uploadUrl;let we="";const xe=`${ke}/sys/comment/addFile`;function Le(t){let n={biz:"comment",commentId:""};const{createMessage:a}=g(),l=r(!1);function i(l){return e(this,null,(function*(){let e=xe;const i=new FormData;return i.append("file",l),i.append("tableName",t.tableName),i.append("tableDataId",t.dataId),Object.keys(n).map((e=>{i.append(e,n[e])})),new Promise(((t,n)=>{te(e,i).then((e=>{e&&e.data?"success"==e.data.result?t(1):(a.warning(e.data.message),n()):n()}))}))}))}return{saveCommentAndFiles:function(o,s){return e(this,null,(function*(){l.value=!0,setTimeout((()=>{l.value=!1}),500),yield function(l){return e(this,null,(function*(){const{fromUserId:e,toUserId:i,commentId:o,commentContent:s}=l;let c={tableName:t.tableName,tableDataId:t.dataId,fromUserId:e,commentContent:s,toUserId:"",commentId:""};i&&(c.toUserId=i),o&&(c.commentId=o),n.commentId="";const d=yield(r=c,m.post({url:"/sys/comment/addText",params:r},{isTransformResponse:!1}));var r;if(!d.success)return a.warning(d.message),Promise.reject("保存评论失败");n.commentId=d.result}))}(o),yield function(t){return e(this,null,(function*(){if(t&&t.length>0)for(let e=0;e<t.length;e++){let n=v(t[e]);yield i(n.originFileObj)}}))}(s)}))},buttonLoading:l}}function je(){const t=u({}),n={xls:Ce,xlsx:Ce,pdf:"/assets/pdf.f8d68ae5.svg",txt:"/assets/txt.8d556a18.svg",docx:Ie,doc:Ie};function a(e){if(i(e)){!function(e,n){new Promise(((a,l)=>{let i=new FileReader;e?(i.readAsDataURL(e),i.onload=function(){let e=i.result;t[n]=e,a(e)}):l()}))}(e,e.uid)}}const l=r([]);function i(e){return(e.type||"").indexOf("image")>=0}function o(e){if(i(e)){let n=e.uid;if(n){if(t[n])return t[n]}else if(e.url){return f(e.url)}}return""}return{selectFileList:l,getBackground:function(e){if(i(e))return"none";{const t=e.name;if(!t)return"none";const a=t.substring(t.lastIndexOf(".")+1);let l=n[a];return l||(l="/assets/other.c9fbb14a.svg"),l}},getFileSize:function(e){let t=e.fileSize;return t?Math.round(t/1024)+" KB":"0B"},downLoad:function(e){let t=f(e.url);t&&window.open(t)},beforeUpload:function(e){return a(e),l.value=[...l.value,e],!1},handleRemove:function(e){const t=l.value.indexOf(e),n=l.value.slice();n.splice(t,1),l.value=n},isImage:i,getImageSrc:o,getImageAsBackground:function(e){let t=o(e);return t?{backgroundImage:"url('"+t+"')"}:{}},viewImage:function(t){return e(this,null,(function*(){if(i(t)){let e=o(t);if(e){ne({imageList:[e]})}}else if(t.url){let n=f(t.url);yield function(){return e(this,null,(function*(){we||(we=yield m.get({url:"/sys/comment/getFileViewDomain"})),we.startsWith("http")||(we="http://"+we)}))}(),window.open(we+"?officePreviewType=pdf&url="+encodeURIComponent(n))}}))}}}function Oe(e){const t=new RegExp("([^:]+)?(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)","g");function n(e,t){return e.endsWith(t)}return{globalEmojiIndex:e,getHtml:function(a){return a?a.replace(t,(function(t,a,l){const i=a||"";if(n(i,'alt="')||n(i,'data-text="'))return t;let o=e.findEmoji(l);return o?i+function(e){return`<span style="width: 24px" class="emoji-mart-emoji"><span class="my-emoji-icon emoji-set-apple emoji-type-image" style="position: absolute;top: -3px;left: 3px;width: 18px; height: 18px;background-position: ${e.getPosition()}"> </span> </span>`}(o):t})):""}}}const Se={name:"UploadChunk",components:{Tooltip:y,UploadOutlined:X,FolderOutlined:b,DownloadOutlined:C,PaperClipOutlined:I,DeleteOutlined:k},props:{visible:{type:Boolean,default:!1}},emits:["select"],setup(e,{emit:t}){const{selectFileList:n,beforeUpload:a,handleRemove:l,getBackground:i,isImage:o,getImageSrc:s,viewImage:c}=je();return w((()=>n.value),(e=>{if(e&&e.length>0){let n=e[0].name;n&&t("select",n)}})),{selectFileList:n,beforeUpload:a,handleRemove:l,getBackground:i,getUploadFileList:function(){return v(n.value)},clear:function(){n.value=[]},isImage:o,getImageSrc:s,viewImage:c}}},Ue={key:0},_e={class:"j-icon"},Te={class:"inner-button"},Ae=D("上传"),Fe={class:"j-icon"},Be={class:"inner-button"},De=D("从文件库选择?"),Pe={key:0,class:"selected-file-warp"},Ne={class:"selected-file-list"},He={class:"item"},Me={class:"complex"},Re={class:"content"},ze={key:0,class:"content-top",style:{height:"100%"}},Ee={class:"content-top"},Ve=["title"],qe=["onClick"],Ye={class:"text"},$e={class:"buttons"},We={class:"opt-icon"},Ge=P('<div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div> <div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div><div class="item empty" data-v-7abc3564></div>',7);const Je={categories:{recent:"最常用的",smileys:"表情选择",people:"人物&身体",nature:"动物&自然",foods:"食物&饮料",activity:"活动",places:"旅行&地点",objects:"物品",symbols:"符号",flags:"旗帜"}},Ke={name:"MyComment",components:{UserAddOutlined:be,Tooltip:y,UserSelectModal:ee,PaperClipOutlined:I,UploadChunk:h(Se,[["render",function(e,t,n,a,i,o){const s=x("upload-outlined"),c=x("a-upload"),d=x("folder-outlined"),r=x("a-alert"),u=x("delete-outlined"),m=x("Tooltip");return n.visible?(L(),j("div",Ue,[l(r,{type:"info",class:"jeecg-comment-files",style:{margin:"0"}},{message:O((()=>[S("span",_e,[l(c,{multiple:"","file-list":a.selectFileList,"onUpdate:file-list":t[0]||(t[0]=e=>a.selectFileList=e),showUploadList:!1,"before-upload":a.beforeUpload},{default:O((()=>[S("span",Te,[l(s),Ae])])),_:1},8,["file-list","before-upload"])]),S("span",Fe,[S("span",Be,[l(d),De])])])),_:1}),a.selectFileList&&a.selectFileList.length>0?(L(),j("div",Pe,[S("div",Ne,[(L(!0),j(U,null,_(a.selectFileList,(e=>(L(),j("div",He,[S("div",Me,[S("div",Re,[a.isImage(e)?(L(),j("div",ze,[S("div",{class:"content-image",style:T({height:"100%",backgroundImage:"url("+a.getImageSrc(e)+")"})},null,4)])):(L(),j(U,{key:1},[S("div",Ee,[S("div",{class:"content-icon",style:T({background:"url("+a.getBackground(e)+")  no-repeat"})},null,4)]),S("div",{class:"content-bottom",title:e.name},[S("span",null,A(e.name),1)],8,Ve)],64))]),S("div",{class:F(["layer",{"layer-image":a.isImage(e)}])},[S("div",{class:"next",onClick:t=>a.viewImage(e)},[S("div",Ye,A(e.name),1)],8,qe),S("div",$e,[S("div",We,[l(m,{title:"删除"},{default:O((()=>[l(u,{onClick:t=>a.handleRemove(e)},null,8,["onClick"])])),_:2},1024)])])],2)])])))),256)),Ge])])):B("",!0)])):B("",!0)}],["__scopeId","data-v-7abc3564"]]),SmileOutlined:fe},props:{inner:N.bool.def(!1),inputFocus:{type:Boolean,default:!1}},emits:["cancel","comment"],setup(e,{emit:t}){const n=r(!1),a=r(),[l,{openModal:i}]=H(),o=r(!1),s=r("");const c=r(!1);w(s,(()=>{let e=s.value;c.value=!e&&"0"!==e}));const d=r();function u(){i(!0,{isUpdate:!1})}w((()=>e.inputFocus),(e=>{1==e&&(s.value="",1==n.value&&(a.value.clear(),n.value=!1))}),{deep:!0,immediate:!0}),w((()=>s.value),(e=>{e&&e.endsWith("@")&&u()}));const m=r();const v=r(!1);const f=M("$globalEmojiIndex"),{getHtml:p}=Oe(f),g=R((()=>{let e=s.value;return e?p(e):"请输入你的评论，可以@成员"})),h=r(!1);function y(){h.value=!0}const b=r(!1),C=R((()=>!(s.value.length>0)));return{myComment:s,sendComment:function(){let e=s.value;if(e||"0"===e){o.value=!0;let l=[];1==n.value&&(l=a.value.getUploadFileList()),t("comment",e,l),setTimeout((()=>{o.value=!1}),350)}else c.value=!0},noComment:function(){t("cancel")},disabledButton:c,buttonLoading:o,commentRef:d,registerModal:l,openSelectUser:u,setValue:function(e){if(e&&e.length>0){const{label:t,value:n}=e[0];if(t&&n){let e=`${t}[${n}]`,a=s.value;a?a.endsWith("@")?s.value=a+e:s.value="@"+e+" "+a:s.value="@"+e}}},handleCommentChange:function(){},uploadRef:a,uploadVisible:n,onSelectEmoji:function(e){let t=s.value||"";t+=e,s.value=t,m.value.click()},optionsName:Je,emojiButton:m,emojiIndex:f,showEmoji:function(e){let t=s.value||"",n=e.colons;n.indexOf("::")>0&&(n=n.substring(0,n.indexOf(":")+1)),s.value=t+n,v.value=!1,y()},pickerStyles:{width:"490px"},visibleEmoji:v,handleClickBlank:function(e){e.preventDefault(),e.stopPropagation(),v.value=!1,b.value=!0},handleShowEmoji:function(e){e.preventDefault(),e.stopPropagation(),v.value=!v.value},commentHtml:g,showHtml:h,handleClickHtmlShower:function(e){e.preventDefault(),e.stopPropagation(),h.value=!1,d.value.focus(),b.value=!0},handleBlur:y,commentActive:b,noConent:C,changeActive:function(){0==s.value.length&&(b.value=!1,n.value=!1)},selectFirstFile:function(e){0==s.value.length&&(s.value=e)}}}},Ze=["innerHTML"],Qe={key:0,class:"comment-buttons"},Xe={style:{cursor:"pointer"}},et={title:"表情",style:{display:"inline-block"}},tt={style:{position:"relative"}},nt={key:0},at=D("取消"),lt=D("发 送"),it=S("span",null,null,-1);var ot=h(Ke,[["render",function(e,t,n,a,i,o){const s=x("user-add-outlined"),c=x("Tooltip"),d=x("PaperClipOutlined"),r=x("SmileOutlined"),u=x("a-button"),m=x("upload-chunk"),v=x("UserSelectModal"),f=x("Picker"),p=x("a-modal");return L(),j(U,null,[S("div",{class:F({"comment-active":a.commentActive}),style:{border:"1px solid #eee",margin:"0",position:"relative"},onClick:t[5]||(t[5]=(...e)=>a.handleClickBlank&&a.handleClickBlank(...e))},[z(S("textarea",{ref:"commentRef","onUpdate:modelValue":t[0]||(t[0]=e=>a.myComment=e),onInput:t[1]||(t[1]=(...e)=>a.handleCommentChange&&a.handleCommentChange(...e)),onBlur:t[2]||(t[2]=(...e)=>a.handleBlur&&a.handleBlur(...e)),class:"comment-content",rows:3,placeholder:"请输入你的评论，可以@成员"},null,544),[[E,a.myComment]]),S("div",{class:F(["comment-content comment-html-shower",{"no-content":a.noConent,"top-div":a.showHtml,"bottom-div":0==a.showHtml}]),innerHTML:a.commentHtml,onClick:t[3]||(t[3]=(...e)=>a.handleClickHtmlShower&&a.handleClickHtmlShower(...e))},null,10,Ze),a.commentActive?(L(),j("div",Qe,[S("div",Xe,[l(c,{title:"选择@用户"},{default:O((()=>[l(s,{onClick:a.openSelectUser},null,8,["onClick"])])),_:1}),l(c,{title:"上传附件"},{default:O((()=>[l(d,{onClick:t[4]||(t[4]=e=>a.uploadVisible=!a.uploadVisible)})])),_:1}),S("span",et,[l(r,{ref:"emojiButton",onClick:a.handleShowEmoji},null,8,["onClick"]),z(S("div",tt,null,512),[[V]])])]),a.commentActive?(L(),j("div",nt,[n.inner?(L(),q(u,{key:0,onClick:a.noComment,style:{"margin-right":"10px"}},{default:O((()=>[at])),_:1},8,["onClick"])):B("",!0),l(u,{type:"primary",onClick:a.sendComment,loading:a.buttonLoading,disabled:a.disabledButton},{default:O((()=>[lt])),_:1},8,["onClick","loading","disabled"])])):B("",!0)])):B("",!0),l(m,{ref:"uploadRef",visible:a.uploadVisible,onSelect:a.selectFirstFile},null,8,["visible","onSelect"])],2),l(v,{labelKey:"realname",rowKey:"username",onRegister:a.registerModal,onGetSelectResult:a.setValue,isRadioSelection:""},null,8,["onRegister","onGetSelectResult"]),l(p,{visible:a.visibleEmoji,"onUpdate:visible":t[6]||(t[6]=e=>a.visibleEmoji=e),footer:null,wrapClassName:"emoji-modal",closable:!1,width:490},{title:O((()=>[it])),default:O((()=>[l(f,{pickerStyles:a.pickerStyles,i18n:a.optionsName,data:a.emojiIndex,emoji:"grinning",showPreview:!1,infiniteScroll:!1,showSearch:!1,showSkinTones:!1,set:"apple",onSelect:a.showEmoji},null,8,["pickerStyles","i18n","data","onSelect"])])),_:1},8,["visible"])],64)}]]);const st={name:"HistoryFileList",props:{dataList:{type:Array,default:()=>[]},isComment:{type:Boolean,default:!1}},components:{UploadOutlined:X,FolderOutlined:b,DownloadOutlined:C,PaperClipOutlined:I,DeleteOutlined:k,Tooltip:y},setup(){const{getBackground:e,getFileSize:t,downLoad:n,isImage:a,getImageAsBackground:l,viewImage:i}=je();return{getBackground:e,downLoad:n,getFileSize:t,isImage:a,getImageAsBackground:l,viewImage:i}}},ct={class:"selected-file-list"},dt={class:"item"},rt={class:"complex"},ut={class:"content"},mt={key:0,class:"content-top",style:{height:"100%"}},vt={class:"content-top"},ft=["title"],pt=["onClick"],gt={class:"text"},ht={class:"text"},yt={class:"buttons"},bt={class:"opt-icon"},Ct=P('<div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div> <div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div><div class="item empty" data-v-e4322150></div>',7);var It=h(st,[["render",function(e,t,n,a,i,o){const s=x("download-outlined"),c=x("Tooltip");return L(),j("div",{class:F(["comment-file-his-list",!0===n.isComment?"in-comment":""])},[S("div",ct,[(L(!0),j(U,null,_(n.dataList,(e=>(L(),j("div",dt,[S("div",rt,[S("div",ut,[a.isImage(e)?(L(),j("div",mt,[S("div",{class:"content-image",style:T(a.getImageAsBackground(e))},null,4)])):(L(),j(U,{key:1},[S("div",vt,[S("div",{class:"content-icon",style:T({background:"url("+a.getBackground(e)+")  no-repeat"})},null,4)]),S("div",{class:"content-bottom",title:e.name},[S("span",null,A(e.name),1)],8,ft)],64))]),S("div",{class:F(["layer",{"layer-image":a.isImage(e)}])},[S("div",{class:"next",onClick:t=>a.viewImage(e)},[S("div",gt,A(e.name),1),S("div",ht,A(a.getFileSize(e)),1)],8,pt),S("div",yt,[S("div",bt,[l(c,{title:"下载"},{default:O((()=>[l(s,{onClick:t=>a.downLoad(e)},null,8,["onClick"])])),_:2},1024)])])],2)])])))),256)),Ct])],2)}],["__scopeId","data-v-e4322150"]]);const kt=n({name:"CommentList",components:{MessageOutlined:de,AComment:le,Tooltip:y,MyComment:ot,Popconfirm:Y,HistoryFileList:It},props:{tableName:N.string.def(""),dataId:N.string.def(""),datetime:N.number.def(1)},setup(t){const n=r([]),{userInfo:a}=$(),l=M("$dayjs");const i=r(300),o=r(300);function s(){return e(this,null,(function*(){const e={tableName:t.tableName,tableDataId:t.dataId,column:"createTime",order:"desc"},a=yield(e=>m.get({url:"/sys/comment/listByForm",params:e}))(e);if(a&&a.records&&0!=a.records.length){let e=a.records;n.value=e}else n.value=[]}))}W((()=>{i.value=window.innerHeight-57-46-70-160,o.value=window.innerHeight-57-46-53-20}));const{saveCommentAndFiles:c}=Le(t);const d=r(!1);G((()=>{t.datetime&&t.tableName&&t.dataId&&s()}));const u=M("$globalEmojiIndex"),{getHtml:v}=Oe(u),p=r();return{dataList:n,getAvatar:function(e){return e.fromUserAvatar?f(e.fromUserAvatar):""},getAvatarText:function(e){return e.fromUserId_dictText?e.fromUserId_dictText.substr(0,2):"未知"},getAuthor:function(e){return e.toUser?e.fromUserId_dictText+" 回复 "+e.fromUserId_dictText:e.fromUserId_dictText},getDateDiff:function(e){if(e.createTime){return l(e.createTime,"YYYY-MM-DD hh:mm:ss").fromNow()}return""},commentHeight:i,allHeight:o,replyComment:function(t,n,l){return e(this,null,(function*(){let e={fromUserId:a.id,toUserId:t.fromUserId,commentId:t.id,commentContent:n};yield c(e,l),yield s()}))},sendComment:function(t,n){return e(this,null,(function*(){let e={fromUserId:a.id,commentContent:t};yield c(e,n),yield s(),d.value=!1,setTimeout((()=>{d.value=!0}),100)}))},getMyname:function(){return a.realname?a.realname.substr(0,2):""},getMyAvatar:function(){return a.avatar},focusStatus:d,showReply:function(e){let t=n.value;for(let n of t)n.commentStatus=!1;e.commentStatus=!0,d.value=!1,d.value=!0},deleteComment:function(t){return e(this,null,(function*(){const e={id:t.id};yield(e=>m.delete({url:"/sys/comment/deleteOne",params:e},{joinParamsToUrl:!0}))(e),yield s()}))},getHtml:v,handleClickItem:function(){p.value.changeActive()},bottomCommentRef:p,visibleChange:function(t,n){return e(this,null,(function*(){if(1==t&&!n.commentId_dictText){const e=yield(e=>{let t={id:e};return m.get({url:"/sys/comment/queryById",params:t},{isTransformResponse:!1})})(n.commentId);1==e.success?n.commentId_dictText=e.result.commentContent:n.commentId_dictText="该评论已被删除"}}))}}}}),wt=e=>(J("data-v-07e4cb61"),e=e(),K(),e),xt={class:"comment-author"},Lt=wt((()=>S("span",null,"回复",-1))),jt=["innerHTML"],Ot=["onClick"],St=wt((()=>S("span",null,"删除",-1))),Ut=["innerHTML"],_t={key:0},Tt={key:0,class:"inner-comment"},At={style:{position:"absolute",bottom:"0",left:"0",width:"100%",background:"#fff","border-top":"1px solid #eee"}};var Ft=h(kt,[["render",function(e,t,n,a,i,o){const s=x("a-avatar"),c=x("message-outlined"),d=x("Tooltip"),r=x("Popconfirm"),u=x("history-file-list"),m=x("a-comment"),v=x("my-comment"),f=x("a-list-item"),p=x("a-list");return L(),j("div",{style:T({position:"relative",height:e.allHeight+"px"})},[l(p,{class:"jeecg-comment-list",header:"","item-layout":"horizontal","data-source":e.dataList,style:T({height:e.commentHeight+"px"})},{renderItem:O((({item:t})=>[l(f,{style:{"padding-left":"10px","flex-direction":"column"},onClick:e.handleClickItem},{default:O((()=>[l(m,null,{avatar:O((()=>[l(s,{class:"tx",src:e.getAvatar(t),alt:e.getAvatarText(t)},{default:O((()=>[D(A(e.getAvatarText(t)),1)])),_:2},1032,["src","alt"])])),author:O((()=>[S("div",xt,[S("span",null,A(t.fromUserId_dictText),1),t.toUserId?(L(),j(U,{key:0},[Lt,S("span",null,A(t.toUserId_dictText),1),l(d,{class:"comment-last-content",onVisibleChange:n=>e.visibleChange(n,t)},{title:O((()=>[S("div",{innerHTML:e.getHtml(t.commentId_dictText)},null,8,jt)])),default:O((()=>[l(c)])),_:2},1032,["onVisibleChange"])],64)):B("",!0)])])),datetime:O((()=>[S("div",null,[l(d,{title:t.createTime},{default:O((()=>[S("span",null,A(e.getDateDiff(t)),1)])),_:2},1032,["title"])])])),actions:O((()=>[S("span",{onClick:n=>e.showReply(t)},"回复",8,Ot),l(r,{title:"确定删除吗？",onConfirm:n=>e.deleteComment(t)},{default:O((()=>[St])),_:2},1032,["onConfirm"])])),content:O((()=>[S("div",{innerHTML:e.getHtml(t.commentContent),style:{"font-size":"15px"}},null,8,Ut),t.fileList&&t.fileList.length>0?(L(),j("div",_t,[l(u,{dataList:t.fileList,isComment:""},null,8,["dataList"])])):B("",!0)])),_:2},1024),t.commentStatus?(L(),j("div",Tt,[l(v,{inner:"",onCancel:e=>t.commentStatus=!1,onComment:(n,a)=>e.replyComment(t,n,a),inputFocus:e.focusStatus},null,8,["onCancel","onComment","inputFocus"])])):B("",!0)])),_:2},1032,["onClick"])])),_:1},8,["data-source","style"]),S("div",At,[l(m,{style:{margin:"0 10px"}},{avatar:O((()=>[l(s,{class:"tx",src:e.getMyAvatar(),alt:e.getMyname()},{default:O((()=>[D(A(e.getMyname()),1)])),_:1},8,["src","alt"])])),content:O((()=>[l(v,{ref:"bottomCommentRef",onComment:e.sendComment,inputFocus:e.focusStatus},null,8,["onComment","inputFocus"])])),_:1})])],4)}],["__scopeId","data-v-07e4cb61"]]);const Bt={name:"CommentFiles",components:{UploadOutlined:X,FolderOutlined:b,JUpload:ae,DownloadOutlined:C,PaperClipOutlined:I,DeleteOutlined:k,Tooltip:y,HistoryFileList:It},props:{tableName:N.string.def(""),dataId:N.string.def(""),datetime:N.number.def(1)},setup(t){const{userInfo:n}=$(),a=r([]),l=r("");function i(){return e(this,null,(function*(){const e={tableName:t.tableName,tableDataId:t.dataId},n=yield(e=>m.get({url:"/sys/comment/fileList",params:e}))(e);if(n&&n.records&&0!=n.records.length){let e=n.records;a.value=e}else a.value=[];l.value=""}))}G((()=>{t.datetime&&t.tableName&&t.dataId&&i()}));const{saveCommentAndFiles:o,buttonLoading:s}=Le(t),{selectFileList:c,beforeUpload:d,handleRemove:u,getBackground:v,isImage:f,getImageAsBackground:p,viewImage:g}=je();return{selectFileList:c,beforeUpload:d,handleRemove:u,getBackground:v,isImage:f,dataList:a,uploadFileUrl:xe,quxiao:function(){c.value=[]},queding:function(){return e(this,null,(function*(){let e={fromUserId:n.id,commentContent:"上传了附件"};yield o(e,c.value),c.value=[],yield i()}))},buttonLoading:s,getImageAsBackground:p,viewImage:g}}},Dt={class:"j-icon"},Pt={class:"inner-button"},Nt=D("上传"),Ht={class:"j-icon"},Mt={class:"inner-button"},Rt=D("从文件库选择?"),zt={key:0,class:"selected-file-warp"},Et={class:"selected-file-list"},Vt={class:"item"},qt={class:"complex"},Yt={class:"content"},$t={key:0,class:"content-top",style:{height:"100%"}},Wt={class:"content-top"},Gt=["title"],Jt=["onClick"],Kt={class:"text"},Zt={class:"buttons"},Qt={class:"opt-icon"},Xt=P('<div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div> <div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div><div class="item empty" data-v-8e4402d4></div>',7),en={style:{"margin-bottom":"24px","margin-top":"18px","text-align":"right"}},tn=D("取消"),nn=D("确定");var an=h(Bt,[["render",function(e,t,n,a,i,o){const s=x("upload-outlined"),c=x("a-upload"),d=x("folder-outlined"),r=x("a-alert"),u=x("delete-outlined"),m=x("Tooltip"),v=x("a-button"),f=x("history-file-list");return L(),j("div",null,[l(r,{type:"info",class:"jeecg-comment-files"},{message:O((()=>[S("span",Dt,[l(c,{multiple:"","file-list":a.selectFileList,"onUpdate:file-list":t[0]||(t[0]=e=>a.selectFileList=e),showUploadList:!1,"before-upload":a.beforeUpload},{default:O((()=>[S("span",Pt,[l(s),Nt])])),_:1},8,["file-list","before-upload"])]),S("span",Ht,[S("span",Mt,[l(d),Rt])])])),_:1}),a.selectFileList&&a.selectFileList.length>0?(L(),j("div",zt,[S("div",Et,[(L(!0),j(U,null,_(a.selectFileList,(e=>(L(),j("div",Vt,[S("div",qt,[S("div",Yt,[a.isImage(e)?(L(),j("div",$t,[S("div",{class:"content-image",style:T(a.getImageAsBackground(e))},null,4)])):(L(),j(U,{key:1},[S("div",Wt,[S("div",{class:"content-icon",style:T({background:"url("+a.getBackground(e)+")  no-repeat"})},null,4)]),S("div",{class:"content-bottom",title:e.name},[S("span",null,A(e.name),1)],8,Gt)],64))]),S("div",{class:F(["layer",{"layer-image":a.isImage(e)}])},[S("div",{class:"next",onClick:t=>a.viewImage(e)},[S("div",Kt,A(e.name),1)],8,Jt),S("div",Zt,[S("div",Qt,[l(m,{title:"删除"},{default:O((()=>[l(u,{onClick:t=>a.handleRemove(e)},null,8,["onClick"])])),_:2},1024)])])],2)])])))),256)),Xt]),S("div",en,[l(v,{onClick:a.quxiao},{default:O((()=>[tn])),_:1},8,["onClick"]),l(v,{type:"primary",style:{"margin-left":"10px"},onClick:a.queding,loading:a.buttonLoading},{default:O((()=>[nn])),_:1},8,["onClick","loading"])])])):B("",!0),l(f,{dataList:a.dataList},null,8,["dataList"])])}],["__scopeId","data-v-8e4402d4"]]);const ln={name:"DataLogList",components:{PlusOutlined:Z,EditOutlined:Q,Tooltip:y},props:{tableName:N.string.def(""),dataId:N.string.def(""),datetime:N.number.def(1)},setup(t){const n=M("$dayjs"),a=window.innerHeight,l=r(300);l.value=a-46-57-53-30;const i=r([]),o=r(0);function s(){return e(this,null,(function*(){const e={dataTable:t.tableName,dataId:t.dataId,type:"comment"},n=yield(e=>m.get({url:"/sys/dataLog/queryDataVerList",params:e},{isTransformResponse:!1}))(e);if(n&&n.result&&0!=n.result.length){let e=n.result;o.value=e.length-1,i.value=e}else i.value=[],o.value=-1}))}return G((()=>{t.datetime&&t.tableName&&t.dataId&&s()})),{height:l,lastIndex:o,dataList:i,getDateDiff:function(e){if(e.createTime){return n(e.createTime,"YYYY-MM-DD hh:mm:ss").fromNow()}return""},handleClickPerson:function(){}}}},on={class:"data-log-content"},sn={class:"logbox"},cn={class:"log-item"},dn={class:"log-item-icon"},rn={class:"log-item-content"},un={class:"log-item-date"};const mn={name:"CommentPanel",components:{CommentList:Ft,CommentFiles:an,DataLogList:h(ln,[["render",function(e,t,n,a,i,o){const s=x("plus-outlined"),c=x("edit-outlined"),d=x("Tooltip");return L(),j("div",{class:"data-log-scroll",style:T({height:a.height+"px"})},[S("div",on,[S("div",sn,[(L(!0),j(U,null,_(a.dataList,((e,n)=>(L(),j("div",cn,[S("span",dn,[a.lastIndex==n?(L(),q(s,{key:0,style:{"margin-top":"3px"}})):(L(),q(c,{key:1}))]),S("span",rn,[S("a",{onClick:t[0]||(t[0]=(...e)=>a.handleClickPerson&&a.handleClickPerson(...e))},"@"+A(e.createBy),1),D(" "+A(e.dataContent),1)]),S("div",un,[l(d,{title:e.createTime},{default:O((()=>[S("span",null,A(a.getDateDiff(e)),1)])),_:2},1032,["title"])])])))),256))])])],4)}],["__scopeId","data-v-10e1db0a"]])},props:{tableName:N.string.def(""),dataId:N.string.def("")},setup(e){const t=R((()=>!(!e.dataId||!e.tableName))),n=r(1),a=r(1),l=r(1);return{showStatus:t,handleChange:function(e){let t=(new Date).getTime();"comment"==e?n.value=t:"file"==e?a.value=t:l.value=t},datetime1:n,datetime2:a,datetime3:l,reload:function(){let e=(new Date).getTime();n.value=e,a.value=e,l.value=e}}}},vn={key:0,class:"comment-tabs-warp"};var fn=h(mn,[["render",function(e,t,n,a,i,o){const s=x("comment-list"),c=x("a-tab-pane"),d=x("comment-files"),r=x("data-log-list"),u=x("a-tabs"),m=x("a-empty");return a.showStatus?(L(),j("div",vn,[l(u,{onChange:a.handleChange,animated:!1},{default:O((()=>[l(c,{tab:"评论",key:"comment",class:"comment-list-tab"},{default:O((()=>[l(s,{tableName:n.tableName,dataId:n.dataId,datetime:a.datetime1},null,8,["tableName","dataId","datetime"])])),_:1}),l(c,{tab:"文件",key:"file"},{default:O((()=>[l(d,{tableName:n.tableName,dataId:n.dataId,datetime:a.datetime2},null,8,["tableName","dataId","datetime"])])),_:1}),l(c,{tab:"日志",key:"log"},{default:O((()=>[l(r,{tableName:n.tableName,dataId:n.dataId,datetime:a.datetime3},null,8,["tableName","dataId","datetime"])])),_:1})])),_:1},8,["onChange"])])):(L(),q(m,{key:1,description:"新增页面不支持评论"}))}],["__scopeId","data-v-4f470734"]]);export{fn as C};
