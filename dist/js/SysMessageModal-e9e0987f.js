var B=(D,i,f)=>new Promise((e,_)=>{var p=l=>{try{s(f.next(l))}catch(v){_(v)}},h=l=>{try{s(f.throw(l))}catch(v){_(v)}},s=l=>l.done?e(l.value):Promise.resolve(l.value).then(p,h);s((f=f.apply(D,i)).next())});import{B as X}from"./index-f7d688aa.js";import{d0 as Y,co as Z,d1 as $,d2 as ee,cA as ae}from"./antd-vue-vendor-c5335947.js";import{n as te,U as se}from"./JSelectUser-99e618da.js";import{l as y,r as P,e as F,u as le,ad as t,V as c,a7 as m,a8 as u,F as O,f as o,aa as d,ak as K,aq as ne,ae as T,ac as N,ab as oe,W as re}from"./vue-50733b77.js";import ie from"./SysMessageList-da67d558.js";import ce from"./DetailModal-e9284bf7.js";import{_ as de}from"./jeecg-online-vendor-d3e1865b.js";import{E as fe,F as V}from"./index-b34ff7bc.js";import"./BasicModal-064024e0.js";import"./useWindowSizeFn-34cbae37.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-058e2396.js";import"./vxe-table-vendor-838914b0.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./props-2079d80b.js";import"./JSelectBiz-f98b6288.js";import"./useFormItem-915d7f1b.js";import"./useSysMessage-7bc8b9fb.js";const _e={name:"SysMessageModal",components:{BasicModal:X,FilterOutlined:Y,CloseOutlined:Z,BellFilled:$,ExclamationOutlined:ee,JSelectUser:te,SysMessageList:ie,UserSelectModal:se,PlusOutlined:ae,DetailModal:ce},emits:["register","refresh"],setup(D,{emit:i}){const f=y(),e=y(),_=y("all");function p(a,n){_.value=n,l()}function h(a){_.value=a}const s=P({fromUser:"",realname:"",rangeDateKey:"7day",rangeDate:[]});function l(){let a={fromUser:s.fromUser,rangeDateKey:s.rangeDateKey,rangeDate:s.rangeDate};_.value=="all"?f.value.reload(a):e.value.reload(a)}const[v,{closeModal:b}]=fe(a=>B(this,null,function*(){l()})),k=y(!1);function C(a,n){k.value=!0}const g=P([{key:"jt",text:"今天",active:!1},{key:"zt",text:"昨天",active:!1},{key:"qt",text:"前天",active:!1},{key:"bz",text:"本周",active:!1},{key:"sz",text:"上周",active:!1},{key:"by",text:"本月",active:!1},{key:"sy",text:"上月",active:!1},{key:"7day",text:"七日",active:!0},{key:"zdy",text:"自定义",active:!1}]);function x(a){for(let n of g)n.key!=a.key&&(n.active=!1);a.active=!a.active,a.active==!1?s.rangeDateKey="":s.rangeDateKey=a.key,a.key=="zdy"?a.active==!1&&(s.rangeDate=[],l()):l()}const M=F(()=>{let a=g.filter(n=>n.active==!0);return!!(a&&a.length>0&&a[0].text=="自定义")}),S=y([]);function R(a,n){s.rangeDate=[...n],l()}function r(a){i("refresh",a)}const z=F(()=>{const{fromUser:a,rangeDateKey:n,realname:H}=s;if(!a&&!n)return"";let U=[];if(a&&U.push(H),n){let w=g.filter(Q=>Q.key==n);w&&w.length>0&&U.push(w[0].text)}return U.join("、")}),[A,{openModal:E}]=V();function j(a,n){a&&a.length>0&&(s.fromUser=n,s.realname=a[0].label)}function q(){E(!0,{})}function G(){s.fromUser="",s.realname=""}function I(){s.fromUser="",s.realname="",s.rangeDateKey="",s.rangeDate=[];for(let a of g)a.active=!1;l()}const[L,{openModal:J}]=V();function W(a){J(!0,{record:le(a),isUpdate:!0})}return{conditionStr:z,regModal:A,getSelectedUser:j,openSelectPerson:q,clearSearchParamsUser:G,clearAll:I,registerModal:v,activeKey:_,handleChangePanel:h,handleChangeTab:p,showSearch:k,searchParams:s,handleChangeSearchPerson:C,dateTags:g,handleClickDateTag:x,showRangeDate:M,searchRangeDate:S,handleChangeSearchDate:R,closeModal:b,hrefThenClose:r,allMessageRef:f,starMessageRef:e,registerDetail:L,showDetailModal:W}}},ge={class:"sys-msg-modal-title"},me=t("div",{class:"title"},null,-1),he={class:"ant-tabs-nav-wrap"},ve={class:"ant-tabs-nav-scroll"},ue={class:"ant-tabs-nav ant-tabs-nav-animated"},ye={class:"icon-right"},pe={class:"icons"},be=t("span",{class:"search-label"},"回复、提到我的人?：",-1),ke={style:{display:"inline-block"}},Ce={key:0,class:"selected-user"},De={class:"clear-user-icon"},xe={class:"search-date"},Me=t("div",{class:"date-label"},"时间：",-1),Se={class:"date-tags"},Re={class:"tags-container"},Ue=["onClick"],we={key:0,class:"cust-range-date"},Ke={key:0,class:"anticon filtera"},Te={style:{"font-size":"12px","margin-left":"3px"}},ze={style:{display:"flex",margin:"0 5px"}},Be={class:"sys-message-card"},Pe=t("div",null,null,-1);function Fe(D,i,f,e,_,p){const h=c("close-outlined"),s=c("plus-outlined"),l=c("a-button"),v=c("a-range-picker"),b=c("filter-outlined"),k=c("a-popover"),C=c("sys-message-list"),g=c("a-tab-pane"),x=c("a-tabs"),M=c("BasicModal"),S=c("user-select-modal"),R=c("DetailModal");return m(),u(O,null,[o(M,{canFullscreen:!1,draggable:!1,closable:!1,onRegister:e.registerModal,wrapClassName:"sys-msg-modal",width:800,footer:null,destroyOnClose:""},{title:d(()=>[t("div",ge,[me,t("div",he,[t("div",ve,[t("div",ue,[t("div",null,[t("div",{onClick:i[0]||(i[0]=r=>e.handleChangeTab(r,"all")),role:"tab","aria-disabled":"false","aria-selected":"false",class:K(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="all"}])}," 全部消息 ",2),t("div",{onClick:i[1]||(i[1]=r=>e.handleChangeTab(r,"star")),role:"tab","aria-disabled":"false","aria-selected":"true",class:K(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="star"}])}," 标星消息 ",2)]),t("div",{class:"ant-tabs-ink-bar ant-tabs-ink-bar-animated",style:ne({transform:e.activeKey=="all"?"translate3d(130px, 0px, 0px)":"translate3d(215px, 0px, 0px)",display:"block",width:"88px",height:"1px"})},null,4)])])]),t("div",ye,[t("div",pe,[o(k,{placement:"bottomRight",overlayStyle:{width:"400px"},trigger:"click",visible:e.showSearch,"onUpdate:visible":i[3]||(i[3]=r=>e.showSearch=r)},{content:d(()=>[t("div",null,[be,t("span",ke,[e.searchParams.fromUser?(m(),u("div",Ce,[t("span",null,T(e.searchParams.realname),1),t("span",De,[o(h,{style:{"font-size":"12px"},onClick:e.clearSearchParamsUser},null,8,["onClick"])])])):(m(),N(l,{key:1,type:"dashed",shape:"circle",onClick:e.openSelectPerson},{default:d(()=>[o(s)]),_:1},8,["onClick"]))])]),t("div",xe,[Me,t("div",Se,[t("div",Re,[(m(!0),u(O,null,oe(e.dateTags,r=>(m(),u("div",{class:K(r.active==!0?"tag active":"tag"),onClick:z=>e.handleClickDateTag(r)},T(r.text),11,Ue))),256))]),e.showRangeDate?(m(),u("div",we,[o(v,{value:e.searchRangeDate,"onUpdate:value":i[2]||(i[2]=r=>e.searchRangeDate=r),onChange:e.handleChangeSearchDate},null,8,["value","onChange"])])):re("",!0)])])]),default:d(()=>[e.conditionStr?(m(),u("span",Ke,[o(b),t("span",Te,T(e.conditionStr),1),t("span",ze,[o(h,{style:{"font-size":"12px"},onClick:e.clearAll},null,8,["onClick"])])])):(m(),N(b,{key:1}))]),_:1},8,["visible"]),o(h,{onClick:e.closeModal},null,8,["onClick"])])])])]),default:d(()=>[t("div",Be,[o(x,{activeKey:e.activeKey,center:"",onTabClick:e.handleChangePanel},{renderTabBar:d(()=>[Pe]),default:d(()=>[o(g,{tab:"全部消息",key:"all",forceRender:""},{default:d(()=>[o(C,{ref:"allMessageRef",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["onClose","onDetail"])]),_:1}),o(g,{tab:"标星消息",key:"star",forceRender:""},{default:d(()=>[o(C,{ref:"starMessageRef",star:"",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["onClose","onDetail"])]),_:1})]),_:1},8,["activeKey","onTabClick"])])]),_:1},8,["onRegister"]),o(S,{isRadioSelection:"",showButton:!1,labelKey:"realname",rowKey:"username",onRegister:e.regModal,onGetSelectResult:e.getSelectedUser},null,8,["onRegister","onGetSelectResult"]),o(R,{onRegister:e.registerDetail,zIndex:1001},null,8,["onRegister"])],64)}const ta=de(_e,[["render",Fe]]);export{ta as default};
