var d=(E,w,c)=>new Promise((M,k)=>{var T=o=>{try{s(c.next(o))}catch(l){k(l)}},b=o=>{try{s(c.throw(o))}catch(l){k(l)}},s=o=>o.done?M(o.value):Promise.resolve(o.value).then(T,b);s((c=c.apply(E,w)).next())});import{d as ve,c as he,l as u,V as r,a7 as m,ac as D,aa as a,ad as y,f as n,E as f,W as P,a8 as R,ae as W,F as z,u as B,n as G}from"./vue-86253b15.js";import"./index-5f3b36bb.js";import{q as ke,aT as ge}from"./jeecg-online-vendor-bc5d810e.js";import{q as H,d as xe,A as J}from"./depart.api-b7cb4c93.js";import{s as Ce}from"./depart.user.api-0c9706fc.js";import De from"./DepartFormModal-31b69bdf.js";import{bv as we}from"./antd-vue-vendor-371529c2.js";import{F as Te}from"./index-4de4eaa0.js";import"./BasicModal-8033a6fa.js";import"./useWindowSizeFn-0b39b13a.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-04a44d0a.js";import"./vxe-table-vendor-6a8d95c4.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./index-2b71c6a1.js";import"./useForm-61401b42.js";import"./componentMap-804f169d.js";import"./useFormItem-48d9339b.js";import"./index-7eb57de2.js";import"./download-dda5b956.js";import"./base64Conver-fa2fe1af.js";import"./index-c842bec9.js";import"./index-f5da07b2.js";import"./useCountdown-7a164eb2.js";import"./useFormItemSingle-1ae794f9.js";import"./JAddInput-eb55e093.js";import"./areaDataUtil-c66543dc.js";import"./JSelectUser-43c751df.js";import"./props-edbd03b5.js";import"./JSelectBiz-4759b897.js";import"./index-6c9d1f87.js";import"./index-6021b022.js";import"./bem-6904c165.js";import"./props-3eac2fce.js";import"./useContextMenu-368c1b38.js";import"./JSelectDept-1fac1b66.js";import"./JPopup-1441d476.js";import"./cron-parser-vendor-8edbe50a.js";import"./JEllipsis-08edf142.js";import"./JUpload-5d01fa2e.js";import"./index-8967d44c.js";import"./index-d90d28d1.js";import"./depart.data-400b56fa.js";const be={class:"j-table-operator",style:{width:"100%"}},Ke=y("span",null,"删除",-1),Ae=y("span",null,"批量操作 ",-1),Ie={key:1},Se=y("span",{style:{color:"red"}},"删除",-1),Ct=ve({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(E,{expose:w,emit:c}){const M=he("prefixCls"),{createMessage:k}=ke(),{handleImportXls:T,handleExportXls:b}=ge(),s=u(!1),o=u([]),l=u([]),p=u([]),h=u([]),K=u(!1),O=u(!0),A=u(null),I=u(null),Q=u(""),[Y,{openModal:U}]=Te();function _(){return d(this,null,function*(){try{s.value=!0,o.value=[];const e=yield H();if(Array.isArray(e)&&(o.value=e),p.value.length===0)V();else if(h.value.length===0){let t=o.value[0];t&&g(t.id,t)}else c("select",A.value);c("rootTreeData",o.value)}finally{s.value=!1}})}_();function Z(e){return d(this,null,function*(){try{const t=yield H({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,p.value.length>0){let i=[];for(let x of p.value)t.findIndex(C=>C.id===x)!==-1&&i.push(x);i.length>0&&(p.value=[...p.value])}o.value=[...o.value],c("rootTreeData",o.value)}catch(t){}return Promise.resolve()})}function V(){let e=o.value[0];e?(e.isLeaf||(p.value=[e.key]),g(e.id,e),ee()):c("select",null)}function ee(){return d(this,null,function*(){yield G(),K.value=!0,yield G(),K.value=!1})}function g(e,t){h.value=[e],t&&(A.value=t,c("select",t))}function te(){U(!0,{isUpdate:!1,isChild:!1})}function $(e=A.value){if(e==null){k.warning("请先选择一个部门");return}const t={parentId:e.id};U(!0,{isUpdate:!1,isChild:!0,record:t})}function ae(e){return d(this,null,function*(){if(e)try{s.value=!0,o.value=[];let t=yield Ce({keyWord:e});Array.isArray(t)&&(o.value=t),V()}finally{s.value=!1}else _();Q.value=e})}function ne(e){Array.isArray(e)?l.value=e:l.value=e.checked}function oe(e,t){e.length>0&&h.value[0]!==e[0]?g(e[0],t.selectedNodes[0]):g(h.value[0])}function L(e,t=!0){return d(this,null,function*(){const i=B(e);if(i.length>0)try{s.value=!0,yield xe({ids:i.join(",")},t),yield _()}finally{s.value=!1}})}function le(e){return d(this,null,function*(){e&&(X(!1),L([e.id],!1))})}function ie(){return d(this,null,function*(){try{yield L(l),l.value=[]}finally{}})}function X(e){e||(I.value=null)}function re(e){T(e,J.importExcelUrl,()=>{_()})}function se(){b("部门信息",J.exportXlsUrl)}return w({loadRootTreeData:_}),(e,t)=>{const i=r("a-button"),x=r("a-upload"),C=r("icon"),S=r("a-menu-item"),q=r("a-menu"),N=r("a-dropdown"),ce=r("a-divider"),ue=r("a-alert"),pe=r("a-input-search"),de=r("a-tree"),me=r("a-empty"),fe=r("a-spin"),ye=r("a-card");return m(),D(ye,{bordered:!1,style:{height:"100%"}},{default:a(()=>[y("div",be,[n(i,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:te},{default:a(()=>[f("新增")]),_:1}),n(i,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>$())},{default:a(()=>[f("添加下级")]),_:1}),n(x,{name:"file",showUploadList:!1,customRequest:re},{default:a(()=>[n(i,{type:"primary",preIcon:"ant-design:import-outlined"},{default:a(()=>[f("导入")]),_:1})]),_:1}),n(i,{type:"primary",preIcon:"ant-design:export-outlined",onClick:se},{default:a(()=>[f("导出")]),_:1}),n(i,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[f("同步企微?")]),_:1}),n(i,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[f("同步钉钉?")]),_:1}),l.value.length>0?(m(),D(N,{key:0},{overlay:a(()=>[n(q,null,{default:a(()=>[n(S,{key:"1",onClick:ie},{default:a(()=>[n(C,{icon:"ant-design:delete-outlined"}),Ke]),_:1})]),_:1})]),default:a(()=>[n(i,null,{default:a(()=>[Ae,n(C,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):P("",!0)]),n(ue,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:a(()=>[l.value.length>0?(m(),R(z,{key:0},[y("span",null,"已选中 "+W(l.value.length)+" 条记录",1),n(ce,{type:"vertical"}),y("a",{onClick:t[1]||(t[1]=v=>l.value=[])},"清空")],64)):(m(),R("span",Ie,"未选中任何数据"))]),_:1}),n(fe,{spinning:s.value},{default:a(()=>[n(pe,{placeholder:"按部门名称搜索…",style:{"margin-bottom":"10px"},onSearch:ae}),o.value.length>0?(m(),R(z,{key:0},[K.value?P("",!0):(m(),D(de,{key:0,checkable:"",clickRowToExpand:!1,treeData:o.value,selectedKeys:h.value,checkStrictly:O.value,"load-data":Z,checkedKeys:l.value,expandedKeys:p.value,"onUpdate:expandedKeys":t[3]||(t[3]=v=>p.value=v),onCheck:ne,onSelect:oe},{title:a(({key:v,title:_e,dataRef:j})=>[n(N,{trigger:["contextmenu"]},{overlay:a(()=>[n(q,{onClick:t[2]||(t[2]=()=>{})},{default:a(()=>[n(S,{key:"1",onClick:F=>$(j)},{default:a(()=>[f("添加子级")]),_:2},1032,["onClick"]),n(S,{key:"2",onClick:F=>I.value=v},{default:a(()=>[Se]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(B(we),{visible:I.value===v,title:"确定要删除吗？","ok-text":"确定","cancel-text":"取消",placement:"rightTop",onConfirm:F=>le(j),onVisibleChange:X},{default:a(()=>[y("span",null,W(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(m(),D(me,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"]),n(De,{rootTreeData:o.value,onRegister:B(Y),onSuccess:_},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{Ct as default};
