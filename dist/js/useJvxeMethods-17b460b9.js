var y=(m,f,o)=>new Promise((i,d)=>{var s=r=>{try{n(o.next(r))}catch(l){d(l)}},t=r=>{try{n(o.throw(r))}catch(l){d(l)}},n=r=>r.done?i(r.value):Promise.resolve(r.value).then(s,t);n((o=o.apply(m,f)).next())});import{ap as g}from"./jeecg-online-vendor-d3e1865b.js";import{l as D,u as b}from"./vue-50733b77.js";import{validateFormModelAndTables as w,VALIDATE_FAILED as F}from"./vxeUtils-26061d69.js";import"./antd-vue-vendor-c5335947.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-058e2396.js";import"./vxe-table-vendor-838914b0.js";function N(m,f,o,i,d,s){const t=D();function n(e,a,c,v){c.loading=!0,g.get({url:e,params:a},{isTransformResponse:!1}).then(h=>{let{result:A}=h;h.success&&A&&(Array.isArray(A)?c.dataSource=A:Array.isArray(A.records)&&(c.dataSource=A.records)),typeof v=="function"&&v(h)}).finally(()=>{c.loading=!1})}function r(e){var a,c;(c=(a=o[e])==null?void 0:a.value)==null||c.resetScrollTop(0)}function l(){let e=Object.values(o);return Promise.all(e)}function p(){l().then(e=>{let a=t.value.getFieldsValue();return w(t.value.validate,a,e,t.value.getProps,!1)}).then(e=>s&&typeof s=="function"?s(e):u(e)).then(e=>{if(typeof f!="function")throw T("classifyIntoFormData");let a=f(e);return m(a)}).catch(e=>{e.error===F&&(e.paneKey?i.value=e.paneKey:i.value=e.index==null?b(i):d.value[e.index])})}function u(e){return new Promise(a=>{a(e)})}function T(e){return`${e} 未定义或不是一个函数`}function j(e){return`${e} 未定义或不是一个数组`}return[r,p,n,t]}function V(m,f){function o(){return y(this,null,function*(){let t={},n=Object.keys(f),r="";for(let l=0;l<n.length;l++){r=n[l];let p=f[r].value;if(p.isForm){let u=yield s(p,r);u&&(t[r+"List"]=[u])}else{let u=yield d(p,r);u&&u.length>0&&(t[r+"List"]=u)}}return t})}function i(t){return t&&Object.keys(t).map(n=>{t[n]instanceof Array&&(t[n]=t[n].join(","))}),t}function d(t,n){return y(this,null,function*(){return(yield t.validateTable())?(m.value=n,t.resetScrollTop(0),Promise.reject(1)):t.getTableData()})}function s(t,n){return y(this,null,function*(){try{let r=yield t.getFormData();return i(r),r}catch(r){return m.value=n,Promise.reject(r)}})}return{getSubFormAndTableData:o,transformData:i}}export{N as useJvxeMethod,V as useValidateAntFormAndTable};
