var Ge=Object.defineProperty;var Xe=(n,e,t)=>e in n?Ge(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Oe=(n,e,t)=>(Xe(n,typeof e!="symbol"?e+"":e,t),t);import{Q,h as add}from"./componentMap-5c02cfaf.js";import{aJ as ne$1,F as useModal,E as useModalInner,g as getFileAccessHttpUrl,p as propTypes,d as useDebounceFn}from"./index-b34ff7bc.js";import{l as ref,r as reactive,w as watch,J as toRaw,n as nextTick,e as computed,u as unref,V as resolveComponent,a7 as openBlock,ac as createBlock,a8 as createElementBlock,f as createVNode,d as defineComponent,h as h$1,af as mergeProps,aa as withCtx,E as createTextVNode,ae as toDisplayString,W as createCommentVNode,s as watchEffect,ad as createBaseVNode,F as Fragment,ab as renderList,a4 as useRouter,Y as markRaw,a2 as defineAsyncComponent,ak as normalizeClass}from"./vue-50733b77.js";import{p as pick,da as PrinterOutlined,db as DiffOutlined,cl as FormOutlined,bz as Button,cA as PlusOutlined,dc as EditOutlined,cE as MinusCircleFilled}from"./antd-vue-vendor-c5335947.js";import{B as BasicModal}from"./index-f7d688aa.js";import{bC as replaceAll,u as useUserStore,ap as defHttp,z as usePermissionStore,q as useMessage,bB as h,ao as getToken,bD as goJmReportViewPage,aO as filterMultiDictText,bE as importViewsFile}from"./jeecg-online-vendor-d3e1865b.js";import"./index-7e7a94e9.js";import"./lodash-es-vendor-058e2396.js";import"./index-5593b297.js";import{d as duplicateCheck}from"./user.api-c252cb60.js";import{C as CustomExpression}from"./customExpression-62f5afd1.js";import"./index-f191817e.js";import{useListPage}from"./useListPage-4f9607d2.js";import{R as REGION_DATA}from"./areaDataUtil-5dfcdadb.js";import{U as UploadTypeEnum,c as createImgPreview}from"./JUpload-c8630cc9.js";import v from"./LinkTableListPiece-34266919-7405b407.js";import z from"./OnlineSelectCascade-c7baf52b-e9e1ca05.js";import S from"./JModalTip-abe1515a-57f430d6.js";import{B as BasicForm,u as useForm}from"./useForm-14ceb529.js";import K from"./BasicTable-ca5b2c76.js";class Area{constructor(e){Oe(this,"all");e||(e=REGION_DATA);let t=[];const o=e[86];Object.keys(o).map(c=>{t.push({id:c,text:o[c],pid:"86",index:1});const l=e[c];Object.keys(l).map(i=>{t.push({id:i,text:l[i],pid:c,index:2});const C=e[i];C&&Object.keys(C).map(b=>{t.push({id:b,text:C[b],pid:i,index:3})})})}),this.all=t}get pca(){return this.all}getCode(e){if(!e||e.length==0)return"";for(let t of this.all)if(t.text===e)return t.id}getText(e,t=3){if(!e||e.length==0)return"";let o=[];return this.getAreaBycode(e,o,t),o.join("/")}getRealCode(e){let t=[];return this.getPcode(e,t,3),t}getPcode(e,t,o){for(let c of this.all)c.id===e&&c.index==o&&(t.unshift(e),c.pid!="86"&&this.getPcode(c.pid,t,--o))}getAreaBycode(e,t,o){for(let c of this.all)c.id===e&&c.index==o&&(t.unshift(c.text),c.pid!="86"&&this.getAreaBycode(c.pid,t,--o))}}const jeecgAreaData=new Area,getAreaTextByCode=function(n){let e=3;return n&&n.includes(",")&&(e=n.split(",").length,n=n.substr(n.lastIndexOf(",")+1)),jeecgAreaData.getText(n,e)};var je=Object.defineProperty,We=Object.defineProperties,Je=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,Te=(n,e,t)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ne=(n,e)=>{for(var t in e||(e={}))He.call(e,t)&&Te(n,t,e[t]);if(ve)for(var t of ve(e))Ue.call(e,t)&&Te(n,t,e[t]);return n},pe=(n,e)=>We(n,Je(e)),J=(n,e,t)=>new Promise((o,c)=>{var l=b=>{try{C(t.next(b))}catch(P){c(P)}},i=b=>{try{C(t.throw(b))}catch(P){c(P)}},C=b=>b.done?o(b.value):Promise.resolve(b.value).then(l,i);C((t=t.apply(n,e)).next())});const SUBMIT_FLOW_KEY="jeecg_submit_form_and_flow",SUBMIT_FLOW_ID="flow_submit_id",ONL_FORM_TABLE_NAME="online_form_table_name",VALIDATE_FAILED="validate-failed",SETUP="setup",ENHANCEJS="EnhanceJS",FORM_VIEW_TO_QUERY_VIEW={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},POP_CONTAINER=".jeecg-online-modal .ant-modal-content",ONL_AUTH_PRE="online_";class IFormSchema{constructor(e,t){this._data=t,this.field=e,this.label=t.title,this.hidden=!1,this.order=t.order||999,this.required=!1,this.onlyValidator="",this.setFieldsValue="",this.hasChange=!0,e.indexOf("@")>0?this.pre=e.substring(0,e.indexOf("@")+1):this.pre="",this.schemaProp={},this.searchForm=!1,this.disabled=!1,this.popContainer="",this.handleWidgetAttr(t),this.inPopover=!1,this.labelLength=4,this.initLabelLength()}getFormItemSchema(){let e=this.getItem();return this.addDefaultChangeEvent(e),e}getItem(){let e={field:this.field,label:this.label,labelLength:this.labelLength,component:"Input",itemProps:{labelCol:{class:"online-form-label"}}},t=this.getRule();return t.length>0&&this.onlyValidator&&(e.rules=t),this.hidden===!0&&(e.show=!1),e}setFormRef(e){this.formRef=e}isHidden(){return this.hidden=!0,this}isRequired(e){return e&&e.length>0&&e.indexOf(this.field)>=0&&(this.required=!0),this}initLabelLength(){let e=this.getExtendData();e&&e.labelLength&&(this.labelLength=e.labelLength)}getExtendData(){let e={},{fieldExtendJson:t}=this._data;if(t&&typeof t=="string")try{let o=JSON.parse(t);e=ne({},o)}catch(o){}return e}getRelatedHideFields(){return[]}getPlaceholder(){return"请输入"+this.label}setOnlyValidateFun(e){e&&(this.onlyValidator=(t,o)=>J(this,null,function*(){let c=yield e(t,o);return c?Promise.reject(c):Promise.resolve()}))}getRule(){let e=[];const{view:t,errorInfo:o,pattern:c,type:l}=this._data;if(this.required===!0){let i=this.getPlaceholder();o&&(i=o),t=="sel_depart"||t=="sel_user"?this.schemaProp.required=!0:e.push({required:!0,message:i})}if(t=="sel_user"&&c==="only"&&this.onlyValidator&&e.push({validator:this.onlyValidator}),t==="list"||t==="radio"||t==="markdown"||t==="pca"||t.indexOf("sel")>=0||t==="time"||t.indexOf("upload")>=0||t.indexOf("file")>=0||t.indexOf("image")>=0)return e;if(c)if(c==="only")this.onlyValidator&&e.push({validator:this.onlyValidator});else if(c==="z")l=="number"||l=="integer"||e.push({pattern:/^-?\d+$/,message:"请输入整数"});else{let i=o||"正则表达式不正确";e.push({pattern:c,message:i})}return e}addDefaultChangeEvent(e){this.hasChange&&(e.componentProps||(e.componentProps={}),this.disabled==!0&&(e.componentProps.disabled=!0),e.componentProps.hasOwnProperty("onChange")||(e.componentProps.onChange=(t,o)=>{t instanceof Event&&(t=t.target.value),t instanceof Array&&(t=t.join(",")),!this.formRef||!this.formRef.value||!this.formRef.value.$formValueChange||this.formRef.value.$formValueChange(this.field,t,o)})),Object.keys(this.schemaProp).map(t=>{e[t]=this.schemaProp[t]})}noChange(){this.hasChange=!1}updateField(e){this.field=e}setFunctionForFieldValue(e){e&&(this.setFieldsValue=e)}asSearchForm(){this.searchForm=!0}getModalAsContainer(){let e=this.getPopContainer();return document.querySelector(e)}getPopContainer(){return this.searchForm===!0?"body":this.inPopover===!0?`.${this.popContainer}`:this.popContainer?`.${this.popContainer} .ant-modal-content`:POP_CONTAINER}handleWidgetAttr(e){e.ui&&e.ui.widgetattrs&&e.ui.widgetattrs.disabled==!0&&(this.disabled=!0)}setCustomPopContainer(e){this.popContainer=e}getLinkFieldInfo(){return""}setOtherInfo(e){}isInPopover(){this.inPopover=!0}}class InputWidget extends IFormSchema{getItem(){let e=super.getItem();return this.hidden===!0&&(e.show=!1),e}}var DateFormat=(n=>(n.datetime="YYYY-MM-DD HH:mm:ss",n.date="YYYY-MM-DD",n))(DateFormat||{});class DateWidget extends IFormSchema{constructor(e,t){super(e,t),this.format=DateFormat[t.view],this.showTime=t.view!="date"}getItem(){let e=super.getItem();return Object.assign({},e,{component:"DatePicker",componentProps:{placeholder:`请选择${this.label}`,showTime:this.showTime,valueFormat:this.format,style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()}})}}class SelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum,t.type),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.multi=t.multi||!1}getItem(){let e=super.getItem(),t=this.getFormComponent(),o=this.getComponentProps();return Object.assign({},e,{component:t,componentProps:o})}getFormComponent(){return this.options.length>0?"Select":"JDictSelectTag"}getComponentProps(){let e={allowClear:!0,mode:this.multi===!0?"multiple":"combobox",style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()};if(this.options.length>0)e.options=this.options;else if(!this.dictTable)e.dictCode=this.dictCode;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e}getOptions(e,t){if(!e||e.length==0)return[];let o=t=="number",c=[];for(let l of e){let i=l.value;o&&(i=parseInt(i)),c.push({value:i,label:l.title})}return c}}class PasswordWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputPassword"})}}class FileWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e=this.getExtendData();return e&&e.uploadnum?{maxCount:Number(e.uploadnum)}:{}}}class ImageWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e={fileType:UploadTypeEnum.image},t=this.getExtendData();return t&&t.uploadnum&&(e.maxCount=Number(t.uploadnum)),e}}class TextAreaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputTextArea",componentProps:{autoSize:{minRows:4,maxRows:10}}})}}class SelectMultiWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectMultiple",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};{let e={};if(!this.dictTable)e.dictCode=this.dictCode;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e.triggerChange=!0,e.popContainer=this.getPopContainer(),e}}}class SelectSearchWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=encodeURI(`${t.dictTable},${t.dictText},${t.dictCode}`)}getItem(){let e=super.getItem(),t=this.getPopContainer();return Object.assign({},e,{component:"JSearchSelect",componentProps:{dict:this.dict,pageSize:6,async:!0,popContainer:t}})}}class PopupWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.multi=t.popupMulti,this.fieldConfig=this.getFieldConfig(t)}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JPopup",componentProps:t})}getComponentProps(){let e={code:this.code,multi:this.multi,fieldConfig:this.fieldConfig};return this.formRef?e.formElRef=this.formRef:e.setFieldsValue=this.setFieldsValue,this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}getFieldConfig(e){let{destFields:t,orgFields:o}=e;if(!t||t.length==0)return[];let c=t.split(","),l=o.split(","),i=[];const C=this.pre;for(let b=0;b<c.length;b++)i.push({target:C+c[b],source:l[b]});return i}}class TreeCategoryWidget extends IFormSchema{constructor(e,t){super(e,t),this.multi=!1,this.pid=t.pidValue,this.pcode=t.pcode,this.textField=t.textField}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{componentProps:t,component:"JCategorySelect"})}getComponentProps(){let e={placeholder:"请选择"+this.label};if(this.pcode)e.pcode=this.pcode;else{let t=this.pid||"EMPTY_PID";e.pid=t}return this.textField?pe(ne({loadTriggleChange:!0,multiple:this.multi},e),{back:this.textField,onChange:(t,o)=>{this.formRef&&(this.formRef.value.setFieldsValue(o),this.formRef.value.$formValueChange(this.field,t))}}):ne({multiple:this.multi},e)}getRelatedHideFields(){let e=[];return this.textField&&e.push(this.textField),e}}class SelectDepartWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectDept",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={checkStrictly:!0,showButton:!1};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.multiple=!1),e.multiSelect===!0&&(t.multiple=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class SelectUserWidget extends IFormSchema{constructor(e,t){super(e,t),this.showButton=t.showButton!==!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectUser",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={showSelected:!1,allowClear:!0,isRadioSelection:!1,showButton:this.showButton};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.isRadioSelection=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class EditorWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JEditor",componentProps:{options:{auto_focus:!1}}})}}class MarkdownWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JMarkdownEditor",componentProps:{}})}}class PcaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JAreaSelect"})}}class TreeSelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=t.dict,this.pidField=t.pidField,this.pidValue=t.pidValue}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JTreeSelect",componentProps:{dict:this.dict,pidField:this.pidField,pidValue:this.pidValue}})}}class RadioWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JDictSelectTag",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};if(this.dictTable){let e=`${this.dictTable},${this.dictText},${this.dictCode}`;return{dictCode:encodeURI(e),type:"radio"}}else return{dictCode:this.dictCode,type:"radio"}}}class CheckboxWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum)}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JCheckbox",componentProps:{options:this.options,triggerChange:!0}})}getOptions(e){if(!e||e.length==0)return[];let t=[];for(let o of e)t.push({value:o.value,label:o.title});return t}}class SwitchWidget extends IFormSchema{constructor(e,t){super(e,t),this.hasChange=!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSwitch",componentProps:t})}getComponentProps(){let{fieldExtendJson:e}=this._data,t=["Y","N"];if(e&&typeof e=="string"){let o=JSON.parse(e);o.length==2&&(t=o)}return{options:t}}}class TimeWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"TimePicker",componentProps:{placeholder:`请选择${this.label}`,valueFormat:"HH:mm:ss",getPopupContainer:t=>this.getModalAsContainer(),style:{width:"100%"}}})}}class LinkDownWidget extends IFormSchema{constructor(e,t){super(e,t);const{dictTable:o,dictText:c,dictCode:l,pidField:i,idField:C,origin:b,condition:P}=t;this.table=o,this.txt=c,this.store=l,this.idField=C,this.pidField=i,this.origin=b,this.condition=P,this.options=[],this.next=t.next||"",this.type=t.type}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"OnlineSelectCascade",componentProps:t})}getComponentProps(){let e={table:this.table,txt:this.txt,store:this.store,pidField:this.pidField,idField:this.idField,origin:this.origin,pidValue:"-1",style:{width:"100%"},onChange:t=>{this.valueChange(t)},onNext:t=>{this.nextOptionsChange(t)}};return this._data.origin===!0&&(e.condition=this.condition),e}nextOptionsChange(e){return J(this,null,function*(){this.formRef&&this.next&&(yield this.formRef.value.updateSchema({field:this.next,componentProps:{pidValue:e}}))})}valueChange(e){return J(this,null,function*(){if(!this.formRef||!this.next)return;let t=this.formRef.value;t.$formValueChange(this.field,e),yield t.setFieldsValue({[this.next]:""})})}}class SlotWidget extends IFormSchema{constructor(e,t){super(e,t),this.slot=""}getItem(){let e=super.getItem(),t=this.slot;return Object.assign({},e,{slot:t})}groupDate(){return this.slot="groupDate",this}groupDatetime(){return this.slot="groupDatetime",this}groupNumber(){return this.slot="groupNumber",this}}class NumberWidget extends IFormSchema{constructor(e,t){super(e,t),this.dbPointLength=t.dbPointLength}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"InputNumber",componentProps:t})}getComponentProps(){const e={style:{width:"100%"}};return this.dbPointLength>=0&&(e.precision=this.dbPointLength),e}}class LinkTableWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.view=t.view,this.componentString="",this.linkFields=[]}getItem(){let e=super.getItem();const t=this.getComponentProps();return Object.assign({},e,{component:this.componentString,componentProps:t})}getComponentProps(){let e={textField:this.dictText,tableName:this.dictTable,valueField:this.dictCode},t=this.getExtendData();if(t.multiSelect?e.multi=!0:e.multi=!1,t.imageField?e.imageField=t.imageField:e.imageField="",t.showType=="select"){this.componentString="LinkTableSelect";let o=this.getPopContainer();e.popContainer=o}else this.componentString="LinkTableCard";return this.linkFields.length>0&&(e.linkFields=this.linkFields),e}setOtherInfo(e){this.linkFields=e}}class LinkTableFieldWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText}getItem(){let e=super.getItem();return Object.assign({},e,{componentProps:{readOnly:!0,allowClear:!1,disabled:!0,style:{background:"none",color:"rgba(0, 0, 0, 0.85)",border:"none"}}})}getLinkFieldInfo(){return[this.dictTable,`${this.field},${this.dictText}`]}}class LinkTableForQueryWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.titleField=t.titleField,this.multi=t.multi||!1}getItem(){let e=super.getItem();return Object.assign({},e,{component:"LinkTableForQuery",componentProps:{code:this.code,multi:this.multi,field:this.titleField,style:{width:"100%"}}})}}class CascaderPcaForQueryWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"CascaderPcaForQuery",componentProps:{style:{width:"100%"}}})}}class SelectUser2Widget extends IFormSchema{constructor(e,t){super(e,t),this.multi=t.multi===!0,this.store=t.store||"",this.query=t.query||!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"UserSelect",componentProps:t})}getComponentProps(){let e={multi:this.multi,store:this.store,query:this.query};return this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}}class RangeWidget extends IFormSchema{constructor(e,t){super(e,t);let o=t.view;this.format=t.format,this.datetime=!1,o==="rangeNumber"?this.componentType="JRangeNumber":o==="rangeTime"?this.componentType="RangeTime":(this.componentType="RangeDate",t.datetime===!0&&(this.datetime=!0))}getItem(){let e=super.getItem();return Object.assign({},e,{component:this.componentType,componentProps:{datetime:this.datetime,format:this.format,getPopupContainer:t=>this.getModalAsContainer()}})}}class FormSchemaFactory{static createFormSchema(e,t){switch(t.view){case"password":return new PasswordWidget(e,t);case"list":return new SelectWidget(e,t);case"radio":return new RadioWidget(e,t);case"checkbox":return new CheckboxWidget(e,t);case"date":case"datetime":return new DateWidget(e,t);case"time":return new TimeWidget(e,t);case"file":return new FileWidget(e,t);case"image":return new ImageWidget(e,t);case"textarea":return new TextAreaWidget(e,t);case"list_multi":return new SelectMultiWidget(e,t);case"sel_search":return new SelectSearchWidget(e,t);case"popup":return new PopupWidget(e,t);case"cat_tree":return new TreeCategoryWidget(e,t);case"sel_depart":return new SelectDepartWidget(e,t);case"sel_user":return new SelectUserWidget(e,t);case"umeditor":return new EditorWidget(e,t);case"markdown":return new MarkdownWidget(e,t);case"pca":return new PcaWidget(e,t);case"link_down":return new LinkDownWidget(e,t);case"sel_tree":return new TreeSelectWidget(e,t);case"switch":return new SwitchWidget(e,t);case"link_table":return new LinkTableWidget(e,t);case"link_table_field":return new LinkTableFieldWidget(e,t);case"slot":return new SlotWidget(e,t);case"LinkTableForQuery":return new LinkTableForQueryWidget(e,t);case"CascaderPcaForQuery":return new CascaderPcaForQueryWidget(e,t);case"select_user2":return new SelectUser2Widget(e,t);case"rangeDate":case"rangeTime":case"rangeNumber":return new RangeWidget(e,t);case"hidden":return new InputWidget(e,t).isHidden();default:return t.type=="number"?new NumberWidget(e,t):new InputWidget(e,t)}}static createSlotFormSchema(e,t){let o=new SlotWidget(e,t),c=t.view;if(c=="date")o.groupDate();else if(c=="datetime")o.groupDatetime();else{let l=t.type;(l=="number"||l=="integer")&&o.groupNumber()}return o}static createIdField(){return{label:"",field:"id",component:"Input",show:!1}}}var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var dayjs_min={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(commonjsGlobal,function(){var t=1e3,o=6e4,c=36e5,l="millisecond",i="second",C="minute",b="hour",P="day",k="week",w="month",E="quarter",T="year",A="date",N="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(u){var a=["th","st","nd","rd"],r=u%100;return"["+u+(a[(r-20)%10]||a[r]||a[0])+"]"}},O=function(u,a,r){var p=String(u);return!p||p.length>=a?u:""+Array(a+1-p.length).join(r)+u},H={s:O,z:function(u){var a=-u.utcOffset(),r=Math.abs(a),p=Math.floor(r/60),m=r%60;return(a<=0?"+":"-")+O(p,2,"0")+":"+O(m,2,"0")},m:function u(a,r){if(a.date()<r.date())return-u(r,a);var p=12*(r.year()-a.year())+(r.month()-a.month()),m=a.clone().add(p,w),F=r-m<0,M=a.clone().add(p+(F?-1:1),w);return+(-(p+(r-m)/(F?m-M:M-m))||0)},a:function(u){return u<0?Math.ceil(u)||0:Math.floor(u)},p:function(u){return{M:w,y:T,w:k,d:P,D:A,h:b,m:C,s:i,ms:l,Q:E}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(u){return u===void 0}},U="en",B={};B[U]=$;var L=function(u){return u instanceof D},f=function u(a,r,p){var m;if(!a)return U;if(typeof a=="string"){var F=a.toLowerCase();B[F]&&(m=F),r&&(B[F]=r,m=F);var M=a.split("-");if(!m&&M.length>1)return u(M[0])}else{var Y=a.name;B[Y]=a,m=Y}return!p&&m&&(U=m),m||!p&&U},x=function(u,a){if(L(u))return u.clone();var r=typeof a=="object"?a:{};return r.date=u,r.args=arguments,new D(r)},y=H;y.l=f,y.i=L,y.w=function(u,a){return x(u,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var D=function(){function u(r){this.$L=f(r.locale,null,!0),this.parse(r)}var a=u.prototype;return a.parse=function(r){this.$d=function(p){var m=p.date,F=p.utc;if(m===null)return new Date(NaN);if(y.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var M=m.match(R);if(M){var Y=M[2]-1||0,q=(M[7]||"0").substring(0,3);return F?new Date(Date.UTC(M[1],Y,M[3]||1,M[4]||0,M[5]||0,M[6]||0,q)):new Date(M[1],Y,M[3]||1,M[4]||0,M[5]||0,M[6]||0,q)}}return new Date(m)}(r),this.$x=r.x||{},this.init()},a.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},a.$utils=function(){return y},a.isValid=function(){return this.$d.toString()!==N},a.isSame=function(r,p){var m=x(r);return this.startOf(p)<=m&&m<=this.endOf(p)},a.isAfter=function(r,p){return x(r)<this.startOf(p)},a.isBefore=function(r,p){return this.endOf(p)<x(r)},a.$g=function(r,p,m){return y.u(r)?this[p]:this.set(m,r)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(r,p){var m=this,F=!!y.u(p)||p,M=y.p(r),Y=function(j,Z){var ie=y.w(m.$u?Date.UTC(m.$y,Z,j):new Date(m.$y,Z,j),m);return F?ie:ie.endOf(P)},q=function(j,Z){return y.w(m.toDate()[j].apply(m.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(Z)),m)},G=this.$W,X=this.$M,re=this.$D,de="set"+(this.$u?"UTC":"");switch(M){case T:return F?Y(1,0):Y(31,11);case w:return F?Y(1,X):Y(0,X+1);case k:var se=this.$locale().weekStart||0,ue=(G<se?G+7:G)-se;return Y(F?re-ue:re+(6-ue),X);case P:case A:return q(de+"Hours",0);case b:return q(de+"Minutes",1);case C:return q(de+"Seconds",2);case i:return q(de+"Milliseconds",3);default:return this.clone()}},a.endOf=function(r){return this.startOf(r,!1)},a.$set=function(r,p){var m,F=y.p(r),M="set"+(this.$u?"UTC":""),Y=(m={},m[P]=M+"Date",m[A]=M+"Date",m[w]=M+"Month",m[T]=M+"FullYear",m[b]=M+"Hours",m[C]=M+"Minutes",m[i]=M+"Seconds",m[l]=M+"Milliseconds",m)[F],q=F===P?this.$D+(p-this.$W):p;if(F===w||F===T){var G=this.clone().set(A,1);G.$d[Y](q),G.init(),this.$d=G.set(A,Math.min(this.$D,G.daysInMonth())).$d}else Y&&this.$d[Y](q);return this.init(),this},a.set=function(r,p){return this.clone().$set(r,p)},a.get=function(r){return this[y.p(r)]()},a.add=function(r,p){var m,F=this;r=Number(r);var M=y.p(p),Y=function(X){var re=x(F);return y.w(re.date(re.date()+Math.round(X*r)),F)};if(M===w)return this.set(w,this.$M+r);if(M===T)return this.set(T,this.$y+r);if(M===P)return Y(1);if(M===k)return Y(7);var q=(m={},m[C]=o,m[b]=c,m[i]=t,m)[M]||1,G=this.$d.getTime()+r*q;return y.w(G,this)},a.subtract=function(r,p){return this.add(-1*r,p)},a.format=function(r){var p=this,m=this.$locale();if(!this.isValid())return m.invalidDate||N;var F=r||"YYYY-MM-DDTHH:mm:ssZ",M=y.z(this),Y=this.$H,q=this.$m,G=this.$M,X=m.weekdays,re=m.months,de=m.meridiem,se=function(Z,ie,oe,ee){return Z&&(Z[ie]||Z(p,F))||oe[ie].slice(0,ee)},ue=function(Z){return y.s(Y%12||12,Z,"0")},j=de||function(Z,ie,oe){var ee=Z<12?"AM":"PM";return oe?ee.toLowerCase():ee};return F.replace(I,function(Z,ie){return ie||function(oe){switch(oe){case"YY":return String(p.$y).slice(-2);case"YYYY":return y.s(p.$y,4,"0");case"M":return G+1;case"MM":return y.s(G+1,2,"0");case"MMM":return se(m.monthsShort,G,re,3);case"MMMM":return se(re,G);case"D":return p.$D;case"DD":return y.s(p.$D,2,"0");case"d":return String(p.$W);case"dd":return se(m.weekdaysMin,p.$W,X,2);case"ddd":return se(m.weekdaysShort,p.$W,X,3);case"dddd":return X[p.$W];case"H":return String(Y);case"HH":return y.s(Y,2,"0");case"h":return ue(1);case"hh":return ue(2);case"a":return j(Y,q,!0);case"A":return j(Y,q,!1);case"m":return String(q);case"mm":return y.s(q,2,"0");case"s":return String(p.$s);case"ss":return y.s(p.$s,2,"0");case"SSS":return y.s(p.$ms,3,"0");case"Z":return M}return null}(Z)||M.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(r,p,m){var F,M=this,Y=y.p(p),q=x(r),G=(q.utcOffset()-this.utcOffset())*o,X=this-q,re=function(){return y.m(M,q)};switch(Y){case T:F=re()/12;break;case w:F=re();break;case E:F=re()/3;break;case k:F=(X-G)/6048e5;break;case P:F=(X-G)/864e5;break;case b:F=X/c;break;case C:F=X/o;break;case i:F=X/t;break;default:F=X}return m?F:y.a(F)},a.daysInMonth=function(){return this.endOf(w).$D},a.$locale=function(){return B[this.$L]},a.locale=function(r,p){if(!r)return this.$L;var m=this.clone(),F=f(r,p,!0);return F&&(m.$L=F),m},a.clone=function(){return y.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},u}(),d=D.prototype;return x.prototype=d,[["$ms",l],["$s",i],["$m",C],["$H",b],["$W",P],["$M",w],["$y",T],["$D",A]].forEach(function(u){d[u[1]]=function(a){return this.$g(a,u[0],u[1])}}),x.extend=function(u,a){return u.$i||(u(a,D,x),u.$i=!0),x},x.locale=f,x.isDayjs=L,x.unix=function(u){return x(1e3*u)},x.en=B[U],x.Ls=B,x.p={},x})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;const dayjs=getDefaultExportFromCjs(dayjs_minExports),ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(n=>CustomExpression[n]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(n,e,t){hasEffectiveValue(e.defVal)&&t.push({field:n,type:e.type,value:e.defVal})}function initSubTableDefValueConfig(n,e){hasEffectiveValue(n.fieldDefaultValue)&&e.push({field:n.key,type:n.type,value:n.fieldDefaultValue})}function loadFormFieldsDefVal(n,e,t){return J(this,null,function*(){if(Array.isArray(n)&&n.length>0){let o={};for(let c of n){let{value:l,type:i,field:C}=c;l=yield handleDefaultValue(l,ACTION_TYPES.ADD,t||{}),i==="number"&&l&&(l=Number.parseFloat(l)),o[C]=l}e(o)}})}function loadOneFieldDefVal(n,e,t){return J(this,null,function*(){let{defVal:o,type:c}=e;if(hasEffectiveValue(o)){let l=yield handleDefaultValue(o,ACTION_TYPES.ADD,{});c==="number"&&l&&(l=Number.parseFloat(l)),t[n]=l}})}function hasEffectiveValue(n){return!!(n||n===0)}function handleDefaultValue(n,e,t){return J(this,null,function*(){if(n!=null&&checkExpressionType(n)){let o=yield getDefaultValue(n,e,t);if(o!=null)return o}return n})}function checkExpressionType(n){let e=0,t=0,o=0;if(n.replace(fillRuleRegExp,()=>o++),o>1)return`${n}`,!1;n.replace(normalRegExp,()=>e++),n.replace(customRegExp,()=>t++);let c=e+t;return o>0&&c>0?(`${n}`,!1):!0}function getRegExpMap(n,e){let t=new Map;return n.replace(e,function(o,c){return t.set(o,c.trim()),o}),t}function getDefaultValue(n,e,t){return J(this,null,function*(){return(e===ACTION_TYPES.ADD||e===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(n)?yield executeRegExp(n,fillRuleRegExp,executeFillRuleExpression,[t]):e===ACTION_TYPES.ADD?(n=yield executeRegExp(n,normalRegExp,executeNormalExpression),n=yield executeRegExp(n,customRegExp,executeCustomExpression),n):null})}function executeRegExp(n,e,t){return J(this,arguments,function*(o,c,l,i=[]){let C=getRegExpMap(o,c);for(let b of C.keys()){let P=C.get(b),k=yield l.apply(null,[P,b,...i]);if(b===o)return k;o=replaceAll(o,b,k)}return o})}function executeNormalExpression(n,e){return J(this,null,function*(){switch(n){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let t=getUserInfoByExpression(n);return t!=null?t:e}})}function getUserInfoByExpression(n){let e=useUserStore().getUserInfo;if(e)switch(n){case"sysUserId":return e.id;case"sysUserCode":case"sys_user_code":return e.username;case"sysUserName":return e.realname;case"sysOrgCode":case"sys_org_code":return e.orgCode}return null}function executeCustomExpression(expression,origin){return J(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(n){return origin}})}function executeFillRuleExpression(n,e,t){return J(this,null,function*(){let o=`/sys/fillRule/executeRuleByCode/${n}`,c={};typeof t=="function"?c=t():t&&(c=ne({},t));let{success:l,message:i,result:C}=yield defHttp.put({url:o,params:c},{isTransformResponse:!1});return l?C:(`${n}${i}`,e)})}function logWarn(n){}function logError(n){}const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(n,e){useExtendComponent();const t=n.modalClass,o=ref([]),c=ref(""),l=ref({}),i=reactive({}),C=ref(!1),b=ref([]),P=ref({}),k={},w=ref([]),E=reactive({}),T=ref("");T.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function A(O,H,U){clearObj(E),E[c.value]=[];let B=[],L=[],f=[],x={},y={};Object.keys(O).map(d=>{const u=O[d];if(u.view=="tab"){C.value=!0,E[d]=[];let a={key:d,foreignKey:u.foreignKey,describe:u.describe,relationType:u.relationType,requiredFields:u.required||[],order:u.order,id:u.id};u.relationType==1?(k[d]=ref(null),a.properties=u.properties):(N(u),k[d]=ref(),a.columns=u.columns,x[d]=[]),B.push(a),handleSubTableButtonAuth(d,u)}else if(initDefValueConfig(d,u,E[c.value]),u.view===LINK_DOWN){let a=handleLinkDown(u,d);for(let r of a){i[r.key]=!0,i[r.key+"_load"]=!0;let p=FormSchemaFactory.createFormSchema(r.key,r);U&&p.setOnlyValidateFun(U),p.isRequired(H),p.setFormRef(e),p.handleWidgetAttr(u);let m=getFieldIndex(L,r.key);m==-1?L.push(p):L[m]=p}}else if(i[d]=!0,i[d+"_load"]=!0,getFieldIndex(L,d)==-1){let a=FormSchemaFactory.createFormSchema(d,u);if(U&&a.setOnlyValidateFun(U),a.isRequired(H),a.setFormRef(e),L.push(a),f.push(...a.getRelatedHideFields()),u.view===LINK_TABLE_FIELD){let r=a.getLinkFieldInfo();r&&(y[r[0]]?y[r[0]].push(r[1]):y[r[0]]=[r[1]])}}}),L.sort(function(d,u){return d.order-u.order});let D=[];D.push(FormSchemaFactory.createIdField());for(let d of L)d.view&&d.view==LINK_TABLE&&y[d.field]&&d.setOtherInfo(y[d.field]),f.indexOf(d.field)>=0&&d.isHidden(),t&&d.setCustomPopContainer(t),D.push(d.getFormItemSchema());o.value=D,B.sort(function(d,u){return d.order-u.order}),b.value=B,P.value=x}watch(i,O=>{let H=e.value,U=[],B=toRaw(O);Object.keys(B).map(L=>{if(!L.endsWith("_load")){let f={field:L,show:B[L]},x=L+"_load";B.hasOwnProperty(x)&&(f.ifShow=B[x]),U.push(f)}}),H&&H.updateSchema(U)},{immediate:!1});function N(O){useOnlineVxeTableColumns(O,H=>{initSubTableDefValueConfig(H,E[O.key])})}watch(()=>n.formTemplate,()=>{T.value=R()},{immediate:!0});function R(){let O=n.formTemplate;return O==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:O==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:O==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{sm:24,xs:24,md:24,lg:24,xl:24,xxl:24}}function I(O,H){return new Promise(U=>{H||U("");let B={tableName:c.value.replace(/\$\d+/,""),fieldName:O.field,fieldVal:H},L=l.value;L.id&&(B.dataId=L.id),duplicateCheck(B).then(f=>{f.success?U(""):U(f.message)}).catch(f=>{U(f)})})}function $(O){return Object.keys(O).map(H=>{O[H]&&O[H]instanceof Array&&(O[H]=O[H].join(","))}),O}return{formSchemas:o,defaultValueFields:E,tableName:c,dbData:l,checkOnlyFieldValue:I,createFormSchemas:A,fieldDisplayStatus:i,subTabInfo:b,hasSubTable:C,subDataSource:P,baseColProps:T,changeDataIfArray2String:$,linkDownList:w,refMap:k}}function useOnlineVxeTableColumns(n,e){const t={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};n.columns.forEach(l=>{l.type==="radio"?l.type="select":t[l.type]?l.type=t[l.type]:l.type==="popup"&&o(l),l.type==="depart-select"&&(l.checkStrictly=!0),l.type==="user-select"&&c(l),l.type==="pca"&&(l.width="230px"),(l.width==120||l.width=="120px")&&(l.type=="image"||l.type=="file")&&(l.width="130px"),l.width||(l.width="200px"),e&&e(l)});function o(l){let{destFields:i,orgFields:C}=l,b=[];if(!(!i||i.length==0)){let P=i.split(","),k=C.split(",");for(let w=0;w<P.length;w++)b.push({target:P[w],source:k[w]})}l.fieldConfig=b}function c(l){let i=l.fieldExtendJson,C=!1;if(i)try{JSON.parse(i).multiSelect===!1&&(C=!0)}catch(b){}l.isRadioSelection=C}}function useOnlineFormContext(){let n={};const e={addSubRows:"<m> 一对多子表，新增自定义行",changeOptions:"<m> 改变下拉框选项",clearSubRows:"<m> 清空一对多子表行",clearThenAddRows:"<m> 清空一对多子表行，然后新增自定义行",executeMainFillRule:"<m> 刷新主表的增值规制值",executeSubFillRule:"<m> 刷新子表的增值规制值",getFieldsValue:"<m> 获取表单控件的值",getSubTableInstance:"<m> 获取子表实例",isUpdate:"<p> 判断是否为编辑模式",loading:"<p> 页面加载状态",onlineFormRef:"<p> 当前表单ref对象",refMap:"<p> 子表ref对象map",setFieldsValue:"<m> 设置表单控件的值",sh:"<p> 表单控件的显示隐藏状态",subActiveKey:"<p> 子表激活tab，对应子表表名",subFormHeight:"<p> 一对一子表表单高度",submitFlowFlag:"<p> 是否提交流程状态",subTableHeight:"<p> 一对多子表表格高度",tableName:"<p> 当前表名",triggleChangeValues:"<m> 修改多个表单值",triggleChangeValue:"<m> 修改表单值",updateSchema:"<m> 修改表单控件配置"},t=new Proxy(e,{get(l,i){return Reflect.get(n,i)}});function o(l,i){n[l]=i}function c(l){Object.keys(l).map(i=>{n[i]=l[i]})}return o("$nextTick",nextTick),o("addObject2Context",o),{onlineFormContext:t,addObject2Context:o,resetContext:c}}function handleLinkDown(n,e){const{config:{table:t,key:o,txt:c,linkField:l,idField:i,pidField:C,condition:b},others:P,order:k,title:w}=n;let E={dictTable:t,dictText:c,dictCode:o,pidField:C,idField:i,view:LINK_DOWN,type:n.type},T=[],A=ne({key:e,title:w,order:k,condition:b,origin:!0},E);if(l&&l.length>0){let N=l.split(",");A.next=N[0];for(let R=0;R<N.length;R++)for(let I of P)if(I.field==N[R]){let $=ne({key:I.field,title:I.title,order:I.order,origin:!1},E);R+1<N.length&&($.next=N[R+1]),T.push($)}}return T.push(A),T}function getFieldIndex(n,e){let t=-1;for(let o=0;o<n.length;o++)if(n[o].field===e){t=o;break}return t}function getRefPromise(n){return new Promise(e=>{(function t(){let o=n.value;o?e(o):setTimeout(()=>{t()},100)})()})}function clearObj(n){Object.keys(n).map(e=>{delete n[e]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(n,e){let t=e.hideButtons,o=ONL_AUTH_PRE+n+":";t||(t=[]),permissionStore.setOnlineSubTableAuth(o,t)}function getDetailFormSchemas(n){const e=ref([]),t={},o=reactive({}),c=ref(!1),l=ref([]),i=ref({}),C=computed(()=>{let E=n.formTemplate;return E=="2"?12:E=="3"?8:E=="4"?6:24});function b(E){let T=[],A=[],N={};Object.keys(E).map(R=>{const I=E[R];if(I.view=="tab"){c.value=!0;let $={key:R,foreignKey:I.foreignKey,describe:I.describe,relationType:I.relationType,requiredFields:I.required||[],order:I.order};I.relationType==1?(t[R]=ref(null),$.properties=I.properties):(P(I),t[R]=ref(),$.columns=I.columns,N[R]=[],o[R]=!1),T.push($)}else if(I.view===LINK_DOWN){let $=w(I,R);for(let O of $){let H=k(A,O.key),U={field:O.key,label:O.title,view:O.view,order:O.order,dictTable:O.dictTable,linkField:O.linkField||""};H==-1?A.push(U):A[H]=U}}else if(I.view!="hidden"&&k(A,R)==-1){let $=Object.assign({field:R,label:I.title},pick(I,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(I.view=="file"&&($.span=24,$.isFile=!0),I.view=="image"&&($.span=24,$.isImage=!0),I.view=="link_table"&&I.fieldExtendJson)try{let O=JSON.parse(I.fieldExtendJson);O.showType!="select"&&($.isCard=!0),O.multiSelect==!0&&($.multi=!0)}catch(O){}(I.view=="umeditor"||I.view=="markdown")&&($.isHtml=!0,$.span=24),A.push($)}}),A.sort(function(R,I){return R.order-I.order}),T.sort(function(R,I){return R.order-I.order}),l.value=T;for(let R=0;R<A.length;R++){let I=A[R];if((I.isFile===!0||I.isImage===!0||I.isHtml===!0)&&R>0){let $=A[R-1],O=$.span||C.value;$.span=O}}e.value=A,i.value=N}function P(E){useOnlineVxeTableColumns(E)}function k(E,T){let A=-1;for(let N=0;N<E.length;N++)if(E[N].field===T){A=N;break}return A}function w(E,T){let A=[];const{config:{table:N,key:R,txt:I,linkField:$},order:O,title:H,others:U}=E;let B={view:"link_down",order:O,title:H,dictTable:JSON.stringify({table:N,key:R,txt:I})};if(A.push(Object.assign({},{linkField:$,key:T},B)),$){let L=$.split(",");for(let f of L){let x="";for(let y of U)y.field==f&&(x=y.title);A.push(Object.assign({},{key:f},B,{title:x}))}}return A}return{detailFormSchemas:e,hasSubTable:c,subTabInfo:l,refMap:t,showStatus:o,createFormSchemas:b,formSpan:C,subDataSource:i}}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(n,e)=>defHttp.get({url:n,params:e},{isTransformResponse:!1}),postAction=(n,e)=>defHttp.post({url:n,params:e},{isTransformResponse:!1}),putAction=(n,e)=>defHttp.put({url:n,params:e},{isTransformResponse:!1}),deleteAction=(n,e)=>defHttp.delete({url:n,params:e},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(n,e){EnhanceJS&&EnhanceJS[e]&&EnhanceJS[e](n)}function customBeforeSubmit(n,e){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(n,e):Promise.resolve()}function beforeDelete(n,e){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(n,e):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeDelete?e.beforeDelete(onlineTableContext,n):Promise.resolve()},onlineTableContext.beforeEdit=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeEdit?e.beforeEdit(onlineTableContext,n):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading:ne$1},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(n,{emit:e}){const t=ref(null),o=ref(!1);useMessage();const{formSchemas:c,defaultValueFields:l,changeDataIfArray2String:i,tableName:C,dbData:b,checkOnlyFieldValue:P,fieldDisplayStatus:k,createFormSchemas:w,baseColProps:E}=useFormItems(n,t),[T,{setProps:A,validate:N,resetFields:R,setFieldsValue:I,getFieldsValue:$}]=useForm({schemas:c,showActionButtonGroup:!1,baseColProps:E});watch(()=>n.table,()=>{C.value=n.table},{immediate:!0}),watch(()=>n.properties,d=>{o.value=!1,O(),w(n.properties,n.requiredFields,P),o.value=!0},{deep:!0,immediate:!0}),watch(()=>n.mainId,d=>{setTimeout(()=>{U()},100)},{immediate:!0}),watch(()=>n.disabled,d=>{A({disabled:d})});function O(){return J(this,null,function*(){let d=yield getRefPromise(t);d.$formValueChange=(u,a)=>{let r={[u]:a};e("formChange",r)}})}function H(){if(unref(n.isUpdate)===!1){let d=toRaw(l[C.value]);loadFormFieldsDefVal(d,u=>{I(u)})}}function U(){return J(this,null,function*(){yield getRefPromise(o),yield R(),H();const{table:d,mainId:u}=n;if(!d||!u)return;let a=yield B(d,u);b.value=a,yield I(a)})}function B(d,u){let a=`${baseUrl}/${d}/${u}`;return new Promise((r,p)=>{defHttp.get({url:a},{isTransformResponse:!1}).then(m=>{m.success?r(m.result):p()})}).finally(()=>{b.value=""})}function L(){return new Promise((d,u)=>{N().then(()=>{let a=$();a=i(a),d(a)}).catch(a=>{u(a)})})}function f(){let d=$();return d.id||(d.id="sub-change-temp-id"),{row:d,target:D}}function x(d){I(d)}function y(){let d=$(),u=toRaw(l[C.value]);loadFormFieldsDefVal(u,a=>{I(a)},d)}const D={onlineFormRef:t,baseColProps:E,formSchemas:c,registerForm:T,setFieldsValue:I,getFieldsValue:$,getFormEvent:f,setValues:x,getAll:L,executeFillRule:y,sh:k};return D}};function _sfc_render$5(n,e,t,o,c,l){const i=resolveComponent("BasicForm");return openBlock(),createBlock(i,{ref:"onlineFormRef",onRegister:n.registerForm},null,8,["onRegister"])}const OnlineSubForm=h(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"})),urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading:ne$1,OnlineSubForm,PrinterOutlined,DiffOutlined,FormOutlined},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0},isVxeTableData:{type:Boolean,default:!1}},emits:["success","rendered","dataChange"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),[o,{openModal:c}]=useModal(),l=ref(""),i=ref(null),C=ref(!0),b=ref(!1),P=ref(1),k=ref(!1),w=ref(!1),E=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:T,resetContext:A}=useOnlineFormContext(),{formSchemas:N,defaultValueFields:R,changeDataIfArray2String:I,tableName:$,dbData:O,checkOnlyFieldValue:H,hasSubTable:U,subTabInfo:B,refMap:L,subDataSource:f,baseColProps:x,createFormSchemas:y,fieldDisplayStatus:D}=useFormItems(n,i);let{EnhanceJS:d,initCgEnhanceJs:u}=useEnhance(T,!1);const[a,{setProps:r,validate:p,resetFields:m,setFieldsValue:F,updateSchema:M,getFieldsValue:Y,scrollToField:q}]=useForm({schemas:N,showActionButtonGroup:!1,baseColProps:x}),G=ref(!1);function X(){let s=n.disabled;G.value=s,r({disabled:s})}function re(s,g,_){return J(this,null,function*(){yield m(),O.value="";let V=unref(s);w.value=V,V&&(yield se(g)),yield nextTick(()=>{!V&&_&&F(_),de(),ye("js","loaded"),X()})})}function de(){if(unref(w)===!1){let s=toRaw(R[$.value]);loadFormFieldsDefVal(s,g=>{F(g)})}}function se(s){return J(this,null,function*(){let g=yield j(s.id);(!g||Object.keys(g).length==0)&&(g=ne({},toRaw(s))),O.value=Object.assign({},g);let _=ue.value,V=pick(g,..._);n.isVxeTableData===!0&&(V=Object.assign({},V,s)),yield F(V)})}let ue=computed(()=>{let s=N.value,g=[];for(let _ of s)g.push(_.field);return g});function j(s){let g=`${urlObject.optPre}${n.id}/${s}`;return new Promise((_,V)=>{defHttp.get({url:g},{isTransformResponse:!1}).then(te=>{te.success?_(te.result):(V(),t.warning(te.message))}).catch(()=>{V()})})}function Z(s){return J(this,null,function*(){P.value=s.head.tableType,$.value=s.head.tableName,C.value=s.head.tableType==1,ie(s.head.extConfigJson),y(s.schema.properties,s.schema.required,H),d=u(s.enhanceJs),e("rendered",E);let g=yield getRefPromise(i);g.$formValueChange=(_,V,te)=>{Ae(_,V),te&&F(te)}})}function ie(s){let g={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};s&&(g=JSON.parse(s)),Object.keys(g).map(_=>{E[_]=g[_]})}function oe(){C.value===!0?fe():ee()}function ee(){W().then(s=>{he(s)})}function W(){let s={};return new Promise((g,_)=>{p().then(V=>g(V),({errorFields:V})=>{V&&V.length>0&&q(V[0][0]),_(VALIDATE_FAILED)})}).then(g=>(Object.assign(s,I(g)),ae())).then(g=>(Object.assign(s,g),Promise.resolve(s))).catch(g=>((g===VALIDATE_FAILED||(g==null?void 0:g.code)===VALIDATE_FAILED)&&(t.warning("校验未通过"),g.key&&le(g.key)),Promise.reject(null)))}function le(s){let g=B.value;for(let _=0;_<g.length;_++)if(s==g[_].key){be.value=_+"";break}}function ae(){return new Promise((s,g)=>J(this,null,function*(){let _={};try{let V=B.value;for(let te=0;te<V.length;te++){let ce=V[te].key,me=L[ce].value;if(me instanceof Array&&(me=me[0]),V[te].relationType==1)try{let we=yield me.getAll();_[ce]=[],_[ce].push(we)}catch(we){throw{code:VALIDATE_FAILED,key:ce}}else{if(yield me.fullValidateTable())throw{code:VALIDATE_FAILED,key:ce};_[ce]=me.getTableData()}}}catch(V){g(V)}s(_)}))}function fe(){return J(this,null,function*(){try{let s=yield p();s=Object.assign({},O.value,s),s=I(s),b.value=!0,he(s)}finally{b.value=!1}})}function he(s){Ne(_e,s).then(()=>{Qe(s)}).catch(g=>{t.warning(g)})}function ge(s,g,_){g&&_?_.setValues?_.setValues(s):_.setValues([{rowKey:g,values:s}]):F(s)}function ke(s,g){let _={};_[s]=g,F(_)}const be=ref("0"),Ce=ref(300),xe=ref(340);function Ie(s){if(w.value===!0){let g=O.value;return Pe(g,s)}return""}function Pe(s,g){if(s){let _=s[g];return!_&&_!==0&&(_=s[g.toLowerCase()],!_&&_!==0&&(_=s[g.toUpperCase()])),_}return""}function De(s,g){if(d&&d[g+"_onlChange"]){let _=d[g+"_onlChange"](),V=Object.keys(s)[0];if(_[V]){let te=L[g].value;te instanceof Array&&(te=te[0]);let ce=te.getFormEvent(),me=ne({column:{key:V},value:s[V]},ce);_[V].call(T,T,me)}}}function Me(s,g){if(d&&d[g+"_onlChange"]){let _=d[g+"_onlChange"](T);_[s.column.key]&&_[s.column.key].call(T,T,s)}}function Ee(s,g){}function $e(s){return"online_"+s+":"}function Ae(s,g){return J(this,null,function*(){if(O.value[s]!=g&&e("dataChange",s),!d||!d.onlChange||!s)return!1;let _=d.onlChange();if(_[s]){let V={row:yield Y(),column:{key:s},value:g};_[s].call(T,T,V)}})}function ye(s,g){if(s=="js")d&&d[g]&&d[g].call(T,T);else if(s=="action"){let _=O.value,V={formId:n.id,buttonCode:g,dataId:_.id,uiFormData:Object.assign({},_)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:V},{isTransformResponse:!1}).then(te=>{te.success?t.success("处理完成!"):t.warning("处理失败!")})}}function Fe(s){let g=L[s].value,_=[...g.getNewDataWithId(),...f.value[s]];if(!_||_.length==0)return!1;let V=[];for(let te of _)V.push(te.id);g.removeRowsById(V)}function Se(s,g){if(!g)return!1;let _=L[s].value;typeof g=="object"?_.addRows(g,!0):t.error("添加子表数据,参数不识别!")}function Ve(s,g){Fe(s),Se(s,g)}function Re(s,g){!g&&g.length<=0&&(g=[]),g.map(_=>{_.hasOwnProperty("label")||(_.label=_.text)}),M({field:s,componentProps:{options:g}})}function Ne(s,g){return d&&d.beforeSubmit?d.beforeSubmit(s,g):Promise.resolve()}function Be(s,g){let _=toRaw(D);s&&s.length>0?Object.keys(_).map(V=>{!V.endsWith("_load")&&s.indexOf(V)<0&&(D[V]=!1)}):g&&g.length>0&&Object.keys(_).map(V=>{g.indexOf(V)>=0&&(D[V]=!1)})}function Le(s){return J(this,null,function*(){yield m(),O.value="",w.value=!0,yield se(s),yield nextTick(()=>{ye("js","loaded")})})}function Ye(s){let g=L[s].value;return g instanceof Array&&(g=g[0]),g}function Ke(){let s=E.reportPrintUrl,g=O.value.id,_=getToken();goJmReportViewPage(s,g,_)}function qe(s){l.value=s.id,c(!0)}function ze(s){}function Qe(s){if(Object.keys(s).map(g=>{Array.isArray(s[g])&&s[g].length==0&&(s[g]="")}),n.request==!1)e("success",s);else{let g=`${urlObject.optPre}${n.id}?tabletype=${P.value}`;k.value===!0&&(s[SUBMIT_FLOW_KEY]=1);let _=w.value===!0?"put":"post";defHttp.request({url:g,method:_,params:s},{isTransformResponse:!1}).then(V=>{V.success?(V.result&&(s.id||(s.id=V.result)),e("success",s),O.value=s,w.value=!0,t.success("操作成功!")):t.warning(V.message)}).finally(()=>{b.value=!1})}}function Ze(){return J(this,null,function*(){let s=O.value,g=ue.value,_=pick(s,...g);if(s)yield F(_);else{let V={};for(let te of g)V[te]="";yield F(V)}})}let _e={tableName:$,loading:b,subActiveKey:be,onlineFormRef:i,getFieldsValue:Y,setFieldsValue:F,submitFlowFlag:k,subFormHeight:Ce,subTableHeight:xe,refMap:L,triggleChangeValues:ge,triggleChangeValue:ke,sh:D,clearSubRows:Fe,addSubRows:Se,clearThenAddRows:Ve,changeOptions:Re,isUpdate:w,getSubTableInstance:Ye};return A(_e),{tableName:$,onlineFormRef:i,registerForm:a,loading:b,subActiveKey:be,hasSubTable:U,subTabInfo:B,refMap:L,subFormHeight:Ce,getSubTableForeignKeyValue:Ie,isUpdate:w,handleSubFormChange:De,subTableHeight:xe,onlineFormDisabled:G,subDataSource:f,getSubTableAuthPre:$e,handleAdded:Ee,handleValueChange:Me,openSubFormModalForAdd:qe,openSubFormModalForEdit:ze,registerVxeFormModal:o,vxeTableId:l,show:re,createRootProperties:Z,handleSubmit:oe,sh:D,handleCgButtonClick:ye,handleCustomFormSh:Be,handleCustomFormEdit:Le,dbData:O,onOpenReportPrint:Ke,onlineExtConfigJson:E,recoverFormData:Ze}}},_hoisted_1$3=["id"];function _sfc_render$4(n,e,t,o,c,l){const i=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:o.tableName+"_form"},[createVNode(i,{ref:"onlineFormRef",onRegister:o.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}const OnlinePopForm=h(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(n,{emit:e}={},t){const o=ref(null),c=ref(!1),l=ref(1),i=ref([]),C=ref(!1),b=ref(0),P=ref(!1),k=ref(""),w=ref(!1),E=ref(!1),T=ref(!0),A=reactive({}),N=ref(!0),R=ref(""),I=ref(!0),$=ref(!1),{popModalFixedWidth:O,resetBodyStyle:H,popBodyStyle:U}=useFixedHeightModal(),B=ref(!1),L=ref(""),f={handleOpenModal:W=>{}},x=ref(""),y=ref(""),D=ref(!1);let d={};const u=computed(()=>R.value||(unref(c)===!0?"详情":unref(E)===!0?"编辑":"新增")),[a,{setModalProps:r,closeModal:p}]=useModalInner(W=>J(this,null,function*(){R.value="",$.value=!1,n===!0?yield f.handleOpenModal(W):yield M(W),H(),t&&t()})),m=ref(!1);function F(){return J(this,null,function*(){return yield getRefPromise(m),B.value})}function M(W){return J(this,null,function*(){r({confirmLoading:!1}),E.value=W.isUpdate,c.value=W.disableSubmit||!1,(W==null?void 0:W.hideSub)===!0&&(N.value=!1),W!=null&&W.title&&(R.value=W.title),W!=null&&W.record?y.value=W.record.id:y.value="",yield nextTick(()=>J(this,null,function*(){yield getRefPromise(C),q(),yield o.value.show(W==null?void 0:W.isUpdate,W==null?void 0:W.record,W==null?void 0:W.param)}))})}function Y(W){C.value=!0,b.value=W.modalMinWidth,W.modelFullscreen==1?r({defaultFullscreen:!0}):r({defaultFullscreen:!1}),d=W}function q(){let W=y.value;d.commentStatus==1&&W?(D.value=!0,r({defaultFullscreen:!0})):D.value=!1}const G=800,X=1100,re=computed(()=>{let W=200*(l.value-1),le=(unref(T)?G:X)+W;le=de(le);let ae=b.value;return ae&&le<ae&&(le=ae),le});function de(W){let le=A.modalMinWidth;if(le!=null&&le!=="")try{if(le=Number.parseInt(le),W<le)return le}catch(ae){}return W}function se(W,le){o.value.handleCgButtonClick(W,le)}function ue(){w.value=!0,setTimeout(()=>{w.value=!1},1500),o.value.handleSubmit()}function j(){p()}function Z(W,le={}){let ae=`/online/cgform/api/getFormItem/${W}`;return new Promise((fe,he)=>{defHttp.get({url:ae,params:le},{isTransformResponse:!1}).then(ge=>{ge.success?fe(ge.result):he(ge.message)}).catch(()=>{he()})})}function ie(W,le){return J(this,null,function*(){let ae=yield Z(W,le),fe=ae.head.formTemplate;l.value=fe?Number(fe):1,i.value=ae.cgButtonList,P.value=ae.head.isTree==="Y",k.value=ae.head.treeParentIdField||"",x.value=ae.head.tableName,L.value=ae.head.themeTemplate,ae.form_disable_update===!0?B.value=!0:B.value=!1,m.value=!0,e&&e("formConfig",ae),yield nextTick(()=>J(this,null,function*(){yield(yield getRefPromise(o)).createRootProperties(ae)}))})}function oe(W){W[ONL_FORM_TABLE_NAME]=x.value,e("success",W),I.value==!0&&p(),$.value=!1,I.value=!0}function ee(){o.value&&o.value.onCloseModal()}return{title:u,modalWidth:re,registerModal:a,closeModal:p,modalObject:f,onCloseEvent:ee,cgButtonList:i,handleCgButtonClick:se,disableSubmit:c,handleSubmit:ue,submitLoading:w,handleCancel:j,successThenClose:I,handleSuccess:oe,topTipVisible:$,handleFormConfig:ie,onlineFormCompRef:o,formTemplate:l,isTreeForm:P,pidFieldName:k,renderSuccess:Y,formRendered:C,isUpdate:E,showSub:N,themeTemplate:L,tableName:x,formDataId:y,enableComment:D,popBodyStyle:U,popModalFixedWidth:O,getFormStatus:F}}function useFixedHeightModal(){const n=ref(800);let e=window.innerWidth-300;e<800&&(e=800),n.value=e;const t=ref({});function o(){let c=window.innerHeight-210;t.value={height:c+"px",overflowY:"auto"}}return{popModalFixedWidth:n,popBodyStyle:t,resetBodyStyle:o}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1},isVxeTableData:{type:Boolean,default:!1},formTableType:{type:String,default:""}},components:{BasicModal,OnlinePopForm,JModalTip:S,Button},emits:["success","register","formConfig"],setup(n,{emit:e}){const{title:t,registerModal:o,cgButtonList:c,handleCgButtonClick:l,disableSubmit:i,handleSubmit:C,submitLoading:b,handleCancel:P,handleFormConfig:k,onlineFormCompRef:w,formTemplate:E,isTreeForm:T,pidFieldName:A,renderSuccess:N,formRendered:R,handleSuccess:I,topTipVisible:$,successThenClose:O,isUpdate:H,popBodyStyle:U,popModalFixedWidth:B,getFormStatus:L}=useAutoModal(!1,{emit:e});watch(()=>n.id,f,{immediate:!0});function f(){return J(this,null,function*(){if(R.value=!1,!n.id)return;let a={};n.formTableType&&(a.tabletype=n.formTableType),yield k(n.id,a)})}function x(){n.saveClose===!1&&(O.value=!1),C()}function y(){$.value=!1,w.value.recoverFormData()}function D(){$.value=!0}const d=computed(()=>H.value?n.topTip:!1),u=computed(()=>{if(H.value==!0)return null;{let a=b.value;return[h$1(Button,{type:"primary",loading:a,onClick:C},()=>"确定"),h$1(Button,{onClick:P},()=>"关闭")]}});return{title:t,topTipVisible:$,handleSaveData:x,handleRecover:y,onlineFormCompRef:w,renderSuccess:N,registerModal:o,handleSubmit:C,handleSuccess:I,handleCancel:P,formTemplate:E,disableSubmit:i,cgButtonList:c,handleCgButtonClick:l,isTreeForm:T,pidFieldName:A,submitLoading:b,handleDataChange:D,isUpdate:H,showTopTip:d,modalFooter:u,popBodyStyle:U,popModalFixedWidth:B,getFormStatus:L}}});function _sfc_render$3(n,e,t,o,c,l){const i=resolveComponent("j-modal-tip"),C=resolveComponent("online-pop-form"),b=resolveComponent("BasicModal");return openBlock(),createBlock(b,mergeProps({width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle},n.$attrs,{footer:n.modalFooter,cancelText:"关闭",onRegister:n.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:n.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(n.title)+" ",1),n.showTopTip?(openBlock(),createBlock(i,{key:0,visible:n.topTipVisible,onSave:n.handleSaveData,onCancel:n.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(C,{ref:"onlineFormCompRef",id:n.id,disabled:n.disableSubmit,"form-template":n.formTemplate,isTree:n.isTreeForm,pidField:n.pidFieldName,request:n.request,isVxeTableData:n.isVxeTableData,onRendered:n.renderSuccess,onSuccess:n.handleSuccess,onDataChange:n.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","isVxeTableData","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}const OnlinePopModal=h(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(n,e){const t="/online/cgform/api/getData/"+n;return defHttp.get({url:t,params:e})}function queryTableColumns(n,e){const t="/online/cgform/api/getColumns/"+n;return defHttp.get({url:t,params:e})}function useLinkTable(n){const e=ref("1"),t=ref({}),o=ref({}),c=ref(""),l=reactive({add:!0,update:!0}),i=computed(()=>n.textField?n.textField.split(","):[]),C=ref([]),b=computed(()=>{let f=C.value;return n.multi==!0?f.slice(0,3):f.slice(0,6)});watchEffect(()=>J(this,null,function*(){if(n.tableName){let f=n.valueField||"",x=n.textField||"",y=[];if(f&&y.push(f),x){let d=x.split(",");c.value=d[0];for(let u of d)y.push(u)}let D=n.imageField||"";D&&y.push(D),t.value={linkTableSelectFields:y.join(",")},yield T(),yield A()}}));const P=computed(()=>{let f=n.textField||"",x=[],y="";if(f){let D=f.split(",");y=D[0];for(let d=0;d<D.length;d++)d>0&&x.push(D[d])}return{others:x,labelField:y}}),k=ref([]),w=ref([]),E=ref({});function T(){return J(this,null,function*(){let f=t.value;const x=yield queryTableColumns(n.tableName,f);if(w.value=x.columns,x.columns){let y=n.imageField,D=x.columns.filter(d=>d.dataIndex!=c.value&&d.dataIndex!=y);C.value=D}if(E.value=x.dictOptions,x.hideColumns){let y=x.hideColumns;y.indexOf("add")>=0?l.add=!1:l.add=!0,y.indexOf("update")>=0?l.update=!1:l.update=!0}})}function A(){return J(this,null,function*(){let f=R(),x=(yield queryTableData(n.tableName,f)).records,y=[],{others:D,labelField:d}=P.value,u=n.imageField;if(x&&x.length>0)for(let a of x){let r=ne({},a);N(r);let p=Object.assign({},pick(r,D),{id:r.id,label:r[d],value:r[n.valueField]});u&&(p[u]=r[u]),y.push(p)}y.push({}),k.value=y})}function N(f){let x=w.value,y=E.value;for(let D of x){const{dataIndex:d,customRender:u}=D;(f[d]||f[d]===0)&&u&&u==d&&y[u]&&(f[d]=filterMultiDictText(y[u],f[d]))}}function R(){return Object.assign({pageSize:10,pageNo:e.value},t.value,o.value)}function I(f){if(!f)o.value={};else{let x=i.value,y=[],D=[];for(let d=0;d<x.length;d++)d<=1&&(D.push(x[d]),y.push({field:x[d],rule:"like",val:f}));y.superQueryMatchType="or",y.superQueryParams=encodeURI(JSON.stringify(y)),o.value=y}}function $(f){return J(this,null,function*(){if(!f)return[];let x=n.valueField,y=pe(ne({},t.value),{pageSize:10,pageNo:e.value});y.superQueryMatchType="and";let D=[{field:x,rule:"in",val:f}];y.superQueryParams=encodeURI(JSON.stringify(D));let d=(yield queryTableData(n.tableName,y)).records,u=[];if(d&&d.length>0)for(let a of d){let r=ne({},a);N(r),u.push(r)}return u})}function O(f,x){if(!f||f.length==0)return!1;let y=x.split(",");if(y.length!=f.length)return!1;let D=!0;for(let d of f){let u=d[n.valueField];y.indexOf(u)<0&&(D=!1)}return D}function H(f){Object.keys(f).map(x=>{f[x]instanceof Array&&(f[x]=f[x].join(","))})}function U(f,x,y){if(y||(y={}),x&&x.length>0)for(let D of x){let d=D.split(","),u=d[0],a=d[1];if(f[u])f[u].push(y[a]);else{let r=y[a]||"";f[u]=[r]}}}function B(f){if(n.imageField){let x=f[n.imageField];return getFileAccessHttpUrl(x)}return""}const L=computed(()=>!!n.imageField);return{pageNo:e,otherColumns:C,realShowColumns:b,selectOptions:k,reloadTableLinkOptions:A,textFieldArray:i,addQueryParams:I,tableColumns:w,transData:N,mainContentField:c,loadOne:$,compareData:O,formatData:H,initFormData:U,getImageSrc:B,showImage:L,auths:l}}const LinkTableSelect_vue_vue_type_style_index_0_scoped_e9a2adfa_lang="",_sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def("")},emits:["change","update:value"],setup(n,{emit:e}){const t=ref([]),{auths:o,mainContentField:c,textFieldArray:l,selectOptions:i,reloadTableLinkOptions:C,addQueryParams:b,formatData:P,initFormData:k,getImageSrc:w,showImage:E}=useLinkTable(n),[T,{openModal:A}]=useModal(),N=computed(()=>n.tableName),R=computed(()=>n.multi===!0?{mode:"multiple"}:{});function I(f){f==null||f.stopPropagation(),f==null||f.preventDefault(),A(!0,{})}function $(f,x){f==null||f.stopPropagation(),f==null||f.preventDefault(),o.update!=!1&&A(!0,{isUpdate:!0,record:x})}function O(f){return J(this,null,function*(){yield C();let x=f[n.valueField];t.value=x})}function H(f){b(f),C()}function U(f){B(f),f||(b(),C())}function B(f){let x={},y=n.linkFields,D=[];if(!f)k(x,y);else{let d=toRaw(i.value),u=toRaw(f);u instanceof Array?D=[...u]:n.multi==!0?D=u.split(","):D=[u];let a=d.filter(r=>D.indexOf(r[n.valueField])>=0);if(a&&a.length>0){let r=ne({},a[0]);if(a.length>1)for(let m=1;m<a.length;m++)r=L(r,a[m]);let p=c.value;r[p]=r.label,k(x,y,r)}}P(x),e("change",D.join(",")||"",x),e("update:value",D.join(",")||"")}function L(f,x){let y={};return Object.keys(f).map(D=>{y[D]=(f[D]||"")+","+(x[D]||"")}),y}return watch(()=>n.value,f=>J(this,null,function*(){f?(n.multi==!0?t.value=f.split(","):t.value=f,n.linkFields&&n.linkFields.length>0&&B(f)):t.value=[]}),{immediate:!0}),watch(()=>i.value,f=>{f&&f.length>0&&n.linkFields&&n.linkFields.length>0&&t.value&&t.value.length>0&&B(t.value)}),{selectValue:t,selectOptions:i,registerPopModal:T,popTableName:N,textFieldArray:l,handleClickAdd:I,handleClickEdit:$,getFormData:O,handleSearch:useDebounceFn(H,800),handleChange:U,bindValue:R,showImage:E,getImageSrc:w,auths:o}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("EditOutlined"),b=resolveComponent("a-select"),P=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(b,mergeProps({value:o.selectValue,"onUpdate:value":e[1]||(e[1]=k=>o.selectValue=k),style:{width:"100%"},placeholder:"请选择","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},o.bindValue,{options:o.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:o.handleSearch,onChange:o.handleChange}),{option:withCtx(k=>[!k.value&&o.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:e[0]||(e[0]=(...w)=>o.handleClickAdd&&o.handleClickAdd(...w))},[createVNode(i),createTextVNode(" 记录 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[o.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[o.getImageSrc(k)?(openBlock(),createElementBlock("img",{key:0,src:o.getImageSrc(k),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[o.auths.update?(openBlock(),createBlock(C,{key:0,onClick:w=>o.handleClickEdit(w,k)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(k.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.textFieldArray,w=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(k[w]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(P,{id:o.popTableName,onRegister:o.registerPopModal,onSuccess:o.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}const LinkTableSelect=h(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-e9a2adfa"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(n,e="checkbox"){dictOptionInfo.value=n.dictOptions,n.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange,type:e}:rowSelection.value=null,enableScrollBar.value=n.scrollFlag==1;let t=n.columns;t.forEach(i=>{i.fieldExtendJson&&JSON.parse(i.fieldExtendJson).isFixed&&(i.fixed="left"),Object.keys(i).map(C=>{i[C]==null&&delete i[C]})});let o=n.fieldHrefSlots;const c={};o.forEach(i=>c[i.slotName]=i);let l=[];if(l=handleColumnHrefAndDict(t,c),bpmStatusFilter(l),onlineTableContext.isTree()===!0){let i=n.textField,C=-1;for(let b=0;b<l.length;b++)if(l[b].dataIndex==i){C=b;break}if(C>0){let b=l.splice(C,1);l.unshift(b[0])}l.length>0&&(l[0].align="left")}columns.value=l,onlineTableContext.reloadTable()}function onSelectChange(n,e){selectedKeys.value=n,onlineTableContext.selectedRows=toRaw(e),onlineTableContext.selectedRowKeys=toRaw(n)}function handleColumnHrefAndDict(n,e){for(let t of n){let{customRender:o,hrefSlotName:c,fieldType:l}=t;if(l=="date"||l=="Date")t.customRender=({text:i})=>i?i.length>10?i.substring(0,10):i:"";else if(l=="link_table")t.customRender=({text:i,record:C})=>{if(!i)return"";if(onlineTableContext.isPopList===!0)return C[t.dataIndex+"_dictText"];{let b=(i+"").split(","),P=[];C[t.dataIndex+"_dictText"]&&(P=C[t.dataIndex+"_dictText"].split(","));let k=[];for(let w=0;w<b.length;w++){let E=h$1(v,{id:b[w],text:P[w],onTab:T=>handleClickLinkTable(T,c)});k.push(E)}return k.length==0?"":h$1("div",{style:{overflow:"hidden"}},k)}};else{if(!c&&t.scopedSlots&&t.scopedSlots.customRender&&e.hasOwnProperty(t.scopedSlots.customRender)&&(c=t.scopedSlots.customRender),o||c){let i=o,C="_replace_text_";t.ellipsis=!0,t.customRender=({text:b,record:P})=>{let k=b;if(i)if(i.startsWith(C)){let w=i.replace(C,"");k=P[w]}else k=filterMultiDictText(unref(dictOptionInfo)[i],b+"");if(t.showLength&&k&&k.length>t.showLength&&(k=k.substr(0,t.showLength)+"..."),c){let w=e[c];if(w)return h$1("a",{onClick:()=>handleClickFieldHref(w,P)},k)}return k}}if(t.scopedSlots){t.ellipsis=!0;let i=t.scopedSlots;t.slots=i,delete t.scopedSlots}}}return n}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let n=href.split(":");hrefMainTableId.value=n[1];let e=n[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[e]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(n,e)=>record[e]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(n){return text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"关闭",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(n){let e=n.indexOf("?"),t=n;if(e!==-1){t=n.substring(0,e);let o=n.substring(e+1,n.length).split("&"),c={};o.forEach(l=>{let i=l.split("=");c[i[0]]=i[1]}),hrefComponent.params=c}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="操作",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(t)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var n,e;((n=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:n.tableFixedAction)===1&&(actionColumn.fixed=((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(n){let e=!1;for(let t=0;t<n.length;t++)if(n[t].dataIndex.toLowerCase()=="bpm_status"){e=!0;break}return onlineTableContext.hasBpmStatus=e,e}function downloadRowFile(n){if(!n)return;n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(",")));let e=getFileAccessHttpUrl(n);window.open(e)}function getImgView(n){return n&&n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(","))),getFileAccessHttpUrl(n)}function getPcaText(n){return n?getAreaTextByCode(n):""}function getFormatDate(n){if(!n)return"";let e=n;return e.length>10&&(e=e.substring(0,10)),e}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(n){if(n){let e=[],t=n.split(",");for(let o of t)o&&e.push(getFileAccessHttpUrl(o));createImgPreview({imageList:e})}}const onlinePopModalRef=ref();function handleClickLinkTable(n,e){return J(this,null,function*(){popTableId.value=e,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=e,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:n}})):openPopModal(!0,{isUpdate:!0,record:{id:n}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable:K,TableAction:Q,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),{popModalFixedWidth:o,resetBodyStyle:c,popBodyStyle:l}=useFixedHeightModal(),i=ref(""),C=ref(800),[b,{closeModal:P}]=useModalInner(()=>{i.value="",M.value=[],Y.value=[],m({current:1}),p(),c()}),[k,{openModal:w}]=useModal();function E(){P()}const T=computed(()=>{const j=M.value;return!(j&&j.length>0)}),A=ref(!1);function N(){A.value=!0;let j=toRaw(Y.value);j&&j.length>0&&(e("success",j),P()),setTimeout(()=>{A.value=!1},200)}function R(j){const Z="/online/cgform/api/getData/"+n.id;return defHttp.get({url:Z,params:j})}function I(j){return j.column="id",new Promise((Z,ie)=>J(this,null,function*(){const oe=yield R(j);Z(oe)}))}const $={isPopList:!0,reloadTable(){},isTree(){return!1}},O=ref({}),{columns:H,downloadRowFile:U,getImgView:B,getPcaText:L,getFormatDate:f,handleColumnResult:x,hrefComponent:y,viewOnlineCellImage:D}=useTableColumns($,O);function d(){const j="/online/cgform/api/getColumns/"+n.id;return new Promise((Z,ie)=>{defHttp.get({url:j},{isTransformResponse:!1}).then(oe=>{oe.success?Z(oe.result):(t.warning(oe.message),ie())})})}const u=ref("");watch(()=>n.id,()=>J(this,null,function*(){let j=yield d();x(j),u.value=j.description}),{immediate:!0});const{tableContext:a}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:I,clickToRowSelect:!0,columns:H,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:j=>de(j)}}),[r,{reload:p,setPagination:m},{rowSelection:F,selectedRowKeys:M,selectedRows:Y}]=a;watch(()=>n.multi,j=>{j==!0?F.type="checkbox":F.type="radio"},{immediate:!0});function q(j){return[{label:"编辑",onClick:G.bind(null,j)}]}function G(j){}function X(){p()}const re=["int","double","Date","Datetime","BigDecimal"];function de(j){let Z=i.value;if(!Z)return j.superQueryMatchType="or",j.superQueryParams="",j;let ie=H.value,oe=[];if(ie&&ie.length>0)for(let ee of ie)ee.dbType&&(ee.dbType=="string"?oe.push({field:ee.dataIndex,type:ee.dbType.toLowerCase(),rule:"like",val:Z}):ee.dbType=="Date"?Z.length==10&&oe.push({field:ee.dataIndex,type:ee.dbType.toLowerCase(),rule:"eq",val:Z}):ee.dbType=="Datetime"?Z.length==19&&oe.push({field:ee.dataIndex,type:ee.dbType.toLowerCase(),rule:"eq",val:Z}):re.indexOf(ee.dbType)&&oe.push({field:ee.dataIndex,type:ee.dbType.toLowerCase(),rule:"eq",val:Z}));return j.superQueryMatchType="or",j.superQueryParams=encodeURI(JSON.stringify(oe)),j}function se(){w(!0,{})}function ue(j){e("success",[j]),P()}return{registerModal:b,modalWidth:C,handleCancel:E,submitDisabled:T,submitLoading:A,handleSubmit:N,registerTable:r,getTableAction:q,searchText:i,onSearch:X,downloadRowFile:U,getImgView:B,getPcaText:L,getFormatDate:f,hrefComponent:y,viewOnlineCellImage:D,rowSelection:F,modalTitle:u,registerPopModal:k,handleAdd:se,reload:p,popModalFixedWidth:o,popBodyStyle:l,handleDataSave:ue}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("a-button"),b=resolveComponent("a-input-search"),P=resolveComponent("TableAction"),k=resolveComponent("BasicTable"),w=resolveComponent("BasicModal"),E=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(w,{onRegister:n.registerModal,width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle,title:n.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[n.addAuth?(openBlock(),createBlock(C,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:n.handleAdd},{default:withCtx(()=>[createVNode(i),createTextVNode("新增记录")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(C,{key:"back",onClick:n.handleCancel},{default:withCtx(()=>[createTextVNode("关闭")]),_:1},8,["onClick"]),createVNode(C,{disabled:n.submitDisabled,key:"submit",type:"primary",onClick:n.handleSubmit,loading:n.submitLoading},{default:withCtx(()=>[createTextVNode("确定")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(k,{onRegister:n.registerTable,rowSelection:n.rowSelection},{tableTitle:withCtx(()=>[createVNode(b,{value:n.searchText,"onUpdate:value":e[0]||(e[0]=T=>n.searchText=T),onSearch:n.onSearch,placeholder:"请输入关键词，按回车搜索",style:{width:"240px"}},null,8,["value","onSearch"])]),action:withCtx(({record:T})=>[createVNode(P,{actions:n.getTableAction(T)},null,8,["actions"])]),fileSlot:withCtx(({text:T})=>[T?(openBlock(),createBlock(C,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:A=>n.downloadRowFile(T)},{default:withCtx(()=>[createTextVNode(" 下载 ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"无文件"))]),imgSlot:withCtx(({text:T})=>[T?(openBlock(),createElementBlock("img",{key:1,src:n.getImgView(T),alt:"图片不存在",class:"online-cell-image",onClick:A=>n.viewOnlineCellImage(T)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"无图片"))]),htmlSlot:withCtx(({text:T})=>[createBaseVNode("div",{innerHTML:T},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:T})=>[createBaseVNode("div",{title:n.getPcaText(T)},toDisplayString(n.getPcaText(T)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:T})=>[createBaseVNode("span",null,toDisplayString(n.getFormatDate(T)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode(E,{id:n.id,onRegister:n.registerPopModal,onSuccess:n.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}const OnlinePopListModal=h(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"})),LinkTableCard_vue_vue_type_style_index_0_scoped_447ec75a_lang="",_sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def("")},components:{PlusOutlined,MinusCircleFilled,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(n,{emit:e}){const t=computed(()=>n.tableName),[o,{openModal:c}]=useModal(),[l,{openModal:i}]=useModal(),C=ref([]),b=ref([]),P=computed(()=>!(n.disabled==!0||n.multi===!1&&b.value.length>0)),{auths:k,otherColumns:w,realShowColumns:E,tableColumns:T,textFieldArray:A,transData:N,loadOne:R,compareData:I,formatData:$,initFormData:O,getImageSrc:H,showImage:U}=useLinkTable(n),B=computed(()=>n.multi===!0?12:24),L=computed(()=>n.multi===!0?24:12);function f(p){if(p&&A.value.length>0){let m=A.value[0];return p[m]}}function x(p){p==null||p.stopPropagation(),p==null||p.preventDefault()}function y(p,m){x(p),k.update!=!1&&n.disabled==!1&&i(!0,{isUpdate:!0,record:m})}function D(p){c(!0,{})}function d(p){let m=b.value;for(let F of p){let M=ne({},F);N(M),m.push(M)}b.value=m,r()}function u(p){let m=b.value;for(let F=0;F<m.length;F++)if(m[F].id===p.id){let M=ne({},p);N(M),m.splice(F,1,M)}b.value=m,r()}function a(p,m){x(p);let F=b.value;F&&F.length>m&&(F.splice(m,1),b.value=F),r()}function r(){let p=b.value,m=[],F={},M=n.linkFields;if(p.length>0)for(let q=0;q<p.length;q++)m.push(p[q][n.valueField]),O(F,M,p[q]);else O(F,M);let Y=m.join(",");$(F),e("change",Y,F),e("update:value",Y)}return watch(()=>n.value,p=>J(this,null,function*(){if(p){if(I(b.value,p)===!1){let m=yield R(p);b.value=m}n.linkFields&&n.linkFields.length>0&&r()}else b.value=[]}),{immediate:!0}),{popTableName:t,selectRecords:b,otherColumns:w,realShowColumns:E,showButton:P,selectValue:C,handleAddRecord:D,handleDeleteRecord:a,getMainContent:f,itemSpan:B,columnSpan:L,tableColumns:T,addCard:d,registerListModal:o,registerFormModal:l,handleClickEdit:y,updateCardData:u,getImageSrc:H,showImage:U,auths:k}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("a-button"),b=resolveComponent("minus-circle-filled"),P=resolveComponent("a-col"),k=resolveComponent("a-row"),w=resolveComponent("online-pop-list-modal"),E=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[o.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(C,{onClick:o.handleAddRecord},{default:withCtx(()=>[createVNode(i),createTextVNode("记 录")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(k,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.selectRecords,(T,A)=>(openBlock(),createBlock(P,{span:o.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":t.detail==!0}]),onClick:N=>o.handleClickEdit(N,T)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":o.showImage}])},[t.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(b,{onClick:N=>o.handleDeleteRecord(N,A)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(o.getMainContent(T)),1),createBaseVNode("div",_hoisted_8,[createVNode(k,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.realShowColumns,N=>(openBlock(),createBlock(P,{span:o.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(N.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(T[N.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),o.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[o.getImageSrc(T)?(openBlock(),createElementBlock("img",{key:0,src:o.getImageSrc(T),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(w,{onRegister:o.registerListModal,multi:t.multi,id:o.popTableName,addAuth:o.auths.add,onSuccess:o.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode(E,{id:o.popTableName,onRegister:o.registerFormModal,onSuccess:o.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}const LinkTableCard=h(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-447ec75a"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"})),componentKeyMap={};function useExtendComponent(){n("OnlineSelectCascade",z),n("LinkTableSelect",LinkTableSelect),n("LinkTableCard",LinkTableCard);function n(t,o){componentKeyMap[t]||(add(t,o),componentKeyMap[t]=1)}function e(t){t.component=="LinkTableCard"&&(t.component="LinkTableSelect",t.componentProps.popContainer="body")}return{addComponent:n,linkTableCard2Select:e}}const useExtendComponent48d37d9b=Object.freeze(Object.defineProperty({__proto__:null,E:ENHANCEJS,F:FormSchemaFactory,L:LINK_DOWN,O:OnlinePopModal,S:SETUP,V:VALIDATE_FAILED,a:useTableColumns,b:useExtendComponent,c:FORM_VIEW_TO_QUERY_VIEW,d:getFieldIndex,e:useAutoModal,f:OnlineSubForm,g:getRefPromise,h:handleLinkDown,i:useOnlineFormContext,j:useFormItems,k:loadFormFieldsDefVal,l:loadOneFieldDefVal,m:SUBMIT_FLOW_KEY,n:SUBMIT_FLOW_ID,o:ONL_FORM_TABLE_NAME,p:getDetailFormSchemas,q:LinkTableCard,r:OnlineSubForm$1,s:OnlinePopForm$1,t:OnlinePopModal$1,u:useEnhance,v:LinkTableSelect$1,w:OnlinePopListModal$1,x:LinkTableCard$1},Symbol.toStringTag,{value:"Module"}));export{ENHANCEJS as E,FormSchemaFactory as F,LinkTableCard as L,OnlineSubForm as O,SUBMIT_FLOW_KEY as S,VALIDATE_FAILED as V,OnlinePopModal as a,useOnlineFormContext as b,useFormItems as c,useEnhance as d,SUBMIT_FLOW_ID as e,ONL_FORM_TABLE_NAME as f,getRefPromise as g,getDetailFormSchemas as h,getAreaTextByCode as i,FORM_VIEW_TO_QUERY_VIEW as j,loadOneFieldDefVal as k,loadFormFieldsDefVal as l,LINK_DOWN as m,handleLinkDown as n,getFieldIndex as o,useTableColumns as p,useAutoModal as q,SETUP as r,useExtendComponent48d37d9b as s,useExtendComponent as u};
