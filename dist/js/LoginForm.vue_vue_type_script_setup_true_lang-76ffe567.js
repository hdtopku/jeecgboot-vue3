var q=(D,l,d)=>new Promise((i,w)=>{var S=c=>{try{p(d.next(c))}catch(C){w(C)}},o=c=>{try{p(d.throw(c))}catch(C){w(C)}},p=c=>c.done?i(c.value):Promise.resolve(c.value).then(S,o);p((d=d.apply(D,l)).next())});import{d as J,k as y,r as N,e as W,u as e,o as Q,a5 as F,a6 as E,v as U,A,f as s,a7 as a,E as f,ab as g,aa as k,am as H,ac as X,F as Y,J as Z}from"./vue-5a09445c.js";import{c as ee}from"./checkcode-5ec5fe8f.js";import{t as se,I as te,J as ae,K as v,q as oe,N as ne,u as le,O as ie}from"./jeecg-online-vendor-a84f26e2.js";import{m as re}from"./index-797f995b.js";import{_ as ue}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-fa096b8a.js";import de from"./ThirdModal-227bbcf6.js";import{bo as O,bw as $,bx as ce,by as me,bz as x,bA as fe,bB as ge,bC as pe,bD as ye,bE as Ce,bF as ke}from"./antd-vue-vendor-04f0af1d.js";const ve=["src"],Fe=J({__name:"LoginForm",setup(D){const l=Ce,d=ke,i=O.Item,w=$.Password,S=ce({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:o}=oe(),{notification:p,createErrorModal:c}=le(),{prefixCls:C}=re("login"),P=se(),{setLoginState:_,getLoginState:V}=te(),{getFormRules:G}=ae(),T=y(),L=y(),I=y(!1),M=y(!1),r=N({account:"",password:"",inputCode:""}),m=N({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:j}=ie(T),z=W(()=>e(V)===v.LOGIN),R=y(),K=y();function B(){return q(this,null,function*(){const u=yield j();if(u)try{I.value=!0;const{userInfo:t}=yield P.login(Z({password:u.password,username:u.account,captcha:u.inputCode,checkKey:m.checkKey,mode:"none"}));t&&p.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${t.realname}`,duration:3})}catch(t){p.error({message:o("sys.api.errorTip"),description:t.message||o("sys.api.networkExceptionMsg"),duration:3}),I.value=!1,t.message==="验证码错误"?(r.inputCode="",R.value.focus(),b()):(t.message==="该用户不存在，请注册"||t.message==="用户名或密码错误")&&K.value.focus()}})}function b(){r.inputCode="",m.checkKey=1629428467008,ne(m.checkKey).then(u=>{m.randCodeImage=u,m.requestCodeSuccess=!0,R.value.focus()})}function h(u){L.value.onThirdLogin(u)}return Q(()=>{b()}),(u,t)=>(F(),E(Y,null,[U(s(ue,{class:"enter-x"},null,512),[[A,z.value]]),U(s(e(O),{class:"p-4 enter-x",model:r,rules:e(G),ref_key:"formRef",ref:T,onKeypress:X(B,["enter"])},{default:a(()=>[s(e(i),{name:"account",class:"enter-x"},{default:a(()=>[s(e($),{ref_key:"usernameRef",ref:K,allowClear:"",size:"large",value:r.account,"onUpdate:value":t[0]||(t[0]=n=>r.account=n),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:a(()=>[s(e(w),{allowClear:"",size:"large",visibilityToggle:"",value:r.password,"onUpdate:value":t[1]||(t[1]=n=>r.password=n),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x",gutter:4},{default:a(()=>[s(e(l),{span:16},{default:a(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:a(()=>[s(e($),{allowClear:"",ref_key:"inputCodeRef",ref:R,autocomplete:"off",size:"large",value:r.inputCode,"onUpdate:value":t[2]||(t[2]=n=>r.inputCode=n),placeholder:e(o)("sys.login.inputCode")},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(l),{span:8},{default:a(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:a(()=>[m.requestCodeSuccess?(F(),E("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:b},null,8,ve)):(F(),E("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:ee,onClick:b}))]),_:1})]),_:1})]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(l),{span:12},{default:a(()=>[s(e(i),null,{default:a(()=>[s(e(me),{checked:M.value,"onUpdate:checked":t[3]||(t[3]=n=>M.value=n),size:"small"},{default:a(()=>[f(g(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(l),{span:12},{default:a(()=>[s(e(i),{style:{"text-align":"right"}},{default:a(()=>[s(e(x),{type:"link",size:"small",onClick:t[4]||(t[4]=n=>e(_)(e(v).RESET_PASSWORD))},{default:a(()=>[f(g(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:a(()=>[s(e(x),{type:"primary",size:"large",block:"",onClick:B,loading:I.value},{default:a(()=>[f(g(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(l),{md:8,xs:24},{default:a(()=>[s(e(x),{block:"",onClick:t[5]||(t[5]=n=>e(_)(e(v).MOBILE))},{default:a(()=>[f(g(e(o)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:a(()=>[s(e(x),{block:"",onClick:t[6]||(t[6]=n=>e(_)(e(v).QR_CODE))},{default:a(()=>[f(g(e(o)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:7,xs:24},{default:a(()=>[s(e(x),{block:"",onClick:t[7]||(t[7]=n=>e(_)(e(v).REGISTER))},{default:a(()=>[f(g(e(o)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(fe),{class:"enter-x"},{default:a(()=>[f(g(e(o)("sys.login.otherSignIn")),1)]),_:1}),k("div",{class:H(["flex justify-evenly enter-x",`${e(C)}-sign-in-way`])},[k("a",{onClick:t[8]||(t[8]=n=>h("github")),title:"github"},[s(e(ge))]),k("a",{onClick:t[9]||(t[9]=n=>h("wechat_enterprise")),title:"企业微信"},[s(e(S),{class:"item-icon",type:"icon-qiyeweixin3"})]),k("a",{onClick:t[10]||(t[10]=n=>h("dingtalk")),title:"钉钉"},[s(e(pe))]),k("a",{onClick:t[11]||(t[11]=n=>h("wechat_open")),title:"微信"},[s(e(ye))])],2)]),_:1},8,["model","rules","onKeypress"]),[[A,z.value]]),s(de,{ref_key:"thirdModalRef",ref:L},null,512)],64))}});export{Fe as _};
