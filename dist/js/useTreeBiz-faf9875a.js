var E=(y,k,l)=>new Promise((v,h)=>{var w=a=>{try{u(l.next(a))}catch(s){h(s)}},d=a=>{try{u(l.throw(a))}catch(s){h(s)}},u=a=>a.done?v(a.value):Promise.resolve(a.value).then(w,d);u((l=l.apply(y,k)).next())});import{ab as F}from"./index-fde9c72f.js";import{c as x,k as r,r as H,e as M,w as R,u as T,n as S}from"./vue-c7e3516e.js";function J(y,k,l){const v=x("selectOptions",r([])),h=x("selectValues",H({})),w=x("loadingEcho",r(!1)),d=r([]),u=r([]),a=r([]),s=r(!1),C=M(()=>l.multiple?l.checkStrictly:!0);let b=!0;R(h,({value:e})=>{!e||s.value==!1&&e.length>0&&(w.value=b,b=!1,g(null,e.join(",")).finally(()=>{w.value=!1}))},{immediate:!0});function K(){const e=T(y);if(!e)throw new Error("tree is null!");return e}function D(){S(()=>{l.defaultExpandLevel&&l.defaultExpandLevel>0&&K().filterByLevel(l.defaultExpandLevel),u.value=h.value}).then()}function j(e,t){if(l.checkable==!1){u.value=l.checkStrictly?e.checked:e;const{selectedNodes:n}=t;let c=[];n.forEach(i=>{c.push(i)}),a.value=c}}function B(e,t){if(l.checkable==!0){if(!l.multiple){if(t.checked){u.value=[t.node.eventKey];let i=l.rowKey,m=t.checkedNodes.find(f=>f[i]===t.node.eventKey);a.value=[m]}else u.value=[],a.value=[];return}u.value=l.checkStrictly?e.checked:e;const{checkedNodes:n}=t;let c=[];n.forEach(i=>{c.push(i)}),a.value=c}}function A(e){return E(this,null,function*(){K().checkAll(e),yield S(),u.value=K().getCheckedKeys(),e?O():a.value=[]})}function O(){let e="";T(u).length>0&&(e=u.value.join(",")),k({ids:e}).then(t=>{a.value=t})}function P(e){K().expandAll(e)}function g(e,t){return E(this,null,function*(){let n={},c="";e&&(c=e.eventKey,n.pid=e.value),t&&(c="",n.ids=t);let i=yield k(n),m=i;if(l.serverTreeData||(i=F(i,l,c),i.length==0&&e&&L(c,d.value)),s.value==!0){if(!e)d.value=i;else return new Promise(f=>{if(!e.children){f();return}const o=T(y);o&&(o.updateNodeByKey(e.eventKey,{children:i}),o.setExpandedKeys([e.eventKey,...o.getExpandedKeys()])),f()});D()}else{const f=[];m.forEach(o=>{f.push({label:o[l.titleKey],value:o[l.rowKey]})}),v.value=f}})}function L(e,t){if(t&&t.length>0)for(let n of t)if(n.key==e){n.child||(n.isLeaf=!0);break}else L(e,n.children)}function V(e){const t=[],n=[];a.value.forEach(c=>{t.push({label:c[l.labelKey],value:c[l.rowKey]})}),u.value.forEach(c=>{n.push(c)}),v.value=t,e&&e(t,n)}function z(e){return E(this,null,function*(){e?(s.value=!0,yield g(null,null)):s.value=!1})}return[{visibleChange:z,selectOptions:v,selectValues:h,onLoadData:g,onCheck:B,onSelect:j,checkALL:A,expandAll:P,checkedKeys:u,selectRows:a,treeData:d,getCheckStrictly:C,getSelectTreeData:V}]}export{J as u};
