import{d as O,l as g,r as W,V as u,a7 as B,ac as M,aa as m,f as v,E as b,ad as G,aq as P,W as j}from"./vue-ebecda47.js";import{ap as z,bB as H}from"./jeecg-online-vendor-cfb58502.js";import{B as U}from"./index-e91e8b28.js";import{dr as Q,c as Y}from"./antd-vue-vendor-b75e8c06.js";import"./index-a2e0ccba.js";import{Q as Z}from"./JAddInput-64f6e84f.js";import{E as $}from"./index-85cfc899.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-cd7703c8.js";import"./vxe-table-vendor-4aae63bf.js";import"./BasicModal-7e6e7ae9.js";import"./useWindowSizeFn-50bd5ea0.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./useForm-21b78d9f.js";import"./componentMap-c36c4b8d.js";import"./useFormItem-ba20c4de.js";import"./index-be9b0972.js";import"./download-c9e5f3f7.js";import"./base64Conver-fa2fe1af.js";import"./index-96e99de8.js";import"./index-118a05d7.js";import"./useCountdown-00a25cd7.js";import"./useFormItemSingle-36e25e6f.js";import"./JSelectUser-94adcf4d.js";import"./props-c57324f9.js";import"./JSelectBiz-4fc2f082.js";import"./JSelectDept-394df716.js";import"./index-097af6f9.js";import"./bem-311698ef.js";import"./props-13a58630.js";import"./useContextMenu-eb481e60.js";import"./JPopup-f9a8bda3.js";import"./cron-parser-vendor-afad4b1e.js";import"./JEllipsis-410bb5e8.js";import"./JUpload-ffe34816.js";import"./index-ae3841ab.js";import"./index-ab54dd3c.js";import"./areaDataUtil-4a5c6609.js";import"./index-1c3e0ea1.js";import"./depart.api-1888bf18.js";var D=(i,f,s)=>new Promise((C,h)=>{var w=r=>{try{d(s.next(r))}catch(l){h(l)}},x=r=>{try{d(s.throw(r))}catch(l){h(l)}},d=r=>r.done?C(r.value):Promise.resolve(r.value).then(w,x);d((s=s.apply(i,f)).next())});const X=O({name:"CodeFileViewModal",components:{BasicModal:U,InfoCircleTwoTone:Q,JCodeEditor:Z},emits:["download","register","close"],setup(i,{emit:f}){const s=g([]),C=g(""),h=g([]),w=g(!1),x=window.innerHeight-160,d=g("java"),r=g("");let l=W({});const[_,{closeModal:V}]=$(e=>D(this,null,function*(){l=W({}),r.value="",s.value=e.codeList,C.value=e.pathKey,y(),w.value=!0}));function y(){let e=q(),n=e[0];k(n,e);let o=[];const t=function(p){if(p.children){let a=p.children;a.length==1?t(a[0]):a.length>1&&o.push(p)}};t(n),h.value=o,setTimeout(()=>{E(n)},300)}function E(e){return D(this,null,function*(){const n=function(t){if(t.isLeaf===!0)return t;if(t.children)return n(t.children[0])};let o=n(e);if(o&&o.isLeaf===!0){let t=o.path;l[t]||(yield I(t)),d.value=F(t),r.value=l[t]}})}function k(e,n){for(let o of n)e.key==o.pid&&(e.children||(e.children=[]),e.children.push(o),k(o,n))}function N(e,n){let o=0,t="";for(;o<=n;)t+=e[o],o++;return t}function q(){let e=[],n=[],o=s.value;for(let t of o){let p=t.replace(new RegExp("\\\\","g"),"/").replace("生成成功：","").trim();if(p){let a=p.split("/");for(let c=0;c<a.length;c++){let L=a[c],R=N(a,c);if(L){let T={title:L,key:R};if(L!=0){let S=N(a,c-1);S&&(T.pid=S)}c==a.length-1&&(T.isLeaf=!0,T.path=p),(n.indexOf(R)<0||c==a.length-1)&&(e.push(T),n.push(R))}}}}return e}function A(){V(),f("close")}function J(){f("download")}function F(e){return e.endsWith("xml")?"application/xml":e.endsWith("sql")?"text/x-sql":e.endsWith("vue")?"text/x-vue":e.endsWith("ts")?"text/typescript":"text/x-java"}function K(e,n){return D(this,null,function*(){let o=n.node.dataRef;if(o.isLeaf){let t=o.path;l[t]||(yield I(t)),d.value=F(t),r.value=l[t]}})}function I(e){return new Promise(n=>{let o={path:encodeURI(e),pathKey:C.value};z.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(t=>{if(!t||t.size===0){Y.warning("文件下载失败");return}let p=new Blob([t]),a=new FileReader;a.readAsText(p,"utf8"),a.onload=function(){let c=this.result;l[e]=c,n(1)}})})}return{registerModal:_,codeList:s,onDownloadGenerateCode:J,handleClose:A,treeData:h,showCodeContent:K,activeCodeContent:r,expandStatus:w,height:x,language:d}}});function ee(i,f,s,C,h,w){const x=u("info-circle-two-tone"),d=u("a-directory-tree"),r=u("a-col"),l=u("JCodeEditor"),_=u("a-empty"),V=u("a-row"),y=u("a-button"),E=u("BasicModal");return B(),M(E,{onRegister:i.registerModal,okText:"",cancelText:"关闭",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:i.onDownloadGenerateCode},{title:m(()=>[v(x),b(" 代码在线预览 ")]),footer:m(()=>[v(y,{onClick:i.handleClose},{default:m(()=>[b("关闭")]),_:1},8,["onClick"]),v(y,{type:"primary",onClick:i.onDownloadGenerateCode},{default:m(()=>[b("下载到本地")]),_:1},8,["onClick"])]),default:m(()=>[G("div",null,[v(V,null,{default:m(()=>[v(r,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:m(()=>[G("div",{style:P({height:i.height+"px",overflowY:"auto"})},[i.treeData.length?(B(),M(d,{key:0,defaultExpandAll:!0,"tree-data":i.treeData,onSelect:i.showCodeContent},null,8,["tree-data","onSelect"])):j("",!0)],4)]),_:1}),v(r,{span:18,gutter:3},{default:m(()=>[i.activeCodeContent?(B(),M(l,{key:0,value:i.activeCodeContent,"onUpdate:value":f[0]||(f[0]=k=>i.activeCodeContent=k),theme:"idea",language:i.language,fullScreen:!1,lineNumbers:!0,height:i.height+"px","language-change":!0},null,8,["value","language","height"])):(B(),M(_,{key:1,style:{"margin-top":"50px"},description:"请选择左侧文件，显示详细代码"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}const Ke=H(X,[["render",ee]]);export{Ke as default};
