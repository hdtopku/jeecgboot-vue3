var we=Object.defineProperty,Ne=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var se=(e,y,s)=>y in e?we(e,y,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[y]=s,I=(e,y)=>{for(var s in y||(y={}))Ie.call(y,s)&&se(e,s,y[s]);if(ce)for(var s of ce(y))Ue.call(y,s)&&se(e,s,y[s]);return e},re=(e,y)=>Ne(e,Me(y));var ie=(e,y,s)=>new Promise((x,F)=>{var A=C=>{try{k(s.next(C))}catch(B){F(B)}},l=C=>{try{k(s.throw(C))}catch(B){F(B)}},k=C=>C.done?x(C.value):Promise.resolve(C.value).then(A,l);k((s=s.apply(e,y)).next())});import{d as Se,k as Ke,bb as Pe,e as M,w as P,aV as N,as as H,u as r,R as Oe,V as U,ar as J,bi as V,E as oe,ag as de,ad as ue,f as L,F as W,a_ as He,B as Ve,ae as je,aI as Re,bH as Xe,q as Ye,r as he,s as j,o as $e,v as ye,A as fe,aQ as ze,i as qe,J as $}from"./vue-c7e3516e.js";import{k as Ge,y as ke,f as Je,e as Q,v as Qe,aM as We,bi as Ze,aa as et,an as pe}from"./jeecg-online-vendor-bf2efbcb.js";import{B as tt,I as Z,f as nt,a9 as at,v as lt,y as ct}from"./index-fde9c72f.js";import{createBEM as xe}from"./bem-deccd0b6.js";import{buildProps as st}from"./props-c3781b9d.js";import{d9 as rt,ci as it,cj as ot,da as dt,db as ut,aa as ee,ac as ht,cF as yt,ch as ge,o as ft,aD as kt}from"./antd-vue-vendor-1561c1ba.js";import{useContextMenu as pt}from"./useContextMenu-c0be0b5c.js";import{d as gt}from"./lodash-es-vendor-42c8d3d4.js";var E=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(E||{});const St=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Kt=st({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),xt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},Lt=Se({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:y}){const s=e,x=Ke(""),[F]=xe("tree-header"),A=Pe(),{t:l}=Ge(),k=M(()=>{const t=A.headerTitle||s.title;return["mr-1","w-full",{["ml-5"]:t}]}),C=M(()=>{const{checkable:t}=s,a=[{label:l("component.tree.expandAll"),value:E.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:E.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:E.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:E.UN_SELECT_ALL,divider:t},...a,{label:l("component.tree.checkStrictly"),value:E.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:E.CHECK_UN_STRICTLY}]:a});function B(t){var c,i,d,o;const{key:a}=t;switch(a){case E.SELECT_ALL:(c=s.checkAll)==null||c.call(s,!0);break;case E.UN_SELECT_ALL:(i=s.checkAll)==null||i.call(s,!1);break;case E.EXPAND_ALL:(d=s.expandAll)==null||d.call(s,!0);break;case E.UN_EXPAND_ALL:(o=s.expandAll)==null||o.call(s,!1);break;case E.CHECK_STRICTLY:y("strictly-change",!1);break;case E.CHECK_UN_STRICTLY:y("strictly-change",!0);break}}function _(t){y("search",t)}const h=nt(_,200);return P(()=>x.value,t=>{h(t)}),P(()=>s.searchText,t=>{t!==x.value&&(x.value=t)}),(t,a)=>(N(),H("div",{class:ue([r(F)(),"flex px-2 py-1.5 items-center"])},[r(A).headerTitle?Oe(t.$slots,"headerTitle",{key:0}):U("",!0),!r(A).headerTitle&&t.title?(N(),J(r(tt),{key:1,helpMessage:t.helpMessage},{default:V(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):U("",!0),t.search||t.toolbar?(N(),H("div",xt,[t.search?(N(),H("div",{key:0,class:ue(k.value)},[L(r(rt),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:x.value,"onUpdate:value":a[0]||(a[0]=c=>x.value=c),onSearch:a[1]||(a[1]=c=>t.$emit("clickSearch",c))},null,8,["placeholder","value"])],2)):U("",!0),t.toolbar?(N(),J(r(ot),{key:1,onClick:a[2]||(a[2]=Ve(()=>{},["prevent"]))},{overlay:V(()=>[L(r(it),{onClick:B},{default:V(()=>[(N(!0),H(W,null,He(C.value,c=>(N(),H(W,{key:c.value},[L(r(dt),je(Re({key:c.value})),{default:V(()=>[oe(de(c.label),1)]),_:2},1040),c.divider?(N(),J(r(ut),{key:0})):U("",!0)],64))),128))]),_:1})]),default:V(()=>[L(r(Z),{icon:"ion:ellipsis-vertical"})]),_:1})):U("",!0)])):U("",!0)],2))}}),Ct=({icon:e})=>e?Xe(e)?Ye(Z,{icon:e,class:"mr-1"}):Z:null;function At(e,y){function s(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];t.push(o[c]);const f=o[i];f&&f.length&&t.push(...s(f))}return t}function x(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];o.disabled!==!0&&o.selectable!==!1&&t.push(o[c]);const f=o[i];f&&f.length&&t.push(...x(f))}return t}function F(h,t){const a=[],c=t||r(e),{key:i,children:d}=r(y);if(!d||!i)return a;for(let o=0;o<c.length;o++){const f=c[o],v=f[d];h===f[i]?(a.push(f[i]),v&&v.length&&a.push(...s(v))):v&&v.length&&a.push(...F(h,v))}return a}function A(h,t,a){if(!h)return;const c=a||r(e),{key:i,children:d}=r(y);if(!(!d||!i))for(let o=0;o<c.length;o++){const f=c[o],v=f[d];if(f[i]===h){c[o]=I(I({},c[o]),t);break}else v&&v.length&&A(h,t,f[d])}}function l(h=1,t,a=1){if(!h)return[];const c=[],i=t||r(e)||[];for(let d=0;d<i.length;d++){const o=i[d],{key:f,children:v}=r(y),z=f?o[f]:"",O=v?o[v]:[];c.push(z),O&&O.length&&a<h&&(a+=1,c.push(...l(h,O,a)))}return c}function k({parentKey:h=null,node:t,push:a="push"}){const c=ee(r(e));if(!h){c[a](t),e.value=c;return}const{key:i,children:d}=r(y);!d||!i||(ke(c,o=>{if(o[i]===h)return o[d]=o[d]||[],o[d][a](t),!0}),e.value=c)}function C({parentKey:h=null,list:t,push:a="push"}){const c=ee(r(e));if(!(!t||t.length<1))if(h){const{key:i,children:d}=r(y);if(!d||!i)return;ke(c,o=>{if(o[i]===h){o[d]=o[d]||[];for(let f=0;f<t.length;f++)o[d][a](t[f]);return e.value=c,!0}})}else for(let i=0;i<t.length;i++)c[a](t[i])}function B(h,t){if(!h)return;const a=t||r(e),{key:c,children:i}=r(y);if(!(!i||!c))for(let d=0;d<a.length;d++){const o=a[d],f=o[i];if(o[c]===h){a.splice(d,1);break}else f&&f.length&&B(h,o[i])}}function _(h,t,a){return!h&&h!==0?null:((t||r(e)).forEach(i=>{if((a==null?void 0:a.key)||(a==null?void 0:a.key)===0)return a;if(i.key===h){a=i;return}i.children&&i.children.length&&(a=_(h,i.children,a))}),a||null)}return{deleteNodeByKey:B,insertNodeByKey:k,insertNodesByKey:C,filterByLevel:l,updateNodeByKey:A,getAllKeys:s,getChildrenKeys:F,getEnabledKeys:x,getSelectedNode:_}}function vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const Nt=Se({name:"BasicTree",inheritAttrs:!1,props:Kt,emits:St,setup(e,{attrs:y,slots:s,emit:x,expose:F}){const[A]=xe("tree"),l=he({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),k=he({startSearch:!1,searchText:"",searchData:[]}),C=Ke([]),[B]=pt(),_=M(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),h=M(()=>{let n=re(I(I({blockNode:!0},y),e),{expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(_),"onUpdate:expandedKeys":u=>{l.expandedKeys=u,x("update:expandedKeys",u)},"onUpdate:selectedKeys":u=>{l.selectedKeys=u,x("update:selectedKeys",u)},onCheck:(u,S)=>{let p=$(l.checkedKeys);if(Je(p)&&k.startSearch){const K=S.node.eventKey;p=gt(p,z(K)),S.checked&&p.push(K),l.checkedKeys=p}else l.checkedKeys=u;const g=$(l.checkedKeys);x("update:value",g),x("check",g,S)},onRightClick:Ae});return ft(n,"treeData","class")}),t=M(()=>k.startSearch?k.searchData:r(C)),a=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:c,insertNodeByKey:i,insertNodesByKey:d,filterByLevel:o,updateNodeByKey:f,getAllKeys:v,getChildrenKeys:z,getEnabledKeys:O,getSelectedNode:Le}=At(C,_);function Ce(n,u){return!u&&e.renderIcon&&Q(e.renderIcon)?e.renderIcon(n):u}function Ae(S){return ie(this,arguments,function*({event:n,node:u}){var m;const{rightMenuList:p=[],beforeRightClick:g}=e;let K={event:n,items:[]};if(g&&Q(g)){let b=yield g(u,n);Array.isArray(b)?K.items=b:Object.assign(K,b)}else K.items=p;!((m=K.items)!=null&&m.length)||(K.items=K.items.filter(b=>!b.hidden),B(K))})}function R(n){l.expandedKeys=n}function ve(){return l.expandedKeys}function te(n){l.selectedKeys=n}function Ee(){return l.selectedKeys}function ne(n){l.checkedKeys=n}function be(){return l.checkedKeys}function ae(n){l.checkedKeys=n?O():[]}function q(n){l.expandedKeys=n?v():[]}function Te(n){l.checkStrictly=n}P(()=>e.searchValue,n=>{n!==k.searchText&&(k.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&G(k.searchText)});function G(n){if(n!==k.searchText&&(k.searchText=n),x("update:searchValue",n),!n){k.startSearch=!1;return}const{filterFn:u,checkable:S,expandOnSearch:p,checkOnSearch:g,selectedOnSearch:K}=r(e);k.startSearch=!0;const{title:m,key:b}=r(_),D=[];if(k.searchData=Qe(r(C),T=>{var X,Y;const w=u?u(n,T,r(_)):(Y=(X=T[m])==null?void 0:X.includes(n))!=null?Y:!1;return w&&D.push(T[b]),w},r(_)),p){const T=We(k.searchData).map(w=>w[b]);T&&T.length&&R(T)}g&&S&&D.length&&ne(D),K&&D.length&&te(D)}function _e(n,u){if(!(!e.clickRowToExpand||!u||u.length===0))if(!l.expandedKeys.includes(n))R([...l.expandedKeys,n]);else{const S=[...l.expandedKeys],p=S.findIndex(g=>g===n);p!==-1&&S.splice(p,1),R(S)}}j(()=>{C.value=e.treeData}),$e(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=o(n):e.defaultExpandAll&&q(!0)}),j(()=>{l.expandedKeys=e.expandedKeys}),j(()=>{l.selectedKeys=e.selectedKeys}),j(()=>{l.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{l.checkedKeys=$(e.value||[])},{immediate:!0}),P(()=>l.checkedKeys,()=>{const n=$(l.checkedKeys);x("update:value",n),x("change",n)}),j(()=>{l.checkStrictly=e.checkStrictly});const Be={setExpandedKeys:R,getExpandedKeys:ve,setSelectedKeys:te,getSelectedKeys:Ee,setCheckedKeys:ne,getCheckedKeys:be,insertNodeByKey:i,insertNodesByKey:d,deleteNodeByKey:c,updateNodeByKey:f,getSelectedNode:Le,checkAll:ae,expandAll:q,filterByLevel:n=>{l.expandedKeys=o(n)},setSearchValue:n=>{G(n)},getSearchValue:()=>k.searchText};function De(n){const{actionList:u}=e;if(!(!u||u.length===0))return u.map((S,p)=>{var K;let g=!0;return Q(S.show)?g=(K=S.show)==null?void 0:K.call(S,n):pe(S.show)&&(g=S.show),g?L("span",{key:p,class:A("action")},[S.render(n)]):null})}const Fe=M(()=>{const n=ee(t.value);return Ze(n,(u,S)=>{var le;const p=k.searchText,{highlight:g}=r(e),{title:K,key:m,children:b}=r(_),D=Ce(u,u.icon),T=kt(u,K),w=p?T.indexOf(p):-1,X=k.startSearch&&!et(p)&&g&&w!==-1,Y=`color: ${pe(g)?"#f50":g}`,me=X?L("span",{class:(le=r(h))!=null&&le.blockNode?`${A("content")}`:""},[L("span",null,[T.substr(0,w)]),L("span",{style:Y},[p]),L("span",null,[T.substr(w+p.length)])]):T;return u[K]=L("span",{class:`${A("title")} pl-2`,onClick:_e.bind(null,u[m],u[b])},[s!=null&&s.title?ct(s,"title",u):L(W,null,[D&&L(Ct,{icon:D},null),me,L("span",{class:A("actions")},[De(u)])])]),u}),n});return F(Be),()=>{let n;const{title:u,helpMessage:S,toolbar:p,search:g,checkable:K}=e,m=u||p||g||s.headerTitle,b={height:"calc(100% - 38px)"};return L("div",{class:[A(),"h-full",y.class]},[m&&L(Lt,{checkable:K,checkAll:ae,expandAll:q,title:u,search:g,toolbar:p,helpMessage:S,onStrictlyChange:Te,onSearch:G,onClickSearch:D=>x("search",D),searchText:k.searchText},vt(n=at(s))?n:{default:()=>[n]}),L(ht,{spinning:r(e.loading),tip:"\u52A0\u8F7D\u4E2D..."},{default:()=>[ye(L(lt,{style:b},{default:()=>[L(yt,ze(r(h),{showIcon:!1,treeData:Fe.value}),null)]}),[[fe,!r(a)]]),ye(L(ge,{image:ge.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[fe,r(a)]])]})])}}});export{Nt as _};
