import{c as g,l as D,e as F,n as h}from"./vue-ebecda47.js";import{r as I}from"./cgform.data-cbdd88c3-2ccae74f.js";import"./lodash-es-vendor-cd7703c8.js";import{p as N}from"./antd-vue-vendor-b75e8c06.js";var x=(b,m,a)=>new Promise((o,v)=>{var u=l=>{try{d(a.next(l))}catch(c){v(c)}},f=l=>{try{d(a.throw(l))}catch(c){v(c)}},d=l=>l.done?o(l.value):Promise.resolve(l.value).then(u,f);d((a=a.apply(b,m)).next())});function X(b){const m=g("tables"),a=g("fullScreenRef"),o=D(),v=D(!1),u=D([]),f=F(()=>({normal:a!=null&&a.value?430:260,noToolbar:a!=null&&a.value?480:320})),d=F(()=>["id"].concat(b.value.map(t=>t.key))),l=F(()=>({scrollY:{gt:15},scrollX:{gt:20}}));function c(t){return x(this,null,function*(){let e=o.value;if(yield e.fullValidateTable())throw{code:I,activeKey:t};let y=e.getTableData().map(s=>N(s,d.value)),p=e.getDeleteData().map(s=>s.id);return{tableData:y,deleteIds:p}})}function k(t,e=!1){return x(this,null,function*(){e?(u.value=[],yield h(),yield o.value.addOrInsert(t,0,null,{setActive:!1}),yield h(),o.value.recalcDisableRows()):u.value=t})}function w(t){let e=o.value,y=t.value.tableRef,p=t.value.getRemoveIds(),s=y.getXTable().internalData.tableFullData,R=e.getXTable().internalData.tableFullData;return s.forEach(r=>{let T=!1;if(R.forEach(n=>{if(r.id===n.id){let i=n.dbFieldName,E=n.dbFieldTxt;(r.dbFieldName!==i||r.dbFieldTxt!==E)&&e.setValues([{rowKey:n.id,values:{dbFieldName:r.dbFieldName,dbFieldTxt:r.dbFieldTxt}}]),T=!0}else p.forEach(i=>{i===n.id&&(e.removeRowsById(i),T=!0)})}),!T){let n=Object.assign({},r);b.value.forEach(i=>{i.key!=="dbFieldName"&&i.key!=="dbFieldTxt"&&(n[i.key]=i.defaultValue)}),e.addRows(n)}}),h()}return{tables:m,tableRef:o,loading:v,dataSource:u,columnKeys:d,tableHeight:f,tableProps:l,syncTable:w,validateData:c,setDataSource:k}}export{X as L};
