var B=(L,l,d)=>new Promise((i,w)=>{var I=c=>{try{p(d.next(c))}catch(C){w(C)}},o=c=>{try{p(d.throw(c))}catch(C){w(C)}},p=c=>c.done?i(c.value):Promise.resolve(c.value).then(I,o);p((d=d.apply(L,l)).next())});import{d as j,k as y,r as N,e as J,u as e,o as H,a5 as b,a6 as $,t as U,A,f as s,a7 as t,E as f,ab as g,aa as k,am as Q,ac as X,F as Y,J as Z}from"./vue-249e5fad.js";import{c as ee}from"./checkcode-5ec5fe8f.js";import{I as se,s as ae,J as te,K as oe,W as ne,q as le,N as ie,u as re}from"./jeecg-online-vendor-5792e8a1.js";import{m as ue,G as de,H as ce,L as v,I as me}from"./index-f3247ba0.js";import{_ as fe}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-28aba3ba.js";import ge from"./ThirdModal-ac457e87.js";import{a5 as G,ac as E,ad as pe,ae as x,af as ye,ag as Ce,ah as ke}from"./antd-vue-vendor-31afcf32.js";const ve=["src"],be=j({__name:"LoginForm",setup(L){const l=Ce,d=ke,i=G.Item,w=E.Password,I=se({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:o}=le(),{notification:p,createErrorModal:c}=re(),{prefixCls:C}=ue("login"),O=ae(),{setLoginState:_,getLoginState:P}=de(),{getFormRules:V}=ce(),T=y(),D=y(),R=y(!1),M=y(!1),r=N({account:"",password:"",inputCode:""}),m=N({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:W}=me(T),K=J(()=>e(P)===v.LOGIN),F=y(),z=y();function q(){return B(this,null,function*(){const u=yield W();if(u)try{R.value=!0;const{userInfo:a}=yield O.login(Z({password:u.password,username:u.account,captcha:u.inputCode,checkKey:m.checkKey,mode:"none"}));a&&p.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${a.realname}`,duration:3})}catch(a){p.error({message:o("sys.api.errorTip"),description:a.message||o("sys.api.networkExceptionMsg"),duration:3}),R.value=!1,a.message==="验证码错误"?(r.inputCode="",F.value.focus(),h()):(a.message==="该用户不存在，请注册"||a.message==="用户名或密码错误")&&z.value.focus()}})}function h(){r.inputCode="",m.checkKey=1629428467008,ie(m.checkKey).then(u=>{m.randCodeImage=u,m.requestCodeSuccess=!0,F.value.focus()})}function S(u){D.value.onThirdLogin(u)}return H(()=>{h()}),(u,a)=>(b(),$(Y,null,[U(s(fe,{class:"enter-x"},null,512),[[A,K.value]]),U(s(e(G),{class:"p-4 enter-x",model:r,rules:e(V),ref_key:"formRef",ref:T,onKeypress:X(q,["enter"])},{default:t(()=>[s(e(i),{name:"account",class:"enter-x"},{default:t(()=>[s(e(E),{ref_key:"usernameRef",ref:z,allowClear:"",size:"large",value:r.account,"onUpdate:value":a[0]||(a[0]=n=>r.account=n),placeholder:e(o)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:t(()=>[s(e(w),{allowClear:"",size:"large",visibilityToggle:"",value:r.password,"onUpdate:value":a[1]||(a[1]=n=>r.password=n),placeholder:e(o)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x",gutter:4},{default:t(()=>[s(e(l),{span:16},{default:t(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:t(()=>[s(e(E),{allowClear:"",ref_key:"inputCodeRef",ref:F,autocomplete:"off",size:"large",value:r.inputCode,"onUpdate:value":a[2]||(a[2]=n=>r.inputCode=n),placeholder:e(o)("sys.login.inputCode")},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(l),{span:8},{default:t(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:t(()=>[m.requestCodeSuccess?(b(),$("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:h},null,8,ve)):(b(),$("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:ee,onClick:h}))]),_:1})]),_:1})]),_:1}),s(e(d),{class:"enter-x"},{default:t(()=>[s(e(l),{span:12},{default:t(()=>[s(e(i),null,{default:t(()=>[s(e(pe),{checked:M.value,"onUpdate:checked":a[3]||(a[3]=n=>M.value=n),size:"small"},{default:t(()=>[f(g(e(o)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(l),{span:12},{default:t(()=>[s(e(i),{style:{"text-align":"right"}},{default:t(()=>[s(e(x),{type:"link",size:"small",onClick:a[4]||(a[4]=n=>e(_)(e(v).RESET_PASSWORD))},{default:t(()=>[f(g(e(o)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:t(()=>[s(e(x),{type:"primary",size:"large",block:"",onClick:q,loading:R.value},{default:t(()=>[f(g(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:t(()=>[s(e(l),{md:8,xs:24},{default:t(()=>[s(e(x),{block:"",onClick:a[5]||(a[5]=n=>e(_)(e(v).MOBILE))},{default:t(()=>[f(g(e(o)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:t(()=>[s(e(x),{block:"",onClick:a[6]||(a[6]=n=>e(_)(e(v).QR_CODE))},{default:t(()=>[f(g(e(o)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(l),{md:7,xs:24},{default:t(()=>[s(e(x),{block:"",onClick:a[7]||(a[7]=n=>e(_)(e(v).REGISTER))},{default:t(()=>[f(g(e(o)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(ye),{class:"enter-x"},{default:t(()=>[f(g(e(o)("sys.login.otherSignIn")),1)]),_:1}),k("div",{class:Q(["flex justify-evenly enter-x",`${e(C)}-sign-in-way`])},[k("a",{onClick:a[8]||(a[8]=n=>S("github")),title:"github"},[s(e(te))]),k("a",{onClick:a[9]||(a[9]=n=>S("wechat_enterprise")),title:"企业微信"},[s(e(I),{class:"item-icon",type:"icon-qiyeweixin3"})]),k("a",{onClick:a[10]||(a[10]=n=>S("dingtalk")),title:"钉钉"},[s(e(oe))]),k("a",{onClick:a[11]||(a[11]=n=>S("wechat_open")),title:"微信"},[s(e(ne))])],2)]),_:1},8,["model","rules","onKeypress"]),[[A,K.value]]),s(ge,{ref_key:"thirdModalRef",ref:D},null,512)],64))}});export{be as _};
