import{c7 as J,bW as O,ad as U}from"./jeecg-online-vendor-bf2efbcb.js";import{B as j}from"./index-8cf3aabb.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./componentMap-a6d21ad6.js";import{a8 as q}from"./antd-vue-vendor-1561c1ba.js";import{k as z}from"./JAddInput-2cbbbde9.js";import{A as H}from"./index-fde9c72f.js";import{d as Y,k as g,r as P,U as p,aV as k,ar as D,bi as f,f as C,E as M,at as S,af as Q,V as X}from"./vue-c7e3516e.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./useFormItem-4a12ff45.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./index-ed4be6fa.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";var V=(i,m,u)=>new Promise((v,h)=>{var w=l=>{try{s(u.next(l))}catch(a){h(a)}},_=l=>{try{s(u.throw(l))}catch(a){h(a)}},s=l=>l.done?v(l.value):Promise.resolve(l.value).then(w,_);s((u=u.apply(i,m)).next())});const Z=Y({name:"CodeFileViewModal",components:{BasicModal:j,InfoCircleTwoTone:J,JCodeEditor:z},emits:["download","register","close"],setup(i,{emit:m}){const u=g([]),v=g(""),h=g([]),w=g(!1),_=window.innerHeight-160,s=g("java"),l=g("");let a=P({});const[B,{closeModal:x}]=H(t=>V(this,null,function*(){a=P({}),l.value="",u.value=t.codeList,v.value=t.pathKey,y(),w.value=!0}));function y(){let t=W(),n=t[0];F(n,t);let o=[];const e=function(d){if(d.children){let r=d.children;r.length==1?e(r[0]):r.length>1&&o.push(d)}};e(n),h.value=o,setTimeout(()=>{b(n)},300)}function b(t){return V(this,null,function*(){const n=function(e){if(e.isLeaf===!0)return e;if(e.children)return n(e.children[0])};let o=n(t);if(o&&o.isLeaf===!0){let e=o.path;a[e]||(yield K(e)),s.value=R(e),l.value=a[e]}})}function F(t,n){for(let o of n)t.key==o.pid&&(t.children||(t.children=[]),t.children.push(o),F(o,n))}function A(t,n){let o=0,e="";for(;o<=n;)e+=t[o],o++;return e}function W(){let t=[],n=[],o=u.value;for(let e of o){let d=e.replace(new RegExp("\\\\","g"),"/").replace("\u751F\u6210\u6210\u529F\uFF1A","").trim();if(d){let r=d.split("/");for(let c=0;c<r.length;c++){let T=r[c],L=A(r,c);if(T){let E={title:T,key:L};if(T!=0){let N=A(r,c-1);N&&(E.pid=N)}c==r.length-1&&(E.isLeaf=!0,E.path=d),(n.indexOf(L)<0||c==r.length-1)&&(t.push(E),n.push(L))}}}}return t}function $(){x(),m("close")}function G(){m("download")}function R(t){return t.endsWith("xml")?"application/xml":t.endsWith("sql")?"text/x-sql":t.endsWith("vue")?"text/x-vue":t.endsWith("ts")?"text/typescript":"text/x-java"}function I(t,n){return V(this,null,function*(){let o=n.node.dataRef;if(o.isLeaf){let e=o.path;a[e]||(yield K(e)),s.value=R(e),l.value=a[e]}})}function K(t){return new Promise(n=>{let o={path:encodeURI(t),pathKey:v.value};U.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(e=>{if(!e||e.size===0){q.warning("\u6587\u4EF6\u4E0B\u8F7D\u5931\u8D25");return}let d=new Blob([e]),r=new FileReader;r.readAsText(d,"utf8"),r.onload=function(){let c=this.result;a[t]=c,n(1)}})})}return{registerModal:B,codeList:u,onDownloadGenerateCode:G,handleClose:$,treeData:h,showCodeContent:I,activeCodeContent:l,expandStatus:w,height:_,language:s}}});function ee(i,m,u,v,h,w){const _=p("info-circle-two-tone"),s=p("a-directory-tree"),l=p("a-col"),a=p("JCodeEditor"),B=p("a-empty"),x=p("a-row"),y=p("a-button"),b=p("BasicModal");return k(),D(b,{onRegister:i.registerModal,okText:"",cancelText:"\u5173\u95ED",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:i.onDownloadGenerateCode},{title:f(()=>[C(_),M(" \u4EE3\u7801\u5728\u7EBF\u9884\u89C8 ")]),footer:f(()=>[C(y,{onClick:i.handleClose},{default:f(()=>[M("\u5173\u95ED")]),_:1},8,["onClick"]),C(y,{type:"primary",onClick:i.onDownloadGenerateCode},{default:f(()=>[M("\u4E0B\u8F7D\u5230\u672C\u5730")]),_:1},8,["onClick"])]),default:f(()=>[S("div",null,[C(x,null,{default:f(()=>[C(l,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:f(()=>[S("div",{style:Q({height:i.height+"px",overflowY:"auto"})},[i.treeData.length?(k(),D(s,{key:0,defaultExpandAll:!0,"tree-data":i.treeData,onSelect:i.showCodeContent},null,8,["tree-data","onSelect"])):X("",!0)],4)]),_:1}),C(l,{span:18,gutter:3},{default:f(()=>[i.activeCodeContent?(k(),D(a,{key:0,value:i.activeCodeContent,"onUpdate:value":m[0]||(m[0]=F=>i.activeCodeContent=F),theme:"idea",language:i.language,fullScreen:!1,lineNumbers:!0,height:i.height+"px","language-change":!0},null,8,["value","language","height"])):(k(),D(B,{key:1,style:{"margin-top":"50px"},description:"\u8BF7\u9009\u62E9\u5DE6\u4FA7\u6587\u4EF6\uFF0C\u663E\u793A\u8BE6\u7EC6\u4EE3\u7801"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}var Ke=O(Z,[["render",ee]]);export{Ke as default};
