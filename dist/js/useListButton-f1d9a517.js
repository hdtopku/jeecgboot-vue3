import{E as q,r as he}from"./useExtendComponent-840bfd85.js";import{k as h,bE as Ee,t as Fe,r as se,J as _,n as ie}from"./vue-c7e3516e.js";import{ac as Be,c1 as ye,ad as v,l as me,r as De,aK as we}from"./jeecg-online-vendor-12004772.js";import{o as Pe,E as $,m as ge}from"./index-6916e394.js";import{u as ve,G as Oe}from"./OnlineForm-d4bd8338.js";import"./index-a882524d.js";import{p as Se}from"./pick-51214243.js";import{a9 as be}from"./antd-vue-vendor-1561c1ba.js";var Ce=Object.defineProperty,_e=Object.defineProperties,Re=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,fe=(a,i,f)=>i in a?Ce(a,i,{enumerable:!0,configurable:!0,writable:!0,value:f}):a[i]=f,C=(a,i)=>{for(var f in i||(i={}))Me.call(i,f)&&fe(a,f,i[f]);if(ce)for(var f of ce(i))Te.call(i,f)&&fe(a,f,i[f]);return a},pe=(a,i)=>_e(a,Re(i)),K=(a,i,f)=>new Promise((O,p)=>{var E=d=>{try{B(f.next(d))}catch(F){p(F)}},w=d=>{try{B(f.throw(d))}catch(F){p(F)}},B=d=>d.done?O(d.value):Promise.resolve(d.value).then(E,w);B((f=f.apply(a,i)).next())});const Ae={acceptHrefParams:"<p> \u8DF3\u8F6C\u65F6\u83B7\u53D6\u7684\u53C2\u6570\u4FE1\u606F",currentPage:"<p> \u5F53\u524D\u9875\u6570",currentTableName:"<p> \u5F53\u524D\u8868\u540D",description:"<p> \u5F53\u524D\u8868\u63CF\u8FF0",hasChildrenField:"<p> \u662F\u5426\u6709\u5B50\u8282\u70B9\u7684\u5B57\u6BB5\u540D\uFF0C\u4EC5\u6811\u5F62\u8868\u5355\u4E0B\u6709\u6548",isDesForm:"<p> xx",isTree:"<m> \u662F\u5426\u662F\u6811\u5F62\u8868\u5355 ",loadData:"<m> \u52A0\u8F7D\u5217\u8868\u6570\u636E",pageSize:"<p> \u6BCF\u4E00\u9875\u663E\u793A\u6761\u6570",queryParam:"<p> \u67E5\u8BE2\u6761\u4EF6\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u70B9\u51FB\u67E5\u8BE2\u540E\u624D\u4F1A\u66F4\u65B0\u6B64\u6570\u636E",selectedRowKeys:"<p> \u9009\u4E2D\u7684\u884C\u7684id\u6570\u7EC4",sortField:"<p> \u6392\u5E8F\u5B57\u6BB5",sortType:"<p> \u6392\u5E8F\u89C4\u5219",total:"<p> \u603B\u9875\u6570"},Ie={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess"};let ke={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const Ne={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(a,i)=>i[0]+"-"+i[1]+" \u5171"+a+"\u6761",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:Q,createErrorModal:Ue}=me();function ze(){const a=h(""),i=Ee(),f=h(),O=h(),p=h(!1),E=h([]),w=h(!0),B=h();let d={};const F={execButtonEnhance:function(t,r){if(l[q][t])if(he===t)R(t);else{let e=_(r);return l[q][t].call(l,l,e)}else if(l[q][t+"_hook"])if(r){let e=_(r);R(t+"_hook",e)}else R(t+"_hook")},isTree:function(t){return typeof t=="boolean"?(l.isTreeTable=t,t):l.isTreeTable}};function R(t,r){let u=l[q][t].toLocaleString().match(Oe);if(u.length>1){let n=u[1];g(n,r)}}const l=new Proxy(Ae,{get(t,r){if(typeof F[r]=="function")return F[r];{let e=d[a.value];return Reflect.get(e,r)}},set(t,r,e){let u=M();return Reflect.set(typeof e=="function"?F:u,r,e)},deleteProperty(t,r){return r===a.value?(delete d[r],!0):!1}}),{executeJsEnhanced:g}=ve({},l);function S(){let t=i.params.id;return t||(t=""),t}Pe(()=>{x()}),Fe(()=>{delete d[a.value]});function M(){let t=d[a.value];if(!t){let r=Object.assign({},ke,{onlineUrl:Ie});t=JSON.parse(JSON.stringify(r)),d[a.value]=t}return t}function X(){let t={},r=i.query;r&&(Object.keys(r).map(e=>{t[e]=r[e]}),l.acceptHrefParams=t)}function G(){return new Promise((t,r)=>{v.get({url:`${l.onlineUrl.getColumns}${a.value}`},{isTransformResponse:!1}).then(e=>{e.success?t(e.result):(Q.warning(e.message),r())}).catch(()=>{r()})})}function b(){return new Promise((t,r)=>{let e=`${l.onlineUrl.getData}${a.value}`;l.isTree()===!0&&(e=`${l.onlineUrl.getTreeData}${a.value}`);let u=T();v.get({url:e,params:u},{isTransformResponse:!1}).then(n=>{n.success?(j(n.result),t(!0)):(n.message==="NO_DB_SYNC"?Ue({title:"\u6570\u636E\u5E93\u672A\u540C\u6B65",content:"\u8BF7\u5148\u540C\u6B65\u6570\u636E\u5E93\u518D\u67E5\u770B\u6B64\u9875\u9762\uFF01",onOk:()=>De.back()}):Q.warning(n.message),r(!1))}).catch(()=>{let n="\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";Q.warning(n),r(!1)})})}function T(){const{sortField:t,sortType:r,acceptHrefParams:e,queryParam:u}=l;let n={};l.isTree()===!0?n.hasQuery="false":n.hasQuery="true";let s=Object.assign({},n,e,u,{column:t,order:r});p.value?(s.pageNo=p.value.current,s.pageSize=p.value.pageSize):s.pageSize=-521;let o=H();return s.superQueryMatchType=o.matchType||"",s.superQueryParams=o.params||"",ge(s)}function j(t){let r=0;Number(t.total)>0?(l.isTree()===!0?(E.value=P(t.records),ie(()=>{J(E.value)})):E.value=t.records,r=Number(t.total)):E.value=[],p.value&&(p.value=pe(C({},p.value),{total:r}))}function W(t,r,e){e&&e.order?(l.sortField=e.field,l.sortType=e.order=="ascend"?"asc":"desc"):(l.sortField="id",l.sortType="asc"),p.value&&(p.value=t),b()}function Y(t){l.description=t.description,l.currentTableName=t.currentTableName,l.isDesForm=t.isDesForm,l.desFormCode=t.desFormCode,l.ID=a.value;let{acceptHrefParams:r,queryParam:e,superQuery:u,currentPage:n,pageSize:s}=l;X(),e?f.value.initDefaultValues(e,r):l.queryParam={},u?O.value.initDefaultValues(u):l.superQuery={params:"",matchType:""},t.paginationFlag=="Y"?p.value=C(C({},Ne),{current:n,pageSize:s}):p.value=!1}function L(){return K(this,null,function*(){w.value=!0,yield ie(),w.value=!1})}const A={loadData:b,getLoadDataParams:T,reloadTable:L};Object.keys(A).map(t=>{l[t]=A[t]});let Z=h(!1);function ee(){return K(this,null,function*(){p.value&&(p.value=pe(C({},p.value),{current:1})),l.clearSelectedRow(),yield b()})}function P(t){if(t)return t.map(r=>{let e=l.hasChildrenField;if(r[e]=="1"){let u={id:r.id+"_loadChild",name:"loading...",isLoading:!0};u.jeecg_row_key=u.id,r.children=[u]}return r})}const I=h([]);function te(t){I.value=t}function J(t){let r=I.value;if(r.length>0){const{sortField:e,sortType:u,pidField:n}=l;let s=Object.assign({},{column:e,order:u});s.hasQuery="in";let o=Object.assign({});o.rule="in",o.type="text",o.val=r.join(","),o.field=n,o=[o],s.superQueryParams=encodeURI(JSON.stringify(o)),s.superQueryMatchType="and",s.batchFlag="true";let c=`${l.onlineUrl.getTreeData}${a.value}`;v.get({url:c,params:s},{isTransformResponse:!1}).then(m=>{if(m.success&&m.result.records&&m.result.records.length>0){let y=m.result.records;const N=new Map;for(let U of y){let D=U[n];if(r.join(",").includes(D)){let z=N.get(D);z==null&&(z=[]),z.push(U),N.set(D,z)}}let le=N,oe=U=>{U&&U.forEach(D=>{r.includes(D.id)&&(D.children=P(le.get(D.id)),oe(D.children))})};oe(t)}}).catch(()=>{let m="loadDataByExpandedRows\u8BF7\u6C42\u5217\u8868\u6570\u636E\u5F02\u5E38!";Q.warning(m)})}else return Promise.resolve()}function H(){if(!l.superQuery)return{};const{superQuery:{params:t,matchType:r},currentTableName:e}=l;let u=e+"@",n=[];if(t.length>0)for(let o of t){let c=C({},o),m=c.field;m.startsWith(u)&&(c.field=m.replace(u,"")),n.push(c)}let s=n.length>0?JSON.stringify(n):"";return{params:encodeURIComponent(s),matchType:r}}const k=h(!1);function V(t,r){l.superQuery={params:t,matchType:r},t.length==0?k.value=!1:k.value=!0,b()}const[ue,{openModal:re}]=$();function ne(t){if(t||(t={}),!t.row){let r=l.selectedRows;if(!r||r.length==0||r.length>1){Q.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u6570\u636E");return}t.row=r[0]}t.code=a.value,re(!0,t)}l.openCustomModal=ne;function x(){let t=S();a.value=t}x();function ae(t){let r=t.head.extConfigJson;r&&(B.value=JSON.parse(r))}return C({ID:a,onlineQueryFormOuter:f,superQueryButtonRef:O,loading:Z,reload:ee,dataSource:E,pagination:p,tableReloading:w,handleSpecialConfig:Y,onlineTableContext:l,handleChangeInTable:W,getColumnList:G,getTreeDataByResult:P,expandedRowKeys:I,handleExpandedRowsChange:te,onlineExtConfigJson:B,handleFormConfig:ae,superQueryStatus:k,handleSuperQuery:V,registerCustomModal:ue},A)}const de="onl_";function qe(a,i){const f={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[O,{openModal:p}]=$(),[E,{openModal:w}]=$(),[B,{openModal:d}]=$(),[F,{openModal:R}]=$(),{createMessage:l}=me(),g=se(f),S=se([]),M=se([]);function X(e){if(S.length=0,M.length=0,e&&e.length>0)for(let u=0;u<e.length;u++){let n=Se(e[u],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");n.buttonStyle=="button"?M.push(n):n.buttonStyle=="link"&&S.push(n)}}function G(e){Object.keys(g).forEach(u=>{g[u]=!0}),e&&e.length>0&&Object.keys(g).forEach(u=>{e.indexOf(u)>=0&&(g[u]=!1)})}function b(e){let u={isUpdate:!1};e&&(u.param=e),p(!0,u)}function T(e){a.beforeEdit(e).then(()=>{p(!0,{isUpdate:!0,record:e})}).catch(u=>{l.warning(u)})}const j=e=>({label:"\u5220\u9664",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:W.bind(null,e)}});function W(e){a.beforeDelete(e).then(()=>{H(e.id)}).catch(u=>{l.warning(u)})}function Y(e){let u=P(e),n=u&&(u=="1"||u=="3"||u=="4")||!u;return _(g.update)===!0&&n?[{label:"\u7F16\u8F91",onClick:T.bind(null,e)}]:[]}function L(e){return{label:"\u63D0\u4EA4\u6D41\u7A0B",popConfirm:{title:"\u786E\u8BA4\u63D0\u4EA4\u6D41\u7A0B\u5417\uFF1F",confirm:J.bind(null,e)}}}function A(e){return{label:"\u5BA1\u6279\u8FDB\u5EA6",onClick:Z.bind(null,e)}}function Z(e){const{currentTableName:u}=a;let n=de+u,s=e.id;R(!0,{flowCode:n,dataId:s})}function ee(e){let u=[];if(_(g.detail)===!0&&u.push({label:"\u8BE6\u60C5",onClick:I.bind(null,e)}),a.hasBpmStatus===!0&&_(g.bpm)===!0){let c=P(e);!c||c=="1"?u.push(L(e)):u.push(A(e))}if(i.value){let{reportPrintShow:c,reportPrintUrl:m}=i.value;c&&m&&u.push({label:"\u6253\u5370",onClick(){let y=m,N=e.id,le=Be();ye(y,N,le)}})}let n=P(e),s=n&&n=="1"||!n;_(g.delete)===!0&&s&&u.push(j(e));let o=S;if(o&&o.length>0)for(let c of o)r(c.exp||"",e)===!0&&u.push({label:c.buttonName,onClick:V.bind(null,e,c.buttonCode,c.optType)});return u}function P(e){const u="bpm_status";let n=e[u];return n||(n=e[u.toUpperCase()]),n}function I(e){d(!0,{isUpdate:!0,disableSubmit:!0,record:e})}function te(e){const{currentTableName:u,onlineUrl:{startProcess:n}}=a;let s={url:n,params:{flowCode:de+u,id:e.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},o={isTransformResponse:!1};return new Promise((c,m)=>{v.post(s,o).then(y=>{y.success?(c(y),l.success(y.message)):(m(),l.warning(y.message))})})}function J(e){return K(this,null,function*(){yield te(e),a.loadData()})}function H(e){let u=`${a.onlineUrl.optPre}${a.ID}/${e}`;return new Promise((n,s)=>{v.delete({url:u},{isTransformResponse:!1}).then(o=>{o.success?(l.success(o.message),a.loadData(),n(!0)):(l.warning(o.message),s())})})}function k(){let e=a.selectedRowKeys;if(e.length<=0)return l.warning("\u8BF7\u9009\u62E9\u4E00\u6761\u8BB0\u5F55\uFF01"),!1;{let u=[];e.forEach(function(s){let o=s;o&&o.endsWith("_loadChild")&&(o=o.replace("_loadChild","")),u.indexOf(o)<0&&u.push(o)});let n=u.join(",");be.confirm({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>K(this,null,function*(){yield H(n),a.clearSelectedRow()})})}}function V(e,u,n){if(n=="js")a.execButtonEnhance(u,e);else if(n=="action"){let s={formId:a.ID,buttonCode:u,dataId:e.id},o=`${a.onlineUrl.buttonAction}`;v.post({url:o,params:s},{isTransformResponse:!1}).then(c=>{c.success?(a.loadData(),l.success("\u5904\u7406\u5B8C\u6210!")):l.warning(c.message)})}}function ue(e){a.execButtonEnhance(e)}function re(e){let u=a.selectedRowKeys;if(!u||u.length==0)return l.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u6761\u8BB0\u5F55"),!1;let n=u.join(","),s={formId:a.ID,buttonCode:e,dataId:n},o=`${a.onlineUrl.buttonAction}`;v.post({url:o,params:s},{isTransformResponse:!1}).then(c=>{c.success?(a.loadData(),a.clearSelectedRow(),l.success("\u5904\u7406\u5B8C\u6210!")):l.warning(c.message)})}function ne(){w(!0)}const x=()=>`${a.onlineUrl.importXls}${a.ID}`,{handleExportXlsx:ae}=we();function t(){let e=a.getLoadDataParams(),u=a.selectedRowKeys;u&&u.length>0&&(e.selections=u.join(","));let n=JSON.stringify(ge(e)),s=`${a.onlineUrl.exportXls}${a.ID}`;const o=a.description;return ae(o,s,{paramsStr:n})}function r(e,u){if(!e||e=="")return!0;let n=e.split("#"),s=u[n[0]],o=n[1].toLowerCase();return o==="eq"?s==n[2]:o==="ne"?s!=n[2]:o==="empty"?n[2]==="true"?!s||s=="":s&&s.length>0:o==="in"?n[2].split(",").indexOf(String(s))>=0:!1}return{buttonSwitch:g,cgLinkButtonList:S,cgTopButtonList:M,importUrl:x,registerModal:O,handleAdd:b,handleEdit:T,handleBatchDelete:k,registerImportModal:E,onImportExcel:ne,onExportExcel:t,getDropDownActions:ee,getActions:Y,cgButtonJsHandler:ue,cgButtonActionHandler:re,cgButtonLinkHandler:V,initButtonList:X,initButtonSwitch:G,getDeleteButton:j,handleSubmitFlow:J,getSubmitFlowButton:L,registerDetailModal:B,registerBpmModal:F}}export{qe as a,ze as u};
