var ne=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var U=(e,l,a)=>l in e?ne(e,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[l]=a,G=(e,l)=>{for(var a in l||(l={}))ue.call(l,a)&&U(e,a,l[a]);if(P)for(var a of P(l))ce.call(l,a)&&U(e,a,l[a]);return e},Q=(e,l)=>oe(e,se(l));var R=(e,l,a)=>new Promise((g,h)=>{var p=n=>{try{o(a.next(n))}catch(u){h(u)}},r=n=>{try{o(a.throw(n))}catch(u){h(u)}},o=n=>n.done?g(n.value):Promise.resolve(n.value).then(p,r);o((a=a.apply(e,l)).next())});import{c as N,l as m,r as x,e as ie,w as A,u as E,n as W,d as ee,V as S,a7 as F,a8 as te,f as C,af as j,aa as k,ac as X,E as $,W as Y,p as H,s as re,J as Z}from"./vue-50733b77.js";import{B as de}from"./index-f7d688aa.js";import{a6 as fe,p as B,E as me,a7 as he,a8 as ve,F as pe}from"./index-b34ff7bc.js";import{ar as ae,_ as le}from"./jeecg-online-vendor-d3e1865b.js";import{t as ye}from"./props-2079d80b.js";import{_ as ge}from"./index-7963a080.js";import"./lodash-es-vendor-058e2396.js";import{o as ke}from"./antd-vue-vendor-c5335947.js";import{J as Ce}from"./JSelectBiz-f98b6288.js";import{useRuleFormItem as Se}from"./useFormItem-915d7f1b.js";function Ee(e,l,a,g){const h=N("selectOptions",m([])),p=N("selectValues",x({})),r=N("loadingEcho",m(!1)),o=m([]),n=m([]),u=m([]),y=m(!1),w=ie(()=>g.multiple?a.checkStrictly:!0);let D=!0;A(p,({value:t})=>{t&&y.value==!1&&t.length>0&&(r.value=D,D=!1,L(null,t.join(",")).finally(()=>{r.value=!1}))},{immediate:!0});function d(){const t=E(e);if(!t)throw new Error("tree is null!");return t}function b(){W(()=>{a.defaultExpandLevel&&a.defaultExpandLevel>0&&d().filterByLevel(a.defaultExpandLevel),n.value=p.value}).then()}function O(t,s){if(a.checkable==!1){n.value=a.checkStrictly?t.checked:t;const{selectedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function V(t,s){if(a.checkable==!0){if(!g.multiple){if(s.checked){n.value=[s.node.eventKey];let v=a.rowKey,z=s.checkedNodes.find(_=>_[v]===s.node.eventKey);u.value=[z]}else n.value=[],u.value=[];return}n.value=a.checkStrictly?t.checked:t;const{checkedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function f(t){return R(this,null,function*(){d().checkAll(t),yield W(),n.value=d().getCheckedKeys(),t?K():u.value=[]})}function K(){let t="";E(n).length>0&&(t=n.value.join(",")),l({ids:t}).then(s=>{u.value=s})}function J(t){d().expandAll(t)}function L(t,s){return R(this,null,function*(){let c={},i="";t&&(i=t.eventKey,c.pid=t.value),s&&(i="",c.ids=s);let v=yield l(c),z=v;if(a.serverTreeData||(v=fe(v,a,i),v.length==0&&t&&M(i,o.value)),y.value==!0){if(!t)o.value=v;else return new Promise(_=>{if(!t.children){_();return}const T=E(e);T&&(T.updateNodeByKey(t.eventKey,{children:v}),T.setExpandedKeys([t.eventKey,...T.getExpandedKeys()])),_()});b()}else{const _=[];z.forEach(T=>{_.push({label:T[a.titleKey],value:T[a.rowKey]})}),h.value=_}})}function M(t,s){if(s&&s.length>0)for(let c of s)if(c.key==t){c.child||(c.isLeaf=!0);break}else M(t,c.children)}function I(t){const s=[],c=[];u.value.forEach(i=>{s.push({label:i[a.labelKey],value:i[a.rowKey]})}),n.value.forEach(i=>{c.push(i)}),h.value=s,t&&t(s,c)}function q(t){return R(this,null,function*(){t?(y.value=!0,yield L(null,null)):y.value=!1})}return[{visibleChange:q,selectOptions:h,selectValues:p,onLoadData:L,onCheck:V,onSelect:O,checkALL:f,expandAll:J,checkedKeys:n,selectRows:u,treeData:o,getCheckStrictly:w,getSelectTreeData:I}]}const we=ee({name:"DeptSelectModal",components:{BasicModal:de,BasicTree:ge},props:Q(G({},ye),{modalTitle:{type:String,default:"部门选择"},value:B.oneOfType([B.string,B.array])}),emits:["register","getSelectResult"],setup(e,{emit:l,refs:a}){const[g,{closeModal:h}]=me(),p=ae(),r=m(null);let o=e.value===""?[]:e.value,n=Object.assign({},E(e),E(p),{value:o},{disabled:!1});const u=ke(n,"multiple"),y=s(),[{visibleChange:w,checkedKeys:D,getCheckStrictly:d,getSelectTreeData:b,onCheck:O,onLoadData:V,treeData:f,checkALL:K,expandAll:J,onSelect:L}]=Ee(r,y,u,e),M=m(e.params),I=m([]),q={key:e.rowKey};function t(){b((c,i)=>{l("getSelectResult",c,i),h()})}function s(){let c=e.sync?he:ve;return i=>c(Object.assign({},i,{primaryKey:e.rowKey}))}return{tree:I,handleOk:t,searchInfo:M,treeRef:r,treeData:f,onCheck:O,onSelect:L,checkALL:K,expandAll:J,fieldNames:q,checkedKeys:D,register:g,getBindValue:u,getCheckStrictly:d,visibleChange:w,onLoadData:V}}});function De(e,l,a,g,h,p){const r=S("BasicTree"),o=S("a-menu-item"),n=S("a-menu"),u=S("Icon"),y=S("a-button"),w=S("a-dropdown"),D=S("BasicModal");return F(),te("div",null,[C(D,j(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:"500px",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{insertFooter:k(()=>[C(w,{placement:"top"},{overlay:k(()=>[C(n,null,{default:k(()=>[e.multiple?(F(),X(o,{key:"1",onClick:l[0]||(l[0]=d=>e.checkALL(!0))},{default:k(()=>[$("全部勾选")]),_:1})):Y("",!0),e.multiple?(F(),X(o,{key:"2",onClick:l[1]||(l[1]=d=>e.checkALL(!1))},{default:k(()=>[$("取消全选")]),_:1})):Y("",!0),C(o,{key:"3",onClick:l[2]||(l[2]=d=>e.expandAll(!0))},{default:k(()=>[$("展开全部")]),_:1}),C(o,{key:"4",onClick:l[3]||(l[3]=d=>e.expandAll(!1))},{default:k(()=>[$("折叠全部")]),_:1})]),_:1})]),default:k(()=>[C(y,{style:{float:"left"}},{default:k(()=>[$(" 树操作 "),C(u,{icon:"ant-design:up-outlined"})]),_:1})]),_:1})]),default:k(()=>[C(r,j({ref:"treeRef",treeData:e.treeData,"load-data":e.sync==!1?null:e.onLoadData},e.getBindValue,{onSelect:e.onSelect,onCheck:e.onCheck,fieldNames:e.fieldNames,checkedKeys:e.checkedKeys,multiple:e.multiple,checkStrictly:e.getCheckStrictly}),null,16,["treeData","load-data","onSelect","onCheck","fieldNames","checkedKeys","multiple","checkStrictly"])]),_:1},16,["onRegister","title","onOk","onVisibleChange"])])}const Ke=le(we,[["render",De]]),_e=ee({name:"JSelectDept",components:{DeptSelectModal:Ke,JSelectBiz:Ce},inheritAttrs:!1,props:{value:B.oneOfType([B.string,B.array]),multiple:B.bool.def(!0)},emits:["options-change","change","select","update:value"],setup(e,{emit:l,refs:a}){const g=m(),[h,{openModal:p}]=pe(),[r]=Se(e,"value","change",g),o=m([]);let n=x({value:[]});const u=m(!1);H("selectOptions",o),H("selectValues",n),H("loadingEcho",u);const y=m(!1),w=ae();re(()=>{e.value&&d()}),A(()=>e.value,()=>{d()}),A(n,()=>{n&&(r.value=n.value)}),A(o,()=>{o&&l("select",Z(E(o)),Z(E(n)))});function D(){y.value=!0,p(!0,{isUpdate:!1})}function d(){let f=e.value?e.value:[];f&&typeof f=="string"?(r.value=f.split(","),n.value=f.split(",")):n.value=f}function b(f,K){o.value=f,r.value=K,n.value=K,l("update:value",K.join(","))}const O=Object.assign({},E(e),E(w));function V(f){l("update:value",f)}return{state:r,attrs:w,selectOptions:o,selectValues:n,loadingEcho:u,getBindValue:O,tag:y,regModal:h,setValue:b,handleOpen:D,handleChange:V}}});function Te(e,l,a,g,h,p){const r=S("JSelectBiz"),o=S("DeptSelectModal");return F(),te("div",null,[C(r,j({onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs,{onChange:e.handleChange}),null,16,["onHandleOpen","loading","onChange"]),C(o,j({onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{multiple:e.multiple}),null,16,["onRegister","onGetSelectResult","multiple"])])}const Je=le(_e,[["render",Te],["__scopeId","data-v-a8d1e27c"]]);export{Je as o};
