var N=(h,I,x)=>new Promise((P,U)=>{var O=c=>{try{d(x.next(c))}catch(C){U(C)}},$=c=>{try{d(x.throw(c))}catch(C){U(C)}},d=c=>c.done?P(c.value):Promise.resolve(c.value).then(O,$);d((x=x.apply(h,I)).next())});import{d as be,r as z,M as we,k as b,e as Re,u as n,V as f,a5 as s,a9 as w,a7 as r,f as a,a6 as p,F as _,a8 as R,E as y,ab as V,aa as D,ac as ee,W as B,ag as Ve,n as te}from"./vue-5a09445c.js";import{u as xe,B as Ue}from"./index-711dccc6.js";import{b as M}from"./jeecg-online-vendor-a80da268.js";import{c2 as T,bI as Be,bp as F,c3 as Ie}from"./antd-vue-vendor-04f0af1d.js";const Me=h=>M.get({url:"/sys/gatewayRoute/list",params:h}),Oe=h=>M.post({url:"/sys/gatewayRoute/updateAll",params:h}),je=(h,I)=>M.delete({url:"/sys/gatewayRoute/delete",data:h},{joinParamsToUrl:!0}).then(()=>{I()}),$e={key:0},ze={key:1},De={key:2},Pe={key:3},Ae={class:"btn",style:{"padding-top":"10px"}},He={class:"btn",style:{"padding-top":"10px"}},qe=be({__name:"RouteModal",emits:["register","success"],setup(h,{emit:I}){const x=z({xs:{span:24},sm:{span:5}}),P=z({xs:{span:24},sm:{span:16}});we();const U=b(!0),O=b(),$=b();let d=z({inputVisible:!1,inputValue:""});const c=b(0),C=b(-1),ae={routerId:[{required:!0,message:"routerId不能为空",trigger:"blur"}],name:[{required:!0,message:"路由名称不能为空",trigger:"blur"}],uri:[{required:!0,message:"uri不能为空",trigger:"blur"}]},j=["Path","Host","Method","After","Before","Between","RemoteAddr"],A=[{key:1,name:"限流过滤器"}],ne=b([{name:"Path",args:[]},{name:"Header",args:{header:"",regexp:""}},{name:"Query",args:{param:"",regexp:""}},{name:"Method",args:[]},{name:"Host",args:[]},{name:"Cookie",args:{name:"",regexp:""}},{name:"After",args:[]},{name:"Before",args:[]},{name:"Between",args:[]},{name:"RemoteAddr",args:[]}]),q=b();let u=z({});const[le,{setDrawerProps:H,closeDrawer:re}]=xe(e=>N(this,null,function*(){U.value=!!(e!=null&&e.isUpdate),H({confirmLoading:!1}),oe(),n(U)&&(u=Object.assign(u,e.record))})),ue=Re(()=>n(U)?"编辑路由":"新增路由");function se(e,l){let i=e.args.filter(g=>g!==l);e.args=i}function oe(){u=Object.assign(u,{id:"",routerId:"",name:"",uri:"",status:1,predicates:[],filters:[]})}function ie(e){u.predicates.push({args:e.args,name:e.name})}function de(e,l,i){l[i]=e.target.value}function pe(e,l,i,g){c.value=g,C.value=i,d.inputValue=l,te(()=>{$.value[0].focus()})}function ce(e,l){d.inputValue="",d.inputVisible=!0,c.value=l,te(()=>{O.value[0].focus()})}function S(e){}function E(e,l){e.predicates.splice(l,1)}function fe(e,l){e.args.splice(l,1)}function me(e,l){e.filters.splice(l,1)}function ge(e){e.args.push({key:"key"+e.args.length+1,value:""})}function ve(e){e.key==0&&u.filters.push({args:[{key:"name",value:"default"},{key:"fallbackUri",value:"forward:/fallback"}],name:"Hystrix",title:A[0].name}),e.key==1&&u.filters.push({args:[{key:"key-resolver",value:"#{@ipKeyResolver}"},{key:"redis-rate-limiter.replenishRate",value:20},{key:"redis-rate-limiter.burstCapacity",value:20}],name:"RequestRateLimiter",title:A[0].name})}function J(e){let l=e.args;const i=d.inputValue;i&&l.indexOf(i)===-1&&(e.args=[...l,d.inputValue]),d.inputVisible=!1,d.inputValue="",C.value=-1,c.value=-1}function Q(e,l,i){d.inputValue&&(e.args[i]=d.inputValue),C.value=-1,c.value=-1}function _e(){return N(this,null,function*(){yield q.value.validate().then(()=>{try{H({confirmLoading:!0});let e=Object.assign({},u,{predicates:JSON.stringify(u.predicates),filters:JSON.stringify(u.filters)});Oe({router:e}).then(()=>{re(),I("success")})}finally{H({confirmLoading:!1})}})})}return(e,l)=>{const i=f("a-input"),g=f("a-form-item"),ye=f("a-switch"),K=f("a-divider"),W=f("a-tag"),G=f("a-col"),ke=f("a-row"),X=f("a-menu-item"),Y=f("a-menu"),L=f("a-button"),Z=f("a-dropdown"),he=f("a-form-item-rest"),Ce=f("a-form");return s(),w(n(Ue),Ve(e.$attrs,{onRegister:n(le),title:ue.value,width:"30%",onOk:_e,destroyOnClose:"",showFooter:""}),{default:r(()=>[a(Ce,{ref_key:"formRef",ref:q,"label-col":x,"wrapper-col":P,model:n(u),rules:ae},{default:r(()=>[a(g,{label:"路由ID",name:"routerId"},{default:r(()=>[a(i,{value:n(u).routerId,"onUpdate:value":l[0]||(l[0]=t=>n(u).routerId=t),placeholder:"路由唯一ID"},null,8,["value"])]),_:1}),a(g,{label:"路由名称",name:"name"},{default:r(()=>[a(i,{value:n(u).name,"onUpdate:value":l[1]||(l[1]=t=>n(u).name=t),placeholder:"路由名称"},null,8,["value"])]),_:1}),a(g,{label:"路由URI",name:"uri"},{default:r(()=>[a(i,{value:n(u).uri,"onUpdate:value":l[2]||(l[2]=t=>n(u).uri=t),placeholder:"路由URL"},null,8,["value"])]),_:1}),a(g,{label:"路由状态",name:"status"},{default:r(()=>[a(ye,{"default-checked":"","checked-value":1,"un-checked-value":0,checked:n(u).status,"onUpdate:checked":l[3]||(l[3]=t=>n(u).status=t)},null,8,["checked"])]),_:1}),a(g,{name:"predicates",label:"路由条件"},{default:r(()=>[(s(!0),p(_,null,R(n(u).predicates,(t,k)=>(s(),p("div",null,[j.includes(t.name)?(s(),p(_,{key:0},[a(K,null,{default:r(()=>[y(V(t.name)+" ",1),a(n(T),{size:"22",onClick:o=>E(n(u),k)},null,8,["onClick"])]),_:2},1024),D("div",null,[(s(!0),p(_,null,R(t.args,(o,m)=>(s(),p(_,null,[m==C.value&&k==c.value?(s(),w(i,{key:0,ref_for:!0,ref_key:"inputRef2",ref:$,type:"text",size:"small",style:{width:"190px"},value:n(d).inputValue,"onUpdate:value":l[4]||(l[4]=v=>n(d).inputValue=v),onChange:S,onBlur:v=>Q(t,o,m),onKeyup:ee(v=>Q(t,o,m),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),w(W,{key:o,style:{"margin-bottom":"2px"},closable:!0,onClose:()=>se(t,o),onClick:v=>pe(t,o,m,k)},{default:r(()=>[y(V(o),1)]),_:2},1032,["onClose","onClick"]))],64))),256)),n(d).inputVisible&&k==c.value?(s(),w(i,{key:0,ref_for:!0,ref_key:"inputRef",ref:O,type:"text",size:"small",style:{width:"100px"},value:n(d).inputValue,"onUpdate:value":l[5]||(l[5]=o=>n(d).inputValue=o),onChange:S,onBlur:o=>J(t),onKeyup:ee(o=>J(t),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),w(W,{key:1,style:{background:"#fff",borderstyle:"dashed","margin-bottom":"2px"},onClick:o=>ce(t,k)},{default:r(()=>[a(n(Be),{size:"22"}),y(" 新建"+V(t.name),1)]),_:2},1032,["onClick"]))])],64)):B("",!0),j.includes(t.name)?B("",!0):(s(),p(_,{key:1},[a(K,null,{default:r(()=>[y(V(t.name)+" ",1),a(n(T),{size:"22",onClick:o=>E(n(u),k)},null,8,["onClick"])]),_:2},1024),D("div",null,[(s(!0),p(_,null,R(t.args,(o,m)=>(s(),w(ke,null,{default:r(()=>[a(G,{span:5,style:{"margin-top":"8px"}},{default:r(()=>[m=="header"?(s(),p("span",$e,"Header名称")):B("",!0),m=="regexp"?(s(),p("span",ze,"参数值")):B("",!0),m=="param"?(s(),p("span",De,"参数名")):B("",!0),m=="name"?(s(),p("span",Pe,"参数名")):B("",!0)]),_:2},1024),a(G,{span:18},{default:r(()=>[a(i,{defaultValue:o,placeholder:"参数值",style:{width:"70%","margin-right":"8px","margin-top":"3px"},onChange:v=>de(v,t.args,m)},null,8,["defaultValue","onChange"])]),_:2},1024)]),_:2},1024))),256))])],64))]))),256)),D("p",Ae,[a(Z,null,{overlay:r(()=>[a(Y,null,{default:r(()=>[(s(!0),p(_,null,R(ne.value,t=>(s(),w(X,{key:t.name,onClick:k=>ie(t)},{default:r(()=>[y(V(t.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:r(()=>[a(L,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:r(()=>[y(" 添加路由条件 "),a(n(F),{size:22})]),_:1})]),_:1})])]),_:1}),a(g,{name:"predicates",label:"过滤器"},{default:r(()=>[(s(!0),p(_,null,R(n(u).filters,(t,k)=>(s(),p("div",null,[a(K,null,{default:r(()=>[y(V(t.name)+" ",1),a(n(T),{size:"22",onClick:o=>me(n(u),k)},null,8,["onClick"])]),_:2},1024),(s(!0),p(_,null,R(t.args,(o,m)=>(s(),p("div",{key:o.key},[a(he,null,{default:r(()=>[a(i,{value:o.key,"onUpdate:value":v=>o.key=v,placeholder:"参数键",style:{width:"45%","margin-right":"8px"}},null,8,["value","onUpdate:value"]),a(i,{value:o.value,"onUpdate:value":v=>o.value=v,placeholder:"参数值",style:{width:"40%","margin-right":"8px","margin-top":"3px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(n(Ie),{size:22,onClick:v=>fe(t,m)},null,8,["onClick"])]))),128)),a(L,{type:"dashed",style:{"margin-left":"28%",width:"37%","margin-top":"5px"},size:"small",onClick:o=>ge(t)},{default:r(()=>[a(n(F),{size:22}),y(" 添加参数 ")]),_:2},1032,["onClick"])]))),256)),D("p",He,[a(Z,null,{overlay:r(()=>[a(Y,{onClick:ve},{default:r(()=>[(s(),p(_,null,R(A,t=>a(X,{key:t.key,name:t.name},{default:r(()=>[y(V(t.name),1)]),_:2},1032,["name"])),64))]),_:1})]),default:r(()=>[a(L,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:r(()=>[y(" 添加过滤器 "),a(n(F))]),_:1})]),_:1})])]),_:1})]),_:1},8,["label-col","wrapper-col","model"])]),_:1},16,["onRegister","title"])}}});export{qe as _,je as d,Me as g};
