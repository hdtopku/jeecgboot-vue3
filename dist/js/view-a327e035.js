var T=Object.defineProperty,B=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var y=(n,a,o)=>a in n?T(n,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[a]=o,k=(n,a)=>{for(var o in a||(a={}))$.call(a,o)&&y(n,o,a[o]);if(I)for(var o of I(a))q.call(a,o)&&y(n,o,a[o]);return n},x=(n,a)=>B(n,M(a));var g=(n,a,o)=>new Promise((f,d)=>{var r=e=>{try{s(o.next(e))}catch(p){d(p)}},c=e=>{try{s(o.throw(e))}catch(p){d(p)}},s=e=>e.done?f(e.value):Promise.resolve(e.value).then(r,c);s((o=o.apply(n,a)).next())});import{k as w,d as C,a4 as L,a3 as P,w as S,U as V,a5 as A,a6 as F,f as N,u as R}from"./vue-249e5fad.js";import{q as W}from"./page.api-ff6c5533.js";import{F as j,z as b}from"./index-12df1add.js";import"./index-1c1dc92f.js";import{s as G,B as H,o as J,C as K}from"./jeecg-online-vendor-ef755ff7.js";import Q from"./html2canvas-vendor-47cc7ff0.js";import"./antd-vue-vendor-31afcf32.js";import"./tinymce-vendor-676f8393.js";import"./lodash-es-vendor-c1987ca1.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-0b109a77.js";import"./BasicModal-e6e1e190.js";import"./useWindowSizeFn-8e659aab.js";function X(){const n=w();function a(d){let r=n.value;if(!r)return;const c={width:r.offsetWidth,height:r.offsetHeight};Q(r,{useCORS:!0,logging:!0}).then(s=>g(this,null,function*(){const e=s.toDataURL("image/png");yield o(e,c,d)}))}function o(d,r,c){return g(this,null,function*(){const s=yield f(d,r),e=document.createElement("a");e.href=s,e.download=`${c}.png`,e.click()})}function f(d,r){return new Promise(c=>{let s=document.createElement("canvas");const e=s.getContext("2d"),p=new Image;p.crossOrigin="Anonymous",p.src=d,p.onload=()=>{s.height=r.height,s.width=r.width,e.drawImage(p,0,0,r.width,r.height);const v=s.toDataURL("image/png");s=null,c(v)}})}return{exportRef:n,onExportImage:a}}const Y=C({name:"drag-page-view"}),Z=C(x(k({},Y),{props:{routeInfo:{type:Object,default:()=>{}}},emits:["loadOk"],setup(n,{emit:a}){const o=n,{setTitle:f}=j();G();const d=w(""),{currentRoute:r,push:c,resolve:s}=L(),e=w({name:"",coverUrl:"",backgroundColor:"",theme:"default",style:"default",designType:100,backgroundImage:"",componentData:[]});function p(){return g(this,null,function*(){const{params:t,path:i}=R(r);let u=t.id?t.id:i.substr(i.lastIndexOf("/")+1);d.value=u;const l=yield W({id:u});if(l.success){yield f(l.result.name);let m=l.result.template?JSON.parse(l.result.template):[];e.value.componentData=m,e.value.name=l.result.name,e.value.coverUrl=l.result.coverUrl,e.value.backgroundColor=l.result.backgroundColor,e.value.backgroundImage=l.result.backgroundImage,e.value.designType=l.result.designType,e.value.theme=l.result.theme||"default",e.value.style=l.result.style||"default"}})}function v(t,i){t&&t.indexOf("http")>-1?J(t):c({path:t,query:i})}b();const[z,{openModal:U}]=b(),h=P();function _(t,i){if(i.openMode==="2"){let u=s(t);window.open(u.href,"_blank")}else c(t)}function D(t){let i=t.operationType;if(i=="1"){let u={mode:"add",desformCode:t.worksheet.value,dataId:null,isOnline:!1,viewId:"",lowAppId:h.params.appId};U(!0,u)}else if(i=="2"){let u=h.params.appId,l=t.worksheet.value,m={path:`/myapp/${u}/desform/${l}`};t.view&&(m.query={view:t.view}),_(m,t)}else if(i=="3"){let u=h.params.appId,l=t.customPage.value,m={path:`/myapp/${u}/drag/${l}`};_(m,t)}}const{exportRef:E,onExportImage:O}=X();return S(()=>o.routeInfo,t=>{if(t&&t.exportImage){let i=e.value.name;O(i)}},{deep:!0,immediate:!0}),p(),(t,i)=>{const u=V("ViewEngine");return A(),F("div",{ref_key:"exportRef",ref:E},[N(u,{dragData:e.value,token:R(H)(),onGo:v,onBtnClick:D},null,8,["dragData","token"])],512)}}}));const fe=K(Z,[["__scopeId","data-v-9cdbf309"]]);export{fe as default};
