var T=(e,i,r)=>new Promise((B,s)=>{var C=l=>{try{u(r.next(l))}catch(d){s(d)}},m=l=>{try{u(r.throw(l))}catch(d){s(d)}},u=l=>l.done?B(l.value):Promise.resolve(l.value).then(C,m);u((r=r.apply(e,i)).next())});import{c as x,ad as ee,l as ae,_ as te}from"./jeecg-online-vendor-12004772.js";import{A as ue}from"./index-6916e394.js";import{B as se}from"./index-a882524d.js";import{cQ as oe}from"./antd-vue-vendor-1561c1ba.js";import{d as ne,k as p,r as re,e as le,u as n,U as g,aV as E,ar as I,bi as t,f as _,E as y,ax as L,ad as M,as as w,a_ as U,F as N,V,aQ as z,ag as $,aX as ie,aW as de,at as S}from"./vue-c7e3516e.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicModal-b901e352.js";import"./useWindowSizeFn-581ed1a8.js";const fe=ne({name:"loginSelect",components:{Avatar:oe,BasicModal:se},emits:["success","register"],setup(e,{emit:i}){const r=x(),{notification:B}=ae(),s=p(!1),C=p([]),m=p(""),u=p(!1),l=p([]),d=p(""),h=p(!1),b=p(""),D=p(),f=re({orgCode:void 0,tenantId:null}),o={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},[q,{closeModal:H}]=ue(),P=le(()=>{if(n(u)&&n(s))return"\u8BF7\u9009\u62E9\u79DF\u6237\u548C\u90E8\u95E8";if(n(u)&&!n(s))return"\u8BF7\u9009\u62E9\u90E8\u95E8";if(!n(u)&&n(s))return"\u8BF7\u9009\u62E9\u79DF\u6237"}),Q=p({tenantId:[{required:n(s),type:"number",message:"\u8BF7\u9009\u62E9\u79DF\u6237",trigger:"change"}],orgCode:[{required:n(u),message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:"change"}]}),W={labelCol:{span:4},wrapperCol:{span:18}};function X(a){var F,v;if(((F=a.userInfo)==null?void 0:F.orgCode)&&((v=a.userInfo)==null?void 0:v.orgCode)!==""){u.value=!1;return}let c=a.multi_depart;c==0?(B.warn({message:"\u63D0\u793A",description:"\u60A8\u5C1A\u672A\u5F52\u5C5E\u90E8\u95E8,\u8BF7\u786E\u8BA4\u8D26\u53F7\u4FE1\u606F",duration:3}),u.value=!1):c==2?(u.value=!0,l.value=a.departs):u.value=!1}function j(a){var F,v;if(((F=a.userInfo)==null?void 0:F.loginTenantId)&&((v=a.userInfo)==null?void 0:v.loginTenantId)!==0){s.value=!1;return}let c=a.tenantList;Array.isArray(c)&&(c.length===0?(s.value=!1,r.setTenant(f.tenantId)):c.length===1?(f.tenantId=c[0].id,s.value=!1,r.setTenant(f.tenantId)):(s.value=!0,C.value=c))}function G(){if(n(s)&&!f.tenantId)return m.value="error",!1;if(n(u)&&!f.orgCode)return d.value="error",!1;D.value.validate().then(()=>{J().then(()=>{r.setTenant(f.tenantId),i("success")}).catch(a=>{}).finally(()=>{O()})}).catch(a=>{})}function J(){return new Promise((a,c)=>{if(!n(u)&&!n(s))a();else{let F={orgCode:f.orgCode,loginTenantId:f.tenantId,username:n(b)};ee.put({url:"/sys/selectDepart",params:F}).then(v=>{v.userInfo?(r.setUserInfo(v.userInfo),a()):(K(v),r.logout(),c())})}})}function K(a){B.error({message:"\u767B\u5F55\u5931\u8D25",description:((a.response||{}).data||{}).message||a.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function O(){H(),k()}function Y(a){return T(this,null,function*(){a&&(b.value=r.username,yield k(),yield X(a),yield j(a),!n(u)&&!n(s)?i("success",r.getUserInfo):h.value=!0),a.isLogin=!1,r.setLoginInfo(a)})}function k(){C.value=[],m.value="",l.value=[],d.value=""}function Z(a){m.value=""}function R(a){d.value=""}return{registerModal:q,visible:h,tenantList:C,isMultiTenant:s,validate_status:m,isMultiDepart:u,departList:l,validate_status1:d,formState:f,rules:Q,layout:W,formRef:D,currTitle:P,config:o,handleTenantChange:Z,handleDepartChange:R,show:Y,handleSubmit:G}}});const A=e=>(ie("data-v-456d5286"),e=e(),de(),e),ce=A(()=>S("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),pe=A(()=>S("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",-1)),me=A(()=>S("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1)),ve=A(()=>S("span",{style:{color:"#ed6f6f"}},"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",-1));function ge(e,i,r,B,s,C){const m=g("a-avatar"),u=g("a-tooltip"),l=g("a-select-option"),d=g("a-select"),h=g("a-form-item"),b=g("a-form"),D=g("a-button"),f=g("BasicModal");return E(),I(f,z(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":i[2]||(i[2]=o=>e.visible=o)}),{footer:t(()=>[_(D,{onClick:e.handleSubmit,type:"primary"},{default:t(()=>[y("\u786E\u8BA4")]),_:1},8,["onClick"])]),default:t(()=>[_(b,z({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:t(()=>[e.isMultiTenant?(E(),I(h,{key:0,name:"tenantId","validate-status":e.validate_status},L({label:t(()=>[_(u,{placement:"topLeft"},{title:t(()=>[ce]),default:t(()=>[_(m,{style:{"background-color":"#87d068"},size:30},{default:t(()=>[y(" \u79DF\u6237 ")]),_:1})]),_:1})]),default:t(()=>[_(d,{value:e.formState.tenantId,"onUpdate:value":i[0]||(i[0]=o=>e.formState.tenantId=o),onChange:e.handleTenantChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u79DF\u6237",class:M({"valid-error":e.validate_status=="error"})},{default:t(()=>[(E(!0),w(N,null,U(e.tenantList,o=>(E(),I(l,{key:o.id,value:o.id},{default:t(()=>[y($(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status=="error"?{name:"extra",fn:t(()=>[pe]),key:"0"}:void 0]),1032,["validate-status"])):V("",!0),e.isMultiDepart?(E(),I(h,{key:1,"validate-status":e.validate_status1,colon:!1},L({label:t(()=>[_(u,{placement:"topLeft"},{title:t(()=>[me]),default:t(()=>[_(m,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:t(()=>[y(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:t(()=>[_(d,{value:e.formState.orgCode,"onUpdate:value":i[1]||(i[1]=o=>e.formState.orgCode=o),onChange:e.handleDepartChange,placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:M({"valid-error":e.validate_status1=="error"})},{default:t(()=>[(E(!0),w(N,null,U(e.departList,o=>(E(),I(l,{key:o.orgCode,value:o.orgCode},{default:t(()=>[y($(o.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange","class"])]),_:2},[e.validate_status1=="error"?{name:"extra",fn:t(()=>[ve]),key:"0"}:void 0]),1032,["validate-status"])):V("",!0)]),_:1},16,["model","rules"])]),_:1},16,["onRegister","title","visible"])}const Le=te(fe,[["render",ge],["__scopeId","data-v-456d5286"]]);export{Le as default};
