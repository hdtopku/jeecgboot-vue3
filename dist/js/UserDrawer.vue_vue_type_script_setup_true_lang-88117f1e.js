var B=Object.defineProperty;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var D=(i,s,r)=>s in i?B(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r,A=(i,s)=>{for(var r in s||(s={}))S.call(s,r)&&D(i,r,s[r]);if(v)for(var r of v(s))P.call(s,r)&&D(i,r,s[r]);return i};var y=(i,s,r)=>new Promise((w,c)=>{var h=o=>{try{p(r.next(o))}catch(d){c(d)}},g=o=>{try{p(r.throw(o))}catch(d){c(d)}},p=o=>o.done?w(o.value):Promise.resolve(o.value).then(h,g);p((r=r.apply(i,s)).next())});import{B as L}from"./BasicForm-e7d3537f.js";import"./componentMap-42aebfee.js";import{u as k}from"./useForm-b8bb8b05.js";import"./JAddInput-6e8b52df.js";import"./JSelectUser-9d666511.js";import"./JSelectDept-113b0470.js";import"./JPopup-746d3c0b.js";import"./index-26fb0584.js";import"./cron-parser-vendor-b0ab0fe2.js";import"./index-9ca8f863.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-8153fc9b.js";import{f as O}from"./user.data-2f11d3e0.js";import{u as C,B as V}from"./index-2ed3aa04.js";import{g as W,a as j,b as x,c as N,s as G}from"./user.api-0a40541d.js";import{useDrawerAdaptiveWidth as K}from"./useAdaptiveWidth-227426ee.js";import{U as M}from"./jeecg-online-vendor-9cc54e36.js";import{d as $,M as q,k as f,e as z,u as t,a5 as E,a9 as H,a7 as J,f as Q,ag as X}from"./vue-5a09445c.js";const he=$({__name:"UserDrawer",emits:["success","register"],setup(i,{emit:s}){q();const r=f(!0),w=f(""),c=f([]),[h,{setProps:g,resetFields:p,setFieldsValue:o,validate:d,updateSchema:F}]=k({labelWidth:90,schemas:O,showActionButtonGroup:!1}),m=f(!0),[b,{setDrawerProps:I,closeDrawer:R}]=C(e=>y(this,null,function*(){var l;if(yield p(),m.value=(l=e==null?void 0:e.showFooter)!=null?l:!0,I({confirmLoading:!1,showFooter:m.value}),r.value=!!(e!=null&&e.isUpdate),t(r)){w.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const n=yield W({userid:e.record.id});n&&n.length>0&&(e.record.selectedroles=n)}catch(n){}const a=yield j({userId:e.record.id});if(a&&a.length>0){e.record.selecteddeparts=a;let n=Array.from(a,({key:u})=>u);e.record.selecteddeparts=n.join(","),c.value=a.map(u=>({label:u.title,value:u.key}))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=!e.record.departIds||e.record.departIds==""?[]:e.record.departIds}e.selectedroles&&(yield o({selectedroles:e.selectedroles})),F([{field:"password",show:!t(r)},{field:"confirmPassword",ifShow:!t(r)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:c}},{field:"selecteddeparts",show:!(e!=null&&e.departDisabled)},{field:"selectedroles",show:!(e!=null&&e.departDisabled),componentProps:{api:e.tenantSaas?x:N}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!t(r)&&e.tenantSaas&&(yield o({relTenantIds:M().toString()})),typeof e.record=="object"&&o(A({},e.record)),g({disabled:!m.value})})),T=z(()=>t(r)?"编辑用户":"新增用户"),{adaptiveWidth:U}=K();function _(){return y(this,null,function*(){try{let e=yield d();I({confirmLoading:!0}),e.userIdentity===1&&(e.departIds="");let l=t(r);yield G(e,l),R(),s("success",{isUpdateVal:l,values:e})}finally{I({confirmLoading:!1})}})}return(e,l)=>(E(),H(t(V),X(e.$attrs,{onRegister:t(b),title:T.value,width:t(U),onOk:_,showFooter:m.value,destroyOnClose:""}),{default:J(()=>[Q(t(L),{onRegister:t(h)},null,8,["onRegister"])]),_:1},16,["onRegister","title","width","showFooter"]))}});export{he as _};
