import{B as E}from"./index-8cf3aabb.js";import{B as A}from"./BasicForm-83ba9c88.js";import"./componentMap-a6d21ad6.js";import{u as L}from"./useForm-fa63344e.js";import"./JAddInput-2cbbbde9.js";import{A as I}from"./index-fde9c72f.js";import{bW as D,ad as R,l as j}from"./jeecg-online-vendor-bf2efbcb.js";import{o as q}from"./omit-13df237f.js";import"./toString-8deea73b.js";import"./isArray-b183d537.js";import"./_baseClone-632ebf1c.js";import"./_arrayPush-ae8b790e.js";import"./_flatRest-34ab130c.js";import{k as h,U as B,aV as N,ar as $,bi as _,f as v,aQ as H}from"./vue-c7e3516e.js";import"./BasicModal-ff8f2086.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./useWindowSizeFn-e5cad7ae.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./useFormItem-4a12ff45.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./index-ed4be6fa.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./_baseSlice-834c0c3e.js";var J=Object.defineProperty,y=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,F=(r,o,t)=>o in r?J(r,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[o]=t,Q=(r,o)=>{for(var t in o||(o={}))K.call(o,t)&&F(r,t,o[t]);if(y)for(var t of y(o))G.call(o,t)&&F(r,t,o[t]);return r},m=(r,o,t)=>new Promise((n,a)=>{var s=i=>{try{p(t.next(i))}catch(d){a(d)}},u=i=>{try{p(t.throw(i))}catch(d){a(d)}},p=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,u);p((t=t.apply(r,o)).next())});const U={name:"LinkTableFieldConfigModal",emits:["success","register"],components:{BasicModal:E,BasicForm:A},setup(r,{emit:o}){const t=h(!1),n=h([]),a=h([]);let s={},u={};const{createMessage:p}=j(),[i,{closeModal:d}]=I(e=>m(this,null,function*(){u=Q({},e.record),s=e.tableAndFieldsMap,yield O(),yield b({dictTable:e.record.dictTable}),setTimeout(()=>m(this,null,function*(){let l=q(e.record,"dictTable");yield b(l),yield M()}),200)}));function O(){return m(this,null,function*(){let e=Object.keys(s);if(!e||e.length==0)n.value=[];else{let l=[];for(let c of e)l.push({text:s[c].title,value:c});n.value=l}})}function C(e){return m(this,null,function*(){if(e){const{table:l,fields:c}=s[e];if(!l){p.warning("\u8BF7\u5148\u5B8C\u5584\u5B57\u6BB5["+e+"]\u5173\u8054\u8BB0\u5F55\u7684\u914D\u7F6E");return}const P="/online/cgform/field/listByHeadCode",g=yield R.get({url:P,params:{headCode:l}});if(g&&g.length>0){let S=g.map(f=>({text:f.dbFieldTxt,value:f.dbFieldName})),V=c.split(",");a.value=S.filter(f=>V.indexOf(f.value)>0)}else a.value=[]}})}const T=[{label:"rowKey",field:"rowKey",component:"Input",show:!1},{label:"\u5B57\u6BB5\u63CF\u8FF0",field:"dbFieldTxt",component:"Input",required:!0},{label:"\u5173\u8054\u8BB0\u5F55",field:"dictTable",component:"JSearchSelect",required:!0,componentProps:({formActionType:e})=>({async:!1,popContainer:".link-table-field-config-modal",dictOptions:n.value,immediateChange:!0,onChange:c=>m(this,null,function*(){u.dictText&&(yield e.setFieldsValue({dictText:""}),yield e.clearValidate()),C(c)})})},{label:"\u663E\u793A\u5B57\u6BB5",field:"dictText",component:"JSearchSelect",required:!0,componentProps:{async:!1,popContainer:".link-table-field-config-modal",dictOptions:a,onChange:e=>{u.dictText=e}}}],[w,{validate:x,setFieldsValue:b,clearValidate:M}]=L({schemas:T,showActionButtonGroup:!1,labelAlign:"right"});function k(){return m(this,null,function*(){const e=yield x();o("success",e),d()})}return{registerModal:i,spinningLoading:t,registerForm:w,handleSubmit:k}}};function W(r,o,t,n,a,s){const u=B("BasicForm"),p=B("a-spin"),i=B("BasicModal");return N(),$(i,H({wrapClassName:"link-table-field-config-modal"},r.$attrs,{title:"\u4ED6\u8868\u5B57\u6BB5\u914D\u7F6E",onRegister:n.registerModal,keyboard:"",canFullscreen:!1,cancelText:"\u5173\u95ED",onOk:n.handleSubmit}),{default:_(()=>[v(p,{spinning:n.spinningLoading},{default:_(()=>[v(u,{onRegister:n.registerForm},null,8,["onRegister"])]),_:1},8,["spinning"])]),_:1},16,["onRegister","onOk"])}var je=D(U,[["render",W]]);export{je as default};
