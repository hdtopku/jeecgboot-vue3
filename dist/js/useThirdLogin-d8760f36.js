var x=Object.defineProperty;var y=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var T=(t,n,i)=>n in t?x(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,U=(t,n)=>{for(var i in n||(n={}))H.call(n,i)&&T(t,i,n[i]);if(y)for(var i of y(n))q.call(n,i)&&T(t,i,n[i]);return t};import{k as z,d as G,c as N,ad as F,bj as J,l as K}from"./jeecg-online-vendor-bf2efbcb.js";import{k as u,u as o}from"./vue-c7e3516e.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";function _(){const{createMessage:t,notification:n}=K(),{t:i}=z(),D=G(),P=N(),w=u(""),r=u({}),g=u(!1),h=u(!1),B=u(""),l=u(!1),p=u(!1),d=u(""),L=u(""),m=u(!1),c=u(""),v=u("");function S(e){let s=`${D.uploadUrl}/sys/thirdLogin/render/${e}`;window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),w.value=e,r.value={},g.value=!1;let j=function(O){let a=O.data;if(typeof a=="string")if(a==="\u767B\u5F55\u5931\u8D25")t.warning(a);else if(a.includes("\u7ED1\u5B9A\u624B\u673A\u53F7")){h.value=!0;let R=a.split(",");B.value=R[1]}else f(a);else typeof a=="object"?a.isObj===!0&&(l.value=!0,r.value=U({},a)):t.warning("\u4E0D\u8BC6\u522B\u7684\u4FE1\u606F\u4F20\u9012")};window.addEventListener("message",j,!1)}function f(e){o(g)===!1&&(g.value=!0,P.ThirdLogin({token:e,thirdType:o(w)}).then(s=>{s&&s.userInfo?n.success({message:i("sys.login.loginSuccessTitle"),description:`${i("sys.login.loginSuccessDesc")}: ${s.userInfo.realname}`,duration:3}):k(s)}))}function k(e){n.error({message:"\u767B\u5F55\u5931\u8D25",description:((e.response||{}).data||{}).message||e.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function A(){d.value="",L.value=r.value.uuid,l.value=!1,p.value=!0}function E(){m.value=!0,r.value.suffix=parseInt(Math.random()*98+1),F.post({url:"/sys/third/user/create",params:{thirdLoginInfo:o(r)}},{isTransformResponse:!1}).then(e=>{if(e.success){let s=e.result;f(s),l.value=!1}else t.warning(e.message)}).finally(()=>{m.value=!1})}function I(){let e=Object.assign({},o(r),{password:o(d)});F.post({url:"/sys/third/user/checkPassword",params:e},{isTransformResponse:!1}).then(s=>{s.success?(b(),f(s.result)):t.warning(s.message)})}function b(){p.value=!1,d.value="",L.value=""}function M(){return J({mobile:o(c),smsmode:"0"})}function $(){o(c)||C("\u8BF7\u8F93\u5165\u624B\u673A\u53F7"),o(v)||C("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801");let e={mobile:o(c),captcha:o(v),thirdUserUuid:o(B)};F.post({url:"/sys/thirdLogin/bindingThirdPhone",params:e},{isTransformResponse:!1}).then(s=>{s.success?(h.value=!1,f(s.result)):t.warning(s.message)})}function C(e){n.error({message:"\u767B\u5F55\u5931\u8D25",description:e,duration:4})}return{thirdPasswordShow:p,thirdLoginCheckPassword:I,thirdLoginNoPassword:b,thirdLoginPassword:d,thirdConfirmShow:l,thirdCreateUserLoding:m,thirdLoginUserCreate:E,thirdLoginUserBind:A,bindingPhoneModal:h,thirdHandleOk:$,thirdPhone:c,thirdCaptcha:v,onThirdLogin:S,sendCodeApi:M}}export{_ as useThirdLogin};
