import{V as A,C as Q,a5 as q,b as G,u as X}from"./jeecg-online-vendor-a80da268.js";import{P as Y}from"./index-0f5326ee.js";import Z from"./DetailForm-e4538e7a-7460ca89.js";import ee from"./OnlineSubFormDetail-0aa4966c-dcfbd4e9.js";import{h as te}from"./useExtendComponent-48d37d9b-bf2a5eb0.js";import{e as re}from"./constant-fe20103a-44089532.js";import"./JUpload.vue_vue_type_style_index_0_lang-c2f2a386.js";import"./componentMap-3d0064b3.js";import"./BasicForm.vue_vue_type_style_index_0_lang-92cda8aa.js";import{bV as oe}from"./antd-vue-vendor-04f0af1d.js";import"./index-5effa088.js";import"./JAddInput-7a10c45b.js";import"./JSelectUser-0b713614.js";import"./JSelectDept-a5c54ddb.js";import"./JPopup-cd3c8a0f.js";import"./cron-parser-vendor-278b5be3.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-d40bf8e2.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-18270bc5.js";import"./BasicTable.vue_vue_type_style_index_0_lang-370f2588.js";import"./useTable-e785b2d6.js";import"./LinkTableListPiece-34266919-92c59f43.js";import{k as d,r as ae,V as u,a5 as s,a6 as S,f as T,W as j,a9 as P,a7 as R,F as ie,a8 as ne,an as le,R as me}from"./vue-5a09445c.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./BasicForm-862341ae.js";import"./BasicModal-588c46fe.js";import"./useWindowSizeFn-31e0259d.js";import"./useForm-3526c2e4.js";import"./user.api-99a0b5cb.js";import"./customExpression-62f5afd1.js";import"./BasicTable-0c3b97e4.js";import"./useFormItem-742dfe7c.js";/* empty css              */import"./download-d03a8b78.js";import"./base64Conver-fa2fe1af.js";import"./index-eae03fd6.js";import"./index-73ed1f2f.js";import"./useCountdown-85782a4d.js";import"./useFormItemSingle-373c20d8.js";import"./areaDataUtil-1f845736.js";import"./props-4cb7d255.js";import"./JSelectBiz-bd869605.js";import"./index-21f376b3.js";import"./index-14b4b10a.js";import"./bem-8d785cce.js";import"./props-17f0c5eb.js";import"./useContextMenu-16ff3db3.js";import"./depart.api-19a655aa.js";import"./index-b484e0e9.js";import"./index-42cdfb26.js";import"./injectionKey-69710956.js";import"./useListPage-5c54d46c.js";import"./OnlineSelectCascade-c7baf52b-c8fd8464.js";import"./JModalTip-abe1515a-31977e16.js";var pe=Object.defineProperty,D=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,M=(n,i,o)=>i in n?pe(n,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[i]=o,fe=(n,i)=>{for(var o in i||(i={}))se.call(i,o)&&M(n,o,i[o]);if(D)for(var o of D(i))ue.call(i,o)&&M(n,o,i[o]);return n},V=(n,i,o)=>new Promise((r,h)=>{var v=m=>{try{p(o.next(m))}catch(f){h(f)}},g=m=>{try{p(o.throw(m))}catch(f){h(f)}},p=m=>m.done?r(m.value):Promise.resolve(m.value).then(v,g);p((o=o.apply(n,i)).next())});const ce={name:"OnlineFormDetail",components:{DetailForm:Z,Loading:Y,PrinterOutlined:oe,OnlineSubFormDetail:ee},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},showSub:{type:Boolean,default:!0},themeTemplate:{type:String,default:""}},emits:["success","rendered"],setup(n,{emit:i}){const{createMessage:o}=X(),r=d(""),h=d(!0),v=d(!1),g=d(1),p=d({}),m=d(300),f=d(340),b=ae({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{detailFormSchemas:k,hasSubTable:w,subTabInfo:F,refMap:l,showStatus:y,subDataSource:x,createFormSchemas:N,formSpan:B}=te(n);function J(e){let t={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};e&&(t=JSON.parse(e)),Object.keys(t).map(a=>{b[a]=t[a]})}function E(e){return V(this,null,function*(){g.value=e.head.tableType,r.value=e.head.tableName,h.value=e.head.tableType==1,J(e.head.extConfigJson),N(e.schema.properties),i("rendered",b)})}function H(e,t){return V(this,null,function*(){yield L(t),C(!0)})}function I(e){let t=`/online/cgform/api/detail/${n.id}/${e}`;return new Promise((a,c)=>{G.get({url:t},{isTransformResponse:!1}).then(O=>{O.success?a(O.result):(c(),o.warning(O.message))}).catch(()=>{c()})})}function C(e){Object.keys(y).map(t=>{y[t]=e})}function _(){C(!1),setTimeout(()=>{C(!0)},300)}function L(e){return V(this,null,function*(){let t=yield I(e.id);p.value=fe({},t),U(t)})}function U(e){e||(e={});let t=Object.keys(x.value);if(t&&t.length>0){let a={};for(let c of t)a[c]=e[c]||[];x.value=a}}function z(e){return"online_"+e+":"}function K(){let e=b.reportPrintUrl,t=p.value;if(t){let a=t.id,c=Q();q(e,a,c)}}function W(e){let t=p.value;return $(t,e)}function $(e,t){if(e){let a=e[t];return!a&&a!==0&&(a=e[t.toLowerCase()],!a&&a!==0&&(a=e[t.toUpperCase()])),a}return""}return{detailFormSchemas:k,formData:p,formSpan:B,tableName:r,loading:v,hasSubTable:w,subTabInfo:F,subFormHeight:m,subTableHeight:f,refMap:l,onTabChange:_,subDataSource:x,getSubTableAuthPre:z,show:H,createRootProperties:E,onOpenReportPrint:K,onlineExtConfigJson:b,getSubTableForeignKeyValue:W,showStatus:y,ERP:re}}},de=["id"],be={key:0,style:{"text-align":"right",position:"absolute",top:"15px",right:"20px","z-index":"999"}},he={key:1};function ge(n,i,o,r,h,v){const g=u("PrinterOutlined"),p=u("detail-form"),m=u("online-sub-form-detail"),f=u("JVxeTable"),b=u("a-spin"),k=u("a-tab-pane"),w=u("a-tabs"),F=u("Loading");return s(),S("div",{id:r.tableName+"_form"},[r.formData.id&&r.onlineExtConfigJson.reportPrintShow?(s(),S("div",be,[T(g,{title:"打印",onClick:r.onOpenReportPrint,style:{"font-size":"16px"}},null,8,["onClick"])])):j("",!0),T(p,{schemas:r.detailFormSchemas,data:r.formData,span:r.formSpan},null,8,["schemas","data","span"]),o.themeTemplate!==r.ERP&&r.hasSubTable&&o.showSub?(s(),P(w,{key:1,onChange:r.onTabChange},{default:R(()=>[(s(!0),S(ie,null,ne(r.subTabInfo,(l,y)=>(s(),P(k,{tab:l.describe,key:y+"",forceRender:!0},{default:R(()=>[l.relationType==1?(s(),S("div",{key:0,style:le({"overflow-y":"auto","overflow-x":"hidden","max-height":r.subFormHeight+"px"})},[T(m,{table:l.key,"form-template":o.formTemplate,"main-id":r.getSubTableForeignKeyValue(l.foreignKey),properties:l.properties},null,8,["table","form-template","main-id","properties"])],4)):(s(),S("div",he,[r.showStatus[l.key]?(s(),P(f,{key:0,ref_for:!0,ref:r.refMap[l.key],toolbar:"","keep-source":"","row-number":"","row-selection":"",height:r.subTableHeight,disabled:!0,columns:l.columns,dataSource:r.subDataSource[l.key],authPre:r.getSubTableAuthPre(l.key)},null,8,["height","columns","dataSource","authPre"])):(s(),P(b,{key:1,spinning:!0}))]))]),_:2},1032,["tab"]))),128))]),_:1},8,["onChange"])):j("",!0),T(F,{loading:r.loading,absolute:!1},null,8,["loading"]),me(n.$slots,"bottom")],8,de)}const Tt=A(ce,[["render",ge]]);export{Tt as default};
