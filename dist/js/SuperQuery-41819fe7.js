import{k as A,w as ae,U as d,aV as C,as as re,at as g,ar as B,bi as a,f as o,E as v,V as he,ad as ue,v as ie,A as se,F as de,a_ as ge,ag as Fe,j as Ee,r as ce,bE as Ce,J as fe,aX as De,aW as be}from"./vue-c7e3516e.js";import{B as ke}from"./index-a882524d.js";import{E as we,A as Se,aM as oe}from"./index-6916e394.js";import{bW as Oe,b9 as Be,bX as Ae,bY as Ie,aQ as xe,l as ve}from"./jeecg-online-vendor-12004772.js";import{u as Me,F as Te}from"./useExtendComponent-840bfd85.js";import{_ as Pe}from"./SuperQueryValComponent.vue_vue_type_script_lang-cab2b64a.js";import"./componentMap-90ab712d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-8cb333b2.js";import{U as Re,l as Ve,cI as je,ch as Qe,a9 as Ne}from"./antd-vue-vendor-1561c1ba.js";import"./JAddInput-dff0b84f.js";import"./JUpload.vue_vue_type_style_index_0_lang-5851070a.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-88479361.js";import"./pick-51214243.js";import"./_flatRest-34ab130c.js";import"./isArray-b183d537.js";import"./toString-8deea73b.js";import"./_arrayPush-ae8b790e.js";import"./BasicTable.vue_vue_type_style_index_0_lang-3c8b8bcc.js";import"./useTable-7c8820b4.js";import"./LinkTableListPiece-ee383d81.js";import"./OnlineSelectCascade-96168c23.js";import"./BasicModal-b901e352.js";import"./useWindowSizeFn-581ed1a8.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm-030e7c21.js";import"./useForm-ae9e1cbd.js";import"./user.api-ea86029c.js";import"./_commonjsHelpers-938fab4e.js";import"./customExpression-e22f3cce.js";import"./BasicTable-04058a09.js";import"./useFormItem-cc50e63d.js";import"./download-fc124faf.js";import"./base64Conver-4e359726.js";import"./index-d83c9bcd.js";import"./index-6d615beb.js";import"./useCountdown-61c82faf.js";import"./areaDataUtil-13d415af.js";import"./useSelectBiz-f95680cd.js";import"./props-18305405.js";import"./index-3ce15f67.js";import"./bem-2be191b9.js";import"./props-c3781b9d.js";import"./useContextMenu-1b1215cd.js";import"./useTreeBiz-cda2af6e.js";import"./index-c5567c31.js";import"./depart.api-de6ffddd.js";import"./index-fcc2460e.js";import"./injectionKey-5da932b3.js";import"./useListPage-8d85dabf.js";import"./JModalTip-2822aa1b.js";import"./_baseSlice-834c0c3e.js";var qe=Object.defineProperty,Ue=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,Je=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,me=(f,u,_)=>u in f?qe(f,u,{enumerable:!0,configurable:!0,writable:!0,value:_}):f[u]=_,_e=(f,u)=>{for(var _ in u||(u={}))Je.call(u,_)&&me(f,_,u[_]);if(pe)for(var _ of pe(u))We.call(u,_)&&me(f,_,u[_]);return f},ye=(f,u)=>Ue(f,Le(u));const Ke={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},Xe="JSuperQuerySaved_";function Ye(){const{linkTableCard2Select:f}=Me(),{createMessage:u}=ve(),_=A(),e=ce({values:[]}),I=A("and"),[le,{setModalProps:Y}]=Se(()=>{Y({confirmLoading:!1})}),Q=Object.assign({},{link_down:"text"},Ke);function F(){}function z(){}function G(t,l,r){r.val=l}const x=A({}),M=A([]);function m(t){let{allFields:l,treeData:r}=D(t);x.value=l,M.value=r}function N(t){let l={field:void 0,rule:"eq",val:"",key:oe(16)};t===!1?(e.values=[],e.values.push(l)):t===!0?e.values.length==0&&e.values.push(l):e.values.splice(++t,0,l)}function k(t){let l=fe(e.values),r=-1;for(let n=0;n<l.length;n++)if(t.key==l[n].key){r=n;break}r!=-1&&e.values.splice(r,1)}const q={field:"val",label:"\u6D4B\u8BD5",component:"Input"};function U(t,l){let n=x.value[t.field];if(!n)return q;Q[n.view]&&(n.view=Q[n.view]);let p=Te.createFormSchema(t.field,n);p.noChange(),p.asSearchForm(),p.updateField(t.field+l);const c=b=>{t.val=b[t.field]};p.setFunctionForFieldValue(c);let h=p.getFormItemSchema();return["empty","not_empty"].includes(t.rule)&&(h.componentProps=ye(_e({},h.componentProps),{disabled:!0})),f(h),h}const L=A(""),T=xe(),E=ce({visible:!1,title:"",content:"",saveCode:""}),H=A(!1),P=Ce();ae(()=>P.fullPath,t=>{J()});const y=A([]);ae(()=>y.value,t=>{let l=[];t&&t.length>0&&t.map(r=>{let n=oe(16);l.push({title:r.title,slots:{icon:"custom"},value:n})}),L.value=l},{immediate:!0,deep:!0});function J(){let t=Xe+P.fullPath;E.saveCode=t;let l=T.get(t);l&&l instanceof Array&&(y.value=l)}J();function Z(){let t=w();if(!t){u.warning("\u7A7A\u6761\u4EF6\u4E0D\u80FD\u4FDD\u5B58");return}let l=JSON.stringify(t);$(l)}function $(t){E.visible=!0,E.title="",E.content=t}function V(){let{title:t,content:l,saveCode:r}=E,n=W(t);n>=0?Ne.confirm({title:"\u63D0\u793A",content:`${t} \u5DF2\u5B58\u5728\uFF0C\u662F\u5426\u8986\u76D6\uFF1F`,okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk:()=>{y.value.splice(n,1,{content:l,title:t,type:I.value}),T.set(r,y.value),E.visible=!1,u.success("\u4FDD\u5B58\u6210\u529F")}}):(y.value.push({content:l,title:t,type:I.value}),T.set(r,y.value),E.visible=!1,u.success("\u4FDD\u5B58\u6210\u529F"))}function W(t){let l=y.value,r=-1;for(let n=0;n<l.length;n++)if(l[n].title==t){r=n;break}return r}function w(t=!1){var l;let r=e.values;if(!r||r.length==0)return!1;let n=[],p=x.value;for(let c of r){let h=["empty","not_empty"].includes(c.rule);if(c.field&&(h||c.val||c.val===0)&&c.rule){let b=p[c.field],R=(l=b==null?void 0:b.formatValue)!=null?l:j=>j,O=fe(c.val);O instanceof Array?O=O.map(j=>R(j)).join(","):O=R(O);let X={field:ee(c),rule:c.rule,val:O};if(t===!0){let j=p[c.field];j&&(X.type=j.view,X.dbType=j.type)}n.push(X)}}return n.length==0?!1:n}function ee(t){let l=t.field;return l.indexOf("@")>0&&(l=l.replace("@",",")),l}function te(t,{node:l}){let r=l.dataRef.title,n=y.value.filter(p=>p.title==r);if(n&&n.length>0){let{content:p,type:c}=n[0],h=JSON.parse(p),b=[];for(let R of h)b.push(Object.assign({},{key:oe(16)},R));e.values=b,I.value=c}}function i(t){let l=W(t);l>=0&&(y.value.splice(l,1),T.set(E.saveCode,y.value))}function D(t){let l={},r=1,n=[];return t.properties&&(t=t.properties),Object.keys(t).map(p=>{let c=t[p];if(c.view=="table"){let h=c.properties||c.fields,b=r*100,R={title:c.title,value:p,disabled:!0,children:[],order:b};Object.keys(h).map(O=>{let K=h[O];K.order=b+K.order;let X=p+"@"+O;l[X]=K,R.children.push({title:K.title,value:X,isLeaf:!0,order:K.order})}),s(R),n.push(R),r++}else{let h=p;l[h]=c,n.push({title:c.title,value:h,isLeaf:!0,order:c.order})}}),s(n),{allFields:l,treeData:n}}function s(t){(t.children||t).sort(function(r,n){return r.order-n.order})}function S(t){const{params:l,matchType:r}=t;if(l){let n=[];for(let p of l)n.push(Object.assign({},{key:oe(16)},p));e.values=n,r.value=r}}return{formRef:_,init:m,dynamicRowValues:e,matchType:I,registerModal:le,handleSubmit:F,handleCancel:z,handleSave:Z,doSaveQueryInfo:V,saveInfo:E,saveTreeData:L,handleRemoveSaveInfo:i,handleTreeSelect:te,fieldTreeData:M,addOne:N,removeOne:k,setFormModel:G,getSchema:U,loading:H,getQueryInfo:w,initDefaultValues:S}}const ze={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1},online:{type:Boolean,default:!1}},components:{BasicModal:ke,MinusCircleOutlined:Be,PlusOutlined:Re,OnlineSuperQueryValComponent:Pe,FileTextOutlined:Ae,CloseCircleOutlined:Ve,AppstoreTwoTone:Ie,Divider:je},emits:["search"],setup(f,{emit:u}){const[_,e]=we(),{createMessage:I}=ve(),le=A(!0);function Y(){e.closeModal()}function Q(){if(f.online===!0){let s=V(!0);s&&s.length>0?u("search",s,m.value):I.warning("\u7A7A\u6761\u4EF6\u65E0\u6CD5\u67E5\u8BE2\uFF01")}else{let s=V(!0);if(s&&s.length>0){let S=F(s);u("search",S)}else I.warning("\u7A7A\u6761\u4EF6\u65E0\u6CD5\u67E5\u8BE2\uFF01")}}function F(s){let S=[];for(let l of s){let r=l.field,n=l.val;n instanceof Array&&(n=n.join(",")),S.push(ye(_e({},l),{field:r,val:n}))}return S.length>0?w.value=!0:w.value=!1,{superQueryMatchType:m.value,superQueryParams:encodeURI(JSON.stringify(S))}}function z(){M.values=[],P(!1);let s=F([]);u("search",s)}const{formRef:G,init:x,dynamicRowValues:M,matchType:m,registerModal:N,handleSave:k,doSaveQueryInfo:q,saveInfo:U,saveTreeData:L,handleTreeSelect:T,handleRemoveSaveInfo:E,fieldTreeData:H,addOne:P,removeOne:y,setFormModel:J,getSchema:Z,loading:$,getQueryInfo:V,initDefaultValues:W}=Ye(),w=A(!1);ae(()=>f.status,s=>{w.value=s},{immediate:!0});function ee(){e.openModal(),P(!0)}function te(){return document.getElementsByClassName("jee-super-query-form")[0]}function i(s){}function D(s){s.val=""}return ae(()=>f.config,s=>{s&&x(s)},{immediate:!0}),{formRef:G,registerFormModal:_,init:x,handleChangeField:D,dynamicRowValues:M,matchType:m,historyCollapsed:le,registerModal:N,handleSubmit:Q,handleCancel:Y,handleSave:k,handleReset:z,doSaveQueryInfo:q,saveInfo:U,saveTreeData:L,handleTreeSelect:T,handleRemoveSaveInfo:E,fieldTreeData:H,addOne:P,removeOne:y,setFormModel:J,getSchema:Z,loading:$,onFinish:i,getPopupContainer:te,superQueryFlag:w,handleOpen:ee,initDefaultValues:W,simpleImage:Qe.PRESENTED_IMAGE_SIMPLE}}},ne=f=>(De("data-v-31ffc821"),f=f(),be(),f),Ge={class:"j-super-query-button"},He=ne(()=>g("span",null,"\u5DF2\u6709\u9AD8\u7EA7\u67E5\u8BE2\u6761\u4EF6\u751F\u6548",-1)),Ze=ne(()=>g("span",null,"\u9AD8\u7EA7\u67E5\u8BE2",-1)),$e={style:{float:"left"}},et={slot:"description"},tt=ne(()=>g("span",null,"\u6CA1\u6709\u4EFB\u4F55\u67E5\u8BE2\u6761\u4EF6",-1)),lt=ne(()=>g("div",null,"\u4FDD\u5B58\u7684\u67E5\u8BE2",-1)),ot=["title"],at={class:"icon-cancle"},nt={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function ut(f,u,_,e,I,le){const Y=d("divider"),Q=d("AppstoreTwoTone"),F=d("a-button"),z=d("a-button-group"),G=d("a-tooltip"),x=d("a-divider"),M=d("a-empty"),m=d("a-select-option"),N=d("a-select"),k=d("a-form-item"),q=d("a-col"),U=d("a-row"),L=d("a-tree-select"),T=d("online-super-query-val-component"),E=d("PlusOutlined"),H=d("MinusCircleOutlined"),P=d("a-space"),y=d("a-form"),J=d("close-circle-outlined"),Z=d("file-text-outlined"),$=d("a-tree"),V=d("Icon"),W=d("a-card"),w=d("BasicModal"),ee=d("a-input"),te=d("a-modal");return C(),re(de,null,[g("div",Ge,[e.superQueryFlag?(C(),B(G,{key:0,mouseLeaveDelay:.2},{title:a(()=>[He,o(Y,{type:"vertical",style:{"background-color":"#fff"}}),g("a",{onClick:u[0]||(u[0]=(...i)=>e.handleReset&&e.handleReset(...i))},"\u6E05\u7A7A")]),default:a(()=>[o(z,null,{default:a(()=>[o(F,{type:"primary",onClick:e.handleOpen},{default:a(()=>[o(Q,{spin:!0}),Ze]),_:1},8,["onClick"])]),_:1})]),_:1},8,["mouseLeaveDelay"])):(C(),B(F,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:e.handleOpen},{default:a(()=>[v(" \u9AD8\u7EA7\u67E5\u8BE2 ")]),_:1},8,["onClick"]))]),(C(),B(Ee,{to:"body"},[o(w,{title:"\u9AD8\u7EA7\u67E5\u8BE2\u6784\u9020\u5668",canFullscreen:!1,width:750,onRegister:e.registerFormModal,onOk:e.handleSubmit},{footer:a(()=>[g("div",$e,[o(F,{loading:e.loading,onClick:e.handleReset},{default:a(()=>[v("\u91CD\u7F6E")]),_:1},8,["loading","onClick"]),o(F,{loading:e.loading,onClick:e.handleSave},{default:a(()=>[v("\u4FDD\u5B58\u67E5\u8BE2")]),_:1},8,["loading","onClick"])]),o(F,{key:"submit",type:"primary",onClick:e.handleSubmit},{default:a(()=>[v("\u786E\u5B9A")]),_:1},8,["onClick"]),o(F,{key:"back",onClick:e.handleCancel},{default:a(()=>[v("\u5173\u95ED")]),_:1},8,["onClick"])]),default:a(()=>[e.dynamicRowValues.values.length==0?(C(),B(M,{key:0},{default:a(()=>[g("div",et,[tt,o(x,{type:"vertical"}),g("a",{onClick:u[1]||(u[1]=i=>e.addOne(-1))},"\u70B9\u51FB\u65B0\u589E")])]),_:1})):he("",!0),o(U,{class:ue("j-super-query-modal-content")},{default:a(()=>[o(q,{sm:24,md:24},{default:a(()=>[ie(o(U,null,{default:a(()=>[o(q,{md:12,xs:24},{default:a(()=>[o(k,{label:"\u5339\u914D\u6A21\u5F0F",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:a(()=>[o(N,{value:e.matchType,"onUpdate:value":u[2]||(u[2]=i=>e.matchType=i),getPopupContainer:i=>i.parentNode,style:{width:"100%"}},{default:a(()=>[o(m,{value:"and"},{default:a(()=>[v("AND\uFF08\u6240\u6709\u6761\u4EF6\u5339\u914D\uFF09")]),_:1}),o(m,{value:"or"},{default:a(()=>[v("OR\uFF08\u4EFB\u610F\u4E00\u4E2A\u5339\u914D\uFF09")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[se,e.dynamicRowValues.values.length>0]]),ie(o(y,{ref:"formRef",class:ue("jee-super-query-form"),model:e.dynamicRowValues,onFinish:e.onFinish},{default:a(()=>[(C(!0),re(de,null,ge(e.dynamicRowValues.values,(i,D)=>(C(),B(P,{key:i.key,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:a(()=>[o(k,{name:["values",D,"field"],style:{width:"150px"}},{default:a(()=>[o(L,{style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5",value:i.field,"onUpdate:value":s=>i.field=s,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},onChange:s=>e.handleChangeField(i),"tree-data":e.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),o(k,{name:["values",D,"rule"],style:{width:"100px"}},{default:a(()=>[o(N,{style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u5339\u914D\u89C4\u5219",value:i.rule,"onUpdate:value":s=>i.rule=s},{default:a(()=>[o(m,{value:"eq"},{default:a(()=>[v("\u7B49\u4E8E")]),_:1}),o(m,{value:"like"},{default:a(()=>[v("\u6A21\u7CCA")]),_:1}),o(m,{value:"right_like"},{default:a(()=>[v("\u4EE5..\u5F00\u59CB")]),_:1}),o(m,{value:"left_like"},{default:a(()=>[v("\u4EE5..\u7ED3\u5C3E")]),_:1}),o(m,{value:"in"},{default:a(()=>[v("\u5728...\u4E2D")]),_:1}),o(m,{value:"ne"},{default:a(()=>[v("\u4E0D\u7B49\u4E8E")]),_:1}),o(m,{value:"gt"},{default:a(()=>[v("\u5927\u4E8E")]),_:1}),o(m,{value:"ge"},{default:a(()=>[v("\u5927\u4E8E\u7B49\u4E8E")]),_:1}),o(m,{value:"lt"},{default:a(()=>[v("\u5C0F\u4E8E")]),_:1}),o(m,{value:"le"},{default:a(()=>[v("\u5C0F\u4E8E\u7B49\u4E8E")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),o(k,{name:["values",D,"val"],style:{width:"300px"}},{default:a(()=>[o(T,{style:{width:"100%"},schema:e.getSchema(i,D),formModel:i,setFormModel:(s,S)=>{e.setFormModel(s,S,i)},onSubmit:e.handleSubmit},null,8,["schema","formModel","setFormModel","onSubmit"])]),_:2},1032,["name"]),o(k,null,{default:a(()=>[o(F,{onClick:s=>e.addOne(D),style:{"margin-right":"6px"}},{default:a(()=>[o(E)]),_:2},1032,["onClick"]),o(F,{onClick:s=>e.removeOne(i)},{default:a(()=>[o(H)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["model","onFinish"]),[[se,e.dynamicRowValues.values.length>0]])]),_:1})]),_:1}),o(W,{class:ue(["j-super-query-history-card",{collapsed:e.historyCollapsed}]),bordered:!1},{title:a(()=>[lt]),default:a(()=>[e.saveTreeData.length===0?(C(),B(M,{key:0,class:"j-super-query-history-empty",image:e.simpleImage,description:"\u6CA1\u6709\u4FDD\u5B58\u7684\u67E5\u8BE2"},null,8,["image"])):(C(),B($,{key:1,class:"j-super-query-history-tree",treeData:e.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:e.handleTreeSelect},{title:a(({title:i})=>[g("div",null,[g("span",{title:i},Fe(i.length>10?i.substring(0,10)+"...":i),9,ot),g("span",at,[o(J,{onClick:D=>e.handleRemoveSaveInfo(i)},null,8,["onClick"])])])]),custom:a(()=>[o(Z)]),_:1},8,["treeData","onSelect"])),g("div",{class:"collapse-box",onClick:u[3]||(u[3]=i=>e.historyCollapsed=!e.historyCollapsed)},[e.historyCollapsed?(C(),B(V,{key:0,icon:"ant-design:caret-left"})):(C(),B(V,{key:1,icon:"ant-design:caret-right"}))])]),_:1},8,["class"])]),_:1},8,["onRegister","onOk"])])),o(te,{title:"\u8BF7\u8F93\u5165\u4FDD\u5B58\u7684\u540D\u79F0",visible:e.saveInfo.visible,onCancel:u[5]||(u[5]=i=>e.saveInfo.visible=!1),onOk:e.doSaveQueryInfo},{default:a(()=>[g("div",nt,[o(ee,{value:e.saveInfo.title,"onUpdate:value":u[4]||(u[4]=i=>e.saveInfo.title=i),style:{width:"90%"},placeholder:"\u8BF7\u8F93\u5165\u4FDD\u5B58\u7684\u540D\u79F0"},null,8,["value"])])]),_:1},8,["visible","onOk"])],64)}var sl=Oe(ze,[["render",ut],["__scopeId","data-v-31ffc821"]]);export{sl as default};
