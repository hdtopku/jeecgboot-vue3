var et=Object.defineProperty,at=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var I=(t,s,i)=>s in t?et(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,B=(t,s)=>{for(var i in s||(s={}))st.call(s,i)&&I(t,i,s[i]);if(R)for(var i of R(s))it.call(s,i)&&I(t,i,s[i]);return t},O=(t,s)=>at(t,ot(s));var N=(t,s,i)=>new Promise((m,g)=>{var v=e=>{try{n(i.next(e))}catch(r){g(r)}},y=e=>{try{n(i.throw(e))}catch(r){g(r)}},n=e=>e.done?m(e.value):Promise.resolve(e.value).then(v,y);n((i=i.apply(t,s)).next())});import{b as K,x as nt,C as q,bf as rt,s as lt,r as pt,B as ct,bg as mt}from"./jeecg-online-vendor-88d7be55.js";import{m as W,z as A}from"./index-b6e19f4a.js";import{T as dt}from"./componentMap-ac4d3a60.js";import{cd as F,ci as k,cR as ut,ce as L,cS as gt,cC as U,cx as yt}from"./antd-vue-vendor-cce59da1.js";import{d as X,k as P,e as M,u as S,w as ft,U as l,a5 as c,a9 as _,a7 as f,a6 as h,a8 as vt,F as V,am as J,an as _t,f as p,aa as z,E as ht,ab as E,V as C,g as bt,r as kt,o as Ct,ag as wt}from"./vue-705b7309.js";import Dt from"./DetailModal-85eee416.js";import{_ as Mt}from"./DynamicNotice.vue_vue_type_script_setup_true_name_dynamic-notice_lang-308586bc.js";import"./index-378f1f74.js";import{connectWebSocket as St,onWebSocket as Tt}from"./useWebSocket-30087267.js";import{r as jt}from"./mynews.api-82c24029.js";import Bt from"./SysMessageModal-ad4eaac0.js";import"./tinymce-vendor-6e169cb2.js";import"./lodash-es-vendor-5fc8fca4.js";import"./codemirror-vendor-3f45d0f3.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-60c6a8c7.js";import"./useFormItem-faf326fe.js";import"./JUpload.vue_vue_type_style_index_0_lang-72743f30.js";import"./BasicModal-93f24ffc.js";import"./useWindowSizeFn-b9945b41.js";import"./download-827e9970.js";import"./base64Conver-fa2fe1af.js";import"./index-99de6536.js";import"./index-a24a9872.js";import"./useCountdown-5da1361d.js";import"./JAddInput-079a6c33.js";import"./areaDataUtil-6588b720.js";import"./JSelectUser-b7290477.js";import"./props-4069293e.js";import"./JSelectBiz-53a9985e.js";import"./index-2ccd691b.js";import"./index-4eb07c8e.js";import"./bem-eb26b268.js";import"./props-dec3c169.js";import"./useContextMenu-430f82bc.js";import"./depart.api-880d8784.js";import"./JSelectDept-52bb52e5.js";import"./JPopup-4aed0a12.js";import"./index-4802827d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-ad90633d.js";import"./SysMessageList-8c2b3eee.js";import"./useSysMessage-3f37f841.js";var Y=(t=>(t.L="L",t.M="M",t.H="H",t))(Y||{});const Nt=[{key:"1",name:"通知",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"你收到了 14 份新周报",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"你推荐的 曲妮妮 已通过第三轮面试",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"这种模板可以区分多种通知类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"标题可以设置自动显示省略号，本例中标题行数已设为1行，如果内容超过1行将自动截断并支持tooltip显示完整标题。",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"系统消息",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"曲丽丽 评论了你",description:"描述信息描述信息描述信息",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"朱偏右 回复了你",description:"这种模板用于提醒谁与你发生了互动",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"标题",description:"请将鼠标移动到此处，以便测试超长的消息在此处将如何处理。本例中设置的描述最大行数为2，超过2行的描述内容将被省略并且可以通过tooltip查看完整内容",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}],zt=t=>K.get({url:"/sys/annountCement/listByUser",params:t}),H=(t,s)=>K.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:B({anntId:t},s)}),Pt=X({components:{[F.name]:F,[k.name]:k,[k.Item.name]:k.Item,AListItemMeta:k.Item.Meta,ATypographyParagraph:ut.Paragraph,[L.name]:L,Time:dt},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(t,{emit:s}){const{prefixCls:i}=W("header-notify-list"),m=P(t.currentPage||1),g=M(()=>{const{pageSize:e,list:r}=t;if(e===!1)return[];let d=nt(e)?e:5;return r.slice(d*(S(m)-1),d*S(m))});ft(()=>t.currentPage,e=>{m.value=e});const v=M(()=>!!t.onTitleClick),y=M(()=>{const{list:e,pageSize:r}=t;return r>0&&e&&e.length>r?{total:e.length,pageSize:r,current:S(m),onChange(d){m.value=d,s("update:currentPage",d)}}:!1});function n(e){t.onTitleClick&&t.onTitleClick(e)}return{prefixCls:i,getPagination:y,getData:g,handleTitleClick:n,isTitleClickable:v,PriorityTypes:Y}}});const Gt={class:"title"},$t={key:0,class:"extra"},Rt={key:2},It={key:0,class:"description"},Ot={class:"datetime"};function At(t,s,i,m,g,v){const y=l("a-typography-paragraph"),n=l("a-tag"),e=l("a-avatar"),r=l("Icon"),d=l("Time"),T=l("a-list-item-meta"),b=l("a-list-item"),w=l("a-list");return c(),_(w,{class:J(t.prefixCls),pagination:t.getPagination},{default:f(()=>[(c(!0),h(V,null,vt(t.getData,o=>(c(),_(b,{key:o.id,class:"list-item",onClick:G=>t.handleTitleClick(o),style:_t({cursor:t.isTitleClickable?"pointer":""})},{default:f(()=>[p(T,null,{title:f(()=>[z("div",Gt,[p(y,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!o.titleDelete,ellipsis:t.$props.titleRows&&t.$props.titleRows>0?{rows:t.$props.titleRows,tooltip:!!o.title}:!1,content:o.title},null,8,["delete","ellipsis","content"]),o.extra?(c(),h("div",$t,[p(n,{class:"tag",color:o.color},{default:f(()=>[ht(E(o.extra),1)]),_:2},1032,["color"])])):C("",!0)])]),avatar:f(()=>[o.avatar?(c(),_(e,{key:0,class:"avatar",src:o.avatar},null,8,["src"])):o.priority?(c(),h(V,{key:1},[o.priority===t.PriorityTypes.L?(c(),_(e,{key:0,class:"avatar priority-L",title:"一般消息"},{icon:f(()=>[p(r,{icon:"entypo:info"})]),_:1})):C("",!0),o.priority===t.PriorityTypes.M?(c(),_(e,{key:1,class:"avatar priority-M",title:"重要消息"},{icon:f(()=>[p(r,{icon:"bi:exclamation-lg"})]),_:1})):C("",!0),o.priority===t.PriorityTypes.H?(c(),_(e,{key:2,class:"avatar priority-H",title:"紧急消息"},{icon:f(()=>[p(r,{icon:"ant-design:warning-filled"})]),_:1})):C("",!0)],64)):(c(),h("span",Rt,E(o.avatar),1))]),description:f(()=>[z("div",null,[o.description?(c(),h("div",It,[p(y,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:t.$props.descRows&&t.$props.descRows>0?{rows:t.$props.descRows,tooltip:!!o.description}:!1,content:o.description},null,8,["ellipsis","content"])])):C("",!0),z("div",Ot,[p(d,{value:o.datetime,title:o.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const Ft=q(Pt,[["render",At],["__scopeId","data-v-f011ee3f"]]),Lt=X({components:{Popover:gt,BellOutlined:rt,Tabs:U,TabPane:U.TabPane,Badge:yt,NoticeList:Ft,DetailModal:Dt,DynamicNotice:Mt,SysMessageModal:Bt},setup(){const{prefixCls:t}=W("header-notify"),s=bt(),i=lt(),m=pt(),g=kt({path:"",formData:{}}),[v,y]=A(),n=P(Nt),e=M(()=>{let a=0;for(let u=0;u<n.value.length;u++)a+=n.value[u].count;return a}),[r,{openModal:d}]=A();function T(){for(let a=0;a<n.value.length;a++)n.value[a].count=0;d(!0,{})}const b=P(!1);Ct(()=>{Z()});function w(a){return O(B({},a),{title:a.titile,description:a.msgAbstract,datetime:a.sendTime})}function o(){return N(this,null,function*(){try{let{anntMsgList:a,sysMsgList:u,anntMsgTotal:D,sysMsgTotal:j}=yield zt({pageSize:5});n.value[0].list=a.map(w),n.value[1].list=u.map(w),n.value[0].count=D,n.value[1].count=j}catch(a){}})}o();function G(a){var u;try{H(a.id),o()}catch(D){}a.openType==="component"?(g.path=a.openPage,g.formData={id:a.busId},(u=s.refs.dynamicNoticeRef)==null||u.detail(a.openPage)):y.openModal(!0,{record:a,isUpdate:!0}),b.value=!1}function Z(){var $;let a=ct(),u=mt(a),D=S(i.getUserInfo).id+"_"+u,j=(($=m.domainUrl)==null?void 0:$.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+D;St(j),Tt(x)}function x(a){(a.cmd==="topic"||a.cmd==="user")&&setTimeout(()=>{o()},1e3)}function Q(){b.value=!1,jt({},o)}function tt(a){return N(this,null,function*(){try{yield H(a),yield o()}catch(u){}})}return{prefixCls:t,listData:n,count:e,clickBadge:T,registerMessageModal:r,reloadCount:tt,onNoticeClick:G,onEmptyNotify:Q,numberStyle:{},popoverVisible:b,registerDetail:v,dynamicNoticeProps:g}}});function Ut(t,s,i,m,g,v){const y=l("BellOutlined"),n=l("Badge"),e=l("DynamicNotice"),r=l("DetailModal"),d=l("sys-message-modal");return c(),h("div",{class:J(t.prefixCls)},[p(n,{count:t.count,overflowCount:9,offset:[-4,10],numberStyle:t.numberStyle,onClick:t.clickBadge},{default:f(()=>[p(y)]),_:1},8,["count","numberStyle","onClick"]),p(e,wt({ref:"dynamicNoticeRef"},t.dynamicNoticeProps),null,16),p(r,{onRegister:t.registerDetail},null,8,["onRegister"]),p(d,{onRegister:t.registerMessageModal,onRefresh:t.reloadCount},null,8,["onRegister","onRefresh"])],2)}const ze=q(Lt,[["render",Ut]]);export{ze as default};
