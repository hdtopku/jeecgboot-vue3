var Xt=Object.defineProperty,Yt=Object.defineProperties;var Zt=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var Jt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var rt=(e,t,o)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,O=(e,t)=>{for(var o in t||(t={}))Jt.call(t,o)&&rt(e,o,t[o]);if(it)for(var o of it(t))Qt.call(t,o)&&rt(e,o,t[o]);return e},he=(e,t)=>Yt(e,Zt(t));var re=(e,t,o)=>new Promise((c,s)=>{var a=u=>{try{i(o.next(u))}catch(l){s(l)}},r=u=>{try{i(o.throw(u))}catch(l){s(l)}},i=u=>u.done?c(u.value):Promise.resolve(u.value).then(a,r);i((o=o.apply(e,t)).next())});import{d as me,e as T,V as L,a5 as M,a6 as de,a9 as ee,R as De,E as ke,ab as se,f as q,a7 as W,am as ae,W as ne,F as We,k as j,w as $e,u as n,q as Ne,s as Re,n as ve,J as Fe,x as en,v as ct,A as tn,aa as ce,ag as Ee,b as vt,r as et,o as St,H as nn,a8 as on,c as ln,ar as sn}from"./vue-5a09445c.js";import{D as Se,q as Pe,aL as fe,y as Je,X as oe,Z as Oe,x as Ve,aK as an,b0 as rn,u as wt,$ as cn,b1 as un,W as dn,a8 as fn,b2 as ut,b3 as kt,b4 as gn}from"./jeecg-online-vendor-231813f7.js";import{aH as hn,m as Ke,aI as mn,p as J,o as _t,A as pn,C as dt,r as bn,d as Cn,q as yn,a7 as vn,t as Sn,aJ as wn,aK as kn,au as _n,Z as Be,i as Tn}from"./index-ebe32d90.js";import{B as Rn}from"./BasicForm-202637f7.js";import{P as Ue,b as In,A as xn,d as $n,u as Ie,R as ye,D as Fn,I as ze,e as qe,F as Tt,f as Pn,g as On,h as En,i as An}from"./componentMap-d4bccc5b.js";import{u as Dn}from"./useForm-b308f6ee.js";import"./JAddInput-b2310633.js";import"./JSelectUser-71a05f8d.js";import"./JSelectDept-1f595344.js";import"./JPopup-2fd87e0d.js";import"./cron-parser-vendor-f28c5d73.js";import"./index-156cafb7.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-b03a3f81.js";import{P as Ln}from"./injectionKey-69710956.js";import{bX as Rt,cQ as Kn,cR as Mn,bw as Hn,ct as Bn,cs as Nn,cn as zn,by as Ge,d7 as Vn,cl as jn,cI as It,c3 as Wn,bU as Un,b as qn,S as Ye,_ as Gn,bO as Xn,c as Le,d8 as tt,bb as Yn,G as ft,cw as Zn,bn as Ze,d9 as Jn,bA as xt,da as Qn,bG as eo,cj as gt,cr as to,cY as no,cZ as oo}from"./antd-vue-vendor-e4fda4cf.js";import"./BasicForm.vue_vue_type_style_index_0_lang-b507e110.js";import{s as lo,t as so}from"./lodash-es-vendor-3f622b6f.js";import{useWindowSizeFn as ao}from"./useWindowSizeFn-090d6233.js";import{u as io}from"./BasicModal-4736e0c2.js";const ro={key:0},co=me({__name:"CustomSelectHeader",props:{isRadio:{type:Boolean,required:!0},selectedLength:{type:Number,required:!0},pageSize:{type:Number,required:!0},disabled:{type:Boolean,required:!0}},emits:["select-all"],setup(e,{emit:t}){const o=e,c=T(()=>o.isRadio?!1:o.selectedLength>0&&o.selectedLength>=o.pageSize),s=T(()=>o.isRadio?!1:o.selectedLength>0&&o.selectedLength<o.pageSize);function a(r){t("select-all",r)}return(r,i)=>{const u=L("a-checkbox");return e.isRadio?(M(),de("span",ro)):(M(),ee(u,{key:1,disabled:e.disabled,checked:c.value,indeterminate:s.value,"onUpdate:checked":a},null,8,["disabled","checked","indeterminate"]))}}}),uo=me({name:"EditTableHeaderIcon",components:{FormOutlined:Rt},props:{title:{type:String,default:""}}});function fo(e,t,o,c,s,a){const r=L("FormOutlined");return M(),de("span",null,[De(e.$slots,"default"),ke(" "+se(e.title)+" ",1),q(r)])}const go=Se(uo,[["render",fo]]),ho=me({name:"TableHeaderCell",components:{EditTableHeaderCell:go,BasicHelp:hn},props:{column:{type:Object,default:()=>({})}},setup(e){const{prefixCls:t}=Ke("basic-table-header-cell"),o=T(()=>{var a;return!!((a=e.column)!=null&&a.edit)}),c=T(()=>{var a,r;return((a=e.column)==null?void 0:a.customTitle)||((r=e.column)==null?void 0:r.title)}),s=T(()=>{var a;return(a=e.column)==null?void 0:a.helpMessage});return{prefixCls:t,getIsEdit:o,getTitle:c,getHelpMessage:s}}});const mo={key:1};function po(e,t,o,c,s,a){const r=L("EditTableHeaderCell"),i=L("BasicHelp");return M(),de(We,null,[e.getIsEdit?(M(),ee(r,{key:0},{default:W(()=>[ke(se(e.getTitle),1)]),_:1})):(M(),de("span",mo,se(e.getTitle),1)),e.getHelpMessage?(M(),ee(i,{key:2,text:e.getHelpMessage,class:ae(`${e.prefixCls}__help`)},null,8,["text","class"])):ne("",!0)],64)}const bo=Se(ho,[["render",po]]);function Co({page:e,type:t,originalElement:o}){return t==="prev"?e===0?null:q(Kn,null,null):t==="next"?e===1?null:q(Mn,null,null):o}function yo(e){const{t}=Pe(),o=j({}),c=j(!0);$e(()=>n(e).pagination,l=>{!fe(l)&&l&&(o.value=O(O({},n(o)),l!=null?l:{}))});const s=T(()=>{const{pagination:l}=n(e);return!n(c)||fe(l)&&!l?!1:O(O({current:1,pageSize:Ue,size:"small",defaultPageSize:Ue,showTotal:y=>t("component.table.total",{total:y}),showSizeChanger:!0,pageSizeOptions:In,itemRender:Co,showQuickJumper:!0},fe(l)?{}:l),n(o))});function a(l){const y=n(s);o.value=O(O({},fe(y)?{}:y),l)}function r(){return n(s)}function i(){return n(c)}function u(l){return re(this,null,function*(){c.value=l})}return{getPagination:r,getPaginationInfo:s,setShowPagination:u,getShowPagination:i,setPagination:a}}const _e=new Map;_e.set("Input",Hn);_e.set("InputNumber",Bn);_e.set("Select",Nn);_e.set("ApiSelect",xn);_e.set("ApiTreeSelect",$n);_e.set("Switch",zn);_e.set("Checkbox",Ge);_e.set("DatePicker",Vn);_e.set("TimePicker",jn);const vo=({component:e="Input",rule:t=!0,ruleMessage:o,popoverVisible:c,getPopupContainer:s},{attrs:a})=>{const r=_e.get(e),i=Ne(r,a);return t?Ne(It,O({overlayClassName:"edit-cell-rule-popover",visible:!!c},s?{getPopupContainer:s}:{}),{default:()=>i,content:()=>o}):i},{t:Qe}=Pe();function ht(e){return e.includes("Input")?Qe("common.inputText"):e.includes("Picker")||e.includes("Select")||e.includes("Checkbox")||e.includes("Radio")||e.includes("Switch")||e.includes("DatePicker")||e.includes("TimePicker")?Qe("common.chooseText"):""}const So=me({name:"EditableCell",components:{FormOutlined:Rt,CloseOutlined:Wn,CheckOutlined:Un,CellComponent:vo,ASpin:qn},directives:{clickOutside:mn},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:J.number},setup(e){const t=Ie(),o=j(!1),c=j(),s=j(!1),a=j(""),r=j([]),i=j(e.value),u=j(e.value),l=j(!1),{prefixCls:y}=Ke("editable-cell"),h=T(()=>{var f;return((f=e.column)==null?void 0:f.editComponent)||"Input"}),m=T(()=>{var f;return(f=e.column)==null?void 0:f.editRule}),v=T(()=>n(a)&&n(s)),x=T(()=>{const f=n(h);return["Checkbox","Switch"].includes(f)}),_=T(()=>{var D,z;const f=(z=(D=e.column)==null?void 0:D.editComponentProps)!=null?z:{},$=n(h),k={};$==="ApiSelect"&&(k.cache=!0);const F=n(x),g=F?"checked":"value",S=n(i),E=F?Je(S)&&fe(S)?S:!!S:S;return he(O(O({size:"small",getPopupContainer:()=>{var U;return(U=n(t==null?void 0:t.wrapRef.value))!=null?U:document.body},getCalendarContainer:()=>{var U;return(U=n(t==null?void 0:t.wrapRef.value))!=null?U:document.body},placeholder:ht(n(h))},k),Ye(f,"onChange")),{[g]:E})}),p=T(()=>{var E,D;const{editComponentProps:f,editValueMap:$}=e.column,k=n(i);if($&&oe($))return $(k);if(!n(h).includes("Select"))return k;const S=((E=f==null?void 0:f.options)!=null?E:n(r)||[]).find(z=>`${z.value}`==`${k}`);return(D=S==null?void 0:S.label)!=null?D:k}),b=T(()=>n(x)||n(P)?{}:{width:"calc(100% - 48px)"}),w=T(()=>{const{align:f="center"}=e.column;return`edit-cell-align-${f}`}),P=T(()=>{const{editable:f}=e.record||{};return!!f});Re(()=>{u.value=e.value,i.value=e.value}),Re(()=>{const{editable:f}=e.column;(fe(f)||fe(n(P)))&&(o.value=!!f||n(P))});function B(){var f;n(P)||n((f=e.column)==null?void 0:f.editRow)||(a.value="",o.value=!0,ve(()=>{var k;const $=n(c);(k=$==null?void 0:$.focus)==null||k.call($)}))}function Y($){return re(this,arguments,function*(f){var g,S,E;const k=n(h);f?f!=null&&f.target&&Reflect.has(f.target,"value")?i.value=f.target.value:k==="Checkbox"?i.value=f.target.checked:(Ve(f)||fe(f)||Je(f)||Oe(f))&&(i.value=f):i.value=f;const F=(S=(g=e.column)==null?void 0:g.editComponentProps)==null?void 0:S.onChange;F&&oe(F)&&F(...arguments),(E=t.emit)==null||E.call(t,"edit-change",{column:e.column,value:n(i),record:Fe(e.record)}),Z()})}function Z(){return re(this,null,function*(){const{column:f,record:$}=e,{editRule:k}=f,F=n(i);if(k){if(fe(k)&&!F&&!Je(F)){s.value=!0;const g=n(h);return a.value=ht(g),!1}if(oe(k)){const g=yield k(F,$);return g?(a.value=g,s.value=!0,!1):(a.value="",!0)}}return a.value="",!0})}function N(f=!0,$=!0){return re(this,null,function*(){var U;if($&&!(yield Z()))return!1;const{column:k,index:F,record:g}=e;if(!g)return!1;const{key:S,dataIndex:E}=k,D=n(i);if(!S||!E)return;const z=E||S;if(!g.editable){const{getBindValues:pe}=t,{beforeEditSubmit:Ce,columns:ge}=n(pe);if(Ce&&oe(Ce)){l.value=!0;const we=ge.map(I=>I.dataIndex).filter(I=>!!I);let d=!0;try{d=yield Ce({record:Gn(g,we),index:F,key:S,value:D})}catch(I){d=!1}finally{l.value=!1}if(d===!1)return}}lo(g,z,D),f&&((U=t.emit)==null||U.call(t,"edit-end",{record:g,index:F,key:S,value:D})),o.value=!1})}function ue(){return re(this,null,function*(){var f;(f=e.column)!=null&&f.editRow||N()})}function ie(){N()}function C(){var S;o.value=!1,i.value=u.value;const{column:f,index:$,record:k}=e,{key:F,dataIndex:g}=f;(S=t.emit)==null||S.call(t,"edit-cancel",{record:k,index:$,key:g||F,value:n(i)})}function R(){var $;if(($=e.column)!=null&&$.editable||n(P))return;n(h).includes("Input")&&C()}function H(f){var F,g;const{replaceFields:$}=(g=(F=e.column)==null?void 0:F.editComponentProps)!=null?g:{};if(n(h)==="ApiTreeSelect"){const{title:S="title",value:E="value",children:D="children"}=$||{};let z=an(f,{children:D});z=z.map(U=>({label:U[S],value:U[E]})),r.value=z}else r.value=f}function G(f,$){var k;e.record&&(Oe(e.record[f])?(k=e.record[f])==null||k.push($):e.record[f]=[$])}return e.record&&(G("submitCbs",N),G("validCbs",Z),G("cancelCbs",C),e.column.dataIndex&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.dataIndex]=i),e.record.onCancelEdit=()=>{var f,$;Oe((f=e.record)==null?void 0:f.cancelCbs)&&(($=e.record)==null||$.cancelCbs.forEach(k=>k()))},e.record.onSubmitEdit=()=>re(this,null,function*(){var f,$,k,F,g;if(Oe((f=e.record)==null?void 0:f.submitCbs))return(k=($=e.record)==null?void 0:$.onValid)!=null&&k.call($)?((((F=e.record)==null?void 0:F.submitCbs)||[]).forEach(E=>E(!1,!1)),(g=t.emit)==null||g.call(t,"edit-row-end"),!0):void 0})),{isEdit:o,prefixCls:y,handleEdit:B,currentValueRef:i,handleSubmit:N,handleChange:Y,handleCancel:C,elRef:c,getComponent:h,getRule:m,onClickOutside:R,ruleMessage:a,getRuleVisible:v,getComponentProps:_,handleOptionsChange:H,getWrapperStyle:b,getWrapperClass:w,getRowEditable:P,getValues:p,handleEnter:ue,handleSubmitClick:ie,spinning:l}}});const wo=["title"];function ko(e,t,o,c,s,a){var m;const r=L("FormOutlined"),i=L("CellComponent"),u=L("CheckOutlined"),l=L("CloseOutlined"),y=L("a-spin"),h=en("click-outside");return M(),de("div",{class:ae(e.prefixCls)},[ct(ce("div",{class:ae({[`${e.prefixCls}__normal`]:!0,"ellipsis-cell":e.column.ellipsis}),onClick:t[0]||(t[0]=(...v)=>e.handleEdit&&e.handleEdit(...v))},[ce("div",{class:"cell-content",title:e.column.ellipsis&&(m=e.getValues)!=null?m:""},se(e.getValues?e.getValues:" "),9,wo),e.column.editRow?ne("",!0):(M(),ee(r,{key:0,class:ae(`${e.prefixCls}__normal-icon`)},null,8,["class"]))],2),[[tn,!e.isEdit]]),e.isEdit?(M(),ee(y,{key:0,spinning:e.spinning},{default:W(()=>[ct((M(),de("div",{class:ae(`${e.prefixCls}__wrapper`)},[q(i,Ee(e.getComponentProps,{component:e.getComponent,style:e.getWrapperStyle,popoverVisible:e.getRuleVisible,rule:e.getRule,ruleMessage:e.ruleMessage,class:e.getWrapperClass,ref:"elRef",onChange:e.handleChange,onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","style","popoverVisible","rule","ruleMessage","class","onChange","onOptionsChange","onPressEnter"]),e.getRowEditable?ne("",!0):(M(),de("div",{key:0,class:ae(`${e.prefixCls}__action`)},[q(u,{class:ae([`${e.prefixCls}__icon`,"mx-2"]),onClick:e.handleSubmitClick},null,8,["class","onClick"]),q(l,{class:ae(`${e.prefixCls}__icon `),onClick:e.handleCancel},null,8,["class","onClick"])],2))],2)),[[h,e.onClickOutside]])]),_:1},8,["spinning"])):ne("",!0)],2)}const _o=Se(So,[["render",ko]]);function To(e){return({text:t,record:o,index:c})=>(o.onValid=()=>re(this,null,function*(){if(Oe(o==null?void 0:o.validCbs)){const s=((o==null?void 0:o.validCbs)||[]).map(r=>r());return(yield Promise.all(s)).every(r=>!!r)}else return!1}),o.onEdit=(s,a=!1)=>re(this,null,function*(){var r,i;return a||(o.editable=s),!s&&a?(yield o.onValid())&&(yield(r=o.onSubmitEdit)==null?void 0:r.call(o))?(o.editable=!1,!0):!1:(!s&&!a&&((i=o.onCancelEdit)==null||i.call(o)),!0)}),Ne(_o,{value:t,record:o,column:e,index:c}))}const Xe="j-custom-selected-column";function Ro(e,t,o,c,s,a){const{createConfirm:r}=wt(),i=j(),u=j(0),l=j(0),y=j(0),h=j([]),m=j([]),v=T(()=>{const d=$t(s.value,a.value),I=e.value.rowSelection;if((I==null?void 0:I.type)==="checkbox"&&I.getCheckboxProps)for(let V=0,A=d.length;V<A;V++){const K=d[V];I.getCheckboxProps(K).disabled&&(d.splice(V,1),V--,A--)}return d}),x=T(()=>{const{rowSelection:d}=n(e);return d?O({preserveSelectedRowKeys:!0},Ye(d,["onChange","selectedRowKeys"])):null}),_=T(()=>{var d;return((d=x.value)==null?void 0:d.type)==="radio"}),p=T(()=>n(e).autoCreateKey&&!n(e).rowKey),b=T(()=>{const{rowKey:d}=n(e);return n(p)?ye:d}),w=d=>b.value?oe(b.value)?b.value(d):d[b.value]:d[ye],P=T(()=>typeof c.value=="boolean"?{}:c.value),B=T(()=>{const{pageSize:d=10,total:I=v.value.length}=P.value;return d>I?I:d}),Y=T(()=>({onSelectAll:ue,isRadio:_.value,selectedLength:v.value.filter(d=>h.value.includes(w(d))).length,pageSize:B.value,disabled:v.value.length==0}));$e(()=>{var d,I;return(I=(d=n(e))==null?void 0:d.rowSelection)==null?void 0:I.selectedRowKeys},d=>{Array.isArray(d)&&D(d)},{immediate:!0}),$e([h,m],()=>{ve(()=>{E()})});const Z=so(d=>{var I;return y.value=(I=d==null?void 0:d.target)==null?void 0:I.scrollTop},150);let N=null;Re(()=>{var d;if(i.value){N=new ResizeObserver(V=>{for(let A of V)if(A.target===i.value&&A.contentRect){const{height:K}=A.contentRect;u.value=Math.ceil(K)}}),N.observe(i.value);const I=(d=i.value)==null?void 0:d.querySelector("tbody.ant-table-tbody tr.ant-table-row");if(I){l.value=I.offsetHeight;return}}l.value=50,e.value.size}),_t(()=>re(this,null,function*(){i.value=yield Io(o.value),i.value.addEventListener("scroll",Z)})),vt(()=>{var d;i.value&&((d=i.value)==null||d.removeEventListener("scroll",Z)),N!=null&&N.disconnect()});function ue(d){if(!d){h.value=[],m.value=[],H();return}let I=null;const V=()=>{I!=null&&I.update({content:"正在分批全选，请稍后……",cancelButtonProps:{disabled:!0}});let A=0,K=100;const te=[];if(v.value.forEach((le,be,Ae)=>{Ae.length>120?A<=K&&f(be,Math.max((K-10)/2,3))?(A++,R(le,d)):te.push(le):R(le,d)}),te.length>0)return ie(te,d,K);H()};v.value.length>120?I=r({title:"全选",content:"当前数据量较大，全选可能会导致页面卡顿，确定要执行此操作吗？",iconType:"warning",onOk:()=>V()}):V()}function ie(d,I,V){return new Promise(A=>{(function K(){setTimeout(()=>{const te=d.splice(0,V);te.length>0?(te.forEach(le=>{R(le,I)}),K()):setTimeout(()=>{H(),setTimeout(()=>A(),0)},500)},300)})()})}function C(d,I){R(d,I),H()}function R(d,I){const V=w(d);if(_.value){h.value=[V],m.value=[d];return}const A=h.value.findIndex(K=>K===V);I?A===-1&&(h.value.push(V),m.value.push(d)):A!==-1&&(h.value.splice(A,1),m.value.splice(A,1))}function H(){const{rowSelection:d}=n(e);if(d){const{onChange:I}=d;I&&oe(I)&&setTimeout(()=>{I(h.value,m.value)},0)}t("selection-change",{keys:pe(),rows:U()})}function G(d){return d.key===Xe}function f(d,I=3){if(v.value.length>50){const A=y.value-l.value*I<d*l.value,K=d*l.value<y.value+u.value+l.value*I;return A&&K}return!0}function $(d){const{index:I}=d;return e.value.canResize&&!f(I)?"":_.value?F(d):k(d)}function k({record:d}){var A;const I=w(d),V=(K=>{var te;if(typeof K=="function")try{return(te=K(d))!=null?te:{}}catch(le){}return{}})((A=e.value.rowSelection)==null?void 0:A.getCheckboxProps);return q(Ge,Ee(V,{key:"j-select__"+I,checked:h.value.includes(I),"onUpdate:checked":K=>C(d,K)}),null)}function F({record:d}){const I=w(d),V=(()=>{const A=e.value.rowSelection;return A!=null&&A.getCheckboxProps?A.getCheckboxProps(d):{}})();return q(Xn,Ee(V,{key:"j-select__"+I,checked:h.value.includes(I),"onUpdate:checked":A=>C(d,A)}),null)}function g(d){const I=e.value.rowSelection;if(!I)return;const V=I.fixed||d.some(A=>A.fixed==="left");d.unshift(he(O({title:"选择列",flag:"CHECKBOX",key:Xe,width:50,minWidth:50,maxWidth:50,align:"center"},V?{fixed:"left"}:{}),{customRender:$}))}function S(){ue(!1)}function E(){h.value.length!==m.value.length&&D(h.value)}function D(d){var K;const I=h.value===d;h.value=d;const V=rn(Fe(n(v)).concat(Fe(n(m))),te=>d.includes(w(te)),{children:(K=e.value.childrenColumnName)!=null?K:"children"}),A=[];d.forEach(te=>{const le=V.find(be=>w(be)===te);le&&A.push(le)}),I&&z(m.value,A)||(m.value=A,H())}function z(d,I){let V=[],A=[];if(d.length===I.length){V=d.map(K=>w(K)),A=I.map(K=>w(K));for(let K=0,te=V.length;K<te;K++)if(!A.find(be=>be===V[K]))return!1;return!0}return!1}function U(){return n(m)}function pe(){return n(h)}function Ce(){return n(x)}function ge(d){const I=h.value.findIndex(V=>V===d);I!==-1&&(h.value.splice(I,1),m.value.splice(I,1))}const we=T(()=>{const{expandIconColumnIndex:d}=n(e);return x.value==null?d:d==null?1:d});return{getRowSelection:Ce,getRowSelectionRef:x,getSelectRows:U,getSelectRowKeys:pe,setSelectedRowKeys:D,deleteSelectRowByKey:ge,selectHeaderProps:Y,isCustomSelection:G,handleCustomSelectColumn:g,clearSelectedRowKeys:S,getExpandIconColumnIndex:we}}function Io(e){return new Promise(t=>{(function o(){const c=e.querySelector(".ant-table-wrapper .ant-table-body");c?t(c):setTimeout(o,100)})()})}function $t(e,t){let o=[];return(e||[]).forEach(c=>{o.push(c),c&&typeof c=="object"&&t in c&&(o=[...o,...$t(c[t],t)])}),o}function Ft(e,t){const{key:o,dataIndex:c,children:s}=e;e.align=e.align||Fn,t&&(o||(e.key=c),fe(e.ellipsis)||Object.assign(e,{ellipsis:t})),s&&s.length&&Pt(s,!!t)}function Pt(e,t){e&&e.forEach(o=>{const{children:c}=o;Ft(o,t),Pt(c,t)})}function xo(e,t,o){const{t:c}=Pe(),{showIndexColumn:s,indexColumnProps:a,isTreeTable:r}=n(e);let i=!1;if(n(r)||(o.forEach(()=>{const l=o.findIndex(y=>y.flag===ze);s?i=l===-1:!s&&l!==-1&&o.splice(l,1)}),!i))return;const u=o.some(l=>l.fixed==="left");o.unshift(O(O({flag:ze,width:50,title:c("component.table.index"),align:"center",customRender:({index:l})=>{const y=n(t);if(fe(y))return`${l+1}`;const{current:h=1,pageSize:m=Ue}=y;return((h<1?1:h)-1)*m+l+1}},u?{fixed:"left"}:{}),a))}function $o(e,t){const{actionColumn:o,showActionColumn:c}=n(e);if(!o||!c)return;const s=t.findIndex(a=>a.flag===qe);s===-1&&t.push(he(O(O({},t[s]),o),{flag:qe}))}function Fo(e,t,o){const c=j(n(e).columns);let s=n(e).columns;const a=T(()=>{const v=Le(n(c));if(xo(e,t,v),$o(e,v),o(v),!v)return[];const{ellipsis:x}=n(e);return v.forEach(_=>{const{customRender:p,slots:b}=_;Ft(_,Reflect.has(_,"ellipsis")?!!_.ellipsis:!!x&&!p&&!b)}),v});function r(v){const x=v.ifShow;let _=!0;return fe(x)&&(_=x),oe(x)&&(_=x(v)),_}const{hasPermission:i}=pn(),u=T(()=>{const v=mt(n(a)),_=Le(v).filter(p=>i(p.auth)&&r(p)).map(p=>{var ie;(ie=p.slots)!=null&&ie.customRender&&(p.slotsBak=p.slots,delete p.slots);const{slots:b,customRender:w,format:P,edit:B,editRow:Y,flag:Z,title:N}=p;(!b||!(b!=null&&b.title))&&(p.customTitle=p.title,Reflect.deleteProperty(p,"title")),p.children&&(p.title=N);const ue=[ze,qe].includes(Z);return!w&&P&&!B&&!ue&&(p.customRender=({text:C,record:R,index:H})=>Po(C,P,R,H)),(B||Y)&&!ue&&(p.customRender=To(p)),et(p)});if(e.value.expandedRowKeys){let p=0;const b=_.findIndex(B=>B.key===Xe);b!=-1&&(p=b+1);const w=_[p+1];let P=tt.EXPAND_COLUMN;w&&(w.fixed==!0||w.fixed=="left")&&(P=Object.assign(P,{fixed:"left"})),_.splice(p,0,P)}return _});$e(()=>n(e).columns,v=>{var x;c.value=v,s=(x=v==null?void 0:v.filter(_=>!_.flag))!=null?x:[]});function l(v,x){!v||!x||s.forEach(_=>{if(_.dataIndex===v){Object.assign(_,x);return}})}function y(v){const x=Le(v);if(!Oe(x))return;if(x.length<=0){c.value=[];return}const _=x[0],p=s.map(b=>b.dataIndex);if(!Ve(_)&&!Oe(_))c.value=x;else{const b=x.map(P=>P.toString()),w=[];s.forEach(P=>{var B;w.push(he(O({},P),{defaultHidden:!b.includes(((B=P.dataIndex)==null?void 0:B.toString())||P.key)}))}),Yn(p,x)||w.sort((P,B)=>{var Y,Z;return b.indexOf((Y=P.dataIndex)==null?void 0:Y.toString())-b.indexOf((Z=B.dataIndex)==null?void 0:Z.toString())}),c.value=w}}function h(v){const{ignoreIndex:x,ignoreAction:_,sort:p}=v||{};let b=Fe(n(a));return x&&(b=b.filter(w=>w.flag!==ze)),_&&(b=b.filter(w=>w.flag!==qe)),b=b.filter(w=>w.key!==Xe),p&&(b=mt(b)),b}function m(){return s}return{getColumnsRef:a,getCacheColumns:m,getColumns:h,setColumns:y,getViewColumns:u,setCacheColumnsByField:l}}function mt(e){const t=[],o=[],c=[];for(const s of e){if(s.fixed==="left"){t.push(s);continue}if(s.fixed==="right"){o.push(s);continue}c.push(s)}return[...t,...c,...o].filter(s=>!s.defaultHidden)}function Po(e,t,o,c){if(!t)return e;if(oe(t))return t(e,o,c);try{const s="date|";if(Ve(t)&&t.startsWith(s)){const a=t.replace(s,"");return a?cn(e,a):e}if(un(t))return t.get(e)}catch(s){return e}}function Oo(e,{getPaginationInfo:t,setPagination:o,setLoading:c,validate:s,clearSelectedRowKeys:a,tableData:r},i){const u=et({sortInfo:{},filterInfo:{}}),l=j([]),y=j({});Re(()=>{r.value=n(l)}),$e(()=>n(e).dataSource,()=>{const{dataSource:C,api:R}=n(e);!R&&C&&(l.value=C)},{immediate:!0});function h(C,R,H){const{clearSelectOnPageChange:G,sortFn:f,filterFn:$}=n(e);G&&a(),o(C);const k={};if(H&&oe(f)){const F=f(H);u.sortInfo=F,k.sortInfo=F}if(R&&oe($)){const F=$(R);u.filterInfo=F,k.filterInfo=F}Y(k)}function m(C){!C||!Array.isArray(C)||C.forEach(R=>{R[ye]||(R[ye]=dt()),R.children&&R.children.length&&m(R.children)})}const v=T(()=>n(e).autoCreateKey&&!n(e).rowKey),x=T(()=>{const{rowKey:C}=n(e);return n(v)?ye:C}),_=T(()=>{const C=n(l);if(!C||C.length===0)return n(l);if(n(v)){const R=C[0],H=C[C.length-1];if(R&&H&&(!R[ye]||!H[ye])){const G=Le(n(l));G.forEach(f=>{f[ye]||(f[ye]=dt()),f.children&&f.children.length&&m(f.children)}),l.value=G}}return n(l)});function p(C,R,H){return re(this,null,function*(){return l.value[C]&&(l.value[C][R]=H),l.value[C]})}function b(C,R){const H=B(C);if(H){for(const G in H)Reflect.has(R,G)&&(H[G]=R[G]);return H}}function w(C){var G,f,$;if(!l.value||l.value.length==0)return;const R=n(x);if(!R)return;const H=Array.isArray(C)?C:[C];for(const k of H){let F=l.value.findIndex(g=>{let S;return typeof R=="function"?S=R(g):S=R,g[S]===k});F>=0&&l.value.splice(F,1),F=(G=n(e).dataSource)==null?void 0:G.findIndex(g=>{let S;return typeof R=="function"?S=R(g):S=R,g[S]===k}),typeof F!="undefined"&&F!==-1&&((f=n(e).dataSource)==null||f.splice(F,1))}o({total:($=n(e).dataSource)==null?void 0:$.length})}function P(C,R){var H;return R=R!=null?R:(H=l.value)==null?void 0:H.length,n(l).splice(R,0,C),n(l)}function B(C){if(!l.value||l.value.length==0)return;const R=n(x);if(!R)return;const{childrenColumnName:H="children"}=n(e);return(f=>{let $;return f.some(function k(F){if(typeof R=="function"){if(R(F)===C)return $=F,!0}else if(Reflect.has(F,R)&&F[R]===C)return $=F,!0;return F[H]&&F[H].some(k)}),$})(l.value)}function Y(C){return re(this,null,function*(){var S,E,D;const{api:R,searchInfo:H,defSort:G,fetchSetting:f,beforeFetch:$,afterFetch:k,useSearchForm:F,pagination:g}=n(e);if(!(!R||!oe(R)))try{c(!0);const{pageField:z,sizeField:U,listField:pe,totalField:Ce}=Object.assign({},Tt,f);let ge={};const{current:we=1,pageSize:d=Ue}=n(t);fe(g)&&!g||fe(t)?ge={}:(ge[z]=C&&C.page||we,ge[U]=d);const{sortInfo:I={},filterInfo:V}=u;let A=O(O(O(O(O(O(O(O(O({},ge),F?yield s():{}),H),G),(S=C==null?void 0:C.searchInfo)!=null?S:{}),I),V),(E=C==null?void 0:C.sortInfo)!=null?E:{}),(D=C==null?void 0:C.filterInfo)!=null?D:{});$&&oe($)&&(A=(yield $(A))||A);const K=yield R(A);y.value=K;const te=Array.isArray(K);let le=te?K:ft(K,pe);const be=te?0:ft(K,Ce);if(be){const Ae=Math.ceil(Number(be)/d);if(we>Ae)return o({current:Ae}),yield Y(C)}return k&&oe(k)&&(le=(yield k(le))||le),l.value=le,o({total:Number(be)||0}),C&&C.page&&o({current:C.page||1}),i("fetch-success",{items:n(le),total:Number(be)}),le}catch(z){i("fetch-error",z),l.value=[],o({total:0})}finally{c(!1)}})}function Z(C){l.value=C}function N(){return _.value}function ue(){return y.value}function ie(C){return re(this,null,function*(){return yield Y(C)})}return St(()=>{bn(()=>{n(e).immediate&&Y()},16)}),{getDataSourceRef:_,getDataSource:N,getRawDataSource:ue,getRowKey:x,setTableData:Z,getAutoCreateKey:v,fetch:Y,reload:ie,updateTableData:p,updateTableDataRecord:b,deleteTableDataRecord:w,insertTableDataRecord:P,findTableDataRecord:B,handleTableChange:h}}function Eo(e){const t=j(n(e).loading);$e(()=>n(e).loading,s=>{t.value=s});const o=T(()=>n(t));function c(s){t.value=s}return{getLoading:o,setLoading:c}}function Ao(e,t,o,c,s){const a=j(null),r=io(),i=Cn(l,100),u=T(()=>{const{canResize:b,scroll:w}=n(e);return b&&!(w||{}).y});$e(()=>{var b;return[n(u),(b=n(s))==null?void 0:b.length]},()=>{i()},{flush:"post"});function l(){ve(()=>{x()})}function y(b){var w;a.value=b,(w=r==null?void 0:r.redoModalHeight)==null||w.call(r)}let h,m,v;function x(){return re(this,null,function*(){var F,g;const{resizeHeightOffset:b,pagination:w,maxHeight:P,minHeight:B}=n(e),Y=n(s),Z=n(t);if(!Z)return;const N=Z.$el;if(!N||!v&&(v=N.querySelector(".ant-table-tbody"),!v))return;const ue=v.scrollHeight>v.clientHeight,ie=v.scrollWidth>v.clientWidth;if(ue?N.classList.contains("hide-scrollbar-y")&&N.classList.remove("hide-scrollbar-y"):!N.classList.contains("hide-scrollbar-y")&&N.classList.add("hide-scrollbar-y"),ie?N.classList.contains("hide-scrollbar-x")&&N.classList.remove("hide-scrollbar-x"):!N.classList.contains("hide-scrollbar-x")&&N.classList.add("hide-scrollbar-x"),v.style.height="unset",!n(u)||!Y||Y.length===0)return;yield ve();const C=N.querySelector(".ant-table-thead");if(!C)return;const{bottomIncludeBody:R}=yn(C),H=32;let G=2;if(fe(w))G=-8;else if(h=N.querySelector(".ant-pagination"),h){const S=h.offsetHeight;G+=S||0}else G+=24;let f=0;if(!fe(w))if(!m)m=N.querySelector(".ant-table-footer");else{const S=m.offsetHeight;f+=S||0}let $=0;C&&($=C.offsetHeight);let k=R-(b||0)-H-G-f-$;k=(F=k<B?B:k)!=null?F:k,k=(g=k>P?P:k)!=null?g:k,y(k),v.style.height=`${k}px`})}ao(x,280),_t(()=>{x(),ve(()=>{i()})});const _=T(()=>{var ie,C;let b=0;const{maxColumnWidth:w}=n(e),P=w!=null?w:150,B=n(o).filter(R=>!R.defaultHidden);B.forEach(R=>{b+=Number.parseInt(R.width)||0});const Z=B.filter(R=>!Reflect.has(R,"width")).length;Z!==0&&(b+=Z*P);const N=n(t);return((C=(ie=N==null?void 0:N.$el)==null?void 0:ie.offsetWidth)!=null?C:0)>b?"100%":b});return{getScrollRef:T(()=>{const b=n(a),{canResize:w,scroll:P}=n(e);return O({x:n(_),y:w?b:null,scrollToFirstRowOnChange:!1},P)}),redoHeight:l}}function Do(e,t,o){return!t||o?e[ye]:Ve(t)?e[t]:oe(t)?e[t(e)]:null}function Lo(e,{setSelectedRowKeys:t,getSelectRowKeys:o,getAutoCreateKey:c,clearSelectedRowKeys:s,emit:a}){return{customRow:(i,u)=>({onClick:l=>{l==null||l.stopPropagation();function y(){var w;const{rowSelection:h,rowKey:m,clickToRowSelect:v}=n(e);if(!h||!v)return;const x=o(),_=Do(i,m,n(c));if(!_)return;if(h.type==="checkbox"){const P=(w=l.composedPath)==null?void 0:w.call(l).find(Z=>Z.tagName==="TR");if(!P)return;const B=P.querySelector("input[type=checkbox]");if(!B||B.hasAttribute("disabled"))return;if(!x.includes(_)){t([...x,_]);return}const Y=x.findIndex(Z=>Z===_);x.splice(Y,1),t(x);return}if(h.type==="radio"){const P=e.value.rowSelection;if(P.getCheckboxProps&&P.getCheckboxProps(i).disabled)return;if(!x.includes(_)){x.length&&s(),t([_]);return}s()}}y(),a("row-click",i,u,l)},onDblclick:l=>{a("row-dbClick",i,u,l)},onContextmenu:l=>{a("row-contextmenu",i,u,l)},onMouseenter:l=>{a("row-mouseenter",i,u,l)},onMouseleave:l=>{a("row-mouseleave",i,u,l)}})}}function Ko(e,t){function o(c,s){const{striped:a,rowClassName:r}=n(e),i=[];return a&&i.push((s||0)%2===1?`${t}-row__striped`:""),r&&oe(r)&&i.push(r(c,s)),i.filter(u=>!!u).join(" ")}return{getRowClassName:o}}function Mo(e,t,o){let c=!1;const s=Ie(),a=dn(),{createMessage:r}=wt(),i=T(()=>{var w;let{fullPath:_}=fn.currentRoute.value,p=_.replace(/[\/\\]/g,"_"),b=(w=s.getBindValues.value.tableSetting)==null?void 0:w.cacheKey;return b&&(p+=":"+b),"columnCache:"+p});Re(()=>{s.getColumns().length&&u()});function u(){return re(this,null,function*(){if(c)return;c=!0;let _=a.get(i.value);if(_&&_.checkedList){const{checkedList:p,sortedList:b,sortableOrder:w,checkIndex:P}=_;yield ve(),e.sortableOrder.value=w,e.state.checkedList=p,e.plainSortOptions.value.sort((B,Y)=>b.indexOf(B.value)-b.indexOf(Y.value)),p.sort((B,Y)=>b.indexOf(B)-b.indexOf(Y)),P&&s.setProps({showIndexColumn:!0}),t(p),l(_)}})}function l(_){return re(this,null,function*(){const{fixedColumns:p}=_,b=e.plainOptions.value;for(const w of b){let P=p.find(B=>B.key===(w.key||w.dataIndex));P&&(yield ve(),o(w,P.fixed))}})}const y=/^(true|left|right)$/;function h(){var b;let _=[];const p=e.plainOptions.value;for(const w of p)y.test(((b=w.fixed)!=null?b:"").toString())&&_.push({key:w.key||w.dataIndex,fixed:w.fixed===!0?"left":w.fixed});return _}function m(){const{checkedList:_}=e.state,p=n(e.plainSortOptions).map(b=>b.value);a.set(i.value,{checkedList:_,sortedList:p,checkIndex:n(e.checkIndex),sortableOrder:n(e.sortableOrder),fixedColumns:h()}),r.success("保存成功"),e.popoverVisible.value=!1}function v(){return re(this,null,function*(){yield x(),a.remove(i.value),r.success("重置成功")})}function x(){return re(this,null,function*(){var p;const _=e.plainOptions.value;for(const b of _)b.fixed,y.test(((p=b.fixed)!=null?p:"").toString())&&(yield ve(),o(b,null))})}return{saveSetting:m,resetSetting:v}}const Ho=me({name:"ColumnSetting",props:{isMobile:Boolean},components:{SettingOutlined:Zn,Popover:It,Tooltip:Ze,Checkbox:Ge,CheckboxGroup:Ge.Group,DragOutlined:Jn,ScrollContainer:vn,Divider:xt,Icon:Sn},emits:["columns-change"],setup(e,{emit:t,attrs:o}){const{t:c}=Pe(),s=Ie(),a=j(!0);ve(()=>a.value=!1);const r=Ye(s.getRowSelection(),"selectedRowKeys");let i=!1;const u=j([]),l=j([]),y=j([]),h=j(null),m=et({checkAll:!0,checkedList:[],defaultCheckList:[]}),v=j(!1),x=j(!1),{prefixCls:_}=Ke("basic-column-setting"),p=T(()=>n(s==null?void 0:s.getBindValues)||{}),b=T(()=>{let g={};return e.isMobile&&(g.visible=!1),g});let w;const P=j(),{saveSetting:B,resetSetting:Y}=Mo({state:m,popoverVisible:a,plainOptions:l,plainSortOptions:y,sortableOrder:P,checkIndex:v},k,$);Re(()=>{setTimeout(()=>{s.getColumns().length&&!m.isInit&&N()},0)}),Re(()=>{const g=n(p);v.value=!!g.showIndexColumn,x.value=!!g.rowSelection});function Z(){const g=[];return s.getColumns({ignoreIndex:!0,ignoreAction:!0}).forEach(S=>{g.push(O({label:S.title||S.customTitle,value:S.dataIndex||S.title},S))}),g}function N(){const g=Z(),S=s.getColumns({ignoreAction:!0}).map(E=>E.defaultHidden?"":E.dataIndex||E.title).filter(Boolean);l.value.length?n(l).forEach(E=>{const D=g.find(z=>z.dataIndex===E.dataIndex);D&&(E.fixed=D.fixed)}):(l.value=g,y.value=g,u.value=g,m.defaultCheckList=S),m.isInit=!0,m.checkedList=S}function ue(g){const S=l.value.map(E=>E.value);g.target.checked?(m.checkedList=S,k(S)):(m.checkedList=[],k([]))}const ie=T(()=>{const g=l.value.length;let S=m.checkedList.length;return n(v)&&S--,S>0&&S<g});function C(g){const S=y.value.length;m.checkAll=g.length===S;const E=n(y).map(D=>D.value);g.sort((D,z)=>E.indexOf(D)-E.indexOf(z)),k(g)}function R(){m.checkedList=s.getColumns({ignoreAction:!0}).map(g=>g.dataIndex||g.title).filter(Boolean),m.checkAll=!0,l.value=n(u),y.value=n(u),k(s.getCacheColumns()),P.value&&w.sort(P.value),Y()}function H(){i||ve(()=>{const g=n(h);if(!g)return;const S=g.$el;S&&(w=wn.create(n(S),{animation:500,delay:400,delayOnTouchOnly:!0,handle:".table-column-drag-icon ",onEnd:E=>{const{oldIndex:D,newIndex:z}=E;if(ut(D)||ut(z)||D===z)return;const U=Le(y.value);if(D>z?(U.splice(z,0,U[D]),U.splice(D+1,1)):(U.splice(z+1,0,U[D]),U.splice(D,1)),y.value=U,m.checkedList.length!=U.length){const Ce=U.map(ge=>ge.value).filter(ge=>m.checkedList.find(we=>we===ge));k(Ce)}else k(U)}}),P.value||(P.value=w.toArray()),i=!0)})}function G(g){s.setProps({showIndexColumn:g.target.checked})}function f(g){s.setProps({rowSelection:g.target.checked?r:void 0})}function $(g,S){var U;if(!m.checkedList.includes(g.dataIndex))return;const E=Z(),D=g.fixed===S?!1:S,z=E.findIndex(pe=>pe.dataIndex===g.dataIndex);z!==-1&&(E[z].fixed=D),g.fixed=D,D&&!g.width&&(g.width=100),(U=s.setCacheColumnsByField)==null||U.call(s,g.dataIndex,{fixed:D}),k(E)}function k(g){s.setColumns(g);const S=n(y).map(E=>{const D=g.findIndex(z=>z===E.value||typeof z!="string"&&z.dataIndex===E.value)!==-1;return{dataIndex:E.value,fixed:E.fixed,visible:D}});t("columns-change",S)}function F(){return oe(o.getPopupContainer)?o.getPopupContainer():kt()}return he(O({getBindProps:b,t:c},nn(m)),{popoverVisible:a,indeterminate:ie,onCheckAllChange:ue,onChange:C,plainOptions:l,reset:R,saveSetting:B,prefixCls:_,columnListRef:h,handleVisibleChange:H,checkIndex:v,checkSelect:x,handleIndexCheckChange:G,handleSelectCheckChange:f,defaultRowSelection:r,handleColumnFixed:$,getPopupContainer:F})}});function Bo(e,t,o,c,s,a){const r=L("Checkbox"),i=L("DragOutlined"),u=L("Icon"),l=L("Tooltip"),y=L("Divider"),h=L("CheckboxGroup"),m=L("ScrollContainer"),v=L("a-button"),x=L("SettingOutlined"),_=L("Popover");return M(),ee(l,Ee({placement:"top"},e.getBindProps),{title:W(()=>[ce("span",null,se(e.t("component.table.settingColumn")),1)]),default:W(()=>[q(_,{visible:e.popoverVisible,"onUpdate:visible":t[3]||(t[3]=p=>e.popoverVisible=p),placement:"bottomLeft",trigger:"click",onVisibleChange:e.handleVisibleChange,overlayClassName:`${e.prefixCls}__cloumn-list`,getPopupContainer:e.getPopupContainer},{title:W(()=>[ce("div",{class:ae(`${e.prefixCls}__popover-title`)},[q(r,{indeterminate:e.indeterminate,checked:e.checkAll,"onUpdate:checked":t[0]||(t[0]=p=>e.checkAll=p),onChange:e.onCheckAllChange},{default:W(()=>[ke(se(e.t("component.table.settingColumnShow")),1)]),_:1},8,["indeterminate","checked","onChange"]),q(r,{checked:e.checkIndex,"onUpdate:checked":t[1]||(t[1]=p=>e.checkIndex=p),onChange:e.handleIndexCheckChange},{default:W(()=>[ke(se(e.t("component.table.settingIndexColumnShow")),1)]),_:1},8,["checked","onChange"])],2)]),content:W(()=>[q(m,null,{default:W(()=>[q(h,{value:e.checkedList,"onUpdate:value":t[2]||(t[2]=p=>e.checkedList=p),onChange:e.onChange,ref:"columnListRef"},{default:W(()=>[(M(!0),de(We,null,on(e.plainOptions,p=>(M(),de(We,{key:p.value},["ifShow"in p&&!p.ifShow?ne("",!0):(M(),de("div",{key:0,class:ae(`${e.prefixCls}__check-item`)},[q(i,{class:"table-column-drag-icon"}),q(r,{value:p.value},{default:W(()=>[ke(se(p.label),1)]),_:2},1032,["value"]),q(l,{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:e.getPopupContainer},{title:W(()=>[ke(se(e.t("component.table.settingFixedLeft")),1)]),default:W(()=>[q(u,{icon:"line-md:arrow-align-left",class:ae([`${e.prefixCls}__fixed-left`,{active:p.fixed==="left",disabled:!e.checkedList.includes(p.value)}]),onClick:b=>e.handleColumnFixed(p,"left")},null,8,["class","onClick"])]),_:2},1032,["getPopupContainer"]),q(y,{type:"vertical"}),q(l,{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:e.getPopupContainer},{title:W(()=>[ke(se(e.t("component.table.settingFixedRight")),1)]),default:W(()=>[q(u,{icon:"line-md:arrow-align-left",class:ae([`${e.prefixCls}__fixed-right`,{active:p.fixed==="right",disabled:!e.checkedList.includes(p.value)}]),onClick:b=>e.handleColumnFixed(p,"right")},null,8,["class","onClick"])]),_:2},1032,["getPopupContainer"])],2))],64))),128))]),_:1},8,["value","onChange"])]),_:1}),ce("div",{class:ae(`${e.prefixCls}__popover-footer`)},[q(v,{size:"small",onClick:e.reset},{default:W(()=>[ke(se(e.t("common.resetText")),1)]),_:1},8,["onClick"]),q(v,{size:"small",type:"primary",onClick:e.saveSetting},{default:W(()=>[ke(" 保存 ")]),_:1},8,["onClick"])],2)]),default:W(()=>[q(x)]),_:1},8,["visible","onVisibleChange","overlayClassName","getPopupContainer"])]),_:1},16)}const No=Se(Ho,[["render",Bo]]),zo=me({name:"SizeSetting",props:{isMobile:Boolean},components:{ColumnHeightOutlined:Qn,Tooltip:Ze,Dropdown:eo,Menu:gt,MenuItem:gt.Item},setup(e){const t=Ie(),{t:o}=Pe(),c=j([t.getSize()]),s=T(()=>{let r={};return e.isMobile&&(r.visible=!1),r});function a({key:r}){c.value=[r],t.setProps({size:r})}return{getBindProps:s,handleTitleClick:a,selectedKeysRef:c,getPopupContainer:kt,t:o}}});function Vo(e,t,o,c,s,a){const r=L("ColumnHeightOutlined"),i=L("MenuItem"),u=L("Menu"),l=L("Dropdown"),y=L("Tooltip");return M(),ee(y,Ee({placement:"top"},e.getBindProps),{title:W(()=>[ce("span",null,se(e.t("component.table.settingDens")),1)]),default:W(()=>[q(l,{placement:"bottom",trigger:["click"],getPopupContainer:e.getPopupContainer},{overlay:W(()=>[q(u,{onClick:e.handleTitleClick,selectable:"",selectedKeys:e.selectedKeysRef,"onUpdate:selectedKeys":t[0]||(t[0]=h=>e.selectedKeysRef=h)},{default:W(()=>[q(i,{key:"default"},{default:W(()=>[ce("span",null,se(e.t("component.table.settingDensDefault")),1)]),_:1}),q(i,{key:"middle"},{default:W(()=>[ce("span",null,se(e.t("component.table.settingDensMiddle")),1)]),_:1}),q(i,{key:"small"},{default:W(()=>[ce("span",null,se(e.t("component.table.settingDensSmall")),1)]),_:1})]),_:1},8,["onClick","selectedKeys"])]),default:W(()=>[q(r)]),_:1},8,["getPopupContainer"])]),_:1},16)}const jo=Se(zo,[["render",Vo]]),Wo=me({name:"RedoSetting",props:{isMobile:Boolean},components:{RedoOutlined:to,Tooltip:Ze},setup(e){const t=Ie(),{t:o}=Pe(),c=T(()=>{let a={};return e.isMobile&&(a.visible=!1),a});function s(){t.reload(),t.emit("table-redo")}return{getBindProps:c,redo:s,t:o}}});function Uo(e,t,o,c,s,a){const r=L("RedoOutlined"),i=L("Tooltip");return M(),ee(i,Ee({placement:"top"},e.getBindProps),{title:W(()=>[ce("span",null,se(e.t("common.redo")),1)]),default:W(()=>[q(r,{onClick:e.redo},null,8,["onClick"])]),_:1},16)}const qo=Se(Wo,[["render",Uo]]),Go=me({name:"FullScreenSetting",props:{isMobile:Boolean},components:{FullscreenExitOutlined:no,FullscreenOutlined:oo,Tooltip:Ze},setup(e){const t=Ie(),{t:o}=Pe(),{toggle:c,isFullscreen:s}=kn(t.wrapRef);return{getBindProps:T(()=>{let r={};return e.isMobile&&(r.visible=!1),r}),toggle:c,isFullscreen:s,t:o}}});function Xo(e,t,o,c,s,a){const r=L("FullscreenOutlined"),i=L("FullscreenExitOutlined"),u=L("Tooltip");return M(),ee(u,Ee({placement:"top"},e.getBindProps),{title:W(()=>[ce("span",null,se(e.t("component.table.settingFullScreen")),1)]),default:W(()=>[e.isFullscreen?(M(),ee(i,{key:1,onClick:e.toggle},null,8,["onClick"])):(M(),ee(r,{key:0,onClick:e.toggle},null,8,["onClick"]))]),_:1},16)}const Yo=Se(Go,[["render",Xo]]),Zo=me({name:"TableSetting",components:{ColumnSetting:No,SizeSetting:jo,RedoSetting:qo,FullScreenSetting:Yo},props:{setting:{type:Object,default:()=>({})},mode:String},emits:["columns-change"],setup(e,{emit:t}){const{t:o}=Pe(),c=Ie(),s=T(()=>O({redo:!0,size:!0,setting:!0,fullScreen:!1},e.setting)),a=T(()=>e.mode==="mobile");function r(u){t("columns-change",u)}function i(){return c?n(c.wrapRef):document.body}return{getSetting:s,t:o,handleColumnChange:r,getTableContainer:i,isMobile:a}}});const Jo={class:"table-settings"};function Qo(e,t,o,c,s,a){const r=L("RedoSetting"),i=L("SizeSetting"),u=L("ColumnSetting"),l=L("FullScreenSetting");return M(),de("div",Jo,[e.getSetting.redo?(M(),ee(r,{key:0,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):ne("",!0),e.getSetting.size?(M(),ee(i,{key:1,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):ne("",!0),e.getSetting.setting?(M(),ee(u,{key:2,isMobile:e.isMobile,onColumnsChange:e.handleColumnChange,getPopupContainer:e.getTableContainer},null,8,["isMobile","onColumnsChange","getPopupContainer"])):ne("",!0),e.getSetting.fullScreen?(M(),ee(l,{key:3,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):ne("",!0)])}const el=Se(Zo,[["render",Qo]]),tl=me({name:"BasicTableTitle",components:{BasicTitle:_n},props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(e){const{prefixCls:t}=Ke("basic-table-title");return{getTitle:T(()=>{const{title:c,getSelectRows:s=()=>{}}=e;let a=c;return oe(c)&&(a=c({selectRows:s()})),a}),prefixCls:t}}});function nl(e,t,o,c,s,a){const r=L("BasicTitle");return e.getTitle?(M(),ee(r,{key:0,class:ae(e.prefixCls),helpMessage:e.helpMessage},{default:W(()=>[ke(se(e.getTitle),1)]),_:1},8,["class","helpMessage"])):ne("",!0)}const ol=Se(tl,[["render",nl]]),ll=me({name:"BasicTableHeader",components:{Divider:xt,TableTitle:ol,TableSetting:el},props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""}},emits:["columns-change"],setup(e,{emit:t}){const{prefixCls:o}=Ke("basic-table-header");function c(y){t("columns-change",y)}const{getSelectRowKeys:s,setSelectedRowKeys:a,getRowSelection:r}=Ie(),i=T(()=>s()),u=T(()=>r()),l=T(()=>{var y;return((y=u.value)==null?void 0:y.preserveSelectedRowKeys)===!0});return{prefixCls:o,handleColumnChange:c,selectRowKeys:i,setSelectedRowKeys:a,openRowSelection:u,isAcrossPage:l}}});const sl={style:{width:"100%"}},al={key:0,style:{margin:"5px"}},il={style:{margin:"-4px 0 -2px","padding-top":"5px"}},rl={key:0},cl={key:1};function ul(e,t,o,c,s,a){const r=L("TableTitle"),i=L("Divider"),u=L("TableSetting"),l=L("a-button"),y=L("a-popover"),h=L("a-divider"),m=L("a-alert");return M(),de("div",sl,[e.$slots.headerTop?(M(),de("div",al,[De(e.$slots,"headerTop")])):ne("",!0),ce("div",{class:ae(`flex items-center ${e.prefixCls}__table-title-box`)},[ce("div",{class:ae(`${e.prefixCls}__tableTitle`)},[e.$slots.tableTitle?De(e.$slots,"tableTitle",{key:0}):ne("",!0),!e.$slots.tableTitle&&e.title?(M(),ee(r,{key:1,helpMessage:e.titleHelpMessage,title:e.title},null,8,["helpMessage","title"])):ne("",!0)],2),ce("div",{class:ae(`${e.prefixCls}__toolbar`)},[De(e.$slots,"toolbar"),e.$slots.toolbar&&e.showTableSetting?(M(),ee(i,{key:0,type:"vertical"})):ne("",!0),e.showTableSetting?(M(),ee(u,{key:1,class:ae(`${e.prefixCls}__toolbar-desktop`),style:{"white-space":"nowrap"},setting:e.tableSetting,onColumnsChange:e.handleColumnChange},null,8,["class","setting","onColumnsChange"])):ne("",!0),q(y,{overlayClassName:`${e.prefixCls}__toolbar-mobile`,trigger:"click",placement:"left",getPopupContainer:v=>v.parentElement},{content:W(()=>[e.showTableSetting?(M(),ee(u,{key:0,mode:"mobile",setting:e.tableSetting,onColumnsChange:e.handleColumnChange},null,8,["setting","onColumnsChange"])):ne("",!0)]),default:W(()=>[e.showTableSetting?(M(),ee(l,{key:0,class:ae(`${e.prefixCls}__toolbar-mobile`),type:"text",preIcon:"ant-design:menu",shape:"circle"},null,8,["class"])):ne("",!0)]),_:1},8,["overlayClassName","getPopupContainer"])],2)],2),ce("div",il,[De(e.$slots,"tableTop",{},()=>[e.openRowSelection!=null?(M(),ee(m,{key:0,type:"info","show-icon":"",class:"alert"},{message:W(()=>[e.selectRowKeys.length>0?(M(),de(We,{key:0},[ce("span",null,[ce("span",null,"已选中 "+se(e.selectRowKeys.length)+" 条记录",1),e.isAcrossPage?(M(),de("span",rl,"(可跨页)")):ne("",!0)]),q(h,{type:"vertical"}),ce("a",{onClick:t[0]||(t[0]=v=>e.setSelectedRowKeys([]))},"清空"),De(e.$slots,"alertAfter")],64)):(M(),de("span",cl,"未选中任何数据"))]),_:3})):ne("",!0)])])])}const dl=Se(ll,[["render",ul]]);function fl(e,t,o){return{getHeaderProps:T(()=>{const{title:s,showTableSetting:a,titleHelpMessage:r,tableSetting:i}=n(e),u=!t.tableTitle&&!s&&!t.toolbar&&!a;return u&&!Ve(s)?{}:{title:u?null:()=>Ne(dl,{title:s,titleHelpMessage:r,showTableSetting:a,tableSetting:i,onColumnsChange:o.onColumnsChange},O(O(O(O(O({},t.toolbar?{toolbar:()=>Be(t,"toolbar")}:{}),t.tableTitle?{tableTitle:()=>Be(t,"tableTitle")}:{}),t.headerTop?{headerTop:()=>Be(t,"headerTop")}:{}),t.tableTop?{tableTop:()=>Be(t,"tableTop")}:{}),t.alertAfter?{alertAfter:()=>Be(t,"alertAfter")}:{}))}})}}function gl(e,t,o){const c=j([]),s=T(()=>n(e).autoCreateKey&&!n(e).rowKey),a=T(()=>{const{rowKey:y}=n(e);return n(s)?ye:y}),r=T(()=>{const{isTreeTable:y}=n(e);return y?{expandedRowKeys:n(c),onExpandedRowsChange:h=>{c.value=h,o("expanded-rows-change",h)}}:{}});function i(){const y=u();c.value=y}function u(y){const h=[],{childrenColumnName:m}=n(e);return Fe(y||n(t)).forEach(v=>{h.push(v[n(a)]);const x=v[m||"children"];x!=null&&x.length&&h.push(...u(x))}),h}function l(){c.value=[]}return{getExpandOption:r,expandAll:i,collapseAll:l}}const pt="_row",bt="_index",hl=me({name:"BasicTableFooter",components:{Table:tt},props:{bordered:{type:Boolean,default:!1},summaryFunc:{type:Function},summaryData:{type:Array},scroll:{type:Object},rowKey:J.string.def("key"),hasExpandedRow:J.bool},setup(e){const t=Ie(),o=T(()=>{const{summaryFunc:s,summaryData:a}=e;if(a!=null&&a.length)return a.forEach((i,u)=>i[e.rowKey]=`${u}`),a;if(!oe(s))return[];let r=Fe(n(t.getDataSource()));return r=s(r),r.forEach((i,u)=>{i[e.rowKey]=`${u}`}),r});return{getColumns:T(()=>{const s=n(o);let a=Le(t.getColumns());a=a.filter(h=>!h.defaultHidden);const r=a.findIndex(h=>h.flag===ze),i=s.some(h=>Reflect.has(h,pt)),u=s.some(h=>Reflect.has(h,bt));let l=!1,y=t.getRowSelection()&&i;if(r!==-1&&(u?(l=!0,a[r].customRender=({record:h})=>h[bt],a[r].ellipsis=!1):Reflect.deleteProperty(a[r],"customRender")),y){const h=a.some(m=>m.fixed==="left"||m.fixed===!0);a.unshift(he(O({width:50,title:"selection",key:"selectionKey",align:"center"},h?{fixed:"left"}:{}),{customRender:({record:m})=>l?"":m[pt]}))}if(e.hasExpandedRow){const h=a.some(m=>m.fixed==="left");a.unshift(he(O({width:50,title:"expandedRow",key:"expandedRowKey",align:"center"},h?{fixed:"left"}:{}),{customRender:()=>""}))}return a}),getDataSource:o}}});function ml(e,t,o,c,s,a){const r=L("Table");return e.summaryFunc||e.summaryData?(M(),ee(r,{key:0,showHeader:!1,bordered:e.bordered,pagination:!1,dataSource:e.getDataSource,rowKey:i=>i[e.rowKey],columns:e.getColumns,tableLayout:"fixed",scroll:e.scroll},null,8,["bordered","dataSource","rowKey","columns","scroll"])):ne("",!0)}const pl=Se(hl,[["render",ml],["__scopeId","data-v-9e46aea3"]]);function bl(e,t,o,c,s){const a=T(()=>(n(s)||[]).length===0),r=T(()=>Object.keys(t).includes("expandedRowRender")),i=T(()=>{const{summaryFunc:l,showSummary:y,summaryData:h,bordered:m}=n(e);return y&&!n(a)?()=>Ne(pl,{bordered:m,summaryFunc:l,summaryData:h,scroll:n(o),hasExpandedRow:r.value}):void 0});Re(()=>{u()});function u(){const{showSummary:l}=n(e);!l||n(a)||ve(()=>{const y=n(c);if(!y)return;const h=y.$el.querySelector(".ant-table-content");Tn({el:h,name:"scroll",listener:()=>{const m=y.$el.querySelector(".ant-table-footer .ant-table-content");!m||!h||(m.scrollLeft=h.scrollLeft)},wait:0,options:!0})})}return{getFooterProps:i}}function Cl(e,t,o,c){const s=T(()=>{const{formConfig:u}=n(e),{submitButtonOptions:l,autoSubmitOnEnter:y}=u||{};return he(O({showAdvancedButton:!0},u),{submitButtonOptions:O({loading:n(c)},l),compact:!0,autoSubmitOnEnter:y})}),a=T(()=>Object.keys(t).map(l=>l.startsWith("form-")?l:null).filter(l=>!!l));function r(u){var l,y;return u&&(y=(l=u==null?void 0:u.replace)==null?void 0:l.call(u,/form\-/,""))!=null?y:""}function i(u){const{handleSearchInfoFn:l}=n(e);l&&oe(l)&&(u=l(u)||u),o({searchInfo:u,page:1})}return{getFormProps:s,replaceFormSlotKey:r,getFormSlotKeys:a,handleSearchInfoChange:i}}const yl={clickToRowSelect:J.bool.def(!0),isTreeTable:J.bool.def(!1),tableSetting:J.shape({}),inset:J.bool,sortFn:{type:Function,default:Pn},filterFn:{type:Function,default:On},showTableSetting:J.bool,autoCreateKey:J.bool.def(!0),striped:J.bool.def(!1),showSummary:J.bool,summaryFunc:{type:[Function,Array],default:null},summaryData:{type:Array,default:null},indentSize:J.number.def(24),canColDrag:J.bool.def(!0),api:{type:Function,default:null},beforeFetch:{type:Function,default:null},afterFetch:{type:Function,default:null},handleSearchInfoFn:{type:Function,default:null},fetchSetting:{type:Object,default:()=>Tt},immediate:J.bool.def(!0),emptyDataIsShowTable:J.bool.def(!0),searchInfo:{type:Object,default:null},defSort:{type:Object,default:null},useSearchForm:J.bool,formConfig:{type:Object,default:null},columns:{type:[Array],default:()=>[]},showIndexColumn:J.bool.def(!0),indexColumnProps:{type:Object,default:null},showActionColumn:{type:Boolean,default:!0},actionColumn:{type:Object,default:null},ellipsis:J.bool.def(!0),canResize:J.bool.def(!0),clearSelectOnPageChange:J.bool,resizeHeightOffset:J.number.def(0),rowSelection:{type:Object,default:null},title:{type:[String,Function],default:null},titleHelpMessage:{type:[String,Array]},minHeight:J.number,maxHeight:J.number,maxColumnWidth:J.number,dataSource:{type:Array,default:null},rowKey:{type:[String,Function],default:""},bordered:J.bool,pagination:{type:[Object,Boolean],default:null},loading:J.bool,rowClassName:{type:Function},scroll:{type:Object,default:null},beforeEditSubmit:{type:Function},size:{type:String,default:En},expandedRowKeys:{type:Array,default:null}},nt=me({components:{Table:tt,BasicForm:Rn,HeaderCell:bo,CustomSelectHeader:co},props:yl,emits:["fetch-success","fetch-error","selection-change","register","row-click","row-dbClick","row-contextmenu","row-mouseenter","row-mouseleave","edit-end","edit-cancel","edit-row-end","edit-change","expanded-rows-change","change","columns-change","table-redo"],setup(e,{attrs:t,emit:o,slots:c,expose:s}){const a=j(null),r=j([]),i=j(null),u=j(),{prefixCls:l}=Ke("basic-table"),[y,h]=Dn(),m=T(()=>O(O({},e),n(u))),v=ln(Ln,!1);Re(()=>{n(v)&&e.canResize&&gn()});const{getLoading:x,setLoading:_}=Eo(m),{getPaginationInfo:p,getPagination:b,setPagination:w,setShowPagination:P,getShowPagination:B}=yo(m),Y=T(()=>m.value.childrenColumnName||"children"),{getRowSelection:Z,getSelectRows:N,getSelectRowKeys:ue,setSelectedRowKeys:ie,getRowSelectionRef:C,selectHeaderProps:R,isCustomSelection:H,handleCustomSelectColumn:G,clearSelectedRowKeys:f,deleteSelectRowByKey:$,getExpandIconColumnIndex:k}=Ro(m,o,i,p,r,Y),{handleTableChange:F,getDataSourceRef:g,getDataSource:S,getRawDataSource:E,setTableData:D,updateTableDataRecord:z,deleteTableDataRecord:U,insertTableDataRecord:pe,findTableDataRecord:Ce,fetch:ge,getRowKey:we,reload:d,getAutoCreateKey:I,updateTableData:V}=Oo(m,{tableData:r,getPaginationInfo:p,setLoading:_,setPagination:w,validate:h.validate,clearSelectedRowKeys:f},o);function A(...X){F.call(void 0,...X),o("change",...X);const{onChange:Q}=n(m);Q&&oe(Q)&&Q.call(void 0,...X)}const{getViewColumns:K,getColumns:te,setCacheColumnsByField:le,setColumns:be,getColumnsRef:Ae,getCacheColumns:Ot}=Fo(m,p,G),{getScrollRef:ot,redoHeight:lt}=Ao(m,a,Ae,C,g),{customRow:Et}=Lo(m,{setSelectedRowKeys:ie,getSelectRowKeys:ue,clearSelectedRowKeys:f,getAutoCreateKey:I,emit:o}),{getRowClassName:At}=Ko(m,l),{getExpandOption:Dt,expandAll:Lt,collapseAll:Kt}=gl(m,r,o),Mt={onColumnsChange:X=>{var Q,Te;o("columns-change",X),(Te=(Q=n(m)).onColumnsChange)==null||Te.call(Q,X)}},{getHeaderProps:Ht}=fl(m,c,Mt),{getFooterProps:Bt}=bl(m,c,ot,a,g),{getFormProps:Nt,replaceFormSlotKey:zt,getFormSlotKeys:Vt,handleSearchInfoChange:jt}=Cl(m,c,ge,x),Me=T(()=>{const X=n(g);let Q=he(O(he(O(O(he(O({},t),{customRow:Et}),n(m)),n(Ht)),{scroll:n(ot),loading:n(x),tableLayout:"fixed",rowSelection:n(C),rowKey:n(we),columns:Fe(n(K)),pagination:Fe(n(p)),dataSource:X,footer:n(Bt)}),n(Dt)),{expandIconColumnIndex:k.value});return delete Q.rowSelection,!Q.isTreeTable&&delete Q.expandIconColumnIndex,Q.expandedRowKeys===null&&delete Q.expandedRowKeys,Q=Ye(Q,["class","onChange"]),Q}),st=T(()=>{const X=n(Me);return X.maxColumnWidth>0?X.maxColumnWidth+"px":null}),Wt=T(()=>{const X=n(Me);return[l,t.class,{[`${l}-form-container`]:X.useSearchForm,[`${l}--inset`]:X.inset,[`${l}-col-max-width`]:st.value!=null,[`${l}--show-summary`]:X.showSummary}]}),Ut=T(()=>{const{emptyDataIsShowTable:X,useSearchForm:Q}=n(m);return X||!Q?!0:!!n(g).length});function qt(X){u.value=O(O({},n(u)),X)}const je={reload:d,getSelectRows:N,clearSelectedRowKeys:f,getSelectRowKeys:ue,deleteSelectRowByKey:$,setPagination:w,setTableData:D,updateTableDataRecord:z,deleteTableDataRecord:U,insertTableDataRecord:pe,findTableDataRecord:Ce,redoHeight:lt,setSelectedRowKeys:ie,setColumns:be,setLoading:_,getDataSource:S,getRawDataSource:E,setProps:qt,getRowSelection:Z,getPaginationRef:b,getColumns:te,getCacheColumns:Ot,emit:o,updateTableData:V,setShowPagination:P,getShowPagination:B,setCacheColumnsByField:le,expandAll:Lt,collapseAll:Kt,getSize:()=>n(Me).size};An(he(O({},je),{wrapRef:i,getBindValues:Me}));const Gt=T(()=>{const X=[],Q=[],He=n(K).map(xe=>{var at;return(at=xe.slotsBak)==null?void 0:at.customRender});for(const xe of Object.keys(c))["bodyCell"].includes(xe)||(He.includes(xe)?Q.push(xe):X.push(xe));return{native:X,custom:Q}});if(s(je),o("register",je,h),m.value.showSummary){let X;const Q=function(){const Te=this.scrollLeft;X.forEach(He=>He.scrollLeft=Te)};St(()=>{const Te=$e(g,He=>{He.length>0&&setTimeout(()=>{Te(),X=i.value.querySelectorAll(".ant-table-body"),X.forEach(xe=>{xe.addEventListener("scroll",Q,!1)})},0)},{immediate:!0})}),vt(()=>{X.length&&X.forEach(Te=>Te.removeEventListener("scroll",Q))})}return{tableElRef:a,getBindValues:Me,getLoading:x,registerForm:y,handleSearchInfoChange:jt,getEmptyDataIsShowTable:Ut,handleTableChange:A,getRowClassName:At,wrapRef:i,tableAction:je,redoHeight:lt,handleResizeColumn:(X,Q)=>{Q.width=X},getFormProps:Nt,replaceFormSlotKey:zt,getFormSlotKeys:Vt,getWrapperClass:Wt,getMaxColumnWidth:st,columns:K,selectHeaderProps:R,isCustomSelection:H,slotNamesGroup:Gt}}}),Ct=()=>{sn(e=>({"353385b0":e.getMaxColumnWidth}))},yt=nt.setup;nt.setup=yt?(e,t)=>(Ct(),yt(e,t)):Ct;const Bl=nt;export{Bl as _};
