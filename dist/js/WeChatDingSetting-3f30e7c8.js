var N=Object.defineProperty,V=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var B=(i,t,a)=>t in i?N(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,F=(i,t)=>{for(var a in t||(t={}))G.call(t,a)&&B(i,a,t[a]);if(A)for(var a of A(t))O.call(t,a)&&B(i,a,t[a]);return i},E=(i,t)=>V(i,P(t));var f=(i,t,a)=>new Promise((D,o)=>{var c=r=>{try{y(a.next(r))}catch(p){o(p)}},g=r=>{try{y(a.throw(r))}catch(p){o(p)}},y=r=>r.done?D(r.value):Promise.resolve(r.value).then(c,g);y((a=a.apply(i,t)).next())});import{d as z,l as u,o as X,a7 as k,a8 as x,ad as l,f as M,aq as S,u as n,ae as w,W as L,ak as Z}from"./vue-86253b15.js";import{i as H,j as J,k as K}from"./UserSetting.api-604009d2.js";import{u as Q,d as R,q as Y}from"./jeecg-online-vendor-bc5d810e.js";import{cX as ee,cZ as se,c_ as te,M as ae}from"./antd-vue-vendor-371529c2.js";import{m as ne}from"./index-4de4eaa0.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-04a44d0a.js";import"./vxe-table-vendor-6a8d95c4.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";const ie=l("div",{class:"my-account"},"第三方APP",-1),le={class:"account-row-item"},oe=l("div",{class:"account-label gray-75"},"钉钉绑定",-1),re=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"钉钉",-1),ce={key:0,class:"gray-75",style:{"margin-left":"8px"}},de={class:"account-row-item"},ue=l("div",{class:"account-label gray-75"},"账号绑定",-1),pe=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"微信",-1),me={key:0,class:"gray-75",style:{"margin-left":"8px"}},fe=z({name:"we-chat-ding-setting"}),Ce=z(E(F({},fe),{setup(i){const{prefixCls:t}=ne("j-user-tenant-setting-container"),a=ee({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),D=Q(),o=u({}),c=u({}),g=u({}),y=R(),r=u(""),p=u(""),ge=u({}),{createMessage:m}=Y(),h=u(""),v=u("");function T(){return f(this,null,function*(){let e=yield H({thirdType:"wechat_open,dingtalk,wechat_enterprise"});if(o.value="",c.value="",g.value="",e&&e.result){let s=e.result;for(let d=0;d<s.length;d++)C(s[d])}})}function ye(){let e=n(g);e.sysUserId?b({sysUserId:e.sysUserId,id:e.id},"企业微信"):U("wechat_enterprise")}function W(){let e=n(c);e.sysUserId?b({sysUserId:e.sysUserId,id:e.id},"钉钉"):U("dingtalk")}function $(){let e=n(o);e.sysUserId?b({sysUserId:e.sysUserId,id:e.id},"微信"):U("wechat_open")}function U(e){let s=`${y.uploadUrl}/sys/thirdLogin/render/${e}`;n(h)&&(h.value.close(),window.removeEventListener("message",n(v),!1)),h.value=window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),r.value=e,v.value=function(d){return f(this,null,function*(){let _=d.data;if(typeof _=="string")if(_==="登录失败")I();else if(_.includes("绑定手机号")){let q=_.split(",");p.value=q[1],yield j()}else _&&m.warning("该敲敲云账号已被其它第三方账号绑定,请解绑或绑定其它敲敲云账号");else I();window.removeEventListener("message",n(v),!1),h.value=""})},window.addEventListener("message",n(v),!1)}function j(){return f(this,null,function*(){if(!n(p)){I();return}let e={thirdUserUuid:n(p),thirdType:n(r)};yield J(e).then(s=>{s.success?s.result&&C(s.result):m.warning(s.message)}).catch(s=>{m.warning(s.message)})})}function I(){m.warning("第三方账号绑定异常")}function C(e){let s=e.thirdType;s=="wechat_open"?o.value=e:s=="dingtalk"?c.value=e:s=="wechat_enterprise"&&(g.value=e)}function b(e,s){return f(this,null,function*(){ae.confirm({title:"解绑"+s,content:"确定要解绑吗",okText:"确认",cancelText:"取消",onOk:()=>f(this,null,function*(){yield K(e).then(d=>{d.success?(T(),m.success(d.message)):m.warning(d.message)})})})})}return X(()=>{T()}),(e,s)=>(k(),x("div",{class:Z([`${n(t)}`])},[ie,l("div",le,[oe,l("span",null,[M(n(se),{style:S(c.value.sysUserId?{color:"#007FFF"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),re,c.value.realname?(k(),x("span",ce,w("已绑定："+c.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:W},w(c.value.sysUserId?"解绑":"绑定"),1)])]),l("div",de,[ue,l("span",null,[M(n(te),{style:S(o.value.sysUserId?{color:"#1ec563"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),pe,o.value.realname?(k(),x("span",me,w("已绑定："+o.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:$},w(o.value.sysUserId?"解绑":"绑定"),1)])])],2))}}));export{Ce as default};
