var u=(f,R,l)=>new Promise((i,s)=>{var h=n=>{try{p(l.next(n))}catch(c){s(c)}},y=n=>{try{p(l.throw(n))}catch(c){s(c)}},p=n=>n.done?i(n.value):Promise.resolve(n.value).then(h,y);p((l=l.apply(f,R)).next())});import j from"./BasicTable-1161a1ed.js";import{Q as A}from"./componentMap-9abc9664.js";import{u as H}from"./useTable-8db918c8.js";import{u as Q,a as q,B as G}from"./index-4898f2ce.js";import"./index-32f277d2.js";import{_ as J}from"./UserDrawer.vue_vue_type_script_setup_true_lang-2902afcf.js";import{_ as X}from"./UseSelectModal.vue_vue_type_script_setup_true_lang-a3ba22be.js";import{u as Y,b as Z,a as ee,d as te}from"./role.api-7fb490ad.js";import{u as oe,s as ne}from"./role.data-0a33274b.js";import{g as ae}from"./user.api-d0443f37.js";import{z as se}from"./index-92811877.js";import{d as re,k,V as m,a5 as w,a9 as g,a7 as t,f as o,u as r,E as _,W as I}from"./vue-bcbaddf9.js";const Re=re({__name:"RoleUserTable",props:{disableUserEdit:{type:Boolean,default:!1}},emits:["register","hideUserList"],setup(f,{emit:R}){const l=f,i=k([]),s=k(""),[h,{setDrawerProps:y,closeDrawer:p}]=Q(e=>u(this,null,function*(){s.value=e.id,x({searchInfo:{roleId:e.id}}),d()})),[n,{openDrawer:c}]=q(),[S,{openModal:D}]=se(),[U,{reload:d,updateTableDataRecord:v,setProps:x}]=H({title:"用户列表",api:Y,columns:oe,formConfig:{labelWidth:120,schemas:ne,autoSubmitOnEnter:!0,actionColOptions:{pull:1}},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},canResize:!1,rowKey:"id",actionColumn:{width:180,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),T={type:"checkbox",columnWidth:50,selectedRowKeys:i,onChange:B};function B(e,a){i.value=e}function E(){c(!0,{isUpdate:!1,selectedroles:[s.value],isRole:!0})}function K(e){return u(this,null,function*(){try{const a=yield ae({userid:e.id});a&&a.length>0&&(e.selectedroles=a)}catch(a){}c(!0,{record:e,isUpdate:!0,isRole:!0})})}function O(e){return u(this,null,function*(){yield te({userId:e.id,roleId:s.value},d)})}function V(){return u(this,null,function*(){yield Z({userIds:i.value.join(","),roleId:s.value},d)})}function L({isUpdate:e,values:a}){e?v(a.id,a):d()}function M(){D(!0)}function N(e){return u(this,null,function*(){yield ee({roleId:s.value,userIdList:e},d)})}function W(e){return[{label:"编辑",onClick:K.bind(null,e),ifShow:()=>!l.disableUserEdit},{label:"取消关联",popConfirm:{title:"是否确认取消关联",confirm:O.bind(null,e)}}]}return(e,a)=>{const b=m("a-button"),C=m("Icon"),z=m("a-menu-item"),F=m("a-menu"),P=m("a-dropdown");return w(),g(r(G),{onRegister:r(h),title:"角色用户",width:"800",destroyOnClose:""},{default:t(()=>[o(r(j),{onRegister:r(U),rowSelection:T},{tableTitle:t(()=>[f.disableUserEdit?I("",!0):(w(),g(b,{key:0,type:"primary",onClick:E},{default:t(()=>[_(" 新增用户")]),_:1})),o(b,{type:"primary",onClick:M},{default:t(()=>[_(" 已有用户")]),_:1}),i.value.length>0?(w(),g(P,{key:1},{overlay:t(()=>[o(F,null,{default:t(()=>[o(z,{key:"1",onClick:V},{default:t(()=>[o(C,{icon:"bx:bx-unlink"}),_(" 取消关联 ")]),_:1})]),_:1})]),default:t(()=>[o(b,null,{default:t(()=>[_("批量操作 "),o(C,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):I("",!0)]),action:t(({record:$})=>[o(r(A),{actions:W($)},null,8,["actions"])]),_:1},8,["onRegister"]),o(J,{onRegister:r(n),onSuccess:L},null,8,["onRegister"]),o(X,{onRegister:r(S),onSelect:N},null,8,["onRegister"])]),_:1},8,["onRegister"])}}});export{Re as _};
