var Ve=Object.defineProperty;var $e=(n,e,t)=>e in n?Ve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ge=(n,e,t)=>($e(n,typeof e!="symbol"?e+"":e,t),t);import{T as TableAction,h as add}from"./componentMap-a6d21ad6.js";import{A as useModalInner,p as propTypes,E as useModal,f as useDebounceFn,g as getFileAccessHttpUrl,aN as Loading}from"./index-fde9c72f.js";import{B as BasicModal}from"./index-8cf3aabb.js";import{q as usePermissionStore,bW as _export_sfc,bd as MinusCircleFilled,bZ as replaceAll,ad as defHttp,aF as filterMultiDictText,b_ as importViewsFile,c as useUserStore,b$ as PrinterOutlined,c0 as DiffOutlined,aL as FormOutlined,ac as getToken,c1 as goJmReportViewPage,l as useMessage}from"./jeecg-online-vendor-bf2efbcb.js";import{B as BasicForm}from"./BasicForm-83ba9c88.js";import{u as useForm}from"./useForm-fa63344e.js";import"./JAddInput-2cbbbde9.js";import{U as UploadTypeEnum,c as createImgPreview}from"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-0a69d004.js";import{d as duplicateCheck}from"./user.api-dd1b3184.js";import{c as commonjsGlobal}from"./_commonjsHelpers-938fab4e.js";import{C as CustomExpression}from"./customExpression-e22f3cce.js";import{p as pick$1}from"./pick-51214243.js";import BasicTable from"./BasicTable-29c6504d.js";import"./BasicTable.vue_vue_type_style_index_0_lang-b7d11241.js";import"./useTable-7e303edd.js";import{useListPage}from"./useListPage-5049b37a.js";import{k as ref,r as reactive,w as watch,J as toRaw,e as computed,u as unref,d as defineComponent,q as h,bF as useRouter,n as nextTick,s as watchEffect,a4 as markRaw,az as defineAsyncComponent,U as resolveComponent,aV as openBlock,ar as createBlock,as as createElementBlock,f as createVNode,bi as withCtx,E as createTextVNode,ag as toDisplayString,V as createCommentVNode,aQ as mergeProps,at as createBaseVNode,F as Fragment,a_ as renderList,ad as normalizeClass}from"./vue-c7e3516e.js";import{e as dataExports}from"./areaDataUtil-b2642a1f.js";import LinkTableListPiece from"./LinkTableListPiece-50f8f8cc.js";import OnlineSelectCascade from"./OnlineSelectCascade-dee0bae8.js";import JModalTip from"./JModalTip-b651c0e6.js";import{cn as Button,U as PlusOutlined,E as EditOutlined}from"./antd-vue-vendor-1561c1ba.js";class Area{constructor(e){ge(this,"all");e||(e=dataExports);let t=[];const l=e[86];Object.keys(l).map(s=>{t.push({id:s,text:l[s],pid:"86",index:1});const o=e[s];Object.keys(o).map(i=>{t.push({id:i,text:o[i],pid:s,index:2});const b=e[i];b&&Object.keys(b).map(_=>{t.push({id:_,text:b[_],pid:i,index:3})})})}),this.all=t}get pca(){return this.all}getCode(e){if(!e||e.length==0)return"";for(let t of this.all)if(t.text===e)return t.id}getText(e,t=3){if(!e||e.length==0)return"";let l=[];return this.getAreaBycode(e,l,t),l.join("/")}getRealCode(e){let t=[];return this.getPcode(e,t,3),t}getPcode(e,t,l){for(let s of this.all)s.id===e&&s.index==l&&(t.unshift(e),s.pid!="86"&&this.getPcode(s.pid,t,--l))}getAreaBycode(e,t,l){for(let s of this.all)s.id===e&&s.index==l&&(t.unshift(s.text),s.pid!="86"&&this.getAreaBycode(s.pid,t,--l))}}const jeecgAreaData=new Area,getAreaTextByCode=function(n){let e=3;return n&&n.includes(",")&&(e=n.split(",").length,n=n.substr(n.lastIndexOf(",")+1)),jeecgAreaData.getText(n,e)};var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(n,e,t)=>e in n?__defProp(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,__spreadValues=(n,e)=>{for(var t in e||(e={}))__hasOwnProp.call(e,t)&&__defNormalProp(n,t,e[t]);if(__getOwnPropSymbols)for(var t of __getOwnPropSymbols(e))__propIsEnum.call(e,t)&&__defNormalProp(n,t,e[t]);return n},__spreadProps=(n,e)=>__defProps(n,__getOwnPropDescs(e)),__async=(n,e,t)=>new Promise((l,s)=>{var o=_=>{try{b(t.next(_))}catch(P){s(P)}},i=_=>{try{b(t.throw(_))}catch(P){s(P)}},b=_=>_.done?l(_.value):Promise.resolve(_.value).then(o,i);b((t=t.apply(n,e)).next())});const SUBMIT_FLOW_KEY="jeecg_submit_form_and_flow",SUBMIT_FLOW_ID="flow_submit_id",ONL_FORM_TABLE_NAME="online_form_table_name",VALIDATE_FAILED="validate-failed",SETUP="setup",ENHANCEJS="EnhanceJS",FORM_VIEW_TO_QUERY_VIEW={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},POP_CONTAINER=".jeecg-online-modal .ant-modal-content",ONL_AUTH_PRE="online_";class IFormSchema{constructor(e,t){this._data=t,this.field=e,this.label=t.title,this.hidden=!1,this.order=t.order||999,this.required=!1,this.onlyValidator="",this.setFieldsValue="",this.hasChange=!0,e.indexOf("@")>0?this.pre=e.substring(0,e.indexOf("@")+1):this.pre="",this.schemaProp={},this.searchForm=!1,this.disabled=!1,this.popContainer="",this.handleWidgetAttr(t),this.inPopover=!1,this.labelLength=4,this.initLabelLength()}getFormItemSchema(){let e=this.getItem();return this.addDefaultChangeEvent(e),e}getItem(){let e={field:this.field,label:this.label,labelLength:this.labelLength,component:"Input",itemProps:{labelCol:{class:"online-form-label"}}},t=this.getRule();return t.length>0&&this.onlyValidator&&(e.rules=t),this.hidden===!0&&(e.show=!1),e}setFormRef(e){this.formRef=e}isHidden(){return this.hidden=!0,this}isRequired(e){return e&&e.length>0&&e.indexOf(this.field)>=0&&(this.required=!0),this}initLabelLength(){let e=this.getExtendData();e&&e.labelLength&&(this.labelLength=e.labelLength)}getExtendData(){let e={},{fieldExtendJson:t}=this._data;if(t&&typeof t=="string")try{let l=JSON.parse(t);e=__spreadValues({},l)}catch(l){}return e}getRelatedHideFields(){return[]}getPlaceholder(){return"\u8BF7\u8F93\u5165"+this.label}setOnlyValidateFun(e){e&&(this.onlyValidator=(t,l)=>__async(this,null,function*(){let s=yield e(t,l);return s?Promise.reject(s):Promise.resolve()}))}getRule(){let e=[];const{view:t,errorInfo:l,pattern:s,type:o}=this._data;if(this.required===!0){let i=this.getPlaceholder();l&&(i=l),t=="sel_depart"||t=="sel_user"?this.schemaProp.required=!0:e.push({required:!0,message:i})}if(t=="sel_user"&&s==="only"&&this.onlyValidator&&e.push({validator:this.onlyValidator}),t==="list"||t==="radio"||t==="markdown"||t==="pca"||t.indexOf("sel")>=0||t==="time"||t.indexOf("upload")>=0||t.indexOf("file")>=0||t.indexOf("image")>=0)return e;if(s)if(s==="only")this.onlyValidator&&e.push({validator:this.onlyValidator});else if(s==="z")o=="number"||o=="integer"||e.push({pattern:/^-?\d+$/,message:"\u8BF7\u8F93\u5165\u6574\u6570"});else{let i=l||"\u6B63\u5219\u8868\u8FBE\u5F0F\u4E0D\u6B63\u786E";e.push({pattern:s,message:i})}return e}addDefaultChangeEvent(e){this.hasChange&&(e.componentProps||(e.componentProps={}),this.disabled==!0&&(e.componentProps.disabled=!0),e.componentProps.hasOwnProperty("onChange")||(e.componentProps.onChange=(t,l)=>{t instanceof Event&&(t=t.target.value),t instanceof Array&&(t=t.join(",")),!this.formRef||!this.formRef.value||!this.formRef.value.$formValueChange||this.formRef.value.$formValueChange(this.field,t,l)})),Object.keys(this.schemaProp).map(t=>{e[t]=this.schemaProp[t]})}noChange(){this.hasChange=!1}updateField(e){this.field=e}setFunctionForFieldValue(e){e&&(this.setFieldsValue=e)}asSearchForm(){this.searchForm=!0}getModalAsContainer(){let e=this.getPopContainer();return document.querySelector(e)}getPopContainer(){return this.searchForm===!0?"body":this.inPopover===!0?`.${this.popContainer}`:this.popContainer?`.${this.popContainer} .ant-modal-content`:POP_CONTAINER}handleWidgetAttr(e){e.ui&&e.ui.widgetattrs&&e.ui.widgetattrs.disabled==!0&&(this.disabled=!0)}setCustomPopContainer(e){this.popContainer=e}getLinkFieldInfo(){return""}setOtherInfo(e){}isInPopover(){this.inPopover=!0}}class InputWidget extends IFormSchema{getItem(){let e=super.getItem();return this.hidden===!0&&(e.show=!1),e}}var DateFormat=(n=>(n.datetime="YYYY-MM-DD HH:mm:ss",n.date="YYYY-MM-DD",n))(DateFormat||{});class DateWidget extends IFormSchema{constructor(e,t){super(e,t),this.format=DateFormat[t.view],this.showTime=t.view!="date"}getItem(){let e=super.getItem();return Object.assign({},e,{component:"DatePicker",componentProps:{placeholder:`\u8BF7\u9009\u62E9${this.label}`,showTime:this.showTime,valueFormat:this.format,style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()}})}}class SelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum,t.type),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.multi=t.multi||!1}getItem(){let e=super.getItem(),t=this.getFormComponent(),l=this.getComponentProps();return Object.assign({},e,{component:t,componentProps:l})}getFormComponent(){return this.options.length>0?"Select":"JDictSelectTag"}getComponentProps(){let t={allowClear:!0,mode:this.multi===!0?"multiple":"combobox",style:{width:"100%"},getPopupContainer:l=>this.getModalAsContainer()};if(this.options.length>0)t.options=this.options;else if(!this.dictTable)t.dictCode=this.dictCode;else{let l=`${this.dictTable},${this.dictText},${this.dictCode}`;t.dictCode=encodeURI(l)}return t}getOptions(e,t){if(!e||e.length==0)return[];let l=t=="number",s=[];for(let o of e){let i=o.value;l&&(i=parseInt(i)),s.push({value:i,label:o.title})}return s}}class PasswordWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputPassword"})}}class FileWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e=this.getExtendData();return e&&e.uploadnum?{maxCount:Number(e.uploadnum)}:{}}}class ImageWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e={fileType:UploadTypeEnum.image},t=this.getExtendData();return t&&t.uploadnum&&(e.maxCount=Number(t.uploadnum)),e}}class TextAreaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputTextArea",componentProps:{autosize:{minRows:4,maxRows:10}}})}}class SelectMultiWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectMultiple",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};{let e={};if(!this.dictTable)e.dictCode=this.dictCode;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e.triggerChange=!0,e.popContainer=this.getPopContainer(),e}}}class SelectSearchWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=encodeURI(`${t.dictTable},${t.dictText},${t.dictCode}`)}getItem(){let e=super.getItem(),t=this.getPopContainer();return Object.assign({},e,{component:"JSearchSelect",componentProps:{dict:this.dict,pageSize:6,async:!0,popContainer:t}})}}class PopupWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.multi=t.popupMulti,this.fieldConfig=this.getFieldConfig(t)}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JPopup",componentProps:t})}getComponentProps(){let e={code:this.code,multi:this.multi,fieldConfig:this.fieldConfig};return this.formRef?e.formElRef=this.formRef:e.setFieldsValue=this.setFieldsValue,this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}getFieldConfig(e){let{destFields:t,orgFields:l}=e;if(!t||t.length==0)return[];let s=t.split(","),o=l.split(","),i=[];const b=this.pre;for(let _=0;_<s.length;_++)i.push({target:b+s[_],source:o[_]});return i}}class TreeCategoryWidget extends IFormSchema{constructor(e,t){super(e,t),this.multi=!1,this.pid=t.pidValue,this.pcode=t.pcode,this.textField=t.textField}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{componentProps:t,component:"JCategorySelect"})}getComponentProps(){let e={placeholder:"\u8BF7\u9009\u62E9"+this.label};if(this.pcode)e.pcode=this.pcode;else{let t=this.pid||"EMPTY_PID";e.pid=t}return this.textField?__spreadProps(__spreadValues({loadTriggleChange:!0,multiple:this.multi},e),{back:this.textField,onChange:(t,l)=>{this.formRef&&(this.formRef.value.setFieldsValue(l),this.formRef.value.$formValueChange(this.field,t))}}):__spreadValues({multiple:this.multi},e)}getRelatedHideFields(){let e=[];return this.textField&&e.push(this.textField),e}}class SelectDepartWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectDept",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={checkStrictly:!0,showButton:!1};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.multiple=!1),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class SelectUserWidget extends IFormSchema{constructor(e,t){super(e,t),this.showButton=t.showButton!==!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectUser",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={showSelected:!1,allowClear:!0,isRadioSelection:!1,showButton:this.showButton};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.isRadioSelection=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class EditorWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JEditor",componentProps:{options:{auto_focus:!1}}})}}class MarkdownWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JMarkdownEditor",componentProps:{}})}}class PcaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JAreaSelect"})}}class TreeSelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=t.dict,this.pidField=t.pidField,this.pidValue=t.pidValue}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JTreeSelect",componentProps:{dict:this.dict,pidField:this.pidField,pidValue:this.pidValue}})}}class RadioWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JDictSelectTag",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};if(this.dictTable){let e=`${this.dictTable},${this.dictText},${this.dictCode}`;return{dictCode:encodeURI(e),type:"radio"}}else return{dictCode:this.dictCode,type:"radio"}}}class CheckboxWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum)}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JCheckbox",componentProps:{options:this.options,triggerChange:!0}})}getOptions(e){if(!e||e.length==0)return[];let t=[];for(let l of e)t.push({value:l.value,label:l.title});return t}}class SwitchWidget extends IFormSchema{constructor(e,t){super(e,t),this.hasChange=!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSwitch",componentProps:t})}getComponentProps(){let{fieldExtendJson:e}=this._data,t=["Y","N"];if(e&&typeof e=="string"){let l=JSON.parse(e);l.length==2&&(t=l)}return{options:t}}}class TimeWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"TimePicker",componentProps:{placeholder:`\u8BF7\u9009\u62E9${this.label}`,valueFormat:"HH:mm:ss",getPopupContainer:t=>this.getModalAsContainer(),style:{width:"100%"}}})}}class LinkDownWidget extends IFormSchema{constructor(e,t){super(e,t);const{dictTable:l,dictText:s,dictCode:o,pidField:i,idField:b,origin:_,condition:P}=t;this.table=l,this.txt=s,this.store=o,this.idField=b,this.pidField=i,this.origin=_,this.condition=P,this.options=[],this.next=t.next||"",this.type=t.type}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"OnlineSelectCascade",componentProps:t})}getComponentProps(){let e={table:this.table,txt:this.txt,store:this.store,pidField:this.pidField,idField:this.idField,origin:this.origin,pidValue:"-1",style:{width:"100%"},onChange:t=>{this.valueChange(t)},onNext:t=>{this.nextOptionsChange(t)}};return this._data.origin===!0&&(e.condition=this.condition),e}nextOptionsChange(e){return __async(this,null,function*(){if(!this.formRef||!this.next)return;yield this.formRef.value.updateSchema({field:this.next,componentProps:{pidValue:e}})})}valueChange(e){return __async(this,null,function*(){if(!this.formRef||!this.next)return;let t=this.formRef.value;t.$formValueChange(this.field,e),yield t.setFieldsValue({[this.next]:""})})}}class SlotWidget extends IFormSchema{constructor(e,t){super(e,t),this.slot=""}getItem(){let e=super.getItem(),t=this.slot;return Object.assign({},e,{slot:t})}groupDate(){return this.slot="groupDate",this}groupDatetime(){return this.slot="groupDatetime",this}groupNumber(){return this.slot="groupNumber",this}}class NumberWidget extends IFormSchema{constructor(e,t){super(e,t),this.dbPointLength=t.dbPointLength}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"InputNumber",componentProps:t})}getComponentProps(){const e={style:{width:"100%"}};return this.dbPointLength>=0&&(e.precision=this.dbPointLength),e}}class LinkTableWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.view=t.view,this.componentString="",this.linkFields=[]}getItem(){let e=super.getItem();const t=this.getComponentProps();return Object.assign({},e,{component:this.componentString,componentProps:t})}getComponentProps(){let e={textField:this.dictText,tableName:this.dictTable,valueField:this.dictCode},t=this.getExtendData();if(t.multiSelect?e.multi=!0:e.multi=!1,t.imageField?e.imageField=t.imageField:e.imageField="",t.showType=="select"){this.componentString="LinkTableSelect";let l=this.getPopContainer();e.popContainer=l}else this.componentString="LinkTableCard";return this.linkFields.length>0&&(e.linkFields=this.linkFields),e}setOtherInfo(e){this.linkFields=e}}class LinkTableFieldWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText}getItem(){let e=super.getItem();return Object.assign({},e,{componentProps:{readOnly:!0,allowClear:!1,disabled:!0,style:{background:"none",color:"rgba(0, 0, 0, 0.85)",border:"none"}}})}getLinkFieldInfo(){return[this.dictTable,`${this.field},${this.dictText}`]}}class LinkTableForQueryWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.titleField=t.titleField,this.multi=t.multi||!1}getItem(){let e=super.getItem();return Object.assign({},e,{component:"LinkTableForQuery",componentProps:{code:this.code,multi:this.multi,field:this.titleField,style:{width:"100%"}}})}}class CascaderPcaForQueryWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"CascaderPcaForQuery",componentProps:{style:{width:"100%"}}})}}class SelectUser2Widget extends IFormSchema{constructor(e,t){super(e,t),this.multi=t.multi===!0,this.store=t.store||"",this.query=t.query||!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"UserSelect",componentProps:t})}getComponentProps(){let e={multi:this.multi,store:this.store,query:this.query};return this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}}class RangeWidget extends IFormSchema{constructor(e,t){super(e,t);let l=t.view;this.format=t.format,this.datetime=!1,l==="rangeNumber"?this.componentType="JRangeNumber":l==="rangeTime"?this.componentType="RangeTime":(this.componentType="RangeDate",t.datetime===!0&&(this.datetime=!0))}getItem(){let e=super.getItem();return Object.assign({},e,{component:this.componentType,componentProps:{datetime:this.datetime,format:this.format,getPopupContainer:t=>this.getModalAsContainer()}})}}class FormSchemaFactory{static createFormSchema(e,t){switch(t.view){case"password":return new PasswordWidget(e,t);case"list":return new SelectWidget(e,t);case"radio":return new RadioWidget(e,t);case"checkbox":return new CheckboxWidget(e,t);case"date":case"datetime":return new DateWidget(e,t);case"time":return new TimeWidget(e,t);case"file":return new FileWidget(e,t);case"image":return new ImageWidget(e,t);case"textarea":return new TextAreaWidget(e,t);case"list_multi":return new SelectMultiWidget(e,t);case"sel_search":return new SelectSearchWidget(e,t);case"popup":return new PopupWidget(e,t);case"cat_tree":return new TreeCategoryWidget(e,t);case"sel_depart":return new SelectDepartWidget(e,t);case"sel_user":return new SelectUserWidget(e,t);case"umeditor":return new EditorWidget(e,t);case"markdown":return new MarkdownWidget(e,t);case"pca":return new PcaWidget(e,t);case"link_down":return new LinkDownWidget(e,t);case"sel_tree":return new TreeSelectWidget(e,t);case"switch":return new SwitchWidget(e,t);case"link_table":return new LinkTableWidget(e,t);case"link_table_field":return new LinkTableFieldWidget(e,t);case"slot":return new SlotWidget(e,t);case"LinkTableForQuery":return new LinkTableForQueryWidget(e,t);case"CascaderPcaForQuery":return new CascaderPcaForQueryWidget(e,t);case"select_user2":return new SelectUser2Widget(e,t);case"rangeDate":case"rangeTime":case"rangeNumber":return new RangeWidget(e,t);case"hidden":return new InputWidget(e,t).isHidden();default:return t.type=="number"?new NumberWidget(e,t):new InputWidget(e,t)}}static createSlotFormSchema(e,t){let l=new SlotWidget(e,t),s=t.view;if(s=="date")l.groupDate();else if(s=="datetime")l.groupDatetime();else{let o=t.type;(o=="number"||o=="integer")&&l.groupNumber()}return l}static createIdField(){return{label:"",field:"id",component:"Input",show:!1}}}var dayjs_min={exports:{}};(function(n,e){(function(t,l){n.exports=l()})(commonjsGlobal,function(){var t=1e3,l=6e4,s=36e5,o="millisecond",i="second",b="minute",_="hour",P="day",w="week",S="month",B="quarter",y="year",A="date",k="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,O=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,V={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var a=["th","st","nd","rd"],r=c%100;return"["+c+(a[(r-20)%10]||a[r]||a[0])+"]"}},T=function(c,a,r){var f=String(c);return!f||f.length>=a?c:""+Array(a+1-f.length).join(r)+c},$={s:T,z:function(c){var a=-c.utcOffset(),r=Math.abs(a),f=Math.floor(r/60),m=r%60;return(a<=0?"+":"-")+T(f,2,"0")+":"+T(m,2,"0")},m:function c(a,r){if(a.date()<r.date())return-c(r,a);var f=12*(r.year()-a.year())+(r.month()-a.month()),m=a.clone().add(f,S),v=r-m<0,I=a.clone().add(f+(v?-1:1),S);return+(-(f+(r-m)/(v?m-I:I-m))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:S,y,w,d:P,D:A,h:_,m:b,s:i,ms:o,Q:B}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},W="en",j={};j[W]=V;var N=function(c){return c instanceof E},g=function c(a,r,f){var m;if(!a)return W;if(typeof a=="string"){var v=a.toLowerCase();j[v]&&(m=v),r&&(j[v]=r,m=v);var I=a.split("-");if(!m&&I.length>1)return c(I[0])}else{var J=a.name;j[J]=a,m=J}return!f&&m&&(W=m),m||!f&&W},C=function(c,a){if(N(c))return c.clone();var r=typeof a=="object"?a:{};return r.date=c,r.args=arguments,new E(r)},F=$;F.l=g,F.i=N,F.w=function(c,a){return C(c,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var E=function(){function c(r){this.$L=g(r.locale,null,!0),this.parse(r)}var a=c.prototype;return a.parse=function(r){this.$d=function(f){var m=f.date,v=f.utc;if(m===null)return new Date(NaN);if(F.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var I=m.match(R);if(I){var J=I[2]-1||0,H=(I[7]||"0").substring(0,3);return v?new Date(Date.UTC(I[1],J,I[3]||1,I[4]||0,I[5]||0,I[6]||0,H)):new Date(I[1],J,I[3]||1,I[4]||0,I[5]||0,I[6]||0,H)}}return new Date(m)}(r),this.$x=r.x||{},this.init()},a.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},a.$utils=function(){return F},a.isValid=function(){return this.$d.toString()!==k},a.isSame=function(r,f){var m=C(r);return this.startOf(f)<=m&&m<=this.endOf(f)},a.isAfter=function(r,f){return C(r)<this.startOf(f)},a.isBefore=function(r,f){return this.endOf(f)<C(r)},a.$g=function(r,f,m){return F.u(r)?this[f]:this.set(m,r)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(r,f){var m=this,v=!!F.u(f)||f,I=F.p(r),J=function(L,U){var Q=F.w(m.$u?Date.UTC(m.$y,U,L):new Date(m.$y,U,L),m);return v?Q:Q.endOf(P)},H=function(L,U){return F.w(m.toDate()[L].apply(m.toDate("s"),(v?[0,0,0,0]:[23,59,59,999]).slice(U)),m)},Y=this.$W,K=this.$M,ee=this.$D,X="set"+(this.$u?"UTC":"");switch(I){case y:return v?J(1,0):J(31,11);case S:return v?J(1,K):J(0,K+1);case w:var te=this.$locale().weekStart||0,ne=(Y<te?Y+7:Y)-te;return J(v?ee-ne:ee+(6-ne),K);case P:case A:return H(X+"Hours",0);case _:return H(X+"Minutes",1);case b:return H(X+"Seconds",2);case i:return H(X+"Milliseconds",3);default:return this.clone()}},a.endOf=function(r){return this.startOf(r,!1)},a.$set=function(r,f){var m,v=F.p(r),I="set"+(this.$u?"UTC":""),J=(m={},m[P]=I+"Date",m[A]=I+"Date",m[S]=I+"Month",m[y]=I+"FullYear",m[_]=I+"Hours",m[b]=I+"Minutes",m[i]=I+"Seconds",m[o]=I+"Milliseconds",m)[v],H=v===P?this.$D+(f-this.$W):f;if(v===S||v===y){var Y=this.clone().set(A,1);Y.$d[J](H),Y.init(),this.$d=Y.set(A,Math.min(this.$D,Y.daysInMonth())).$d}else J&&this.$d[J](H);return this.init(),this},a.set=function(r,f){return this.clone().$set(r,f)},a.get=function(r){return this[F.p(r)]()},a.add=function(r,f){var m,v=this;r=Number(r);var I=F.p(f),J=function(K){var ee=C(v);return F.w(ee.date(ee.date()+Math.round(K*r)),v)};if(I===S)return this.set(S,this.$M+r);if(I===y)return this.set(y,this.$y+r);if(I===P)return J(1);if(I===w)return J(7);var H=(m={},m[b]=l,m[_]=s,m[i]=t,m)[I]||1,Y=this.$d.getTime()+r*H;return F.w(Y,this)},a.subtract=function(r,f){return this.add(-1*r,f)},a.format=function(r){var f=this,m=this.$locale();if(!this.isValid())return m.invalidDate||k;var v=r||"YYYY-MM-DDTHH:mm:ssZ",I=F.z(this),J=this.$H,H=this.$m,Y=this.$M,K=m.weekdays,ee=m.months,X=function(U,Q,Z,D){return U&&(U[Q]||U(f,v))||Z[Q].slice(0,D)},te=function(U){return F.s(J%12||12,U,"0")},ne=m.meridiem||function(U,Q,Z){var D=U<12?"AM":"PM";return Z?D.toLowerCase():D},L={YY:String(this.$y).slice(-2),YYYY:this.$y,M:Y+1,MM:F.s(Y+1,2,"0"),MMM:X(m.monthsShort,Y,ee,3),MMMM:X(ee,Y),D:this.$D,DD:F.s(this.$D,2,"0"),d:String(this.$W),dd:X(m.weekdaysMin,this.$W,K,2),ddd:X(m.weekdaysShort,this.$W,K,3),dddd:K[this.$W],H:String(J),HH:F.s(J,2,"0"),h:te(1),hh:te(2),a:ne(J,H,!0),A:ne(J,H,!1),m:String(H),mm:F.s(H,2,"0"),s:String(this.$s),ss:F.s(this.$s,2,"0"),SSS:F.s(this.$ms,3,"0"),Z:I};return v.replace(O,function(U,Q){return Q||L[U]||I.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(r,f,m){var v,I=F.p(f),J=C(r),H=(J.utcOffset()-this.utcOffset())*l,Y=this-J,K=F.m(this,J);return K=(v={},v[y]=K/12,v[S]=K,v[B]=K/3,v[w]=(Y-H)/6048e5,v[P]=(Y-H)/864e5,v[_]=Y/s,v[b]=Y/l,v[i]=Y/t,v)[I]||Y,m?K:F.a(K)},a.daysInMonth=function(){return this.endOf(S).$D},a.$locale=function(){return j[this.$L]},a.locale=function(r,f){if(!r)return this.$L;var m=this.clone(),v=g(r,f,!0);return v&&(m.$L=v),m},a.clone=function(){return F.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},c}(),d=E.prototype;return C.prototype=d,[["$ms",o],["$s",i],["$m",b],["$H",_],["$W",P],["$M",S],["$y",y],["$D",A]].forEach(function(c){d[c[1]]=function(a){return this.$g(a,c[0],c[1])}}),C.extend=function(c,a){return c.$i||(c(a,E,C),c.$i=!0),C},C.locale=g,C.isDayjs=N,C.unix=function(c){return C(1e3*c)},C.en=j[W],C.Ls=j,C.p={},C})})(dayjs_min);var dayjs=dayjs_min.exports;const ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(n=>CustomExpression[n]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(n,e,t){hasEffectiveValue(e.defVal)&&t.push({field:n,type:e.type,value:e.defVal})}function initSubTableDefValueConfig(n,e){hasEffectiveValue(n.fieldDefaultValue)&&e.push({field:n.key,type:n.type,value:n.fieldDefaultValue})}function loadFormFieldsDefVal(n,e,t){return __async(this,null,function*(){if(Array.isArray(n)&&n.length>0){let l={};for(let s of n){let{value:o,type:i,field:b}=s;o=yield handleDefaultValue(o,ACTION_TYPES.ADD,t||{}),i==="number"&&o&&(o=Number.parseFloat(o)),l[b]=o}e(l)}})}function loadOneFieldDefVal(n,e,t){return __async(this,null,function*(){let{defVal:l,type:s}=e;if(hasEffectiveValue(l)){let o=yield handleDefaultValue(l,ACTION_TYPES.ADD,{});s==="number"&&o&&(o=Number.parseFloat(o)),t[n]=o}})}function hasEffectiveValue(n){return!!(n||n===0)}function handleDefaultValue(n,e,t){return __async(this,null,function*(){if(n!=null&&checkExpressionType(n)){let l=yield getDefaultValue(n,e,t);if(l!=null)return l}return n})}function checkExpressionType(n){let e=0,t=0,l=0;if(n.replace(fillRuleRegExp,()=>l++),l>1)return`${n}`,!1;n.replace(normalRegExp,()=>e++),n.replace(customRegExp,()=>t++);let s=e+t;return l>0&&s>0?(`${n}`,!1):!0}function getRegExpMap(n,e){let t=new Map;return n.replace(e,function(l,s){return t.set(l,s.trim()),l}),t}function getDefaultValue(n,e,t){return __async(this,null,function*(){return(e===ACTION_TYPES.ADD||e===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(n)?yield executeRegExp(n,fillRuleRegExp,executeFillRuleExpression,[t]):e===ACTION_TYPES.ADD?(n=yield executeRegExp(n,normalRegExp,executeNormalExpression),n=yield executeRegExp(n,customRegExp,executeCustomExpression),n):null})}function executeRegExp(n,e,t){return __async(this,arguments,function*(l,s,o,i=[]){let b=getRegExpMap(l,s);for(let _ of b.keys()){let P=b.get(_),w=yield o.apply(null,[P,_,...i]);if(_===l)return w;l=replaceAll(l,_,w)}return l})}function executeNormalExpression(n,e){return __async(this,null,function*(){switch(n){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let t=getUserInfoByExpression(n);return t!=null?t:e}})}function getUserInfoByExpression(n){let t=useUserStore().getUserInfo;if(t)switch(n){case"sysUserId":return t.id;case"sysUserCode":case"sys_user_code":return t.username;case"sysUserName":return t.realname;case"sysOrgCode":case"sys_org_code":return t.orgCode}return null}function executeCustomExpression(expression,origin){return __async(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(n){return origin}})}function executeFillRuleExpression(n,e,t){return __async(this,null,function*(){let l=`/sys/fillRule/executeRuleByCode/${n}`,s={};typeof t=="function"?s=t():t&&(s=__spreadValues({},t));let{success:o,message:i,result:b}=yield defHttp.put({url:l,params:s},{isTransformResponse:!1});return o?b:(`${n}${i}`,e)})}function logWarn(n){}function logError(n){}const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(n,e){useExtendComponent();const t=n.modalClass,l=ref([]),s=ref(""),o=ref({}),i=reactive({}),b=ref(!1),_=ref([]),P=ref({}),w={},S=ref([]),B=reactive({}),y=ref("");y.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function A(T,$,W){clearObj(B),B[s.value]=[];let j=[],N=[],g=[],C={},F={};Object.keys(T).map(d=>{const c=T[d];if(c.view=="tab"){b.value=!0,B[d]=[];let a={key:d,foreignKey:c.foreignKey,describe:c.describe,relationType:c.relationType,requiredFields:c.required||[],order:c.order,id:c.id};c.relationType==1?(w[d]=ref(null),a.properties=c.properties):(k(c),w[d]=ref(),a.columns=c.columns,C[d]=[]),j.push(a),handleSubTableButtonAuth(d,c)}else if(initDefValueConfig(d,c,B[s.value]),c.view===LINK_DOWN){let a=handleLinkDown(c,d);for(let r of a){i[r.key]=!0,i[r.key+"_load"]=!0;let f=FormSchemaFactory.createFormSchema(r.key,r);W&&f.setOnlyValidateFun(W),f.isRequired($),f.setFormRef(e),f.handleWidgetAttr(c);let m=getFieldIndex(N,r.key);m==-1?N.push(f):N[m]=f}}else if(i[d]=!0,i[d+"_load"]=!0,getFieldIndex(N,d)==-1){let r=FormSchemaFactory.createFormSchema(d,c);if(W&&r.setOnlyValidateFun(W),r.isRequired($),r.setFormRef(e),N.push(r),g.push(...r.getRelatedHideFields()),c.view===LINK_TABLE_FIELD){let f=r.getLinkFieldInfo();f&&(F[f[0]]?F[f[0]].push(f[1]):F[f[0]]=[f[1]])}}}),N.sort(function(d,c){return d.order-c.order});let E=[];E.push(FormSchemaFactory.createIdField());for(let d of N)d.view&&d.view==LINK_TABLE&&F[d.field]&&d.setOtherInfo(F[d.field]),g.indexOf(d.field)>=0&&d.isHidden(),t&&d.setCustomPopContainer(t),E.push(d.getFormItemSchema());l.value=E,j.sort(function(d,c){return d.order-c.order}),_.value=j,P.value=C}watch(i,T=>{let $=e.value,W=[],j=toRaw(T);Object.keys(j).map(N=>{if(!N.endsWith("_load")){let g={field:N,show:j[N]},C=N+"_load";j.hasOwnProperty(C)&&(g.ifShow=j[C]),W.push(g)}}),$&&$.updateSchema(W)},{immediate:!1});function k(T){useOnlineVxeTableColumns(T,$=>{initSubTableDefValueConfig($,B[T.key])})}watch(()=>n.formTemplate,()=>{y.value=R()},{immediate:!0});function R(){let T=n.formTemplate;return T==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:T==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:T==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{sm:24,xs:24,md:24,lg:24,xl:24,xxl:24}}function O(T,$){return new Promise(W=>{$||W("");let N={tableName:s.value.replace(/\$\d+/,""),fieldName:T.field,fieldVal:$},g=o.value;g.id&&(N.dataId=g.id),duplicateCheck(N).then(C=>{C.success?W(""):W(C.message)}).catch(C=>{W(C)})})}function V(T){return Object.keys(T).map($=>{T[$]&&T[$]instanceof Array&&(T[$]=T[$].join(","))}),T}return{formSchemas:l,defaultValueFields:B,tableName:s,dbData:o,checkOnlyFieldValue:O,createFormSchemas:A,fieldDisplayStatus:i,subTabInfo:_,hasSubTable:b,subDataSource:P,baseColProps:y,changeDataIfArray2String:V,linkDownList:S,refMap:w}}function useOnlineVxeTableColumns(n,e){const t={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};n.columns.forEach(o=>{o.type==="radio"?o.type="select":t[o.type]?o.type=t[o.type]:o.type==="popup"&&l(o),o.type==="depart-select"&&(o.checkStrictly=!0),o.type==="user-select"&&s(o),o.type==="pca"&&(o.width="230px"),(o.width==120||o.width=="120px")&&(o.type=="image"||o.type=="file")&&(o.width="130px"),o.width||(o.width="200px"),e&&e(o)});function l(o){let{destFields:i,orgFields:b}=o,_=[];if(!(!i||i.length==0)){let P=i.split(","),w=b.split(",");for(let S=0;S<P.length;S++)_.push({target:P[S],source:w[S]})}o.fieldConfig=_}function s(o){let i=o.fieldExtendJson,b=!1;if(i)try{JSON.parse(i).multiSelect===!1&&(b=!0)}catch(_){}o.isRadioSelection=b}}function useOnlineFormContext(){let n={};const e={addSubRows:"<m> \u4E00\u5BF9\u591A\u5B50\u8868\uFF0C\u65B0\u589E\u81EA\u5B9A\u4E49\u884C",changeOptions:"<m> \u6539\u53D8\u4E0B\u62C9\u6846\u9009\u9879",clearSubRows:"<m> \u6E05\u7A7A\u4E00\u5BF9\u591A\u5B50\u8868\u884C",clearThenAddRows:"<m> \u6E05\u7A7A\u4E00\u5BF9\u591A\u5B50\u8868\u884C\uFF0C\u7136\u540E\u65B0\u589E\u81EA\u5B9A\u4E49\u884C",executeMainFillRule:"<m> \u5237\u65B0\u4E3B\u8868\u7684\u589E\u503C\u89C4\u5236\u503C",executeSubFillRule:"<m> \u5237\u65B0\u5B50\u8868\u7684\u589E\u503C\u89C4\u5236\u503C",getFieldsValue:"<m> \u83B7\u53D6\u8868\u5355\u63A7\u4EF6\u7684\u503C",getSubTableInstance:"<m> \u83B7\u53D6\u5B50\u8868\u5B9E\u4F8B",isUpdate:"<p> \u5224\u65AD\u662F\u5426\u4E3A\u7F16\u8F91\u6A21\u5F0F",loading:"<p> \u9875\u9762\u52A0\u8F7D\u72B6\u6001",onlineFormRef:"<p> \u5F53\u524D\u8868\u5355ref\u5BF9\u8C61",refMap:"<p> \u5B50\u8868ref\u5BF9\u8C61map",setFieldsValue:"<m> \u8BBE\u7F6E\u8868\u5355\u63A7\u4EF6\u7684\u503C",sh:"<p> \u8868\u5355\u63A7\u4EF6\u7684\u663E\u793A\u9690\u85CF\u72B6\u6001",subActiveKey:"<p> \u5B50\u8868\u6FC0\u6D3Btab\uFF0C\u5BF9\u5E94\u5B50\u8868\u8868\u540D",subFormHeight:"<p> \u4E00\u5BF9\u4E00\u5B50\u8868\u8868\u5355\u9AD8\u5EA6",submitFlowFlag:"<p> \u662F\u5426\u63D0\u4EA4\u6D41\u7A0B\u72B6\u6001",subTableHeight:"<p> \u4E00\u5BF9\u591A\u5B50\u8868\u8868\u683C\u9AD8\u5EA6",tableName:"<p> \u5F53\u524D\u8868\u540D",triggleChangeValues:"<m> \u4FEE\u6539\u591A\u4E2A\u8868\u5355\u503C",triggleChangeValue:"<m> \u4FEE\u6539\u8868\u5355\u503C",updateSchema:"<m> \u4FEE\u6539\u8868\u5355\u63A7\u4EF6\u914D\u7F6E"},t=new Proxy(e,{get(o,i){return Reflect.get(n,i)}});function l(o,i){n[o]=i}function s(o){Object.keys(o).map(i=>{n[i]=o[i]})}return l("$nextTick",nextTick),l("addObject2Context",l),{onlineFormContext:t,addObject2Context:l,resetContext:s}}function handleLinkDown(n,e){const{config:{table:t,key:l,txt:s,linkField:o,idField:i,pidField:b,condition:_},others:P,order:w,title:S}=n;let B={dictTable:t,dictText:s,dictCode:l,pidField:b,idField:i,view:LINK_DOWN,type:n.type},y=[],A=__spreadValues({key:e,title:S,order:w,condition:_,origin:!0},B);if(o&&o.length>0){let k=o.split(",");A.next=k[0];for(let R=0;R<k.length;R++)for(let O of P)if(O.field==k[R]){let V=__spreadValues({key:O.field,title:O.title,order:O.order,origin:!1},B);R+1<k.length&&(V.next=k[R+1]),y.push(V)}}return y.push(A),y}function getFieldIndex(n,e){let t=-1;for(let l=0;l<n.length;l++)if(n[l].field===e){t=l;break}return t}function getRefPromise(n){return new Promise(e=>{(function t(){let l=n.value;l?e(l):setTimeout(()=>{t()},100)})()})}function clearObj(n){Object.keys(n).map(e=>{delete n[e]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(n,e){let t=e.hideButtons,l=ONL_AUTH_PRE+n+":";t||(t=[]),permissionStore.setOnlineSubTableAuth(l,t)}function getDetailFormSchemas(n){const e=ref([]),t={},l=reactive({}),s=ref(!1),o=ref([]),i=ref({}),b=computed(()=>{let B=n.formTemplate;return B=="2"?12:B=="3"?8:B=="4"?6:24});function _(B){let y=[],A=[],k={};Object.keys(B).map(R=>{const O=B[R];if(O.view=="tab"){s.value=!0;let V={key:R,foreignKey:O.foreignKey,describe:O.describe,relationType:O.relationType,requiredFields:O.required||[],order:O.order};O.relationType==1?(t[R]=ref(null),V.properties=O.properties):(P(O),t[R]=ref(),V.columns=O.columns,k[R]=[],l[R]=!1),y.push(V)}else if(O.view===LINK_DOWN){let V=S(O,R);for(let T of V){let $=w(A,T.key),W={field:T.key,label:T.title,view:T.view,order:T.order,dictTable:T.dictTable,linkField:T.linkField||""};$==-1?A.push(W):A[$]=W}}else if(O.view!="hidden"){if(w(A,R)==-1){let T=Object.assign({field:R,label:O.title},pick$1(O,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(O.view=="file"&&(T.span=24,T.isFile=!0),O.view=="image"&&(T.span=24,T.isImage=!0),O.view=="link_table"&&O.fieldExtendJson)try{let $=JSON.parse(O.fieldExtendJson);$.showType!="select"&&(T.isCard=!0),$.multiSelect==!0&&(T.multi=!0)}catch($){}(O.view=="umeditor"||O.view=="markdown")&&(T.isHtml=!0,T.span=24),A.push(T)}}}),A.sort(function(R,O){return R.order-O.order}),y.sort(function(R,O){return R.order-O.order}),o.value=y;for(let R=0;R<A.length;R++){let O=A[R];if((O.isFile===!0||O.isImage===!0||O.isHtml===!0)&&R>0){let V=A[R-1],T=V.span||b.value;V.span=T}}e.value=A,i.value=k}function P(B){useOnlineVxeTableColumns(B)}function w(B,y){let A=-1;for(let k=0;k<B.length;k++)if(B[k].field===y){A=k;break}return A}function S(B,y){let A=[];const{config:{table:k,key:R,txt:O,linkField:V},order:T,title:$,others:W}=B;let j={table:k,key:R,txt:O},N={view:"link_down",order:T,title:$,dictTable:JSON.stringify(j)};if(A.push(Object.assign({},{linkField:V,key:y},N)),V){let g=V.split(",");for(let C of g){let F="";for(let E of W)E.field==C&&(F=E.title);A.push(Object.assign({},{key:C},N,{title:F}))}}return A}return{detailFormSchemas:e,hasSubTable:s,subTabInfo:o,refMap:t,showStatus:l,createFormSchemas:_,formSpan:b,subDataSource:i}}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(n,e)=>defHttp.get({url:n,params:e},{isTransformResponse:!1}),postAction=(n,e)=>defHttp.post({url:n,params:e},{isTransformResponse:!1}),putAction=(n,e)=>defHttp.put({url:n,params:e},{isTransformResponse:!1}),deleteAction=(n,e)=>defHttp.delete({url:n,params:e},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(n,e){EnhanceJS&&EnhanceJS[e]&&EnhanceJS[e](n)}function customBeforeSubmit(n,e){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(n,e):Promise.resolve()}function beforeDelete(n,e){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(n,e):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeDelete?e.beforeDelete(onlineTableContext,n):Promise.resolve()},onlineTableContext.beforeEdit=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeEdit?e.beforeEdit(onlineTableContext,n):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(n,{emit:e}){const t=ref(null),l=ref(!1),{formSchemas:s,defaultValueFields:o,changeDataIfArray2String:i,tableName:b,dbData:_,checkOnlyFieldValue:P,fieldDisplayStatus:w,createFormSchemas:S,baseColProps:B}=useFormItems(n,t),[y,{setProps:A,validate:k,resetFields:R,setFieldsValue:O,getFieldsValue:V}]=useForm({schemas:s,showActionButtonGroup:!1,baseColProps:B});watch(()=>n.table,()=>{b.value=n.table},{immediate:!0}),watch(()=>n.properties,d=>{l.value=!1,T(),S(n.properties,n.requiredFields,P),l.value=!0},{deep:!0,immediate:!0}),watch(()=>n.mainId,d=>{setTimeout(()=>{W()},100)},{immediate:!0}),watch(()=>n.disabled,d=>{A({disabled:d})});function T(){return __async(this,null,function*(){let d=yield getRefPromise(t);d.$formValueChange=(c,a)=>{let r={[c]:a};e("formChange",r)}})}function $(){if(unref(n.isUpdate)===!1){let d=toRaw(o[b.value]);loadFormFieldsDefVal(d,c=>{O(c)})}}function W(){return __async(this,null,function*(){yield getRefPromise(l),yield R(),$();const{table:d,mainId:c}=n;if(!d||!c)return;let a=yield j(d,c);_.value=a,yield O(a)})}function j(d,c){let a=`${baseUrl}/${d}/${c}`;return new Promise((r,f)=>{defHttp.get({url:a},{isTransformResponse:!1}).then(m=>{m.success?r(m.result):f()})}).finally(()=>{_.value=""})}function N(){return new Promise((d,c)=>{k().then(()=>{let a=V();a=i(a),d(a)}).catch(a=>{c(a)})})}function g(){let d=V();return d.id||(d.id="sub-change-temp-id"),{row:d,target:E}}function C(d){O(d)}function F(){let d=V(),c=toRaw(o[b.value]);loadFormFieldsDefVal(c,a=>{O(a)},d)}const E={onlineFormRef:t,baseColProps:B,formSchemas:s,registerForm:y,setFieldsValue:O,getFieldsValue:V,getFormEvent:g,setValues:C,getAll:N,executeFillRule:F,sh:w};return E}};function _sfc_render$5(n,e,t,l,s,o){const i=resolveComponent("BasicForm");return openBlock(),createBlock(i,{ref:"onlineFormRef",onRegister:n.registerForm},null,8,["onRegister"])}var OnlineSubForm=_export_sfc(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"}));const urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading,OnlineSubForm,PrinterOutlined,DiffOutlined,FormOutlined},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0},isVxeTableData:{type:Boolean,default:!1}},emits:["success","rendered","dataChange"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),[l,{openModal:s}]=useModal(),o=ref(""),i=ref(null),b=ref(!0),_=ref(!1),P=ref(1),w=ref(!1),S=ref(!1),B=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:y,resetContext:A}=useOnlineFormContext(),{formSchemas:k,defaultValueFields:R,changeDataIfArray2String:O,tableName:V,dbData:T,checkOnlyFieldValue:$,hasSubTable:W,subTabInfo:j,refMap:N,subDataSource:g,baseColProps:C,createFormSchemas:F,fieldDisplayStatus:E}=useFormItems(n,i);let{EnhanceJS:d,initCgEnhanceJs:c}=useEnhance(y,!1);const[a,{setProps:r,validate:f,resetFields:m,setFieldsValue:v,updateSchema:I,getFieldsValue:J,scrollToField:H}]=useForm({schemas:k,showActionButtonGroup:!1,baseColProps:C}),Y=ref(!1);function K(){let u=n.disabled;Y.value=u,r({disabled:u})}function ee(u,p,x){return __async(this,null,function*(){yield m(),T.value="";let M=unref(u);S.value=M,M&&(yield te(p)),yield nextTick(()=>{!M&&x&&v(x),X(),ue("js","loaded"),K()})})}function X(){if(unref(S)===!1){let u=toRaw(R[V.value]);loadFormFieldsDefVal(u,p=>{v(p)})}}function te(u){return __async(this,null,function*(){let p=yield L(u.id);(!p||Object.keys(p).length==0)&&(p=__spreadValues({},toRaw(u))),T.value=Object.assign({},p);let x=ne.value,M=pick$1(p,...x);n.isVxeTableData===!0&&(M=Object.assign({},M,u)),yield v(M)})}let ne=computed(()=>{let u=k.value,p=[];for(let x of u)p.push(x.field);return p});function L(u){let p=`${urlObject.optPre}${n.id}/${u}`;return new Promise((x,M)=>{defHttp.get({url:p},{isTransformResponse:!1}).then(q=>{q.success?x(q.result):(M(),t.warning(q.message))}).catch(()=>{M()})})}function U(u){return __async(this,null,function*(){P.value=u.head.tableType,V.value=u.head.tableName,b.value=u.head.tableType==1,Q(u.head.extConfigJson),F(u.schema.properties,u.schema.required,$),d=c(u.enhanceJs),e("rendered",B);let p=yield getRefPromise(i);p.$formValueChange=(x,M,q)=>{xe(x,M),q&&v(q)}})}function Q(u){let p={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};u&&(p=JSON.parse(u)),Object.keys(p).map(x=>{B[x]=p[x]})}function Z(){b.value===!0?se():D()}function D(){z().then(u=>{re(u)})}function z(){let u={};return new Promise((p,x)=>{f().then(M=>p(M),({errorFields:M})=>{M&&M.length>0&&H(M[0][0]),x(VALIDATE_FAILED)})}).then(p=>(Object.assign(u,O(p)),ie())).then(p=>(Object.assign(u,p),Promise.resolve(u))).catch(p=>((p===VALIDATE_FAILED||(p==null?void 0:p.code)===VALIDATE_FAILED)&&(t.warning("\u6821\u9A8C\u672A\u901A\u8FC7"),p.key&&G(p.key)),Promise.reject(null)))}function G(u){let p=j.value;for(let x=0;x<p.length;x++)if(u==p[x].key){ae.value=x+"";break}}function ie(){return new Promise((u,p)=>__async(this,null,function*(){let x={};try{let M=j.value;for(let q=0;q<M.length;q++){let le=M[q].key,oe=N[le].value;if(oe instanceof Array&&(oe=oe[0]),M[q].relationType==1)try{let ce=yield oe.getAll();x[le]=[],x[le].push(ce)}catch(ce){throw{code:VALIDATE_FAILED,key:le}}else{if(yield oe.fullValidateTable())throw{code:VALIDATE_FAILED,key:le};x[le]=oe.getTableData()}}}catch(M){p(M)}u(x)}))}function se(){return __async(this,null,function*(){try{let u=yield f();u=Object.assign({},T.value,u),u=O(u),_.value=!0,re(u)}finally{_.value=!1}})}function re(u){Oe(he,u).then(()=>{Re(u)}).catch(p=>{t.warning(p)})}function be(u,p,x){p&&x?x.setValues?x.setValues(u):x.setValues([{rowKey:p,values:u}]):v(u)}function Ce(u,p){let x={};x[u]=p,v(x)}const ae=ref("0"),de=ref(300),fe=ref(340);function Fe(u){if(S.value===!0){let p=T.value;return _e(p,u)}return""}function _e(u,p){if(u){let x=u[p];return!x&&x!==0&&(x=u[p.toLowerCase()],!x&&x!==0&&(x=u[p.toUpperCase()])),x}return""}function ye(u,p){if(d&&d[p+"_onlChange"]){let x=d[p+"_onlChange"](),M=Object.keys(u)[0];if(x[M]){let q=N[p].value;q instanceof Array&&(q=q[0]);let le=q.getFormEvent(),oe=__spreadValues({column:{key:M},value:u[M]},le);x[M].call(y,y,oe)}}}function ve(u,p){if(d&&d[p+"_onlChange"]){let x=d[p+"_onlChange"](y);x[u.column.key]&&x[u.column.key].call(y,y,u)}}function Te(u,p){}function Se(u){return"online_"+u+":"}function xe(u,p){return __async(this,null,function*(){if(T.value[u]!=p&&e("dataChange",u),!d||!d.onlChange||!u)return!1;let M=d.onlChange();if(M[u]){let le={row:yield J(),column:{key:u},value:p};M[u].call(y,y,le)}})}function ue(u,p){if(u=="js")d&&d[p]&&d[p].call(y,y);else if(u=="action"){let x=T.value,M={formId:n.id,buttonCode:p,dataId:x.id,uiFormData:Object.assign({},x)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:M},{isTransformResponse:!1}).then(q=>{q.success?t.success("\u5904\u7406\u5B8C\u6210!"):t.warning("\u5904\u7406\u5931\u8D25!")})}}function me(u){let p=N[u].value,x=[...p.getNewDataWithId(),...g.value[u]];if(!x||x.length==0)return!1;let M=[];for(let q of x)M.push(q.id);p.removeRowsById(M)}function pe(u,p){if(!p)return!1;let x=N[u].value;typeof p=="object"?x.addRows(p,!0):t.error("\u6DFB\u52A0\u5B50\u8868\u6570\u636E,\u53C2\u6570\u4E0D\u8BC6\u522B!")}function we(u,p){me(u),pe(u,p)}function Ee(u,p){!p&&p.length<=0&&(p=[]),p.map(x=>{x.hasOwnProperty("label")||(x.label=x.text)}),I({field:u,componentProps:{options:p}})}function Oe(u,p){return d&&d.beforeSubmit?d.beforeSubmit(u,p):Promise.resolve()}function De(u,p){let x=toRaw(E);u&&u.length>0?Object.keys(x).map(M=>{!M.endsWith("_load")&&u.indexOf(M)<0&&(E[M]=!1)}):p&&p.length>0&&Object.keys(x).map(M=>{p.indexOf(M)>=0&&(E[M]=!1)})}function Pe(u){return __async(this,null,function*(){yield m(),T.value="",S.value=!0,yield te(u),yield nextTick(()=>{ue("js","loaded")})})}function Ie(u){let p=N[u].value;return p instanceof Array&&(p=p[0]),p}function Be(){let u=B.reportPrintUrl,p=T.value.id,x=getToken();goJmReportViewPage(u,p,x)}function Ae(u){o.value=u.id,s(!0)}function Me(u){}function Re(u){if(Object.keys(u).map(p=>{Array.isArray(u[p])&&u[p].length==0&&(u[p]="")}),n.request==!1)e("success",u);else{let p=`${urlObject.optPre}${n.id}?tabletype=${P.value}`;w.value===!0&&(u[SUBMIT_FLOW_KEY]=1);let x=S.value===!0?"put":"post";defHttp.request({url:p,method:x,params:u},{isTransformResponse:!1}).then(M=>{M.success?(M.result&&(u.id||(u.id=M.result)),e("success",u),T.value=u,S.value=!0,t.success("\u64CD\u4F5C\u6210\u529F!")):t.warning(M.message)}).finally(()=>{_.value=!1})}}function ke(){return __async(this,null,function*(){let u=T.value,p=ne.value,x=pick$1(u,...p);if(u)yield v(x);else{let M={};for(let q of p)M[q]="";yield v(M)}})}let he={tableName:V,loading:_,subActiveKey:ae,onlineFormRef:i,getFieldsValue:J,setFieldsValue:v,submitFlowFlag:w,subFormHeight:de,subTableHeight:fe,refMap:N,triggleChangeValues:be,triggleChangeValue:Ce,sh:E,clearSubRows:me,addSubRows:pe,clearThenAddRows:we,changeOptions:Ee,isUpdate:S,getSubTableInstance:Ie};return A(he),{tableName:V,onlineFormRef:i,registerForm:a,loading:_,subActiveKey:ae,hasSubTable:W,subTabInfo:j,refMap:N,subFormHeight:de,getSubTableForeignKeyValue:Fe,isUpdate:S,handleSubFormChange:ye,subTableHeight:fe,onlineFormDisabled:Y,subDataSource:g,getSubTableAuthPre:Se,handleAdded:Te,handleValueChange:ve,openSubFormModalForAdd:Ae,openSubFormModalForEdit:Me,registerVxeFormModal:l,vxeTableId:o,show:ee,createRootProperties:U,handleSubmit:Z,sh:E,handleCgButtonClick:ue,handleCustomFormSh:De,handleCustomFormEdit:Pe,dbData:T,onOpenReportPrint:Be,onlineExtConfigJson:B,recoverFormData:ke}}},_hoisted_1$3=["id"];function _sfc_render$4(n,e,t,l,s,o){const i=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:l.tableName+"_form"},[createVNode(i,{ref:"onlineFormRef",onRegister:l.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}var OnlinePopForm=_export_sfc(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(n,{emit:e}={},t){const l=ref(null),s=ref(!1),o=ref(1),i=ref([]),b=ref(!1),_=ref(0),P=ref(!1),w=ref(""),S=ref(!1),B=ref(!1),y=ref(!0),A=reactive({}),k=ref(!0),R=ref(""),O=ref(!0),V=ref(!1),{popModalFixedWidth:T,resetBodyStyle:$,popBodyStyle:W}=useFixedHeightModal(),j=ref(!1),N={handleOpenModal:D=>{}},g=ref(""),C=ref(""),F=ref(!1);let E={};const d=computed(()=>{let D=R.value;return D||(unref(s)===!0?"\u8BE6\u60C5":unref(B)===!0?"\u7F16\u8F91":"\u65B0\u589E")}),[c,{setModalProps:a,closeModal:r}]=useModalInner(D=>__async(this,null,function*(){R.value="",V.value=!1,n===!0?yield N.handleOpenModal(D):yield v(D),$(),t&&t()})),f=ref(!1);function m(){return __async(this,null,function*(){return yield getRefPromise(f),j.value})}function v(D){return __async(this,null,function*(){a({confirmLoading:!1}),B.value=D.isUpdate,s.value=D.disableSubmit||!1,(D==null?void 0:D.hideSub)===!0&&(k.value=!1),D!=null&&D.title&&(R.value=D.title),D!=null&&D.record?C.value=D.record.id:C.value="",yield nextTick(()=>__async(this,null,function*(){yield getRefPromise(b),J(),yield l.value.show(D==null?void 0:D.isUpdate,D==null?void 0:D.record,D==null?void 0:D.param)}))})}function I(D){b.value=!0,_.value=D.modalMinWidth,D.modelFullscreen==1?a({defaultFullscreen:!0}):a({defaultFullscreen:!1}),E=D}function J(){let D=C.value;E.commentStatus==1&&D?(F.value=!0,a({defaultFullscreen:!0})):F.value=!1}const H=800,Y=1100,K=computed(()=>{let D=200*(o.value-1),z=(unref(y)?H:Y)+D;z=ee(z);let G=_.value;return G&&z<G&&(z=G),z});function ee(D){let z=A.modalMinWidth;if(z!=null&&z!=="")try{if(z=Number.parseInt(z),D<z)return z}catch(G){}return D}function X(D,z){l.value.handleCgButtonClick(D,z)}function te(){S.value=!0,setTimeout(()=>{S.value=!1},1500),l.value.handleSubmit()}function ne(){r()}function L(D,z={}){let G=`/online/cgform/api/getFormItem/${D}`;return new Promise((ie,se)=>{defHttp.get({url:G,params:z},{isTransformResponse:!1}).then(re=>{re.success?ie(re.result):se(re.message)}).catch(()=>{se()})})}function U(D,z){return __async(this,null,function*(){let G=yield L(D,z),ie=G.head.formTemplate;o.value=ie?Number(ie):1,i.value=G.cgButtonList,P.value=G.head.isTree==="Y",w.value=G.head.treeParentIdField||"",g.value=G.head.tableName,G.form_disable_update===!0?j.value=!0:j.value=!1,f.value=!0,e&&e("formConfig",G),yield nextTick(()=>__async(this,null,function*(){yield(yield getRefPromise(l)).createRootProperties(G)}))})}function Q(D){D[ONL_FORM_TABLE_NAME]=g.value,e("success",D),O.value==!0&&r(),V.value=!1,O.value=!0}function Z(){l.value&&l.value.onCloseModal()}return{title:d,modalWidth:K,registerModal:c,closeModal:r,modalObject:N,onCloseEvent:Z,cgButtonList:i,handleCgButtonClick:X,disableSubmit:s,handleSubmit:te,submitLoading:S,handleCancel:ne,successThenClose:O,handleSuccess:Q,topTipVisible:V,handleFormConfig:U,onlineFormCompRef:l,formTemplate:o,isTreeForm:P,pidFieldName:w,renderSuccess:I,formRendered:b,isUpdate:B,showSub:k,tableName:g,formDataId:C,enableComment:F,popBodyStyle:W,popModalFixedWidth:T,getFormStatus:m}}function useFixedHeightModal(){const e=ref(800);let t=window.innerWidth-300;t<800&&(t=800),e.value=t;const l=ref({});function s(){let o=window.innerHeight-210;l.value={height:o+"px",overflowY:"auto"}}return{popModalFixedWidth:e,popBodyStyle:l,resetBodyStyle:s}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1},isVxeTableData:{type:Boolean,default:!1},formTableType:{type:String,default:""}},components:{BasicModal,OnlinePopForm,JModalTip,Button},emits:["success","register","formConfig"],setup(n,{emit:e}){const{title:t,registerModal:l,cgButtonList:s,handleCgButtonClick:o,disableSubmit:i,handleSubmit:b,submitLoading:_,handleCancel:P,handleFormConfig:w,onlineFormCompRef:S,formTemplate:B,isTreeForm:y,pidFieldName:A,renderSuccess:k,formRendered:R,handleSuccess:O,topTipVisible:V,successThenClose:T,isUpdate:$,popBodyStyle:W,popModalFixedWidth:j,getFormStatus:N}=useAutoModal(!1,{emit:e});watch(()=>n.id,g,{immediate:!0});function g(){return __async(this,null,function*(){if(R.value=!1,!n.id)return;let r={};n.formTableType&&(r.tabletype=n.formTableType),yield w(n.id,r)})}function C(){n.saveClose===!1&&(T.value=!1),b()}function F(){V.value=!1,S.value.recoverFormData()}function E(){V.value=!0}const d=computed(()=>$.value?n.topTip:!1),c=computed(()=>{if($.value==!0)return null;{let r=_.value;return[h(Button,{type:"primary",loading:r,onClick:b},()=>"\u786E\u5B9A"),h(Button,{onClick:P},()=>"\u5173\u95ED")]}});return{title:t,topTipVisible:V,handleSaveData:C,handleRecover:F,onlineFormCompRef:S,renderSuccess:k,registerModal:l,handleSubmit:b,handleSuccess:O,handleCancel:P,formTemplate:B,disableSubmit:i,cgButtonList:s,handleCgButtonClick:o,isTreeForm:y,pidFieldName:A,submitLoading:_,handleDataChange:E,isUpdate:$,showTopTip:d,modalFooter:c,popBodyStyle:W,popModalFixedWidth:j,getFormStatus:N}}});function _sfc_render$3(n,e,t,l,s,o){const i=resolveComponent("j-modal-tip"),b=resolveComponent("online-pop-form"),_=resolveComponent("BasicModal");return openBlock(),createBlock(_,mergeProps({width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle},n.$attrs,{footer:n.modalFooter,cancelText:"\u5173\u95ED",onRegister:n.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:n.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(n.title)+" ",1),n.showTopTip?(openBlock(),createBlock(i,{key:0,visible:n.topTipVisible,onSave:n.handleSaveData,onCancel:n.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(b,{ref:"onlineFormCompRef",id:n.id,disabled:n.disableSubmit,"form-template":n.formTemplate,isTree:n.isTreeForm,pidField:n.pidFieldName,request:n.request,isVxeTableData:n.isVxeTableData,onRendered:n.renderSuccess,onSuccess:n.handleSuccess,onDataChange:n.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","isVxeTableData","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}var OnlinePopModal=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(n,e){const t="/online/cgform/api/getData/"+n;return defHttp.get({url:t,params:e})}function queryTableColumns(n,e){const t="/online/cgform/api/getColumns/"+n;return defHttp.get({url:t,params:e})}function useLinkTable(n){const e=ref("1"),t=ref({}),l=ref({}),s=ref(""),o=reactive({add:!0,update:!0}),i=computed(()=>n.textField?n.textField.split(","):[]),b=ref([]),_=computed(()=>{let g=b.value;return n.multi==!0?g.slice(0,3):g.slice(0,6)});watchEffect(()=>__async(this,null,function*(){if(n.tableName){let C=n.valueField||"",F=n.textField||"",E=[];if(C&&E.push(C),F){let c=F.split(",");s.value=c[0];for(let a of c)E.push(a)}let d=n.imageField||"";d&&E.push(d),t.value={linkTableSelectFields:E.join(",")},yield y(),yield A()}}));const P=computed(()=>{let g=n.textField||"",C=[],F="";if(g){let E=g.split(",");F=E[0];for(let d=0;d<E.length;d++)d>0&&C.push(E[d])}return{others:C,labelField:F}}),w=ref([]),S=ref([]),B=ref({});function y(){return __async(this,null,function*(){let g=t.value;const C=yield queryTableColumns(n.tableName,g);if(S.value=C.columns,C.columns){let F=n.imageField,E=C.columns.filter(d=>d.dataIndex!=s.value&&d.dataIndex!=F);b.value=E}if(B.value=C.dictOptions,C.hideColumns){let F=C.hideColumns;F.indexOf("add")>=0?o.add=!1:o.add=!0,F.indexOf("update")>=0?o.update=!1:o.update=!0}})}function A(){return __async(this,null,function*(){let g=R(),F=(yield queryTableData(n.tableName,g)).records,E=[],{others:d,labelField:c}=P.value,a=n.imageField;if(F&&F.length>0)for(let r of F){let f=__spreadValues({},r);k(f);let m=Object.assign({},pick$1(f,d),{id:f.id,label:f[c],value:f[n.valueField]});a&&(m[a]=f[a]),E.push(m)}E.push({}),w.value=E})}function k(g){let C=S.value,F=B.value;for(let E of C){const{dataIndex:d,customRender:c}=E;(g[d]||g[d]===0)&&c&&c==d&&F[c]&&(g[d]=filterMultiDictText(F[c],g[d]))}}function R(){return Object.assign({pageSize:10,pageNo:e.value},t.value,l.value)}function O(g){if(!g)l.value={};else{let C=i.value,F=[],E=[];for(let d=0;d<C.length;d++)d<=1&&(E.push(C[d]),F.push({field:C[d],rule:"like",val:g}));F.superQueryMatchType="or",F.superQueryParams=encodeURI(JSON.stringify(F)),l.value=F}}function V(g){return __async(this,null,function*(){if(!g)return[];let C=n.valueField,F=__spreadProps(__spreadValues({},t.value),{pageSize:10,pageNo:e.value});F.superQueryMatchType="and";let E=[{field:C,rule:"in",val:g}];F.superQueryParams=encodeURI(JSON.stringify(E));let c=(yield queryTableData(n.tableName,F)).records,a=[];if(c&&c.length>0)for(let r of c){let f=__spreadValues({},r);k(f),a.push(f)}return a})}function T(g,C){if(!g||g.length==0)return!1;let F=C.split(",");if(F.length!=g.length)return!1;let E=!0;for(let d of g){let c=d[n.valueField];F.indexOf(c)<0&&(E=!1)}return E}function $(g){Object.keys(g).map(C=>{g[C]instanceof Array&&(g[C]=g[C].join(","))})}function W(g,C,F){if(F||(F={}),C&&C.length>0)for(let E of C){let d=E.split(","),c=d[0],a=d[1];if(g[c])g[c].push(F[a]);else{let r=F[a]||"";g[c]=[r]}}}function j(g){if(n.imageField){let C=g[n.imageField];return getFileAccessHttpUrl(C)}return""}const N=computed(()=>!!n.imageField);return{pageNo:e,otherColumns:b,realShowColumns:_,selectOptions:w,reloadTableLinkOptions:A,textFieldArray:i,addQueryParams:O,tableColumns:S,transData:k,mainContentField:s,loadOne:V,compareData:T,formatData:$,initFormData:W,getImageSrc:j,showImage:N,auths:o}}const _sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def([])},emits:["change","update:value"],setup(n,{emit:e}){const t=ref([]),{auths:l,mainContentField:s,textFieldArray:o,selectOptions:i,reloadTableLinkOptions:b,addQueryParams:_,formatData:P,initFormData:w,getImageSrc:S,showImage:B}=useLinkTable(n),[y,{openModal:A}]=useModal(),k=computed(()=>n.tableName),R=computed(()=>n.multi===!0?{mode:"multiple"}:{});function O(g){g==null||g.stopPropagation(),g==null||g.preventDefault(),A(!0,{})}function V(g,C){g==null||g.stopPropagation(),g==null||g.preventDefault(),l.update!=!1&&A(!0,{isUpdate:!0,record:C})}function T(g){return __async(this,null,function*(){yield b();let C=g[n.valueField];t.value=C})}function $(g){_(g),b()}function W(g){j(g),g||(_(),b())}function j(g){let C={},F=n.linkFields,E=[];if(!g)w(C,F);else{let d=toRaw(i.value),c=toRaw(g);c instanceof Array?E=[...c]:n.multi==!0?E=c.split(","):E=[c];let a=d.filter(r=>E.indexOf(r[n.valueField])>=0);if(a&&a.length>0){let r=__spreadValues({},a[0]);if(a.length>1)for(let m=1;m<a.length;m++)r=N(r,a[m]);let f=s.value;r[f]=r.label,w(C,F,r)}}P(C),e("change",E.join(",")||"",C),e("update:value",E.join(",")||"")}function N(g,C){let F={};return Object.keys(g).map(E=>{F[E]=(g[E]||"")+","+(C[E]||"")}),F}return watch(()=>n.value,g=>__async(this,null,function*(){g?(n.multi==!0?t.value=g.split(","):t.value=g,n.linkFields&&n.linkFields.length>0&&j(g)):t.value=[]}),{immediate:!0}),watch(()=>i.value,g=>{g&&g.length>0&&n.linkFields&&n.linkFields.length>0&&t.value&&t.value.length>0&&j(t.value)}),{selectValue:t,selectOptions:i,registerPopModal:y,popTableName:k,textFieldArray:o,handleClickAdd:O,handleClickEdit:V,getFormData:T,handleSearch:useDebounceFn($,800),handleChange:W,bindValue:R,showImage:B,getImageSrc:S,auths:l}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(n,e,t,l,s,o){const i=resolveComponent("PlusOutlined"),b=resolveComponent("EditOutlined"),_=resolveComponent("a-select"),P=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(_,mergeProps({value:l.selectValue,"onUpdate:value":e[1]||(e[1]=w=>l.selectValue=w),style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},l.bindValue,{options:l.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:l.handleSearch,onChange:l.handleChange}),{option:withCtx(w=>[!w.value&&l.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:e[0]||(e[0]=(...S)=>l.handleClickAdd&&l.handleClickAdd(...S))},[createVNode(i),createTextVNode(" \u8BB0\u5F55 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[l.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[l.getImageSrc(w)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(w),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[l.auths.update?(openBlock(),createBlock(b,{key:0,onClick:S=>l.handleClickEdit(S,w)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(w.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.textFieldArray,S=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(w[S]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(P,{id:l.popTableName,onRegister:l.registerPopModal,onSuccess:l.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableSelect=_export_sfc(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-2f5e23a7"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(n){dictOptionInfo.value=n.dictOptions,n.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange}:rowSelection.value=null,enableScrollBar.value=n.scrollFlag==1;let e=n.columns;e.forEach(o=>{Object.keys(o).map(i=>{o[i]==null&&delete o[i]})});let t=n.fieldHrefSlots;const l={};t.forEach(o=>l[o.slotName]=o);let s=[];if(s=handleColumnHrefAndDict(e,l),bpmStatusFilter(s),onlineTableContext.isTree()===!0){let o=n.textField,i=-1;for(let b=0;b<s.length;b++)if(s[b].dataIndex==o){i=b;break}if(i>0){let b=s.splice(i,1);s.unshift(b[0])}s.length>0&&(s[0].align="left")}columns.value=s,onlineTableContext.reloadTable()}function onSelectChange(n,e){selectedKeys.value=n,onlineTableContext.selectedRows=toRaw(e),onlineTableContext.selectedRowKeys=toRaw(n)}function handleColumnHrefAndDict(n,e){for(let t of n){let{customRender:l,hrefSlotName:s,fieldType:o}=t;if(o=="date"||o=="Date")t.customRender=({text:i})=>i?i.length>10?i.substring(0,10):i:"";else if(o=="link_table")t.customRender=({text:i,record:b})=>{if(!i)return"";if(onlineTableContext.isPopList===!0)return b[t.dataIndex+"_dictText"];{let _=(i+"").split(","),P=[];b[t.dataIndex+"_dictText"]&&(P=b[t.dataIndex+"_dictText"].split(","));let w=[];for(let S=0;S<_.length;S++){let B=h(LinkTableListPiece,{id:_[S],text:P[S],onTab:y=>handleClickLinkTable(y,s)});w.push(B)}return w.length==0?"":h("div",{style:{overflow:"hidden"}},w)}};else{if(!s&&t.scopedSlots&&t.scopedSlots.customRender&&e.hasOwnProperty(t.scopedSlots.customRender)&&(s=t.scopedSlots.customRender),l||s){let i=l,b="_replace_text_";t.ellipsis=!0,t.customRender=({text:_,record:P})=>{let w=_;if(i)if(i.startsWith(b)){let S=i.replace(b,"");w=P[S]}else w=filterMultiDictText(unref(dictOptionInfo)[i],_+"");if(t.showLength&&w&&w.length>t.showLength&&(w=w.substr(0,t.showLength)+"..."),s){let S=e[s];if(S)return h("a",{onClick:()=>handleClickFieldHref(S,P)},w)}return w}}if(t.scopedSlots){t.ellipsis=!0;let i=t.scopedSlots;t.slots=i,delete t.scopedSlots}}}return n}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let n=href.split(":");hrefMainTableId.value=n[1];let e=n[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[e]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(n,e)=>record[e]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(n){return text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"\u5173\u95ED",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(n){let e=n.indexOf("?"),t=n;if(e!==-1){t=n.substring(0,e);let s=n.substring(e+1,n.length).split("&"),o={};s.forEach(i=>{let b=i.split("=");o[b[0]]=b[1]}),hrefComponent.params=o}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="\u64CD\u4F5C",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(t)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var n,e;((n=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:n.tableFixedAction)===1&&(actionColumn.fixed=((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(n){let e=!1;for(let t=0;t<n.length;t++)if(n[t].dataIndex.toLowerCase()=="bpm_status"){e=!0;break}return onlineTableContext.hasBpmStatus=e,e}function downloadRowFile(n){if(!n)return;n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(",")));let e=getFileAccessHttpUrl(n);window.open(e)}function getImgView(n){return n&&n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(","))),getFileAccessHttpUrl(n)}function getPcaText(n){return n?getAreaTextByCode(n):""}function getFormatDate(n){if(!n)return"";let e=n;return e.length>10&&(e=e.substring(0,10)),e}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(n){if(n){let e=[],t=n.split(",");for(let l of t)l&&e.push(getFileAccessHttpUrl(l));createImgPreview({imageList:e})}}const onlinePopModalRef=ref();function handleClickLinkTable(n,e){return __async(this,null,function*(){popTableId.value=e,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=e,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:n}})):openPopModal(!0,{isUpdate:!0,record:{id:n}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable,TableAction,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),{popModalFixedWidth:l,resetBodyStyle:s,popBodyStyle:o}=useFixedHeightModal(),i=ref(""),b=ref(800),[_,{closeModal:P}]=useModalInner(()=>{i.value="",I.value=[],J.value=[],m({current:1}),f(),s()}),[w,{openModal:S}]=useModal();function B(){P()}const y=computed(()=>{const L=I.value;return!(L&&L.length>0)}),A=ref(!1);function k(){A.value=!0;let L=toRaw(J.value);L&&L.length>0&&(e("success",L),P()),setTimeout(()=>{A.value=!1},200)}function R(L){const U="/online/cgform/api/getData/"+n.id;return defHttp.get({url:U,params:L})}function O(L){return L.column="id",new Promise((U,Q)=>__async(this,null,function*(){const Z=yield R(L);U(Z)}))}const V={isPopList:!0,reloadTable(){},isTree(){return!1}},T=ref({}),{columns:$,downloadRowFile:W,getImgView:j,getPcaText:N,getFormatDate:g,handleColumnResult:C,hrefComponent:F,viewOnlineCellImage:E}=useTableColumns(V,T);function d(){const L="/online/cgform/api/getColumns/"+n.id;return new Promise((U,Q)=>{defHttp.get({url:L},{isTransformResponse:!1}).then(Z=>{Z.success?U(Z.result):(t.warning(Z.message),Q())})})}const c=ref("");watch(()=>n.id,()=>__async(this,null,function*(){let L=yield d();C(L),c.value=L.description}),{immediate:!0});const{tableContext:a}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:O,clickToRowSelect:!0,columns:$,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:L=>X(L)}}),[r,{reload:f,setPagination:m},{rowSelection:v,selectedRowKeys:I,selectedRows:J}]=a;watch(()=>n.multi,L=>{L==!0?v.type="checkbox":v.type="radio"},{immediate:!0});function H(L){return[{label:"\u7F16\u8F91",onClick:Y.bind(null,L)}]}function Y(L){}function K(){f()}const ee=["int","double","Date","Datetime","BigDecimal"];function X(L){let U=i.value;if(!U)return L.superQueryMatchType="or",L.superQueryParams="",L;let Q=$.value,Z=[];if(Q&&Q.length>0)for(let D of Q)D.dbType&&(D.dbType=="string"?Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"like",val:U}):D.dbType=="Date"?U.length==10&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:U}):D.dbType=="Datetime"?U.length==19&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:U}):ee.indexOf(D.dbType)&&Z.push({field:D.dataIndex,type:D.dbType.toLowerCase(),rule:"eq",val:U}));return L.superQueryMatchType="or",L.superQueryParams=encodeURI(JSON.stringify(Z)),L}function te(){S(!0,{})}function ne(L){e("success",[L]),P()}return{registerModal:_,modalWidth:b,handleCancel:B,submitDisabled:y,submitLoading:A,handleSubmit:k,registerTable:r,getTableAction:H,searchText:i,onSearch:K,downloadRowFile:W,getImgView:j,getPcaText:N,getFormatDate:g,hrefComponent:F,viewOnlineCellImage:E,rowSelection:v,modalTitle:c,registerPopModal:w,handleAdd:te,reload:f,popModalFixedWidth:l,popBodyStyle:o,handleDataSave:ne}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(n,e,t,l,s,o){const i=resolveComponent("PlusOutlined"),b=resolveComponent("a-button"),_=resolveComponent("a-input-search"),P=resolveComponent("TableAction"),w=resolveComponent("BasicTable"),S=resolveComponent("BasicModal"),B=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(S,{onRegister:n.registerModal,width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle,title:n.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[n.addAuth?(openBlock(),createBlock(b,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:n.handleAdd},{default:withCtx(()=>[createVNode(i),createTextVNode("\u65B0\u589E\u8BB0\u5F55")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(b,{key:"back",onClick:n.handleCancel},{default:withCtx(()=>[createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),createVNode(b,{disabled:n.submitDisabled,key:"submit",type:"primary",onClick:n.handleSubmit,loading:n.submitLoading},{default:withCtx(()=>[createTextVNode("\u786E\u5B9A")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(w,{onRegister:n.registerTable,rowSelection:n.rowSelection},{tableTitle:withCtx(()=>[createVNode(_,{value:n.searchText,"onUpdate:value":e[0]||(e[0]=y=>n.searchText=y),onSearch:n.onSearch,placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD\uFF0C\u6309\u56DE\u8F66\u641C\u7D22",style:{width:"240px"}},null,8,["value","onSearch"])]),action:withCtx(({record:y})=>[createVNode(P,{actions:n.getTableAction(y)},null,8,["actions"])]),fileSlot:withCtx(({text:y})=>[y?(openBlock(),createBlock(b,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:A=>n.downloadRowFile(y)},{default:withCtx(()=>[createTextVNode(" \u4E0B\u8F7D ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"\u65E0\u6587\u4EF6"))]),imgSlot:withCtx(({text:y})=>[y?(openBlock(),createElementBlock("img",{key:1,src:n.getImgView(y),alt:"\u56FE\u7247\u4E0D\u5B58\u5728",class:"online-cell-image",onClick:A=>n.viewOnlineCellImage(y)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"\u65E0\u56FE\u7247"))]),htmlSlot:withCtx(({text:y})=>[createBaseVNode("div",{innerHTML:y},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:y})=>[createBaseVNode("div",{title:n.getPcaText(y)},toDisplayString(n.getPcaText(y)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:y})=>[createBaseVNode("span",null,toDisplayString(n.getFormatDate(y)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode(B,{id:n.id,onRegister:n.registerPopModal,onSuccess:n.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}var OnlinePopListModal=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"}));const _sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def([])},components:{PlusOutlined,MinusCircleFilled,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(n,{emit:e}){const t=computed(()=>n.tableName),[l,{openModal:s}]=useModal(),[o,{openModal:i}]=useModal(),b=ref([]),_=ref([]),P=computed(()=>!(n.disabled==!0||n.multi===!1&&_.value.length>0)),{auths:w,otherColumns:S,realShowColumns:B,tableColumns:y,textFieldArray:A,transData:k,loadOne:R,compareData:O,formatData:V,initFormData:T,getImageSrc:$,showImage:W}=useLinkTable(n),j=computed(()=>n.multi===!0?12:24),N=computed(()=>n.multi===!0?24:12);function g(f){if(f&&A.value.length>0){let m=A.value[0];return f[m]}}function C(f){f==null||f.stopPropagation(),f==null||f.preventDefault()}function F(f,m){C(f),w.update!=!1&&n.disabled==!1&&i(!0,{isUpdate:!0,record:m})}function E(f){s(!0,{})}function d(f){let m=_.value;for(let v of f){let I=__spreadValues({},v);k(I),m.push(I)}_.value=m,r()}function c(f){let m=_.value;for(let v=0;v<m.length;v++)if(m[v].id===f.id){let I=__spreadValues({},f);k(I),m.splice(v,1,I)}_.value=m,r()}function a(f,m){C(f);let v=_.value;v&&v.length>m&&(v.splice(m,1),_.value=v),r()}function r(){let f=_.value,m=[],v={},I=n.linkFields;if(f.length>0)for(let H=0;H<f.length;H++)m.push(f[H][n.valueField]),T(v,I,f[H]);else T(v,I);let J=m.join(",");V(v),e("change",J,v),e("update:value",J)}return watch(()=>n.value,f=>__async(this,null,function*(){if(f){if(O(_.value,f)===!1){let v=yield R(f);_.value=v}n.linkFields&&n.linkFields.length>0&&r()}else _.value=[]}),{immediate:!0}),{popTableName:t,selectRecords:_,otherColumns:S,realShowColumns:B,showButton:P,selectValue:b,handleAddRecord:E,handleDeleteRecord:a,getMainContent:g,itemSpan:j,columnSpan:N,tableColumns:y,addCard:d,registerListModal:l,registerFormModal:o,handleClickEdit:F,updateCardData:c,getImageSrc:$,showImage:W,auths:w}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(n,e,t,l,s,o){const i=resolveComponent("PlusOutlined"),b=resolveComponent("a-button"),_=resolveComponent("minus-circle-filled"),P=resolveComponent("a-col"),w=resolveComponent("a-row"),S=resolveComponent("online-pop-list-modal"),B=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[l.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(b,{onClick:l.handleAddRecord},{default:withCtx(()=>[createVNode(i),createTextVNode("\u8BB0 \u5F55")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.selectRecords,(y,A)=>(openBlock(),createBlock(P,{span:l.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":t.detail==!0}]),onClick:k=>l.handleClickEdit(k,y)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":l.showImage}])},[t.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(_,{onClick:k=>l.handleDeleteRecord(k,A)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(l.getMainContent(y)),1),createBaseVNode("div",_hoisted_8,[createVNode(w,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.realShowColumns,k=>(openBlock(),createBlock(P,{span:l.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(k.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(y[k.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),l.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[l.getImageSrc(y)?(openBlock(),createElementBlock("img",{key:0,src:l.getImageSrc(y),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(S,{onRegister:l.registerListModal,multi:t.multi,id:l.popTableName,addAuth:l.auths.add,onSuccess:l.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode(B,{id:l.popTableName,onRegister:l.registerFormModal,onSuccess:l.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}var LinkTableCard=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-f6bb6746"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"}));const componentKeyMap={};function useExtendComponent(){n("OnlineSelectCascade",OnlineSelectCascade),n("LinkTableSelect",LinkTableSelect),n("LinkTableCard",LinkTableCard);function n(t,l){componentKeyMap[t]||(add(t,l),componentKeyMap[t]=1)}function e(t){t.component=="LinkTableCard"&&(t.component="LinkTableSelect",t.componentProps.popContainer="body")}return{addComponent:n,linkTableCard2Select:e}}const useExtendComponent$1=Object.freeze(Object.defineProperty({__proto__:null,E:ENHANCEJS,F:FormSchemaFactory,L:LinkTableCard,O:OnlineSubForm,S:SUBMIT_FLOW_KEY,V:VALIDATE_FAILED,a:OnlinePopModal,b:useOnlineFormContext,c:useFormItems,d:useEnhance,e:SUBMIT_FLOW_ID,f:ONL_FORM_TABLE_NAME,g:getRefPromise,h:getDetailFormSchemas,i:FORM_VIEW_TO_QUERY_VIEW,j:loadOneFieldDefVal,k:LINK_DOWN,l:loadFormFieldsDefVal,m:handleLinkDown,n:getFieldIndex,o:useTableColumns,p:useAutoModal,q:SETUP,r:OnlineSubForm$1,s:OnlinePopForm$1,t:OnlinePopModal$1,u:useExtendComponent,v:LinkTableSelect$1,w:OnlinePopListModal$1,x:LinkTableCard$1},Symbol.toStringTag,{value:"Module"}));export{ENHANCEJS as E,FormSchemaFactory as F,LinkTableCard as L,OnlineSubForm as O,SUBMIT_FLOW_KEY as S,VALIDATE_FAILED as V,OnlinePopModal as a,useOnlineFormContext as b,useFormItems as c,useEnhance as d,SUBMIT_FLOW_ID as e,ONL_FORM_TABLE_NAME as f,getRefPromise as g,getDetailFormSchemas as h,getAreaTextByCode as i,FORM_VIEW_TO_QUERY_VIEW as j,loadOneFieldDefVal as k,loadFormFieldsDefVal as l,LINK_DOWN as m,handleLinkDown as n,getFieldIndex as o,useTableColumns as p,useAutoModal as q,SETUP as r,useExtendComponent$1 as s,useExtendComponent as u};
