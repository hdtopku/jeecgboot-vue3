var et=Object.defineProperty,at=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var R=(t,s,n)=>s in t?et(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,N=(t,s)=>{for(var n in s||(s={}))st.call(s,n)&&R(t,n,s[n]);if(I)for(var n of I(s))nt.call(s,n)&&R(t,n,s[n]);return t},O=(t,s)=>at(t,ot(s));var B=(t,s,n)=>new Promise((d,g)=>{var v=e=>{try{i(n.next(e))}catch(r){g(r)}},y=e=>{try{i(n.throw(e))}catch(r){g(r)}},i=e=>e.done?d(e.value):Promise.resolve(e.value).then(v,y);i((n=n.apply(t,s)).next())});import{b as K,y as it,D as q,t as rt,s as lt,C as ct,aY as pt}from"./jeecg-online-vendor-9cc54e36.js";import{m as W,z as A}from"./index-26fb0584.js";import{T as dt}from"./index-a0d17b33.js";import{bk as F,bu as k,cH as mt,bl as L,cI as ut,cJ as gt,cm as U,cf as yt}from"./antd-vue-vendor-04f0af1d.js";import{d as X,k as P,e as M,u as S,w as ft,V as l,a5 as p,a9 as _,a7 as f,a6 as h,a8 as vt,F as H,am as J,an as _t,f as c,aa as z,E as ht,ab as V,W as C,g as bt,r as kt,o as Ct,ag as wt}from"./vue-5a09445c.js";import Dt from"./DetailModal-969124b8.js";import{_ as Mt}from"./DynamicNotice.vue_vue_type_script_setup_true_name_dynamic-notice_lang-c5ce460f.js";import"./index-9ca8f863.js";import{connectWebSocket as St,onWebSocket as Tt}from"./useWebSocket-08994e98.js";import{r as jt}from"./mynews.api-8b76db1a.js";import Nt from"./SysMessageModal-76cd3865.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./BasicModal-d2e0602d.js";import"./useWindowSizeFn-cfb01db5.js";import"./JSelectUser-9d666511.js";import"./props-c570bc09.js";import"./JSelectBiz-292f2b27.js";import"./useFormItem-43cba0e8.js";import"./SysMessageList-5bcdd6a3.js";import"./useSysMessage-bff0b816.js";var Y=(t=>(t.L="L",t.M="M",t.H="H",t))(Y||{});const Bt=[{key:"1",name:"通知",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"你收到了 14 份新周报",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"你推荐的 曲妮妮 已通过第三轮面试",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"这种模板可以区分多种通知类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"标题可以设置自动显示省略号，本例中标题行数已设为1行，如果内容超过1行将自动截断并支持tooltip显示完整标题。",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"系统消息",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"曲丽丽 评论了你",description:"描述信息描述信息描述信息",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"朱偏右 回复了你",description:"这种模板用于提醒谁与你发生了互动",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"标题",description:"请将鼠标移动到此处，以便测试超长的消息在此处将如何处理。本例中设置的描述最大行数为2，超过2行的描述内容将被省略并且可以通过tooltip查看完整内容",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}],zt=t=>K.get({url:"/sys/annountCement/listByUser",params:t}),E=(t,s)=>K.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:N({anntId:t},s)}),Pt=X({components:{[F.name]:F,[k.name]:k,[k.Item.name]:k.Item,AListItemMeta:k.Item.Meta,ATypographyParagraph:mt.Paragraph,[L.name]:L,Time:dt},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(t,{emit:s}){const{prefixCls:n}=W("header-notify-list"),d=P(t.currentPage||1),g=M(()=>{const{pageSize:e,list:r}=t;if(e===!1)return[];let m=it(e)?e:5;return r.slice(m*(S(d)-1),m*S(d))});ft(()=>t.currentPage,e=>{d.value=e});const v=M(()=>!!t.onTitleClick),y=M(()=>{const{list:e,pageSize:r}=t;return r>0&&e&&e.length>r?{total:e.length,pageSize:r,current:S(d),onChange(m){d.value=m,s("update:currentPage",m)}}:!1});function i(e){t.onTitleClick&&t.onTitleClick(e)}return{prefixCls:n,getPagination:y,getData:g,handleTitleClick:i,isTitleClickable:v,PriorityTypes:Y}}});const Gt={class:"title"},$t={key:0,class:"extra"},It={key:2},Rt={key:0,class:"description"},Ot={class:"datetime"};function At(t,s,n,d,g,v){const y=l("a-typography-paragraph"),i=l("a-tag"),e=l("a-avatar"),r=l("Icon"),m=l("Time"),T=l("a-list-item-meta"),b=l("a-list-item"),w=l("a-list");return p(),_(w,{class:J(t.prefixCls),pagination:t.getPagination},{default:f(()=>[(p(!0),h(H,null,vt(t.getData,o=>(p(),_(b,{key:o.id,class:"list-item",onClick:G=>t.handleTitleClick(o),style:_t({cursor:t.isTitleClickable?"pointer":""})},{default:f(()=>[c(T,null,{title:f(()=>[z("div",Gt,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!o.titleDelete,ellipsis:t.$props.titleRows&&t.$props.titleRows>0?{rows:t.$props.titleRows,tooltip:!!o.title}:!1,content:o.title},null,8,["delete","ellipsis","content"]),o.extra?(p(),h("div",$t,[c(i,{class:"tag",color:o.color},{default:f(()=>[ht(V(o.extra),1)]),_:2},1032,["color"])])):C("",!0)])]),avatar:f(()=>[o.avatar?(p(),_(e,{key:0,class:"avatar",src:o.avatar},null,8,["src"])):o.priority?(p(),h(H,{key:1},[o.priority===t.PriorityTypes.L?(p(),_(e,{key:0,class:"avatar priority-L",title:"一般消息"},{icon:f(()=>[c(r,{icon:"entypo:info"})]),_:1})):C("",!0),o.priority===t.PriorityTypes.M?(p(),_(e,{key:1,class:"avatar priority-M",title:"重要消息"},{icon:f(()=>[c(r,{icon:"bi:exclamation-lg"})]),_:1})):C("",!0),o.priority===t.PriorityTypes.H?(p(),_(e,{key:2,class:"avatar priority-H",title:"紧急消息"},{icon:f(()=>[c(r,{icon:"ant-design:warning-filled"})]),_:1})):C("",!0)],64)):(p(),h("span",It,V(o.avatar),1))]),description:f(()=>[z("div",null,[o.description?(p(),h("div",Rt,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:t.$props.descRows&&t.$props.descRows>0?{rows:t.$props.descRows,tooltip:!!o.description}:!1,content:o.description},null,8,["ellipsis","content"])])):C("",!0),z("div",Ot,[c(m,{value:o.datetime,title:o.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const Ft=q(Pt,[["render",At],["__scopeId","data-v-f011ee3f"]]),Lt=X({components:{Popover:ut,BellOutlined:gt,Tabs:U,TabPane:U.TabPane,Badge:yt,NoticeList:Ft,DetailModal:Dt,DynamicNotice:Mt,SysMessageModal:Nt},setup(){const{prefixCls:t}=W("header-notify"),s=bt(),n=rt(),d=lt(),g=kt({path:"",formData:{}}),[v,y]=A(),i=P(Bt),e=M(()=>{let a=0;for(let u=0;u<i.value.length;u++)a+=i.value[u].count;return a}),[r,{openModal:m}]=A();function T(){for(let a=0;a<i.value.length;a++)i.value[a].count=0;m(!0,{})}const b=P(!1);Ct(()=>{Z()});function w(a){return O(N({},a),{title:a.titile,description:a.msgAbstract,datetime:a.sendTime})}function o(){return B(this,null,function*(){try{let{anntMsgList:a,sysMsgList:u,anntMsgTotal:D,sysMsgTotal:j}=yield zt({pageSize:5});i.value[0].list=a.map(w),i.value[1].list=u.map(w),i.value[0].count=D,i.value[1].count=j}catch(a){}})}o();function G(a){var u;try{E(a.id),o()}catch(D){}a.openType==="component"?(g.path=a.openPage,g.formData={id:a.busId},(u=s.refs.dynamicNoticeRef)==null||u.detail(a.openPage)):y.openModal(!0,{record:a,isUpdate:!0}),b.value=!1}function Z(){var $;let a=ct(),u=pt(a),D=S(n.getUserInfo).id+"_"+u,j=(($=d.domainUrl)==null?void 0:$.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+D;St(j),Tt(Q)}function Q(a){(a.cmd==="topic"||a.cmd==="user")&&setTimeout(()=>{o()},1e3)}function x(){b.value=!1,jt({},o)}function tt(a){return B(this,null,function*(){try{yield E(a),yield o()}catch(u){}})}return{prefixCls:t,listData:i,count:e,clickBadge:T,registerMessageModal:r,reloadCount:tt,onNoticeClick:G,onEmptyNotify:x,numberStyle:{},popoverVisible:b,registerDetail:v,dynamicNoticeProps:g}}});function Ut(t,s,n,d,g,v){const y=l("BellOutlined"),i=l("Badge"),e=l("DynamicNotice"),r=l("DetailModal"),m=l("sys-message-modal");return p(),h("div",{class:J(t.prefixCls)},[c(i,{count:t.count,overflowCount:9,offset:[-4,10],numberStyle:t.numberStyle,onClick:t.clickBadge},{default:f(()=>[c(y)]),_:1},8,["count","numberStyle","onClick"]),c(e,wt({ref:"dynamicNoticeRef"},t.dynamicNoticeProps),null,16),c(r,{onRegister:t.registerDetail},null,8,["onRegister"]),c(m,{onRegister:t.registerMessageModal,onRefresh:t.reloadCount},null,8,["onRegister","onRefresh"])],2)}const ue=q(Lt,[["render",Ut]]);export{ue as default};
