var y=(m,d,l)=>new Promise((r,g)=>{var u=t=>{try{o(l.next(t))}catch(p){g(p)}},c=t=>{try{o(l.throw(t))}catch(p){g(p)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(u,c);o((l=l.apply(m,d)).next())});import{a4 as M,a5 as b,C as E,O as x}from"./jeecg-online-vendor-d469fb0e.js";import{q as A}from"./page.api-643f30d0.js";import{B as P}from"./index-f37bcd39.js";import S from"./PasswordModal-02975609.js";import{B as R}from"./index-cbf1027d.js";import{d as F,k as i,u as n,q as N,V as O,a5 as h,a6 as V,f as C,a7 as q,aa as U,a9 as W,W as J,ag as L,F as $}from"./vue-bcbaddf9.js";const G={id:"dragEngineBox",style:{height:"100vh","overflow-y":"auto"}},Z=F({__name:"DragPageModal",props:{lowAppId:{type:String},isLowApp:{type:Boolean,default:!0}},emits:["success","register","close"],setup(m,{emit:d}){const l={padding:"0",height:window.innerHeight+"px"},r=i(""),g=i(""),u=i(!0),c=i(),o=i({componentData:[],name:"",coverUrl:"",backgroundColor:"",backgroundImage:"",designType:100,theme:"default",style:"default",updateCount:null}),[t,{setModalProps:p,closeModal:v}]=R(a=>y(this,null,function*(){p({showCancelBtn:!1,showOkBtn:!1}),u.value=!1,r.value=a.record.id,_(a.record),g.value=`页面设计 [${a.record.name}]`;const e=yield A({id:n(r)});if(e.success){o.value.name=e.result.name,o.value.coverUrl=e.result.coverUrl;let s=e.result.template?JSON.parse(e.result.template):[];o.value.componentData=s,o.value.backgroundColor=e.result.backgroundColor,o.value.backgroundImage=e.result.backgroundImage,o.value.designType=e.result.designType,o.value.style=e.result.style||"default",o.value.theme=e.result.theme||"default",o.value.updateCount=e.result.updateCount}setTimeout(()=>{N(()=>{u.value=!0})},300)}));function _(a){const e=a.protectionCode;let s=M(b.DRAG_CACHE_PREFIX+n(r));e&&e.length>0&&!s&&(c.value.showModal("design",a),c.value.extraMsg="")}function k(){v(),d("success"),d("close")}function I(a){d("success")}function B(a){let e=document.getElementById("dragEngineBox");D(e,a)}function D(a,e){let s=a.scrollTop;const f=()=>{let w=e-s;s=s+w/10,Math.abs(w)<1?a.scrollTo(0,e):(a.scrollTo(0,s),setTimeout(f,20))};f()}function T(a){window.open(a,"_blank")}return(a,e)=>{const s=O("DragEngine");return h(),V($,null,[C(n(P),L(a.$attrs,{footer:null,wrapClassName:"drag-design-process-modal",style:{top:"0",padding:"0"},onRegister:n(t),bodyStyle:l,canFullscreen:!1,closable:!1,defaultFullscreen:"",destroyOnClose:""}),{default:q(()=>[U("div",G,[u.value?(h(),W(s,{key:0,dragData:o.value,pageId:r.value,token:n(E)(),tenantId:n(x)(),lowAppId:m.lowAppId,isLowApp:!1,onSave:I,onClose:k,onScroll:B,onOpenWindow:T},null,8,["dragData","pageId","token","tenantId","lowAppId"])):J("",!0)])]),_:1},16,["onRegister"]),C(S,{ref_key:"passwordRef",ref:c,onClosed:n(v)},null,8,["onClosed"])],64)}}});export{Z as _};
