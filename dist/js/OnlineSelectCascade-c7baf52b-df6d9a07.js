import{d as V,l as h,w as m,V as y,a7 as v,ac as S,aa as w,a8 as B,F as k,ab as O,ad as $,ae as P}from"./vue-86253b15.js";import{q as M,ap as b,bB as N}from"./jeecg-online-vendor-bc5d810e.js";import"./antd-vue-vendor-371529c2.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-04a44d0a.js";import"./vxe-table-vendor-6a8d95c4.js";var R=(t,o,r)=>new Promise((u,a)=>{var f=n=>{try{d(r.next(n))}catch(s){a(s)}},p=n=>{try{d(r.throw(n))}catch(s){a(s)}},d=n=>n.done?u(n.value):Promise.resolve(n.value).then(f,p);d((r=r.apply(t,o)).next())});const x="/online/cgform/api/querySelectOptions",T=V({name:"OnlineSelectCascade",props:{table:{type:String,default:""},txt:{type:String,default:""},store:{type:String,default:""},idField:{type:String,default:""},pidField:{type:String,default:""},pidValue:{type:String,default:"-1"},origin:{type:Boolean,default:!1},condition:{type:String,default:""},value:{type:String,default:""},isNumber:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"}},emits:["change","next"],setup(t,{emit:o}){const{createMessage:r}=M(),u=h(""),a=h([]),f=h(!0);function p(e){let l=e||"";o("change",l),g(l)}m(()=>t.condition,e=>{f.value=!0,e&&n()},{immediate:!0}),m(()=>t.pidValue,e=>{e==="-1"?a.value=[]:n()}),m(()=>t.value,(e,l)=>{e?u.value=e:(u.value=[],l&&(o("change",""),o("next","-1"))),e&&!l&&d(e)},{immediate:!0});function d(e){return R(this,null,function*(){if(t.idField===t.store)o("next",e);else if(t.origin===!0)yield F(),g(e);else{let l=yield C();g(e,l)}})}function n(){let e=s();t.origin===!0?e.condition=t.condition:e.pidValue=t.pidValue,a.value=[],b.get({url:x,params:e},{isTransformResponse:!1}).then(l=>{l.success?a.value=[...l.result]:r.warning("联动组件数据加载失败,请检查配置!")})}function s(){return{table:t.table,txt:t.txt,key:t.store,idField:t.idField,pidField:t.pidField}}function C(){return new Promise(e=>{if(!t.value)u.value=[],e([]);else{let l=s();t.isNumber===!0?l.condition=`${t.store} = ${t.value}`:l.condition=`${t.store} = '${t.value}'`,b.get({url:x,params:l},{isTransformResponse:!1}).then(i=>{i.success?e(i.result):(r.warning("联动组件数据加载失败,请检查配置!"),e([]))})}})}function F(){return new Promise(e=>{(function l(i){i>10&&e([]);let c=a.value;c&&c.length>0?e(c):setTimeout(()=>{l(i++)},300)})(0)})}function g(e,l=[]){if(e&&e.length>0){(!l||l.length==0)&&(l=a.value);let i=l.filter(c=>c.store===e);if(i&&i.length>0){let c=i[0].id;o("next",c)}}}return{selectedValue:u,dictOptions:a,handleChange:p}}}),q=["title"];function _(t,o,r,u,a,f){const p=y("a-select-option"),d=y("a-select");return v(),S(d,{placeholder:t.placeholder,value:t.selectedValue,onChange:t.handleChange,allowClear:"",style:{width:"100%"}},{default:w(()=>[(v(!0),B(k,null,O(t.dictOptions,(n,s)=>(v(),S(p,{key:s,value:n.store},{default:w(()=>[$("span",{style:{display:"inline-block",width:"100%"},title:n.label},P(n.label),9,q)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onChange"])}const A=N(T,[["render",_]]);export{A as default};
