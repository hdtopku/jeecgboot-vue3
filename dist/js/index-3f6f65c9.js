var et=Object.defineProperty,ut=Object.defineProperties;var at=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var G=(t,o,s)=>o in t?et(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,M=(t,o)=>{for(var s in o||(o={}))ot.call(o,s)&&G(t,s,o[s]);if(z)for(var s of z(o))st.call(o,s)&&G(t,s,o[s]);return t},$=(t,o)=>ut(t,at(o));var S=(t,o,s)=>new Promise((p,g)=>{var E=e=>{try{i(s.next(e))}catch(n){g(n)}},y=e=>{try{i(s.throw(e))}catch(n){g(n)}},i=e=>e.done?p(e.value):Promise.resolve(e.value).then(E,y);i((s=s.apply(t,o)).next())});import{ad as H,ae as it,_ as q,cr as nt,c as rt,d as lt,ac as ct,cs as pt}from"./jeecg-online-vendor-bf2efbcb.js";import{l as W,E as R}from"./index-fde9c72f.js";import{j as mt}from"./componentMap-a6d21ad6.js";import{d as X,k as j,e as b,w as dt,u as A,U as r,aV as c,ar as C,bi as F,as as f,a_ as gt,F as I,ad as Q,af as yt,f as l,at as T,E as Ft,ag as O,V as _,r as Et,o as Ct,g as ft,aQ as vt}from"./vue-c7e3516e.js";import{cQ as L,cC as B,cr as _t,cK as U,cf as Bt,cR as V,cL as Dt}from"./antd-vue-vendor-1561c1ba.js";import ht from"./DetailModal-9ff720a1.js";import{_ as bt}from"./DynamicNotice.vue_vue_type_script_setup_true_name_dynamic-notice_lang-ad1713fe.js";import"./index-8cf3aabb.js";import{connectWebSocket as At,onWebSocket as kt}from"./useWebSocket-8ce99e59.js";import{r as wt}from"./mynews.api-a2cd7cb6.js";import Mt from"./SysMessageModal-ba731ef0.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./useFormItem-4a12ff45.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./JAddInput-2cbbbde9.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./index-ed4be6fa.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./SysMessageList-df53e9bc.js";import"./useSysMessage-bb4caff0.js";var J=(t=>(t.L="L",t.M="M",t.H="H",t))(J||{});const St=[{key:"1",name:"\u901A\u77E5",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"\u4F60\u6536\u5230\u4E86 14 \u4EFD\u65B0\u5468\u62A5",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"\u4F60\u63A8\u8350\u7684 \u66F2\u59AE\u59AE \u5DF2\u901A\u8FC7\u7B2C\u4E09\u8F6E\u9762\u8BD5",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"\u8FD9\u79CD\u6A21\u677F\u53EF\u4EE5\u533A\u5206\u591A\u79CD\u901A\u77E5\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u6807\u9898\u53EF\u4EE5\u8BBE\u7F6E\u81EA\u52A8\u663E\u793A\u7701\u7565\u53F7\uFF0C\u672C\u4F8B\u4E2D\u6807\u9898\u884C\u6570\u5DF2\u8BBE\u4E3A1\u884C\uFF0C\u5982\u679C\u5185\u5BB9\u8D85\u8FC71\u884C\u5C06\u81EA\u52A8\u622A\u65AD\u5E76\u652F\u6301tooltip\u663E\u793A\u5B8C\u6574\u6807\u9898\u3002",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"\u5DE6\u4FA7\u56FE\u6807\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u7C7B\u578B",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"\u7CFB\u7EDF\u6D88\u606F",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u66F2\u4E3D\u4E3D \u8BC4\u8BBA\u4E86\u4F60",description:"\u63CF\u8FF0\u4FE1\u606F\u63CF\u8FF0\u4FE1\u606F\u63CF\u8FF0\u4FE1\u606F",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u6731\u504F\u53F3 \u56DE\u590D\u4E86\u4F60",description:"\u8FD9\u79CD\u6A21\u677F\u7528\u4E8E\u63D0\u9192\u8C01\u4E0E\u4F60\u53D1\u751F\u4E86\u4E92\u52A8",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u6807\u9898",description:"\u8BF7\u5C06\u9F20\u6807\u79FB\u52A8\u5230\u6B64\u5904\uFF0C\u4EE5\u4FBF\u6D4B\u8BD5\u8D85\u957F\u7684\u6D88\u606F\u5728\u6B64\u5904\u5C06\u5982\u4F55\u5904\u7406\u3002\u672C\u4F8B\u4E2D\u8BBE\u7F6E\u7684\u63CF\u8FF0\u6700\u5927\u884C\u6570\u4E3A2\uFF0C\u8D85\u8FC72\u884C\u7684\u63CF\u8FF0\u5185\u5BB9\u5C06\u88AB\u7701\u7565\u5E76\u4E14\u53EF\u4EE5\u901A\u8FC7tooltip\u67E5\u770B\u5B8C\u6574\u5185\u5BB9",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}],Tt=t=>H.get({url:"/sys/annountCement/listByUser",params:t}),K=(t,o)=>H.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:M({anntId:t},o)}),jt=X({components:{[L.name]:L,[B.name]:B,[B.Item.name]:B.Item,AListItemMeta:B.Item.Meta,ATypographyParagraph:_t.Paragraph,[U.name]:U,Time:mt},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(t,{emit:o}){const{prefixCls:s}=W("header-notify-list"),p=j(t.currentPage||1),g=b(()=>{const{pageSize:e,list:n}=t;if(e===!1)return[];let m=it(e)?e:5;return n.slice(m*(A(p)-1),m*A(p))});dt(()=>t.currentPage,e=>{p.value=e});const E=b(()=>!!t.onTitleClick),y=b(()=>{const{list:e,pageSize:n}=t;return n>0&&e&&e.length>n?{total:e.length,pageSize:n,current:A(p),onChange(m){p.value=m,o("update:currentPage",m)}}:!1});function i(e){t.onTitleClick&&t.onTitleClick(e)}return{prefixCls:s,getPagination:y,getData:g,handleTitleClick:i,isTitleClickable:E,PriorityTypes:J}}});const Nt={class:"title"},Pt={key:0,class:"extra"},zt={key:2},Gt={key:0,class:"description"},$t={class:"datetime"};function Rt(t,o,s,p,g,E){const y=r("a-typography-paragraph"),i=r("a-tag"),e=r("a-avatar"),n=r("Icon"),m=r("Time"),k=r("a-list-item-meta"),v=r("a-list-item"),D=r("a-list");return c(),C(D,{class:Q(t.prefixCls),pagination:t.getPagination},{default:F(()=>[(c(!0),f(I,null,gt(t.getData,a=>(c(),C(v,{key:a.id,class:"list-item",onClick:N=>t.handleTitleClick(a),style:yt({cursor:t.isTitleClickable?"pointer":""})},{default:F(()=>[l(k,null,{title:F(()=>[T("div",Nt,[l(y,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!a.titleDelete,ellipsis:t.$props.titleRows&&t.$props.titleRows>0?{rows:t.$props.titleRows,tooltip:!!a.title}:!1,content:a.title},null,8,["delete","ellipsis","content"]),a.extra?(c(),f("div",Pt,[l(i,{class:"tag",color:a.color},{default:F(()=>[Ft(O(a.extra),1)]),_:2},1032,["color"])])):_("",!0)])]),avatar:F(()=>[a.avatar?(c(),C(e,{key:0,class:"avatar",src:a.avatar},null,8,["src"])):a.priority?(c(),f(I,{key:1},[a.priority===t.PriorityTypes.L?(c(),C(e,{key:0,class:"avatar priority-L",title:"\u4E00\u822C\u6D88\u606F"},{icon:F(()=>[l(n,{icon:"entypo:info"})]),_:1})):_("",!0),a.priority===t.PriorityTypes.M?(c(),C(e,{key:1,class:"avatar priority-M",title:"\u91CD\u8981\u6D88\u606F"},{icon:F(()=>[l(n,{icon:"bi:exclamation-lg"})]),_:1})):_("",!0),a.priority===t.PriorityTypes.H?(c(),C(e,{key:2,class:"avatar priority-H",title:"\u7D27\u6025\u6D88\u606F"},{icon:F(()=>[l(n,{icon:"ant-design:warning-filled"})]),_:1})):_("",!0)],64)):(c(),f("span",zt,O(a.avatar),1))]),description:F(()=>[T("div",null,[a.description?(c(),f("div",Gt,[l(y,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:t.$props.descRows&&t.$props.descRows>0?{rows:t.$props.descRows,tooltip:!!a.description}:!1,content:a.description},null,8,["ellipsis","content"])])):_("",!0),T("div",$t,[l(m,{value:a.datetime,title:a.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const It=q(jt,[["render",Rt],["__scopeId","data-v-f011ee3f"]]),Ot=X({components:{Popover:Bt,BellOutlined:nt,Tabs:V,TabPane:V.TabPane,Badge:Dt,NoticeList:It,DetailModal:ht,DynamicNotice:bt,SysMessageModal:Mt},setup(){const{prefixCls:t}=W("header-notify"),o=ft(),s=rt(),p=lt(),g=Et({path:"",formData:{}}),[E,y]=R(),i=j(St),e=b(()=>{let u=0;for(let d=0;d<i.value.length;d++)u+=i.value[d].count;return u}),[n,{openModal:m}]=R();function k(){for(let u=0;u<i.value.length;u++)i.value[u].count=0;m(!0,{})}const v=j(!1);Ct(()=>{Y()});function D(u){return $(M({},u),{title:u.titile,description:u.msgAbstract,datetime:u.sendTime})}function a(){return S(this,null,function*(){try{let{anntMsgList:u,sysMsgList:d,anntMsgTotal:h,sysMsgTotal:w}=yield Tt({pageSize:5});i.value[0].list=u.map(D),i.value[1].list=d.map(D),i.value[0].count=h,i.value[1].count=w}catch(u){}})}a();function N(u){var d;try{K(u.id),a()}catch(h){}u.openType==="component"?(g.path=u.openPage,g.formData={id:u.busId},(d=o.refs.dynamicNoticeRef)==null||d.detail(u.openPage)):y.openModal(!0,{record:u,isUpdate:!0}),v.value=!1}function Y(){var P;let u=ct(),d=pt(u),h=A(s.getUserInfo).id+"_"+d,w=((P=p.domainUrl)==null?void 0:P.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+h;At(w),kt(Z)}function Z(u){(u.cmd==="topic"||u.cmd==="user")&&setTimeout(()=>{a()},1e3)}function x(){v.value=!1,wt({},a)}function tt(u){return S(this,null,function*(){try{yield K(u),yield a()}catch(d){}})}return{prefixCls:t,listData:i,count:e,clickBadge:k,registerMessageModal:n,reloadCount:tt,onNoticeClick:N,onEmptyNotify:x,numberStyle:{},popoverVisible:v,registerDetail:E,dynamicNoticeProps:g}}});function Lt(t,o,s,p,g,E){const y=r("BellOutlined"),i=r("Badge"),e=r("DynamicNotice"),n=r("DetailModal"),m=r("sys-message-modal");return c(),f("div",{class:Q(t.prefixCls)},[l(i,{count:t.count,overflowCount:9,offset:[-4,10],numberStyle:t.numberStyle,onClick:t.clickBadge},{default:F(()=>[l(y)]),_:1},8,["count","numberStyle","onClick"]),l(e,vt({ref:"dynamicNoticeRef"},t.dynamicNoticeProps),null,16),l(n,{onRegister:t.registerDetail},null,8,["onRegister"]),l(m,{onRegister:t.registerMessageModal,onRefresh:t.reloadCount},null,8,["onRegister","onRefresh"])],2)}const Se=q(Ot,[["render",Lt]]);export{Se as default};
