var A=Object.defineProperty;var P=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=(t,n,i)=>n in t?A(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,C=(t,n)=>{for(var i in n||(n={}))B.call(n,i)&&S(t,i,n[i]);if(P)for(var i of P(n))D.call(n,i)&&S(t,i,n[i]);return t};import{q as E,s as G,t as N,b as w,v as J,u as K}from"./jeecg-online-vendor-4c7dd9e8.js";import{k as o,u as a}from"./vue-bcbaddf9.js";import"./antd-vue-vendor-a78909e6.js";import"./tinymce-vendor-676f8393.js";import"./vxe-table-vendor-9edfd3ae.js";import"./lodash-es-vendor-9b741fb8.js";function ee(){const{createMessage:t,notification:n}=K(),{t:i}=E(),k=G(),I=N(),L=o(""),l=o({}),g=o(!1),h=o(!1),b=o(""),u=o(!1),p=o(!1),d=o(""),y=o(""),m=o(!1),f=o(""),v=o("");function M(e){let s=`${k.uploadUrl}/sys/thirdLogin/render/${e}`;window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),L.value=e,l.value={},g.value=!1;let F=function(H){let r=H.data;if(typeof r=="string")if(r==="登录失败")t.warning(r);else if(r.includes("绑定手机号")){h.value=!0;let z=r.split(",");b.value=z[1]}else c(r);else typeof r=="object"?r.isObj===!0&&(u.value=!0,l.value=C({},r)):t.warning("不识别的信息传递")};window.addEventListener("message",F,!1)}function c(e){a(g)===!1&&(g.value=!0,I.ThirdLogin({token:e,thirdType:a(L)}).then(s=>{s&&s.userInfo?n.success({message:i("sys.login.loginSuccessTitle"),description:`${i("sys.login.loginSuccessDesc")}: ${s.userInfo.realname}`,duration:3}):$(s)}))}function $(e){n.error({message:"登录失败",description:((e.response||{}).data||{}).message||e.message||"请求出现错误，请稍后再试",duration:4})}function j(){d.value="",y.value=l.value.uuid,u.value=!1,p.value=!0}function O(){m.value=!0,l.value.suffix=parseInt(Math.random()*98+1),w.post({url:"/sys/third/user/create",params:{thirdLoginInfo:a(l)}},{isTransformResponse:!1}).then(e=>{if(e.success){let s=e.result;c(s),u.value=!1}else t.warning(e.message)}).finally(()=>{m.value=!1})}function R(){let e=Object.assign({},a(l),{password:a(d)});w.post({url:"/sys/third/user/checkPassword",params:e},{isTransformResponse:!1}).then(s=>{s.success?(T(),c(s.result)):t.warning(s.message)})}function T(){p.value=!1,d.value="",y.value=""}function q(){return J({mobile:a(f),smsmode:"0"})}function x(){a(f)||U("请输入手机号"),a(v)||U("请输入验证码");let e={mobile:a(f),captcha:a(v),thirdUserUuid:a(b)};w.post({url:"/sys/thirdLogin/bindingThirdPhone",params:e},{isTransformResponse:!1}).then(s=>{s.success?(h.value=!1,c(s.result)):t.warning(s.message)})}function U(e){n.error({message:"登录失败",description:e,duration:4})}return{thirdPasswordShow:p,thirdLoginCheckPassword:R,thirdLoginNoPassword:T,thirdLoginPassword:d,thirdConfirmShow:u,thirdCreateUserLoding:m,thirdLoginUserCreate:O,thirdLoginUserBind:j,bindingPhoneModal:h,thirdHandleOk:x,thirdPhone:f,thirdCaptcha:v,onThirdLogin:M,sendCodeApi:q}}export{ee as useThirdLogin};
