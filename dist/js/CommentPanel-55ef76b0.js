var T=(t,l,s)=>new Promise((e,g)=>{var v=i=>{try{a(s.next(i))}catch(c){g(c)}},u=i=>{try{a(s.throw(i))}catch(c){g(c)}},a=i=>i.done?e(i.value):Promise.resolve(i.value).then(v,u);a((s=s.apply(t,l)).next())});import{g as te,aR as Ue,p as S,E as Be}from"./index-fde9c72f.js";import{d as De,ad as O,l as Ae,b6 as ue,_ as P,cc as je,cd as Ee,ce as Me,c as be}from"./jeecg-online-vendor-bf2efbcb.js";import{U as Ne}from"./JAddInput-2cbbbde9.js";import"./index-8cf3aabb.js";import{c as He,_ as $e}from"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import{k as L,r as Re,J as Ce,w as ne,U as _,aV as y,as as I,f as r,bi as h,at as n,E as B,F as M,a_ as ae,af as N,ag as U,ad as z,V as A,aX as se,aW as le,c as oe,e as re,v as ge,by as Oe,A as Pe,ar as R,d as Ve,o as qe,s as me}from"./vue-c7e3516e.js";import{cb as W,M as _e,v as fe,S as ie,D as ve,dd as ze,ck as We,U as Ye,E as Ge}from"./antd-vue-vendor-1561c1ba.js";const he="/assets/excel.73e31c52.svg",Ke="/assets/other.c9fbb14a.svg",Je="/assets/pdf.f8d68ae5.svg",Xe="/assets/txt.8d556a18.svg",ye="/assets/word.9460f3fc.svg";var Ze=typeof window!="undefined";Ze&&function(){for(var t=0,l=["ms","moz","webkit","o"],s=0;s<l.length&&!window.requestAnimationFrame;++s)window.requestAnimationFrame=window[l[s]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[l[s]+"CancelAnimationFrame"]||window[l[s]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,g){var v=new Date().getTime(),u=Math.max(0,16-(v-t)),a=window.setTimeout(function(){e(v+u)},u);return t=v+u,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();const Qe=De(),et=Qe.uploadUrl;let q="";const tt=()=>O.get({url:"/sys/comment/getFileViewDomain"}),nt=t=>O.get({url:"/sys/comment/listByForm",params:t}),ot=t=>{let l={id:t};return O.get({url:"/sys/comment/queryById",params:l},{isTransformResponse:!1})},at=t=>O.get({url:"/sys/comment/fileList",params:t}),st=t=>O.delete({url:"/sys/comment/deleteOne",params:t},{joinParamsToUrl:!0}),lt=t=>{let l="/sys/comment/addText";return O.post({url:l,params:t},{isTransformResponse:!1})},it=t=>O.get({url:"/sys/dataLog/queryDataVerList",params:t},{isTransformResponse:!1}),we=`${et}/sys/comment/addFile`;function Ie(t){let l={biz:"comment",commentId:""};const{createMessage:s}=Ae(),e=L(!1);function g(i,c){return T(this,null,function*(){e.value=!0,setTimeout(()=>{e.value=!1},500),yield v(i),yield a(c)})}function v(i){return T(this,null,function*(){const{fromUserId:c,toUserId:d,commentId:f,commentContent:p}=i;let F={tableName:t.tableName,tableDataId:t.dataId,fromUserId:c,commentContent:p,toUserId:"",commentId:""};d&&(F.toUserId=d),f&&(F.commentId=f),l.commentId="";const k=yield lt(F);if(k.success)l.commentId=k.result;else return s.warning(k.message),Promise.reject("\u4FDD\u5B58\u8BC4\u8BBA\u5931\u8D25")})}function u(i){return T(this,null,function*(){let c=we;const d=new FormData;return d.append("file",i),d.append("tableName",t.tableName),d.append("tableDataId",t.dataId),Object.keys(l).map(f=>{d.append(f,l[f])}),new Promise((f,p)=>{Ue(c,d).then(F=>{F&&F.data?F.data.result=="success"?f(1):(s.warning(F.data.message),p()):p()})})})}function a(i){return T(this,null,function*(){if(i&&i.length>0)for(let c=0;c<i.length;c++){let d=Ce(i[c]);yield u(d.originFileObj)}})}return{saveCommentAndFiles:g,buttonLoading:e}}function pe(){const t=Re({}),l={xls:he,xlsx:he,pdf:Je,txt:Xe,docx:ye,doc:ye};function s(o){if(d(o))return"none";{const m=o.name;if(!m)return"none";const C=m.substring(m.lastIndexOf(".")+1);let j=l[C];return j||(j=Ke),j}}function e(o,m){return new Promise((C,j)=>{let $=new FileReader;o?($.readAsDataURL(o),$.onload=function(){let V=$.result;t[m]=V,C(V)}):j()})}function g(o){if(d(o)){let m=o.uid;e(o,m)}}function v(o){let m=te(o.url);m&&window.open(m)}function u(o){let m=o.fileSize;return m?Math.round(m/1024)+" KB":"0B"}const a=L([]);function i(o){return g(o),a.value=[...a.value,o],!1}function c(o){const m=a.value.indexOf(o),C=a.value.slice();C.splice(m,1),a.value=C}function d(o){return(o.type||"").indexOf("image")>=0}function f(o){if(d(o)){let m=o.uid;if(m){if(t[m])return t[m]}else if(o.url)return te(o.url)}return""}function p(o){let m=f(o);return m?{backgroundImage:"url('"+m+"')"}:{}}function F(o){return T(this,null,function*(){if(d(o)){let m=f(o);m&&He({imageList:[m]})}else if(o.url){let m=te(o.url);yield k(),window.open(q+"?officePreviewType=pdf&url="+encodeURIComponent(m))}})}function k(){return T(this,null,function*(){q||(q=yield tt()),q.startsWith("http")||(q="http://"+q)})}return{selectFileList:a,getBackground:s,getFileSize:u,downLoad:v,beforeUpload:i,handleRemove:c,isImage:d,getImageSrc:f,getImageAsBackground:p,viewImage:F}}function ke(t){const l=new RegExp("([^:]+)?(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)","g");function s(v){return v?v.replace(l,function(u,a,i){const c=a||"";if(e(c,'alt="')||e(c,'data-text="'))return u;let d=t.findEmoji(i);return d?c+g(d):u}):""}function e(v,u){return v.endsWith(u)}function g(v){return`<span style="width: 24px" class="emoji-mart-emoji"><span class="my-emoji-icon emoji-set-apple emoji-type-image" style="${`position: absolute;top: -3px;left: 3px;width: 18px; height: 18px;background-position: ${v.getPosition()}`}"> </span> </span>`}return{globalEmojiIndex:t,getHtml:s}}function ct(){return window.innerHeight}const dt={name:"UploadChunk",components:{Tooltip:W,UploadOutlined:ue,FolderOutlined:_e,DownloadOutlined:fe,PaperClipOutlined:ie,DeleteOutlined:ve},props:{visible:{type:Boolean,default:!1}},emits:["select"],setup(t,{emit:l}){const{selectFileList:s,beforeUpload:e,handleRemove:g,getBackground:v,isImage:u,getImageSrc:a,viewImage:i}=pe();function c(){return Ce(s.value)}function d(){s.value=[]}return ne(()=>s.value,f=>{if(f&&f.length>0){let p=f[0].name;p&&l("select",p)}}),{selectFileList:s,beforeUpload:e,handleRemove:g,getBackground:v,getUploadFileList:c,clear:d,isImage:u,getImageSrc:a,viewImage:i}}};const Y=t=>(se("data-v-bcc0a033"),t=t(),le(),t),rt={key:0},ut={class:"j-icon"},mt={class:"inner-button"},_t={class:"j-icon"},ft={class:"inner-button"},vt={key:0,class:"selected-file-warp"},pt={class:"selected-file-list"},gt={class:"item"},ht={class:"complex"},yt={class:"content"},bt={key:0,class:"content-top",style:{height:"100%"}},Ct={class:"content-top"},wt=["title"],It=["onClick"],kt={class:"text"},Ft={class:"buttons"},Lt={class:"opt-icon"},xt=Y(()=>n("div",{class:"item empty"},null,-1)),Tt=Y(()=>n("div",{class:"item empty"},null,-1)),St=Y(()=>n("div",{class:"item empty"},null,-1)),Ut=Y(()=>n("div",{class:"item empty"},null,-1)),Bt=Y(()=>n("div",{class:"item empty"},null,-1)),Dt=Y(()=>n("div",{class:"item empty"},null,-1));function At(t,l,s,e,g,v){const u=_("upload-outlined"),a=_("a-upload"),i=_("folder-outlined"),c=_("a-alert"),d=_("delete-outlined"),f=_("Tooltip");return s.visible?(y(),I("div",rt,[r(c,{type:"info",class:"jeecg-comment-files",style:{margin:"0"}},{message:h(()=>[n("span",ut,[r(a,{multiple:"","file-list":e.selectFileList,"onUpdate:fileList":l[0]||(l[0]=p=>e.selectFileList=p),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[n("span",mt,[r(u),B("\u4E0A\u4F20")])]),_:1},8,["file-list","before-upload"])]),n("span",_t,[n("span",ft,[r(i),B("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?")])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(y(),I("div",vt,[n("div",pt,[(y(!0),I(M,null,ae(e.selectFileList,p=>(y(),I("div",gt,[n("div",ht,[n("div",yt,[e.isImage(p)?(y(),I("div",bt,[n("div",{class:"content-image",style:N({height:"100%",backgroundImage:"url("+e.getImageSrc(p)+")"})},null,4)])):(y(),I(M,{key:1},[n("div",Ct,[n("div",{class:"content-icon",style:N({background:"url("+e.getBackground(p)+")  no-repeat"})},null,4)]),n("div",{class:"content-bottom",title:p.name},[n("span",null,U(p.name),1)],8,wt)],64))]),n("div",{class:z(["layer",{"layer-image":e.isImage(p)}])},[n("div",{class:"next",onClick:F=>e.viewImage(p)},[n("div",kt,U(p.name),1)],8,It),n("div",Ft,[n("div",Lt,[r(f,{title:"\u5220\u9664"},{default:h(()=>[r(d,{onClick:F=>e.handleRemove(p)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),xt,Tt,St,B(),Ut,Bt,Dt])])):A("",!0)])):A("",!0)}const jt=P(dt,[["render",At],["__scopeId","data-v-bcc0a033"]]);const Et={categories:{recent:"\u6700\u5E38\u7528\u7684",smileys:"\u8868\u60C5\u9009\u62E9",people:"\u4EBA\u7269&\u8EAB\u4F53",nature:"\u52A8\u7269&\u81EA\u7136",foods:"\u98DF\u7269&\u996E\u6599",activity:"\u6D3B\u52A8",places:"\u65C5\u884C&\u5730\u70B9",objects:"\u7269\u54C1",symbols:"\u7B26\u53F7",flags:"\u65D7\u5E1C"}},Mt={name:"MyComment",components:{UserAddOutlined:je,Tooltip:W,UserSelectModal:Ne,PaperClipOutlined:ie,UploadChunk:jt,SmileOutlined:Ee},props:{inner:S.bool.def(!1),inputFocus:{type:Boolean,default:!1}},emits:["cancel","comment"],setup(t,{emit:l}){const s=L(!1),e=L(),[g,{openModal:v}]=Be(),u=L(!1),a=L("");function i(){let b=a.value;if(!b&&b!=="0")c.value=!0;else{u.value=!0;let E=[];s.value==!0&&(E=e.value.getUploadFileList()),l("comment",b,E),setTimeout(()=>{u.value=!1},350)}}const c=L(!1);ne(a,()=>{let b=a.value;!b&&b!=="0"?c.value=!0:c.value=!1});function d(){l("cancel")}const f=L();ne(()=>t.inputFocus,b=>{b==!0&&(a.value="",s.value==!0&&(e.value.clear(),s.value=!1))},{deep:!0,immediate:!0});function p(){v(!0,{isUpdate:!1})}function F(b){if(b&&b.length>0){const{label:E,value:H}=b[0];if(E&&H){let de=`${E}[${H}]`,ee=a.value;ee?ee.endsWith("@")?a.value=ee+de:a.value="@"+de+" "+ee:a.value="@"+de}}}function k(){}ne(()=>a.value,b=>{b&&b.endsWith("@")&&p()});const o=L();function m(b){let E=a.value||"";E+=b,a.value=E,o.value.click()}const C=L(!1);function j(b){let E=a.value||"",H=b.colons;H.indexOf("::")>0&&(H=H.substring(0,H.indexOf(":")+1)),a.value=E+H,C.value=!1,Z()}const $={width:"490px"};function V(b){b.preventDefault(),b.stopPropagation(),C.value=!1,Q.value=!0}function J(b){b.preventDefault(),b.stopPropagation(),C.value=!C.value}const X=oe("$globalEmojiIndex"),{getHtml:ce}=ke(X),w=re(()=>{let b=a.value;return b?ce(b):"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"}),x=L(!1);function D(b){b.preventDefault(),b.stopPropagation(),x.value=!1,f.value.focus(),Q.value=!0}function Z(){x.value=!0}const Q=L(!1),xe=re(()=>!(a.value.length>0));function Te(){a.value.length==0&&(Q.value=!1,s.value=!1)}function Se(b){a.value.length==0&&(a.value=b)}return{myComment:a,sendComment:i,noComment:d,disabledButton:c,buttonLoading:u,commentRef:f,registerModal:g,openSelectUser:p,setValue:F,handleCommentChange:k,uploadRef:e,uploadVisible:s,onSelectEmoji:m,optionsName:Et,emojiButton:o,emojiIndex:X,showEmoji:j,pickerStyles:$,visibleEmoji:C,handleClickBlank:V,handleShowEmoji:J,commentHtml:w,showHtml:x,handleClickHtmlShower:D,handleBlur:Z,commentActive:Q,noConent:xe,changeActive:Te,selectFirstFile:Se}}};const Nt=["innerHTML"],Ht={key:0,class:"comment-buttons"},$t={style:{cursor:"pointer"}},Rt={title:"\u8868\u60C5",style:{display:"inline-block"}},Ot={style:{position:"relative"}},Pt={key:0},Vt=n("span",null,null,-1);function qt(t,l,s,e,g,v){const u=_("user-add-outlined"),a=_("Tooltip"),i=_("PaperClipOutlined"),c=_("SmileOutlined"),d=_("a-button"),f=_("upload-chunk"),p=_("UserSelectModal"),F=_("Picker"),k=_("a-modal");return y(),I(M,null,[n("div",{class:z({"comment-active":e.commentActive}),style:{border:"1px solid #eee",margin:"0",position:"relative"},onClick:l[5]||(l[5]=(...o)=>e.handleClickBlank&&e.handleClickBlank(...o))},[ge(n("textarea",{ref:"commentRef","onUpdate:modelValue":l[0]||(l[0]=o=>e.myComment=o),onInput:l[1]||(l[1]=(...o)=>e.handleCommentChange&&e.handleCommentChange(...o)),onBlur:l[2]||(l[2]=(...o)=>e.handleBlur&&e.handleBlur(...o)),class:"comment-content",rows:3,placeholder:"\u8BF7\u8F93\u5165\u4F60\u7684\u8BC4\u8BBA\uFF0C\u53EF\u4EE5@\u6210\u5458"},null,544),[[Oe,e.myComment]]),n("div",{class:z(["comment-content comment-html-shower",{"no-content":e.noConent,"top-div":e.showHtml,"bottom-div":e.showHtml==!1}]),innerHTML:e.commentHtml,onClick:l[3]||(l[3]=(...o)=>e.handleClickHtmlShower&&e.handleClickHtmlShower(...o))},null,10,Nt),e.commentActive?(y(),I("div",Ht,[n("div",$t,[r(a,{title:"\u9009\u62E9@\u7528\u6237"},{default:h(()=>[r(u,{onClick:e.openSelectUser},null,8,["onClick"])]),_:1}),r(a,{title:"\u4E0A\u4F20\u9644\u4EF6"},{default:h(()=>[r(i,{onClick:l[4]||(l[4]=o=>e.uploadVisible=!e.uploadVisible)})]),_:1}),n("span",Rt,[r(c,{ref:"emojiButton",onClick:e.handleShowEmoji},null,8,["onClick"]),ge(n("div",Ot,null,512),[[Pe]])])]),e.commentActive?(y(),I("div",Pt,[s.inner?(y(),R(d,{key:0,onClick:e.noComment,style:{"margin-right":"10px"}},{default:h(()=>[B("\u53D6\u6D88")]),_:1},8,["onClick"])):A("",!0),r(d,{type:"primary",onClick:e.sendComment,loading:e.buttonLoading,disabled:e.disabledButton},{default:h(()=>[B("\u53D1 \u9001")]),_:1},8,["onClick","loading","disabled"])])):A("",!0)])):A("",!0),r(f,{ref:"uploadRef",visible:e.uploadVisible,onSelect:e.selectFirstFile},null,8,["visible","onSelect"])],2),r(p,{labelKey:"realname",rowKey:"username",onRegister:e.registerModal,onGetSelectResult:e.setValue,isRadioSelection:""},null,8,["onRegister","onGetSelectResult"]),r(k,{visible:e.visibleEmoji,"onUpdate:visible":l[6]||(l[6]=o=>e.visibleEmoji=o),footer:null,wrapClassName:"emoji-modal",closable:!1,width:490},{title:h(()=>[Vt]),default:h(()=>[r(F,{pickerStyles:e.pickerStyles,i18n:e.optionsName,data:e.emojiIndex,emoji:"grinning",showPreview:!1,infiniteScroll:!1,showSearch:!1,showSkinTones:!1,set:"apple",onSelect:e.showEmoji},null,8,["pickerStyles","i18n","data","onSelect"])]),_:1},8,["visible"])],64)}const zt=P(Mt,[["render",qt]]);const Wt={name:"HistoryFileList",props:{dataList:{type:Array,default:()=>[]},isComment:{type:Boolean,default:!1}},components:{UploadOutlined:ue,FolderOutlined:_e,DownloadOutlined:fe,PaperClipOutlined:ie,DeleteOutlined:ve,Tooltip:W},setup(){const{getBackground:t,getFileSize:l,downLoad:s,isImage:e,getImageAsBackground:g,viewImage:v}=pe();return{getBackground:t,downLoad:s,getFileSize:l,isImage:e,getImageAsBackground:g,viewImage:v}}},G=t=>(se("data-v-aedc2293"),t=t(),le(),t),Yt={class:"selected-file-list"},Gt={class:"item"},Kt={class:"complex"},Jt={class:"content"},Xt={key:0,class:"content-top",style:{height:"100%"}},Zt={class:"content-top"},Qt=["title"],en=["onClick"],tn={class:"text"},nn={class:"text"},on={class:"buttons"},an={class:"opt-icon"},sn=G(()=>n("div",{class:"item empty"},null,-1)),ln=G(()=>n("div",{class:"item empty"},null,-1)),cn=G(()=>n("div",{class:"item empty"},null,-1)),dn=G(()=>n("div",{class:"item empty"},null,-1)),rn=G(()=>n("div",{class:"item empty"},null,-1)),un=G(()=>n("div",{class:"item empty"},null,-1));function mn(t,l,s,e,g,v){const u=_("download-outlined"),a=_("Tooltip");return y(),I("div",{class:z(["comment-file-his-list",s.isComment===!0?"in-comment":""])},[n("div",Yt,[(y(!0),I(M,null,ae(s.dataList,i=>(y(),I("div",Gt,[n("div",Kt,[n("div",Jt,[e.isImage(i)?(y(),I("div",Xt,[n("div",{class:"content-image",style:N(e.getImageAsBackground(i))},null,4)])):(y(),I(M,{key:1},[n("div",Zt,[n("div",{class:"content-icon",style:N({background:"url("+e.getBackground(i)+")  no-repeat"})},null,4)]),n("div",{class:"content-bottom",title:i.name},[n("span",null,U(i.name),1)],8,Qt)],64))]),n("div",{class:z(["layer",{"layer-image":e.isImage(i)}])},[n("div",{class:"next",onClick:c=>e.viewImage(i)},[n("div",tn,U(i.name),1),n("div",nn,U(e.getFileSize(i)),1)],8,en),n("div",on,[n("div",an,[r(a,{title:"\u4E0B\u8F7D"},{default:h(()=>[r(u,{onClick:c=>e.downLoad(i)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),sn,ln,cn,B(),dn,rn,un])],2)}const Fe=P(Wt,[["render",mn],["__scopeId","data-v-aedc2293"]]);const _n=Ve({name:"CommentList",components:{MessageOutlined:Me,AComment:ze,Tooltip:W,MyComment:zt,Popconfirm:We,HistoryFileList:Fe},props:{tableName:S.string.def(""),dataId:S.string.def(""),datetime:S.number.def(1)},setup(t){const l=L([]),{userInfo:s}=be(),e=oe("$dayjs");function g(){return s.realname?s.realname.substr(0,2):""}function v(){return s.avatar}function u(w){return w.fromUserAvatar?te(w.fromUserAvatar):""}function a(w){return w.fromUserId_dictText?w.fromUserId_dictText.substr(0,2):"\u672A\u77E5"}function i(w){return w.toUser?w.fromUserId_dictText+" \u56DE\u590D "+w.fromUserId_dictText:w.fromUserId_dictText}function c(w){return w.createTime?e(w.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}const d=L(300),f=L(300);qe(()=>{d.value=window.innerHeight-57-46-70-160,f.value=window.innerHeight-57-46-53-20});function p(){return T(this,null,function*(){const w={tableName:t.tableName,tableDataId:t.dataId,column:"createTime",order:"desc"},x=yield nt(w);if(!x||!x.records||x.records.length==0)l.value=[];else{let D=x.records;l.value=D}})}const{saveCommentAndFiles:F}=Ie(t);function k(w,x,D){return T(this,null,function*(){let Z={fromUserId:s.id,toUserId:w.fromUserId,commentId:w.id,commentContent:x};yield F(Z,D),yield p()})}function o(w,x){return T(this,null,function*(){let D={fromUserId:s.id,commentContent:w};yield F(D,x),yield p(),C.value=!1,setTimeout(()=>{C.value=!0},100)})}function m(w){return T(this,null,function*(){const x={id:w.id};yield st(x),yield p()})}const C=L(!1);function j(w){let x=l.value;for(let D of x)D.commentStatus=!1;w.commentStatus=!0,C.value=!1,C.value=!0}me(()=>{t.datetime&&t.tableName&&t.dataId&&p()});const $=oe("$globalEmojiIndex"),{getHtml:V}=ke($),J=L();function X(){J.value.changeActive()}function ce(w,x){return T(this,null,function*(){if(w==!0&&!x.commentId_dictText){const D=yield ot(x.commentId);D.success==!0?x.commentId_dictText=D.result.commentContent:x.commentId_dictText="\u8BE5\u8BC4\u8BBA\u5DF2\u88AB\u5220\u9664"}})}return{dataList:l,getAvatar:u,getAvatarText:a,getAuthor:i,getDateDiff:c,commentHeight:d,allHeight:f,replyComment:k,sendComment:o,getMyname:g,getMyAvatar:v,focusStatus:C,showReply:j,deleteComment:m,getHtml:V,handleClickItem:X,bottomCommentRef:J,visibleChange:ce}}}),Le=t=>(se("data-v-82bce0f0"),t=t(),le(),t),fn={class:"comment-author"},vn=Le(()=>n("span",null,"\u56DE\u590D",-1)),pn=["innerHTML"],gn=["onClick"],hn=Le(()=>n("span",null,"\u5220\u9664",-1)),yn=["innerHTML"],bn={key:0},Cn={key:0,class:"inner-comment"},wn={style:{position:"absolute",bottom:"0",left:"0",width:"100%",background:"#fff","border-top":"1px solid #eee"}};function In(t,l,s,e,g,v){const u=_("a-avatar"),a=_("message-outlined"),i=_("Tooltip"),c=_("Popconfirm"),d=_("history-file-list"),f=_("a-comment"),p=_("my-comment"),F=_("a-list-item"),k=_("a-list");return y(),I("div",{style:N({position:"relative",height:t.allHeight+"px"})},[r(k,{class:"jeecg-comment-list",header:"","item-layout":"horizontal","data-source":t.dataList,style:N({height:t.commentHeight+"px"})},{renderItem:h(({item:o})=>[r(F,{style:{"padding-left":"10px","flex-direction":"column"},onClick:t.handleClickItem},{default:h(()=>[r(f,null,{avatar:h(()=>[r(u,{class:"tx",src:t.getAvatar(o),alt:t.getAvatarText(o)},{default:h(()=>[B(U(t.getAvatarText(o)),1)]),_:2},1032,["src","alt"])]),author:h(()=>[n("div",fn,[n("span",null,U(o.fromUserId_dictText),1),o.toUserId?(y(),I(M,{key:0},[vn,n("span",null,U(o.toUserId_dictText),1),r(i,{class:"comment-last-content",onVisibleChange:m=>t.visibleChange(m,o)},{title:h(()=>[n("div",{innerHTML:t.getHtml(o.commentId_dictText)},null,8,pn)]),default:h(()=>[r(a)]),_:2},1032,["onVisibleChange"])],64)):A("",!0)])]),datetime:h(()=>[n("div",null,[r(i,{title:o.createTime},{default:h(()=>[n("span",null,U(t.getDateDiff(o)),1)]),_:2},1032,["title"])])]),actions:h(()=>[n("span",{onClick:m=>t.showReply(o)},"\u56DE\u590D",8,gn),r(c,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:m=>t.deleteComment(o)},{default:h(()=>[hn]),_:2},1032,["onConfirm"])]),content:h(()=>[n("div",{innerHTML:t.getHtml(o.commentContent),style:{"font-size":"15px"}},null,8,yn),o.fileList&&o.fileList.length>0?(y(),I("div",bn,[r(d,{dataList:o.fileList,isComment:""},null,8,["dataList"])])):A("",!0)]),_:2},1024),o.commentStatus?(y(),I("div",Cn,[r(p,{inner:"",onCancel:m=>o.commentStatus=!1,onComment:(m,C)=>t.replyComment(o,m,C),inputFocus:t.focusStatus},null,8,["onCancel","onComment","inputFocus"])])):A("",!0)]),_:2},1032,["onClick"])]),_:1},8,["data-source","style"]),n("div",wn,[r(f,{style:{margin:"0 10px"}},{avatar:h(()=>[r(u,{class:"tx",src:t.getMyAvatar(),alt:t.getMyname()},{default:h(()=>[B(U(t.getMyname()),1)]),_:1},8,["src","alt"])]),content:h(()=>[r(p,{ref:"bottomCommentRef",onComment:t.sendComment,inputFocus:t.focusStatus},null,8,["onComment","inputFocus"])]),_:1})])],4)}const kn=P(_n,[["render",In],["__scopeId","data-v-82bce0f0"]]);const Fn={name:"CommentFiles",components:{UploadOutlined:ue,FolderOutlined:_e,JUpload:$e,DownloadOutlined:fe,PaperClipOutlined:ie,DeleteOutlined:ve,Tooltip:W,HistoryFileList:Fe},props:{tableName:S.string.def(""),dataId:S.string.def(""),datetime:S.number.def(1)},setup(t){const{userInfo:l}=be(),s=L([]),e=L("");function g(){return T(this,null,function*(){const m={tableName:t.tableName,tableDataId:t.dataId},C=yield at(m);if(!C||!C.records||C.records.length==0)s.value=[];else{let j=C.records;s.value=j}e.value=""})}me(()=>{t.datetime&&t.tableName&&t.dataId&&g()});const{saveCommentAndFiles:v,buttonLoading:u}=Ie(t),{selectFileList:a,beforeUpload:i,handleRemove:c,getBackground:d,isImage:f,getImageAsBackground:p,viewImage:F}=pe();function k(){a.value=[]}function o(){return T(this,null,function*(){let m={fromUserId:l.id,commentContent:"\u4E0A\u4F20\u4E86\u9644\u4EF6"};yield v(m,a.value),a.value=[],yield g()})}return{selectFileList:a,beforeUpload:i,handleRemove:c,getBackground:d,isImage:f,dataList:s,uploadFileUrl:we,quxiao:k,queding:o,buttonLoading:u,getImageAsBackground:p,viewImage:F}}},K=t=>(se("data-v-2dfba4e7"),t=t(),le(),t),Ln={class:"j-icon"},xn={class:"inner-button"},Tn={class:"j-icon"},Sn={class:"inner-button"},Un={key:0,class:"selected-file-warp"},Bn={class:"selected-file-list"},Dn={class:"item"},An={class:"complex"},jn={class:"content"},En={key:0,class:"content-top",style:{height:"100%"}},Mn={class:"content-top"},Nn=["title"],Hn=["onClick"],$n={class:"text"},Rn={class:"buttons"},On={class:"opt-icon"},Pn=K(()=>n("div",{class:"item empty"},null,-1)),Vn=K(()=>n("div",{class:"item empty"},null,-1)),qn=K(()=>n("div",{class:"item empty"},null,-1)),zn=K(()=>n("div",{class:"item empty"},null,-1)),Wn=K(()=>n("div",{class:"item empty"},null,-1)),Yn=K(()=>n("div",{class:"item empty"},null,-1)),Gn={style:{"margin-bottom":"24px","margin-top":"18px","text-align":"right"}};function Kn(t,l,s,e,g,v){const u=_("upload-outlined"),a=_("a-upload"),i=_("folder-outlined"),c=_("a-alert"),d=_("delete-outlined"),f=_("Tooltip"),p=_("a-button"),F=_("history-file-list");return y(),I("div",null,[r(c,{type:"info",class:"jeecg-comment-files"},{message:h(()=>[n("span",Ln,[r(a,{multiple:"","file-list":e.selectFileList,"onUpdate:fileList":l[0]||(l[0]=k=>e.selectFileList=k),showUploadList:!1,"before-upload":e.beforeUpload},{default:h(()=>[n("span",xn,[r(u),B("\u4E0A\u4F20")])]),_:1},8,["file-list","before-upload"])]),n("span",Tn,[n("span",Sn,[r(i),B("\u4ECE\u6587\u4EF6\u5E93\u9009\u62E9?")])])]),_:1}),e.selectFileList&&e.selectFileList.length>0?(y(),I("div",Un,[n("div",Bn,[(y(!0),I(M,null,ae(e.selectFileList,k=>(y(),I("div",Dn,[n("div",An,[n("div",jn,[e.isImage(k)?(y(),I("div",En,[n("div",{class:"content-image",style:N(e.getImageAsBackground(k))},null,4)])):(y(),I(M,{key:1},[n("div",Mn,[n("div",{class:"content-icon",style:N({background:"url("+e.getBackground(k)+")  no-repeat"})},null,4)]),n("div",{class:"content-bottom",title:k.name},[n("span",null,U(k.name),1)],8,Nn)],64))]),n("div",{class:z(["layer",{"layer-image":e.isImage(k)}])},[n("div",{class:"next",onClick:o=>e.viewImage(k)},[n("div",$n,U(k.name),1)],8,Hn),n("div",Rn,[n("div",On,[r(f,{title:"\u5220\u9664"},{default:h(()=>[r(d,{onClick:o=>e.handleRemove(k)},null,8,["onClick"])]),_:2},1024)])])],2)])]))),256)),Pn,Vn,qn,B(),zn,Wn,Yn]),n("div",Gn,[r(p,{onClick:e.quxiao},{default:h(()=>[B("\u53D6\u6D88")]),_:1},8,["onClick"]),r(p,{type:"primary",style:{"margin-left":"10px"},onClick:e.queding,loading:e.buttonLoading},{default:h(()=>[B("\u786E\u5B9A")]),_:1},8,["onClick","loading"])])])):A("",!0),r(F,{dataList:e.dataList},null,8,["dataList"])])}const Jn=P(Fn,[["render",Kn],["__scopeId","data-v-2dfba4e7"]]);const Xn={name:"DataLogList",components:{PlusOutlined:Ye,EditOutlined:Ge,Tooltip:W},props:{tableName:S.string.def(""),dataId:S.string.def(""),datetime:S.number.def(1)},setup(t){const l=oe("$dayjs"),s=ct(),e=L(300);e.value=s-46-57-53-30;const g=L([]),v=L(0);function u(){return T(this,null,function*(){const c={dataTable:t.tableName,dataId:t.dataId,type:"comment"},d=yield it(c);if(!d||!d.result||d.result.length==0)g.value=[],v.value=-1;else{let f=d.result;v.value=f.length-1,g.value=f}})}me(()=>{t.datetime&&t.tableName&&t.dataId&&u()});function a(c){return c.createTime?l(c.createTime,"YYYY-MM-DD hh:mm:ss").fromNow():""}function i(){}return{height:e,lastIndex:v,dataList:g,getDateDiff:a,handleClickPerson:i}}},Zn={class:"data-log-content"},Qn={class:"logbox"},eo={class:"log-item"},to={class:"log-item-icon"},no={class:"log-item-content"},oo={class:"log-item-date"};function ao(t,l,s,e,g,v){const u=_("plus-outlined"),a=_("edit-outlined"),i=_("Tooltip");return y(),I("div",{class:"data-log-scroll",style:N({height:e.height+"px"})},[n("div",Zn,[n("div",Qn,[(y(!0),I(M,null,ae(e.dataList,(c,d)=>(y(),I("div",eo,[n("span",to,[e.lastIndex==d?(y(),R(u,{key:0,style:{"margin-top":"3px"}})):(y(),R(a,{key:1}))]),n("span",no,[n("a",{onClick:l[0]||(l[0]=(...f)=>e.handleClickPerson&&e.handleClickPerson(...f))},"@"+U(c.createBy),1),B(" "+U(c.dataContent),1)]),n("div",oo,[r(i,{title:c.createTime},{default:h(()=>[n("span",null,U(e.getDateDiff(c)),1)]),_:2},1032,["title"])])]))),256))])])],4)}const so=P(Xn,[["render",ao],["__scopeId","data-v-fc975465"]]);const lo={name:"CommentPanel",components:{CommentList:kn,CommentFiles:Jn,DataLogList:so},props:{tableName:S.string.def(""),dataId:S.string.def(""),showComment:S.bool.def(!0),showFiles:S.bool.def(!0),showDataLog:S.bool.def(!0)},setup(t){const l=re(()=>!!(t.dataId&&t.tableName)),s=L(1),e=L(1),g=L(1);function v(a){let i=new Date().getTime();a=="comment"?s.value=i:a=="file"?e.value=i:g.value=i}function u(){let a=new Date().getTime();s.value=a,e.value=a,g.value=a}return{showStatus:l,handleChange:v,datetime1:s,datetime2:e,datetime3:g,reload:u}}},io={key:0,class:"comment-tabs-warp"};function co(t,l,s,e,g,v){const u=_("comment-list"),a=_("a-tab-pane"),i=_("comment-files"),c=_("data-log-list"),d=_("a-tabs"),f=_("a-empty");return e.showStatus?(y(),I("div",io,[r(d,{onChange:e.handleChange,animated:!1},{default:h(()=>[s.showComment?(y(),R(a,{tab:"\u8BC4\u8BBA",key:"comment",class:"comment-list-tab"},{default:h(()=>[r(u,{tableName:s.tableName,dataId:s.dataId,datetime:e.datetime1},null,8,["tableName","dataId","datetime"])]),_:1})):A("",!0),s.showFiles?(y(),R(a,{tab:"\u6587\u4EF6",key:"file"},{default:h(()=>[r(i,{tableName:s.tableName,dataId:s.dataId,datetime:e.datetime2},null,8,["tableName","dataId","datetime"])]),_:1})):A("",!0),s.showDataLog?(y(),R(a,{tab:"\u65E5\u5FD7",key:"log"},{default:h(()=>[r(c,{tableName:s.tableName,dataId:s.dataId,datetime:e.datetime3},null,8,["tableName","dataId","datetime"])]),_:1})):A("",!0)]),_:1},8,["onChange"])])):(y(),R(f,{key:1,description:"\u65B0\u589E\u9875\u9762\u4E0D\u652F\u6301\u8BC4\u8BBA"}))}const ho=P(lo,[["render",co],["__scopeId","data-v-8091174b"]]);export{ho as C};
