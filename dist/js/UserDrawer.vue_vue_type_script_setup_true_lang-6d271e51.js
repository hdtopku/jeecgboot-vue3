var S=Object.defineProperty;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var D=(i,s,r)=>s in i?S(i,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[s]=r,F=(i,s)=>{for(var r in s||(s={}))U.call(s,r)&&D(i,r,s[r]);if(v)for(var r of v(s))P.call(s,r)&&D(i,r,s[r]);return i};var y=(i,s,r)=>new Promise((w,c)=>{var h=o=>{try{d(r.next(o))}catch(p){c(p)}},g=o=>{try{d(r.throw(o))}catch(p){c(p)}},d=o=>o.done?w(o.value):Promise.resolve(o.value).then(h,g);d((r=r.apply(i,s)).next())});import{B as L}from"./BasicForm-030e7c21.js";import"./componentMap-90ab712d.js";import{u as k}from"./useForm-ae9e1cbd.js";import"./JAddInput-dff0b84f.js";import"./index-6916e394.js";import{f as O}from"./user.data-3ad1a75b.js";import{u as V,B as C}from"./index-1b5a8dbb.js";import{g as W,a as j,b as x,c as N,s as E}from"./user.api-ea86029c.js";import{useDrawerAdaptiveWidth as G}from"./useAdaptiveWidth-a9b934a6.js";import{bs as K}from"./jeecg-online-vendor-12004772.js";import{d as M,M as Q,k as m,e as $,u as t,aV as q,ar as z,bi as H,f as J,aQ as X}from"./vue-c7e3516e.js";const pe=M({__name:"UserDrawer",emits:["success","register"],setup(i,{emit:s}){Q();const r=m(!0),w=m(""),c=m([]),[h,{setProps:g,resetFields:d,setFieldsValue:o,validate:p,updateSchema:b}]=k({labelWidth:90,schemas:O,showActionButtonGroup:!1}),u=m(!0),[A,{setDrawerProps:I,closeDrawer:B}]=V(e=>y(this,null,function*(){var l;if(yield d(),u.value=(l=e==null?void 0:e.showFooter)!=null?l:!0,I({confirmLoading:!1,showFooter:u.value}),r.value=!!(e!=null&&e.isUpdate),t(r)){w.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const n=yield W({userid:e.record.id});n&&n.length>0&&(e.record.selectedroles=n)}catch(n){}const a=yield j({userId:e.record.id});if(a&&a.length>0){e.record.selecteddeparts=a;let n=Array.from(a,({key:f})=>f);e.record.selecteddeparts=n.join(","),c.value=a.map(f=>({label:f.title,value:f.key}))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=e.record.departIds==""?[]:e.record.departIds}e.selectedroles&&(yield o({selectedroles:e.selectedroles})),b([{field:"password",show:!t(r)},{field:"confirmPassword",ifShow:!t(r)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:c}},{field:"selecteddeparts",show:!(e!=null&&e.departDisabled)},{field:"selectedroles",show:!(e!=null&&e.departDisabled),componentProps:{api:e.tenantSaas?x:N}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!t(r)&&e.tenantSaas&&(yield o({relTenantIds:K().toString()})),typeof e.record=="object"&&o(F({},e.record)),g({disabled:!u.value})})),R=$(()=>t(r)?"\u7F16\u8F91\u7528\u6237":"\u65B0\u589E\u7528\u6237"),{adaptiveWidth:T}=G();function _(){return y(this,null,function*(){try{let e=yield p();I({confirmLoading:!0}),e.userIdentity===1&&(e.departIds="");let l=t(r);yield E(e,l),B(),s("success",{isUpdateVal:l,values:e})}finally{I({confirmLoading:!1})}})}return(e,l)=>(q(),z(t(C),X(e.$attrs,{onRegister:t(A),title:R.value,width:t(T),onOk:_,showFooter:u.value,destroyOnClose:""}),{default:H(()=>[J(t(L),{onRegister:t(h)},null,8,["onRegister"])]),_:1},16,["onRegister","title","width","showFooter"]))}});export{pe as _};
