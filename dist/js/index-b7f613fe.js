var me=Object.defineProperty,we=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var se=(e,y,s)=>y in e?me(e,y,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[y]=s,I=(e,y)=>{for(var s in y||(y={}))Ie.call(y,s)&&se(e,s,y[s]);if(ce)for(var s of ce(y))Ue.call(y,s)&&se(e,s,y[s]);return e},re=(e,y)=>we(e,Me(y));var ie=(e,y,s)=>new Promise((x,F)=>{var C=A=>{try{k(s.next(A))}catch(B){F(B)}},l=A=>{try{k(s.throw(A))}catch(B){F(B)}},k=A=>A.done?x(A.value):Promise.resolve(A.value).then(C,l);k((s=s.apply(e,y)).next())});import{d as Se,k as Ke,as as Pe,e as M,w as P,a5 as w,a6 as H,u as r,R as Oe,V as U,a9 as J,a7 as V,E as oe,ab as de,am as ue,f as L,F as Q,a8 as He,B as Ve,ae as Re,af as je,at as Xe,q as Ye,r as he,J as $,s as R,o as $e,v as ye,A as fe,ag as ze,i as qe}from"./vue-705b7309.js";import{q as Ge,a$ as ke,a0 as Je,Z,b0 as Ze,aR as Qe,b1 as We,i as et,b2 as pe}from"./jeecg-online-vendor-e26fc0e5.js";import{d as tt,ay as nt,t as W,az as at,ac as lt,a2 as ct}from"./index-ea73cedc.js";import{createBEM as xe}from"./bem-f204c89d.js";import{buildProps as st}from"./props-dec3c169.js";import{cL as rt,cy as it,cq as ot,cM as dt,cN as ut,ac as ee,S as ht,ae as yt,cO as ft,cr as ge,aF as kt}from"./antd-vue-vendor-cce59da1.js";import{useContextMenu as pt}from"./useContextMenu-cafc8f96.js";import{d as gt}from"./lodash-es-vendor-5fc8fca4.js";var E=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(E||{});const St=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Kt=st({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),xt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},Lt=Se({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:y}){const s=e,x=Ke(""),[F]=xe("tree-header"),C=Pe(),{t:l}=Ge(),k=M(()=>["mr-1","w-full",{"ml-5":C.headerTitle||s.title}]),A=M(()=>{const{checkable:t}=s,a=[{label:l("component.tree.expandAll"),value:E.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:E.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:E.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:E.UN_SELECT_ALL,divider:t},...a,{label:l("component.tree.checkStrictly"),value:E.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:E.CHECK_UN_STRICTLY}]:a});function B(t){var c,i,d,o;const{key:a}=t;switch(a){case E.SELECT_ALL:(c=s.checkAll)==null||c.call(s,!0);break;case E.UN_SELECT_ALL:(i=s.checkAll)==null||i.call(s,!1);break;case E.EXPAND_ALL:(d=s.expandAll)==null||d.call(s,!0);break;case E.UN_EXPAND_ALL:(o=s.expandAll)==null||o.call(s,!1);break;case E.CHECK_STRICTLY:y("strictly-change",!1);break;case E.CHECK_UN_STRICTLY:y("strictly-change",!0);break}}function _(t){y("search",t)}const h=tt(_,200);return P(()=>x.value,t=>{h(t)}),P(()=>s.searchText,t=>{t!==x.value&&(x.value=t)}),(t,a)=>(w(),H("div",{class:ue([r(F)(),"flex px-2 py-1.5 items-center"])},[r(C).headerTitle?Oe(t.$slots,"headerTitle",{key:0}):U("",!0),!r(C).headerTitle&&t.title?(w(),J(r(nt),{key:1,helpMessage:t.helpMessage},{default:V(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):U("",!0),t.search||t.toolbar?(w(),H("div",xt,[t.search?(w(),H("div",{key:0,class:ue(k.value)},[L(r(rt),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:x.value,"onUpdate:value":a[0]||(a[0]=c=>x.value=c),onSearch:a[1]||(a[1]=c=>t.$emit("clickSearch",c))},null,8,["placeholder","value"])],2)):U("",!0),t.toolbar?(w(),J(r(ot),{key:1,onClick:a[2]||(a[2]=Ve(()=>{},["prevent"]))},{overlay:V(()=>[L(r(it),{onClick:B},{default:V(()=>[(w(!0),H(Q,null,He(A.value,c=>(w(),H(Q,{key:c.value},[L(r(dt),Re(je({key:c.value})),{default:V(()=>[oe(de(c.label),1)]),_:2},1040),c.divider?(w(),J(r(ut),{key:0})):U("",!0)],64))),128))]),_:1})]),default:V(()=>[L(r(W),{icon:"ion:ellipsis-vertical"})]),_:1})):U("",!0)])):U("",!0)],2))}}),At=({icon:e})=>e?Xe(e)?Ye(W,{icon:e,class:"mr-1"}):W:null;function Ct(e,y){function s(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];t.push(o[c]);const f=o[i];f&&f.length&&t.push(...s(f))}return t}function x(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];o.disabled!==!0&&o.selectable!==!1&&t.push(o[c]);const f=o[i];f&&f.length&&t.push(...x(f))}return t}function F(h,t){const a=[],c=t||r(e),{key:i,children:d}=r(y);if(!d||!i)return a;for(let o=0;o<c.length;o++){const f=c[o],v=f[d];h===f[i]?(a.push(f[i]),v&&v.length&&a.push(...s(v))):v&&v.length&&a.push(...F(h,v))}return a}function C(h,t,a){if(!h)return;const c=a||r(e),{key:i,children:d}=r(y);if(!(!d||!i))for(let o=0;o<c.length;o++){const f=c[o],v=f[d];if(f[i]===h){c[o]=I(I({},c[o]),t);break}else v&&v.length&&C(h,t,f[d])}}function l(h=1,t,a=1){if(!h)return[];const c=[],i=t||r(e)||[];for(let d=0;d<i.length;d++){const o=i[d],{key:f,children:v}=r(y),z=f?o[f]:"",O=v?o[v]:[];c.push(z),O&&O.length&&a<h&&(a+=1,c.push(...l(h,O,a)))}return c}function k({parentKey:h=null,node:t,push:a="push"}){const c=ee(r(e));if(!h){c[a](t),e.value=c;return}const{key:i,children:d}=r(y);!d||!i||(ke(c,o=>{if(o[i]===h)return o[d]=o[d]||[],o[d][a](t),!0}),e.value=c)}function A({parentKey:h=null,list:t,push:a="push"}){const c=ee(r(e));if(!(!t||t.length<1))if(h){const{key:i,children:d}=r(y);if(!d||!i)return;ke(c,o=>{if(o[i]===h){o[d]=o[d]||[];for(let f=0;f<t.length;f++)o[d][a](t[f]);return e.value=c,!0}})}else for(let i=0;i<t.length;i++)c[a](t[i])}function B(h,t){if(!h)return;const a=t||r(e),{key:c,children:i}=r(y);if(!(!i||!c))for(let d=0;d<a.length;d++){const o=a[d],f=o[i];if(o[c]===h){a.splice(d,1);break}else f&&f.length&&B(h,o[i])}}function _(h,t,a){return!h&&h!==0?null:((t||r(e)).forEach(i=>{if(a!=null&&a.key||(a==null?void 0:a.key)===0)return a;if(i.key===h){a=i;return}i.children&&i.children.length&&(a=_(h,i.children,a))}),a||null)}return{deleteNodeByKey:B,insertNodeByKey:k,insertNodesByKey:A,filterByLevel:l,updateNodeByKey:C,getAllKeys:s,getChildrenKeys:F,getEnabledKeys:x,getSelectedNode:_}}function vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!qe(e)}const wt=Se({name:"BasicTree",inheritAttrs:!1,props:Kt,emits:St,setup(e,{attrs:y,slots:s,emit:x,expose:F}){const[C]=xe("tree"),l=he({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),k=he({startSearch:!1,searchText:"",searchData:[]}),A=Ke([]),[B]=pt(),_=M(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),h=M(()=>{let n=re(I(I({blockNode:!0},y),e),{expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(_),"onUpdate:expandedKeys":u=>{l.expandedKeys=u,x("update:expandedKeys",u)},"onUpdate:selectedKeys":u=>{l.selectedKeys=u,x("update:selectedKeys",u)},onCheck:(u,S)=>{let p=$(l.checkedKeys);if(Je(p)&&k.startSearch){const K=S.node.eventKey;p=gt(p,z(K)),S.checked&&p.push(K),l.checkedKeys=p}else l.checkedKeys=u;const g=$(l.checkedKeys);x("update:value",g),x("check",g,S)},onRightClick:Ce});return ht(n,"treeData","class")}),t=M(()=>k.startSearch?k.searchData:r(A)),a=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:c,insertNodeByKey:i,insertNodesByKey:d,filterByLevel:o,updateNodeByKey:f,getAllKeys:v,getChildrenKeys:z,getEnabledKeys:O,getSelectedNode:Le}=Ct(A,_);function Ae(n,u){return!u&&e.renderIcon&&Z(e.renderIcon)?e.renderIcon(n):u}function Ce(S){return ie(this,arguments,function*({event:n,node:u}){var N;const{rightMenuList:p=[],beforeRightClick:g}=e;let K={event:n,items:[]};if(g&&Z(g)){let T=yield g(u,n);Array.isArray(T)?K.items=T:Object.assign(K,T)}else K.items=p;(N=K.items)!=null&&N.length&&(K.items=K.items.filter(T=>!T.hidden),B(K))})}function j(n){l.expandedKeys=n}function ve(){return l.expandedKeys}function te(n){l.selectedKeys=n}function Ee(){return l.selectedKeys}function ne(n){l.checkedKeys=n}function Te(){return l.checkedKeys}function ae(n){l.checkedKeys=n?O():[]}function q(n){l.expandedKeys=n?v():[]}function be(n){l.checkStrictly=n}P(()=>e.searchValue,n=>{n!==k.searchText&&(k.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&G(k.searchText)});function G(n){if(n!==k.searchText&&(k.searchText=n),x("update:searchValue",n),!n){k.startSearch=!1;return}const{filterFn:u,checkable:S,expandOnSearch:p,checkOnSearch:g,selectedOnSearch:K}=r(e);k.startSearch=!0;const{title:N,key:T}=r(_),D=[];if(k.searchData=Qe(r(A),b=>{var X,Y;const m=u?u(n,b,r(_)):(Y=(X=b[N])==null?void 0:X.includes(n))!=null?Y:!1;return m&&D.push(b[T]),m},r(_)),p){const b=We(k.searchData).map(m=>m[T]);b&&b.length&&j(b)}g&&S&&D.length&&ne(D),K&&D.length&&te(D)}function _e(n,u){if(!(!e.clickRowToExpand||!u||u.length===0))if(!l.expandedKeys.includes(n))j([...l.expandedKeys,n]);else{const S=[...l.expandedKeys],p=S.findIndex(g=>g===n);p!==-1&&S.splice(p,1),j(S)}}R(()=>{A.value=e.treeData}),$e(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=o(n):e.defaultExpandAll&&q(!0)}),R(()=>{l.expandedKeys=e.expandedKeys}),R(()=>{l.selectedKeys=e.selectedKeys}),R(()=>{l.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{l.checkedKeys=$(e.value||[])},{immediate:!0}),P(()=>l.checkedKeys,()=>{const n=$(l.checkedKeys);x("update:value",n),x("change",n)}),R(()=>{l.checkStrictly=e.checkStrictly});const Be={setExpandedKeys:j,getExpandedKeys:ve,setSelectedKeys:te,getSelectedKeys:Ee,setCheckedKeys:ne,getCheckedKeys:Te,insertNodeByKey:i,insertNodesByKey:d,deleteNodeByKey:c,updateNodeByKey:f,getSelectedNode:Le,checkAll:ae,expandAll:q,filterByLevel:n=>{l.expandedKeys=o(n)},setSearchValue:n=>{G(n)},getSearchValue:()=>k.searchText};function De(n){const{actionList:u}=e;if(!(!u||u.length===0))return u.map((S,p)=>{var K;let g=!0;return Z(S.show)?g=(K=S.show)==null?void 0:K.call(S,n):pe(S.show)&&(g=S.show),g?L("span",{key:p,class:C("action")},[S.render(n)]):null})}const Fe=M(()=>{const n=ee(t.value);return Ze(n,(u,S)=>{var le;const p=k.searchText,{highlight:g}=r(e),{title:K,key:N,children:T}=r(_),D=Ae(u,u.icon),b=kt(u,K),m=p?b.indexOf(p):-1,X=k.startSearch&&!et(p)&&g&&m!==-1,Y=`color: ${pe(g)?"#f50":g}`,Ne=X?L("span",{class:(le=r(h))!=null&&le.blockNode?`${C("content")}`:""},[L("span",null,[b.substr(0,m)]),L("span",{style:Y},[p]),L("span",null,[b.substr(m+p.length)])]):b;return u[K]=L("span",{class:`${C("title")} pl-2`,onClick:_e.bind(null,u[N],u[T])},[s!=null&&s.title?ct(s,"title",u):L(Q,null,[D&&L(At,{icon:D},null),Ne,L("span",{class:C("actions")},[De(u)])])]),u}),n});return F(Be),()=>{let n;const{title:u,helpMessage:S,toolbar:p,search:g,checkable:K}=e,N=u||p||g||s.headerTitle,T={height:"calc(100% - 38px)"};return L("div",{class:[C(),"h-full",y.class]},[N&&L(Lt,{checkable:K,checkAll:ae,expandAll:q,title:u,search:g,toolbar:p,helpMessage:S,onStrictlyChange:be,onSearch:G,onClickSearch:D=>x("search",D),searchText:k.searchText},vt(n=at(s))?n:{default:()=>[n]}),L(yt,{spinning:r(e.loading),tip:"加载中..."},{default:()=>[ye(L(lt,{style:T},{default:()=>[L(ft,ze(r(h),{showIcon:!1,treeData:Fe.value}),null)]}),[[fe,!r(a)]]),ye(L(ge,{image:ge.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[fe,r(a)]])]})])}}});export{wt as _};
