var ne=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var P=(e,n,a)=>n in e?ne(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,H=(e,n)=>{for(var a in n||(n={}))se.call(n,a)&&P(e,a,n[a]);if(N)for(var a of N(n))ce.call(n,a)&&P(e,a,n[a]);return e},G=(e,n)=>le(e,oe(n));var R=(e,n,a)=>new Promise((m,h)=>{var p=l=>{try{o(a.next(l))}catch(r){h(r)}},i=l=>{try{o(a.throw(l))}catch(r){h(r)}},o=l=>l.done?m(l.value):Promise.resolve(l.value).then(p,i);o((a=a.apply(e,n)).next())});import{B as ue}from"./index-52485b3e.js";import{av as ie,p as B,B as re,X as de,U as fe,z as he}from"./index-f3247ba0.js";import{ap as Z,C as x}from"./jeecg-online-vendor-5792e8a1.js";import{t as ve}from"./props-67f8b4a0.js";import{_ as me}from"./index-103c50ea.js";import{c as z,k as f,r as ee,e as pe,w as A,u as w,q as Q,d as te,U as E,a5 as j,a6 as ae,f as C,a7 as k,a9 as X,E as $,V as W,ag as F,p as U,s as ye,J as Y}from"./vue-249e5fad.js";import{J as ge}from"./JSelectBiz-b9220e19.js";import{useRuleFormItem as ke}from"./useFormItem-fecc857a.js";function Ce(e,n,a){const m=z("selectOptions",f([])),h=z("selectValues",ee({})),p=z("loadingEcho",f(!1)),i=f([]),o=f([]),l=f([]),r=f(!1),_=pe(()=>a.multiple?a.checkStrictly:!0);let S=!0;A(h,({value:t})=>{t&&r.value==!1&&t.length>0&&(p.value=S,S=!1,L(null,t.join(",")).finally(()=>{p.value=!1}))},{immediate:!0});function y(){const t=w(e);if(!t)throw new Error("tree is null!");return t}function g(){Q(()=>{a.defaultExpandLevel&&a.defaultExpandLevel>0&&y().filterByLevel(a.defaultExpandLevel),o.value=h.value}).then()}function b(t,s){if(a.checkable==!1){o.value=a.checkStrictly?t.checked:t;const{selectedNodes:c}=s;let u=[];c.forEach(v=>{u.push(v)}),l.value=u}}function O(t,s){if(a.checkable==!0){if(!a.multiple){if(s.checked){o.value=[s.node.eventKey];let v=a.rowKey,q=s.checkedNodes.find(K=>K[v]===s.node.eventKey);l.value=[q]}else o.value=[],l.value=[];return}o.value=a.checkStrictly?t.checked:t;const{checkedNodes:c}=s;let u=[];c.forEach(v=>{u.push(v)}),l.value=u}}function V(t){return R(this,null,function*(){y().checkAll(t),yield Q(),o.value=y().getCheckedKeys(),t?d():l.value=[]})}function d(){let t="";w(o).length>0&&(t=o.value.join(",")),n({ids:t}).then(s=>{l.value=s})}function D(t){y().expandAll(t)}function L(t,s){return R(this,null,function*(){let c={},u="";t&&(u=t.eventKey,c.pid=t.value),s&&(u="",c.ids=s);let v=yield n(c),q=v;if(a.serverTreeData||(v=ie(v,a,u),v.length==0&&t&&M(u,i.value)),r.value==!0){if(!t)i.value=v;else return new Promise(K=>{if(!t.children){K();return}const T=w(e);T&&(T.updateNodeByKey(t.eventKey,{children:v}),T.setExpandedKeys([t.eventKey,...T.getExpandedKeys()])),K()});g()}else{const K=[];q.forEach(T=>{K.push({label:T[a.titleKey],value:T[a.rowKey]})}),m.value=K}})}function M(t,s){if(s&&s.length>0)for(let c of s)if(c.key==t){c.child||(c.isLeaf=!0);break}else M(t,c.children)}function J(t){const s=[],c=[];l.value.forEach(u=>{s.push({label:u[a.labelKey],value:u[a.rowKey]})}),o.value.forEach(u=>{c.push(u)}),m.value=s,t&&t(s,c)}function I(t){return R(this,null,function*(){t?(r.value=!0,yield L(null,null)):r.value=!1})}return[{visibleChange:I,selectOptions:m,selectValues:h,onLoadData:L,onCheck:O,onSelect:b,checkALL:V,expandAll:D,checkedKeys:o,selectRows:l,treeData:i,getCheckStrictly:_,getSelectTreeData:J}]}const Se=te({name:"DeptSelectModal",components:{BasicModal:ue,BasicTree:me},props:G(H({},ve),{modalTitle:{type:String,default:"部门选择"},value:B.oneOfType([B.string,B.array])}),emits:["register","getSelectResult"],setup(e,{emit:n,refs:a}){const[m,{closeModal:h}]=re(),p=Z(),i=f(null);let o=e.value===""?[]:e.value;const l=Object.assign({},w(e),w(p),{value:o},{disabled:!1}),r=s(),[{visibleChange:_,checkedKeys:S,getCheckStrictly:y,getSelectTreeData:g,onCheck:b,onLoadData:O,treeData:V,checkALL:d,expandAll:D,onSelect:L}]=Ce(i,r,l),M=f(e.params),J=f([]),I={key:e.rowKey};function t(){g((c,u)=>{n("getSelectResult",c,u),h()})}function s(){let c=e.sync?de:fe;return u=>c(Object.assign({},u,{primaryKey:e.rowKey}))}return{tree:J,handleOk:t,searchInfo:M,treeRef:i,treeData:V,onCheck:b,onSelect:L,checkALL:d,expandAll:D,fieldNames:I,checkedKeys:S,register:m,getBindValue:l,getCheckStrictly:y,visibleChange:_,onLoadData:O}}});function Ee(e,n,a,m,h,p){const i=E("BasicTree"),o=E("a-menu-item"),l=E("a-menu"),r=E("Icon"),_=E("a-button"),S=E("a-dropdown"),y=E("BasicModal");return j(),ae("div",null,[C(y,F(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:"500px",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{insertFooter:k(()=>[C(S,{placement:"top"},{overlay:k(()=>[C(l,null,{default:k(()=>[e.multiple?(j(),X(o,{key:"1",onClick:n[0]||(n[0]=g=>e.checkALL(!0))},{default:k(()=>[$("全部勾选")]),_:1})):W("",!0),e.multiple?(j(),X(o,{key:"2",onClick:n[1]||(n[1]=g=>e.checkALL(!1))},{default:k(()=>[$("取消全选")]),_:1})):W("",!0),C(o,{key:"3",onClick:n[2]||(n[2]=g=>e.expandAll(!0))},{default:k(()=>[$("展开全部")]),_:1}),C(o,{key:"4",onClick:n[3]||(n[3]=g=>e.expandAll(!1))},{default:k(()=>[$("折叠全部")]),_:1})]),_:1})]),default:k(()=>[C(_,{style:{float:"left"}},{default:k(()=>[$(" 树操作 "),C(r,{icon:"ant-design:up-outlined"})]),_:1})]),_:1})]),default:k(()=>[C(i,F({ref:"treeRef",treeData:e.treeData,"load-data":e.sync==!1?null:e.onLoadData},e.getBindValue,{onSelect:e.onSelect,onCheck:e.onCheck,fieldNames:e.fieldNames,checkedKeys:e.checkedKeys,checkStrictly:e.getCheckStrictly}),null,16,["treeData","load-data","onSelect","onCheck","fieldNames","checkedKeys","checkStrictly"])]),_:1},16,["onRegister","title","onOk","onVisibleChange"])])}const we=x(Se,[["render",Ee]]),_e=te({name:"JSelectDept",components:{DeptSelectModal:we,JSelectBiz:ge},inheritAttrs:!1,props:{value:B.oneOfType([B.string,B.array]),multiple:B.bool.def(!0)},emits:["options-change","change","select","update:value"],setup(e,{emit:n,refs:a}){const m=f(),[h,{openModal:p}]=he(),[i]=ke(e,"value","change",m),o=f([]);let l=ee({value:[]});const r=f(!1);U("selectOptions",o),U("selectValues",l),U("loadingEcho",r);const _=f(!1),S=Z();ye(()=>{e.value&&g()}),A(()=>e.value,()=>{g()}),A(l,()=>{l&&(i.value=l.value)}),A(o,()=>{o&&n("select",Y(w(o)),Y(w(l)))});function y(){_.value=!0,p(!0,{isUpdate:!1})}function g(){let d=e.value?e.value:[];d&&typeof d=="string"?(i.value=d.split(","),l.value=d.split(",")):l.value=d}function b(d,D){o.value=d,i.value=D,l.value=D,n("update:value",D.join(","))}const O=Object.assign({},w(e),w(S));function V(d){n("update:value",d)}return{state:i,attrs:S,selectOptions:o,selectValues:l,loadingEcho:r,getBindValue:O,tag:_,regModal:h,setValue:b,handleOpen:y,handleChange:V}}});function De(e,n,a,m,h,p){const i=E("JSelectBiz"),o=E("DeptSelectModal");return j(),ae("div",null,[C(i,F({onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs,{onChange:e.handleChange}),null,16,["onHandleOpen","loading","onChange"]),C(o,F({onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue),null,16,["onRegister","onGetSelectResult"])])}const Re=x(_e,[["render",De],["__scopeId","data-v-82cb815e"]]);export{Re as o};
