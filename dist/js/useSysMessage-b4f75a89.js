var v=(r,n,u)=>new Promise((c,p)=>{var o=s=>{try{g(u.next(s))}catch(f){p(f)}},y=s=>{try{g(u.throw(s))}catch(f){p(f)}},g=s=>s.done?c(s.value):Promise.resolve(s.value).then(o,y);g((u=u.apply(r,n)).next())});import{g as S,h as w,b as T}from"./jeecg-online-vendor-ef755ff7.js";import{a4 as M,a3 as F,k as D,r as I}from"./vue-249e5fad.js";import{F as P}from"./index-12df1add.js";const A=r=>{const n="/sys/annountCement/vue3List";return T.get({url:n,params:r})};function R(){S("rangeDate");const r=D([]),n=D(1);let u=10;const c=I({fromUser:"",rangeDateKey:"",rangeDate:[],starFlag:""});function p(){let{fromUser:e,rangeDateKey:t,rangeDate:a,starFlag:d}=c,i={fromUser:e,starFlag:d,rangeDateKey:t,beginDate:"",endDate:"",pageNo:n.value,pageSize:u};return t=="zdy"&&(i.beginDate=a[0]+" 00:00:00",i.endDate=a[1]+" 23:59:59"),i}const o=D(!1);function y(){return v(this,null,function*(){if(o.value===!0)return;let e=p();const t=yield A(e);if(!t||t.length<=0){o.value=!0;return}t.length<u&&(o.value=!0),n.value=n.value+1;let a=r.value;a.push(...t),r.value=a})}function g(){r.value=[],n.value=1,o.value=!1}function s(e){const t="/sys/sysAnnouncementSend/edit";let a="1";e.starFlag==a&&(a="0");const d={starFlag:a,id:e.sendId};T.put({url:t,params:d})}const f=D(!1);function l(){return v(this,null,function*(){f.value=!0,yield y(),f.value=!1})}function m(e){return e.readFlag!=="1"}function b(e){return e.busType=="email"?"邮件提醒:":e.busType=="bpm"?"流程催办:":e.busType=="bpm_task"?"流程任务:":e.msgCategory=="2"?"系统消息:":e.msgCategory=="1"?"通知公告:":""}return{messageList:r,reset:g,loadData:y,loadEndStatus:o,searchParams:c,updateStarMessage:s,onLoadMore:l,noRead:m,getMsgCategory:b}}function q(r){const n=S("messageHref"),u=M(),c=w(),p=F(),{close:o,closeSameRoute:y}=P();function g(l,m){return v(this,null,function*(){l.busType?yield s(l):m?m():yield f(l)})}function s(l){return v(this,null,function*(){const{busType:m,busId:b,msgAbstract:e}=l;let t=n.filter(i=>i.value===m);if(!t||t.length==0)return;let a=t[0].text;a=a.replace("{DETAIL_ID}",b);let d={detailId:b};if(e)try{let i=JSON.parse(e);Object.keys(i).map(h=>{d[h]=i[h]})}catch(i){}c.setMessageHrefParams(d),p.path.indexOf(a)>=0?(yield o(),yield u.replace({path:a,query:{time:new Date().getTime()}})):(y(a),yield u.push({path:a}))})}function f(l){return v(this,null,function*(){r("detail",l)})}return{goPage:g}}export{q as a,R as u};
