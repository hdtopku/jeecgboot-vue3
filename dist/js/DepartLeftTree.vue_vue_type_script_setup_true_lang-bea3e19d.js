var p=(E,w,c)=>new Promise((T,k)=>{var b=l=>{try{o(c.next(l))}catch(r){k(r)}},d=l=>{try{o(c.throw(l))}catch(r){k(r)}},o=l=>l.done?T(l.value):Promise.resolve(l.value).then(b,d);o((c=c.apply(E,w)).next())});import"./index-9c776ac3.js";import{u as me,j as ve}from"./jeecg-online-vendor-e26fc0e5.js";import{b as q,A as F,d as he}from"./depart.api-35875297.js";import{s as ke}from"./depart.user.api-98b5d533.js";import{_ as ge}from"./DepartFormModal.vue_vue_type_script_setup_true_lang-8d9c505d.js";import{z as xe}from"./index-ea73cedc.js";import{d as Ce,c as De,k as u,U as i,a5 as f,a9 as D,a7 as a,aa as _,f as n,E as y,V as z,a6 as R,F as W,ab as G,u as B,n as H}from"./vue-705b7309.js";import{cj as we}from"./antd-vue-vendor-cce59da1.js";const Te={class:"j-table-operator",style:{width:"100%"}},be=_("span",null,"删除",-1),Ke=_("span",null,"批量操作 ",-1),Ae={key:1},Ie=_("span",{style:{color:"red"}},"删除",-1),Le=Ce({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(E,{expose:w,emit:c}){De("prefixCls");const{createMessage:T}=me(),{handleImportXls:k,handleExportXls:b}=ve(),d=u(!1),o=u([]),l=u([]),r=u([]),h=u([]),K=u(!1),J=u(!0),A=u(null),I=u(null),O=u(""),[Q,{openModal:U}]=xe();function m(){return p(this,null,function*(){try{d.value=!0,o.value=[];const e=yield q();if(Array.isArray(e)&&(o.value=e),r.value.length===0)M();else if(h.value.length===0){let t=o.value[0];t&&g(t.id,t)}else c("select",A.value);c("rootTreeData",o.value)}finally{d.value=!1}})}m();function Y(e){return p(this,null,function*(){try{const t=yield q({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,r.value.length>0){let s=[];for(let x of r.value)t.findIndex(C=>C.id===x)!==-1&&s.push(x);s.length>0&&(r.value=[...r.value])}o.value=[...o.value],c("rootTreeData",o.value)}catch(t){}return Promise.resolve()})}function M(){let e=o.value[0];e?(e.isLeaf||(r.value=[e.key]),g(e.id,e),Z()):c("select",null)}function Z(){return p(this,null,function*(){yield H(),K.value=!0,yield H(),K.value=!1})}function g(e,t){h.value=[e],t&&(A.value=t,c("select",t))}function ee(){U(!0,{isUpdate:!1,isChild:!1})}function V(e=A.value){if(e==null){T.warning("请先选择一个部门");return}const t={parentId:e.id};U(!0,{isUpdate:!1,isChild:!0,record:t})}function te(e){return p(this,null,function*(){if(e)try{d.value=!0,o.value=[];let t=yield ke({keyWord:e});Array.isArray(t)&&(o.value=t),M()}finally{d.value=!1}else m();O.value=e})}function ae(e){Array.isArray(e)?l.value=e:l.value=e.checked}function ne(e,t){e.length>0&&h.value[0]!==e[0]?g(e[0],t.selectedNodes[0]):g(h.value[0])}function $(e,t=!0){return p(this,null,function*(){const s=B(e);if(s.length>0)try{d.value=!0,yield he({ids:s.join(",")},t),yield m()}finally{d.value=!1}})}function oe(e){return p(this,null,function*(){e&&(j(!1),$([e.id],!1))})}function le(){return p(this,null,function*(){try{yield $(l),l.value=[]}finally{}})}function j(e){e||(I.value=null)}function se(e){k(e,F.importExcelUrl,()=>{m()})}function ie(){b("部门信息",F.exportXlsUrl)}return w({loadRootTreeData:m}),(e,t)=>{const s=i("a-button"),x=i("a-upload"),C=i("icon"),S=i("a-menu-item"),L=i("a-menu"),X=i("a-dropdown"),re=i("a-divider"),ce=i("a-alert"),ue=i("a-input-search"),de=i("a-tree"),pe=i("a-empty"),fe=i("a-spin"),ye=i("a-card");return f(),D(ye,{bordered:!1,style:{height:"100%"}},{default:a(()=>[_("div",Te,[n(s,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ee},{default:a(()=>[y("新增")]),_:1}),n(s,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>V())},{default:a(()=>[y("添加下级")]),_:1}),n(x,{name:"file",showUploadList:!1,customRequest:se},{default:a(()=>[n(s,{type:"primary",preIcon:"ant-design:import-outlined"},{default:a(()=>[y("导入")]),_:1})]),_:1}),n(s,{type:"primary",preIcon:"ant-design:export-outlined",onClick:ie},{default:a(()=>[y("导出")]),_:1}),n(s,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("同步企微?")]),_:1}),n(s,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("同步钉钉?")]),_:1}),l.value.length>0?(f(),D(X,{key:0},{overlay:a(()=>[n(L,null,{default:a(()=>[n(S,{key:"1",onClick:le},{default:a(()=>[n(C,{icon:"ant-design:delete-outlined"}),be]),_:1})]),_:1})]),default:a(()=>[n(s,null,{default:a(()=>[Ke,n(C,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):z("",!0)]),n(ce,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:a(()=>[l.value.length>0?(f(),R(W,{key:0},[_("span",null,"已选中 "+G(l.value.length)+" 条记录",1),n(re,{type:"vertical"}),_("a",{onClick:t[1]||(t[1]=v=>l.value=[])},"清空")],64)):(f(),R("span",Ae,"未选中任何数据"))]),_:1}),n(fe,{spinning:d.value},{default:a(()=>[n(ue,{placeholder:"按部门名称搜索…",style:{"margin-bottom":"10px"},onSearch:te}),o.value.length>0?(f(),R(W,{key:0},[K.value?z("",!0):(f(),D(de,{key:0,checkable:"",clickRowToExpand:!1,treeData:o.value,selectedKeys:h.value,checkStrictly:J.value,"load-data":Y,checkedKeys:l.value,expandedKeys:r.value,"onUpdate:expandedKeys":t[3]||(t[3]=v=>r.value=v),onCheck:ae,onSelect:ne},{title:a(({key:v,title:_e,dataRef:N})=>[n(X,{trigger:["contextmenu"]},{overlay:a(()=>[n(L,{onClick:t[2]||(t[2]=()=>{})},{default:a(()=>[n(S,{key:"1",onClick:P=>V(N)},{default:a(()=>[y("添加子级")]),_:2},1032,["onClick"]),n(S,{key:"2",onClick:P=>I.value=v},{default:a(()=>[Ie]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(B(we),{visible:I.value===v,title:"确定要删除吗？","ok-text":"确定","cancel-text":"取消",placement:"rightTop",onConfirm:P=>oe(N),onVisibleChange:j},{default:a(()=>[_("span",null,G(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(f(),D(pe,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"]),n(ge,{rootTreeData:o.value,onRegister:B(Q),onSuccess:m},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{Le as _};
