var ke=Object.defineProperty,Se=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var se=(t,n,o)=>n in t?ke(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,ae=(t,n)=>{for(var o in n||(n={}))ve.call(n,o)&&se(t,o,n[o]);if(oe)for(var o of oe(n))xe.call(n,o)&&se(t,o,n[o]);return t},re=(t,n)=>Se(t,Ae(n));var C=(t,n,o)=>new Promise((_,c)=>{var m=s=>{try{r(o.next(s))}catch(p){c(p)}},u=s=>{try{r(o.throw(s))}catch(p){c(p)}},r=s=>s.done?_(s.value):Promise.resolve(s.value).then(m,u);r((o=o.apply(t,n)).next())});import Ce from"./BasicTable-6551da7b.js";import{Q as Ue}from"./componentMap-ba94d61e.js";import"./useTable-e75e95c2.js";import{b as de,aX as ie,u as ye,D as fe,t as Ie,U as Le}from"./jeecg-online-vendor-f8ebd627.js";import{d as O,e as X,V as B,a5 as g,a9 as S,a7 as l,f as i,E as T,ab as E,W as Q,k as D,q as z,a6 as q,ag as le,ah as ce,F as ue,u as a,aa as pe}from"./vue-5a09445c.js";import{M as K,cG as Re}from"./antd-vue-vendor-04f0af1d.js";import{_ as Me}from"./UserQuitAgentModal.vue_vue_type_script_setup_true_name_user-quit-agent-modal_lang-cad1306d.js";import Be from"./UserQuitModal-b5b438a9.js";import{a as Ee}from"./index-d3889e2f.js";import{useListPage as De}from"./useListPage-7c981c75.js";import"./index-0d8c6dee.js";import{x as $e,y as Fe}from"./user.api-2e564f12.js";import{u as Ne,e as je}from"./user.data-99f81bbd.js";import{U as ze}from"./JSelectUser-d28baf37.js";import{j as Qe}from"./UserSetting.api-af99f3db.js";import{m as Oe}from"./tenant.api-14b3bbb6.js";import Pe from"./TenantUserDrawer-4a8b3ed3.js";import{z as V}from"./index-23d562e3.js";import"./BasicTable.vue_vue_type_style_index_0_lang-ff52d12f.js";import"./BasicForm-ac34d48e.js";import"./BasicForm.vue_vue_type_style_index_0_lang-492c189b.js";import"./lodash-es-vendor-70833b4a.js";import"./BasicModal-984237cb.js";import"./useWindowSizeFn-123149fd.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./useForm-a39fb19e.js";import"./JAddInput-ff8a2196.js";import"./areaDataUtil-1a45154e.js";import"./useFormItem-3b7d78e2.js";import"./props-57077bfd.js";import"./JSelectBiz-eead536a.js";import"./index-56ed0801.js";import"./index-5ea00b35.js";import"./bem-5ff749b6.js";import"./props-17f0c5eb.js";import"./useContextMenu-d4796678.js";import"./depart.api-ee845ad8.js";import"./JSelectDept-6a5d3f49.js";import"./JPopup-03bf28d5.js";import"./cron-parser-vendor-c9873295.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-eaa23dad.js";import"./injectionKey-69710956.js";/* empty css              */import"./download-a7e2eae4.js";import"./base64Conver-fa2fe1af.js";import"./index-c70b6345.js";import"./index-94b582d6.js";import"./useCountdown-577483f4.js";import"./useFormItemSingle-55ffe2e1.js";import"./JUpload.vue_vue_type_style_index_0_lang-53f5b66c.js";import"./index-7c5ea69b.js";import"./index-d11886bb.js";import"./validator-3e3aef60.js";import"./renderUtils-fec7e871.js";import"./tenant.data-e4bc33e6.js";const ge={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let J=null;const He=()=>C(void 0,null,function*(){if(J!=null)return ie(J);{let{success:t,result:n}=yield de.get({url:ge.getEnabledType},{isTransformResponse:!1});if(t)return J=ie(n),n}return{}}),me=O({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(t,{emit:n}){const o=t,_=X(()=>o.type==="wechatEnterprise"?!1:o.syncToLocal);function c(m){n(m.key,{type:o.type})}return(m,u)=>{const r=B("a-button"),s=B("a-menu-item"),p=B("a-menu"),A=B("a-dropdown");return t.syncToApp&&t.syncToLocal?(g(),S(A,{key:0},{overlay:l(()=>[i(p,{onClick:c},{default:l(()=>[t.syncToApp?(g(),S(s,{key:"to-app"},{default:l(()=>[T("同步到"+E(t.name),1)]),_:1})):Q("",!0),_.value?(g(),S(s,{key:"to-local"},{default:l(()=>[T("同步到本地")]),_:1})):Q("",!0)]),_:1})]),default:l(()=>[i(r,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})]),_:1})):t.syncToApp?(g(),S(r,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:u[0]||(u[0]=U=>c({key:"to-app"}))},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})):(g(),S(r,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:u[1]||(u[1]=U=>c({key:"to-local"}))},{default:l(()=>[T("同步"+E(t.name)+"到本地",1)]),_:1}))}}}),Ke=O({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(t,{emit:n}){const o=t,{createMessage:_,createWarningModal:c}=ye(),m=D({}),u=X(()=>({syncToApp:o.syncToApp,syncToLocal:o.syncToLocal})),r=X(()=>({"to-app":s,"to-local":p}));function s(d){U(d.type,"/toApp")}function p(d){U(d.type,"/toLocal")}function A(){return C(this,null,function*(){m.value=yield He()})}function U(d,h){let I=ge[d];if(!(I&&I[o.bizType]))return;let k=I[o.bizType]+h,v=o.selectedRowKeys,F="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(v)&&v.length>0?F=`确定要开始同步这 ${v.length} 项吗？`:v=[],new Promise((P,G)=>{const N=K.confirm({icon:i(Re),title:"同步",content:F,onOk:()=>{N.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let H={ids:v.join(",")};return de.get({url:k,params:H},{isTransformResponse:!1}).then(y=>{let w={};y.result&&(w={width:600,title:y.message,content:()=>{let L,j=["成功信息如下：",$(z,y.result.successInfo.map((R,M)=>`${M+1}. ${R}`).join(`
`))];return y.success?L=[...j,z("br"),"无失败信息！"]:L=["失败信息如下：",$(z,y.result.failInfo.map((R,M)=>`${M+1}. ${R}`).join(`
`)),z("br"),...j],L}}),y.success?(w!=null?K.success(w):_.warning(y.message),n("sync-ok")):(w!=null?K.warning(w):_.warning(y.message),n("sync-error"))}).catch(()=>N.destroy()).finally(()=>{P(),n("sync-finally",{type:d,direction:h,isToApp:h==="/toApp",isToLocal:h==="/toLocal"})})},onCancel(){P()}})})}function $(d,h){return d("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},h)}return A(),(d,h)=>t.syncToApp||t.syncToLocal?(g(),q(ue,{key:0},[m.value.wechatEnterprise?(g(),S(me,le({key:0,type:"wechatEnterprise",name:"企微"},u.value,ce(r.value)),null,16)):Q("",!0),m.value.dingtalk?(g(),S(me,le({key:1,type:"dingtalk",name:"钉钉"},u.value,ce(r.value)),null,16)):Q("",!0)],64)):(g(),q(ue,{key:1},[T("未设置任何同步方向")],64))}});const Ve=fe(Ke,[["__scopeId","data-v-d8023e59"]]),Je={style:{"margin-left":"10px","margin-top":"5px"}},Xe={class:"tenant-name"},qe=O({name:"tenant-system-user"}),Ge=O(re(ae({},qe),{setup(t){const{createMessage:n,createConfirm:o}=ye(),[_,{openDrawer:c}]=Ee(),[m,{openModal:u}]=V(),[r,{openModal:s}]=V(),p=Ie(),A=p.getUserInfo.username,{prefixCls:U,tableContext:$,onExportXls:d,onImportXls:h}=De({designScope:"user-list",tableProps:{title:"租户用户列表",api:$e,columns:Ne,size:"small",formConfig:{schemas:je},actionColumn:{width:120},beforeFetch:e=>(e.userTenantStatus="1,3,4",Object.assign({column:"createTime",order:"desc"},e))}}),[I,{reload:k,updateTableDataRecord:v},{rowSelection:F,selectedRows:P,selectedRowKeys:G}]=$;function N(){c(!0,{isUpdate:!1,showFooter:!0,tenantSaas:!0})}function H(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!0,tenantSaas:!0})})}function y(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!1,tenantSaas:!0})})}function w(){k()}function L({isToLocal:e}){e&&k()}function j(e){return[{label:"编辑",onClick:H.bind(null,e)}]}function R(e){return[{label:"详情",onClick:y.bind(null,e)},{label:"离职",onClick:M.bind(null,e.username),ifShow:()=>e.status==="1"&&e.username!==e.createBy},{label:"交接",onClick:he.bind(null,e),ifShow:()=>e.username===e.createBy},{label:"同意",onClick:W.bind(null,e.id,"1"),ifShow:()=>(e.status==="3"||e.status==="4")&&e.createBy===A},{label:"拒绝",popConfirm:{title:"是否确认拒绝",confirm:W.bind(null,e.id,"4")},ifShow:()=>e.status==="3"&&e.createBy===A}]}function M(e,f){u(!0,{userName:e,userId:f})}function W(e,f){Fe({userId:e,status:f}).then(b=>{b.success&&w()}).catch(b=>{n.warning(b.message)})}const Y=D(""),Z=D([]),[Te,{openModal:_e}]=V(),ee=D("");function he(e){Y.value=Le(),Z.value=[e.id],ee.value=e.createBy,_e(!0)}function we(e,f){if(f&&f.length>0){let b=f[0];Qe({userId:b,tenantId:a(Y)}).then(x=>{var ne;x.success?(n.success("交接成功"),((ne=p.userInfo)==null?void 0:ne.username)==ee.value?p.logout(!0):k()):n.warning(x.message)})}}const te=D("");be();function be(){return C(this,null,function*(){te.value=yield Oe()})}return(e,f)=>{const b=B("a-button");return g(),q("div",null,[i(a(Ce),{onRegister:a(I),rowSelection:a(F)},{tableTitle:l(()=>[i(b,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:l(()=>[T(" 新增")]),_:1}),i(Ve,{"biz-type":"user","selected-row-keys":a(G),syncToApp:"",syncToLocal:"",onSyncFinally:L},null,8,["selected-row-keys"]),i(b,{type:"primary",onClick:f[0]||(f[0]=x=>a(s)(!0,{})),preIcon:"ant-design:user-delete-outlined"},{default:l(()=>[T("离职信息")]),_:1}),pe("div",Je,[T(" 当前登录租户: "),pe("span",Xe,E(te.value),1)])]),action:l(({record:x})=>[i(a(Ue),{actions:j(x),dropDownActions:R(x)},null,8,["actions","dropDownActions"])]),_:1},8,["onRegister","rowSelection"]),i(Pe,{onRegister:a(_),onSuccess:w},null,8,["onRegister"]),i(Me,{onRegister:a(m),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(Be,{onRegister:a(r),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(ze,{onRegister:a(Te),excludeUserIdList:Z.value,maxSelectCount:1,onGetSelectResult:we},null,8,["onRegister","excludeUserIdList"])])}}}));const on=fe(Ge,[["__scopeId","data-v-540d12f8"]]);export{on as default};
