import{V as P,b as j}from"./jeecg-online-vendor-a84f26e2.js";import{B as q}from"./index-5e1edea3.js";import{B as z}from"./index-797f995b.js";import"./componentMap-4f24d9c4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-56b5d203.js";import{b$ as H,Y as U}from"./antd-vue-vendor-04f0af1d.js";import{Q as Y}from"./JAddInput-7275d351.js";import"./JSelectUser-c48969f7.js";import"./JSelectDept-f9e74791.js";import"./JPopup-5cac5270.js";import"./cron-parser-vendor-df2efc7b.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-cd7c9198.js";import{d as $,k as g,r as G,V as u,a5 as M,a9 as T,a7 as m,f as v,E as D,aa as I,an as Q,W as Z}from"./vue-5a09445c.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./BasicModal-02606f87.js";import"./useWindowSizeFn-76d4329b.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./useFormItem-51923232.js";/* empty css              */import"./download-1a51d657.js";import"./base64Conver-fa2fe1af.js";import"./index-4f7c087f.js";import"./index-898bd182.js";import"./useCountdown-e194c426.js";import"./useFormItemSingle-950ee32c.js";import"./JUpload.vue_vue_type_style_index_0_lang-b42545d1.js";import"./index-60a41ace.js";import"./index-f2355824.js";import"./areaDataUtil-994dc62e.js";import"./props-6ce5d664.js";import"./JSelectBiz-9c436f80.js";import"./index-86570f8b.js";import"./index-8f3c0498.js";import"./bem-05093d2d.js";import"./props-17f0c5eb.js";import"./useContextMenu-3014907a.js";import"./depart.api-71c168b0.js";var E=(i,f,s)=>new Promise((C,h)=>{var w=r=>{try{d(s.next(r))}catch(l){h(l)}},x=r=>{try{d(s.throw(r))}catch(l){h(l)}},d=r=>r.done?C(r.value):Promise.resolve(r.value).then(w,x);d((s=s.apply(i,f)).next())});const X=$({name:"CodeFileViewModal",components:{BasicModal:q,InfoCircleTwoTone:H,JCodeEditor:Y},emits:["download","register","close"],setup(i,{emit:f}){const s=g([]),C=g(""),h=g([]),w=g(!1),x=window.innerHeight-160,d=g("java"),r=g("");let l=G({});const[V,{closeModal:_}]=z(e=>E(this,null,function*(){l=G({}),r.value="",s.value=e.codeList,C.value=e.pathKey,y(),w.value=!0}));function y(){let e=K(),n=e[0];k(n,e);let o=[];const t=function(p){if(p.children){let a=p.children;a.length==1?t(a[0]):a.length>1&&o.push(p)}};t(n),h.value=o,setTimeout(()=>{b(n)},300)}function b(e){return E(this,null,function*(){const n=function(t){if(t.isLeaf===!0)return t;if(t.children)return n(t.children[0])};let o=n(e);if(o&&o.isLeaf===!0){let t=o.path;l[t]||(yield S(t)),d.value=F(t),r.value=l[t]}})}function k(e,n){for(let o of n)e.key==o.pid&&(e.children||(e.children=[]),e.children.push(o),k(o,n))}function N(e,n){let o=0,t="";for(;o<=n;)t+=e[o],o++;return t}function K(){let e=[],n=[],o=s.value;for(let t of o){let p=t.replace(new RegExp("\\\\","g"),"/").replace("生成成功：","").trim();if(p){let a=p.split("/");for(let c=0;c<a.length;c++){let L=a[c],R=N(a,c);if(L){let B={title:L,key:R};if(L!=0){let W=N(a,c-1);W&&(B.pid=W)}c==a.length-1&&(B.isLeaf=!0,B.path=p),(n.indexOf(R)<0||c==a.length-1)&&(e.push(B),n.push(R))}}}}return e}function A(){_(),f("close")}function J(){f("download")}function F(e){return e.endsWith("xml")?"application/xml":e.endsWith("sql")?"text/x-sql":e.endsWith("vue")?"text/x-vue":e.endsWith("ts")?"text/typescript":"text/x-java"}function O(e,n){return E(this,null,function*(){let o=n.node.dataRef;if(o.isLeaf){let t=o.path;l[t]||(yield S(t)),d.value=F(t),r.value=l[t]}})}function S(e){return new Promise(n=>{let o={path:encodeURI(e),pathKey:C.value};j.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(t=>{if(!t||t.size===0){U.warning("文件下载失败");return}let p=new Blob([t]),a=new FileReader;a.readAsText(p,"utf8"),a.onload=function(){let c=this.result;l[e]=c,n(1)}})})}return{registerModal:V,codeList:s,onDownloadGenerateCode:J,handleClose:A,treeData:h,showCodeContent:O,activeCodeContent:r,expandStatus:w,height:x,language:d}}});function ee(i,f,s,C,h,w){const x=u("info-circle-two-tone"),d=u("a-directory-tree"),r=u("a-col"),l=u("JCodeEditor"),V=u("a-empty"),_=u("a-row"),y=u("a-button"),b=u("BasicModal");return M(),T(b,{onRegister:i.registerModal,okText:"",cancelText:"关闭",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:i.onDownloadGenerateCode},{title:m(()=>[v(x),D(" 代码在线预览 ")]),footer:m(()=>[v(y,{onClick:i.handleClose},{default:m(()=>[D("关闭")]),_:1},8,["onClick"]),v(y,{type:"primary",onClick:i.onDownloadGenerateCode},{default:m(()=>[D("下载到本地")]),_:1},8,["onClick"])]),default:m(()=>[I("div",null,[v(_,null,{default:m(()=>[v(r,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:m(()=>[I("div",{style:Q({height:i.height+"px",overflowY:"auto"})},[i.treeData.length?(M(),T(d,{key:0,defaultExpandAll:!0,"tree-data":i.treeData,onSelect:i.showCodeContent},null,8,["tree-data","onSelect"])):Z("",!0)],4)]),_:1}),v(r,{span:18,gutter:3},{default:m(()=>[i.activeCodeContent?(M(),T(l,{key:0,value:i.activeCodeContent,"onUpdate:value":f[0]||(f[0]=k=>i.activeCodeContent=k),theme:"idea",language:i.language,fullScreen:!1,lineNumbers:!0,height:i.height+"px","language-change":!0},null,8,["value","language","height"])):(M(),T(V,{key:1,style:{"margin-top":"50px"},description:"请选择左侧文件，显示详细代码"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}const Je=P(X,[["render",ee]]);export{Je as default};
