import _e from"./BasicTable-e53fa5dc.js";import{Q as He}from"./componentMap-d4bccc5b.js";import{k as P,w as Ke,V as c,a5 as i,a6 as S,f,W as g,a9 as u,a7 as r,E as y,F as J,a8 as Pe,ab as v,v as Je,A as Ve,aa as A,am as Ne,ad as qe,ae as ze,af as je,ag as Ue,ah as We}from"./vue-5a09445c.js";import"./useTable-abb474dc.js";import{V as $e,u as Ge,b as Xe}from"./jeecg-online-vendor-231813f7.js";import Ye from"./OnlineAutoModal-2a146238-2372ea4d.js";import Ze from"./OnlineDetailModal-f967f080-a3adce68.js";import eo from"./OnlineCustomModal-456a85a6-0769a673.js";import{x as oo}from"./JImportModal-d6f533eb.js";import{l as to,o as no}from"./useListButton-cef1371a-268f9dea.js";import{d as lo,p as io,g as ro}from"./useExtendComponent-48d37d9b-8cba60ae.js";import ao from"./OnlineQueryForm-1c5949a7-45512a3d.js";import so from"./SuperQuery-3821f984-0e6e89b7.js";import{s as co}from"./constant-fe20103a-44089532.js";import"./index-156cafb7.js";import"./index-ebe32d90.js";import"./BasicForm.vue_vue_type_style_index_0_lang-b507e110.js";import"./antd-vue-vendor-e4fda4cf.js";import"./JAddInput-b2310633.js";import"./JSelectUser-71a05f8d.js";import"./JSelectDept-1f595344.js";import"./JPopup-2fd87e0d.js";import"./cron-parser-vendor-f28c5d73.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-b03a3f81.js";import"./CommentPanel-2e65f3a7.js";import"./DetailForm-e4538e7a-a6da2e4b.js";import"./JUpload.vue_vue_type_style_index_0_lang-5fe736b1.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-fee3f5bc.js";import"./LinkTableListPiece-34266919-c6f6b572.js";import"./BasicTable.vue_vue_type_style_index_0_lang-80d59b16.js";import"./BasicForm-202637f7.js";import"./lodash-es-vendor-3f622b6f.js";import"./BasicModal-4736e0c2.js";import"./useWindowSizeFn-090d6233.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./useForm-b308f6ee.js";import"./injectionKey-69710956.js";import"./useFormItem-9ad9dd7f.js";/* empty css              */import"./download-b10715e6.js";import"./base64Conver-fa2fe1af.js";import"./index-ca8ee4d9.js";import"./index-3e837de3.js";import"./useCountdown-1a556b94.js";import"./useFormItemSingle-2e069e0c.js";import"./areaDataUtil-8b7c0164.js";import"./props-070e4759.js";import"./JSelectBiz-8d24dfc4.js";import"./index-0644f043.js";import"./index-64029d3c.js";import"./bem-a05115ab.js";import"./props-1156b2b9.js";import"./useContextMenu-695a8028.js";import"./depart.api-125ba91d.js";import"./index-a66c1701.js";import"./index-afd7fbfc.js";import"./OnlineForm-630a22c2-b9e102c4.js";import"./user.api-54300816.js";import"./customExpression-62f5afd1.js";import"./useListPage-37055c1f.js";import"./OnlineSelectCascade-c7baf52b-ce6838ff.js";import"./JModalTip-abe1515a-df6ad209.js";import"./OnlineFormDetail-1b216792-0161a664.js";import"./OnlineSubFormDetail-0aa4966c-42855721.js";import"./SuperQueryValComponent.vue_vue_type_script_lang-e3ad7ee8-c5e085e0.js";var O=(e,x,p)=>new Promise((l,T)=>{var C=s=>{try{a(p.next(s))}catch(h){T(h)}},m=s=>{try{a(p.throw(s))}catch(h){T(h)}},a=s=>s.done?l(s.value):Promise.resolve(s.value).then(C,m);a((p=p.apply(e,x)).next())});const uo={name:"DefaultOnlineList",components:{BasicTable:_e,TableAction:He,OnlineAutoModal:Ye,JImportModal:oo,OnlineQueryForm:ao,OnlineSuperQuery:so,OnlineCustomModal:eo,OnlineDetailModal:Ze},setup(){const{createMessage:e}=Ge(),x=P(),{ID:p,onlineTableContext:l,onlineQueryFormOuter:T,loading:C,reload:m,dataSource:a,pagination:s,handleSpecialConfig:h,getColumnList:F,handleChangeInTable:D,loadData:B,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,registerCustomModal:o,getTreeDataByResult:w,expandedRowKeys:d,handleExpandedRowsChange:V,tableReloading:N,onlineExtConfigJson:Q,handleFormConfig:q}=to();if(!p.value){e.warning("地址错误, 配置ID不存在!");return}l.isTree(!0);let{initCgEnhanceJs:z}=lo(l);const{buttonSwitch:j,cgLinkButtonList:U,cgTopButtonList:W,importUrl:$,registerModal:G,handleAdd:_,handleEdit:X,handleBatchDelete:Y,registerImportModal:Z,onImportExcel:ee,onExportExcel:oe,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleSubmitFlow:ie,getDropDownActions:re,getActions:ae,initButtonList:se,initButtonSwitch:de,registerDetailModal:ce}=no(l,Q),{columns:ue,actionColumn:pe,selectedKeys:me,rowSelection:ge,enableScrollBar:he,tableScroll:fe,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,handleColumnResult:Se,hrefComponent:xe,viewOnlineCellImage:Te}=io(l,Q);Ke(p,()=>{ke()},{immediate:!0});function ke(){return O(this,null,function*(){C.value=!0;let t=yield F(co);Re(t),yield B(),C.value=!1,l.execButtonEnhance("setup")})}function Re(t){let n=z(t.enhanceJs);l.EnhanceJS=n,se(t.cgButtonList),de(t.hideColumns),Se(t),h(t),l.hasChildrenField=t.hasChildrenField,l.pidField=t.pidField}function Ie(t,n){l.queryParam=t,n===!0?m():H()}function ve(t){return O(this,null,function*(){yield ro(k),k.value.init(t)})}function Fe(t,n){let b=d.value;if(t){if(De(n.id),n.children.length>0&&n.children[0].isLoading===!0){let R=l.hasChildrenField;const{sortField:Ae,sortType:Oe}=l;let M=Object.assign({},{column:Ae,order:Oe});M[l.pidField]=n.id,M[R]=n[R];let Qe=`${l.onlineUrl.getTreeData}${l.ID}`;Xe.get({url:Qe,params:M},{isTransformResponse:!1}).then(I=>{I.success?Number(I.result.total)>0?n.children=w(I.result.records):(n.children="",n.hasChildrenField="0"):e.warning(I.message)}).catch(()=>{e.warning("加载子节点失败!")})}}else{let R=b.indexOf(n.id);R>=0&&(d.value=b.splice(R,1))}}function De(t){let n=d.value;n&&n.indexOf(t)<0&&n.push(t),d.value=n}function H(){return O(this,null,function*(){l.isTree()===!0&&(d.value=[],x.value.collapseAll()),m()})}function Be(t){if(K.value===!0){let n=t[l.pidField];if(n){let b=d.value;b.indexOf(n)<0&&b.push(n),d.value=b}}m()}const Ee=t=>({label:"添加下级",onClick:Le.bind(null,t)}),K=P(!1);function Le(t){K.value=!0;let n={[l.pidField]:t.id};_(n)}function Me(t){let n=re(t);return n.unshift(Ee(t)),n}return{ID:p,onlineQueryFormOuter:T,queryWithCondition:Ie,onQueryFormLoaded:ve,reload:m,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,loading:C,columns:ue,actionColumn:pe,dataSource:a,pagination:s,rowSelection:ge,selectedKeys:me,tableScroll:fe,enableScrollBar:he,handleChangeInTable:D,buttonSwitch:j,handleAdd:_,handleEdit:X,onImportExcel:ee,onExportExcel:oe,cgTopButtonList:W,cgLinkButtonList:U,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleBatchDelete:Y,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,getActions:ae,getTreeDropDownActions:Me,registerModal:G,registerCustomModal:o,registerImportModal:Z,importUrl:$,handleFormConfig:q,tableReloading:N,handleSubmitFlow:ie,hrefComponent:xe,viewOnlineCellImage:Te,onlineTreeTableRef:x,handlerFormSuccess:Be,searchReset:H,handleExpand:Fe,expandedRowKeys:d,handleExpandedRowsChange:V,registerDetailModal:ce}}},po={class:"p-2"},mo={key:0,style:{"font-size":"12px","font-style":"italic"}},go={key:0,style:{"font-size":"12px","font-style":"italic"}},ho=["src","onClick"],fo=["innerHTML"],yo=["title"];function Co(e,x,p,l,T,C){const m=c("online-query-form"),a=c("a-button"),s=c("online-super-query"),h=c("TableAction"),F=c("BasicTable"),D=c("OnlineAutoModal"),B=c("JImportModal"),k=c("a-modal"),E=c("online-custom-modal"),L=c("online-detail-modal");return i(),S("div",po,[f(m,{ref:"onlineQueryFormOuter",id:e.ID,onSearch:e.queryWithCondition,onLoaded:e.onQueryFormLoaded},null,8,["id","onSearch","onLoaded"]),e.tableReloading?g("",!0):(i(),u(F,{key:0,ref:"onlineTreeTableRef",isTreeTable:!0,expandedRowKeys:e.expandedRowKeys,onExpandedRowsChange:e.handleExpandedRowsChange,onExpand:e.handleExpand,rowKey:"jeecg_row_key",canResize:!0,bordered:!0,showIndexColumn:!1,loading:e.loading,columns:e.columns,dataSource:e.dataSource,pagination:e.pagination,rowSelection:e.rowSelection,actionColumn:e.actionColumn,showTableSetting:!0,clickToRowSelect:!1,scroll:e.tableScroll,onTableRedo:e.reload,class:Ne({"j-table-force-nowrap":e.enableScrollBar}),onChange:e.handleChangeInTable},{tableTitle:r(()=>[e.buttonSwitch.add?(i(),u(a,{key:0,preIcon:"ant-design:plus-outlined",type:"primary",onClick:e.handleAdd},{default:r(()=>[y("新增")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.import?(i(),u(a,{key:1,preIcon:"ant-design:import-outlined",type:"primary",onClick:e.onImportExcel},{default:r(()=>[y("导入")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.export?(i(),u(a,{key:2,preIcon:"ant-design:export-outlined",type:"primary",onClick:e.onExportExcel},{default:r(()=>[y(" 导出")]),_:1},8,["onClick"])):g("",!0),e.cgTopButtonList&&e.cgTopButtonList.length>0?(i(!0),S(J,{key:3},Pe(e.cgTopButtonList,(o,w)=>(i(),S(J,null,[o.optType=="js"?(i(),u(a,{key:"cgbtn"+w,onClick:d=>e.cgButtonJsHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:r(()=>[y(v(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):o.optType=="action"?(i(),u(a,{key:"cgbtn"+w,onClick:d=>e.cgButtonActionHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:r(()=>[y(v(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):g("",!0)],64))),256)):g("",!0),e.buttonSwitch.batch_delete?Je((i(),u(a,{key:4,preIcon:"ant-design:delete-outlined",onClick:e.handleBatchDelete},{default:r(()=>[y(" 批量删除")]),_:1},8,["onClick"])),[[Ve,e.selectedKeys.length>0]]):g("",!0),e.buttonSwitch.super_query?(i(),u(s,{key:5,ref:"superQueryButtonRef",online:"",status:e.superQueryStatus,onSearch:e.handleSuperQuery},null,8,["status","onSearch"])):g("",!0)]),fileSlot:r(({text:o})=>[o?(i(),u(a,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:w=>e.downloadRowFile(o)},{default:r(()=>[y(" 下载 ")]),_:2},1032,["onClick"])):(i(),S("span",mo,"无文件"))]),imgSlot:r(({text:o})=>[o?(i(),S("img",{key:1,src:e.getImgView(o),alt:"图片不存在",class:"online-cell-image",onClick:w=>e.viewOnlineCellImage(o)},null,8,ho)):(i(),S("span",go,"无图片"))]),htmlSlot:r(({text:o})=>[A("div",{innerHTML:o},null,8,fo)]),pcaSlot:r(({text:o})=>[A("div",{title:e.getPcaText(o)},v(e.getPcaText(o)),9,yo)]),dateSlot:r(({text:o})=>[A("span",null,v(e.getFormatDate(o)),1)]),action:r(({record:o})=>[f(h,{actions:e.getActions(o),dropDownActions:e.getTreeDropDownActions(o)},null,8,["actions","dropDownActions"])]),_:1},8,["expandedRowKeys","onExpandedRowsChange","onExpand","loading","columns","dataSource","pagination","rowSelection","actionColumn","scroll","onTableRedo","class","onChange"])),f(D,{id:e.ID,onRegister:e.registerModal,onSuccess:e.handlerFormSuccess,onFormConfig:e.handleFormConfig},null,8,["id","onRegister","onSuccess","onFormConfig"]),f(B,{onRegister:e.registerImportModal,url:e.importUrl(),onOk:e.reload,online:""},null,8,["onRegister","url","onOk"]),f(k,Ue(e.hrefComponent.model,We(e.hrefComponent.on)),{default:r(()=>[(i(),u(qe(e.hrefComponent.is),ze(je(e.hrefComponent.params)),null,16))]),_:1},16),f(E,{onRegister:e.registerCustomModal,onSuccess:e.reload},null,8,["onRegister","onSuccess"]),f(L,{id:e.ID,onRegister:e.registerDetailModal},null,8,["id","onRegister"])])}const Mt=$e(uo,[["render",Co]]);export{Mt as default};
