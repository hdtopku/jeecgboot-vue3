var D=(h,I,a)=>new Promise((u,r)=>{var i=t=>{try{l(a.next(t))}catch(c){r(c)}},s=t=>{try{l(a.throw(t))}catch(c){r(c)}},l=t=>t.done?u(t.value):Promise.resolve(t.value).then(i,s);l((a=a.apply(h,I)).next())});import{d as P,l as n,V as m,a7 as f,a8 as A,f as v,aa as d,E as O,ad as C,ac as w,ae as W,W as z,u as y,F as G}from"./vue-86253b15.js";import{_ as H}from"./index-6021b022.js";import{u as J,a as Q,B as U}from"./index-6be60ec8.js";import{q as X}from"./jeecg-online-vendor-bc5d810e.js";import Y from"./DepartRoleDataRuleDrawer-048da143.js";import{a as Z,b as ee,c as ae}from"./depart.user.api-0c9706fc.js";import"./antd-vue-vendor-371529c2.js";import"./tinymce-vendor-7c917b36.js";import"./index-4de4eaa0.js";import"./lodash-es-vendor-04a44d0a.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./vxe-table-vendor-6a8d95c4.js";import"./bem-6904c165.js";import"./props-3eac2fce.js";import"./useContextMenu-368c1b38.js";const ke=P({__name:"DepartRoleAuthDrawer",emits:["register"],setup(h){const{createMessage:I}=X(),a=n(!1),u=n(""),r=n(""),i=n([]),s=n([]),l=n([]),t=n([]),c=n([]),b=n([]),K=n(!0),[B,{closeDrawer:F}]=J(e=>{r.value=e.record.id,u.value=e.record.departId,R()}),[S,T]=Q();function R(){return D(this,null,function*(){try{a.value=!0;const{ids:e,treeList:o}=yield Z({departId:u.value});e.length>0?(b.value=e,t.value=e,i.value=o,s.value=yield ee({roleId:r.value}),l.value=[s.value]):g()}finally{a.value=!1}})}function g(){i.value=[],t.value=[],s.value=[],l.value=[],a.value=!1}function V(e){K.value?s.value=e.checked:s.value=e}function E(e){t.value=e}function N(e,{selectedNodes:o}){var p;if((p=o[0])!=null&&p.ruleFlag){let _=e[0];T.openDrawer(!0,{roleId:r,departId:u,functionId:_})}c.value=[]}function $(){g(),F()}function q(){g()}function x(e){return D(this,null,function*(){try{a.value=!0;let o={roleId:r.value,permissionIds:s.value.join(","),lastpermissionIds:l.value.join(",")};yield ae(o),e&&$()}finally{a.value=!1,e||R()}})}return(e,o)=>{const p=m("Icon"),_=m("a-empty"),j=m("a-spin"),L=m("a-button");return f(),A(G,null,[v(y(U),{title:"部门角色权限配置",width:650,loading:a.value,showFooter:"",okText:"保存并关闭",onOk:o[1]||(o[1]=k=>x(!0)),onClose:q,onRegister:y(B)},{centerFooter:d(()=>[v(L,{type:"primary",loading:a.value,ghost:"",onClick:o[0]||(o[0]=k=>x(!1))},{default:d(()=>[O("仅保存")]),_:1},8,["loading"])]),default:d(()=>[C("div",null,[v(j,{spinning:a.value},{default:d(()=>[i.value.length>0?(f(),w(y(H),{key:0,title:"所拥有的部门权限",toolbar:"",checkable:"",treeData:i.value,checkedKeys:s.value,selectedKeys:c.value,expandedKeys:t.value,checkStrictly:K.value,clickRowToExpand:!1,onCheck:V,onExpand:E,onSelect:N},{title:d(({slotTitle:k,ruleFlag:M})=>[C("span",null,W(k),1),M?(f(),w(p,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):z("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(f(),w(_,{key:1,description:"无可配置部门权限"}))]),_:1},8,["spinning"])])]),_:1},8,["loading","onRegister"]),v(Y,{onRegister:y(S)},null,8,["onRegister"])],64)}}});export{ke as default};
