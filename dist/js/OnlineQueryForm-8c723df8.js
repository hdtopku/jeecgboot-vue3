import{B as ie}from"./BasicForm-83ba9c88.js";import"./componentMap-a6d21ad6.js";import{u as le}from"./useForm-fa63344e.js";import"./JAddInput-2cbbbde9.js";import"./index-fde9c72f.js";import{bW as ue,ad as ce,l as me}from"./jeecg-online-vendor-bf2efbcb.js";import{u as pe,g as de,j as L,k as fe,F as Y,m as he,n as ge,o as A}from"./useExtendComponent-f3ffbcdf.js";import"./index-8cf3aabb.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-0a69d004.js";import"./pick-51214243.js";import"./_flatRest-34ab130c.js";import"./isArray-b183d537.js";import"./toString-8deea73b.js";import"./_arrayPush-ae8b790e.js";import"./BasicTable.vue_vue_type_style_index_0_lang-b7d11241.js";import"./useTable-7e303edd.js";import"./LinkTableListPiece-50f8f8cc.js";import"./OnlineSelectCascade-dee0bae8.js";import{k as x,r as _e,w as U,J as M,U as E,aV as H,as as W,f as h,bi as O,at as j,E as N,ag as ye,V as q,aX as ve,aW as Fe}from"./vue-c7e3516e.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./useFormItem-4a12ff45.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./index-ed4be6fa.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./user.api-dd1b3184.js";import"./_commonjsHelpers-938fab4e.js";import"./customExpression-e22f3cce.js";import"./BasicTable-29c6504d.js";import"./injectionKey-5da932b3.js";import"./useListPage-5049b37a.js";import"./JModalTip-b651c0e6.js";var be=Object.defineProperty,J=Object.getOwnPropertySymbols,we=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,K=(l,n,i)=>n in l?be(l,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[n]=i,R=(l,n)=>{for(var i in n||(n={}))we.call(n,i)&&K(l,i,n[i]);if(J)for(var i of J(n))Se.call(n,i)&&K(l,i,n[i]);return l},k=(l,n,i)=>new Promise((u,_)=>{var C=d=>{try{v(i.next(d))}catch(F){_(F)}},y=d=>{try{v(i.throw(d))}catch(F){_(F)}},v=d=>d.done?u(d.value):Promise.resolve(d.value).then(C,y);v((i=i.apply(l,n)).next())});const xe={name:"OnlineQueryForm",components:{BasicForm:ie},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(l,{emit:n}){const i="/online/cgform/api/getQueryInfoVue3/",u=x(null),_=x([]),C=x({xs:24,sm:24,md:12,lg:6,xl:6}),y=x(!1),v=x(!1),d=x({}),F=x([]),{createMessage:I}=me(),{linkTableCard2Select:B}=pe(),o=_e({config:{},cache:{},param:{},status:!1});U(()=>o.status,t=>k(this,null,function*(){const{config:e,cache:s,param:g}=M(o);let b=Object.assign({},e,s,g);yield X(b)}),{immediate:!0,deep:!0});function c(t,e){return k(this,null,function*(){o.cache=R({},t),o.param=R({},e),o.status=!o.status})}U(()=>l.id,t=>{t?G():_.value=[]},{immediate:!0});function p(t){return k(this,null,function*(){let e=[],s={},g=Object.keys(t);for(let a of g){const r=t[a];a==="sys_org_code"&&(r.fieldExtendJson||(r.fieldExtendJson='{"store":"orgCode"}'));let m=r.view;if(L[m]&&(r.view=L[m]),yield fe(a,r,s),r.mode=="group"&&(m=="date"||m=="datetime"||m=="number")){let w=Y.createSlotFormSchema(a,r);e.push(w)}else if(r.view===he){let w=ge(r,a);for(let S of w){let V=Y.createFormSchema(S.key,S),D=A(e,S.key);D==-1?e.push(V):e[D]=V}}else if(A(e,a)==-1){let S=Y.createFormSchema(a,r);e.push(S)}}e.sort(function(a,r){return a.order-r.order});let b=[];e.length>2&&(y.value=!0);let f=[];for(let a=0;a<e.length;a++){let r=e[a];r.setFormRef(u),r.noChange(),r.asSearchForm(),a>1&&(f.push(r.field),r.isHidden());let m=r.getFormItemSchema();r.slot=="groupDatetime"&&(m.colProps={xs:24,sm:24,md:12,lg:8,xl:8}),B(m),b.push(m)}F.value=f,_.value=b,o.config=R({},s),o.status=!o.status})}function G(){return k(this,null,function*(){let t=yield $(),e=Z(t);n("loaded",t);let{formProperties:s,hasField:g}=z(e,t);if(g==!1){_.value=[];return}yield p(s)})}function X(t){return k(this,null,function*(){yield de(u),yield T(t),Object.keys(t).length>0&&P()})}function z(t,e){const{searchFieldList:s,joinQuery:g,table:b}=e;let f=!1,a={};return t&&Object.keys(t).map(r=>{s.indexOf(r)>=0&&(g==!0?r.indexOf("@")<0?(a[b+"@"+r]=t[r],f=!0):(a[r]=t[r],f=!0):r.indexOf("@")<0&&(a[r]=t[r],f=!0))}),{formProperties:a,hasField:f}}function Z(t){const{properties:e,searchFieldList:s,joinQuery:g,table:b}=t;let f={},a=1;return Object.keys(e).map(r=>{let m=e[r];if(m.view=="table"){let w=m.properties,S=a*100;Object.keys(w).map(V=>{let D=w[V];D.order=S+Number(D.order);let se=r+"@"+V;f[se]=D}),a++}else m.order=Number(m.order),f[r]=m}),f}function $(){let t=`${i}${l.id}`;return new Promise(e=>{ce.get({url:t},{isTransformResponse:!1}).then(s=>{s.success?e(s.result):(e(!1),I.warning(s.message))}).catch(()=>{I.warning("\u83B7\u53D6\u67E5\u8BE2\u6761\u4EF6\u5931\u8D25!"),e(!1)})})}const[ee,{resetFields:te,setFieldsValue:T,updateSchema:re,getFieldsValue:oe}]=le({schemas:_,showActionButtonGroup:!1,baseColProps:C,autoSubmitOnEnter:!0,submitFunc(){P()}});function P(){let t=oe(),e=Object.assign({},M(o.param),ne(t));n("search",e,!0)}function ae(){return k(this,null,function*(){yield te();const{config:t,param:e}=M(o);let s=Object.assign({},t,e);Object.keys(s).length>0&&(yield T(s)),n("search",s,!1)})}function ne(t){return Object.keys(t).map(e=>{t[e]&&t[e]instanceof Array&&(t[e]=t[e].join(","))}),t}return U(()=>v.value,t=>{let e=F.value;if(e&&e.length>0){let s=[];for(let g of e)s.push({field:g,show:t});re(s)}},{immediate:!1}),{onlineQueryFormRef:u,registerForm:ee,initDefaultValues:c,toggleButtonShow:y,toggleSearchStatus:v,doSearch:P,resetSearch:ae,queryParams:d,formSchemas:_}}},Q=l=>(ve("data-v-4b8f6d7a"),l=l(),Fe(),l),Oe={key:0,class:"jeecg-basic-table-form-container p-0"},De=Q(()=>j("span",{class:"group-query-string"},"~",-1)),Ee=Q(()=>j("span",{class:"group-query-string"},"~",-1)),ke=Q(()=>j("span",{class:"group-query-string"},"~",-1)),Ve={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function Ce(l,n,i,u,_,C){const y=E("a-date-picker"),v=E("a-input-number"),d=E("a-button"),F=E("a-icon"),I=E("a-col"),B=E("BasicForm");return u.formSchemas&&u.formSchemas.length>0?(H(),W("div",Oe,[h(B,{ref:"onlineQueryFormRef",onRegister:u.registerForm},{groupDate:O(({model:o,field:c})=>[h(y,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u5F00\u59CB\u65E5\u671F",value:o[c+"_begin"],"onUpdate:value":p=>o[c+"_begin"]=p,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),De,h(y,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"\u7ED3\u675F\u65E5\u671F",value:o[c+"_end"],"onUpdate:value":p=>o[c+"_end"]=p,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),groupDatetime:O(({model:o,field:c})=>[h(y,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u5F00\u59CB\u65F6\u95F4",value:o[c+"_begin"],"onUpdate:value":p=>o[c+"_begin"]=p,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),Ee,h(y,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"\u7ED3\u675F\u65F6\u95F4",value:o[c+"_end"],"onUpdate:value":p=>o[c+"_end"]=p,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),groupNumber:O(({model:o,field:c})=>[h(v,{placeholder:"\u5F00\u59CB\u503C",value:o[c+"_begin"],"onUpdate:value":p=>o[c+"_begin"]=p,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),ke,h(v,{placeholder:"\u7ED3\u675F\u503C",value:o[c+"_end"],"onUpdate:value":p=>o[c+"_end"]=p,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),formFooter:O(()=>[h(I,{md:6,sm:8},{default:O(()=>[j("span",Ve,[h(d,{preIcon:"ant-design:search",type:"primary",onClick:u.doSearch},{default:O(()=>[N("\u67E5\u8BE2")]),_:1},8,["onClick"]),h(d,{preIcon:"ant-design:reload",type:"primary",onClick:u.resetSearch,style:{"margin-left":"8px"}},{default:O(()=>[N("\u91CD\u7F6E")]),_:1},8,["onClick"]),u.toggleButtonShow?(H(),W("a",{key:0,onClick:n[0]||(n[0]=o=>u.toggleSearchStatus=!u.toggleSearchStatus),style:{"margin-left":"8px"}},[N(ye(u.toggleSearchStatus?"\u6536\u8D77":"\u5C55\u5F00")+" ",1),h(F,{type:u.toggleSearchStatus?"up":"down"},null,8,["type"])])):q("",!0)])]),_:1})]),_:1},8,["onRegister"])])):q("",!0)}var It=ue(xe,[["render",Ce],["__scopeId","data-v-4b8f6d7a"]]);export{It as default};
