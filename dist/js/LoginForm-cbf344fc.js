var q=(T,n,d)=>new Promise((i,w)=>{var S=c=>{try{g(d.next(c))}catch(C){w(C)}},a=c=>{try{g(d.throw(c))}catch(C){w(C)}},g=c=>c.done?i(c.value):Promise.resolve(c.value).then(S,a);g((d=d.apply(T,n)).next())});import{d as W,l as y,r as U,e as H,u as e,o as J,a7 as F,a8 as $,v as N,B as O,f as s,aa as o,E as f,ae as p,ad as k,ak as Q,a9 as X,F as Y,J as Z}from"./vue-86253b15.js";import{c as ee}from"./checkcode-5ec5fe8f.js";import{cX as se,bo as E,bH as te,bz as v,bU as oe,cY as ae,cZ as le,c_ as ne,c2 as P,c4 as ie,c3 as re}from"./antd-vue-vendor-371529c2.js";import{m as ue}from"./index-4de4eaa0.js";import{u as de,bl as ce,bm as me,br as x,o as fe,q as pe,bn as ge,bs as ye}from"./jeecg-online-vendor-bc5d810e.js";import Ce from"./LoginFormTitle-a5a36097.js";import ke from"./ThirdModal-42c14f0f.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-04a44d0a.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./vxe-table-vendor-6a8d95c4.js";import"./index-f5da07b2.js";import"./useCountdown-7a164eb2.js";import"./useFormItemSingle-1ae794f9.js";import"./useThirdLogin-0d9bb353.js";const ve=["src"],Ke=W({__name:"LoginForm",setup(T){const n=ie,d=re,i=P.Item,w=E.Password,S=se({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),{t:a}=fe(),{notification:g,createErrorModal:c}=pe(),{prefixCls:C}=ue("login"),V=de(),{setLoginState:_,getLoginState:A}=ce(),{getFormRules:G}=me(),D=y(),L=y(),I=y(!1),M=y(!1),r=U({account:"",password:"",inputCode:""}),m=U({randCodeImage:"",requestCodeSuccess:!1,checkKey:null}),{validForm:j}=ge(D),z=H(()=>e(A)===x.LOGIN),R=y(),B=y();function K(){return q(this,null,function*(){const u=yield j();if(u)try{I.value=!0;const{userInfo:t}=yield V.login(Z({password:u.password,username:u.account,captcha:u.inputCode,checkKey:m.checkKey,mode:"none"}));t&&g.success({message:a("sys.login.loginSuccessTitle"),description:`${a("sys.login.loginSuccessDesc")}: ${t.realname}`,duration:3})}catch(t){g.error({message:a("sys.api.errorTip"),description:t.message||a("sys.api.networkExceptionMsg"),duration:3}),I.value=!1,t.message==="验证码错误"?(r.inputCode="",R.value.focus(),b()):(t.message==="该用户不存在，请注册"||t.message==="用户名或密码错误")&&B.value.focus()}})}function b(){r.inputCode="",m.checkKey=1629428467008,ye(m.checkKey).then(u=>{m.randCodeImage=u,m.requestCodeSuccess=!0,R.value.focus()})}function h(u){L.value.onThirdLogin(u)}return J(()=>{b()}),(u,t)=>(F(),$(Y,null,[N(s(Ce,{class:"enter-x"},null,512),[[O,z.value]]),N(s(e(P),{class:"p-4 enter-x",model:r,rules:e(G),ref_key:"formRef",ref:D,onKeypress:X(K,["enter"])},{default:o(()=>[s(e(i),{name:"account",class:"enter-x"},{default:o(()=>[s(e(E),{ref_key:"usernameRef",ref:B,allowClear:"",size:"large",value:r.account,"onUpdate:value":t[0]||(t[0]=l=>r.account=l),placeholder:e(a)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(i),{name:"password",class:"enter-x"},{default:o(()=>[s(e(w),{allowClear:"",size:"large",visibilityToggle:"",value:r.password,"onUpdate:value":t[1]||(t[1]=l=>r.password=l),placeholder:e(a)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x",gutter:4},{default:o(()=>[s(e(n),{span:16},{default:o(()=>[s(e(i),{name:"inputCode",class:"enter-x"},{default:o(()=>[s(e(E),{allowClear:"",ref_key:"inputCodeRef",ref:R,autocomplete:"off",size:"large",value:r.inputCode,"onUpdate:value":t[2]||(t[2]=l=>r.inputCode=l),placeholder:e(a)("sys.login.inputCode")},null,8,["value","placeholder"])]),_:1})]),_:1}),s(e(n),{span:8},{default:o(()=>[s(e(i),{style:{"text-align":"right","margin-left":"20px"},class:"enter-x"},{default:o(()=>[m.requestCodeSuccess?(F(),$("img",{key:0,style:{"margin-top":"2px","max-width":"initial"},src:m.randCodeImage,onClick:b},null,8,ve)):(F(),$("img",{key:1,style:{"margin-top":"2px","max-width":"initial"},src:ee,onClick:b}))]),_:1})]),_:1})]),_:1}),s(e(d),{class:"enter-x"},{default:o(()=>[s(e(n),{span:12},{default:o(()=>[s(e(i),null,{default:o(()=>[s(e(te),{checked:M.value,"onUpdate:checked":t[3]||(t[3]=l=>M.value=l),size:"small"},{default:o(()=>[f(p(e(a)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(n),{span:12},{default:o(()=>[s(e(i),{style:{"text-align":"right"}},{default:o(()=>[s(e(v),{type:"link",size:"small",onClick:t[4]||(t[4]=l=>e(_)(e(x).RESET_PASSWORD))},{default:o(()=>[f(p(e(a)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(e(i),{class:"enter-x"},{default:o(()=>[s(e(v),{type:"primary",size:"large",block:"",onClick:K,loading:I.value},{default:o(()=>[f(p(e(a)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:o(()=>[s(e(n),{md:8,xs:24},{default:o(()=>[s(e(v),{block:"",onClick:t[5]||(t[5]=l=>e(_)(e(x).MOBILE))},{default:o(()=>[f(p(e(a)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:o(()=>[s(e(v),{block:"",onClick:t[6]||(t[6]=l=>e(_)(e(x).QR_CODE))},{default:o(()=>[f(p(e(a)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(n),{md:7,xs:24},{default:o(()=>[s(e(v),{block:"",onClick:t[7]||(t[7]=l=>e(_)(e(x).REGISTER))},{default:o(()=>[f(p(e(a)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(oe),{class:"enter-x"},{default:o(()=>[f(p(e(a)("sys.login.otherSignIn")),1)]),_:1}),k("div",{class:Q(["flex justify-evenly enter-x",`${e(C)}-sign-in-way`])},[k("a",{onClick:t[8]||(t[8]=l=>h("github")),title:"github"},[s(e(ae))]),k("a",{onClick:t[9]||(t[9]=l=>h("wechat_enterprise")),title:"企业微信"},[s(e(S),{class:"item-icon",type:"icon-qiyeweixin3"})]),k("a",{onClick:t[10]||(t[10]=l=>h("dingtalk")),title:"钉钉"},[s(e(le))]),k("a",{onClick:t[11]||(t[11]=l=>h("wechat_open")),title:"微信"},[s(e(ne))])],2)]),_:1},8,["model","rules","onKeypress"]),[[O,z.value]]),s(ke,{ref_key:"thirdModalRef",ref:L},null,512)],64))}});export{Ke as default};
