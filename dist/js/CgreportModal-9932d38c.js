import{B as ne}from"./index-8cf3aabb.js";import{B as ie}from"./BasicForm-83ba9c88.js";import"./componentMap-a6d21ad6.js";import{u as se}from"./useForm-fa63344e.js";import"./JAddInput-2cbbbde9.js";import{aj as n,A as ce}from"./index-fde9c72f.js";import{useJvxeMethod as de}from"./useJvxeMethods-92baf332.js";import{d as pe}from"./user.api-dd1b3184.js";import{ad as b,l as U}from"./jeecg-online-vendor-bf2efbcb.js";import{d as me,k as x,r as R,e as fe,u as h,U as y,aV as L,ar as T,bi as B,f as _,at as C,E as D,aQ as ge}from"./vue-c7e3516e.js";import"./BasicModal-ff8f2086.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./useWindowSizeFn-e5cad7ae.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./useFormItem-4a12ff45.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./index-ed4be6fa.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./vxeUtils-681bb911.js";var he=Object.defineProperty,Fe=Object.defineProperties,Be=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,j=(t,u,o)=>u in t?he(t,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[u]=o,W=(t,u)=>{for(var o in u||(u={}))_e.call(u,o)&&j(t,o,u[o]);if(M)for(var o of M(u))be.call(u,o)&&j(t,o,u[o]);return t},ye=(t,u)=>Fe(t,Be(u)),$=(t,u,o)=>new Promise((m,E)=>{var f=c=>{try{s(o.next(c))}catch(S){E(S)}},F=c=>{try{s(o.throw(c))}catch(S){E(S)}},s=c=>c.done?m(c.value):Promise.resolve(c.value).then(f,F);s((o=o.apply(t,u)).next())});const{createConfirm:Ce}=U(),Ee="/online/cgreport/param/listByHeadId",ve="/online/cgreport/item/listByHeadId",xt=t=>b.get({url:"/online/cgreport/head/list",params:t}),Dt=(t,u)=>b.delete({url:"/online/cgreport/head/delete",params:t},{joinParamsToUrl:!0}).then(()=>{u()}),St=(t,u)=>{Ce({title:"\u786E\u8BA4\u5220\u9664",content:"\u662F\u5426\u5220\u9664\u9009\u4E2D\u6570\u636E",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",iconType:"warning",onOk:()=>b.delete({url:"/online/cgreport/head/deleteBatch",data:t},{joinParamsToUrl:!0}).then(()=>{u()})})},Ae=(t,u)=>u?b.put({url:"/online/cgreport/head/editAll",params:t}):b.post({url:"/online/cgreport/head/add",params:t}),Pt=t=>b.get({url:"/online/cgreport/api/getParamsInfo/"+t}),xe=()=>b.get({url:"/sys/dataSource/options"}),De=t=>b.get({url:"/online/cgreport/head/parseSql?"+t}),wt=[{title:"\u62A5\u8868\u540D\u5B57",align:"center",dataIndex:"name",width:120},{title:"\u62A5\u8868\u7F16\u7801",align:"center",dataIndex:"code",width:120},{title:"\u62A5\u8868SQL",align:"center",dataIndex:"cgrSql",width:360},{title:"\u6570\u636E\u6E90",align:"center",dataIndex:"dbSource",width:120},{title:"\u521B\u5EFA\u65F6\u95F4",align:"center",dataIndex:"createTime",width:120}],kt=[{label:"\u62A5\u8868\u540D\u79F0",field:"name",component:"JInput"},{label:"\u62A5\u8868\u7F16\u7801",field:"code",component:"JInput"}],Se=/^[a-z|A-Z][a-z|A-Z|\d|_|-]{0,}$/,Pe=[{label:"",field:"id",component:"Input",show:!1},{label:"\u62A5\u8868\u7F16\u7801",field:"code",component:"Input",colProps:{sm:24,xs:24,md:12,lg:8,xl:8,xxl:8},dynamicRules:({values:t,model:u})=>[{required:!0,validator:(o,m)=>new Promise((E,f)=>{if(!m)return f("\u8BF7\u8F93\u5165\u62A5\u8868\u7F16\u7801\uFF01");if(!Se.test(m))return f("\u7F16\u7801\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF0C\u53EF\u5305\u542B\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u6A2A\u6760\uFF01");let F={tableName:"onl_cgreport_head",fieldName:"code",fieldVal:m,dataId:u.id};pe(F).then(s=>{s.success?E():f("\u62A5\u8868\u7F16\u7801\u5DF2\u5B58\u5728!")}).catch(s=>{f(s.message||"\u6821\u9A8C\u5931\u8D25")})})}]},{label:"\u62A5\u8868\u540D\u5B57",field:"name",component:"Input",colProps:{sm:24,xs:24,md:12,lg:8,xl:8,xxl:8},dynamicRules:()=>[{required:!0,message:"\u8BF7\u8F93\u5165\u62A5\u8868\u540D\u5B57!"}]},{label:"\u52A8\u6001\u6570\u636E\u6E90",field:"dbSource",colProps:{sm:24,xs:24,md:12,lg:8,xl:8,xxl:8},component:"ApiSelect",componentProps:{api:xe}},{label:"\u62A5\u8868SQL",field:"cgrSql",component:"JCodeEditor",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u62A5\u8868SQL"}],itemProps:{labelCol:{xs:24,sm:2},wrapperCol:{xs:24,sm:22}},componentProps:{height:"200px",fullScreen:!0},colProps:{span:20}},{label:" ",field:"analyseButton",component:"Input",slot:"analyseButton",colProps:{span:4},itemProps:{labelCol:{xs:1,sm:1},wrapperCol:{xs:23,sm:23},colon:!1}}],we=[{title:"\u53C2\u6570\u5B57\u6BB5",key:"paramName",type:n.input,width:"200px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:"",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u53C2\u6570\u6587\u672C",key:"paramTxt",type:n.input,width:"200px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:"",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u53C2\u6570\u9ED8\u8BA4\u503C",key:"paramValue",type:n.input,width:"200px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:""}],ke=[{title:"\u5B57\u6BB5\u540D\u5B57",key:"fieldName",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:"",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u5B57\u6BB5\u6587\u672C",key:"fieldTxt",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:"",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u5B57\u6BB5\u7C7B\u578B",key:"fieldType",minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:"",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}],type:n.select,options:[{title:"\u6570\u503C\u7C7B\u578B",value:"Integer"},{title:"\u5B57\u7B26\u7C7B\u578B",value:"String"},{title:"\u65E5\u671F\u7C7B\u578B",value:"Date"},{title:"\u65F6\u95F4\u7C7B\u578B",value:"Datetime"},{title:"\u957F\u6574\u578B",value:"Long"}]},{title:"\u662F\u5426\u663E\u793A",key:"isShow",minWidth:"80px",align:"center",type:n.checkbox,customValue:[1,0],defaultChecked:!0},{title:"\u5B57\u6BB5href",key:"fieldHref",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:""},{title:"\u67E5\u8BE2\u6A21\u5F0F",key:"searchMode",type:n.select,minWidth:"150px",placeholder:"\u8BF7\u9009\u62E9${title}",options:[{title:"\u5355\u6761\u4EF6\u67E5\u8BE2",value:"single"},{title:"\u8303\u56F4\u67E5\u8BE2",value:"group"}]},{title:"\u53D6\u503C\u8868\u8FBE\u5F0F",key:"replaceVal",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:""},{title:"\u5B57\u5178code",key:"dictCode",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:""},{title:"\u5206\u7EC4\u6807\u9898",key:"groupTitle",type:n.input,minWidth:"150px",placeholder:"\u8BF7\u8F93\u5165${title}",defaultValue:""},{title:"\u662F\u5426\u67E5\u8BE2",key:"isSearch",type:n.checkbox,customValue:["1","0"],minWidth:"80px",align:"center",defaultChecked:!1},{title:"\u662F\u5426\u5408\u8BA1",align:"center",key:"isTotal",type:n.checkbox,customValue:["1","0"],minWidth:"80px",defaultChecked:!1}],Ie={style:{flex:"1","text-align":"left"}},Ve=C("br",null,null,-1),Oe=C("br",null,null,-1),Le=C("br",null,null,-1),Te=C("br",null,null,-1),$e=C("br",null,null,-1),qe=C("span",{style:{color:"red"}},"\u6CE8\uFF1A\u53C2\u6570\u53EA\u652F\u6301\u52A8\u6001\u62A5\u8868\uFF0Cpopup\u6682\u4E0D\u652F\u6301",-1),Ne=me({__name:"CgreportModal",emits:["register","success"],setup(t,{emit:u}){const{createMessage:o}=U(),m=x(!0),E=x(!0),f=x(["onlCgreportItem","onlCgreportParam"]),F=x("onlCgreportItem"),s=x(),c=x(),S={onlCgreportItem:c,onlCgreportParam:s},v=R({loading:!1,dataSource:[],columns:we}),A=R({loading:!1,dataSource:[],columns:ke}),[z,{setProps:J,resetFields:K,setFieldsValue:Q,validate:Re,validateFields:H}]=se({schemas:Pe,showActionButtonGroup:!1}),[Z,{setModalProps:P,closeModal:G}]=ce(e=>$(this,null,function*(){var r,l;yield ue(),P({confirmLoading:!1,showCancelBtn:e==null?void 0:e.showFooter,showOkBtn:e==null?void 0:e.showFooter}),m.value=!!(e!=null&&e.isUpdate),h(m)&&(yield Q(W({},e.record)),q(Ee,{headId:(r=e==null?void 0:e.record)==null?void 0:r.id},v),q(ve,{headId:(l=e==null?void 0:e.record)==null?void 0:l.id},A)),J({disabled:!(e!=null&&e.showFooter)})})),[X,Y,q,ee]=de(re,oe,S,F,f),te=fe(()=>h(m)?"\u7F16\u8F91":"\u65B0\u589E");function ue(){return $(this,null,function*(){yield K(),F.value="onlCgreportItem",v.dataSource=[],A.dataSource=[]})}function oe(e){let r=Object.assign({},e.formValue);return ye(W({},r),{onlCgreportParamList:e.tablesValue[1].tableData,onlCgreportItemList:e.tablesValue[0].tableData})}function re(e){return $(this,null,function*(){try{P({confirmLoading:!0});let r=[],l=[],i={};Object.keys(e).map(a=>{a=="onlCgreportItemList"?l=e[a]:a=="onlCgreportParamList"?r=e[a]:i[a]=e[a]}),yield Ae({head:i,params:r,items:l},m.value),G(),u("success")}finally{P({confirmLoading:!1})}})}function le(){P({confirmLoading:!0}),H(["cgrSql","dbSource"]).then(e=>{let{cgrSql:r,dbSource:l}=e,i="sql="+encodeURIComponent(r);l&&(i+="&dbKey="+l),De(i).then(d=>{if(d){o.success("\u89E3\u6790\u6210\u529F");let{fields:a,params:p}=d,g=a.filter(k=>k.fieldName!="__row_number__"),I=c.value.getTableData(),w=N(I,g||[],"fieldName");w=w.sort((k,O)=>k.orderNum-O.orderNum),A.dataSource=w;let ae=s.value.getTableData(),V=N(ae,p||[],"paramName");V=V.sort((k,O)=>k.orderNum-O.orderNum),v.dataSource=V}})}).catch(()=>{}).finally(()=>{P({confirmLoading:!1})})}function N(e,r,l){if(e.length>0){let i=[],d=[],a=1;for(let p of r)for(let g of e)if(g[l]==p[l]){i.push(g),d.push(p[l]),g.orderNum>a&&(a=g.orderNum);break}for(let p of r)d.indexOf(p[l])<0&&(p.orderNum=++a,i.push(p));return i}else{let i=0;for(let d of r)d.orderNum||(d.orderNum=++i);return r}}return(e,r)=>{const l=y("a-icon"),i=y("a-popover"),d=y("a-button"),a=y("a-divider"),p=y("JVxeTable"),g=y("a-tab-pane"),I=y("a-tabs");return L(),T(h(ne),ge(e.$attrs,{onRegister:h(Z),title:h(te),width:1200,maskClosable:!1,defaultFullscreen:!0,confirmLoading:E.value,onOk:h(Y)}),{default:B(()=>[_(h(ie),{onRegister:h(z),ref_key:"formRef",ref:ee},{analyseButton:B(()=>[C("div",Ie,[_(i,{title:"\u4F7F\u7528\u6307\u5357",trigger:"hover",style:{margin:"0 10px 0 6px"}},{content:B(()=>[D(" \u60A8\u53EF\u4EE5\u952E\u5165\u201C\u201D\u4F5C\u4E3A\u4E00\u4E2A\u53C2\u6570\uFF0C\u8FD9\u91CCabc\u662F\u53C2\u6570\u7684\u540D\u79F0\u3002\u4F8B\u5982\uFF1A"),Ve,D(" select * from table where id = ${abc}\u3002"),Oe,D(" select * from table where id like concat('%',${abc},'%')\u3002(mysql\u6A21\u7CCA\u67E5\u8BE2)"),Le,D(" select * from table where id like '%'||${abc}||'%'\u3002(oracle\u6A21\u7CCA\u67E5\u8BE2)"),Te,D(" select * from table where id like '%'+${abc}+'%'\u3002(sqlserver\u6A21\u7CCA\u67E5\u8BE2)"),$e,qe]),default:B(()=>[_(l,{type:"question-circle"})]),_:1}),_(d,{style:{"margin-left":"10px"},type:"primary",onClick:le},{default:B(()=>[D("SQL\u89E3\u6790")]),_:1})])]),_:1},8,["onRegister"]),_(a,{style:{margin:"1px 0"},class:"cust-divider"}),_(I,{activeKey:F.value,"onUpdate:activeKey":r[0]||(r[0]=w=>F.value=w),animated:"",onChange:h(X)},{default:B(()=>[(L(),T(g,{tab:"\u52A8\u6001\u62A5\u8868\u914D\u7F6E\u660E\u7EC6",key:f.value[0],forceRender:!0},{default:B(()=>[_(p,{"keep-source":"",dragSort:"",resizable:"",ref_key:"onlCgreportItem",ref:c,loading:A.loading,columns:A.columns,dataSource:A.dataSource,height:390,rowNumber:!0,rowSelection:!0,toolbar:!0},null,8,["loading","columns","dataSource"])]),_:1})),(L(),T(g,{tab:"\u62A5\u8868\u53C2\u6570",key:f.value[1],forceRender:!0},{default:B(()=>[_(p,{"keep-source":"",resizable:"",dragSort:"",ref_key:"onlCgreportParam",ref:s,loading:v.loading,columns:v.columns,dataSource:v.dataSource,height:390,rowNumber:!0,rowSelection:!0,toolbar:!0},null,8,["loading","columns","dataSource"])]),_:1}))]),_:1},8,["activeKey","onChange"])]),_:1},16,["onRegister","title","confirmLoading","onOk"])}}});var It=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{It as C,Ne as _,St as b,wt as c,Dt as d,Pt as g,xt as l,kt as s};
