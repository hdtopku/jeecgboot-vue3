var T=Object.defineProperty;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var w=(e,o,t)=>o in e?T(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,x=(e,o)=>{for(var t in o||(o={}))U.call(o,t)&&w(e,t,o[t]);if(v)for(var t of v(o))_.call(o,t)&&w(e,t,o[t]);return e};var b=(e,o,t)=>new Promise((c,l)=>{var u=r=>{try{p(t.next(r))}catch(m){l(m)}},g=r=>{try{p(t.throw(r))}catch(m){l(m)}},p=r=>r.done?c(r.value):Promise.resolve(r.value).then(u,g);p((t=t.apply(e,o)).next())});import{B as L}from"./index-378f1f74.js";import{B as S}from"./BasicForm-b17dbcb2.js";import"./componentMap-ac4d3a60.js";import{u as F}from"./useForm-ec2789c8.js";import"./JAddInput-079a6c33.js";import"./JSelectUser-b7290477.js";import"./JSelectDept-52bb52e5.js";import"./JPopup-4aed0a12.js";import{B as M}from"./index-b6e19f4a.js";import{b as i}from"./jeecg-online-vendor-88d7be55.js";import{ab as R}from"./antd-vue-vendor-cce59da1.js";import{d as D,k as f,e as O,u as a,a5 as A,a9 as E,a7 as H,f as j,ag as K}from"./vue-705b7309.js";const ae=[{title:"分类名称",dataIndex:"name",width:350,align:"left"},{title:"分类编码",dataIndex:"code"}],re=[{label:"名称",field:"name",component:"Input",colProps:{span:6}},{label:"编码",field:"code",component:"Input",colProps:{span:6}}],V=[{label:"",field:"id",component:"Input",show:!1},{label:"父级节点",field:"pid",component:"TreeSelect",componentProps:{replaceFields:{value:"key"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:()=>document.body},show:({values:e})=>e.pid!=="0",dynamicDisabled:({values:e})=>!!e.id},{label:"分类名称",field:"name",required:!0,component:"Input"}],ne="/sys/category/exportXls",le="/sys/category/importExcel",ie=e=>i.get({url:"/sys/category/rootList",params:e}),ce=(e,o)=>i.delete({url:"/sys/category/delete",params:e},{joinParamsToUrl:!0}).then(()=>{o()}),de=(e,o)=>{R.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>i.delete({url:"/sys/category/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{o()})})},q=(e,o)=>{let t=o?"/sys/category/edit":"/sys/category/add";return i.post({url:t,params:e})},G=e=>i.get({url:"/sys/category/loadTreeRoot",params:e}),pe=e=>i.get({url:"/sys/category/childList",params:e}),me=e=>i.get({url:"/sys/category/getChildListBatch",params:e},{isTransformResponse:!1}),ue=D({__name:"CategoryModal",emits:["register","success"],setup(e,{emit:o}){const t=f(!0),c=f([]),l=f([]),u=f(!1),[g,{resetFields:p,setFieldsValue:r,validate:m,updateSchema:B}]=F({schemas:V,showActionButtonGroup:!1,labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[C,{setModalProps:y,closeModal:P}]=M(s=>b(this,null,function*(){yield p(),c.value=[],y({confirmLoading:!1,minHeight:80}),t.value=!!(s!=null&&s.isUpdate),u.value=!(s!=null&&s.isUpdate)&&s.record.id,s!=null&&s.record&&(yield r(x({},s.record))),l.value=yield G({async:!1,pcode:""}),B({field:"pid",componentProps:{treeData:l}})})),k=O(()=>a(t)?"编辑字典":"新增字典");function h(s,n){if(s&&n&&n.length>0)for(let d=0;d<n.length;d++)n[d].key==s&&a(c).indexOf(s)<0?(c.value.push(n[d].key),h(n[d].parentId,a(l))):h(s,n[d].children)}function I(){return b(this,null,function*(){try{let s=yield m();y({confirmLoading:!0}),yield q(s,t.value),P(),yield h(s.pid,a(l)),o("success",{isUpdate:a(t),isSubAdd:a(u),values:x({},s),expandedArr:a(c).reverse()})}finally{y({confirmLoading:!1})}})}return(s,n)=>(A(),E(a(L),K(s.$attrs,{onRegister:a(C),destroyOnClose:"",title:k.value,onOk:I}),{default:H(()=>[j(a(S),{onRegister:a(g)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{ue as _,le as a,de as b,ae as c,me as d,pe as e,ce as f,ne as g,ie as l,re as s};
