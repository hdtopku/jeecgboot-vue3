var p=(x,b,m)=>new Promise((c,l)=>{var r=o=>{try{u(m.next(o))}catch(t){l(t)}},y=o=>{try{u(m.throw(o))}catch(t){l(t)}},u=o=>o.done?c(o.value):Promise.resolve(o.value).then(r,y);u((m=m.apply(x,b)).next())});import{d as W,e as G,l as i,w as H,n as g,V as d,a7 as w,a8 as J,f as a,aa as n,ac as h,ad as I,ae as M,W as Q,u as K,ak as U,E as f,F as X,a5 as pe,a6 as de}from"./vue-50733b77.js";import{a as Y}from"./index-52f25951.js";import{_ as Z}from"./index-7963a080.js";import ee from"./DepartDataRuleDrawer-87c07fef.js";import{c as te,e as ae,f as ne}from"./depart.api-1967d2cb.js";import{m as oe}from"./index-b34ff7bc.js";import{_ as se}from"./jeecg-online-vendor-d3e1865b.js";import"./antd-vue-vendor-c5335947.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-058e2396.js";import"./bem-e62027cc.js";import"./vxe-table-vendor-838914b0.js";import"./props-12d3a914.js";import"./useContextMenu-e6153f12.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";const le={class:"j-box-bottom-button offset-20",style:{"margin-top":"30px"}},re=W({__name:"DepartRuleTab",props:{data:{type:Object,default:()=>({})}},setup(x){const b=x,{prefixCls:m}=oe("j-depart-form-content"),c=G(()=>{var e;return(e=b.data)==null?void 0:e.id}),l=i(),r=i(!1),y=i([]),u=i([]),o=i([]),t=i([]),S=i([]),R=i(!0),[E,V]=Y();T(),H(c,()=>$(),{immediate:!0});function T(){return p(this,null,function*(){try{r.value=!0;let{treeList:e}=yield te();y.value=e,yield g(),C(!0)}finally{r.value=!1}})}function $(){return p(this,null,function*(){if(c.value)try{r.value=!0;let e=yield ae({departId:c.value});t.value=e,S.value=[...e]}finally{r.value=!1}})}function B(){return p(this,null,function*(){try{r.value=!0,yield ne({departId:c.value,permissionIds:t.value.join(","),lastpermissionIds:S.value.join(",")}),yield T(),yield $()}finally{r.value=!1}})}function L(e){Array.isArray(e)?t.value=e:t.value=e.checked}function N(e){u.value=e}function F(e,{selectedNodes:s}){var _;if((_=s[0])!=null&&_.ruleFlag){let D=e[0];V.openDrawer(!0,{departId:c,functionId:D})}o.value=[]}function ie(e){return p(this,null,function*(){R.value=e,yield g(),t.value=l.value.getCheckedKeys()})}function C(e){return p(this,null,function*(){l.value.expandAll(e),yield g(),u.value=l.value.getExpandedKeys()})}function j(e){return p(this,null,function*(){l.value.checkAll(e),yield g(),t.value=l.value.getCheckedKeys()})}return(e,s)=>{const _=d("Icon"),D=d("a-empty"),k=d("a-menu-item"),P=d("a-menu"),A=d("a-button"),q=d("a-dropdown"),z=d("a-spin");return w(),J(X,null,[a(z,{spinning:r.value},{default:n(()=>[y.value.length>0?(w(),h(K(Z),{key:0,ref_key:"basicTree",ref:l,class:"depart-rule-tree",checkable:"",treeData:y.value,checkedKeys:t.value,selectedKeys:o.value,expandedKeys:u.value,checkStrictly:R.value,style:{height:"500px",overflow:"auto"},onCheck:L,onExpand:N,onSelect:F},{title:n(({slotTitle:v,ruleFlag:O})=>[I("span",null,M(v),1),O?(w(),h(_,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):Q("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(w(),h(D,{key:1,description:"无可配置部门权限"})),I("div",le,[I("div",{class:U(["j-box-bottom-button-float",[`${K(m)}`]])},[a(q,{trigger:["click"],placement:"top"},{overlay:n(()=>[a(P,null,{default:n(()=>[a(k,{key:"3",onClick:s[0]||(s[0]=v=>j(!0))},{default:n(()=>[f("全部勾选")]),_:1}),a(k,{key:"4",onClick:s[1]||(s[1]=v=>j(!1))},{default:n(()=>[f("取消全选")]),_:1}),a(k,{key:"5",onClick:s[2]||(s[2]=v=>C(!0))},{default:n(()=>[f("展开所有")]),_:1}),a(k,{key:"6",onClick:s[3]||(s[3]=v=>C(!1))},{default:n(()=>[f("收起所有")]),_:1})]),_:1})]),default:n(()=>[a(A,{style:{float:"left"}},{default:n(()=>[f(" 树操作 "),a(_,{icon:"ant-design:up-outlined"})]),_:1})]),_:1}),a(A,{type:"primary",preIcon:"ant-design:save-filled",onClick:B},{default:n(()=>[f("保存")]),_:1})],2)])]),_:1},8,["spinning"]),a(ee,{onRegister:K(E)},null,8,["onRegister"])],64)}}});const Se=se(re,[["__scopeId","data-v-92cad6be"]]);export{Se as default};
