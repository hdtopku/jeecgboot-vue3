var we=Object.defineProperty,Ne=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var se=(e,f,s)=>f in e?we(e,f,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[f]=s,I=(e,f)=>{for(var s in f||(f={}))Ie.call(f,s)&&se(e,s,f[s]);if(ce)for(var s of ce(f))Ue.call(f,s)&&se(e,s,f[s]);return e},re=(e,f)=>Ne(e,Me(f));var ie=(e,f,s)=>new Promise((x,F)=>{var A=L=>{try{k(s.next(L))}catch(B){F(B)}},l=L=>{try{k(s.throw(L))}catch(B){F(B)}},k=L=>L.done?x(L.value):Promise.resolve(L.value).then(A,l);k((s=s.apply(e,f)).next())});import{d as Se,k as Ke,as as Pe,e as M,w as P,a5 as N,a6 as H,u as r,R as Oe,W as U,a9 as J,a7 as j,E as oe,ab as de,am as ue,f as C,F as W,a8 as He,B as je,ae as Ve,af as Xe,at as Re,q as Ye,r as he,J as $,s as V,o as $e,v as fe,A as ye,ag as ze,i as Ge}from"./vue-5a09445c.js";import{q as qe,aI as ke,Z as Je,X as Z,aJ as Ze,aC as We,aK as Qe,i as et,aL as pe}from"./jeecg-online-vendor-231813f7.js";import{d as tt,au as nt,t as Q,av as at,a7 as lt,Z as ct}from"./index-ebe32d90.js";import{createBEM as xe}from"./bem-a05115ab.js";import{buildProps as st}from"./props-1156b2b9.js";import{cz as rt,cj as it,bG as ot,cA as dt,cB as ut,c as ee,S as ht,b as ft,cC as yt,bM as ge,G as kt}from"./antd-vue-vendor-e4fda4cf.js";import{useContextMenu as pt}from"./useContextMenu-695a8028.js";import{d as gt}from"./lodash-es-vendor-3f622b6f.js";var E=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(E||{});const St=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Kt=st({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),xt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},Ct=Se({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:f}){const s=e,x=Ke(""),[F]=xe("tree-header"),A=Pe(),{t:l}=qe(),k=M(()=>["mr-1","w-full",{"ml-5":A.headerTitle||s.title}]),L=M(()=>{const{checkable:t}=s,a=[{label:l("component.tree.expandAll"),value:E.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:E.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:E.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:E.UN_SELECT_ALL,divider:t},...a,{label:l("component.tree.checkStrictly"),value:E.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:E.CHECK_UN_STRICTLY}]:a});function B(t){var c,i,d,o;const{key:a}=t;switch(a){case E.SELECT_ALL:(c=s.checkAll)==null||c.call(s,!0);break;case E.UN_SELECT_ALL:(i=s.checkAll)==null||i.call(s,!1);break;case E.EXPAND_ALL:(d=s.expandAll)==null||d.call(s,!0);break;case E.UN_EXPAND_ALL:(o=s.expandAll)==null||o.call(s,!1);break;case E.CHECK_STRICTLY:f("strictly-change",!1);break;case E.CHECK_UN_STRICTLY:f("strictly-change",!0);break}}function _(t){f("search",t)}const h=tt(_,200);return P(()=>x.value,t=>{h(t)}),P(()=>s.searchText,t=>{t!==x.value&&(x.value=t)}),(t,a)=>(N(),H("div",{class:ue([r(F)(),"flex px-2 py-1.5 items-center"])},[r(A).headerTitle?Oe(t.$slots,"headerTitle",{key:0}):U("",!0),!r(A).headerTitle&&t.title?(N(),J(r(nt),{key:1,helpMessage:t.helpMessage},{default:j(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):U("",!0),t.search||t.toolbar?(N(),H("div",xt,[t.search?(N(),H("div",{key:0,class:ue(k.value)},[C(r(rt),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:x.value,"onUpdate:value":a[0]||(a[0]=c=>x.value=c),onSearch:a[1]||(a[1]=c=>t.$emit("clickSearch",c))},null,8,["placeholder","value"])],2)):U("",!0),t.toolbar?(N(),J(r(ot),{key:1,onClick:a[2]||(a[2]=je(()=>{},["prevent"]))},{overlay:j(()=>[C(r(it),{onClick:B},{default:j(()=>[(N(!0),H(W,null,He(L.value,c=>(N(),H(W,{key:c.value},[C(r(dt),Ve(Xe({key:c.value})),{default:j(()=>[oe(de(c.label),1)]),_:2},1040),c.divider?(N(),J(r(ut),{key:0})):U("",!0)],64))),128))]),_:1})]),default:j(()=>[C(r(Q),{icon:"ion:ellipsis-vertical"})]),_:1})):U("",!0)])):U("",!0)],2))}}),Lt=({icon:e})=>e?Re(e)?Ye(Q,{icon:e,class:"mr-1"}):Q:null;function At(e,f){function s(h){const t=[],a=h||r(e),{key:c,children:i}=r(f);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];t.push(o[c]);const y=o[i];y&&y.length&&t.push(...s(y))}return t}function x(h){const t=[],a=h||r(e),{key:c,children:i}=r(f);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];o.disabled!==!0&&o.selectable!==!1&&t.push(o[c]);const y=o[i];y&&y.length&&t.push(...x(y))}return t}function F(h,t){const a=[],c=t||r(e),{key:i,children:d}=r(f);if(!d||!i)return a;for(let o=0;o<c.length;o++){const y=c[o],v=y[d];h===y[i]?(a.push(y[i]),v&&v.length&&a.push(...s(v))):v&&v.length&&a.push(...F(h,v))}return a}function A(h,t,a){if(!h)return;const c=a||r(e),{key:i,children:d}=r(f);if(!(!d||!i))for(let o=0;o<c.length;o++){const y=c[o],v=y[d];if(y[i]===h){c[o]=I(I({},c[o]),t);break}else v&&v.length&&A(h,t,y[d])}}function l(h=1,t,a=1){if(!h)return[];const c=[],i=t||r(e)||[];for(let d=0;d<i.length;d++){const o=i[d],{key:y,children:v}=r(f),z=y?o[y]:"",O=v?o[v]:[];c.push(z),O&&O.length&&a<h&&(a+=1,c.push(...l(h,O,a)))}return c}function k({parentKey:h=null,node:t,push:a="push"}){const c=ee(r(e));if(!h){c[a](t),e.value=c;return}const{key:i,children:d}=r(f);!d||!i||(ke(c,o=>{if(o[i]===h)return o[d]=o[d]||[],o[d][a](t),!0}),e.value=c)}function L({parentKey:h=null,list:t,push:a="push"}){const c=ee(r(e));if(!(!t||t.length<1))if(h){const{key:i,children:d}=r(f);if(!d||!i)return;ke(c,o=>{if(o[i]===h){o[d]=o[d]||[];for(let y=0;y<t.length;y++)o[d][a](t[y]);return e.value=c,!0}})}else for(let i=0;i<t.length;i++)c[a](t[i])}function B(h,t){if(!h)return;const a=t||r(e),{key:c,children:i}=r(f);if(!(!i||!c))for(let d=0;d<a.length;d++){const o=a[d],y=o[i];if(o[c]===h){a.splice(d,1);break}else y&&y.length&&B(h,o[i])}}function _(h,t,a){return!h&&h!==0?null:((t||r(e)).forEach(i=>{if(a!=null&&a.key||(a==null?void 0:a.key)===0)return a;if(i.key===h){a=i;return}i.children&&i.children.length&&(a=_(h,i.children,a))}),a||null)}return{deleteNodeByKey:B,insertNodeByKey:k,insertNodesByKey:L,filterByLevel:l,updateNodeByKey:A,getAllKeys:s,getChildrenKeys:F,getEnabledKeys:x,getSelectedNode:_}}function vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ge(e)}const Nt=Se({name:"BasicTree",inheritAttrs:!1,props:Kt,emits:St,setup(e,{attrs:f,slots:s,emit:x,expose:F}){const[A]=xe("tree"),l=he({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),k=he({startSearch:!1,searchText:"",searchData:[]}),L=Ke([]),[B]=pt(),_=M(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),h=M(()=>{let n=re(I(I({blockNode:!0},f),e),{expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(_),"onUpdate:expandedKeys":u=>{l.expandedKeys=u,x("update:expandedKeys",u)},"onUpdate:selectedKeys":u=>{l.selectedKeys=u,x("update:selectedKeys",u)},onCheck:(u,S)=>{let p=$(l.checkedKeys);if(Je(p)&&k.startSearch){const K=S.node.eventKey;p=gt(p,z(K)),S.checked&&p.push(K),l.checkedKeys=p}else l.checkedKeys=u;const g=$(l.checkedKeys);x("update:value",g),x("check",g,S)},onRightClick:Ae});return ht(n,"treeData","class")}),t=M(()=>k.startSearch?k.searchData:r(L)),a=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:c,insertNodeByKey:i,insertNodesByKey:d,filterByLevel:o,updateNodeByKey:y,getAllKeys:v,getChildrenKeys:z,getEnabledKeys:O,getSelectedNode:Ce}=At(L,_);function Le(n,u){return!u&&e.renderIcon&&Z(e.renderIcon)?e.renderIcon(n):u}function Ae(S){return ie(this,arguments,function*({event:n,node:u}){var m;const{rightMenuList:p=[],beforeRightClick:g}=e;let K={event:n,items:[]};if(g&&Z(g)){let T=yield g(u,n);Array.isArray(T)?K.items=T:Object.assign(K,T)}else K.items=p;(m=K.items)!=null&&m.length&&(K.items=K.items.filter(T=>!T.hidden),B(K))})}function X(n){l.expandedKeys=n}function ve(){return l.expandedKeys}function te(n){l.selectedKeys=n}function Ee(){return l.selectedKeys}function ne(n){l.checkedKeys=n}function Te(){return l.checkedKeys}function ae(n){l.checkedKeys=n?O():[]}function G(n){l.expandedKeys=n?v():[]}function be(n){l.checkStrictly=n}P(()=>e.searchValue,n=>{n!==k.searchText&&(k.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&q(k.searchText)});function q(n){if(n!==k.searchText&&(k.searchText=n),x("update:searchValue",n),!n){k.startSearch=!1;return}const{filterFn:u,checkable:S,expandOnSearch:p,checkOnSearch:g,selectedOnSearch:K}=r(e);k.startSearch=!0;const{title:m,key:T}=r(_),D=[];if(k.searchData=We(r(L),b=>{var R,Y;const w=u?u(n,b,r(_)):(Y=(R=b[m])==null?void 0:R.includes(n))!=null?Y:!1;return w&&D.push(b[T]),w},r(_)),p){const b=Qe(k.searchData).map(w=>w[T]);b&&b.length&&X(b)}g&&S&&D.length&&ne(D),K&&D.length&&te(D)}function _e(n,u){if(!(!e.clickRowToExpand||!u||u.length===0))if(!l.expandedKeys.includes(n))X([...l.expandedKeys,n]);else{const S=[...l.expandedKeys],p=S.findIndex(g=>g===n);p!==-1&&S.splice(p,1),X(S)}}V(()=>{L.value=e.treeData}),$e(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=o(n):e.defaultExpandAll&&G(!0)}),V(()=>{l.expandedKeys=e.expandedKeys}),V(()=>{l.selectedKeys=e.selectedKeys}),V(()=>{l.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{l.checkedKeys=$(e.value||[])},{immediate:!0}),P(()=>l.checkedKeys,()=>{const n=$(l.checkedKeys);x("update:value",n),x("change",n)}),V(()=>{l.checkStrictly=e.checkStrictly});const Be={setExpandedKeys:X,getExpandedKeys:ve,setSelectedKeys:te,getSelectedKeys:Ee,setCheckedKeys:ne,getCheckedKeys:Te,insertNodeByKey:i,insertNodesByKey:d,deleteNodeByKey:c,updateNodeByKey:y,getSelectedNode:Ce,checkAll:ae,expandAll:G,filterByLevel:n=>{l.expandedKeys=o(n)},setSearchValue:n=>{q(n)},getSearchValue:()=>k.searchText};function De(n){const{actionList:u}=e;if(!(!u||u.length===0))return u.map((S,p)=>{var K;let g=!0;return Z(S.show)?g=(K=S.show)==null?void 0:K.call(S,n):pe(S.show)&&(g=S.show),g?C("span",{key:p,class:A("action")},[S.render(n)]):null})}const Fe=M(()=>{const n=ee(t.value);return Ze(n,(u,S)=>{var le;const p=k.searchText,{highlight:g}=r(e),{title:K,key:m,children:T}=r(_),D=Le(u,u.icon),b=kt(u,K),w=p?b.indexOf(p):-1,R=k.startSearch&&!et(p)&&g&&w!==-1,Y=`color: ${pe(g)?"#f50":g}`,me=R?C("span",{class:(le=r(h))!=null&&le.blockNode?`${A("content")}`:""},[C("span",null,[b.substr(0,w)]),C("span",{style:Y},[p]),C("span",null,[b.substr(w+p.length)])]):b;return u[K]=C("span",{class:`${A("title")} pl-2`,onClick:_e.bind(null,u[m],u[T])},[s!=null&&s.title?ct(s,"title",u):C(W,null,[D&&C(Lt,{icon:D},null),me,C("span",{class:A("actions")},[De(u)])])]),u}),n});return F(Be),()=>{let n;const{title:u,helpMessage:S,toolbar:p,search:g,checkable:K}=e,m=u||p||g||s.headerTitle,T={height:"calc(100% - 38px)"};return C("div",{class:[A(),"h-full",f.class]},[m&&C(Ct,{checkable:K,checkAll:ae,expandAll:G,title:u,search:g,toolbar:p,helpMessage:S,onStrictlyChange:be,onSearch:q,onClickSearch:D=>x("search",D),searchText:k.searchText},vt(n=at(s))?n:{default:()=>[n]}),C(ft,{spinning:r(e.loading),tip:"加载中..."},{default:()=>[fe(C(lt,{style:T},{default:()=>[C(yt,ze(r(h),{showIcon:!1,treeData:Fe.value}),null)]}),[[ye,!r(a)]]),fe(C(ge,{image:ge.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[ye,r(a)]])]})])}}});export{Nt as _};
