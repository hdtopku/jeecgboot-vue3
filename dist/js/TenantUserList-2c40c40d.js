var ke=Object.defineProperty,Se=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var se=(t,n,o)=>n in t?ke(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,ae=(t,n)=>{for(var o in n||(n={}))ve.call(n,o)&&se(t,o,n[o]);if(oe)for(var o of oe(n))xe.call(n,o)&&se(t,o,n[o]);return t},re=(t,n)=>Se(t,Ae(n));var C=(t,n,o)=>new Promise((_,c)=>{var d=s=>{try{r(o.next(s))}catch(u){c(u)}},p=s=>{try{r(o.throw(s))}catch(u){c(u)}},r=s=>s.done?_(s.value):Promise.resolve(s.value).then(d,p);r((o=o.apply(t,n)).next())});import{d as O,e as W,V as B,a7 as g,ac as S,aa as l,f as i,E as T,ae as E,W as z,l as D,a8 as X,af as ie,ag as le,F as ce,h as j,o as Ce,u as a,ad as pe,a5 as nt,a6 as ot}from"./vue-ebecda47.js";import"./index-993283cc.js";import{M as K,d6 as Ie}from"./antd-vue-vendor-b75e8c06.js";import{bA as ue,ap as me,C as ye,_ as fe,u as Le,an as Me}from"./jeecg-online-vendor-cfb58502.js";import Ue from"./UserQuitAgentModal-17e493d5.js";import Re from"./UserQuitModal-5390085c.js";import{a as Be}from"./index-5c1c038a.js";import{useListPage as Ee}from"./useListPage-52971497.js";import"./index-e91e8b28.js";import{f as De,u as $e}from"./user.api-729c8827.js";import{u as Fe,a as Ne}from"./user.data-f8f5590c.js";import{U as Qe}from"./JSelectUser-94adcf4d.js";import{c as je}from"./UserSetting.api-9a2cb8de.js";import{g as ze}from"./tenant.api-82c12bef.js";import Oe from"./TenantUserDrawer-1ce82650.js";import{F as V,aA as Pe}from"./index-85cfc899.js";import{Q as He}from"./componentMap-c36c4b8d.js";import Ke from"./BasicTable-46b6c894.js";import"./index-be9b0972.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-cd7703c8.js";import"./vxe-table-vendor-4aae63bf.js";import"./index-a2e0ccba.js";import"./useForm-21b78d9f.js";import"./BasicModal-7e6e7ae9.js";import"./useWindowSizeFn-50bd5ea0.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./JAddInput-64f6e84f.js";import"./areaDataUtil-4a5c6609.js";import"./useFormItem-ba20c4de.js";import"./props-c57324f9.js";import"./JSelectBiz-4fc2f082.js";import"./index-1c3e0ea1.js";import"./index-097af6f9.js";import"./bem-311698ef.js";import"./props-13a58630.js";import"./useContextMenu-eb481e60.js";import"./depart.api-1888bf18.js";import"./JSelectDept-394df716.js";import"./JPopup-f9a8bda3.js";import"./JEllipsis-410bb5e8.js";import"./download-c9e5f3f7.js";import"./base64Conver-fa2fe1af.js";import"./index-96e99de8.js";import"./index-118a05d7.js";import"./useCountdown-00a25cd7.js";import"./useFormItemSingle-36e25e6f.js";import"./cron-parser-vendor-afad4b1e.js";import"./JUpload-ffe34816.js";import"./index-ae3841ab.js";import"./index-ab54dd3c.js";import"./injectionKey-69710956.js";import"./validator-fb5fa821.js";import"./renderUtils-e0ecd00e.js";import"./tenant.data-d59cff77.js";const ge={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let J=null;const Ve=()=>C(void 0,null,function*(){if(J!=null)return ue(J);{let{success:t,result:n}=yield me.get({url:ge.getEnabledType},{isTransformResponse:!1});if(t)return J=ue(n),n}return{}}),de=O({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(t,{emit:n}){const o=t,_=W(()=>o.type==="wechatEnterprise"?!1:o.syncToLocal);function c(d){n(d.key,{type:o.type})}return(d,p)=>{const r=B("a-button"),s=B("a-menu-item"),u=B("a-menu"),A=B("a-dropdown");return t.syncToApp&&t.syncToLocal?(g(),S(A,{key:0},{overlay:l(()=>[i(u,{onClick:c},{default:l(()=>[t.syncToApp?(g(),S(s,{key:"to-app"},{default:l(()=>[T("同步到"+E(t.name),1)]),_:1})):z("",!0),_.value?(g(),S(s,{key:"to-local"},{default:l(()=>[T("同步到本地")]),_:1})):z("",!0)]),_:1})]),default:l(()=>[i(r,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})]),_:1})):t.syncToApp?(g(),S(r,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:p[0]||(p[0]=I=>c({key:"to-app"}))},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})):(g(),S(r,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:p[1]||(p[1]=I=>c({key:"to-local"}))},{default:l(()=>[T("同步"+E(t.name)+"到本地",1)]),_:1}))}}}),Je=O({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(t,{emit:n}){const o=t,{createMessage:_,createWarningModal:c}=ye(),d=D({}),p=W(()=>({syncToApp:o.syncToApp,syncToLocal:o.syncToLocal})),r=W(()=>({"to-app":s,"to-local":u}));function s(m){I(m.type,"/toApp")}function u(m){I(m.type,"/toLocal")}function A(){return C(this,null,function*(){d.value=yield Ve()})}function I(m,h){let L=ge[m];if(!(L&&L[o.bizType]))return;let k=L[o.bizType]+h,v=o.selectedRowKeys,F="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(v)&&v.length>0?F=`确定要开始同步这 ${v.length} 项吗？`:v=[],new Promise((P,q)=>{const N=K.confirm({icon:i(Ie),title:"同步",content:F,onOk:()=>{N.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let H={ids:v.join(",")};return me.get({url:k,params:H},{isTransformResponse:!1}).then(y=>{let w={};y.result&&(w={width:600,title:y.message,content:()=>{let M,Q=["成功信息如下：",$(j,y.result.successInfo.map((U,R)=>`${R+1}. ${U}`).join(`
`))];return y.success?M=[...Q,j("br"),"无失败信息！"]:M=["失败信息如下：",$(j,y.result.failInfo.map((U,R)=>`${R+1}. ${U}`).join(`
`)),j("br"),...Q],M}}),y.success?(w!=null?K.success(w):_.warning(y.message),n("sync-ok")):(w!=null?K.warning(w):_.warning(y.message),n("sync-error"))}).catch(()=>N.destroy()).finally(()=>{P(),n("sync-finally",{type:m,direction:h,isToApp:h==="/toApp",isToLocal:h==="/toLocal"})})},onCancel(){P()}})})}function $(m,h){return m("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},h)}return A(),(m,h)=>t.syncToApp||t.syncToLocal?(g(),X(ce,{key:0},[d.value.wechatEnterprise?(g(),S(de,ie({key:0,type:"wechatEnterprise",name:"企微"},p.value,le(r.value)),null,16)):z("",!0),d.value.dingtalk?(g(),S(de,ie({key:1,type:"dingtalk",name:"钉钉"},p.value,le(r.value)),null,16)):z("",!0)],64)):(g(),X(ce,{key:1},[T("未设置任何同步方向")],64))}});const We=fe(Je,[["__scopeId","data-v-d8023e59"]]);const Xe={style:{"margin-left":"10px","margin-top":"5px"}},qe={class:"tenant-name"},Ge=O({name:"tenant-system-user"}),Ye=O(re(ae({},Ge),{setup(t){const{createMessage:n,createConfirm:o}=ye(),[_,{openDrawer:c}]=Be(),[d,{openModal:p}]=V(),[r,{openModal:s}]=V(),u=Le(),A=u.getUserInfo.username,{prefixCls:I,tableContext:$,onExportXls:m,onImportXls:h}=Ee({designScope:"user-list",tableProps:{title:"租户用户列表",api:De,columns:Fe,size:"small",formConfig:{schemas:Ne},actionColumn:{width:120},beforeFetch:e=>(e.userTenantStatus="1,3,4",Object.assign({column:"createTime",order:"desc"},e))}}),[L,{reload:k,updateTableDataRecord:v},{rowSelection:F,selectedRows:P,selectedRowKeys:q}]=$;function N(){c(!0,{isUpdate:!1,showFooter:!0,tenantSaas:!0})}function H(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!0,tenantSaas:!0})})}function y(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!1,tenantSaas:!0})})}function w(){k()}function M({isToLocal:e}){e&&k()}function Q(e){return[{label:"编辑",onClick:H.bind(null,e)}]}function U(e){return[{label:"详情",onClick:y.bind(null,e)},{label:"离职",onClick:R.bind(null,e.id),ifShow:()=>e.status==="1"&&e.username!==e.createBy},{label:"交接",onClick:he.bind(null,e),ifShow:()=>e.username===e.createBy},{label:"同意",onClick:G.bind(null,e.id,"1"),ifShow:()=>(e.status==="3"||e.status==="4")&&e.createBy===A},{label:"拒绝",popConfirm:{title:"是否确认拒绝",confirm:G.bind(null,e.id,"4")},ifShow:()=>e.status==="3"&&e.createBy===A}]}function R(e,f){p(!0,{userName:e,userId:f})}function G(e,f){$e({userId:e,status:f}).then(b=>{b.success&&w()}).catch(b=>{n.warning(b.message)})}const Y=D(""),Z=D([]),[Te,{openModal:_e}]=V(),ee=D("");function he(e){Y.value=Me(),Z.value=[e.id],ee.value=e.createBy,_e(!0)}function we(e,f){if(f&&f.length>0){let b=f[0];je({userId:b,tenantId:a(Y)}).then(x=>{var ne;x.success?(n.success("交接成功"),((ne=u.userInfo)==null?void 0:ne.username)==ee.value?u.logout(!0):k()):n.warning(x.message)})}}const te=D("");be();function be(){return C(this,null,function*(){te.value=yield ze()})}return Ce(()=>{Pe("租户用户")}),(e,f)=>{const b=B("a-button");return g(),X("div",null,[i(a(Ke),{onRegister:a(L),rowSelection:a(F)},{tableTitle:l(()=>[i(b,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:l(()=>[T(" 新增")]),_:1}),i(We,{"biz-type":"user","selected-row-keys":a(q),syncToApp:"",syncToLocal:"",onSyncFinally:M},null,8,["selected-row-keys"]),i(b,{type:"primary",onClick:f[0]||(f[0]=x=>a(s)(!0,{})),preIcon:"ant-design:user-delete-outlined"},{default:l(()=>[T("离职信息")]),_:1}),pe("div",Xe,[T(" 当前登录租户: "),pe("span",qe,E(te.value),1)])]),action:l(({record:x})=>[i(a(He),{actions:Q(x),dropDownActions:U(x)},null,8,["actions","dropDownActions"])]),_:1},8,["onRegister","rowSelection"]),i(Oe,{onRegister:a(_),onSuccess:w},null,8,["onRegister"]),i(Ue,{onRegister:a(d),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(Re,{onRegister:a(r),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(Qe,{onRegister:a(Te),excludeUserIdList:Z.value,maxSelectCount:1,onGetSelectResult:we},null,8,["onRegister","excludeUserIdList"])])}}}));const an=fe(Ye,[["__scopeId","data-v-c779c610"]]);export{an as default};
