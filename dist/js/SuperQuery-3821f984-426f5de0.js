import{l as R,r as ie,J as re,a3 as ye,w as ae,a5 as ge,a6 as Ce,ad as g,V as d,a7 as S,a8 as se,F as ue,ac as M,aa as o,f as a,E as f,k as be,W as ke,ak as ne,v as de,B as ce,ab as Se,ae as we}from"./vue-50733b77.js";import{B as _e}from"./index-f7d688aa.js";import{E as Oe,aI as le,F as Fe}from"./index-b34ff7bc.js";import{q as fe,aZ as Te,bB as xe}from"./jeecg-online-vendor-d3e1865b.js";import{M as Ie,cz as Me,cA as Re,d7 as De,d8 as je,d9 as Pe,bU as Ve,br as Ee}from"./antd-vue-vendor-c5335947.js";import{u as qe,F as Ne}from"./useExtendComponent-48d37d9b-605c45a2.js";import{G as Qe}from"./SuperQueryValComponent.vue_vue_type_script_lang-e3ad7ee8-7a33975c.js";import"./componentMap-5c02cfaf.js";import"./index-7e7a94e9.js";import"./lodash-es-vendor-058e2396.js";import"./index-5593b297.js";import"./user.api-c252cb60.js";import"./customExpression-62f5afd1.js";import"./index-f191817e.js";import"./useListPage-4f9607d2.js";import"./JUpload-c8630cc9.js";import"./LinkTableListPiece-34266919-7405b407.js";import"./OnlineSelectCascade-c7baf52b-e9e1ca05.js";import"./JModalTip-abe1515a-57f430d6.js";import"./BasicModal-064024e0.js";import"./useWindowSizeFn-34cbae37.js";import"./tinymce-vendor-7c917b36.js";import"./vxe-table-vendor-838914b0.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./areaDataUtil-5dfcdadb.js";import"./useForm-14ceb529.js";import"./BasicTable-ca5b2c76.js";import"./injectionKey-69710956.js";import"./JAddInput-9c2385b5.js";import"./useFormItem-915d7f1b.js";import"./JSelectUser-99e618da.js";import"./props-2079d80b.js";import"./JSelectBiz-f98b6288.js";import"./index-95220aa0.js";import"./index-7963a080.js";import"./bem-e62027cc.js";import"./props-12d3a914.js";import"./useContextMenu-e6153f12.js";import"./depart.api-1967d2cb.js";import"./JSelectDept-0fd43050.js";import"./JPopup-8bd4163b.js";import"./JEllipsis-66e02300.js";import"./index-fa22fec6.js";import"./download-49b89a1a.js";import"./base64Conver-fa2fe1af.js";import"./index-54db12ae.js";import"./index-f3acc26c.js";import"./useCountdown-9338ec9a.js";import"./useFormItemSingle-37938520.js";import"./cron-parser-vendor-19ac00ef.js";import"./index-665aeeac.js";import"./index-1ac4dcff.js";var Ae=Object.defineProperty,Be=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,me=(p,r,v)=>r in p?Ae(p,r,{enumerable:!0,configurable:!0,writable:!0,value:v}):p[r]=v,ve=(p,r)=>{for(var v in r||(r={}))Ue.call(r,v)&&me(p,v,r[v]);if(pe)for(var v of pe(r))Je.call(r,v)&&me(p,v,r[v]);return p},he=(p,r)=>Be(p,Le(r));const Ge={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},He="JSuperQuerySaved_";function We(){const{linkTableCard2Select:p}=qe(),{createMessage:r}=fe(),v=R(),e=ie({values:[]}),D=R("and"),[te,{setModalProps:A}]=Oe(()=>{A({confirmLoading:!1})}),B=Object.assign({},{link_down:"text"},Ge);function C(){}function Z(){}function $(t,l,n){n.val=l}const j=R({}),P=R([]);function m(t){let{allFields:l,treeData:n}=w(t);j.value=l,P.value=n}function L(t){let l={field:void 0,rule:"eq",val:"",key:le(16)};t===!1?(e.values=[],e.values.push(l)):t===!0?e.values.length==0&&e.values.push(l):e.values.splice(++t,0,l)}function O(t){let l=re(e.values),n=-1;for(let i=0;i<l.length;i++)if(t.key==l[i].key){n=i;break}n!=-1&&e.values.splice(n,1)}const U={field:"val",label:"测试",component:"Input"};function J(t,l){let n=j.value[t.field];if(!n)return U;B[n.view]&&(n.view=B[n.view]);let i=Ne.createFormSchema(t.field,n);i.noChange(),i.asSearchForm(),i.updateField(t.field+l);const h=k=>{t.val=k[t.field]};i.setFunctionForFieldValue(h);let c=i.getFormItemSchema();return["empty","not_empty"].includes(t.rule)&&(c.componentProps=he(ve({},c.componentProps),{disabled:!0})),p(c),c}const G=R(""),V=Te(),b=ie({visible:!1,title:"",content:"",saveCode:""}),z=R(!1),E=ye();ae(()=>E.fullPath,t=>{H()});const y=R([]);ae(()=>y.value,t=>{let l=[];t&&t.length>0&&t.map(n=>{let i=le(16);l.push({title:n.title,slots:{icon:"custom"},value:i})}),G.value=l},{immediate:!0,deep:!0});function H(){let t=He+E.fullPath;b.saveCode=t;let l=V.get(t);l&&l instanceof Array&&(y.value=l)}H();function K(){let t=F();if(!t){r.warning("空条件不能保存");return}let l=JSON.stringify(t);X(l)}function X(t){b.visible=!0,b.title="",b.content=t}function Q(){let{title:t,content:l,saveCode:n}=b,i=W(t);i>=0?Ie.confirm({title:"提示",content:`${t} 已存在，是否覆盖？`,okText:"确认",cancelText:"取消",onOk:()=>{y.value.splice(i,1,{content:l,title:t,type:D.value}),V.set(n,y.value),b.visible=!1,r.success("保存成功")}}):(y.value.push({content:l,title:t,type:D.value}),V.set(n,y.value),b.visible=!1,r.success("保存成功"))}function W(t){let l=y.value,n=-1;for(let i=0;i<l.length;i++)if(l[i].title==t){n=i;break}return n}function F(t=!1){var l;let n=e.values;if(!n||n.length==0)return!1;let i=[],h=j.value;for(let c of n){let k=["empty","not_empty"].includes(c.rule);if(c.field&&(k||c.val||c.val===0)&&c.rule){let q=h[c.field],N=(l=q==null?void 0:q.formatValue)!=null?l:_=>_,x=re(c.val);x instanceof Array?x=x.map(_=>N(_)).join(","):x=N(x);let I={field:Y(c),rule:c.rule,val:x};if(t===!0){let _=h[c.field];_&&(I.type=_.view,I.dbType=_.type)}i.push(I)}}return i.length==0?!1:i}function Y(t){let l=t.field;return l.indexOf("@")>0&&(l=l.replace("@",",")),l}function ee(t,{node:l}){let n=l.dataRef.title,i=y.value.filter(h=>h.title==n);if(i&&i.length>0){let{content:h,type:c}=i[0],k=JSON.parse(h),q=[];for(let N of k)q.push(Object.assign({},{key:le(16)},N));e.values=q,D.value=c}}function s(t){let l=W(t);l>=0&&(y.value.splice(l,1),V.set(b.saveCode,y.value))}function w(t){let l={},n=1,i=[];return t.properties&&(t=t.properties),Object.keys(t).map(h=>{let c=t[h];if(c.view=="table"){let k=c.properties||c.fields,q=n*100,N={title:c.title,value:h,disabled:!0,children:[],order:q};Object.keys(k).map(x=>{let I=k[x];I.order=q+I.order;let _=h+"@"+x;l[_]=I,N.children.push({title:I.title,value:_,isLeaf:!0,order:I.order})}),u(N),i.push(N),n++}else{let k=h;l[k]=c,i.push({title:c.title,value:k,isLeaf:!0,order:c.order})}}),u(i),{allFields:l,treeData:i}}function u(t){(t.children||t).sort(function(l,n){return l.order-n.order})}function T(t){const{params:l,matchType:n}=t;if(l){let i=[];for(let h of l)i.push(Object.assign({},{key:le(16)},h));e.values=i,n.value=n}}return{formRef:v,init:m,dynamicRowValues:e,matchType:D,registerModal:te,handleSubmit:C,handleCancel:Z,handleSave:K,doSaveQueryInfo:Q,saveInfo:b,saveTreeData:G,handleRemoveSaveInfo:s,handleTreeSelect:ee,fieldTreeData:P,addOne:L,removeOne:O,setFormModel:$,getSchema:J,loading:z,getQueryInfo:F,initDefaultValues:T}}const Ze={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1},online:{type:Boolean,default:!1}},components:{BasicModal:_e,MinusCircleOutlined:Me,PlusOutlined:Re,OnlineSuperQueryValComponent:Qe,FileTextOutlined:De,CloseCircleOutlined:je,AppstoreTwoTone:Pe,Divider:Ve},emits:["search"],setup(p,{emit:r}){const[v,e]=Fe(),{createMessage:D}=fe(),te=R(!0);function A(){e.closeModal()}function B(){if(p.online===!0){let u=Q(!0);u&&u.length>0?(r("search",u,m.value),A()):D.warning("空条件无法查询！")}else{let u=Q(!0);if(u&&u.length>0){let T=C(u);r("search",T)}else D.warning("空条件无法查询！")}}function C(u){let T=[];for(let t of u){let l=t.field,n=t.val;n instanceof Array&&(n=n.join(",")),T.push(he(ve({},t),{field:l,val:n}))}return T.length>0?F.value=!0:F.value=!1,{superQueryMatchType:m.value,superQueryParams:encodeURI(JSON.stringify(T))}}function Z(){P.values=[],E(!1);let u=C([]);r("search",u)}const{formRef:$,init:j,dynamicRowValues:P,matchType:m,registerModal:L,handleSave:O,doSaveQueryInfo:U,saveInfo:J,saveTreeData:G,handleTreeSelect:V,handleRemoveSaveInfo:b,fieldTreeData:z,addOne:E,removeOne:y,setFormModel:H,getSchema:K,loading:X,getQueryInfo:Q,initDefaultValues:W}=We(),F=R(!1);ae(()=>p.status,u=>{F.value=u},{immediate:!0});function Y(){e.openModal(),E(!0)}function ee(){return document.getElementsByClassName("jee-super-query-form")[0]}function s(u){}function w(u){u.val=""}return ae(()=>p.config,u=>{u&&j(u)},{immediate:!0}),{formRef:$,registerFormModal:v,init:j,handleChangeField:w,dynamicRowValues:P,matchType:m,historyCollapsed:te,registerModal:L,handleSubmit:B,handleCancel:A,handleSave:O,handleReset:Z,doSaveQueryInfo:U,saveInfo:J,saveTreeData:G,handleTreeSelect:V,handleRemoveSaveInfo:b,fieldTreeData:z,addOne:E,removeOne:y,setFormModel:H,getSchema:K,loading:X,onFinish:s,getPopupContainer:ee,superQueryFlag:F,handleOpen:Y,initDefaultValues:W,simpleImage:Ee.PRESENTED_IMAGE_SIMPLE}}},oe=p=>(ge("data-v-b1c9d7e2"),p=p(),Ce(),p),$e={class:"j-super-query-button"},ze=oe(()=>g("span",null,"已有高级查询条件生效",-1)),Ke=oe(()=>g("span",null,"高级查询",-1)),Xe={style:{float:"left"}},Ye={slot:"description"},et=oe(()=>g("span",null,"没有任何查询条件",-1)),tt=oe(()=>g("div",null,"保存的查询",-1)),lt=["title"],at={class:"icon-cancle"},ot={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function nt(p,r,v,e,D,te){const A=d("divider"),B=d("AppstoreTwoTone"),C=d("a-button"),Z=d("a-button-group"),$=d("a-tooltip"),j=d("a-divider"),P=d("a-empty"),m=d("a-select-option"),L=d("a-select"),O=d("a-form-item"),U=d("a-col"),J=d("a-row"),G=d("a-tree-select"),V=d("online-super-query-val-component"),b=d("PlusOutlined"),z=d("MinusCircleOutlined"),E=d("a-space"),y=d("a-form"),H=d("close-circle-outlined"),K=d("file-text-outlined"),X=d("a-tree"),Q=d("Icon"),W=d("a-card"),F=d("BasicModal"),Y=d("a-input"),ee=d("a-modal");return S(),se(ue,null,[g("div",$e,[e.superQueryFlag?(S(),M($,{key:0,mouseLeaveDelay:.2},{title:o(()=>[ze,a(A,{type:"vertical",style:{"background-color":"#fff"}}),g("a",{onClick:r[0]||(r[0]=(...s)=>e.handleReset&&e.handleReset(...s))},"清空")]),default:o(()=>[a(Z,null,{default:o(()=>[a(C,{type:"primary",onClick:e.handleOpen},{default:o(()=>[a(B,{spin:!0}),Ke]),_:1},8,["onClick"])]),_:1})]),_:1})):(S(),M(C,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:e.handleOpen},{default:o(()=>[f(" 高级查询 ")]),_:1},8,["onClick"]))]),(S(),M(be,{to:"body"},[a(F,{title:"高级查询构造器",canFullscreen:!1,width:750,onRegister:e.registerFormModal,onOk:e.handleSubmit},{footer:o(()=>[g("div",Xe,[a(C,{loading:e.loading,onClick:e.handleReset},{default:o(()=>[f("重置")]),_:1},8,["loading","onClick"]),a(C,{loading:e.loading,onClick:e.handleSave},{default:o(()=>[f("保存查询")]),_:1},8,["loading","onClick"])]),a(C,{key:"submit",type:"primary",onClick:e.handleSubmit},{default:o(()=>[f("确定")]),_:1},8,["onClick"]),a(C,{key:"back",onClick:e.handleCancel},{default:o(()=>[f("关闭")]),_:1},8,["onClick"])]),default:o(()=>[e.dynamicRowValues.values.length==0?(S(),M(P,{key:0},{default:o(()=>[g("div",Ye,[et,a(j,{type:"vertical"}),g("a",{onClick:r[1]||(r[1]=s=>e.addOne(-1))},"点击新增")])]),_:1})):ke("",!0),a(J,{class:ne("j-super-query-modal-content")},{default:o(()=>[a(U,{sm:24,md:24},{default:o(()=>[de(a(J,null,{default:o(()=>[a(U,{md:12,xs:24},{default:o(()=>[a(O,{label:"匹配模式",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:o(()=>[a(L,{value:e.matchType,"onUpdate:value":r[2]||(r[2]=s=>e.matchType=s),getPopupContainer:s=>s.parentNode,style:{width:"100%"}},{default:o(()=>[a(m,{value:"and"},{default:o(()=>[f("AND（所有条件匹配）")]),_:1}),a(m,{value:"or"},{default:o(()=>[f("OR（任意一个匹配）")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[ce,e.dynamicRowValues.values.length>0]]),de(a(y,{ref:"formRef",class:ne("jee-super-query-form"),model:e.dynamicRowValues,onFinish:e.onFinish},{default:o(()=>[(S(!0),se(ue,null,Se(e.dynamicRowValues.values,(s,w)=>(S(),M(E,{key:s.key,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:o(()=>[a(O,{name:["values",w,"field"],style:{width:"150px"}},{default:o(()=>[a(G,{style:{width:"100%"},placeholder:"请选择字段",value:s.field,"onUpdate:value":u=>s.field=u,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},onChange:u=>e.handleChangeField(s),"tree-data":e.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),a(O,{name:["values",w,"rule"],style:{width:"100px"}},{default:o(()=>[a(L,{style:{width:"100%"},placeholder:"请选择匹配规则",value:s.rule,"onUpdate:value":u=>s.rule=u},{default:o(()=>[a(m,{value:"eq"},{default:o(()=>[f("等于")]),_:1}),a(m,{value:"like"},{default:o(()=>[f("模糊")]),_:1}),a(m,{value:"right_like"},{default:o(()=>[f("以..开始")]),_:1}),a(m,{value:"left_like"},{default:o(()=>[f("以..结尾")]),_:1}),a(m,{value:"in"},{default:o(()=>[f("在...中")]),_:1}),a(m,{value:"ne"},{default:o(()=>[f("不等于")]),_:1}),a(m,{value:"gt"},{default:o(()=>[f("大于")]),_:1}),a(m,{value:"ge"},{default:o(()=>[f("大于等于")]),_:1}),a(m,{value:"lt"},{default:o(()=>[f("小于")]),_:1}),a(m,{value:"le"},{default:o(()=>[f("小于等于")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),a(O,{name:["values",w,"val"],style:{width:"300px"}},{default:o(()=>[a(V,{style:{width:"100%"},schema:e.getSchema(s,w),formModel:s,setFormModel:(u,T)=>{e.setFormModel(u,T,s)},onSubmit:e.handleSubmit},null,8,["schema","formModel","setFormModel","onSubmit"])]),_:2},1032,["name"]),a(O,null,{default:o(()=>[a(C,{onClick:u=>e.addOne(w),style:{"margin-right":"6px"}},{default:o(()=>[a(b)]),_:2},1032,["onClick"]),a(C,{onClick:u=>e.removeOne(s)},{default:o(()=>[a(z)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["model","onFinish"]),[[ce,e.dynamicRowValues.values.length>0]])]),_:1})]),_:1}),a(W,{class:ne(["j-super-query-history-card",{collapsed:e.historyCollapsed}]),bordered:!1},{title:o(()=>[tt]),default:o(()=>[e.saveTreeData.length===0?(S(),M(P,{key:0,class:"j-super-query-history-empty",image:e.simpleImage,description:"没有保存的查询"},null,8,["image"])):(S(),M(X,{key:1,class:"j-super-query-history-tree",treeData:e.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:e.handleTreeSelect},{title:o(({title:s})=>[g("div",null,[g("span",{title:s},we(s.length>10?s.substring(0,10)+"...":s),9,lt),g("span",at,[a(H,{onClick:w=>e.handleRemoveSaveInfo(s)},null,8,["onClick"])])])]),custom:o(()=>[a(K)]),_:1},8,["treeData","onSelect"])),g("div",{class:"collapse-box",onClick:r[3]||(r[3]=s=>e.historyCollapsed=!e.historyCollapsed)},[e.historyCollapsed?(S(),M(Q,{key:0,icon:"ant-design:caret-left"})):(S(),M(Q,{key:1,icon:"ant-design:caret-right"}))])]),_:1},8,["class"])]),_:1},8,["onRegister","onOk"])])),a(ee,{title:"请输入保存的名称",visible:e.saveInfo.visible,onCancel:r[5]||(r[5]=s=>e.saveInfo.visible=!1),onOk:e.doSaveQueryInfo},{default:o(()=>[g("div",ot,[a(Y,{value:e.saveInfo.title,"onUpdate:value":r[4]||(r[4]=s=>e.saveInfo.title=s),style:{width:"90%"},placeholder:"请输入保存的名称"},null,8,["value"])])]),_:1},8,["visible","onOk"])],64)}const nl=xe(Ze,[["render",nt],["__scopeId","data-v-b1c9d7e2"]]);export{nl as default};
