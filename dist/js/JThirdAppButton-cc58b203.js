var C=(e,a,n)=>new Promise((f,u)=>{var c=t=>{try{o(n.next(t))}catch(y){u(y)}},s=t=>{try{o(n.throw(t))}catch(y){u(y)}},o=t=>t.done?f(t.value):Promise.resolve(t.value).then(c,s);o((n=n.apply(e,a)).next())});import{b as D,aZ as V,u as G,C as Q}from"./jeecg-online-vendor-e26fc0e5.js";import{d as F,e as I,U as h,a5 as r,a9 as m,a7 as i,f as j,E as T,ab as A,V as _,k as X,q as w,a6 as K,ag as N,ah as O,F as P}from"./vue-705b7309.js";import{ab as S,z as Y}from"./antd-vue-vendor-cce59da1.js";const U={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let $=null;const ee=()=>C(void 0,null,function*(){if($!=null)return V($);{let{success:e,result:a}=yield D.get({url:U.getEnabledType},{isTransformResponse:!1});if(e)return $=V(a),a}return{}}),q=F({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(e,{emit:a}){const n=e,f=I(()=>n.type==="wechatEnterprise"?!1:n.syncToLocal);function u(c){a(c.key,{type:n.type})}return(c,s)=>{const o=h("a-button"),t=h("a-menu-item"),y=h("a-menu"),v=h("a-dropdown");return e.syncToApp&&e.syncToLocal?(r(),m(v,{key:0},{overlay:i(()=>[j(y,{onClick:u},{default:i(()=>[e.syncToApp?(r(),m(t,{key:"to-app"},{default:i(()=>[T("同步到"+A(e.name),1)]),_:1})):_("",!0),f.value?(r(),m(t,{key:"to-local"},{default:i(()=>[T("同步到本地")]),_:1})):_("",!0)]),_:1})]),default:i(()=>[j(o,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:i(()=>[T("同步"+A(e.name),1)]),_:1})]),_:1})):e.syncToApp?(r(),m(o,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:s[0]||(s[0]=b=>u({key:"to-app"}))},{default:i(()=>[T("同步"+A(e.name),1)]),_:1})):(r(),m(o,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:s[1]||(s[1]=b=>u({key:"to-local"}))},{default:i(()=>[T("同步"+A(e.name)+"到本地",1)]),_:1}))}}}),ne=F({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(e,{emit:a}){const n=e,{createMessage:f,createWarningModal:u}=G(),c=X({}),s=I(()=>({syncToApp:n.syncToApp,syncToLocal:n.syncToLocal})),o=I(()=>({"to-app":t,"to-local":y}));function t(l){b(l.type,"/toApp")}function y(l){b(l.type,"/toLocal")}function v(){return C(this,null,function*(){c.value=yield ee()})}function b(l,d){let x=U[l];if(!(x&&x[n.bizType]))return;let W=x[n.bizType]+d,g=n.selectedRowKeys,J="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(g)&&g.length>0?J=`确定要开始同步这 ${g.length} 项吗？`:g=[],new Promise((M,te)=>{const R=S.confirm({icon:j(Y),title:"同步",content:J,onOk:()=>{R.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let Z={ids:g.join(",")};return D.get({url:W,params:Z},{isTransformResponse:!1}).then(p=>{let k={};p.result&&(k={width:600,title:p.message,content:()=>{let E,H=["成功信息如下：",z(w,p.result.successInfo.map((L,B)=>`${B+1}. ${L}`).join(`
`))];return p.success?E=[...H,w("br"),"无失败信息！"]:E=["失败信息如下：",z(w,p.result.failInfo.map((L,B)=>`${B+1}. ${L}`).join(`
`)),w("br"),...H],E}}),p.success?(k!=null?S.success(k):f.warning(p.message),a("sync-ok")):(k!=null?S.warning(k):f.warning(p.message),a("sync-error"))}).catch(()=>R.destroy()).finally(()=>{M(),a("sync-finally",{type:l,direction:d,isToApp:d==="/toApp",isToLocal:d==="/toLocal"})})},onCancel(){M()}})})}function z(l,d){return l("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},d)}return v(),(l,d)=>e.syncToApp||e.syncToLocal?(r(),K(P,{key:0},[c.value.wechatEnterprise?(r(),m(q,N({key:0,type:"wechatEnterprise",name:"企微"},s.value,O(o.value)),null,16)):_("",!0),c.value.dingtalk?(r(),m(q,N({key:1,type:"dingtalk",name:"钉钉"},s.value,O(o.value)),null,16)):_("",!0)],64)):(r(),K(P,{key:1},[T("未设置任何同步方向")],64))}});const re=Q(ne,[["__scopeId","data-v-d8023e59"]]);export{re as J};
