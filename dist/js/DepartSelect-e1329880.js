var b=(m,N,c)=>new Promise((f,k)=>{var U=s=>{try{C(c.next(s))}catch(o){k(o)}},B=s=>{try{C(c.throw(s))}catch(o){k(o)}},C=s=>s.done?f(s.value):Promise.resolve(s.value).then(U,B);C((c=c.apply(m,N)).next())});import{B as le}from"./index-9d0047d3.js";import{g as se,h as oe}from"./depart.api-6f5abe31.js";import{o as ne}from"./tenant.api-a8627522.js";import{t as re,u as ue,D as ie}from"./jeecg-online-vendor-885afdd4.js";import{d as ce,k as u,w as fe,V as v,a5 as _,a9 as I,a7 as a,f as i,E as h,am as R,a6 as $,a8 as W,F as j,W as A,ag as G,u as e,ap as de,aq as pe,aa as K,ab as J}from"./vue-bcbaddf9.js";import"./BasicModal-5ab8e0d9.js";import"./index-4b015b65.js";import"./antd-vue-vendor-a78909e6.js";import"./tinymce-vendor-676f8393.js";import"./lodash-es-vendor-9b741fb8.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-9edfd3ae.js";import"./useWindowSizeFn-e9ba77b6.js";const O=m=>(de("data-v-9b9f3ad3"),m=m(),pe(),m),ve=O(()=>K("span",null,"您隶属于多租户，请选择当前所属租户",-1)),me=O(()=>K("span",null,"您隶属于多部门，请选择当前所在部门",-1)),_e=ce({__name:"DepartSelect",props:{title:{type:String,default:"部门选择"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(m,{expose:N}){const c=m,f=re(),{createMessage:k,notification:U}=ue(),B={labelCol:{span:4},wrapperCol:{span:18}},C={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},s=u(""),o=u(!1),w=u(""),d=u(),L=u([]),x=u(""),p=u(!1),S=u(""),g=u(""),M=u([]),D=u(""),T=u(!1);function Q(){return b(this,null,function*(){yield F(),yield X(),e(o)&&e(p)?s.value="切换租户和部门":e(o)?s.value=e(w)&&e(w).length>0?`租户切换（当前租户 :${e(w)}）`:c.title:e(p)&&(s.value=e(S)&&e(S).length>0?`部门切换（当前部门 :${e(S)}）`:c.title),(e(o)||e(p))&&(T.value=!0)})}function F(){return b(this,null,function*(){const t=yield se();if(!t.list||t.list.length==0)return;let l=t.list.filter(r=>r.orgCode==t.orgCode);M.value=t.list,g.value=l&&l.length>0?t.orgCode:"",S.value=l&&l.length>0?l[0].departName:"",p.value=!0})}function X(){return b(this,null,function*(){const t=yield ne();if(!t.list||t.list.length==0)return;let l=f.getTenant,r=t.list.filter(y=>y.id==l);w.value=r&&r.length>0?r[0].name:"",L.value=t.list,d.value=l,o.value=!0})}function Y(){return b(this,null,function*(){if(e(o)&&e(d)==null)return x.value="error",!1;if(e(p)&&!e(g))return D.value="error",!1;Z().then(()=>{e(o)&&f.setTenant(e(d)),k.success("切换成功"),window.location.reload()}).catch(t=>{}).finally(()=>{e(o)&&f.setTenant(e(d)),V()})})}function Z(){return new Promise((t,l)=>b(this,null,function*(){if(!e(p))t();else{const r=yield oe({username:f.getUserInfo.username,orgCode:e(g),loginTenantId:e(d)});if(r.userInfo){const y=r.userInfo;f.setUserInfo(y),t()}else ee(r),f.logout(),l()}}))}function ee(t){U.error({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})}function V(){te()}function te(){s.value="",o.value=!1,w.value="",d.value="",L.value=[],x.value="",p.value=!1,S.value="",g.value="",M.value=[],D.value="",T.value=!1}return fe(()=>c.username,t=>{t&&F()}),N({show:Q}),(t,l)=>{const r=v("a-avatar"),y=v("a-tooltip"),z=v("Icon"),q=v("a-select-option"),E=v("a-select"),H=v("a-form-item"),ae=v("a-form"),P=v("a-button");return _(),I(e(le),G(C,{title:s.value,visible:T.value,"onUpdate:visible":l[2]||(l[2]=n=>T.value=n),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(P,{onClick:V},{default:a(()=>[h("关闭")]),_:1}),i(P,{onClick:Y,type:"primary"},{default:a(()=>[h("确认")]),_:1})]),default:a(()=>[i(ae,G({ref:"formRef"},B,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[o.value?(_(),I(H,{key:0,"validate-status":x.value},{label:a(()=>[i(y,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(r,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[h(" 租户 ")]),_:1})]),_:1})]),default:a(()=>[i(E,{value:d.value,"onUpdate:value":l[0]||(l[0]=n=>d.value=n),placeholder:"请选择登录部门",class:R({"valid-error":x.value=="error"})},{suffixIcon:a(()=>[i(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(j,null,W(L.value,n=>(_(),I(q,{key:n.id,value:n.id},{default:a(()=>[h(J(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):A("",!0),p.value?(_(),I(H,{key:1,"validate-status":D.value},{label:a(()=>[i(y,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(r,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[h(" 部门 ")]),_:1})]),_:1})]),default:a(()=>[i(E,{value:g.value,"onUpdate:value":l[1]||(l[1]=n=>g.value=n),placeholder:"请选择登录部门",class:R({"valid-error":D.value=="error"})},{suffixIcon:a(()=>[i(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(j,null,W(M.value,n=>(_(),I(q,{key:n.orgCode,value:n.orgCode},{default:a(()=>[h(J(n.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):A("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const Be=ie(_e,[["__scopeId","data-v-9b9f3ad3"]]);export{Be as default};
