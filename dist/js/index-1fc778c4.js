var Q=Object.defineProperty,W=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var F=(l,t,i)=>t in l?Q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[t]=i,v=(l,t)=>{for(var i in t||(t={}))Z.call(t,i)&&F(l,i,t[i]);if(D)for(var i of D(t))ee.call(t,i)&&F(l,i,t[i]);return l},I=(l,t)=>W(l,Y(t));var p=(l,t,i)=>new Promise((g,x)=>{var B=c=>{try{_(i.next(c))}catch(m){x(m)}},E=c=>{try{_(i.throw(c))}catch(m){x(m)}},_=c=>c.done?g(c.value):Promise.resolve(c.value).then(B,E);_((i=i.apply(l,t)).next())});import te from"./BasicTable-04058a09.js";import{T as ne}from"./componentMap-90ab712d.js";import"./BasicTable.vue_vue_type_style_index_0_lang-3c8b8bcc.js";import"./useTable-7c8820b4.js";import{l as oe,c as ie,s as ae,g as le,a as re,_ as se,b as ue,d as ce,e as A,f as de}from"./CategoryModal.vue_vue_type_script_setup_true_lang-64ac0d24.js";import"./index-a882524d.js";import"./jeecg-online-vendor-12004772.js";import{useListPage as pe}from"./useListPage-8d85dabf.js";import{E as me}from"./index-6916e394.js";import{d as M,k as fe,U as h,aV as L,as as he,f as r,bi as u,E as y,u as a,ar as ge,V as _e}from"./vue-c7e3516e.js";import"./lodash-es-vendor-42c8d3d4.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm-030e7c21.js";import"./BasicForm.vue_vue_type_style_index_0_lang-8cb333b2.js";import"./BasicModal-b901e352.js";import"./useWindowSizeFn-581ed1a8.js";import"./useFormItem-cc50e63d.js";import"./JUpload.vue_vue_type_style_index_0_lang-5851070a.js";import"./download-fc124faf.js";import"./base64Conver-4e359726.js";import"./index-d83c9bcd.js";import"./index-6d615beb.js";import"./useCountdown-61c82faf.js";import"./JAddInput-dff0b84f.js";import"./areaDataUtil-13d415af.js";import"./useSelectBiz-f95680cd.js";import"./props-18305405.js";import"./index-3ce15f67.js";import"./bem-2be191b9.js";import"./props-c3781b9d.js";import"./useContextMenu-1b1215cd.js";import"./useTreeBiz-cda2af6e.js";import"./index-c5567c31.js";import"./depart.api-de6ffddd.js";import"./index-fcc2460e.js";import"./useForm-ae9e1cbd.js";import"./injectionKey-5da932b3.js";const Ce=M({name:"system-category"}),ut=M(I(v({},Ce),{setup(l){const t=fe([]),[i,{openModal:g}]=me(),{prefixCls:x,onExportXls:B,onImportXls:E,tableContext:_}=pe({designScope:"category-template",tableProps:{title:"\u5206\u7C7B\u5B57\u5178",api:oe,columns:ie,actionColumn:{width:180},formConfig:{schemas:ae},isTreeTable:!0},exportConfig:{name:"\u5206\u7C7B\u5B57\u5178\u5217\u8868",url:le},importConfig:{url:re}}),[c,{reload:m,collapseAll:be,updateTableDataRecord:R,findTableDataRecord:U,getDataSource:V},{rowSelection:K,selectedRowKeys:k}]=_;function N(){g(!0,{isUpdate:!1})}function j(e){return p(this,null,function*(){g(!0,{record:e,isUpdate:!0})})}function P(e){return p(this,null,function*(){yield de({id:e.id},T)})}function X(){return p(this,null,function*(){const e=k.value.filter(n=>!n.includes("loading"));yield ue({ids:e},T)})}function T(){(k.value=[])&&m()}function H(e){g(!0,{record:e,isUpdate:!1})}function O(b){return p(this,arguments,function*({isUpdate:e,isSubAdd:n,values:o,expandedArr:C}){if(e)R(o.id,o);else if(!o.pid)m();else if(n)yield S(o.pid);else{t.value=[];for(let d of a(C))yield S(d)}})}function $(e){w(e.items)&&q()}function q(){return p(this,null,function*(){if(a(t).length>0){const e=yield ce({parentIds:a(t).join(",")});if(e.success&&e.result.records.length>0){let n=e.result.records;const o=new Map;for(let d of n){let s=d.pid;if(a(t).includes(s)){let f=o.get(s);f==null&&(f=[]),f.push(d),o.set(s,f)}}let C=o,b=d=>{d&&d.forEach(s=>{a(t).includes(s.id)&&(s.children=w(C.get(s.id)),b(s.children))})};b(V())}}})}function w(e){if(e&&e.length>0)return e.map(n=>{if(n.hasChild=="1"){let o={id:n.id+"_loadChild",name:"loading...",isLoading:!0};n.children=[o]}return n})}function z(e,n){return p(this,null,function*(){if(e){if(t.value.push(n.id),n.children.length>0&&!!n.children[0].isLoading){let o=yield A({pid:n.id});o&&o.length>0?n.children=w(o):(n.children=null,n.hasChild="0")}}else{let o=t.value.indexOf(n.id);o>=0&&t.value.splice(o,1)}})}function S(e){return p(this,null,function*(){let n=U(e);t.value.includes(e)||t.value.push(e);let o=yield A({pid:e});o&&o.length>0?n.children=w(o):(n.children=null,n.hasChild="0"),R(e,n)})}function G(e){return[{label:"\u7F16\u8F91",onClick:j.bind(null,e)},{label:"\u5220\u9664",popConfirm:{title:"\u786E\u5B9A\u5220\u9664\u5417?",confirm:P.bind(null,e)}},{label:"\u6DFB\u52A0\u4E0B\u7EA7",onClick:H.bind(null,{pid:e.id})}]}return(e,n)=>{const o=h("a-button"),C=h("j-upload-button"),b=h("Icon"),d=h("a-menu-item"),s=h("a-menu"),f=h("a-dropdown");return L(),he("div",null,[r(a(te),{onRegister:a(c),rowSelection:a(K),expandedRowKeys:t.value,onExpand:z,onFetchSuccess:$},{tableTitle:u(()=>[r(o,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:u(()=>[y(" \u65B0\u589E")]),_:1}),r(o,{type:"primary",preIcon:"ant-design:export-outlined",onClick:a(B)},{default:u(()=>[y(" \u5BFC\u51FA")]),_:1},8,["onClick"]),r(C,{type:"primary",preIcon:"ant-design:import-outlined",onClick:a(E)},{default:u(()=>[y("\u5BFC\u5165")]),_:1},8,["onClick"]),a(k).length>0?(L(),ge(f,{key:0},{overlay:u(()=>[r(s,null,{default:u(()=>[r(d,{key:"1",onClick:X},{default:u(()=>[r(b,{icon:"ant-design:delete-outlined"}),y(" \u5220\u9664 ")]),_:1})]),_:1})]),default:u(()=>[r(o,null,{default:u(()=>[y("\u6279\u91CF\u64CD\u4F5C "),r(b,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):_e("",!0)]),action:u(({record:J})=>[r(a(ne),{actions:G(J)},null,8,["actions"])]),_:1},8,["onRegister","rowSelection","expandedRowKeys"]),r(se,{onRegister:a(i),onSuccess:O},null,8,["onRegister"])])}}}));export{ut as default};
