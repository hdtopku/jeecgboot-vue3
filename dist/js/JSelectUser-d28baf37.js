var q=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var P=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Y.call(t,n)&&P(e,n,t[n]);if(j)for(var n of j(t))Z.call(t,n)&&P(e,n,t[n]);return e},A=(e,t)=>Q(e,X(t));var U=(e,t,n)=>new Promise((s,u)=>{var f=c=>{try{a(n.next(c))}catch(r){u(r)}},l=c=>{try{a(n.throw(c))}catch(r){u(r)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(f,l);a((n=n.apply(e,t)).next())});import{i as ee,u as te,as as ae,A as le,af as J,D}from"./jeecg-online-vendor-f8ebd627.js";import{B as ne}from"./index-0d8c6dee.js";import{B as se,T as F,p as E,z as oe}from"./index-23d562e3.js";import{c as $,k as m,r as G,w as M,u as y,d as H,V as b,a5 as N,a6 as W,f as w,a7 as R,ag as V,aa as ie,p as k,s as ce}from"./vue-5a09445c.js";import{s as ue}from"./props-57077bfd.js";import{J as re}from"./JSelectBiz-eead536a.js";import{useRuleFormItem as de}from"./useFormItem-3b7d78e2.js";function fe(e,t){const n=$("selectOptions",m([])),s=$("selectValues",G({value:[],change:!1})),u=$("loadingEcho",m(!1)),f=m([]),l=m([]),a=m([]),c=te();let r=!0;M(s,()=>{if(s.change==!1&&!ee(s.value)){let o={};o[t.rowKey]=s.value.join(","),u.value=r,r=!1,_(o,!0).then().finally(()=>{u.value=r})}l.value=s.value},{immediate:!0});function g(o,d){return U(this,null,function*(){if(l.value=o,t.showSelected&&y(l).length!==y(d).length){let{records:v}=yield e({code:y(l).join(","),pageSize:y(l).length});a.value=v}else a.value=d})}const S={type:t.isRadioSelection?"radio":"checkbox",columnWidth:20,selectedRowKeys:l,onChange:g,preserveSelectedRowKeys:!0},I={dataIndex:"index",width:50};function _(o,d){return U(this,null,function*(){let{records:v}=yield e(o);if(f.value=v,d){let p=[];v.forEach(h=>{p.push({label:h[t.labelKey],value:h[t.rowKey]})}),n.value=p}})}function x(){return U(this,null,function*(){let{records:o}=yield e({code:s.value.join(","),pageSize:s.value.length});l.value=s.value,a.value=o})}function B(o){return U(this,null,function*(){o&&t.showSelected&&x()})}function K(o){let d=[],v=[];if(a.value.forEach(p=>{d.push({label:p[t.labelKey],value:p[t.rowKey]})}),l.value.forEach(p=>{v.push(p)}),n.value=d,t.maxSelectCount&&v.length>t.maxSelectCount)return c.createMessage.warning(`最多只能选择${t.maxSelectCount}条数据`),!1;o&&o(d,v)}function i(o){l.value=l.value.filter(d=>d!=o[t.rowKey]),a.value=a.value.filter(d=>d[t.rowKey]!==o[t.rowKey])}function C(){l.value=[],a.value=[]}return[{onSelectChange:g,getDataSource:_,visibleChange:B,selectOptions:n,selectValues:s,rowSelection:S,indexColumnProps:I,checkedKeys:l,selectRows:a,dataSource:f,getSelectResult:K,handleDeleteSelected:i,reset:C}]}const me=H({name:"UserSelectModal",components:{BasicModal:ne,BasicTable:ae(()=>le(()=>import("./BasicTable-6551da7b.js"),["js/BasicTable-6551da7b.js","js/BasicTable.vue_vue_type_style_index_0_lang-ff52d12f.js","js/vue-5a09445c.js","js/jeecg-online-vendor-f8ebd627.js","js/antd-vue-vendor-04f0af1d.js","js/tinymce-vendor-e2919cb0.js","js/vxe-table-vendor-c5aaa9d2.js","js/lodash-es-vendor-70833b4a.js","assets/jeecg-online-vendor-cee2ba5d.css","js/index-23d562e3.js","js/codemirror-vendor-f458506d.js","js/echarts-vendor-6c8e2159.js","assets/index-fe1627ce.css","js/BasicForm-ac34d48e.js","js/componentMap-ba94d61e.js","js/useFormItem-3b7d78e2.js","js/index-0d8c6dee.js","js/BasicModal-984237cb.js","js/useWindowSizeFn-123149fd.js","assets/BasicModal-1e1b2ed9.css","assets/index-361bf2db.css","js/download-a7e2eae4.js","js/base64Conver-fa2fe1af.js","js/index-c70b6345.js","assets/index-399aa0e3.css","js/index-94b582d6.js","js/useCountdown-577483f4.js","js/useFormItemSingle-55ffe2e1.js","assets/index-15cc10f8.css","js/JAddInput-ff8a2196.js","js/areaDataUtil-1a45154e.js","js/props-57077bfd.js","js/JSelectBiz-eead536a.js","assets/JSelectBiz-ba37f0a8.css","js/index-56ed0801.js","js/index-5ea00b35.js","js/bem-5ff749b6.js","js/props-17f0c5eb.js","js/useContextMenu-d4796678.js","assets/useContextMenu-6fcaad79.css","assets/index-a95e0833.css","js/depart.api-ee845ad8.js","assets/JAddInput-4d25ca38.css","js/JSelectDept-6a5d3f49.js","assets/JSelectDept-2ce3f5d2.css","js/JPopup-03bf28d5.js","assets/JPopup-00750b3f.css","js/cron-parser-vendor-c9873295.js","js/JEllipsis.vue_vue_type_script_setup_true_lang-eaa23dad.js","js/JUpload.vue_vue_type_style_index_0_lang-53f5b66c.js","assets/JUpload-b67dde08.css","assets/index-0a01c8ed.css","js/index-7c5ea69b.js","js/index-d11886bb.js","assets/index-d42612fa.css","assets/componentMap-11d05ddc.css","js/BasicForm.vue_vue_type_style_index_0_lang-492c189b.js","assets/BasicForm-9101c3b7.css","js/useForm-a39fb19e.js","js/injectionKey-69710956.js","assets/BasicTable-0e5f0b32.css"]),{loading:!0})},props:A(T({},ue),{modalTitle:{type:String,default:"选择用户"},excludeUserIdList:{type:Array,default:[]}}),emits:["register","getSelectResult"],setup(e,{emit:t,refs:n}){const s=m({x:!1}),u=m(),[f,{closeModal:l}]=se(()=>{window.innerWidth<900?s.value={x:900}:s.value={x:!1},setTimeout(()=>{u.value&&u.value.setSelectedRowKeys(I.value||[])},800)}),a=J(),c={canResize:!1,bordered:!0,size:"small"},r=Object.assign({},y(e),y(a),c),[{rowSelection:g,visibleChange:S,selectValues:I,indexColumnProps:_,getSelectResult:x,handleDeleteSelected:B,selectRows:K}]=fe(F,r),i=m(e.params);M(g.selectedRowKeys,h=>{u.value&&u.value.setSelectedRowKeys(h)});const C={baseColProps:{xs:24,sm:8,md:6,lg:8,xl:6,xxl:6},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8},schemas:[{label:"账号",field:"username",component:"JInput"},{label:"姓名",field:"realname",component:"JInput"}]},o=[{title:"用户账号",dataIndex:"username",width:120,align:"left"},{title:"用户姓名",dataIndex:"realname",width:120},{title:"性别",dataIndex:"sex_dictText",width:50},{title:"手机号码",dataIndex:"phone",width:120},{title:"邮箱",dataIndex:"email"},{title:"状态",dataIndex:"status_dictText",width:80}],d={pagination:!1,showIndexColumn:!1,scroll:{y:390},size:"small",canResize:!1,bordered:!0,rowKey:"id",columns:[{title:"用户姓名",dataIndex:"realname",width:40},{title:"操作",dataIndex:"action",align:"center",width:40,slots:{customRender:"action"}}]};function v(){x((h,O)=>{t("getSelectResult",h,O),l()})}function p(h){let O=e.excludeUserIdList;if(!O)return h;let z=[];if(O.length>0&&h&&h.length>0){for(let L of h)O.indexOf(L.id)<0&&z.push(T({},L));return z}return h}return{handleOk:v,searchInfo:i,register:f,indexColumnProps:_,visibleChange:S,getBindValue:r,getUserList:F,formConfig:C,columns:o,rowSelection:g,selectRows:K,selectedTable:d,handleDeleteSelected:B,tableScroll:s,tableRef:u,afterFetch:p}}}),he=["onClick"];function ge(e,t,n,s,u,f){const l=b("BasicTable"),a=b("a-col"),c=b("Icon"),r=b("a-row"),g=b("BasicModal");return N(),W("div",null,[w(g,V(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:e.showSelected?"1200px":"900px",wrapClassName:"j-user-select-modal",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{default:R(()=>[w(r,null,{default:R(()=>[w(a,{span:e.showSelected?18:24},{default:R(()=>[w(l,V({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getUserList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps,afterFetch:e.afterFetch}),{tableTitle:R(()=>[]),_:1},16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps","afterFetch"])]),_:1},8,["span"]),w(a,{span:e.showSelected?6:0},{default:R(()=>[w(l,V(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:R(({record:S})=>[ie("a",{href:"javascript:void(0)",onClick:I=>e.handleDeleteSelected(S)},[w(c,{icon:"ant-design:delete-outlined"})],8,he)]),_:1},16,["dataSource"])]),_:1},8,["span"])]),_:1})]),_:1},16,["onRegister","title","width","onOk","onVisibleChange"])])}const ve=D(me,[["render",ge]]),pe=H({name:"JSelectUser",components:{UserSelectModal:ve,JSelectBiz:re},inheritAttrs:!1,props:{value:E.oneOfType([E.string,E.array]),labelKey:{type:String,default:"realname"},rowKey:{type:String,default:"username"},params:{type:Object,default:()=>{}},excludeUserIdList:{type:Array,default:()=>[]}},emits:["options-change","change","update:value"],setup(e,{emit:t}){const n=m(),[s,{openModal:u}]=oe(),[f]=de(e,"value","change",n),l=m([]);let a=G({value:[],change:!1});const c=m(!1);k("selectOptions",l),k("selectValues",a),k("loadingEcho",c);const r=m(!1),g=J();ce(()=>{e.value&&_(),e.value||(a.value=[])}),M(a,()=>{a&&(f.value=a.value)});const S=m([]);M(()=>e.excludeUserIdList,i=>{S.value=i},{immediate:!0});function I(){r.value=!0,u(!0,{isUpdate:!1})}function _(){let i=e.value?e.value:[];i&&typeof i=="string"&&i!="null"&&i!="undefined"?(f.value=i.split(","),a.value=i.split(",")):a.value=i}function x(i,C){l.value=i,f.value=C,a.value=C,t("update:value",C.join(","))}const B=Object.assign({},y(e),y(g));function K(i){t("update:value",i)}return{state:f,attrs:g,selectOptions:l,getBindValue:B,selectValues:a,loadingEcho:c,tag:r,regModal:s,setValue:x,handleOpen:I,excludeUserIdList:S,handleChange:K}}});function we(e,t,n,s,u,f){const l=b("JSelectBiz"),a=b("UserSelectModal");return N(),W("div",null,[w(l,V({onChange:e.handleChange,onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs),null,16,["onChange","onHandleOpen","loading"]),w(a,V({rowKey:e.rowKey,onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{excludeUserIdList:e.excludeUserIdList}),null,16,["rowKey","onRegister","onGetSelectResult","excludeUserIdList"])])}const Be=D(pe,[["render",we],["__scopeId","data-v-00f5e96f"]]);export{ve as U,Be as n,fe as u};
