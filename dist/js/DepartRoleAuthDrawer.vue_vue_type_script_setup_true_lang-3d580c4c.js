var E=(h,a,l)=>new Promise((i,r)=>{var s=t=>{try{u(l.next(t))}catch(d){r(d)}},c=t=>{try{u(l.throw(t))}catch(d){r(d)}},u=t=>t.done?i(t.value):Promise.resolve(t.value).then(s,c);u((l=l.apply(h,a)).next())});import{_ as P}from"./index-3ce15f67.js";import{u as A,a as O,B as U}from"./index-1b5a8dbb.js";import"./jeecg-online-vendor-12004772.js";import{_ as z}from"./DepartRoleDataRuleDrawer.vue_vue_type_script_setup_true_lang-37c05e1d.js";import{a as G,b as H,c as J}from"./depart.user.api-2013af88.js";import{d as M,k as o,U as f,aV as m,as as Q,f as y,bi as p,E as W,at as R,ar as w,u as D,ag as X,V as Y,F as Z}from"./vue-c7e3516e.js";const ue=M({__name:"DepartRoleAuthDrawer",emits:["register"],setup(h){const a=o(!1),l=o(""),i=o(""),r=o([]),s=o([]),c=o([]),u=o([]),t=o([]),d=o([]),I=o(!0),[x,{closeDrawer:C}]=A(e=>{i.value=e.record.id,l.value=e.record.departId,F()}),[B,b]=O();function F(){return E(this,null,function*(){try{a.value=!0;const{ids:e,treeList:n}=yield G({departId:l.value});e.length>0?(d.value=e,u.value=e,r.value=n,s.value=yield H({roleId:i.value}),c.value=[s.value]):_()}finally{a.value=!1}})}function _(){r.value=[],u.value=[],s.value=[],c.value=[],a.value=!1}function S(e){I.value?s.value=e.checked:s.value=e}function V(e){u.value=e}function T(e,{selectedNodes:n}){var v;if((v=n[0])!=null&&v.ruleFlag){let g=e[0];b.openDrawer(!0,{roleId:i,departId:l,functionId:g})}t.value=[]}function N(){_(),C()}function $(){_()}function K(e){return E(this,null,function*(){try{a.value=!0;let n={roleId:i.value,permissionIds:s.value.join(","),lastpermissionIds:c.value.join(",")};yield J(n),e&&N()}finally{a.value=!1,e||F()}})}return(e,n)=>{const v=f("Icon"),g=f("a-empty"),j=f("a-spin"),q=f("a-button");return m(),Q(Z,null,[y(D(U),{title:"\u90E8\u95E8\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:650,loading:a.value,showFooter:"",okText:"\u4FDD\u5B58\u5E76\u5173\u95ED",onOk:n[1]||(n[1]=k=>K(!0)),onClose:$,onRegister:D(x)},{centerFooter:p(()=>[y(q,{type:"primary",loading:a.value,ghost:"",onClick:n[0]||(n[0]=k=>K(!1))},{default:p(()=>[W("\u4EC5\u4FDD\u5B58")]),_:1},8,["loading"])]),default:p(()=>[R("div",null,[y(j,{spinning:a.value},{default:p(()=>[r.value.length>0?(m(),w(D(P),{key:0,title:"\u6240\u62E5\u6709\u7684\u90E8\u95E8\u6743\u9650",toolbar:"",checkable:"",treeData:r.value,checkedKeys:s.value,selectedKeys:t.value,expandedKeys:u.value,checkStrictly:I.value,clickRowToExpand:!1,onCheck:S,onExpand:V,onSelect:T},{title:p(({slotTitle:k,ruleFlag:L})=>[R("span",null,X(k),1),L?(m(),w(v,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):Y("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(m(),w(g,{key:1,description:"\u65E0\u53EF\u914D\u7F6E\u90E8\u95E8\u6743\u9650"}))]),_:1},8,["spinning"])])]),_:1},8,["loading","onRegister"]),y(z,{onRegister:D(B)},null,8,["onRegister"])],64)}}});export{ue as _};
