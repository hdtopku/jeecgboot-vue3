var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var k=(o,n,t)=>n in o?Y(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t,x=(o,n)=>{for(var t in n||(n={}))te.call(n,t)&&k(o,t,n[t]);if(C)for(var t of C(n))ne.call(n,t)&&k(o,t,n[t]);return o},R=(o,n)=>Z(o,ee(n));var w=(o,n,t)=>new Promise((m,f)=>{var _=c=>{try{i(t.next(c))}catch(u){f(u)}},g=c=>{try{i(t.throw(c))}catch(u){f(u)}},i=c=>c.done?m(c.value):Promise.resolve(c.value).then(_,g);i((t=t.apply(o,n)).next())});import oe from"./BasicTable-862478b3.js";import{Q as ae}from"./componentMap-e7638604.js";import"./useTable-cb85a52b.js";import"./index-9793b37c.js";import{a as S}from"./index-55e39394.js";import{useListPage as re}from"./useListPage-f9433ee2.js";import{_ as se}from"./UserDrawer.vue_vue_type_script_setup_true_lang-22f0a0cc.js";import{U as le}from"./JSelectUser-7d43c9a7.js";import{_ as ie}from"./DepartRoleUserAuthDrawer.vue_vue_type_script_setup_true_lang-0de1bc13.js";import{l as ce,m as ue,u as pe}from"./depart.user.api-bf08e91f.js";import{c as de,e as me}from"./depart.user.data-029bdddb.js";import{z as fe}from"./index-a9a5a3b3.js";import{d as _e,c as we,e as ge,w as be,V as d,a5 as v,a6 as De,f as a,a7 as s,E as I,u as l,a9 as ye,W as he,F as Ue,aa as A}from"./vue-bcbaddf9.js";const Ce=A("span",null,"取消关联",-1),ke=A("span",null,"批量操作 ",-1),Ke=_e({__name:"DepartUserInfoTab",props:{data:{require:!0,type:Object}},setup(o){const n=o;we("prefixCls");const t=ge(()=>{var e;return(e=n.data)==null?void 0:e.id}),m={xs:24,sm:24,md:24,lg:12,xl:12,xxl:8},{tableContext:f,createMessage:_}=re({tableProps:{api:ce,columns:de,canResize:!1,formConfig:{schemas:me,baseColProps:m,labelAlign:"left",labelCol:{xs:24,sm:24,md:24,lg:9,xl:7,xxl:5},wrapperCol:{},actionColOptions:R(x({},m),{style:{textAlign:"left"}})},beforeFetch(e){e.depId=t.value}}}),[g,{reload:i,setProps:c,setLoading:u,updateTableDataRecord:B},{rowSelection:P,selectedRowKeys:b}]=f;be(()=>n.data,()=>i());const[M,{openDrawer:D,setDrawerProps:xe}]=S(),[T,F]=S(),[V,j]=fe();function N(){b.value=[]}function O(e){F.openDrawer(!0,{userId:e.id,departId:t})}function K(){var e,r;t.value?D(!0,{isUpdate:!1,departDisabled:!0,nextDepartOptions:{value:(e=n.data)==null?void 0:e.key,label:(r=n.data)==null?void 0:r.title},record:{activitiSync:1,userIdentity:1,selecteddeparts:t.value}}):_.warning("请先选择一个部门")}function z(e){D(!0,{record:e,isUpdate:!0,departDisabled:!0,showFooter:!1})}function E(e){D(!0,{isUpdate:!0,record:e,departDisabled:!0})}function L(){j.openModal()}function y(e,r){return w(this,null,function*(){if(!t.value)_.warning("请先选择一个部门");else{u(!0);let p=l(e).join(",");try{return yield pe({depId:t.value,userIds:p},r),i()}finally{u(!1)}}return Promise.reject()})}function $(){return w(this,null,function*(){try{yield y(b,!0),N()}catch(e){}})}function q(e,r){return w(this,null,function*(){if(r.length>0)try{u(!0),yield ue(t.value,r),i()}finally{u(!1)}})}function G({isUpdate:e,values:r}){e?B(r.id,r):i()}function Q(e){return[{label:"编辑",onClick:E.bind(null,e)}]}function W(e){return[{label:"部门角色",onClick:O.bind(null,e)},{label:"用户详情",onClick:z.bind(null,e)},{label:"取消关联",color:"error",popConfirm:{title:"确认取消关联吗？",confirm:y.bind(null,[e.id],!1)}}]}return(e,r)=>{const p=d("a-button"),h=d("icon"),H=d("a-menu-item"),J=d("a-menu"),X=d("a-dropdown");return v(),De(Ue,null,[a(l(oe),{onRegister:l(g),rowSelection:l(P)},{tableTitle:s(()=>[a(p,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:L},{default:s(()=>[I("添加已有用户")]),_:1}),a(p,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:K},{default:s(()=>[I("新建用户")]),_:1}),l(b).length>0?(v(),ye(X,{key:0},{overlay:s(()=>[a(J,null,{default:s(()=>[a(H,{key:"1",onClick:$},{default:s(()=>[a(h,{icon:"bx:bx-unlink"}),Ce]),_:1})]),_:1})]),default:s(()=>[a(p,null,{default:s(()=>[ke,a(h,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):he("",!0)]),action:s(({record:U})=>[a(l(ae),{actions:Q(U),dropDownActions:W(U)},null,8,["actions","dropDownActions"])]),_:1},8,["onRegister","rowSelection"]),a(se,{onRegister:l(M),onSuccess:G},null,8,["onRegister"]),a(ie,{onRegister:l(T)},null,8,["onRegister"]),a(le,{rowKey:"id",onRegister:l(V),onGetSelectResult:q},null,8,["onRegister"])],64)}}});export{Ke as _};
