var M=Object.defineProperty,B=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var y=(r,a,t)=>a in r?M(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,k=(r,a)=>{for(var t in a||(a={}))q.call(a,t)&&y(r,t,a[t]);if(I)for(var t of I(a))L.call(a,t)&&y(r,t,a[t]);return r},x=(r,a)=>B(r,$(a));var g=(r,a,t)=>new Promise((f,c)=>{var l=n=>{try{s(t.next(n))}catch(o){c(o)}},p=n=>{try{s(t.throw(n))}catch(o){c(o)}},s=n=>n.done?f(n.value):Promise.resolve(n.value).then(l,p);s((t=t.apply(r,a)).next())});import{l as w,d as C,a4 as S,a3 as V,w as P,V as A,a7 as F,a8 as N,f as W,u as R}from"./vue-50733b77.js";import{q as j}from"./page.api-56e567b9.js";import{ar as G,F as b}from"./index-b34ff7bc.js";import"./index-f7d688aa.js";import{u as H,ao as J,aQ as Q,_ as K}from"./jeecg-online-vendor-d3e1865b.js";import X from"./html2canvas-vendor-47cc7ff0.js";import"./antd-vue-vendor-c5335947.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-058e2396.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./vxe-table-vendor-838914b0.js";import"./BasicModal-064024e0.js";import"./useWindowSizeFn-34cbae37.js";function Y(){const r=w();function a(c){let l=r.value;if(!l)return;const p={width:l.offsetWidth,height:l.offsetHeight};X(l,{useCORS:!0,logging:!0}).then(s=>g(this,null,function*(){const n=s.toDataURL("image/png");yield t(n,p,c)}))}function t(c,l,p){return g(this,null,function*(){const s=yield f(c,l),n=document.createElement("a");n.href=s,n.download=`${p}.png`,n.click()})}function f(c,l){return new Promise(p=>{let s=document.createElement("canvas");const n=s.getContext("2d"),o=new Image;o.crossOrigin="Anonymous",o.src=c,o.onload=()=>{s.height=l.height,s.width=l.width,n.drawImage(o,0,0,l.width,l.height);const v=s.toDataURL("image/png");s=null,p(v)}})}return{exportRef:r,onExportImage:a}}const Z=C({name:"drag-page-view"}),z=C(x(k({},Z),{props:{routeInfo:{type:Object,default:()=>{}}},emits:["loadOk"],setup(r,{emit:a}){const t=r,{setTitle:f}=G(),c=H(),l=w(""),{currentRoute:p,push:s,resolve:n}=S(),o=w({name:"",coverUrl:"",backgroundColor:"",theme:"default",style:"default",designType:100,backgroundImage:"",componentData:[]});function v(){return g(this,null,function*(){const{params:e,path:u}=R(p);let d=e.id?e.id:u.substr(u.lastIndexOf("/")+1);l.value=d;const i=yield j({id:d});if(i.success){yield f(i.result.name);let m=i.result.template?JSON.parse(i.result.template):[];o.value.componentData=m,o.value.name=i.result.name,o.value.coverUrl=i.result.coverUrl,o.value.backgroundColor=i.result.backgroundColor,o.value.backgroundImage=i.result.backgroundImage,o.value.designType=i.result.designType,o.value.theme=i.result.theme||"default",o.value.style=i.result.style||"default"}})}function U(e,u){e&&e.indexOf("http")>-1?Q(e):s({path:e,query:u})}const[ee,{openModal:te}]=b(),[oe,{openModal:D}]=b(),h=V();function _(e,u){if(u.openMode==="2"){let d=n(e);window.open(d.href,"_blank")}else s(e)}function E(e){let u=e.operationType;if(u=="1"){let d={mode:"add",desformCode:e.worksheet.value,dataId:null,isOnline:!1,viewId:"",lowAppId:h.params.appId};D(!0,d)}else if(u=="2"){let d=h.params.appId,i=e.worksheet.value,m={path:`/myapp/${d}/desform/${i}`};e.view&&(m.query={view:e.view}),_(m,e)}else if(u=="3"){let d=h.params.appId,i=e.customPage.value,m={path:`/myapp/${d}/drag/${i}`};_(m,e)}else u=="4"}const{exportRef:O,onExportImage:T}=Y();return P(()=>t.routeInfo,e=>{if(e&&e.exportImage){let u=o.value.name;T(u)}},{deep:!0,immediate:!0}),v(),(e,u)=>{const d=A("ViewEngine");return F(),N("div",{ref_key:"exportRef",ref:O},[W(d,{dragData:o.value,token:R(J)(),onGo:U,onBtnClick:E},null,8,["dragData","token"])],512)}}}));const we=K(z,[["__scopeId","data-v-9cdbf309"]]);export{we as default};
