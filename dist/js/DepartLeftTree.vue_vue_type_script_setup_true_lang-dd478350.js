var p=(S,x,r)=>new Promise((A,k)=>{var B=l=>{try{o(r.next(l))}catch(i){k(i)}},d=l=>{try{o(r.throw(l))}catch(i){k(i)}},o=l=>l.done?A(l.value):Promise.resolve(l.value).then(B,d);o((r=r.apply(S,x)).next())});import"./index-8cf3aabb.js";import{l as me,aK as ve}from"./jeecg-online-vendor-bf2efbcb.js";import{q,A as P,d as he}from"./depart.api-25dc3d39.js";import{s as ke}from"./depart.user.api-fc1a836a.js";import{_ as ge}from"./DepartFormModal.vue_vue_type_script_setup_true_lang-21294cdc.js";import{E as Ee}from"./index-fde9c72f.js";import{d as Ce,c as De,k as c,U as s,aV as f,ar as D,bi as a,at as _,f as n,E as y,V as W,as as K,F as z,ag as G,u as I,n as H}from"./vue-c7e3516e.js";import{ck as xe}from"./antd-vue-vendor-1561c1ba.js";const Ae={class:"j-table-operator",style:{width:"100%"}},Be=_("span",null,"\u5220\u9664",-1),Fe=_("span",null,"\u6279\u91CF\u64CD\u4F5C ",-1),we={key:1},Te=_("span",{style:{color:"red"}},"\u5220\u9664",-1),Le=Ce({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(S,{expose:x,emit:r}){De("prefixCls");const{createMessage:A}=me(),{handleImportXls:k,handleExportXls:B}=ve(),d=c(!1),o=c([]),l=c([]),i=c([]),h=c([]),F=c(!1),J=c(!0),w=c(null),T=c(null),O=c(""),[Q,{openModal:R}]=Ee();function m(){return p(this,null,function*(){try{d.value=!0,o.value=[];const e=yield q();if(Array.isArray(e)&&(o.value=e),i.value.length===0)U();else if(h.value.length===0){let t=o.value[0];t&&g(t.id,t)}else r("select",w.value);r("rootTreeData",o.value)}finally{d.value=!1}})}m();function Y(e){return p(this,null,function*(){try{const t=yield q({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,i.value.length>0){let u=[];for(let E of i.value)t.findIndex(C=>C.id===E)!==-1&&u.push(E);u.length>0&&(i.value=[...i.value])}o.value=[...o.value],r("rootTreeData",o.value)}catch(t){}return Promise.resolve()})}function U(){let e=o.value[0];e?(e.isLeaf||(i.value=[e.key]),g(e.id,e),Z()):r("select",null)}function Z(){return p(this,null,function*(){yield H(),F.value=!0,yield H(),F.value=!1})}function g(e,t){h.value=[e],t&&(w.value=t,r("select",t))}function ee(){R(!0,{isUpdate:!1,isChild:!1})}function V(e=w.value){if(e==null){A.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};R(!0,{isUpdate:!1,isChild:!0,record:t})}function te(e){return p(this,null,function*(){if(e)try{d.value=!0,o.value=[];let t=yield ke({keyWord:e});Array.isArray(t)&&(o.value=t),U()}finally{d.value=!1}else m();O.value=e})}function ae(e){Array.isArray(e)?l.value=e:l.value=e.checked}function ne(e,t){e.length>0&&h.value[0]!==e[0]?g(e[0],t.selectedNodes[0]):g(h.value[0])}function M(e,t=!0){return p(this,null,function*(){const u=I(e);if(u.length>0)try{d.value=!0,yield he({ids:u.join(",")},t),yield m()}finally{d.value=!1}})}function oe(e){return p(this,null,function*(){e&&($(!1),M([e.id],!1))})}function le(){return p(this,null,function*(){try{yield M(l),l.value=[]}finally{}})}function $(e){e||(T.value=null)}function ue(e){k(e,P.importExcelUrl,()=>{m()})}function se(){B("\u90E8\u95E8\u4FE1\u606F",P.exportXlsUrl)}return x({loadRootTreeData:m}),(e,t)=>{const u=s("a-button"),E=s("a-upload"),C=s("icon"),b=s("a-menu-item"),L=s("a-menu"),X=s("a-dropdown"),ie=s("a-divider"),re=s("a-alert"),ce=s("a-input-search"),de=s("a-tree"),pe=s("a-empty"),fe=s("a-spin"),ye=s("a-card");return f(),D(ye,{bordered:!1,style:{height:"100%"}},{default:a(()=>[_("div",Ae,[n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:ee},{default:a(()=>[y("\u65B0\u589E")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>V())},{default:a(()=>[y("\u6DFB\u52A0\u4E0B\u7EA7")]),_:1}),n(E,{name:"file",showUploadList:!1,customRequest:ue},{default:a(()=>[n(u,{type:"primary",preIcon:"ant-design:import-outlined"},{default:a(()=>[y("\u5BFC\u5165")]),_:1})]),_:1}),n(u,{type:"primary",preIcon:"ant-design:export-outlined",onClick:se},{default:a(()=>[y("\u5BFC\u51FA")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("\u540C\u6B65\u4F01\u5FAE?")]),_:1}),n(u,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:a(()=>[y("\u540C\u6B65\u9489\u9489?")]),_:1}),l.value.length>0?(f(),D(X,{key:0},{overlay:a(()=>[n(L,null,{default:a(()=>[n(b,{key:"1",onClick:le},{default:a(()=>[n(C,{icon:"ant-design:delete-outlined"}),Be]),_:1})]),_:1})]),default:a(()=>[n(u,null,{default:a(()=>[Fe,n(C,{icon:"akar-icons:chevron-down"})]),_:1})]),_:1})):W("",!0)]),n(re,{type:"info","show-icon":"",class:"alert",style:{"margin-bottom":"8px"}},{message:a(()=>[l.value.length>0?(f(),K(z,{key:0},[_("span",null,"\u5DF2\u9009\u4E2D "+G(l.value.length)+" \u6761\u8BB0\u5F55",1),n(ie,{type:"vertical"}),_("a",{onClick:t[1]||(t[1]=v=>l.value=[])},"\u6E05\u7A7A")],64)):(f(),K("span",we,"\u672A\u9009\u4E2D\u4EFB\u4F55\u6570\u636E"))]),_:1}),n(fe,{spinning:d.value},{default:a(()=>[n(ce,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:te}),o.value.length>0?(f(),K(z,{key:0},[F.value?W("",!0):(f(),D(de,{key:0,checkable:"",clickRowToExpand:!1,treeData:o.value,selectedKeys:h.value,checkStrictly:J.value,"load-data":Y,checkedKeys:l.value,expandedKeys:i.value,"onUpdate:expandedKeys":t[3]||(t[3]=v=>i.value=v),onCheck:ae,onSelect:ne},{title:a(({key:v,title:_e,dataRef:N})=>[n(X,{trigger:["contextmenu"]},{overlay:a(()=>[n(L,{onClick:t[2]||(t[2]=()=>{})},{default:a(()=>[n(b,{key:"1",onClick:j=>V(N)},{default:a(()=>[y("\u6DFB\u52A0\u5B50\u7EA7")]),_:2},1032,["onClick"]),n(b,{key:"2",onClick:j=>T.value=v},{default:a(()=>[Te]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(I(xe),{visible:T.value===v,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:j=>oe(N),onVisibleChange:$},{default:a(()=>[_("span",null,G(_e),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(f(),D(pe,{key:1,description:"\u6682\u65E0\u6570\u636E"}))]),_:1},8,["spinning"]),n(ge,{rootTreeData:o.value,onRegister:I(Q),onSuccess:m},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{Le as _};
