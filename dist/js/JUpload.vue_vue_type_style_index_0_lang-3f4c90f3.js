var de=Object.defineProperty;var J=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var H=(a,u,c)=>u in a?de(a,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[u]=c,Q=(a,u)=>{for(var c in u||(u={}))me.call(u,c)&&H(a,c,u[c]);if(J)for(var c of J(u))fe.call(u,c)&&H(a,c,u[c]);return a};import{d as V,e as C,r as ie,k as B,s as ge,f as r,u as g,E as pe,m as ve,aV as N,as as R,v as K,A as Z,at as y,F as re,w as ee,U as te,bi as ne,ag as ae,V as se,ar as he,aQ as we,ad as be,n as _e,S as xe}from"./vue-c7e3516e.js";import{p as v,l as ue,I as O,O as Ce,g as j}from"./index-fde9c72f.js";import{i as Le,ba as ye,l as ce,ab as Ie,ac as Fe}from"./jeecg-online-vendor-bf2efbcb.js";import{d7 as oe,m as Ae,P as Se,W as ke}from"./antd-vue-vendor-1561c1ba.js";V({name:"ImagePreview",components:{Image:oe,PreviewGroup:oe.PreviewGroup},props:{functional:v.bool,imageList:{type:Array}},setup(a){const{prefixCls:u}=ue("image-preview"),c=C(()=>{const{imageList:l}=a;return l?l.map(n=>Le(n)?{src:n,placeholder:!1}:n):[]});return{prefixCls:u,getImageList:c}}});const Ee="/assets/resume.8f27866b.svg",$e="/assets/p-rotate.cb8bbfc3.svg",Ue="/assets/scale.44abde22.svg",De="/assets/unscale.c552f416.svg",Ne="/assets/unrotate.ef6a2daf.svg";var S=function(a){return a[a.LOADING=0]="LOADING",a[a.DONE=1]="DONE",a[a.FAIL=2]="FAIL",a}(S||{});const Be={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},h="img-preview",Oe=V({name:"ImagePreview",props:Be,emits:["img-load","img-error"],setup(a,{expose:u,emit:c}){const l=new Map,n=ie({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:S.LOADING,currentIndex:0,moveX:0,moveY:0,show:a.show}),I=B(null),_=B(null);function F(){o();const{index:e,imageList:s}=a;if(!s||!s.length)throw new Error("imageList is undefined");n.currentIndex=e,x(s[e])}function L(){n.imgScale=1,n.imgRotate=0,n.imgTop=0,n.imgLeft=0}function o(){const e=g(I);!e||(e.onmousewheel=m,document.body.addEventListener("DOMMouseScroll",m),document.ondragstart=function(){return!1})}const d=C(()=>{var s;const e=(s=a==null?void 0:a.scaleStep)!=null?s:0;return(e!=null?e:0>0)?e/100:n.imgScale/10});function m(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&b(d.value),e.delta<0&&b(-d.value)}function b(e){n.imgScale<=.2&&e<0||(n.imgScale+=e)}function p(e){n.imgRotate+=e}function A(){const e=g(_);!e||(e.onmousemove=null)}function x(e){n.status=S.LOADING;const s=new Image;s.src=e,s.onload=f=>{if(n.currentUrl!==e){const w=f.composedPath();if(a.rememberState){l.set(n.currentUrl,{scale:n.imgScale,top:n.imgTop,left:n.imgLeft,rotate:n.imgRotate});const D=l.get(e);D?(n.imgScale=D.scale,n.imgTop=D.top,n.imgRotate=D.rotate,n.imgLeft=D.left):(L(),a.defaultWidth&&(n.imgScale=a.defaultWidth/w[0].naturalWidth))}else a.defaultWidth&&(n.imgScale=a.defaultWidth/w[0].naturalWidth);w&&c("img-load",{index:n.currentIndex,dom:w[0],url:e})}n.currentUrl=e,n.status=S.DONE},s.onerror=f=>{const w=f.composedPath();w&&c("img-error",{index:n.currentIndex,dom:w[0],url:e}),n.status=S.FAIL}}function k(e){e&&e.stopPropagation(),E()}function E(){n.show=!1,document.body.removeEventListener("DOMMouseScroll",m),document.ondragstart=null}function M(){L()}u({resume:M,close:E,prev:$.bind(null,"left"),next:$.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(n.imgScale=e)},setRotate:e=>{n.imgRotate=e}});function $(e){const{currentIndex:s}=n,{imageList:f}=a;e==="left"&&(n.currentIndex--,s<=0&&(n.currentIndex=f.length-1)),e==="right"&&(n.currentIndex++,s>=f.length-1&&(n.currentIndex=0)),x(f[n.currentIndex])}function W(e){e=e||window.event,n.moveX=e.clientX,n.moveY=e.clientY;const s=g(_);s&&(s.onmousemove=X)}function X(e){e=e||window.event,e.preventDefault();const s=e.clientX-n.moveX,f=e.clientY-n.moveY;n.imgLeft+=s,n.imgTop+=f,n.moveX=e.clientX,n.moveY=e.clientY}const G=C(()=>{const{imgScale:e,imgRotate:s,imgTop:f,imgLeft:w}=n;return{transform:`scale(${e}) rotate(${s}deg)`,marginTop:`${f}px`,marginLeft:`${w}px`,maxWidth:a.defaultWidth?"unset":"100%"}}),P=C(()=>{const{imageList:e}=a;return e.length>1});ge(()=>{a.show&&F(),a.imageList&&L()});const U=e=>{a.maskClosable&&e.target&&e.target.classList.contains(`${h}-content`)&&k(e)},T=()=>r("div",{class:`${h}__close`,onClick:k},[r(Ae,{class:`${h}__close-icon`},null)]),Y=()=>{if(!g(P))return null;const{currentIndex:e}=n,{imageList:s}=a;return r("div",{class:`${h}__index`},[e+1,pe(" / "),s.length])},t=()=>r("div",{class:`${h}__controller`},[r("div",{class:`${h}__controller-item`,onClick:()=>b(-d.value)},[r("img",{src:De},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>b(d.value)},[r("img",{src:Ue},null)]),r("div",{class:`${h}__controller-item`,onClick:M},[r("img",{src:Ee},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>p(-90)},[r("img",{src:Ne},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>p(90)},[r("img",{src:$e},null)])]),i=e=>g(P)?r("div",{class:[`${h}__arrow`,e],onClick:()=>$(e)},[e==="left"?r(Se,null,null):r(ke,null,null)]):null;return()=>n.show&&r("div",{class:h,ref:I,onMouseup:A,onClick:U},[r("div",{class:`${h}-content`},[r("img",{style:g(G),class:[`${h}-image`,n.status===S.DONE?"":"hidden"],ref:_,src:n.currentUrl,onMousedown:W},null),T(),Y(),t(),i("left"),i("right")])])}});let z=null;function Me(a){var l;if(!ye)return;const u={},c=document.createElement("div");return Object.assign(u,{show:!0,index:0,scaleStep:100},a),z=r(Oe,u),ve(z,c),document.body.appendChild(c),(l=z.component)==null?void 0:l.exposed}var q=(a=>(a.all="all",a.image="image",a.file="file",a))(q||{});const Pe={class:"upload-download-handler"},Te={class:"upload-mover-handler"},Re=V({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(a){const u=a,{createMessage:c}=ce(),l=C(()=>g(u.fileList));function n(){let o=F();if(o===-1){c.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+o);return}if(o===0){_(o,g(l).length-1);return}_(o,o-1)}function I(){let o=F();if(o===-1){c.warn("\u79FB\u52A8\u5931\u8D25\uFF1A"+o);return}if(o==g(l).length-1){_(o,0);return}_(o,o+1)}function _(o,d){if(o!==d){let m=[...g(l)],b=m[o];m[o]=m[d],m[d]=b,u.emitValue(m.map(p=>p.url).join(","))}}function F(){var d,m;const o=(m=(d=u.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:m.src;if(o){const b=g(l);for(let p=0;p<b.length;p++){let A=b[p].url;const x=o.replace(window.location.origin,"");if(A===x||encodeURI(A)===x)return p}}return-1}function L(){var d,m;const o=(m=(d=u.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:m.src;window.open(o)}return(o,d)=>(N(),R(re,null,[K(y("div",Pe,[y("a",{class:"download",title:"\u4E0B\u8F7D",onClick:L},[r(g(O),{icon:"ant-design:download"})])],512),[[Z,a.download]]),K(y("div",Te,[y("a",{title:"\u5411\u524D\u79FB\u52A8",onClick:n},[r(g(O),{icon:"ant-design:arrow-left"})]),y("a",{title:"\u5411\u540E\u79FB\u52A8",onClick:I},[r(g(O),{icon:"ant-design:arrow-right"})])],512),[[Z,a.mover&&l.value.length>1]])],64))}}),Ve={key:0},We={class:"ant-upload-text"},le="ant-upload-list-item",qe=V({__name:"JUpload",props:{value:v.oneOfType([v.string,v.array]),text:v.string.def("\u4E0A\u4F20"),fileType:v.string.def(q.all),bizPath:v.string.def("temp"),returnUrl:v.bool.def(!0),maxCount:v.number.def(0),buttonVisible:v.bool.def(!0),multiple:v.bool.def(!0),mover:v.bool.def(!0),download:v.bool.def(!0),removeConfirm:v.bool.def(!1),beforeUpload:v.func,disabled:v.bool.def(!1)},emits:["change","update:value"],setup(a,{expose:u,emit:c}){const l=a,{createMessage:n,createConfirm:I}=ce(),{prefixCls:_}=ue("j-upload"),F=Ie(),L=ie({"X-Access-Token":Fe()}),o=B([]),d=B(!0),m=B(),b=C(()=>l.maxCount>0&&o.value.length>=l.maxCount),p=C(()=>l.fileType===q.image),A=C(()=>{const t=Object.assign({},l,g(F));return t.name="file",t.listType=p.value?"picture-card":"text",t.class=[t.class,{"upload-disabled":l.disabled}],t.data=Q({biz:l.bizPath},t.data),t.beforeUpload||(t.beforeUpload=$),p.value&&!t.accept&&(t.accept="image/*"),t});ee(()=>l.value,t=>{Array.isArray(t)?l.returnUrl?E(t.join(",")):M(t):E(t)},{immediate:!0}),ee(o,()=>_e(()=>x()),{immediate:!0});function x(){if(!p.value)return;const t=m.value?m.value.getElementsByClassName(le):null;if(!(!t||t.length===0))for(const i of t)i.getAttribute("data-has-actions")==="true"||i.addEventListener("mouseover",k)}function k(t){const e=(()=>{for(const w of t.path){if(w.classList.contains(le))return w;if(w.classList.contains(`${_}-container`))return null}return null})();if(!e)return;const s=e.getElementsByClassName("ant-upload-list-item-actions");if(!s||s.length===0)return;const f=document.createElement("div");f.className="upload-actions-container",xe(Re,{element:e,fileList:o,mover:l.mover,download:l.download,emitValue:U}).mount(f),s[0].appendChild(f),e.setAttribute("data-has-actions","true"),e.removeEventListener("mouseover",k)}function E(t){if(!t||t.length==0){o.value=[];return}let i=[];for(const e of t.split(",")){let s=j(e);i.push({uid:T(),name:Y(e),status:"done",url:s,response:{status:"history",message:e}})}o.value=i}function M(t){if(!t||t.length==0){o.value=[];return}let i=[];for(const e of t){let s=j(e.filePath);i.push({uid:T(),name:e.fileName,url:s,status:"done",response:{status:"history",message:e.filePath}})}o.value=i}function $(t){return d.value=!0,p.value&&t.type.indexOf("image")<0?(n.warning("\u8BF7\u4E0A\u4F20\u56FE\u7247"),d.value=!1,!1):typeof l.beforeUpload=="function"?l.beforeUpload(t):!0}function W(){return l.removeConfirm?new Promise(t=>{I({title:"\u5220\u9664",content:`\u786E\u5B9A\u8981\u5220\u9664\u8FD9${p.value?"\u5F20\u56FE\u7247":"\u4E2A\u6587\u4EF6"}\u5417\uFF1F`,iconType:"warning",onOk:()=>t(!0),onCancel:()=>t(!1)})}):!0}function X(t){!t.file.status&&d.value===!1&&t.fileList.pop();let i=t.fileList;if(l.maxCount>0&&i.length>=l.maxCount)if(l.maxCount-i.length>=0)i=i.slice(-l.maxCount);else return;if(t.file.status==="done"){let e=[];t.file.response.success?e=i.map(s=>{if(s.response){let f=s.response.message;s.url=j(f)}return s}):(e=i.filter(s=>s.uid!=t.file.uid),n.error(`${t.file.name} \u4E0A\u4F20\u5931\u8D25.`)),i=e}else t.file.status==="error"&&n.error(`${t.file.name} \u4E0A\u4F20\u5931\u8D25.`);if(o.value=i,t.file.status==="done"||t.file.status==="removed")if(l.returnUrl)G();else{let e=[];for(const s of i)if(s.status==="done"){let f={fileName:s.name,filePath:s.response.message,fileSize:s.size};e.push(f)}else return;U(e)}}function G(){let t=o.value,i="";(!t||t.length==0)&&(i="");let e=[];for(const s of t)if(s.status==="done")e.push(s.response.message);else return;e.length>0&&(i=e.join(",")),U(i)}function P(t){p.value?Me({imageList:[t.url],maskClosable:!0}):window.open(t.url)}function U(t){c("change",t),c("update:value",t)}function T(){return"-"+parseInt(Math.random()*1e4+1,10)}function Y(t){if(t.lastIndexOf("\\")>=0){let i=new RegExp("\\\\","g");t=t.replace(i,"/")}return t.substring(t.lastIndexOf("/")+1)}return u({addActionsListener:x}),(t,i)=>{const e=te("a-button"),s=te("a-upload");return N(),R("div",{ref_key:"containerRef",ref:m,class:be(`${g(_)}-container`)},[r(s,we({headers:L,multiple:a.multiple,action:g(Ce),fileList:o.value,disabled:a.disabled},A.value,{onRemove:W,onChange:X,onPreview:P}),{default:ne(()=>[p.value?(N(),R(re,{key:0},[b.value?se("",!0):(N(),R("div",Ve,[r(g(O),{icon:"ant-design:plus-outlined"}),y("div",We,ae(a.text),1)]))],64)):a.buttonVisible?(N(),he(e,{key:1,disabled:b.value||a.disabled},{default:ne(()=>[r(g(O),{icon:"ant-design:upload-outlined"}),y("span",null,ae(a.text),1)]),_:1},8,["disabled"])):se("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{q as U,qe as _,Me as c};
