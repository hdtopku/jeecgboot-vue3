import{V as I}from"./cgform.data-e49498ca.js";import{p as N}from"./pick-51214243.js";import{c as R,k as D,e as F,n as h}from"./vue-c7e3516e.js";var k=(u,v,l)=>new Promise((n,b)=>{var o=t=>{try{r(l.next(t))}catch(c){b(c)}},m=t=>{try{r(l.throw(t))}catch(c){b(c)}},r=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,m);r((l=l.apply(u,v)).next())});function X(u){const v=R("tables"),l=R("fullScreenRef"),n=D(),b=D(!1),o=D([]),m=F(()=>({normal:l!=null&&l.value?430:260,noToolbar:l!=null&&l.value?480:320})),r=F(()=>["id"].concat(u.value.map(a=>a.key))),t=F(()=>({scrollY:{gt:15},scrollX:{gt:20}}));function c(a){return k(this,null,function*(){let e=n.value;if(yield e.fullValidateTable())throw{code:I,activeKey:a};let y=e.getTableData().map(f=>N(f,r.value)),p=e.getDeleteData().map(f=>f.id);return{tableData:y,deleteIds:p}})}function w(a,e=!1){return k(this,null,function*(){e?(o.value=[],yield h(),yield n.value.addOrInsert(a,0,null,{setActive:!1}),yield h(),n.value.recalcDisableRows()):o.value=a})}function g(a){let e=n.value,x=a.value.tableRef,y=a.value.getRemoveIds(),p=x.getXTable().internalData.tableFullData,f=e.getXTable().internalData.tableFullData;return p.forEach(s=>{let T=!1;if(f.forEach(d=>{if(s.id===d.id){let i=d.dbFieldName,E=d.dbFieldTxt;(s.dbFieldName!==i||s.dbFieldTxt!==E)&&e.setValues([{rowKey:d.id,values:{dbFieldName:s.dbFieldName,dbFieldTxt:s.dbFieldTxt}}]),T=!0}else y.forEach(i=>{i===d.id&&(e.removeRowsById(i),T=!0)})}),!T){let d=Object.assign({},s);u.value.forEach(i=>{i.key!=="dbFieldName"&&i.key!=="dbFieldTxt"&&(d[i.key]=i.defaultValue)}),e.addRows(d)}}),h()}return{tables:v,tableRef:n,loading:b,dataSource:o,columnKeys:r,tableHeight:m,tableProps:t,syncTable:g,validateData:c,setDataSource:w}}export{X as u};
