import"./index-f191817e.js";import{q as _e,ap as He,bB as Ke}from"./jeecg-online-vendor-d3e1865b.js";import Pe from"./OnlineAutoModal-2a146238-631d263a.js";import Je from"./OnlineDetailModal-f967f080-9a80e1ce.js";import Ve from"./OnlineCustomModal-456a85a6-e68745e5.js";import{l as P,w as qe,V as c,a7 as i,a8 as S,f,W as g,ac as u,ak as Ne,aa as a,E as y,F as J,ab as ze,ae as v,v as je,B as Ue,ad as A,af as We,ag as $e,ah as Ge,ai as Xe,aj as Ye}from"./vue-50733b77.js";import{x as Ze}from"./JImportModal-0c143f01.js";import{l as eo,o as oo}from"./useListButton-cef1371a-e7d018c3.js";import{d as to,p as no,g as lo}from"./useExtendComponent-48d37d9b-605c45a2.js";import io from"./OnlineQueryForm-1c5949a7-fd60102d.js";import ao from"./SuperQuery-3821f984-426f5de0.js";import{s as ro}from"./constant-fe20103a-44089532.js";import"./index-f7d688aa.js";import"./OnlineForm-630a22c2-2f3f9359.js";import"./index-7e7a94e9.js";import"./lodash-es-vendor-058e2396.js";import"./index-b34ff7bc.js";import"./antd-vue-vendor-c5335947.js";import"./CommentPanel-3f8ed367.js";import"./OnlineFormDetail-1b216792-2859f9ba.js";import"./DetailForm-e4538e7a-991b79c0.js";import"./JUpload-c8630cc9.js";import"./OnlineSubFormDetail-0aa4966c-fd13d8d2.js";import{Q as so}from"./componentMap-5c02cfaf.js";import"./index-5593b297.js";import"./user.api-c252cb60.js";import"./customExpression-62f5afd1.js";import"./useListPage-4f9607d2.js";import"./LinkTableListPiece-34266919-7405b407.js";import"./OnlineSelectCascade-c7baf52b-e9e1ca05.js";import"./JModalTip-abe1515a-57f430d6.js";import"./SuperQueryValComponent.vue_vue_type_script_lang-e3ad7ee8-7a33975c.js";import co from"./BasicTable-ca5b2c76.js";import"./index-fa22fec6.js";import"./tinymce-vendor-7c917b36.js";import"./vxe-table-vendor-838914b0.js";import"./BasicModal-064024e0.js";import"./useWindowSizeFn-34cbae37.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./useForm-14ceb529.js";import"./useFormItem-915d7f1b.js";import"./download-49b89a1a.js";import"./base64Conver-fa2fe1af.js";import"./index-54db12ae.js";import"./index-f3acc26c.js";import"./useCountdown-9338ec9a.js";import"./useFormItemSingle-37938520.js";import"./JAddInput-9c2385b5.js";import"./areaDataUtil-5dfcdadb.js";import"./JSelectUser-99e618da.js";import"./props-2079d80b.js";import"./JSelectBiz-f98b6288.js";import"./index-95220aa0.js";import"./index-7963a080.js";import"./bem-e62027cc.js";import"./props-12d3a914.js";import"./useContextMenu-e6153f12.js";import"./depart.api-1967d2cb.js";import"./JSelectDept-0fd43050.js";import"./JPopup-8bd4163b.js";import"./cron-parser-vendor-19ac00ef.js";import"./JEllipsis-66e02300.js";import"./index-665aeeac.js";import"./index-1ac4dcff.js";import"./injectionKey-69710956.js";var O=(e,x,p)=>new Promise((l,T)=>{var C=s=>{try{r(p.next(s))}catch(h){T(h)}},m=s=>{try{r(p.throw(s))}catch(h){T(h)}},r=s=>s.done?l(s.value):Promise.resolve(s.value).then(C,m);r((p=p.apply(e,x)).next())});const uo={name:"DefaultOnlineList",components:{BasicTable:co,TableAction:so,OnlineAutoModal:Pe,JImportModal:Ze,OnlineQueryForm:io,OnlineSuperQuery:ao,OnlineCustomModal:Ve,OnlineDetailModal:Je},setup(){const{createMessage:e}=_e(),x=P(),{ID:p,onlineTableContext:l,onlineQueryFormOuter:T,loading:C,reload:m,dataSource:r,pagination:s,handleSpecialConfig:h,getColumnList:F,handleChangeInTable:B,loadData:D,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,registerCustomModal:o,getTreeDataByResult:w,expandedRowKeys:d,handleExpandedRowsChange:V,tableReloading:q,onlineExtConfigJson:Q,handleFormConfig:N}=eo();if(!p.value){e.warning("地址错误, 配置ID不存在!");return}l.isTree(!0);let{initCgEnhanceJs:z}=to(l);const{buttonSwitch:j,cgLinkButtonList:U,cgTopButtonList:W,importUrl:$,registerModal:G,handleAdd:_,handleEdit:X,handleBatchDelete:Y,registerImportModal:Z,onImportExcel:ee,onExportExcel:oe,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleSubmitFlow:ie,getDropDownActions:ae,getActions:re,initButtonList:se,initButtonSwitch:de,registerDetailModal:ce}=oo(l,Q),{columns:ue,actionColumn:pe,selectedKeys:me,rowSelection:ge,enableScrollBar:he,tableScroll:fe,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,handleColumnResult:Se,hrefComponent:xe,viewOnlineCellImage:Te}=no(l,Q);qe(p,()=>{ke()},{immediate:!0});function ke(){return O(this,null,function*(){C.value=!0;let t=yield F(ro);Re(t),yield D(),C.value=!1,l.execButtonEnhance("setup")})}function Re(t){let n=z(t.enhanceJs);l.EnhanceJS=n,se(t.cgButtonList),de(t.hideColumns),Se(t),h(t),l.hasChildrenField=t.hasChildrenField,l.pidField=t.pidField}function Ie(t,n){l.queryParam=t,n===!0?m():H()}function ve(t){return O(this,null,function*(){yield lo(k),k.value.init(t)})}function Fe(t,n){let b=d.value;if(t){if(Be(n.id),n.children.length>0&&n.children[0].isLoading===!0){let R=l.hasChildrenField;const{sortField:Ae,sortType:Oe}=l;let M=Object.assign({},{column:Ae,order:Oe});M[l.pidField]=n.id,M[R]=n[R];let Qe=`${l.onlineUrl.getTreeData}${l.ID}`;He.get({url:Qe,params:M},{isTransformResponse:!1}).then(I=>{I.success?Number(I.result.total)>0?n.children=w(I.result.records):(n.children="",n.hasChildrenField="0"):e.warning(I.message)}).catch(()=>{e.warning("加载子节点失败!")})}}else{let R=b.indexOf(n.id);R>=0&&(d.value=b.splice(R,1))}}function Be(t){let n=d.value;n&&n.indexOf(t)<0&&n.push(t),d.value=n}function H(){return O(this,null,function*(){l.isTree()===!0&&(d.value=[],x.value.collapseAll()),m()})}function De(t){if(K.value===!0){let n=t[l.pidField];if(n){let b=d.value;b.indexOf(n)<0&&b.push(n),d.value=b}}m()}const Ee=t=>({label:"添加下级",onClick:Le.bind(null,t)}),K=P(!1);function Le(t){K.value=!0;let n={[l.pidField]:t.id};_(n)}function Me(t){let n=ae(t);return n.unshift(Ee(t)),n}return{ID:p,onlineQueryFormOuter:T,queryWithCondition:Ie,onQueryFormLoaded:ve,reload:m,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,loading:C,columns:ue,actionColumn:pe,dataSource:r,pagination:s,rowSelection:ge,selectedKeys:me,tableScroll:fe,enableScrollBar:he,handleChangeInTable:B,buttonSwitch:j,handleAdd:_,handleEdit:X,onImportExcel:ee,onExportExcel:oe,cgTopButtonList:W,cgLinkButtonList:U,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleBatchDelete:Y,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,getActions:re,getTreeDropDownActions:Me,registerModal:G,registerCustomModal:o,registerImportModal:Z,importUrl:$,handleFormConfig:N,tableReloading:q,handleSubmitFlow:ie,hrefComponent:xe,viewOnlineCellImage:Te,onlineTreeTableRef:x,handlerFormSuccess:De,searchReset:H,handleExpand:Fe,expandedRowKeys:d,handleExpandedRowsChange:V,registerDetailModal:ce}}},po={class:"p-2"},mo={key:0,style:{"font-size":"12px","font-style":"italic"}},go={key:0,style:{"font-size":"12px","font-style":"italic"}},ho=["src","onClick"],fo=["innerHTML"],yo=["title"];function Co(e,x,p,l,T,C){const m=c("online-query-form"),r=c("a-button"),s=c("online-super-query"),h=c("TableAction"),F=c("BasicTable"),B=c("OnlineAutoModal"),D=c("JImportModal"),k=c("a-modal"),E=c("online-custom-modal"),L=c("online-detail-modal");return i(),S("div",po,[f(m,{ref:"onlineQueryFormOuter",id:e.ID,onSearch:e.queryWithCondition,onLoaded:e.onQueryFormLoaded},null,8,["id","onSearch","onLoaded"]),e.tableReloading?g("",!0):(i(),u(F,{key:0,ref:"onlineTreeTableRef",isTreeTable:!0,expandedRowKeys:e.expandedRowKeys,onExpandedRowsChange:e.handleExpandedRowsChange,onExpand:e.handleExpand,rowKey:"jeecg_row_key",canResize:!0,bordered:!0,showIndexColumn:!1,loading:e.loading,columns:e.columns,dataSource:e.dataSource,pagination:e.pagination,rowSelection:e.rowSelection,actionColumn:e.actionColumn,showTableSetting:!0,clickToRowSelect:!1,scroll:e.tableScroll,onTableRedo:e.reload,class:Ne({"j-table-force-nowrap":e.enableScrollBar}),onChange:e.handleChangeInTable},{tableTitle:a(()=>[e.buttonSwitch.add?(i(),u(r,{key:0,preIcon:"ant-design:plus-outlined",type:"primary",onClick:e.handleAdd},{default:a(()=>[y("新增")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.import?(i(),u(r,{key:1,preIcon:"ant-design:import-outlined",type:"primary",onClick:e.onImportExcel},{default:a(()=>[y("导入")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.export?(i(),u(r,{key:2,preIcon:"ant-design:export-outlined",type:"primary",onClick:e.onExportExcel},{default:a(()=>[y(" 导出")]),_:1},8,["onClick"])):g("",!0),e.cgTopButtonList&&e.cgTopButtonList.length>0?(i(!0),S(J,{key:3},ze(e.cgTopButtonList,(o,w)=>(i(),S(J,null,[o.optType=="js"?(i(),u(r,{key:"cgbtn"+w,onClick:d=>e.cgButtonJsHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:a(()=>[y(v(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):o.optType=="action"?(i(),u(r,{key:"cgbtn"+w,onClick:d=>e.cgButtonActionHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:a(()=>[y(v(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):g("",!0)],64))),256)):g("",!0),e.buttonSwitch.batch_delete?je((i(),u(r,{key:4,preIcon:"ant-design:delete-outlined",onClick:e.handleBatchDelete},{default:a(()=>[y(" 批量删除")]),_:1},8,["onClick"])),[[Ue,e.selectedKeys.length>0]]):g("",!0),e.buttonSwitch.super_query?(i(),u(s,{key:5,ref:"superQueryButtonRef",online:"",status:e.superQueryStatus,onSearch:e.handleSuperQuery},null,8,["status","onSearch"])):g("",!0)]),fileSlot:a(({text:o})=>[o?(i(),u(r,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:w=>e.downloadRowFile(o)},{default:a(()=>[y(" 下载 ")]),_:2},1032,["onClick"])):(i(),S("span",mo,"无文件"))]),imgSlot:a(({text:o})=>[o?(i(),S("img",{key:1,src:e.getImgView(o),alt:"图片不存在",class:"online-cell-image",onClick:w=>e.viewOnlineCellImage(o)},null,8,ho)):(i(),S("span",go,"无图片"))]),htmlSlot:a(({text:o})=>[A("div",{innerHTML:o},null,8,fo)]),pcaSlot:a(({text:o})=>[A("div",{title:e.getPcaText(o)},v(e.getPcaText(o)),9,yo)]),dateSlot:a(({text:o})=>[A("span",null,v(e.getFormatDate(o)),1)]),action:a(({record:o})=>[f(h,{actions:e.getActions(o),dropDownActions:e.getTreeDropDownActions(o)},null,8,["actions","dropDownActions"])]),_:1},8,["expandedRowKeys","onExpandedRowsChange","onExpand","loading","columns","dataSource","pagination","rowSelection","actionColumn","scroll","onTableRedo","class","onChange"])),f(B,{id:e.ID,onRegister:e.registerModal,onSuccess:e.handlerFormSuccess,onFormConfig:e.handleFormConfig},null,8,["id","onRegister","onSuccess","onFormConfig"]),f(D,{onRegister:e.registerImportModal,url:e.importUrl(),onOk:e.reload,online:""},null,8,["onRegister","url","onOk"]),f(k,We(e.hrefComponent.model,$e(e.hrefComponent.on)),{default:a(()=>[(i(),u(Ge(e.hrefComponent.is),Xe(Ye(e.hrefComponent.params)),null,16))]),_:1},16),f(E,{onRegister:e.registerCustomModal,onSuccess:e.reload},null,8,["onRegister","onSuccess"]),f(L,{id:e.ID,onRegister:e.registerDetailModal},null,8,["id","onRegister"])])}const Et=Ke(uo,[["render",Co]]);export{Et as default};
