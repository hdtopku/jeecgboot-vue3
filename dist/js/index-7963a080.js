var we=Object.defineProperty,Ne=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var se=(e,y,s)=>y in e?we(e,y,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[y]=s,I=(e,y)=>{for(var s in y||(y={}))Ie.call(y,s)&&se(e,s,y[s]);if(ce)for(var s of ce(y))Ue.call(y,s)&&se(e,s,y[s]);return e},re=(e,y)=>Ne(e,Me(y));var ie=(e,y,s)=>new Promise((x,F)=>{var C=L=>{try{k(s.next(L))}catch(B){F(B)}},l=L=>{try{k(s.throw(L))}catch(B){F(B)}},k=L=>L.done?x(L.value):Promise.resolve(L.value).then(C,l);k((s=s.apply(e,y)).next())});import{d as Se,l as Ke,ar as Pe,e as M,w as P,a7 as N,a8 as j,u as r,R as Oe,W as U,ac as W,aa as H,E as oe,ae as de,ak as ue,f as A,F as Q,ab as je,ai as He,aj as Ve,A as Re,ax as Xe,h as Ye,r as he,s as V,o as $e,J as $,v as ye,B as fe,af as ze,i as Je}from"./vue-50733b77.js";import{cI as Ge,cJ as We,cK as qe,bu as Qe,bt as Ze,d as Z,o as et,S as tt,bR as nt,br as ke,J as at}from"./antd-vue-vendor-c5335947.js";import{d as lt,B as ct,t as ee,a9 as st,x as rt,A as it}from"./index-b34ff7bc.js";import{o as ot,E as pe,B as dt,aV as ut,b8 as ht,k as yt,j as q,aw as ge,am as ft}from"./jeecg-online-vendor-d3e1865b.js";import{createBEM as xe}from"./bem-e62027cc.js";import{buildProps as kt}from"./props-12d3a914.js";import{d as pt}from"./lodash-es-vendor-058e2396.js";import{useContextMenu as gt}from"./useContextMenu-e6153f12.js";var E=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(E||{});const St=["update:expandedKeys","update:selectedKeys","update:value","change","check","search","update:searchValue"],Kt=kt({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1}}),xt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch justify-end"},At=Se({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search","clickSearch"],setup(e,{emit:y}){const s=e,x=Ke(""),[F]=xe("tree-header"),C=Pe(),{t:l}=ot(),k=M(()=>["mr-1","w-full",{"ml-5":C.headerTitle||s.title}]),L=M(()=>{const{checkable:t}=s,a=[{label:l("component.tree.expandAll"),value:E.EXPAND_ALL},{label:l("component.tree.unExpandAll"),value:E.UN_EXPAND_ALL,divider:t}];return t?[{label:l("component.tree.selectAll"),value:E.SELECT_ALL},{label:l("component.tree.unSelectAll"),value:E.UN_SELECT_ALL,divider:t},...a,{label:l("component.tree.checkStrictly"),value:E.CHECK_STRICTLY},{label:l("component.tree.checkUnStrictly"),value:E.CHECK_UN_STRICTLY}]:a});function B(t){var c,i,d,o;const{key:a}=t;switch(a){case E.SELECT_ALL:(c=s.checkAll)==null||c.call(s,!0);break;case E.UN_SELECT_ALL:(i=s.checkAll)==null||i.call(s,!1);break;case E.EXPAND_ALL:(d=s.expandAll)==null||d.call(s,!0);break;case E.UN_EXPAND_ALL:(o=s.expandAll)==null||o.call(s,!1);break;case E.CHECK_STRICTLY:y("strictly-change",!1);break;case E.CHECK_UN_STRICTLY:y("strictly-change",!0);break}}function _(t){y("search",t)}const h=lt(_,200);return P(()=>x.value,t=>{h(t)}),P(()=>s.searchText,t=>{t!==x.value&&(x.value=t)}),(t,a)=>(N(),j("div",{class:ue([r(F)(),"flex px-2 py-1.5 items-center"])},[r(C).headerTitle?Oe(t.$slots,"headerTitle",{key:0}):U("",!0),!r(C).headerTitle&&t.title?(N(),W(r(ct),{key:1,helpMessage:t.helpMessage},{default:H(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):U("",!0),t.search||t.toolbar?(N(),j("div",xt,[t.search?(N(),j("div",{key:0,class:ue(k.value)},[A(r(Ge),{placeholder:r(l)("common.searchText"),size:"small",allowClear:"",value:x.value,"onUpdate:value":a[0]||(a[0]=c=>x.value=c),onSearch:a[1]||(a[1]=c=>t.$emit("clickSearch",c))},null,8,["placeholder","value"])],2)):U("",!0),t.toolbar?(N(),W(r(Ze),{key:1,onClick:a[2]||(a[2]=Re(()=>{},["prevent"]))},{overlay:H(()=>[A(r(Qe),{onClick:B},{default:H(()=>[(N(!0),j(Q,null,je(L.value,c=>(N(),j(Q,{key:c.value},[A(r(We),He(Ve({key:c.value})),{default:H(()=>[oe(de(c.label),1)]),_:2},1040),c.divider?(N(),W(r(qe),{key:0})):U("",!0)],64))),128))]),_:1})]),default:H(()=>[A(r(ee),{icon:"ion:ellipsis-vertical"})]),_:1})):U("",!0)])):U("",!0)],2))}}),Lt=({icon:e})=>e?Xe(e)?Ye(ee,{icon:e,class:"mr-1"}):ee:null;function Ct(e,y){function s(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];t.push(o[c]);const f=o[i];f&&f.length&&t.push(...s(f))}return t}function x(h){const t=[],a=h||r(e),{key:c,children:i}=r(y);if(!i||!c)return t;for(let d=0;d<a.length;d++){const o=a[d];o.disabled!==!0&&o.selectable!==!1&&t.push(o[c]);const f=o[i];f&&f.length&&t.push(...x(f))}return t}function F(h,t){const a=[],c=t||r(e),{key:i,children:d}=r(y);if(!d||!i)return a;for(let o=0;o<c.length;o++){const f=c[o],v=f[d];h===f[i]?(a.push(f[i]),v&&v.length&&a.push(...s(v))):v&&v.length&&a.push(...F(h,v))}return a}function C(h,t,a){if(!h)return;const c=a||r(e),{key:i,children:d}=r(y);if(!(!d||!i))for(let o=0;o<c.length;o++){const f=c[o],v=f[d];if(f[i]===h){c[o]=I(I({},c[o]),t);break}else v&&v.length&&C(h,t,f[d])}}function l(h=1,t,a=1){if(!h)return[];const c=[],i=t||r(e)||[];for(let d=0;d<i.length;d++){const o=i[d],{key:f,children:v}=r(y),z=f?o[f]:"",O=v?o[v]:[];c.push(z),O&&O.length&&a<h&&(a+=1,c.push(...l(h,O,a)))}return c}function k({parentKey:h=null,node:t,push:a="push"}){const c=Z(r(e));if(!h){c[a](t),e.value=c;return}const{key:i,children:d}=r(y);!d||!i||(pe(c,o=>{if(o[i]===h)return o[d]=o[d]||[],o[d][a](t),!0}),e.value=c)}function L({parentKey:h=null,list:t,push:a="push"}){const c=Z(r(e));if(!(!t||t.length<1))if(h){const{key:i,children:d}=r(y);if(!d||!i)return;pe(c,o=>{if(o[i]===h){o[d]=o[d]||[];for(let f=0;f<t.length;f++)o[d][a](t[f]);return e.value=c,!0}})}else for(let i=0;i<t.length;i++)c[a](t[i])}function B(h,t){if(!h)return;const a=t||r(e),{key:c,children:i}=r(y);if(!(!i||!c))for(let d=0;d<a.length;d++){const o=a[d],f=o[i];if(o[c]===h){a.splice(d,1);break}else f&&f.length&&B(h,o[i])}}function _(h,t,a){return!h&&h!==0?null:((t||r(e)).forEach(i=>{if(a!=null&&a.key||(a==null?void 0:a.key)===0)return a;if(i.key===h){a=i;return}i.children&&i.children.length&&(a=_(h,i.children,a))}),a||null)}return{deleteNodeByKey:B,insertNodeByKey:k,insertNodesByKey:L,filterByLevel:l,updateNodeByKey:C,getAllKeys:s,getChildrenKeys:F,getEnabledKeys:x,getSelectedNode:_}}function vt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Je(e)}const Nt=Se({name:"BasicTree",inheritAttrs:!1,props:Kt,emits:St,setup(e,{attrs:y,slots:s,emit:x,expose:F}){const[C]=xe("tree"),l=he({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),k=he({startSearch:!1,searchText:"",searchData:[]}),L=Ke([]),[B]=gt(),_=M(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),h=M(()=>{let n=re(I(I({blockNode:!0},y),e),{expandedKeys:l.expandedKeys,selectedKeys:l.selectedKeys,checkedKeys:l.checkedKeys,checkStrictly:l.checkStrictly,fieldNames:r(_),"onUpdate:expandedKeys":u=>{l.expandedKeys=u,x("update:expandedKeys",u)},"onUpdate:selectedKeys":u=>{l.selectedKeys=u,x("update:selectedKeys",u)},onCheck:(u,S)=>{let p=$(l.checkedKeys);if(yt(p)&&k.startSearch){const K=S.node.eventKey;p=pt(p,z(K)),S.checked&&p.push(K),l.checkedKeys=p}else l.checkedKeys=u;const g=$(l.checkedKeys);x("update:value",g),x("check",g,S)},onRightClick:Ce});return et(n,"treeData","class")}),t=M(()=>k.startSearch?k.searchData:r(L)),a=M(()=>!t.value||t.value.length===0),{deleteNodeByKey:c,insertNodeByKey:i,insertNodesByKey:d,filterByLevel:o,updateNodeByKey:f,getAllKeys:v,getChildrenKeys:z,getEnabledKeys:O,getSelectedNode:Ae}=Ct(L,_);function Le(n,u){return!u&&e.renderIcon&&q(e.renderIcon)?e.renderIcon(n):u}function Ce(S){return ie(this,arguments,function*({event:n,node:u}){var m;const{rightMenuList:p=[],beforeRightClick:g}=e;let K={event:n,items:[]};if(g&&q(g)){let b=yield g(u,n);Array.isArray(b)?K.items=b:Object.assign(K,b)}else K.items=p;(m=K.items)!=null&&m.length&&(K.items=K.items.filter(b=>!b.hidden),B(K))})}function R(n){l.expandedKeys=n}function ve(){return l.expandedKeys}function te(n){l.selectedKeys=n}function Ee(){return l.selectedKeys}function ne(n){l.checkedKeys=n}function be(){return l.checkedKeys}function ae(n){l.checkedKeys=n?O():[]}function J(n){l.expandedKeys=n?v():[]}function Te(n){l.checkStrictly=n}P(()=>e.searchValue,n=>{n!==k.searchText&&(k.searchText=n)},{immediate:!0}),P(()=>e.treeData,n=>{n&&G(k.searchText)});function G(n){if(n!==k.searchText&&(k.searchText=n),x("update:searchValue",n),!n){k.startSearch=!1;return}const{filterFn:u,checkable:S,expandOnSearch:p,checkOnSearch:g,selectedOnSearch:K}=r(e);k.startSearch=!0;const{title:m,key:b}=r(_),D=[];if(k.searchData=dt(r(L),T=>{var X,Y;const w=u?u(n,T,r(_)):(Y=(X=T[m])==null?void 0:X.includes(n))!=null?Y:!1;return w&&D.push(T[b]),w},r(_)),p){const T=ut(k.searchData).map(w=>w[b]);T&&T.length&&R(T)}g&&S&&D.length&&ne(D),K&&D.length&&te(D)}function _e(n,u){if(!(!e.clickRowToExpand||!u||u.length===0))if(!l.expandedKeys.includes(n))R([...l.expandedKeys,n]);else{const S=[...l.expandedKeys],p=S.findIndex(g=>g===n);p!==-1&&S.splice(p,1),R(S)}}V(()=>{L.value=e.treeData}),$e(()=>{const n=parseInt(e.defaultExpandLevel);n>0?l.expandedKeys=o(n):e.defaultExpandAll&&J(!0)}),V(()=>{l.expandedKeys=e.expandedKeys}),V(()=>{l.selectedKeys=e.selectedKeys}),V(()=>{l.checkedKeys=e.checkedKeys}),P(()=>e.value,()=>{l.checkedKeys=$(e.value||e.checkedKeys||[])},{immediate:!0}),P(()=>l.checkedKeys,()=>{const n=$(l.checkedKeys);x("update:value",n),x("change",n)}),V(()=>{l.checkStrictly=e.checkStrictly});const Be={setExpandedKeys:R,getExpandedKeys:ve,setSelectedKeys:te,getSelectedKeys:Ee,setCheckedKeys:ne,getCheckedKeys:be,insertNodeByKey:i,insertNodesByKey:d,deleteNodeByKey:c,updateNodeByKey:f,getSelectedNode:Ae,checkAll:ae,expandAll:J,filterByLevel:n=>{l.expandedKeys=o(n)},setSearchValue:n=>{G(n)},getSearchValue:()=>k.searchText};function De(n){const{actionList:u}=e;if(!(!u||u.length===0))return u.map((S,p)=>{var K;let g=!0;return q(S.show)?g=(K=S.show)==null?void 0:K.call(S,n):ge(S.show)&&(g=S.show),g?A("span",{key:p,class:C("action")},[S.render(n)]):null})}const Fe=M(()=>{const n=Z(t.value);return ht(n,(u,S)=>{var le;const p=k.searchText,{highlight:g}=r(e),{title:K,key:m,children:b}=r(_),D=Le(u,u.icon),T=at(u,K),w=p?T.indexOf(p):-1,X=k.startSearch&&!ft(p)&&g&&w!==-1,Y=`color: ${ge(g)?"#f50":g}`,me=X?A("span",{class:(le=r(h))!=null&&le.blockNode?`${C("content")}`:""},[A("span",null,[T.substr(0,w)]),A("span",{style:Y},[p]),A("span",null,[T.substr(w+p.length)])]):T;return u[K]=A("span",{class:`${C("title")} pl-2`,onClick:_e.bind(null,u[m],u[b])},[s!=null&&s.title?it(s,"title",u):A(Q,null,[D&&A(Lt,{icon:D},null),me,A("span",{class:C("actions")},[De(u)])])]),u}),n});return F(Be),()=>{let n;const{title:u,helpMessage:S,toolbar:p,search:g,checkable:K}=e,m=u||p||g||s.headerTitle,b={height:"calc(100% - 38px)"};return A("div",{class:[C(),"h-full",y.class]},[m&&A(At,{checkable:K,checkAll:ae,expandAll:J,title:u,search:g,toolbar:p,helpMessage:S,onStrictlyChange:Te,onSearch:G,onClickSearch:D=>x("search",D),searchText:k.searchText},vt(n=st(s))?n:{default:()=>[n]}),A(tt,{spinning:r(e.loading),tip:"加载中..."},{default:()=>[ye(A(rt,{style:b},{default:()=>[A(nt,ze(r(h),{showIcon:!1,treeData:Fe.value}),null)]}),[[fe,!r(a)]]),ye(A(ke,{image:ke.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[fe,r(a)]])]})])}}});export{Nt as _};
