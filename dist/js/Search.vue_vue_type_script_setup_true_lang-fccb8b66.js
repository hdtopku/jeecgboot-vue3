import{d as he,k as o,g as we,o as Ce,U as u,a5 as i,a6 as B,f as n,a7 as t,aa as xe,E as f,h as Oe,v as V,A as H,V as O,a9 as m,u as z,R as b,al as Se,F as J,a8 as ne,ab as Q}from"./vue-705b7309.js";import{ad as _,q as Ne,a2 as De,aa as se}from"./antd-vue-vendor-cce59da1.js";import{D as Pe,E as Be}from"./jeecg-online-vendor-e26fc0e5.js";import{A as Ae,Y as Ue}from"./index-ea73cedc.js";const $e=c=>{if(c==null)return"";const F=/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,h=c.match(F);return h!=null?h[0]:c},Ee=()=>navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)!=null,Te=()=>!Ee(),Ye={class:"flex flex-wrap justify-evenly"},Me={key:0,class:"flex flex-wrap justify-evenly"},Le={key:1,class:"flex flex-wrap justify-evenly"},qe=he({__name:"Search",props:{placeholder:{type:String,default:"粘贴搜索"},showTop:{type:Boolean,default:!1},showCopy:{type:Boolean,default:!1},showPeople:{type:Boolean,default:!1},tabPane:{type:Object,default:()=>({tabs:[],activeKey:"0"})},switchName:{type:String,default:""}},emits:["queryList","changeAdvanced","confirmCopy"],setup(c,{expose:F,emit:h}){var ee;const p=c,{hasPermission:oe}=Ae(),d=o(_()),w=o(_()),s=o(),v=o(1),G=o(!0),A=o(!1),U=o(!1),K=o([]),y=o(0),C=o(!1),S=o(!1),ue=e=>e&&e>_().endOf("day"),ie=e=>e&&e>_().endOf("day")||e.isBefore(d.value),g=o(),N=(e,a=0)=>{y.value=e,y.value===365?d.value=_().startOf("year"):y.value===100?d.value=_().startOf("month"):d.value=_().subtract(e,"day"),w.value=_().subtract(a,"day"),g.value=!1,k()},W=()=>{g.value=!0,k()},re=()=>{navigator.clipboard.readText().then(e=>{s.value=e,k()}).catch(e=>{e instanceof DOMException?se.error("请手动粘贴，或允许读取剪贴板，失败原因："+e):se.error("请手动粘贴，失败原因："+e)})},X=()=>{var e;return G.value?S.value&&((e=p.switchName)==null?void 0:e.length)>0?"warning":"primary":"error"},ce=()=>{K.value.length===0&&(U.value=!0,Ue({}).then(e=>{K.value=e.records,U.value=!1}))},I=Pe(Be),D=o();let{username:$,realname:ve}=I==null?void 0:I.userInfo;const de=$;D.value=ve;const fe=e=>{$=e,G.value=de===D.value,e==null&&(D.value="所有人"),k()},E=o((ee=p==null?void 0:p.tabPane)==null?void 0:ee.activeKey),pe=e=>{E.value=e,k()},k=()=>{var a,r,x,P,T,Y,M,L,j;d.value.isAfter(w.value)&&(w.value=d.value),s.value=$e((a=s==null?void 0:s.value)==null?void 0:a.trim());let e=(r=s.value)==null?void 0:r.indexOf("/j/");e<0&&(e=(x=s.value)==null?void 0:x.indexOf("/c/")),e<0&&(e=(P=s.value)==null?void 0:P.indexOf("/d/")),e>=0&&(s.value=(T=s.value)==null?void 0:T.substring(e+3)),e<0&&(e=(Y=s.value)==null?void 0:Y.indexOf("/jb/"),e>=0&&(s.value=(M=s.value)==null?void 0:M.substring(e+4)),e=(L=s.value)==null?void 0:L.indexOf("/jc/"),e>=0&&(s.value=(j=s.value)==null?void 0:j.substring(e+4))),localStorage.setItem("searchSwitch:"+p.switchName,JSON.stringify(S.value)),h("queryList",{pageNo:1,pageSize:30,startTime:d.value.startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:w.value.endOf("day").format("YYYY-MM-DD HH:mm:ss"),keyword:s.value,username:$,checked:S.value,status:E.value})},ye=()=>{C.value=!C.value,h("changeAdvanced")},Z=()=>{A.value=!0,h("confirmCopy",{count:v.value,username:$,checked:S.value})},{proxy:R}=we();return F({queryFinish:(e="")=>{v.value===1?R.tool.copy(e,e+"已复制"):R.tool.copy(e,v.value+"条已复制"),A.value=!1}}),Ce(()=>{var e;S.value=JSON.parse((e=localStorage.getItem("searchSwitch:"+p.switchName))!=null?e:"false"),k()}),(e,a)=>{var ae,te;const r=u("a-button"),x=u("a-space"),P=u("a-date-picker"),T=u("a-select-option"),Y=u("a-spin"),M=u("a-select"),L=u("a-input"),j=u("a-card"),q=u("a-col"),me=u("a-slider"),_e=u("a-popconfirm"),ge=u("a-row"),ke=u("a-tab-pane"),be=u("a-tabs");return i(),B(J,null,[n(j,{size:"small"},{default:t(()=>[xe("div",Ye,[c.showTop?(i(),B("div",Me,[n(x,{size:5,class:"mb-2"},{default:t(()=>[n(r,{type:!g.value&&y.value===365?"link":"",onClick:a[0]||(a[0]=l=>N(365,0))},{default:t(()=>[f("今年 ")]),_:1},8,["type"]),n(r,{type:!g.value&&y.value===30?"link":"",onClick:a[1]||(a[1]=l=>N(30,0))},{default:t(()=>[f(" 30天 ")]),_:1},8,["type"]),n(r,{type:!g.value&&y.value===100?"link":"",onClick:a[2]||(a[2]=l=>N(100))},{default:t(()=>[f(" 本月 ")]),_:1},8,["type"]),n(r,{type:!g.value&&y.value===1?"link":"",onClick:a[3]||(a[3]=l=>N(1,1))},{default:t(()=>[f(" 昨天 ")]),_:1},8,["type"]),n(r,{type:!g.value&&y.value===0?"link":"",onClick:a[4]||(a[4]=l=>N(0,0))},{default:t(()=>[f(" 今天 ")]),_:1},8,["type"])]),_:1}),n(Oe,{"enter-active-class":"animate__animated animate__flipInX","leave-active-class":"animate__animated animate__flipOutX animate__faster"},{default:t(()=>[V(n(x,{class:"mb-2"},{default:t(()=>[n(P,{onChange:W,allowClear:"",placeholder:"开始日期","disabled-date":ue,value:d.value,"onUpdate:value":a[5]||(a[5]=l=>d.value=l)},null,8,["value"]),n(P,{onChange:W,allowClear:"",placeholder:"结束日期","disabled-date":ie,value:w.value,"onUpdate:value":a[6]||(a[6]=l=>w.value=l)},null,8,["value"])]),_:1},512),[[H,C.value]])]),_:1})])):O("",!0),n(L,{size:"large",value:s.value,"onUpdate:value":a[8]||(a[8]=l=>s.value=l),onChange:k,placeholder:c.placeholder,allowClear:""},{prefix:t(()=>[n(r,{type:"link",onClick:ye},{default:t(()=>[C.value?(i(),m(z(Ne),{key:0})):(i(),m(z(De),{key:1}))]),_:1}),b(e.$slots,"prefix"),C.value?(i(),m(x,{key:0},{default:t(()=>[z(oe)("am:selectUser")&&c.showPeople?(i(),m(M,{key:0,size:"",loading:U.value,allowClear:"",ref:"select",value:D.value,"onUpdate:value":a[7]||(a[7]=l=>D.value=l),style:{width:"90px"},onFocus:ce,onChange:fe},Se({default:t(()=>[(i(!0),B(J,null,ne(K.value,l=>(i(),m(T,{key:l.id,value:l.username},{default:t(()=>[f(Q(l.realname),1)]),_:2},1032,["value"]))),128))]),_:2},[U.value?{name:"notFoundContent",fn:t(()=>[n(Y,{size:"small"})]),key:"0"}:void 0]),1032,["loading","value"])):O("",!0),z(Te)()?(i(),m(r,{key:1,ghost:"",type:"success",onClick:re},{default:t(()=>[f("粘贴")]),_:1})):O("",!0)]),_:1})):O("",!0)]),suffix:t(()=>[C.value?b(e.$slots,"suffixAdvanced",{key:0}):b(e.$slots,"suffixNotAdvanced",{key:1}),b(e.$slots,"suffix")]),_:3},8,["value","placeholder"])])]),_:3}),c.showCopy?(i(),m(ge,{key:0,class:"w-full mt-2"},{default:t(()=>[n(q,{span:4},{default:t(()=>[b(e.$slots,"left")]),_:3}),n(q,{span:14},{default:t(()=>[n(me,{style:{display:"inline-block"},value:v.value,"onUpdate:value":a[9]||(a[9]=l=>v.value=l),min:1,max:500},null,8,["value"])]),_:1}),n(q,{class:"text-center",span:6},{default:t(()=>[V(n(r,{onClick:Z,loading:A.value,type:X()},{default:t(()=>[f("复制"+Q(v.value)+"条 ",1)]),_:1},8,["loading","type"]),[[H,v.value===1]]),n(_e,{title:`确定复制${v.value}条吗?`,"ok-text":"确定","cancel-text":"取消",onConfirm:Z},{default:t(()=>[V(n(r,{loading:A.value,placeholder:"开始日期",type:X()},{default:t(()=>[f("复制"+Q(v.value)+"条 ",1)]),_:1},8,["loading","type"]),[[H,v.value>1]])]),_:1},8,["title"])]),_:1})]),_:3})):O("",!0),((te=(ae=p.tabPane)==null?void 0:ae.tabs)==null?void 0:te.length)>0?(i(),B("div",Le,[n(be,{animated:!1,activeKey:E.value,"onUpdate:activeKey":a[10]||(a[10]=l=>E.value=l),onTabClick:pe},{leftExtra:t(()=>[b(e.$slots,"leftTabExtra")]),rightExtra:t(()=>[b(e.$slots,"rightTabExtra")]),default:t(()=>{var l;return[(i(!0),B(J,null,ne((l=p.tabPane)==null?void 0:l.tabs,le=>(i(),m(ke,{key:le.tabKey,tab:le.tabName},null,8,["tab"]))),128))]}),_:3},8,["activeKey"])])):O("",!0)],64)}}});export{qe as _};
