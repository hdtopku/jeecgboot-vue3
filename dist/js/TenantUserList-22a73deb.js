var ke=Object.defineProperty,Se=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var se=(t,n,o)=>n in t?ke(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,ae=(t,n)=>{for(var o in n||(n={}))ve.call(n,o)&&se(t,o,n[o]);if(oe)for(var o of oe(n))xe.call(n,o)&&se(t,o,n[o]);return t},re=(t,n)=>Se(t,Ae(n));var C=(t,n,o)=>new Promise((_,c)=>{var m=s=>{try{r(o.next(s))}catch(p){c(p)}},u=s=>{try{r(o.throw(s))}catch(p){c(p)}},r=s=>s.done?_(s.value):Promise.resolve(s.value).then(m,u);r((o=o.apply(t,n)).next())});import Ce from"./BasicTable-e53fa5dc.js";import{Q as Ue}from"./componentMap-d4bccc5b.js";import"./useTable-abb474dc.js";import{b as de,aX as ie,u as ye,D as fe,t as Ie,U as Le}from"./jeecg-online-vendor-231813f7.js";import{d as O,e as X,V as B,a5 as g,a9 as S,a7 as l,f as i,E as T,ab as E,W as Q,k as D,q as z,a6 as q,ag as le,ah as ce,F as ue,o as Me,u as a,aa as pe}from"./vue-5a09445c.js";import{M as K,cG as Re}from"./antd-vue-vendor-e4fda4cf.js";import{_ as Be}from"./UserQuitAgentModal.vue_vue_type_script_setup_true_name_user-quit-agent-modal_lang-6f739442.js";import Ee from"./UserQuitModal-6ab33b93.js";import{a as De}from"./index-0afd802b.js";import{useListPage as $e}from"./useListPage-37055c1f.js";import"./index-156cafb7.js";import{x as Fe,y as Ne}from"./user.api-54300816.js";import{u as je,e as ze}from"./user.data-4c699218.js";import{U as Qe}from"./JSelectUser-71a05f8d.js";import{j as Oe}from"./UserSetting.api-11741bdd.js";import{m as Pe}from"./tenant.api-9f2ccaf7.js";import He from"./TenantUserDrawer-f0f5cec1.js";import{z as V,_ as Ke}from"./index-ebe32d90.js";import"./BasicTable.vue_vue_type_style_index_0_lang-80d59b16.js";import"./BasicForm-202637f7.js";import"./BasicForm.vue_vue_type_style_index_0_lang-b507e110.js";import"./lodash-es-vendor-3f622b6f.js";import"./BasicModal-4736e0c2.js";import"./useWindowSizeFn-090d6233.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./useForm-b308f6ee.js";import"./JAddInput-b2310633.js";import"./areaDataUtil-8b7c0164.js";import"./useFormItem-9ad9dd7f.js";import"./props-070e4759.js";import"./JSelectBiz-8d24dfc4.js";import"./index-0644f043.js";import"./index-64029d3c.js";import"./bem-a05115ab.js";import"./props-1156b2b9.js";import"./useContextMenu-695a8028.js";import"./depart.api-125ba91d.js";import"./JSelectDept-1f595344.js";import"./JPopup-2fd87e0d.js";import"./cron-parser-vendor-f28c5d73.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-b03a3f81.js";import"./injectionKey-69710956.js";/* empty css              */import"./download-b10715e6.js";import"./base64Conver-fa2fe1af.js";import"./index-ca8ee4d9.js";import"./index-3e837de3.js";import"./useCountdown-1a556b94.js";import"./useFormItemSingle-2e069e0c.js";import"./JUpload.vue_vue_type_style_index_0_lang-5fe736b1.js";import"./index-a66c1701.js";import"./index-afd7fbfc.js";import"./validator-99b371bc.js";import"./renderUtils-9bf750c9.js";import"./tenant.data-9b6cb136.js";const ge={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let J=null;const Ve=()=>C(void 0,null,function*(){if(J!=null)return ie(J);{let{success:t,result:n}=yield de.get({url:ge.getEnabledType},{isTransformResponse:!1});if(t)return J=ie(n),n}return{}}),me=O({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(t,{emit:n}){const o=t,_=X(()=>o.type==="wechatEnterprise"?!1:o.syncToLocal);function c(m){n(m.key,{type:o.type})}return(m,u)=>{const r=B("a-button"),s=B("a-menu-item"),p=B("a-menu"),A=B("a-dropdown");return t.syncToApp&&t.syncToLocal?(g(),S(A,{key:0},{overlay:l(()=>[i(p,{onClick:c},{default:l(()=>[t.syncToApp?(g(),S(s,{key:"to-app"},{default:l(()=>[T("同步到"+E(t.name),1)]),_:1})):Q("",!0),_.value?(g(),S(s,{key:"to-local"},{default:l(()=>[T("同步到本地")]),_:1})):Q("",!0)]),_:1})]),default:l(()=>[i(r,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})]),_:1})):t.syncToApp?(g(),S(r,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:u[0]||(u[0]=U=>c({key:"to-app"}))},{default:l(()=>[T("同步"+E(t.name),1)]),_:1})):(g(),S(r,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:u[1]||(u[1]=U=>c({key:"to-local"}))},{default:l(()=>[T("同步"+E(t.name)+"到本地",1)]),_:1}))}}}),Je=O({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(t,{emit:n}){const o=t,{createMessage:_,createWarningModal:c}=ye(),m=D({}),u=X(()=>({syncToApp:o.syncToApp,syncToLocal:o.syncToLocal})),r=X(()=>({"to-app":s,"to-local":p}));function s(d){U(d.type,"/toApp")}function p(d){U(d.type,"/toLocal")}function A(){return C(this,null,function*(){m.value=yield Ve()})}function U(d,h){let I=ge[d];if(!(I&&I[o.bizType]))return;let k=I[o.bizType]+h,v=o.selectedRowKeys,F="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(v)&&v.length>0?F=`确定要开始同步这 ${v.length} 项吗？`:v=[],new Promise((P,G)=>{const N=K.confirm({icon:i(Re),title:"同步",content:F,onOk:()=>{N.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let H={ids:v.join(",")};return de.get({url:k,params:H},{isTransformResponse:!1}).then(y=>{let w={};y.result&&(w={width:600,title:y.message,content:()=>{let L,j=["成功信息如下：",$(z,y.result.successInfo.map((M,R)=>`${R+1}. ${M}`).join(`
`))];return y.success?L=[...j,z("br"),"无失败信息！"]:L=["失败信息如下：",$(z,y.result.failInfo.map((M,R)=>`${R+1}. ${M}`).join(`
`)),z("br"),...j],L}}),y.success?(w!=null?K.success(w):_.warning(y.message),n("sync-ok")):(w!=null?K.warning(w):_.warning(y.message),n("sync-error"))}).catch(()=>N.destroy()).finally(()=>{P(),n("sync-finally",{type:d,direction:h,isToApp:h==="/toApp",isToLocal:h==="/toLocal"})})},onCancel(){P()}})})}function $(d,h){return d("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},h)}return A(),(d,h)=>t.syncToApp||t.syncToLocal?(g(),q(ue,{key:0},[m.value.wechatEnterprise?(g(),S(me,le({key:0,type:"wechatEnterprise",name:"企微"},u.value,ce(r.value)),null,16)):Q("",!0),m.value.dingtalk?(g(),S(me,le({key:1,type:"dingtalk",name:"钉钉"},u.value,ce(r.value)),null,16)):Q("",!0)],64)):(g(),q(ue,{key:1},[T("未设置任何同步方向")],64))}});const Xe=fe(Je,[["__scopeId","data-v-d8023e59"]]),qe={style:{"margin-left":"10px","margin-top":"5px"}},Ge={class:"tenant-name"},We=O({name:"tenant-system-user"}),Ye=O(re(ae({},We),{setup(t){const{createMessage:n,createConfirm:o}=ye(),[_,{openDrawer:c}]=De(),[m,{openModal:u}]=V(),[r,{openModal:s}]=V(),p=Ie(),A=p.getUserInfo.username,{prefixCls:U,tableContext:$,onExportXls:d,onImportXls:h}=$e({designScope:"user-list",tableProps:{title:"租户用户列表",api:Fe,columns:je,size:"small",formConfig:{schemas:ze},actionColumn:{width:120},beforeFetch:e=>(e.userTenantStatus="1,3,4",Object.assign({column:"createTime",order:"desc"},e))}}),[I,{reload:k,updateTableDataRecord:v},{rowSelection:F,selectedRows:P,selectedRowKeys:G}]=$;function N(){c(!0,{isUpdate:!1,showFooter:!0,tenantSaas:!0})}function H(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!0,tenantSaas:!0})})}function y(e){return C(this,null,function*(){c(!0,{record:e,isUpdate:!0,showFooter:!1,tenantSaas:!0})})}function w(){k()}function L({isToLocal:e}){e&&k()}function j(e){return[{label:"编辑",onClick:H.bind(null,e)}]}function M(e){return[{label:"详情",onClick:y.bind(null,e)},{label:"离职",onClick:R.bind(null,e.id),ifShow:()=>e.status==="1"&&e.username!==e.createBy},{label:"交接",onClick:he.bind(null,e),ifShow:()=>e.username===e.createBy},{label:"同意",onClick:W.bind(null,e.id,"1"),ifShow:()=>(e.status==="3"||e.status==="4")&&e.createBy===A},{label:"拒绝",popConfirm:{title:"是否确认拒绝",confirm:W.bind(null,e.id,"4")},ifShow:()=>e.status==="3"&&e.createBy===A}]}function R(e,f){u(!0,{userName:e,userId:f})}function W(e,f){Ne({userId:e,status:f}).then(b=>{b.success&&w()}).catch(b=>{n.warning(b.message)})}const Y=D(""),Z=D([]),[Te,{openModal:_e}]=V(),ee=D("");function he(e){Y.value=Le(),Z.value=[e.id],ee.value=e.createBy,_e(!0)}function we(e,f){if(f&&f.length>0){let b=f[0];Oe({userId:b,tenantId:a(Y)}).then(x=>{var ne;x.success?(n.success("交接成功"),((ne=p.userInfo)==null?void 0:ne.username)==ee.value?p.logout(!0):k()):n.warning(x.message)})}}const te=D("");be();function be(){return C(this,null,function*(){te.value=yield Pe()})}return Me(()=>{Ke("租户用户")}),(e,f)=>{const b=B("a-button");return g(),q("div",null,[i(a(Ce),{onRegister:a(I),rowSelection:a(F)},{tableTitle:l(()=>[i(b,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:N},{default:l(()=>[T(" 新增")]),_:1}),i(Xe,{"biz-type":"user","selected-row-keys":a(G),syncToApp:"",syncToLocal:"",onSyncFinally:L},null,8,["selected-row-keys"]),i(b,{type:"primary",onClick:f[0]||(f[0]=x=>a(s)(!0,{})),preIcon:"ant-design:user-delete-outlined"},{default:l(()=>[T("离职信息")]),_:1}),pe("div",qe,[T(" 当前登录租户: "),pe("span",Ge,E(te.value),1)])]),action:l(({record:x})=>[i(a(Ue),{actions:j(x),dropDownActions:M(x)},null,8,["actions","dropDownActions"])]),_:1},8,["onRegister","rowSelection"]),i(He,{onRegister:a(_),onSuccess:w},null,8,["onRegister"]),i(Be,{onRegister:a(m),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(Ee,{onRegister:a(r),onSuccess:a(k)},null,8,["onRegister","onSuccess"]),i(Qe,{onRegister:a(Te),excludeUserIdList:Z.value,maxSelectCount:1,onGetSelectResult:we},null,8,["onRegister","excludeUserIdList"])])}}}));const an=fe(Ye,[["__scopeId","data-v-c779c610"]]);export{an as default};
