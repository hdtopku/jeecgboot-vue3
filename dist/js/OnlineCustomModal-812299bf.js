import{B as K}from"./index-8cf3aabb.js";import{g as O}from"./useExtendComponent-f3ffbcdf.js";import{bW as Q,ad as W,b_ as J}from"./jeecg-online-vendor-bf2efbcb.js";import{O as X}from"./OnlineForm-3b49fa3a.js";import"./componentMap-a6d21ad6.js";import{A as Y}from"./index-fde9c72f.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./antd-vue-vendor-1561c1ba.js";import"./JAddInput-2cbbbde9.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-0a69d004.js";import"./pick-51214243.js";import"./_flatRest-34ab130c.js";import"./isArray-b183d537.js";import"./toString-8deea73b.js";import"./_arrayPush-ae8b790e.js";import"./BasicTable.vue_vue_type_style_index_0_lang-b7d11241.js";import"./useTable-7e303edd.js";import"./LinkTableListPiece-50f8f8cc.js";import"./OnlineSelectCascade-dee0bae8.js";import"./omit-13df237f.js";import"./_baseClone-632ebf1c.js";import{d as Z,k as i,w as x,r as oo,n as M,a4 as eo,az as to,U as F,aV as b,ar as k,bi as c,f as B,E as P,a$ as no,aQ as ro}from"./vue-c7e3516e.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm-83ba9c88.js";import"./useForm-fa63344e.js";import"./user.api-dd1b3184.js";import"./_commonjsHelpers-938fab4e.js";import"./customExpression-e22f3cce.js";import"./BasicTable-29c6504d.js";import"./useFormItem-4a12ff45.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./index-ed4be6fa.js";import"./injectionKey-5da932b3.js";import"./useListPage-5049b37a.js";import"./JModalTip-b651c0e6.js";import"./_baseSlice-834c0c3e.js";var d=(o,f,r)=>new Promise((m,u)=>{var p=t=>{try{s(r.next(t))}catch(l){u(l)}},a=t=>{try{s(r.throw(t))}catch(l){u(l)}},s=t=>t.done?m(t.value):Promise.resolve(t.value).then(p,a);s((r=r.apply(o,f)).next())});const io={code:"",title:"\u81EA\u5B9A\u4E49\u5F39\u6846",width:600,row:{},hide:[],show:[],requestUrl:"",tableType:"",foreignKeys:"",formComponent:""},mo=Z({name:"OnlineCustomModal",components:{OnlineForm:X,BasicModal:K},setup(o,{emit:f}){const r=i(),m=i(""),u=i("\u81EA\u5B9A\u4E49\u5F39\u6846"),p=i(600);let a=[],s=[],t="",l={};const _={loadFormItems:"/online/cgform/api/getFormItem/",optPre:"/online/cgform/api/form/"},T={position:"relative"},A=i(!1),v=i(!1);function D(){v.value=!0}const h=i(!0),[I,{setModalProps:$,closeModal:S}]=Y(e=>d(this,null,function*(){$({confirmLoading:!1}),N(e),yield M(()=>d(this,null,function*(){e.formComponent?G(e.formComponent):yield H()}))}));function N(e){let n=Object.assign({},io,e);m.value=n.code,u.value=n.title,p.value=n.width,a=n.hide||[],s=n.show||[],t=L(n.requestUrl),l=n.row}function L(e){return e||_.optPre+m.value}const w=i(!1);function U(){w.value=!0,h.value===!0?r.value.handleSubmit():E.value.handleSubmit(),setTimeout(()=>{w.value=!0},3500)}function V(){S()}function j(e){f("success",e),S()}function H(){return d(this,null,function*(){h.value=!0,yield O(v),r.value.handleCustomFormSh(s,a),r.value.handleCustomFormEdit(l,t)})}const R=i(1);x(m,q,{immediate:!0});function q(){return d(this,null,function*(){if(v.value=!1,!m.value)return;let e=yield z(),n=e.head.formTemplate;R.value=n?Number(n):1,M(()=>d(this,null,function*(){(yield O(r)).createRootProperties(e)}))})}function z(){let e=`/online/cgform/api/getFormItem/${m.value}`;return new Promise((n,y)=>{W.get({url:e},{isTransformResponse:!1}).then(g=>{g.success?n(g.result):y(g.message)}).catch(()=>{y()})})}const E=i(),C=oo({url:"",is:"",row:{}});function G(e){h.value=!1,C.url=t,C.row=l,C.is=eo(to(()=>J(e)))}return{registerModal:I,title:u,width:p,modalStyle:T,handleSubmit:U,handleCancel:V,id:m,onlineFormCompRef:r,formTemplate:R,renderSuccess:D,customFormRef:E,customFormComponent:C,open,isOnlineForm:h,confirmLoading:A,submitLoading:w,handleSuccess:j}}});function lo(o,f,r,m,u,p){const a=F("a-button"),s=F("online-form"),t=F("a-spin"),l=F("BasicModal");return b(),k(l,ro({title:o.title,width:o.width},o.$attrs,{style:o.modalStyle,onRegister:o.registerModal,wrapClassName:"jeecg-online-modal2",onOk:o.handleSubmit}),{footer:c(()=>[B(a,{key:"submit",type:"primary",onClick:o.handleSubmit},{default:c(()=>[P("\u786E\u5B9A")]),_:1},8,["onClick"]),B(a,{key:"back",onClick:o.handleCancel},{default:c(()=>[P("\u5173\u95ED")]),_:1},8,["onClick"])]),default:c(()=>[B(t,{spinning:o.confirmLoading},{default:c(()=>[o.isOnlineForm?(b(),k(s,{key:0,ref:"onlineFormCompRef",id:o.id,"form-template":o.formTemplate,onRendered:o.renderSuccess,onSuccess:o.handleSuccess,modalClass:"jeecg-online-modal2"},null,8,["id","form-template","onRendered","onSuccess"])):(b(),k(no(o.customFormComponent.is),{key:1,ref:"customFormRef",url:o.customFormComponent.url,row:o.customFormComponent.row,onClose:o.handleSuccess},null,40,["url","row","onClose"]))]),_:1},8,["spinning"])]),_:1},16,["title","width","style","onRegister","onOk"])}var de=Q(mo,[["render",lo]]);export{de as default};
