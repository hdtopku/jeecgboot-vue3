import{ad as C,bW as b,l as w}from"./jeecg-online-vendor-12004772.js";import{d as O,k as p,w as y,U as F,aV as v,ar as _,bi as E,as as D,F as $,a_ as V,at as k,ag as T}from"./vue-c7e3516e.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";var P=(t,i,u)=>new Promise((d,a)=>{var g=n=>{try{r(u.next(n))}catch(s){a(s)}},f=n=>{try{r(u.throw(n))}catch(s){a(s)}},r=n=>n.done?d(n.value):Promise.resolve(n.value).then(g,f);r((u=u.apply(t,i)).next())});const S="/online/cgform/api/querySelectOptions",N=O({name:"OnlineSelectCascade",props:{table:{type:String,default:""},txt:{type:String,default:""},store:{type:String,default:""},idField:{type:String,default:""},pidField:{type:String,default:""},pidValue:{type:String,default:"-1"},origin:{type:Boolean,default:!1},condition:{type:String,default:""},value:{type:String,default:""},isNumber:{type:Boolean,default:!1},placeholder:{type:String,default:"\u8BF7\u9009\u62E9"}},emits:["change","next"],setup(t,{emit:i}){const{createMessage:u}=w(),d=p(""),a=p([]),g=p(!0);function f(e){let l=e||"";i("change",l),h(l)}y(()=>t.condition,e=>{g.value=!0,e&&n()},{immediate:!0}),y(()=>t.pidValue,e=>{e==="-1"?a.value=[]:n()}),y(()=>t.value,(e,l)=>{e?d.value=e:(d.value=[],l&&(i("change",""),i("next","-1"))),e&&!l&&r(e)},{immediate:!0});function r(e){return P(this,null,function*(){if(t.idField===t.store)i("next",e);else if(t.origin===!0)yield x(),h(e);else{let l=yield B();h(e,l)}})}function n(){let e=s();t.origin===!0?e.condition=t.condition:e.pidValue=t.pidValue,a.value=[],C.get({url:S,params:e},{isTransformResponse:!1}).then(l=>{l.success?a.value=[...l.result]:u.warning("\u8054\u52A8\u7EC4\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25,\u8BF7\u68C0\u67E5\u914D\u7F6E!")})}function s(){return{table:t.table,txt:t.txt,key:t.store,idField:t.idField,pidField:t.pidField}}function B(){return new Promise(e=>{if(!t.value)d.value=[],e([]);else{let l=s();t.isNumber===!0?l.condition=`${t.store} = ${t.value}`:l.condition=`${t.store} = '${t.value}'`,C.get({url:S,params:l},{isTransformResponse:!1}).then(o=>{o.success?e(o.result):(u.warning("\u8054\u52A8\u7EC4\u4EF6\u6570\u636E\u52A0\u8F7D\u5931\u8D25,\u8BF7\u68C0\u67E5\u914D\u7F6E!"),e([]))})}})}function x(){return new Promise(e=>{(function o(c){c>10&&e([]);let m=a.value;m&&m.length>0?e(m):setTimeout(()=>{o(c++)},300)})(0)})}function h(e,l=[]){if(e&&e.length>0){(!l||l.length==0)&&(l=a.value);let o=l.filter(c=>c.store===e);if(o&&o.length>0){let c=o[0].id;i("next",c)}}}return{selectedValue:d,dictOptions:a,handleChange:f}}}),A=["title"];function L(t,i,u,d,a,g){const f=F("a-select-option"),r=F("a-select");return v(),_(r,{placeholder:t.placeholder,value:t.selectedValue,onChange:t.handleChange,allowClear:"",style:{width:"100%"}},{default:E(()=>[(v(!0),D($,null,V(t.dictOptions,(n,s)=>(v(),_(f,{key:s,value:n.store},{default:E(()=>[k("span",{style:{display:"inline-block",width:"100%"},title:n.label},T(n.label),9,A)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onChange"])}var I=b(N,[["render",L]]);export{I as default};
