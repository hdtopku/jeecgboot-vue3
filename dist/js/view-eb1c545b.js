var T=Object.defineProperty,q=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var y=(n,o,a)=>o in n?T(n,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[o]=a,k=(n,o)=>{for(var a in o||(o={}))M.call(o,a)&&y(n,a,o[a]);if(I)for(var a of I(o))$.call(o,a)&&y(n,a,o[a]);return n},x=(n,o)=>q(n,B(o));var g=(n,o,a)=>new Promise((f,d)=>{var r=e=>{try{s(a.next(e))}catch(p){d(p)}},c=e=>{try{s(a.throw(e))}catch(p){d(p)}},s=e=>e.done?f(e.value):Promise.resolve(e.value).then(r,c);s((a=a.apply(n,o)).next())});import{k as w,d as C,bF as L,bE as V,w as H,U as P,aV as S,as as A,f as F,u as R}from"./vue-c7e3516e.js";import{q as N}from"./page.api-265971d0.js";import{aq as W,E as b}from"./index-fde9c72f.js";import"./index-8cf3aabb.js";import{c as j,ac as G,aH as J,_ as K}from"./jeecg-online-vendor-bf2efbcb.js";import{r as Q}from"./html2canvas-vendor-654dcb8a.js";import"./lodash-es-vendor-42c8d3d4.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";var X=Q();function Y(){const n=w();function o(d){let r=n.value;if(!r)return;const c={width:r.offsetWidth,height:r.offsetHeight};X(r,{useCORS:!0,logging:!0}).then(s=>g(this,null,function*(){const e=s.toDataURL("image/png");yield a(e,c,d)}))}function a(d,r,c){return g(this,null,function*(){const s=yield f(d,r),e=document.createElement("a");e.href=s,e.download=`${c}.png`,e.click()})}function f(d,r){return new Promise(c=>{let s=document.createElement("canvas");const e=s.getContext("2d"),p=new Image;p.crossOrigin="Anonymous",p.src=d,p.onload=()=>{s.height=r.height,s.width=r.width,e.drawImage(p,0,0,r.width,r.height);const v=s.toDataURL("image/png");s=null,c(v)}})}return{exportRef:n,onExportImage:o}}const Z=C({name:"drag-page-view"}),z=C(x(k({},Z),{props:{routeInfo:{type:Object,default:()=>{}}},emits:["loadOk"],setup(n,{emit:o}){const a=n,{setTitle:f}=W();j();const d=w(""),{currentRoute:r,push:c,resolve:s}=L(),e=w({name:"",coverUrl:"",backgroundColor:"",theme:"default",style:"default",designType:100,backgroundImage:"",componentData:[]});function p(){return g(this,null,function*(){const{params:t,path:i}=R(r);let u=t.id?t.id:i.substr(i.lastIndexOf("/")+1);d.value=u;const l=yield N({id:u});if(l.success){yield f(l.result.name);let m=l.result.template?JSON.parse(l.result.template):[];e.value.componentData=m,e.value.name=l.result.name,e.value.coverUrl=l.result.coverUrl,e.value.backgroundColor=l.result.backgroundColor,e.value.backgroundImage=l.result.backgroundImage,e.value.designType=l.result.designType,e.value.theme=l.result.theme||"default",e.value.style=l.result.style||"default"}})}function v(t,i){t&&t.indexOf("http")>-1?J(t):c({path:t,query:i})}b();const[ee,{openModal:E}]=b(),h=V();function _(t,i){if(i.openMode==="2"){let u=s(t);window.open(u.href,"_blank")}else c(t)}function U(t){let i=t.operationType;if(i=="1"){let u={mode:"add",desformCode:t.worksheet.value,dataId:null,isOnline:!1,viewId:"",lowAppId:h.params.appId};E(!0,u)}else if(i=="2"){let u=h.params.appId,l=t.worksheet.value,m={path:`/myapp/${u}/desform/${l}`};t.view&&(m.query={view:t.view}),_(m,t)}else if(i=="3"){let u=h.params.appId,l=t.customPage.value,m={path:`/myapp/${u}/drag/${l}`};_(m,t)}}const{exportRef:D,onExportImage:O}=Y();return H(()=>a.routeInfo,t=>{if(t&&t.exportImage){let i=e.value.name;O(i)}},{deep:!0,immediate:!0}),p(),(t,i)=>{const u=P("ViewEngine");return S(),A("div",{ref_key:"exportRef",ref:D},[F(u,{dragData:e.value,token:R(G)(),onGo:v,onBtnClick:U},null,8,["dragData","token"])],512)}}}));const ve=K(z,[["__scopeId","data-v-9cdbf309"]]);export{ve as default};
