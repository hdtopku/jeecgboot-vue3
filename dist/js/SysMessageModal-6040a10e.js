var z=(D,i,m)=>new Promise((e,f)=>{var y=o=>{try{s(m.next(o))}catch(h){f(h)}},p=o=>{try{s(m.throw(o))}catch(h){f(h)}},s=o=>o.done?e(o.value):Promise.resolve(o.value).then(y,p);s((m=m.apply(D,i)).next())});import{B as X}from"./index-cd2db611.js";import{D as Y}from"./jeecg-online-vendor-ecddc31b.js";import{B as Z,z as P}from"./index-b03d7914.js";import"./componentMap-bab84cb7.js";import"./BasicForm.vue_vue_type_style_index_0_lang-2cb51a2e.js";import{aM as $,aH as ee,aN as ae,aO as te,ak as se}from"./antd-vue-vendor-a78909e6.js";import"./JAddInput-903fbbea.js";import{n as oe,U as le}from"./JSelectUser-14c3fad5.js";import"./JSelectDept-56a87299.js";import"./JPopup-d3d151eb.js";import"./cron-parser-vendor-d9194a40.js";import ne from"./SysMessageList-3ea028e0.js";import re from"./DetailModal-aa88c43a.js";import{k as u,r as O,e as F,V as c,a5 as g,a6 as v,f as n,a7 as d,aa as t,am as K,an as ie,ab as T,a9 as N,F as V,a8 as ce,W as de,u as me}from"./vue-bcbaddf9.js";import"./BasicModal-951c06ee.js";import"./useWindowSizeFn-13ef0f26.js";import"./tinymce-vendor-676f8393.js";import"./vxe-table-vendor-9edfd3ae.js";import"./lodash-es-vendor-9b741fb8.js";import"./echarts-vendor-6c8e2159.js";import"./useFormItem-4b66c33c.js";import"./JUpload.vue_vue_type_style_index_0_lang-9cbd44e9.js";import"./download-85c9438d.js";import"./base64Conver-fa2fe1af.js";import"./index-a284b6b4.js";import"./index-1938c9ba.js";import"./useCountdown-056f8acb.js";import"./index-5ded5f19.js";import"./areaDataUtil-661e31ab.js";import"./props-39e7c6b5.js";import"./JSelectBiz-f0398a38.js";import"./index-7371f95b.js";import"./codemirror-vendor-7570b8a9.js";import"./index-92741691.js";import"./bem-a44c7591.js";import"./props-c7c3390f.js";import"./useContextMenu-5e57fefa.js";import"./depart.api-79bf685d.js";import"./useSysMessage-4f1ecbda.js";const fe={name:"SysMessageModal",components:{BasicModal:X,FilterOutlined:$,CloseOutlined:ee,BellFilled:ae,ExclamationOutlined:te,JSelectUser:oe,SysMessageList:ne,UserSelectModal:le,PlusOutlined:se,DetailModal:re},emits:["register","refresh"],setup(D,{emit:i}){const m=u(),e=u(),f=u("all");function y(a,l){f.value=l,o()}function p(a){f.value=a}const s=O({fromUser:"",realname:"",rangeDateKey:"",rangeDate:[]});function o(){let a={fromUser:s.fromUser,rangeDateKey:s.rangeDateKey,rangeDate:s.rangeDate};f.value=="all"?m.value.reload(a):e.value.reload(a)}const[h,{closeModal:b}]=Z(()=>z(this,null,function*(){o()})),k=u(!1);function C(a,l){k.value=!0}const _=O([{key:"jt",text:"今天",active:!1},{key:"zt",text:"昨天",active:!1},{key:"qt",text:"前天",active:!1},{key:"bz",text:"本周",active:!1},{key:"sz",text:"上周",active:!1},{key:"by",text:"本月",active:!1},{key:"sy",text:"上月",active:!1},{key:"zdy",text:"自定义",active:!1}]);function M(a){for(let l of _)l.key!=a.key&&(l.active=!1);a.active=!a.active,a.active==!1?s.rangeDateKey="":s.rangeDateKey=a.key,a.key=="zdy"?a.active==!1&&(s.rangeDate=[],o()):o()}const x=F(()=>{let a=_.filter(l=>l.active==!0);return!!(a&&a.length>0&&a[0].text=="自定义")}),S=u([]);function R(a,l){s.rangeDate=[...l],o()}function r(a){i("refresh",a)}const B=F(()=>{const{fromUser:a,rangeDateKey:l,realname:W}=s;if(!a&&!l)return"";let U=[];if(a&&U.push(W),l){let w=_.filter(Q=>Q.key==l);w&&w.length>0&&U.push(w[0].text)}return U.join("、")}),[j,{openModal:A}]=P();function E(a,l){a&&a.length>0&&(s.fromUser=l,s.realname=a[0].label)}function G(){A(!0,{})}function L(){s.fromUser="",s.realname=""}function q(){s.fromUser="",s.realname="",s.rangeDateKey="",s.rangeDate=[];for(let a of _)a.active=!1}const[H,{openModal:I}]=P();function J(a){I(!0,{record:me(a),isUpdate:!0})}return{conditionStr:B,regModal:j,getSelectedUser:E,openSelectPerson:G,clearSearchParamsUser:L,clearAll:q,registerModal:h,activeKey:f,handleChangePanel:p,handleChangeTab:y,showSearch:k,searchParams:s,handleChangeSearchPerson:C,dateTags:_,handleClickDateTag:M,showRangeDate:x,searchRangeDate:S,handleChangeSearchDate:R,closeModal:b,hrefThenClose:r,allMessageRef:m,starMessageRef:e,registerDetail:H,showDetailModal:J}}},_e={class:"sys-msg-modal-title"},ge=t("div",{class:"title"},null,-1),pe={class:"ant-tabs-nav-wrap"},he={class:"ant-tabs-nav-scroll"},ve={class:"ant-tabs-nav ant-tabs-nav-animated"},ue={class:"icon-right"},ye={class:"icons"},be=t("span",{class:"search-label"},"回复、提到我的人?：",-1),ke={style:{display:"inline-block"}},Ce={key:0,class:"selected-user"},De={class:"clear-user-icon"},Me={class:"search-date"},xe=t("div",{class:"date-label"},"时间：",-1),Se={class:"date-tags"},Re={class:"tags-container"},Ue=["onClick"],we={key:0,class:"cust-range-date"},Ke={key:0,class:"anticon filtera"},Te={style:{"font-size":"12px","margin-left":"3px"}},Be={style:{display:"flex",margin:"0 5px"}},ze={class:"sys-message-card"},Pe=t("div",null,null,-1);function Oe(D,i,m,e,f,y){const p=c("close-outlined"),s=c("plus-outlined"),o=c("a-button"),h=c("a-range-picker"),b=c("filter-outlined"),k=c("a-popover"),C=c("sys-message-list"),_=c("a-tab-pane"),M=c("a-tabs"),x=c("BasicModal"),S=c("user-select-modal"),R=c("DetailModal");return g(),v(V,null,[n(x,{canFullscreen:!1,draggable:!1,closable:!1,onRegister:e.registerModal,wrapClassName:"sys-msg-modal",width:800,footer:null,destroyOnClose:""},{title:d(()=>[t("div",_e,[ge,t("div",pe,[t("div",he,[t("div",ve,[t("div",null,[t("div",{onClick:i[0]||(i[0]=r=>e.handleChangeTab(r,"all")),role:"tab","aria-disabled":"false","aria-selected":"false",class:K(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="all"}])}," 全部消息 ",2),t("div",{onClick:i[1]||(i[1]=r=>e.handleChangeTab(r,"star")),role:"tab","aria-disabled":"false","aria-selected":"true",class:K(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="star"}])}," 标星消息 ",2)]),t("div",{class:"ant-tabs-ink-bar ant-tabs-ink-bar-animated",style:ie({transform:e.activeKey=="all"?"translate3d(0px, 0px, 0px)":"translate3d(120px, 0px, 0px)",display:"block",width:"88px"})},null,4)])])]),t("div",ue,[t("div",ye,[n(k,{placement:"bottomRight",overlayStyle:{width:"400px"},trigger:"click",visible:e.showSearch,"onUpdate:visible":i[3]||(i[3]=r=>e.showSearch=r)},{content:d(()=>[t("div",null,[be,t("span",ke,[e.searchParams.fromUser?(g(),v("div",Ce,[t("span",null,T(e.searchParams.realname),1),t("span",De,[n(p,{style:{"font-size":"12px"},onClick:e.clearSearchParamsUser},null,8,["onClick"])])])):(g(),N(o,{key:1,type:"dashed",shape:"circle",onClick:e.openSelectPerson},{default:d(()=>[n(s)]),_:1},8,["onClick"]))])]),t("div",Me,[xe,t("div",Se,[t("div",Re,[(g(!0),v(V,null,ce(e.dateTags,r=>(g(),v("div",{class:K(r.active==!0?"tag active":"tag"),onClick:B=>e.handleClickDateTag(r)},T(r.text),11,Ue))),256))]),e.showRangeDate?(g(),v("div",we,[n(h,{value:e.searchRangeDate,"onUpdate:value":i[2]||(i[2]=r=>e.searchRangeDate=r),onChange:e.handleChangeSearchDate},null,8,["value","onChange"])])):de("",!0)])])]),default:d(()=>[e.conditionStr?(g(),v("span",Ke,[n(b),t("span",Te,T(e.conditionStr),1),t("span",Be,[n(p,{style:{"font-size":"12px"},onClick:e.clearAll},null,8,["onClick"])])])):(g(),N(b,{key:1}))]),_:1},8,["visible"]),n(p,{onClick:e.closeModal},null,8,["onClick"])])])])]),default:d(()=>[t("div",ze,[n(M,{activeKey:e.activeKey,center:"",onTabClick:e.handleChangePanel},{renderTabBar:d(()=>[Pe]),default:d(()=>[n(_,{tab:"全部消息",key:"all",forceRender:""},{default:d(()=>[n(C,{ref:"allMessageRef",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["onClose","onDetail"])]),_:1}),n(_,{tab:"标星消息",key:"star",forceRender:""},{default:d(()=>[n(C,{ref:"starMessageRef",star:"",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["onClose","onDetail"])]),_:1})]),_:1},8,["activeKey","onTabClick"])])]),_:1},8,["onRegister"]),n(S,{isRadioSelection:"",showButton:!1,labelKey:"realname",rowKey:"username",onRegister:e.regModal,onGetSelectResult:e.getSelectedUser},null,8,["onRegister","onGetSelectResult"]),n(R,{onRegister:e.registerDetail},null,8,["onRegister"])],64)}const Ca=Y(fe,[["render",Oe]]);export{Ca as default};
