var ce=Object.defineProperty;var W=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var X=(t,s,l)=>s in t?ce(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,H=(t,s)=>{for(var l in s||(s={}))re.call(s,l)&&X(t,l,s[l]);if(W)for(var l of W(s))ie.call(s,l)&&X(t,l,s[l]);return t};var O=(t,s,l)=>new Promise((e,d)=>{var U=i=>{try{u(l.next(i))}catch(m){d(m)}},f=i=>{try{u(l.throw(i))}catch(m){d(m)}},u=i=>i.done?e(i.value):Promise.resolve(i.value).then(U,f);u((l=l.apply(t,s)).next())});import{bk as $,C as P,aG as de,bl as ue,bm as fe,b as F,s as _e}from"./jeecg-online-vendor-e26fc0e5.js";import{g as ee,B as ye,z as pe}from"./index-ea73cedc.js";import{B as me}from"./index-9c776ac3.js";import{e as R,r as he,s as ve,J as G,U as r,a5 as y,a9 as k,a7 as S,f as p,aa as I,an as E,ab as N,a6 as T,V as B,k as x,w as J,E as Z,F as j,a8 as V,am as q,d as ge}from"./vue-705b7309.js";import{m as te,$ as Se,cY as Ue,V as xe,cg as Le}from"./antd-vue-vendor-cce59da1.js";const Ie={name:"UserList",props:{dataList:{type:Array,default:()=>[]},depart:{type:Boolean,default:!1},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]}},components:{UserOutlined:$},emits:["selected","unSelect"],setup(t,{emit:s}){function l(a,g){a&&i(a),u[g.id]===!0?s("unSelect",g.id):s("selected",G(g))}function e(a){return a?a.substr(0,2):""}const d=R(()=>t.depart===!0?{flex:1}:{display:"none"}),U=R(()=>t.depart===!0?{width:"200px"}:{flex:1});function f(a){}const u=he({});ve(()=>{let a=t.dataList;if(!a||a.length===0)return;let g=t.selectedIdList;for(let h of a)g.indexOf(h.id)>=0?u[h.id]=!0:u[h.id]=!1});function i(a){a.preventDefault(),a.stopPropagation()}function m(){let a=[],g=t.excludeUserIdList,h=t.dataList;if(h&&h.length>0)for(let L of h)g.indexOf(L.id)<0&&a.push(H({},L));return a}const v=R(()=>{let a=t.excludeUserIdList;return a&&a.length>0?m():t.dataList});return{onClickUser:l,getTwoText:e,departStyle:d,nameStyle:U,onChangeChecked:f,checkStatus:u,showDataList:v,getFileAccessHttpUrl:ee}}};const Ce=["onClick"];function ke(t,s,l,e,d,U){const f=r("a-checkbox"),u=r("a-avatar"),i=r("UserOutlined"),m=r("a-list-item"),v=r("a-list");return y(),k(v,{"item-layout":"horizontal","data-source":e.showDataList},{renderItem:S(({item:a})=>[p(m,{style:{padding:"3px 0"}},{default:S(()=>[I("div",{class:"user-select-user-info",onClick:g=>e.onClickUser(g,a)},[I("div",null,[p(f,{checked:e.checkStatus[a.id],"onUpdate:checked":g=>e.checkStatus[a.id]=g},null,8,["checked","onUpdate:checked"])]),I("div",null,[a.avatar?(y(),k(u,{key:0,src:e.getFileAccessHttpUrl(a.avatar)},null,8,["src"])):(y(),k(u,{key:1},{icon:S(()=>[p(i)]),_:1}))]),I("div",{style:E(e.nameStyle)},N(a.realname),5),I("div",{style:E(e.departStyle)},N(a.orgCodeTxt),5)],8,Ce)]),_:2},1024)]),_:1},8,["data-source"])}const Y=P(Ie,[["render",ke]]);const we={name:"SelectedUserItem",components:{UserOutlined:$,MinusCircleFilled:de,CloseOutlined:te,TagsOutlined:ue,TeamOutlined:fe},props:{info:{type:Object,default:()=>{}},query:{type:Boolean,default:!1}},emits:["unSelect"],setup(t,{emit:s}){function l(d){d.preventDefault(),d.stopPropagation(),s("unSelect",t.info.id)}return{showClose:R(()=>t.query===!0),removeSelect:l,getFileAccessHttpUrl:ee}}},be={class:"user-selected-item"},De={style:{display:"flex","flex-direction":"row",height:"24px","border-radius":"12px","padding-right":"10px","vertical-align":"middle","background-color":"#f5f5f5"}},Te={style:{width:"24px",height:"24px","line-height":"20px","margin-right":"3px",display:"inline-block"}},Oe={style:{height:"24px","line-height":"24px"},class:"ellipsis"},Re={key:0,class:"icon-close"},ze={key:0,class:"icon-remove"};function Be(t,s,l,e,d,U){const f=r("a-avatar"),u=r("team-outlined"),i=r("TagsOutlined"),m=r("UserOutlined"),v=r("CloseOutlined"),a=r("MinusCircleFilled");return y(),T("div",be,[I("div",De,[I("span",Te,[l.info.avatar?(y(),k(f,{key:0,src:e.getFileAccessHttpUrl(l.info.avatar),size:24},null,8,["src"])):l.info.selectType=="sys_role"?(y(),k(f,{key:1,size:24,style:{"background-color":"rgb(255, 173, 0)"}},{icon:S(()=>[p(u,{style:{"font-size":"16px"}})]),_:1})):l.info.selectType=="sys_position"?(y(),k(f,{key:2,size:24,style:{"background-color":"rgb(245, 34, 45)"}},{icon:S(()=>[p(i,{style:{"font-size":"16px"}})]),_:1})):(y(),k(f,{key:3,size:24},{icon:S(()=>[p(m)]),_:1}))]),I("div",Oe,N(l.info.realname||l.info.name),1),e.showClose?(y(),T("div",Re,[p(v,{onClick:e.removeSelect},null,8,["onClick"])])):B("",!0)]),e.showClose?B("",!0):(y(),T("div",ze,[p(a,{onClick:e.removeSelect},null,8,["onClick"])]))])}const ne=P(we,[["render",Be]]),Me={name:"DepartUserList",components:{UserList:Y},props:{searchText:{type:String,default:""},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]}},emits:["loaded","selected","unSelect"],setup(t,{emit:s}){function l(n){return O(this,null,function*(){const o="/sys/sysDepart/queryDepartTreeSync";let c={};return n&&(c.pid=n),yield F.get({url:o,params:c},{isTransformResponse:!1})})}function e(){return O(this,null,function*(){const n=yield l();if(n.success){let o=n.result;U.value=o,d(o)}v()})}function d(n){let o=[];n&&n.length>0&&(o=n.map(c=>({value:c.id,label:c.departName}))),s("loaded",o)}e();const U=x([]),f=x([]),u=x([]),i=x("");function m(n,o){let c=o.node.dataRef;f.value=[c.key];let C=n[0];i.value=C,b()}function v(){i.value=""}function a(n){return O(this,null,function*(){const o=yield l(n.eventKey);if(o.success){let c=o.result;n.dataRef.children=[...c],U.value=[...U.value]}})}const g=x(300);g.value=window.innerHeight-300;const h=R(()=>({"overflow-y":"auto","max-height":g.value+"px"})),L=x([]);function b(){return O(this,null,function*(){const n="/sys/user/selectUserList";let o={pageNo:1,pageSize:10};t.searchText&&(o.keyword=t.searchText),i.value&&(o.departId=i.value);const c=yield F.get({url:n,params:o},{isTransformResponse:!1});if(c.success){const{records:C}=c.result;L.value=C}})}J(()=>t.searchText,()=>{b()});function D(n){s("selected",n)}function z(n){s("unSelect",n)}return{containerStyle:h,treeData:U,selectedKeys:f,expandedKeys:u,onSelect:m,loadChildren:a,onSelectUser:D,unSelectUser:z,userDataList:L}}};function Ae(t,s,l,e,d,U){const f=r("a-tree"),u=r("a-col"),i=r("user-list"),m=r("a-row");return y(),k(m,null,{default:S(()=>[p(u,{span:12},{default:S(()=>[I("div",{style:E(e.containerStyle)},[e.treeData.length>0?(y(),k(f,{key:0,"load-data":e.loadChildren,showIcon:"",autoExpandParent:"",treeData:e.treeData,selectedKeys:e.selectedKeys,expandedKeys:e.expandedKeys,"onUpdate:expandedKeys":s[0]||(s[0]=v=>e.expandedKeys=v),onSelect:e.onSelect},null,8,["load-data","treeData","selectedKeys","expandedKeys","onSelect"])):B("",!0)],4)]),_:1}),p(u,{span:12,style:{"padding-left":"10px"}},{default:S(()=>[I("div",{style:E(e.containerStyle)},[p(i,{excludeUserIdList:l.excludeUserIdList,dataList:e.userDataList,selectedIdList:l.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])],4)]),_:1})]),_:1})}const Ke=P(Me,[["render",Ae]]),Fe={name:"RoleUserList",components:{UserList:Y},props:{searchText:{type:String,default:""},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]}},emits:["selected","unSelect"],setup(t,{emit:s}){const l=x([]);function e(){return O(this,null,function*(){const h="/sys/role/listByTenant";let L={order:"desc",column:"createTime",pageSize:200},b=[];const D=yield F.get({url:h,params:L},{isTransformResponse:!1});if(D.success){const{records:z}=D.result;b=z.map(n=>({title:n.roleName,id:n.id,key:n.id}))}l.value=b})}e();const d=x([]),U=x("");function f(h,L){let b=L.node.dataRef;d.value=[b.key];let D=h[0];U.value=D,i()}const u=x([]);function i(){return O(this,null,function*(){const h="/sys/user/selectUserList";let L={pageNo:1,pageSize:10};t.searchText&&(L.keyword=t.searchText),U.value&&(L.roleId=U.value);const b=yield F.get({url:h,params:L},{isTransformResponse:!1});if(b.success){const{records:D}=b.result;u.value=D}})}J(()=>t.searchText,()=>{i()});function m(h){s("selected",h)}function v(h){s("unSelect",h)}const a=x(300);return a.value=window.innerHeight-300,{containerStyle:R(()=>({"overflow-y":"auto","max-height":a.value+"px"})),treeData:l,selectedKeys:d,onSelect:f,onSelectUser:m,unSelectUser:v,userDataList:u}}};function Ee(t,s,l,e,d,U){const f=r("a-tree"),u=r("a-col"),i=r("user-list"),m=r("a-row");return y(),k(m,null,{default:S(()=>[p(u,{span:12},{default:S(()=>[I("div",{style:E(e.containerStyle)},[e.treeData.length>0?(y(),k(f,{key:0,showIcon:"",treeData:e.treeData,selectedKeys:e.selectedKeys,onSelect:e.onSelect},null,8,["treeData","selectedKeys","onSelect"])):B("",!0)],4)]),_:1}),p(u,{span:12,style:{"padding-left":"10px"}},{default:S(()=>[I("div",{style:E(e.containerStyle)},[p(i,{excludeUserIdList:l.excludeUserIdList,dataList:e.userDataList,selectedIdList:l.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])],4)]),_:1})]),_:1})}const Pe=P(Fe,[["render",Ee]]),Ne=Ue,He={name:"UserSelectModal",components:{BasicModal:me,SearchOutlined:Se,CloseOutlined:te,SelectedUserItem:ne,UserList:Y,DepartUserList:Ke,RoleUserList:Pe,APagination:Ne},props:{multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},izExcludeMy:{type:Boolean,default:!1}},emits:["selected","register"],setup(t,{emit:s}){const l=x("1"),e=x([]),d=_e(),U=R(()=>{let _=e.value;return!_||_.length==0?[]:_.map(w=>w.id)}),f=x([]),[u]=ye(_=>{let w=_.list;w&&w.length>0?e.value=[...w]:e.value=[],_.excludeUserIdList?f.value=_.excludeUserIdList:f.value=[],t.izExcludeMy&&f.value.push(d.getUserInfo.id)});function i(){let _=G(e.value);s("selected",_)}const m=x(""),v=x([]);function a(_){v.value=[{value:"",label:"全部用户"},..._],m.value=""}function g(){M()}const h=x(!1),L=x("");function b(_){_&&Q(_),h.value=!0}function D(){M()}function z(_){_&&Q(_),L.value="",h.value=!1,M()}const n=x(1),o=x(0),c=x([]);function C(){return O(this,null,function*(){yield M()})}function M(){return O(this,null,function*(){const _="/sys/user/selectUserList";let w={pageNo:n.value,pageSize:10};L.value&&(w.keyword=L.value),m.value&&(w.departId=m.value);const A=yield F.get({url:_,params:w},{isTransformResponse:!1});if(A.success){const{records:K,total:oe}=A.result;o.value=oe,c.value=K}})}function se(_){if(t.multi===!0){let w=e.value;U.value.indexOf(_.id)<0&&(w.push(H({},_)),e.value=w)}else e.value=[H({},_)]}function le(_){let w=e.value,A=-1;for(let K=0;K<w.length;K++)if(w[K].id===_){A=K;break}A>=0&&(w.splice(A,1),e.value=w)}function ae(_){l.value=_}function Q(_){_.preventDefault(),_.stopPropagation()}return M(),{selectedDepart:m,departOptions:v,initDepartOptions:a,onDepartChange:g,register:u,handleOk:i,searchText:L,searchInputStatus:h,showSearchInput:b,onSearchUser:D,clearSearch:z,myActiveKey:l,onChangeTab:ae,pageNo:n,totalRecord:o,onPageChange:C,userDataList:c,selectedUserList:e,selectedIdList:U,onSelectUser:se,unSelectUser:le,excludeUserIdList:f}}};const qe={style:{position:"relative","min-height":"350px"}},je={class:"my-tabs"},Ve={class:"selected-users",style:{width:"100%","overflow-x":"hidden"}},Ge={style:{display:"flex","justify-content":"space-between",width:"100%"}},Je={class:"select-user-page-info"};function Ye(t,s,l,e,d,U){const f=r("a-select-option"),u=r("a-select"),i=r("SearchOutlined"),m=r("CloseOutlined"),v=r("a-input"),a=r("user-list"),g=r("a-tab-pane"),h=r("depart-user-list"),L=r("role-user-list"),b=r("a-tabs"),D=r("SelectedUserItem"),z=r("a-pagination"),n=r("a-button"),o=r("BasicModal");return y(),k(o,{onRegister:e.register,getContainer:l.getContainer,canFullscreen:!1,title:"选择用户",width:600,wrapClassName:"j-user-select-modal2"},{footer:S(()=>[I("div",Ge,[I("div",Je,[e.myActiveKey=="1"?(y(),k(z,{key:0,current:e.pageNo,"onUpdate:current":s[3]||(s[3]=c=>e.pageNo=c),size:"small",total:e.totalRecord,"show-quick-jumper":"",onChange:e.onPageChange},null,8,["current","total","onChange"])):B("",!0)]),p(n,{type:"primary",onClick:e.handleOk},{default:S(()=>[Z("确 定")]),_:1},8,["onClick"])])]),default:S(()=>[p(u,{value:e.selectedDepart,"onUpdate:value":s[0]||(s[0]=c=>e.selectedDepart=c),style:{width:"100%"},class:"depart-select",onChange:e.onDepartChange},{default:S(()=>[(y(!0),T(j,null,V(e.departOptions,c=>(y(),k(f,{value:c.value},{default:S(()=>[Z(N(c.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"]),I("div",qe,[I("div",{class:q(e.searchInputStatus?"my-search all-width":"my-search")},[I("span",{class:q(e.searchInputStatus?"hidden":""),style:{"margin-left":"10px"}},[p(i,{style:{color:"#c0c0c0"},onClick:e.showSearchInput},null,8,["onClick"])],2),I("div",{style:{width:"100%"},class:q(e.searchInputStatus?"":"hidden")},[p(v,{value:e.searchText,"onUpdate:value":s[1]||(s[1]=c=>e.searchText=c),onPressEnter:e.onSearchUser,style:{width:"100%"},placeholder:"请输入用户名按回车搜索"},{prefix:S(()=>[p(i,{style:{color:"#c0c0c0"}})]),suffix:S(()=>[p(m,{title:"退出搜索",onClick:e.clearSearch},null,8,["onClick"])]),_:1},8,["value","onPressEnter"])],2)],2),I("div",je,[p(b,{activeKey:e.myActiveKey,"onUpdate:activeKey":s[2]||(s[2]=c=>e.myActiveKey=c),centered:!0,onChange:e.onChangeTab},{default:S(()=>[p(g,{key:"1",tab:"全部",forceRender:""},{default:S(()=>[p(a,{excludeUserIdList:e.excludeUserIdList,dataList:e.userDataList,selectedIdList:e.selectedIdList,depart:"",onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])]),_:1}),p(g,{key:"2",tab:"按部门",forceRender:""},{default:S(()=>[p(h,{searchText:e.searchText,selectedIdList:e.selectedIdList,excludeUserIdList:e.excludeUserIdList,onLoaded:e.initDepartOptions,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["searchText","selectedIdList","excludeUserIdList","onLoaded","onSelected","onUnSelect"])]),_:1}),p(g,{key:"3",tab:"按角色",forceRender:""},{default:S(()=>[p(L,{excludeUserIdList:e.excludeUserIdList,searchText:e.searchText,selectedIdList:e.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["excludeUserIdList","searchText","selectedIdList","onSelected","onUnSelect"])]),_:1})]),_:1},8,["activeKey","onChange"])]),I("div",Ve,[(y(!0),T(j,null,V(e.selectedUserList,c=>(y(),k(D,{info:c,onUnSelect:e.unSelectUser},null,8,["info","onUnSelect"]))),256))])])]),_:1},8,["onRegister","getContainer"])}const Qe=P(He,[["render",Ye]]),We=ge({name:"UserSelect",components:{PlusOutlined:xe,UserSelectModal:Qe,SelectedUserItem:ne},props:{store:{type:String,default:"id"},value:{type:String,default:""},multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},query:{type:Boolean,default:!1},maxCount:{type:Number,default:2},disabled:{type:Boolean,default:!1},izExcludeMy:{type:Boolean,default:!1}},emits:["update:value","change"],setup(t,{emit:s}){const l=Le.useInjectFormItemContext(),e=x(!0),d=x([]),U=R(()=>{let n=d.value,o=t.maxCount;return n.length<=o?n:n.filter((c,C)=>C<o)}),f=R(()=>{let n=t.maxCount,o=d.value.length;return o>n?{status:!0,count:o-n}:{status:!1}}),[u,{openModal:i,closeModal:m}]=pe();function v(){if(t.disabled===!0)return;let n=G(d.value);i(!0,{list:n})}function a(n){d.value=n,g(),m()}function g(){e.value=!1;let n=[],o=d.value;o&&o.length>0&&(n=o.map(C=>C[t.store]));let c=n.join(",");s("update:value",c),s("change",c),l.onFieldChange()}J(()=>t.value,n=>O(this,null,function*(){n?e.value===!0&&(yield h(n)):d.value=[],e.value=!0}),{immediate:!0});function h(n){return O(this,null,function*(){const o="/sys/user/list";let c={[t.store]:n};d.value=[];const C=yield F.get({url:o,params:c},{isTransformResponse:!1});if(C.success){const{records:M}=C.result;d.value=M}})}const L=R(()=>t.disabled===!0?!1:t.multi===!0?!0:!(d.value.length>0));function b(n){let o=d.value,c=-1;for(let C=0;C<o.length;C++)if(o[C].id==n){c=C;break}c>=0&&(o.splice(c,1),d.value=o,g())}function D(n){n.preventDefault(),n.stopPropagation(),v()}const z=R(()=>t.query===!0);return{registerModal:u,onShowModal:v,isSearchFormComp:z,onSelected:a,showAddButton:L,unSelectUser:b,selectedUserList:d,showUserList:U,ellipsisInfo:f,click2Add:D}}});const Xe={key:1,style:{height:"30px","line-height":"30px",display:"inline-block","margin-left":"7px",color:"#bfbfbf"}},Ze={key:2,class:"user-selected-item"},$e={class:"user-select-ellipsis"},et={style:{color:"red"}},tt={key:1,style:{display:"flex","flex-wrap":"wrap","flex-direction":"row"}};function nt(t,s,l,e,d,U){const f=r("SelectedUserItem"),u=r("PlusOutlined"),i=r("a-button"),m=r("user-select-modal");return y(),T("div",null,[t.isSearchFormComp?(y(),T("div",{key:0,onClick:s[0]||(s[0]=(...v)=>t.click2Add&&t.click2Add(...v)),class:q(t.disabled?"disabled-user-select":""),style:{padding:"0 5px","background-color":"#fff",border:"1px solid #ccc","border-radius":"3px","box-sizing":"border-box",display:"flex",color:"#9e9e9e","font-size":"14px","flex-wrap":"wrap","min-height":"32px"}},[t.selectedUserList.length>0?(y(!0),T(j,{key:0},V(t.showUserList,v=>(y(),k(f,{info:v,onUnSelect:t.unSelectUser,query:""},null,8,["info","onUnSelect"]))),256)):(y(),T("span",Xe,"请选择用户")),t.ellipsisInfo.status?(y(),T("div",Ze,[I("div",$e,[I("span",et,"+"+N(t.ellipsisInfo.count)+"...",1)])])):B("",!0)],2)):(y(),T("div",tt,[t.selectedUserList.length>0?(y(!0),T(j,{key:0},V(t.selectedUserList,v=>(y(),k(f,{info:v,onUnSelect:t.unSelectUser},null,8,["info","onUnSelect"]))),256)):B("",!0),t.showAddButton?(y(),k(i,{key:1,shape:"circle",onClick:t.onShowModal},{default:S(()=>[p(u)]),_:1},8,["onClick"])):B("",!0)])),p(m,{multi:t.multi,getContainer:t.getContainer,onRegister:t.registerModal,onSelected:t.onSelected,izExcludeMy:t.izExcludeMy},null,8,["multi","getContainer","onRegister","onSelected","izExcludeMy"])])}const it=P(We,[["render",nt],["__scopeId","data-v-4f9b5aab"]]);export{Qe as U,it as a};
