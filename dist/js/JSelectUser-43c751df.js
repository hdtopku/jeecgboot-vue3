var q=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var P=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))Y.call(t,n)&&P(e,n,t[n]);if(z)for(var n of z(t))Z.call(t,n)&&P(e,n,t[n]);return e},F=(e,t)=>Q(e,X(t));var U=(e,t,n)=>new Promise((s,u)=>{var f=c=>{try{a(n.next(c))}catch(r){u(r)}},l=c=>{try{a(n.throw(c))}catch(r){u(r)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(f,l);a((n=n.apply(e,t)).next())});import{c as T,l as m,r as A,w as E,u as y,d as D,V as b,a7 as G,a8 as H,f as w,af as V,aa as R,ad as ee,p as $,s as te}from"./vue-86253b15.js";import{q as ae,am as le,aD as ne,ar as N,K as se,_ as W}from"./jeecg-online-vendor-bc5d810e.js";import{B as oe}from"./index-5f3b36bb.js";import{E as ie,a5 as J,p as L,F as ce}from"./index-4de4eaa0.js";import{s as ue}from"./props-edbd03b5.js";import{J as re}from"./JSelectBiz-4759b897.js";import{useRuleFormItem as de}from"./useFormItem-48d9339b.js";function fe(e,t){const n=T("selectOptions",m([])),s=T("selectValues",A({value:[],change:!1})),u=T("loadingEcho",m(!1)),f=m([]),l=m([]),a=m([]),c=ae();let r=!0;E(s,()=>{if(s.change==!1&&!le(s.value)){let o={};o[t.rowKey]=s.value.join(","),u.value=r,r=!1,_(o,!0).then().finally(()=>{u.value=r})}l.value=s.value},{immediate:!0});function g(o,d){return U(this,null,function*(){if(l.value=o,t.showSelected&&y(l).length!==y(d).length){let{records:v}=yield e({code:y(l).join(","),pageSize:y(l).length});a.value=v}else a.value=d})}const S={type:t.isRadioSelection?"radio":"checkbox",columnWidth:20,selectedRowKeys:l,onChange:g,preserveSelectedRowKeys:!0},I={dataIndex:"index",width:50};function _(o,d){return U(this,null,function*(){let{records:v}=yield e(o);if(f.value=v,d){let p=[];v.forEach(h=>{p.push({label:h[t.labelKey],value:h[t.rowKey]})}),n.value=p}})}function x(){return U(this,null,function*(){let{records:o}=yield e({code:s.value.join(","),pageSize:s.value.length});l.value=s.value,a.value=o})}function K(o){return U(this,null,function*(){o&&t.showSelected&&x()})}function O(o){let d=[],v=[];if(a.value.forEach(p=>{d.push({label:p[t.labelKey],value:p[t.rowKey]})}),l.value.forEach(p=>{v.push(p)}),n.value=d,t.maxSelectCount&&v.length>t.maxSelectCount)return c.createMessage.warning(`最多只能选择${t.maxSelectCount}条数据`),!1;o&&o(d,v)}function i(o){l.value=l.value.filter(d=>d!=o[t.rowKey]),a.value=a.value.filter(d=>d[t.rowKey]!==o[t.rowKey])}function C(){l.value=[],a.value=[]}return[{onSelectChange:g,getDataSource:_,visibleChange:K,selectOptions:n,selectValues:s,rowSelection:S,indexColumnProps:I,checkedKeys:l,selectRows:a,dataSource:f,getSelectResult:O,handleDeleteSelected:i,reset:C}]}const me=D({name:"UserSelectModal",components:{BasicModal:oe,BasicTable:ne(()=>se(()=>import("./BasicTable-c5288ffa.js"),["js/BasicTable-c5288ffa.js","js/vue-86253b15.js","js/jeecg-online-vendor-bc5d810e.js","js/antd-vue-vendor-371529c2.js","js/tinymce-vendor-7c917b36.js","js/lodash-es-vendor-04a44d0a.js","js/vxe-table-vendor-6a8d95c4.js","assets/jeecg-online-vendor-cee2ba5d.css","js/index-4de4eaa0.js","js/codemirror-vendor-9b2dceac.js","js/echarts-vendor-ba343549.js","assets/index-fe1627ce.css","js/index-2b71c6a1.js","js/useForm-61401b42.js","js/componentMap-804f169d.js","js/useFormItem-48d9339b.js","js/index-5f3b36bb.js","js/BasicModal-8033a6fa.js","js/useWindowSizeFn-0b39b13a.js","assets/BasicModal-1e1b2ed9.css","assets/index-361bf2db.css","js/index-7eb57de2.js","assets/index-0a01c8ed.css","js/download-dda5b956.js","js/base64Conver-fa2fe1af.js","js/index-c842bec9.js","assets/index-399aa0e3.css","js/index-f5da07b2.js","js/useCountdown-7a164eb2.js","js/useFormItemSingle-1ae794f9.js","assets/index-15cc10f8.css","js/JAddInput-eb55e093.js","js/areaDataUtil-c66543dc.js","js/props-edbd03b5.js","js/JSelectBiz-4759b897.js","assets/JSelectBiz-ba37f0a8.css","js/index-6c9d1f87.js","js/index-6021b022.js","js/bem-6904c165.js","js/props-3eac2fce.js","js/useContextMenu-368c1b38.js","assets/useContextMenu-6fcaad79.css","assets/index-a95e0833.css","js/depart.api-b7cb4c93.js","assets/JAddInput-4d25ca38.css","js/JSelectDept-1fac1b66.js","assets/JSelectDept-2ce3f5d2.css","js/JPopup-1441d476.js","assets/JPopup-00750b3f.css","js/cron-parser-vendor-8edbe50a.js","js/JEllipsis-08edf142.js","js/JUpload-5d01fa2e.js","assets/JUpload-b67dde08.css","js/index-8967d44c.js","js/index-d90d28d1.js","assets/index-d42612fa.css","assets/componentMap-11d05ddc.css","assets/useForm-9101c3b7.css","js/injectionKey-69710956.js","assets/BasicTable-300e7560.css"]),{loading:!0})},props:F(M({},ue),{modalTitle:{type:String,default:"选择用户"},excludeUserIdList:{type:Array,default:[]}}),emits:["register","getSelectResult"],setup(e,{emit:t,refs:n}){const s=m({x:!1}),u=m(),[f,{closeModal:l}]=ie(()=>{window.innerWidth<900?s.value={x:900}:s.value={x:!1},setTimeout(()=>{u.value&&u.value.setSelectedRowKeys(I.value||[])},800)}),a=N(),c={canResize:!1,bordered:!0,size:"small"},r=Object.assign({},y(e),y(a),c),[{rowSelection:g,visibleChange:S,selectValues:I,indexColumnProps:_,getSelectResult:x,handleDeleteSelected:K,selectRows:O}]=fe(J,r),i=m(e.params);E(g.selectedRowKeys,h=>{u.value&&u.value.setSelectedRowKeys(h)});const C={baseColProps:{xs:24,sm:8,md:6,lg:8,xl:6,xxl:6},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8},schemas:[{label:"账号",field:"username",component:"JInput"},{label:"姓名",field:"realname",component:"JInput"}]},o=[{title:"用户账号",dataIndex:"username",width:120,align:"left"},{title:"用户姓名",dataIndex:"realname",width:120},{title:"性别",dataIndex:"sex_dictText",width:50},{title:"手机号码",dataIndex:"phone",width:120},{title:"邮箱",dataIndex:"email"},{title:"状态",dataIndex:"status_dictText",width:80}],d={pagination:!1,showIndexColumn:!1,scroll:{y:390},size:"small",canResize:!1,bordered:!0,rowKey:"id",columns:[{title:"用户姓名",dataIndex:"realname",width:40},{title:"操作",dataIndex:"action",align:"center",width:40,slots:{customRender:"action"}}]};function v(){x((h,B)=>{t("getSelectResult",h,B),l()})}function p(h){let B=e.excludeUserIdList;if(!B)return h;let j=[];if(B.length>0&&h&&h.length>0){for(let k of h)B.indexOf(k.id)<0&&j.push(M({},k));return j}return h}return{handleOk:v,searchInfo:i,register:f,indexColumnProps:_,visibleChange:S,getBindValue:r,getUserList:J,formConfig:C,columns:o,rowSelection:g,selectRows:O,selectedTable:d,handleDeleteSelected:K,tableScroll:s,tableRef:u,afterFetch:p}}}),he=["onClick"];function ge(e,t,n,s,u,f){const l=b("BasicTable"),a=b("a-col"),c=b("Icon"),r=b("a-row"),g=b("BasicModal");return G(),H("div",null,[w(g,V(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:e.showSelected?"1200px":"900px",wrapClassName:"j-user-select-modal",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{default:R(()=>[w(r,null,{default:R(()=>[w(a,{span:e.showSelected?18:24},{default:R(()=>[w(l,V({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getUserList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps,afterFetch:e.afterFetch}),{tableTitle:R(()=>[]),_:1},16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps","afterFetch"])]),_:1},8,["span"]),w(a,{span:e.showSelected?6:0},{default:R(()=>[w(l,V(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:R(({record:S})=>[ee("a",{href:"javascript:void(0)",onClick:I=>e.handleDeleteSelected(S)},[w(c,{icon:"ant-design:delete-outlined"})],8,he)]),_:1},16,["dataSource"])]),_:1},8,["span"])]),_:1})]),_:1},16,["onRegister","title","width","onOk","onVisibleChange"])])}const ve=W(me,[["render",ge]]),pe=D({name:"JSelectUser",components:{UserSelectModal:ve,JSelectBiz:re},inheritAttrs:!1,props:{value:L.oneOfType([L.string,L.array]),labelKey:{type:String,default:"realname"},rowKey:{type:String,default:"username"},params:{type:Object,default:()=>{}},excludeUserIdList:{type:Array,default:()=>[]}},emits:["options-change","change","update:value"],setup(e,{emit:t}){const n=m(),[s,{openModal:u}]=ce(),[f]=de(e,"value","change",n),l=m([]);let a=A({value:[],change:!1});const c=m(!1);$("selectOptions",l),$("selectValues",a),$("loadingEcho",c);const r=m(!1),g=N();te(()=>{e.value&&_(),e.value||(a.value=[])}),E(a,()=>{a&&(f.value=a.value)});const S=m([]);E(()=>e.excludeUserIdList,i=>{S.value=i},{immediate:!0});function I(){r.value=!0,u(!0,{isUpdate:!1})}function _(){let i=e.value?e.value:[];i&&typeof i=="string"&&i!="null"&&i!="undefined"?(f.value=i.split(","),a.value=i.split(",")):a.value=i}function x(i,C){l.value=i,f.value=C,a.value=C,t("update:value",C.join(","))}const K=Object.assign({},y(e),y(g));function O(i){t("update:value",i)}return{state:f,attrs:g,selectOptions:l,getBindValue:K,selectValues:a,loadingEcho:c,tag:r,regModal:s,setValue:x,handleOpen:I,excludeUserIdList:S,handleChange:O}}});function we(e,t,n,s,u,f){const l=b("JSelectBiz"),a=b("UserSelectModal");return G(),H("div",null,[w(l,V({onChange:e.handleChange,onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs),null,16,["onChange","onHandleOpen","loading"]),w(a,V({rowKey:e.rowKey,onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{excludeUserIdList:e.excludeUserIdList}),null,16,["rowKey","onRegister","onGetSelectResult","excludeUserIdList"])])}const Ke=W(pe,[["render",we],["__scopeId","data-v-00f5e96f"]]);export{ve as U,Ke as n,fe as u};
