var G=Object.defineProperty;var T=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var J=(r,a,u)=>a in r?G(r,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[a]=u,M=(r,a)=>{for(var u in a||(a={}))H.call(a,u)&&J(r,u,a[u]);if(T)for(var u of T(a))I.call(a,u)&&J(r,u,a[u]);return r};var b=(r,a,u)=>new Promise((f,C)=>{var B=n=>{try{y(u.next(n))}catch(c){C(c)}},k=n=>{try{y(u.throw(n))}catch(c){C(c)}},y=n=>n.done?f(n.value):Promise.resolve(n.value).then(B,k);y((u=u.apply(r,a)).next())});import{B as W}from"./index-a882524d.js";import{B as Q}from"./BasicForm-030e7c21.js";import"./componentMap-90ab712d.js";import{u as z}from"./useForm-ae9e1cbd.js";import"./JAddInput-dff0b84f.js";import{A as X,aj as g}from"./index-6916e394.js";import{f as Y,u as Z,s as ee}from"./check.rule.data-a5746e8d.js";import{p as ue}from"./antd-vue-vendor-1561c1ba.js";import{d as te,e as ae,u as m,k as d,U as _,aV as se,ar as re,bi as v,f as p,aQ as oe}from"./vue-c7e3516e.js";const he=te({__name:"CheckRuleModal",emits:["register","success"],setup(r,{emit:a}){const u=ae(()=>m(f)?"\u7F16\u8F91":"\u65B0\u589E"),f=d(!0),[C,{resetFields:B,setFieldsValue:k,validate:y,getFieldsValue:n}]=z({schemas:Y,showActionButtonGroup:!1}),c=d("1");let w=d([]),D=d([]);const[O,{setModalProps:A,closeModal:N}]=X(e=>b(this,null,function*(){if(yield B(),A({confirmLoading:!1}),f.value=!!(e!=null&&e.isUpdate),c.value="1",w.value=[],D.value=[],m(f)){yield k(M({},e.record));let s=e.record.ruleJson;if(s){let o=JSON.parse(s),t=[],l=[],i="1";o.forEach(F=>{F.digits==="*"?t.push(Object.assign(F,{priority:i})):(i="0",l.push(F))}),w.value=l,D.value=t}}})),R=d(),S=d();function V(e,s){return new Promise((o,t)=>{e.value.validateTable().then(l=>{if(l)c.value=s,t();else{const i=e.value.getTableData();o(i)}})})}function q(){return b(this,null,function*(){let e,s=[],o=[];y().then(t=>(e=t,V(R,"1"))).then(t=>(t&&t.length>0&&(o=t),V(S,"2"))).then(t=>{t&&t.length>0&&(s=t);let l=[],i=[];for(let h=0;h<s.length;h++){let E=s[h];E.digits="*",E.priority==="1"?l.push(E):i.push(E)}let K=l.concat(o).concat(i).map(h=>ue(h,"digits","pattern","message")),P=JSON.stringify(K),j=Object.assign({},e,{ruleJson:P});L(j)}).catch(()=>{A({confirmLoading:!1})})})}function L(e){return b(this,null,function*(){try{A({confirmLoading:!0}),f.value?yield Z(e):yield ee(e),N(),a("success")}finally{A({confirmLoading:!1})}})}const x=({cellValue:e},s)=>{try{new RegExp(e),s(!0)}catch(o){s(!1,"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6B63\u5219\u8868\u8FBE\u5F0F")}},U=d([{title:"\u4F4D\u6570",key:"digits",type:g.inputNumber,minWidth:180,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[1-9]\d*$/,message:"\u8BF7\u8F93\u5165\u96F6\u4EE5\u4E0A\u7684\u6B63\u6574\u6570"}]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",minWidth:320,type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",minWidth:180,type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]),$=d([{title:"\u4F18\u5148\u7EA7",key:"priority",type:g.select,defaultValue:"1",options:[{title:"\u4F18\u5148\u8FD0\u884C",value:"1"},{title:"\u6700\u540E\u8FD0\u884C",value:"0"}],validateRules:[]},{title:"\u89C4\u5219\uFF08\u6B63\u5219\u8868\u8FBE\u5F0F\uFF09",key:"pattern",width:"40%",type:g.input,validateRules:[{required:!0,message:"\u89C4\u5219\u4E0D\u80FD\u4E3A\u7A7A"},{handler:x}]},{title:"\u63D0\u793A\u6587\u672C",key:"message",width:"20%",type:g.input,validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]}]);return(e,s)=>{const o=_("a-alert"),t=_("JVxeTable"),l=_("a-tab-pane"),i=_("a-tabs");return se(),re(m(W),oe(e.$attrs,{onRegister:m(O),onOk:q,title:u.value,width:1200,destroyOnClose:""}),{default:v(()=>[p(m(Q),{onRegister:m(C)},null,8,["onRegister"]),p(i,{activeKey:c.value,"onUpdate:activeKey":s[0]||(s[0]=F=>c.value=F),animated:""},{default:v(()=>[p(l,{tab:"\u5C40\u90E8\u89C4\u5219",key:"1",forceRender:!0},{default:v(()=>[p(t,{ref_key:"vTable1",ref:R,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:m(w),columns:U.value},{toolbarAfter:v(()=>[p(o,{type:"info",showIcon:"",message:"\u5C40\u90E8\u89C4\u5219\u6309\u7167\u4F60\u8F93\u5165\u7684\u4F4D\u6570\u6709\u5E8F\u7684\u6821\u9A8C",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1}),p(l,{tab:"\u5168\u5C40\u89C4\u5219",key:"2",forceRender:!0},{default:v(()=>[p(t,{ref_key:"vTable2",ref:S,toolbar:"",rowNumber:"",dragSort:"",rowSelection:"",maxHeight:580,dataSource:m(D),addSetActive:!1,columns:$.value},{toolbarAfter:v(()=>[p(o,{type:"info",showIcon:"",message:"\u5168\u5C40\u89C4\u5219\u53EF\u6821\u9A8C\u7528\u6237\u8F93\u5165\u7684\u6240\u6709\u5B57\u7B26\uFF1B\u5168\u5C40\u89C4\u5219\u7684\u4F18\u5148\u7EA7\u6BD4\u5C40\u90E8\u89C4\u5219\u7684\u8981\u9AD8\u3002",style:{"margin-bottom":"8px"}})]),_:1},8,["dataSource","columns"])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister","title"])}}});export{he as _};
