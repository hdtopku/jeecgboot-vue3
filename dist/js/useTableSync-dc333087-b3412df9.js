import{r as I}from"./cgform.data-cbdd88c3-f55ae792.js";import{_ as N}from"./antd-vue-vendor-04f0af1d.js";import{c as g,k as F,e as h,n as p}from"./vue-5a09445c.js";var x=(b,m,a)=>new Promise((o,v)=>{var r=l=>{try{d(a.next(l))}catch(c){v(c)}},f=l=>{try{d(a.throw(l))}catch(c){v(c)}},d=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,f);d((a=a.apply(b,m)).next())});function V(b){const m=g("tables"),a=g("fullScreenRef"),o=F(),v=F(!1),r=F([]),f=h(()=>({normal:a!=null&&a.value?430:260,noToolbar:a!=null&&a.value?480:320})),d=h(()=>["id"].concat(b.value.map(t=>t.key))),l=h(()=>({scrollY:{gt:15},scrollX:{gt:20}}));function c(t){return x(this,null,function*(){let e=o.value;if(yield e.fullValidateTable())throw{code:I,activeKey:t};let y=e.getTableData().map(s=>N(s,d.value)),T=e.getDeleteData().map(s=>s.id);return{tableData:y,deleteIds:T}})}function k(t,e=!1){return x(this,null,function*(){e?(r.value=[],yield p(),yield o.value.addOrInsert(t,0,null,{setActive:!1}),yield p(),o.value.recalcDisableRows()):r.value=t})}function w(t){let e=o.value,y=t.value.tableRef,T=t.value.getRemoveIds(),s=y.getXTable().internalData.tableFullData,R=e.getXTable().internalData.tableFullData;return s.forEach(u=>{let D=!1;if(R.forEach(i=>{if(u.id===i.id){let n=i.dbFieldName,E=i.dbFieldTxt;(u.dbFieldName!==n||u.dbFieldTxt!==E)&&e.setValues([{rowKey:i.id,values:{dbFieldName:u.dbFieldName,dbFieldTxt:u.dbFieldTxt}}]),D=!0}else T.forEach(n=>{n===i.id&&(e.removeRowsById(n),D=!0)})}),!D){let i=Object.assign({},u);b.value.forEach(n=>{n.key!=="dbFieldName"&&n.key!=="dbFieldTxt"&&(i[n.key]=n.defaultValue)}),e.addRows(i)}}),p()}return{tables:m,tableRef:o,loading:v,dataSource:r,columnKeys:d,tableHeight:f,tableProps:l,syncTable:w,validateData:c,setDataSource:k}}export{V as L};
