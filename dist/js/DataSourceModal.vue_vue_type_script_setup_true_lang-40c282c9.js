var k=Object.defineProperty;var S=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var w=(e,r,t)=>r in e?k(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,q=(e,r)=>{for(var t in r||(r={}))F.call(r,t)&&w(e,t,r[t]);if(S)for(var t of S(r))L.call(r,t)&&w(e,t,r[t]);return e};var f=(e,r,t)=>new Promise((s,m)=>{var h=a=>{try{i(t.next(a))}catch(b){m(b)}},j=a=>{try{i(t.throw(a))}catch(b){m(b)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(h,j);i((t=t.apply(e,r)).next())});import{B as E}from"./index-d3bb5676.js";import{B as O}from"./BasicForm-e402ba31.js";import"./componentMap-a7b11ac1.js";import{u as R}from"./useForm-b140653f.js";import"./JAddInput-448c30de.js";import"./JSelectUser-6445886b.js";import"./JSelectDept-a510196a.js";import"./JPopup-17610371.js";import{B as N}from"./index-679980cc.js";import{b as n,u as V}from"./jeecg-online-vendor-216a3b98.js";import{M as J}from"./antd-vue-vendor-31afcf32.js";import{d as A,k as z,u as d,e as G,U as D,a5 as H,a9 as K,a7 as c,f as l,E as Q,ag as X}from"./vue-249e5fad.js";const $={1:{dbDriver:"com.mysql.jdbc.Driver"},4:{dbDriver:"com.mysql.cj.jdbc.Driver"},2:{dbDriver:"oracle.jdbc.OracleDriver"},3:{dbDriver:"com.microsoft.sqlserver.jdbc.SQLServerDriver"},5:{dbDriver:"org.mariadb.jdbc.Driver"},6:{dbDriver:"org.postgresql.Driver"},7:{dbDriver:"dm.jdbc.driver.DmDriver"},8:{dbDriver:"com.kingbase8.Driver"},9:{dbDriver:"com.oscar.Driver"},10:{dbDriver:"org.sqlite.JDBC"},11:{dbDriver:"com.ibm.db2.jcc.DB2Driver"},12:{dbDriver:"org.hsqldb.jdbc.JDBCDriver"},13:{dbDriver:"org.apache.derby.jdbc.ClientDriver"},14:{dbDriver:"org.h2.Driver"},15:{dbDriver:""}},W={1:{dbUrl:"jdbc:mysql://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useUnicode=true&useSSL=false"},4:{dbUrl:"jdbc:mysql://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useUnicode=true&useSSL=false&tinyInt1isBit=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai"},2:{dbUrl:"jdbc:oracle:thin:@127.0.0.1:1521:ORCL"},3:{dbUrl:"jdbc:sqlserver://127.0.0.1:1433;SelectMethod=cursor;DatabaseName=jeecgboot"},5:{dbUrl:"jdbc:mariadb://127.0.0.1:3306/jeecg-boot?characterEncoding=UTF-8&useSSL=false"},6:{dbUrl:"jdbc:postgresql://127.0.0.1:5432/jeecg-boot"},7:{dbUrl:"jdbc:dm://127.0.0.1:5236/?jeecg-boot&zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=utf-8"},8:{dbUrl:"jdbc:kingbase8://127.0.0.1:54321/jeecg-boot"},9:{dbUrl:"jdbc:oscar://192.168.1.125:2003/jeecg-boot"},10:{dbUrl:"jdbc:sqlite://opt/test.db"},11:{dbUrl:"jdbc:db2://127.0.0.1:50000/jeecg-boot"},12:{dbUrl:"jdbc:hsqldb:hsql://127.0.0.1/jeecg-boot"},13:{dbUrl:"jdbc:derby://127.0.0.1:1527/jeecg-boot"},14:{dbUrl:"jdbc:h2:tcp://127.0.0.1:8082/jeecg-boot"},15:{dbUrl:""}},ge=[{title:"数据源名称",dataIndex:"name",width:200,align:"left"},{title:"数据库类型",dataIndex:"dbType_dictText",width:200},{title:"驱动类",dataIndex:"dbDriver",width:200},{title:"数据源地址",dataIndex:"dbUrl"},{title:"用户名",dataIndex:"dbUsername",width:200}],ve=[{field:"name",label:"数据源名称",component:"Input",colProps:{span:8}},{field:"dbType",label:"数据库类型",component:"JDictSelectTag",colProps:{span:8},componentProps:()=>({dictCode:"database_type"})}],Y=[{field:"id",label:"id",component:"Input",show:!1},{field:"code",label:"数据源编码",component:"Input",required:!0,dynamicDisabled:({values:e})=>!!e.id},{field:"name",label:"数据源名称",component:"Input",required:!0},{field:"dbType",label:"数据库类型",component:"JDictSelectTag",required:!0,componentProps:({formModel:e})=>({dictCode:"database_type",onChange:r=>{e=Object.assign(e,$[r],W[r])}})},{field:"dbDriver",label:"驱动类",required:!0,component:"Input"},{field:"dbUrl",label:"数据源地址",required:!0,component:"Input"},{field:"dbUsername",label:"用户名",required:!0,component:"Input"},{field:"dbPassword",label:"密码",required:!0,component:"InputPassword",slot:"pwd"},{field:"remark",label:"备注",component:"InputTextArea"}],fe="sys/dataSource/exportXls",De="sys/dataSource/importExcel",he=e=>n.get({url:"/sys/dataSource/list",params:e}),Z=(e,r)=>{let t=r?"/sys/dataSource/edit":"/sys/dataSource/add";return n.post({url:t,params:e})},ee=e=>n.get({url:"/sys/dataSource/queryById",params:e}),je=(e,r)=>n.delete({url:"/sys/dataSource/delete",data:e},{joinParamsToUrl:!0}).then(()=>{r()}),re=e=>n.post({url:"/online/cgreport/api/testConnection",params:e}),Ue=(e,r)=>{J.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>n.delete({url:"/sys/dataSource/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{r()})})},ye=A({__name:"DataSourceModal",emits:["register","success"],setup(e,{emit:r}){const{createMessage:t}=V(),s=z(!0),[m,{getFieldsValue:h,resetFields:j,validateFields:i,setFieldsValue:a,validate:b}]=R({schemas:Y,showActionButtonGroup:!1}),[T,{setModalProps:U,closeModal:I}]=N(o=>f(this,null,function*(){yield j(),U({confirmLoading:!1}),s.value=!!(o!=null&&o.isUpdate),d(s)&&(o.record=yield ee({id:o.record.id}),yield a(q({},o.record)))})),x=G(()=>d(s)?"编辑数据源":"新增数据源");function B(){return f(this,null,function*(){let o=["dbType","dbDriver","dbUrl","dbName","dbUsername","dbPassword"],p=h(o);o.forEach(u=>({value:p[u],errors:null})),yield i(o).then(u=>{let g=t.loading("连接中....",0);re(u).then(v=>{v.success&&t.success("连接成功")}).catch(v=>{}).finally(()=>g())})})}function C(o){return f(this,null,function*(){try{let p=yield b();U({confirmLoading:!0}),yield Z(p,s.value),I(),r("success")}finally{U({confirmLoading:!1})}})}return(o,p)=>{const u=D("a-input-password"),g=D("a-col"),v=D("a-button"),M=D("a-row");return H(),K(d(E),X(o.$attrs,{onRegister:d(T),title:x.value,onOk:C,width:"40%"}),{default:c(()=>[l(d(O),{onRegister:d(m)},{pwd:c(({model:y,field:_})=>[l(M,{gutter:8},{default:c(()=>[l(g,{sm:15,md:16,lg:17,xl:19},{default:c(()=>[l(u,{value:y[_],"onUpdate:value":P=>y[_]=P,placeholder:"请输入密码"},null,8,["value","onUpdate:value"])]),_:2},1024),l(g,{sm:9,md:7,lg:7,xl:5},{default:c(()=>[l(v,{type:"primary",style:{width:"100%"},onClick:B},{default:c(()=>[Q("测试")]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"])}}});export{ye as _,fe as a,De as b,ge as c,je as d,Ue as e,he as g,ve as s};
