import{J as i}from"./index-ebe32d90.js";import{L as w}from"./useTableSync-dc333087-fc5a5258.js";import{V as k}from"./jeecg-online-vendor-231813f7.js";import{d as x,g as Y,k as L,V as $,a5 as K,a9 as W,ag as X}from"./vue-5a09445c.js";import"./antd-vue-vendor-e4fda4cf.js";import"./tinymce-vendor-e2919cb0.js";import"./lodash-es-vendor-3f622b6f.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./cgform.data-cbdd88c3-b8b26022.js";var Q=Object.defineProperty,j=Object.defineProperties,q=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,c=(e,t,l)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,D=(e,t)=>{for(var l in t||(t={}))J.call(t,l)&&c(e,l,t[l]);if(S)for(var l of S(t))Z.call(t,l)&&c(e,l,t[l]);return e},C=(e,t)=>j(e,q(t));const z=["ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONNECTION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","ENCLOSED","ESCAPED","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","GOTO","GRANT","GROUP","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERVAL","INTO","IS","ITERATE","JOIN","KEY","KEYS","KILL","LABEL","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MATCH","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NULL","NUMERIC","ON","OPTIMIZE","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","PRECISION","PRIMARY","PROCEDURE","PURGE","RAID0","RANGE","READ","READS","REAL","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STRAIGHT_JOIN","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","WHEN","WHERE","WHILE","WITH","WRITE","X509","XOR","YEAR_MONTH","ZEROFILL"],ee=x({name:"DBAttributeTable",props:{actionButton:{type:Boolean,default:!0}},emits:["added","removed","inserted","dragged","syncDbType"],setup(e,{emit:t}){const l=Y(),T=L(!1),R=L([{title:"字段名称",key:"dbFieldName",width:140,type:i.input,defaultValue:"",placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"},{pattern:/^[a-zA-Z]{1}(?!_)[a-zA-Z0-9_\\$]+$/,message:"命名规则：只能由字母、数字、下划线、$符号组成；必须以字母开头；不能以单个字母加下滑线开头"},{unique:!0,message:"${title}不能重复"},{handler({cellValue:a},o){z.includes(a.toUpperCase())?o(!1,a+"是关键字，不能作为字段名称使用！"):o(!0)}},{handler:O}],disabled:!e.actionButton},{title:"字段备注",key:"dbFieldTxt",width:140,type:i.input,defaultValue:"",placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"字段长度",key:"dbLength",width:120,type:i.inputNumber,defaultValue:32,placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"}],disabled:!e.actionButton},{title:"小数点",key:"dbPointLength",width:100,type:i.inputNumber,defaultValue:0,placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"}],disabled:!e.actionButton},{title:"默认值",key:"dbDefaultVal",width:140,type:i.input,defaultValue:"",disabled:!e.actionButton},{title:"字段类型",key:"dbType",width:140,type:i.select,options:[{title:"String",value:"string"},{title:"Integer",value:"int"},{title:"Double",value:"double"},{title:"Date",value:"Date"},{title:"Datetime",value:"Datetime"},{title:"BigDecimal",value:"BigDecimal"},{title:"Text",value:"Text"},{title:"Blob",value:"Blob"}],defaultValue:"string",placeholder:"请选择${title}",disabled:!e.actionButton,validateRules:[{required:!0,message:"请选择${title}"}]},{title:"主键",key:"dbIsKey",width:80,type:i.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1,disabled:!e.actionButton},{title:"允许空值",key:"dbIsNull",width:80,type:i.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"同步数据库",key:"dbIsPersist",minWidth:80,type:i.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"orderNum",key:"orderNum",type:i.hidden}]);let r=[];const u=w(R),{tableRef:N,loading:s,dataSource:b,tableHeight:m,tableProps:p,setDataSource:g,validateData:h}=u;function U(){t("added",l)}function f(a){r=r.concat(a.deleteRows.map(o=>o.id)),t("removed",C(D({},a),{removeIds:r,target:l}))}function v(a){t("dragged",{oldIndex:a.oldIndex,newIndex:a.newIndex,target:l})}function B(a){t("inserted",C(D({},a),{target:l}))}function y(){return r}function M(a){let{type:o,row:E,col:I,value:d,target:n}=a;o===i.select&&I.key==="dbType"&&((d==="Date"||d==="Datetime")&&t("syncDbType",{row:E,value:d,target:l}),d==="Blob"||d==="Text"||d==="Date"?n.setValues([{rowKey:E.id,values:{dbLength:"0"}}]):d==="int"||d==="double"||d==="BigDecimal"?n.setValues([{rowKey:E.id,values:{dbLength:"10"}}]):E.dbLength==="0"&&n.setValues([{rowKey:E.id,values:{dbLength:"32"}}]))}function V(a,o,E){return a==="has_child"||a==="id"&&E===0}function P(a){N.value.pushRows(a),T.value||t("added",l)}function _(a){return N.value.removeRowsById(a)}function H(){T.value=!0,s.value=!0}function G(){T.value=!1,s.value=!1,t("added",l)}function O({cellValue:a,row:o},E){const{tables:I}=u;if(I){let d=I.dbTable.value.tableRef.dataSource.filter(A=>A.id===o.id);(!d||d.length<=0)&&E(!0);let n=d[0].dbFieldName;n==a&&E(!0);let F=I.idxTable.value.tableRef.getTableData();for(let A of F)A.indexField.split(",").indexOf(n)>=0&&E(!1,"当前字段存在索引配置，请先删除索引再修改字段")}E(!0)}return{tableRef:N,loading:s,columns:R,dataSource:b,setDataSource:g,addBatchBegin:H,addBatchEnd:G,tableAddLine:P,tableHeight:m,tableProps:p,tableDeleteLines:_,handleAdded:U,handleRemoved:f,handleDragged:v,handleInserted:B,handleValueChange:M,handleDisabledDbFieldName:V,validateData:h,getRemoveIds:y,validateExistIndex:O}}});function te(e,t,l,T,R,r){const u=$("JVxeTable");return K(),W(u,X({ref:"tableRef",rowNumber:"",rowSelection:"",dragSort:"",keyboardEdit:"",sortKey:"orderNum",addButtonSettings:"",loading:e.loading,columns:e.columns,dataSource:e.dataSource,toolbar:e.actionButton,maxHeight:e.tableHeight.normal,disabledRows:{dbFieldName:e.handleDisabledDbFieldName}},e.tableProps,{onAdded:e.handleAdded,onRemoved:e.handleRemoved,onDragged:e.handleDragged,onInserted:e.handleInserted,onValueChange:e.handleValueChange}),null,16,["loading","columns","dataSource","toolbar","maxHeight","disabledRows","onAdded","onRemoved","onDragged","onInserted","onValueChange"])}const Re=k(ee,[["render",te]]);export{Re as default};
