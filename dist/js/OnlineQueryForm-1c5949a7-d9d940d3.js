import{B as se}from"./BasicForm-002087c7.js";import"./componentMap-9abc9664.js";import{u as ne}from"./useForm-e1f12926.js";import"./JAddInput-6b7ccad8.js";import"./JSelectUser-acf556b2.js";import"./JSelectDept-6809f298.js";import"./JPopup-65fb74cb.js";import"./index-92811877.js";import"./cron-parser-vendor-f7d0e790.js";import"./index-32f277d2.js";import{Q as ue,b as pe,u as me}from"./jeecg-online-vendor-00671d17.js";import{u as ce,g as de,j as q,k as fe,F as M,m as he,n as ge,o as L}from"./useExtendComponent-48d37d9b-f24eb139.js";import"./JUpload.vue_vue_type_style_index_0_lang-f1676f4d.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-3f3a7c9a.js";import"./BasicTable.vue_vue_type_style_index_0_lang-475d8bfa.js";import"./useTable-8db918c8.js";import"./LinkTableListPiece-34266919-cfc2e8f9.js";import{k as O,r as ye,w as R,J as E,V as k,a5 as W,a6 as A,f as c,a7 as b,aa as I,E as Q,ab as ve,W as J,ap as be,aq as we}from"./vue-bcbaddf9.js";import"./BasicForm.vue_vue_type_style_index_0_lang-49e8445e.js";import"./antd-vue-vendor-a78909e6.js";import"./tinymce-vendor-676f8393.js";import"./lodash-es-vendor-9b741fb8.js";import"./BasicModal-1cadc5ea.js";import"./useWindowSizeFn-4237c8d5.js";import"./vxe-table-vendor-9edfd3ae.js";import"./echarts-vendor-6c8e2159.js";import"./useFormItem-abe9ede2.js";import"./download-c96f5ea0.js";import"./base64Conver-fa2fe1af.js";import"./index-111c68e1.js";import"./index-8674e57c.js";import"./useCountdown-9fb9a8c7.js";import"./index-d77affd4.js";import"./areaDataUtil-661e31ab.js";import"./props-d8943ba3.js";import"./JSelectBiz-293c9f98.js";import"./index-135dbfab.js";import"./codemirror-vendor-611c4582.js";import"./index-c0e274b6.js";import"./bem-83fa3f8d.js";import"./props-c7c3390f.js";import"./useContextMenu-14663a38.js";import"./depart.api-caf6fd8d.js";import"./user.api-d0443f37.js";import"./customExpression-62f5afd1.js";import"./BasicTable-1161a1ed.js";import"./injectionKey-69710956.js";import"./useListPage-d13feb83.js";import"./OnlineSelectCascade-c7baf52b-e78bd629.js";import"./JModalTip-abe1515a-c28a2709.js";var Fe=Object.defineProperty,$=Object.getOwnPropertySymbols,Se=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,z=(s,a,i)=>a in s?Fe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,N=(s,a)=>{for(var i in a||(a={}))Se.call(a,i)&&z(s,i,a[i]);if($)for(var i of $(a))xe.call(a,i)&&z(s,i,a[i]);return s},Y=(s,a,i)=>new Promise((u,w)=>{var C=h=>{try{y(i.next(h))}catch(S){w(S)}},F=h=>{try{y(i.throw(h))}catch(S){w(S)}},y=h=>h.done?u(h.value):Promise.resolve(h.value).then(C,F);y((i=i.apply(s,a)).next())});const _e={name:"OnlineQueryForm",components:{BasicForm:se},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(s,{emit:a}){const i="/online/cgform/api/getQueryInfoVue3/",u=O(null),w=O([]),C=O({xs:24,sm:24,md:12,lg:6,xl:6}),F=O(!1),y=O(!1),h=O({}),S=O([]),{createMessage:U}=me(),{linkTableCard2Select:P}=ce(),d=ye({config:{},cache:{},param:{},status:!1});R(()=>d.status,t=>Y(this,null,function*(){const{config:e,cache:l,param:v}=E(d);let _=Object.assign({},e,l,v);yield G(_)}),{immediate:!0,deep:!0});function n(t,e){return Y(this,null,function*(){d.cache=N({},t),d.param=N({},e),d.status=!d.status})}R(()=>s.id,t=>{t?f():w.value=[]},{immediate:!0});function p(t){return Y(this,null,function*(){let e=[],l={},v=Object.keys(t);for(let r of v){const o=t[r];r==="sys_org_code"&&(o.fieldExtendJson||(o.fieldExtendJson='{"store":"orgCode"}'));let m=o.view;if(q[m]&&(o.view=q[m]),yield fe(r,o,l),o.mode=="group"&&(m=="date"||m=="datetime"||m=="number")){let x=M.createSlotFormSchema(r,o);e.push(x)}else if(o.view===he){let x=ge(o,r);for(let D of x){let V=M.createFormSchema(D.key,D),j=L(e,D.key);j==-1?e.push(V):e[j]=V}}else if(L(e,r)==-1){let x=M.createFormSchema(r,o);e.push(x)}}e.sort(function(r,o){return r.order-o.order});let _=[];e.length>2&&(F.value=!0);let g=[];for(let r=0;r<e.length;r++){let o=e[r];o.setFormRef(u),o.noChange(),o.asSearchForm(),r>1&&(g.push(o.field),o.isHidden());let m=o.getFormItemSchema();o.slot=="groupDatetime"&&(m.colProps={xs:24,sm:24,md:12,lg:8,xl:8}),P(m),_.push(m)}S.value=g,w.value=_,d.config=N({},l),d.status=!d.status})}function f(){return Y(this,null,function*(){let t=yield Z(),e=X(t);a("loaded",t);let{formProperties:l,hasField:v}=K(e,t);if(v==!1){w.value=[];return}yield p(l)})}function G(t){return Y(this,null,function*(){yield de(u),yield H(t),Object.keys(t).length>0&&B()})}function K(t,e){const{searchFieldList:l,joinQuery:v,table:_}=e;let g=!1,r={};return t&&Object.keys(t).map(o=>{l.indexOf(o)>=0&&(v==!0?o.indexOf("@")<0?(r[_+"@"+o]=t[o],g=!0):(r[o]=t[o],g=!0):o.indexOf("@")<0&&(r[o]=t[o],g=!0))}),{formProperties:r,hasField:g}}function X(t){const{properties:e,searchFieldList:l,joinQuery:v,table:_}=t;let g={},r=1;return Object.keys(e).map(o=>{let m=e[o];if(m.view=="table"){let x=m.properties,D=r*100;Object.keys(x).map(V=>{let j=x[V];j.order=D+Number(j.order);let ie=o+"@"+V;g[ie]=j}),r++}else m.order=Number(m.order),g[o]=m}),g}function Z(){let t=`${i}${s.id}`;return new Promise(e=>{pe.get({url:t},{isTransformResponse:!1}).then(l=>{l.success?e(l.result):(e(!1),U.warning(l.message))}).catch(()=>{U.warning("获取查询条件失败!"),e(!1)})})}const[ee,{resetFields:te,setFieldsValue:H,updateSchema:oe,getFieldsValue:re}]=ne({schemas:w,showActionButtonGroup:!1,baseColProps:C,autoSubmitOnEnter:!0,submitFunc(){B()}});function B(){let t=re(),e=Object.assign({},E(d.param),le(t));a("search",e,!0)}function ae(){return Y(this,null,function*(){yield te();const{config:t,param:e}=E(d);let l=Object.assign({},t,e);Object.keys(l).length>0&&(yield H(l)),a("search",l,!1)})}function le(t){return Object.keys(t).map(e=>{t[e]&&t[e]instanceof Array&&(t[e]=t[e].join(","))}),t}return R(()=>y.value,t=>{let e=S.value;if(e&&e.length>0){let l=[];for(let v of e)l.push({field:v,show:t});oe(l)}},{immediate:!1}),{onlineQueryFormRef:u,registerForm:ee,initDefaultValues:n,toggleButtonShow:F,toggleSearchStatus:y,doSearch:B,resetSearch:ae,queryParams:h,formSchemas:w}}},T=s=>(be("data-v-90f5c109"),s=s(),we(),s),Oe={key:0,class:"jeecg-basic-table-form-container p-0"},ke=T(()=>I("span",{class:"group-query-string"},"~",-1)),je=T(()=>I("span",{class:"group-query-string"},"~",-1)),Ye=T(()=>I("span",{class:"group-query-string"},"~",-1)),De={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function Ve(s,a,i,u,w,C){const F=k("a-date-picker"),y=k("a-form-item-rest"),h=k("a-input-number"),S=k("a-button"),U=k("a-icon"),P=k("a-col"),d=k("BasicForm");return u.formSchemas&&u.formSchemas.length>0?(W(),A("div",Oe,[c(d,{ref:"onlineQueryFormRef",onRegister:u.registerForm},{groupDate:b(({model:n,field:p})=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"开始日期",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),ke,c(y,null,{default:b(()=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"结束日期",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupDatetime:b(({model:n,field:p})=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),je,c(y,null,{default:b(()=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupNumber:b(({model:n,field:p})=>[c(h,{placeholder:"开始值",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),Ye,c(y,null,{default:b(()=>[c(h,{placeholder:"结束值",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),formFooter:b(()=>[c(P,{md:6,sm:8},{default:b(()=>[I("span",De,[c(S,{preIcon:"ant-design:search",type:"primary",onClick:u.doSearch},{default:b(()=>[Q("查询")]),_:1},8,["onClick"]),c(S,{preIcon:"ant-design:reload",type:"primary",onClick:u.resetSearch,style:{"margin-left":"8px"}},{default:b(()=>[Q("重置")]),_:1},8,["onClick"]),u.toggleButtonShow?(W(),A("a",{key:0,onClick:a[0]||(a[0]=n=>u.toggleSearchStatus=!u.toggleSearchStatus),style:{"margin-left":"8px"}},[Q(ve(u.toggleSearchStatus?"收起":"展开")+" ",1),c(U,{type:u.toggleSearchStatus?"up":"down"},null,8,["type"])])):J("",!0)])]),_:1})]),_:1},8,["onRegister"])])):J("",!0)}const jt=ue(_e,[["render",Ve],["__scopeId","data-v-90f5c109"]]);export{jt as default};
