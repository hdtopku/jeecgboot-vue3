var c=(f,C,u)=>new Promise((l,s)=>{var b=n=>{try{p(u.next(n))}catch(i){s(i)}},D=n=>{try{p(u.throw(n))}catch(i){s(i)}},p=n=>n.done?l(n.value):Promise.resolve(n.value).then(b,D);p((u=u.apply(f,C)).next())});import j from"./BasicTable-29c6504d.js";import{T as z}from"./componentMap-a6d21ad6.js";import"./BasicTable.vue_vue_type_style_index_0_lang-b7d11241.js";import{u as H}from"./useTable-7e303edd.js";import{u as q,a as G,B as J}from"./index-fb25354c.js";import"./index-8cf3aabb.js";import{_ as Q}from"./UserDrawer.vue_vue_type_script_setup_true_lang-42e0df80.js";import{_ as X}from"./UseSelectModal.vue_vue_type_script_setup_true_lang-72ae80d3.js";import{u as Y,c as Z,e as ee,f as te}from"./role.api-c2a296f6.js";import{u as oe,b as ne}from"./role.data-ac77dc54.js";import{g as ae}from"./user.api-dd1b3184.js";import{E as se}from"./index-fde9c72f.js";import{d as re,k as y,U as m,aV as w,ar as g,bi as t,f as o,u as r,E as _,V as k}from"./vue-c7e3516e.js";const De=re({__name:"RoleUserTable",props:{disableUserEdit:{type:Boolean,default:!1}},emits:["register","hideUserList"],setup(f,{emit:C}){const u=f,l=y([]),s=y(""),[b,{setDrawerProps:D,closeDrawer:p}]=q(e=>c(this,null,function*(){s.value=e.id,v({searchInfo:{roleId:e.id}}),d()})),[n,{openDrawer:i}]=G(),[I,{openModal:S}]=se(),[U,{reload:d,updateTableDataRecord:T,setProps:v}]=H({title:"\u7528\u6237\u5217\u8868",api:Y,columns:oe,formConfig:{labelWidth:120,schemas:ne,autoSubmitOnEnter:!0,actionColOptions:{pull:1}},striped:!0,useSearchForm:!0,showTableSetting:!0,clickToRowSelect:!1,bordered:!0,showIndexColumn:!1,tableSetting:{fullScreen:!0},canResize:!1,rowKey:"id",actionColumn:{width:180,title:"\u64CD\u4F5C",dataIndex:"action",slots:{customRender:"action"},fixed:void 0}}),x={type:"checkbox",columnWidth:50,selectedRowKeys:l,onChange:B};function B(e,a){l.value=e}function E(){i(!0,{isUpdate:!1,selectedroles:[s.value],isRole:!0})}function F(e){return c(this,null,function*(){try{const a=yield ae({userid:e.id});a&&a.length>0&&(e.selectedroles=a)}catch(a){}i(!0,{record:e,isUpdate:!0,isRole:!0})})}function V(e){return c(this,null,function*(){yield te({userId:e.id,roleId:s.value},d)})}function O(){return c(this,null,function*(){yield Z({userIds:l.value.join(","),roleId:s.value},d)})}function A({isUpdate:e,values:a}){e?T(a.id,a):d()}function K(){S(!0)}function L(e){return c(this,null,function*(){yield ee({roleId:s.value,userIdList:e},d)})}function M(e){return[{label:"\u7F16\u8F91",onClick:F.bind(null,e),ifShow:()=>!u.disableUserEdit},{label:"\u53D6\u6D88\u5173\u8054",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u53D6\u6D88\u5173\u8054",confirm:V.bind(null,e)}}]}return(e,a)=>{const h=m("a-button"),R=m("Icon"),N=m("a-menu-item"),P=m("a-menu"),W=m("a-dropdown");return w(),g(r(J),{onRegister:r(b),title:"\u89D2\u8272\u7528\u6237",width:"800",destroyOnClose:""},{default:t(()=>[o(r(j),{onRegister:r(U),rowSelection:x},{tableTitle:t(()=>[f.disableUserEdit?k("",!0):(w(),g(h,{key:0,type:"primary",onClick:E},{default:t(()=>[_(" \u65B0\u589E\u7528\u6237")]),_:1})),o(h,{type:"primary",onClick:K},{default:t(()=>[_(" \u5DF2\u6709\u7528\u6237")]),_:1}),l.value.length>0?(w(),g(W,{key:1},{overlay:t(()=>[o(P,null,{default:t(()=>[o(N,{key:"1",onClick:O},{default:t(()=>[o(R,{icon:"bx:bx-unlink"}),_(" \u53D6\u6D88\u5173\u8054 ")]),_:1})]),_:1})]),default:t(()=>[o(h,null,{default:t(()=>[_("\u6279\u91CF\u64CD\u4F5C "),o(R,{icon:"ant-design:down-outlined"})]),_:1})]),_:1})):k("",!0)]),action:t(({record:$})=>[o(r(z),{actions:M($)},null,8,["actions"])]),_:1},8,["onRegister"]),o(Q,{onRegister:r(n),onSuccess:A},null,8,["onRegister"]),o(X,{onRegister:r(I),onSelect:L},null,8,["onRegister"])]),_:1},8,["onRegister"])}}});export{De as _};
