var N=Object.defineProperty,L=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var z=(e,a,n)=>a in e?N(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,k=(e,a)=>{for(var n in a||(a={}))Y.call(a,n)&&z(e,n,a[n]);if(E)for(var n of E(a))q.call(a,n)&&z(e,n,a[n]);return e},U=(e,a)=>L(e,W(a));var K=(e,a,n)=>new Promise((o,d)=>{var f=i=>{try{t(n.next(i))}catch(c){d(c)}},l=i=>{try{t(n.throw(i))}catch(c){d(c)}},t=i=>i.done?o(i.value):Promise.resolve(i.value).then(f,l);t((n=n.apply(e,a)).next())});import{u as Q,aK as X,z as Z,ap as P,C as J}from"./jeecg-online-vendor-e26fc0e5.js";import{B as ee}from"./index-9c776ac3.js";import{B as ae,Y as j,p as M,z as te}from"./index-ea73cedc.js";import{c as T,k as m,r as D,w as A,u as w,d as F,U as C,a5 as G,a6 as H,f as v,a7 as R,ag as O,aa as le,p as $,s as ne}from"./vue-705b7309.js";import{s as oe}from"./props-d916a2a4.js";import{J as se}from"./JSelectBiz-52839998.js";import{useRuleFormItem as ie}from"./useFormItem-701320d6.js";function ce(e,a){const n=T("selectOptions",m([])),o=T("selectValues",D({value:[],change:!1})),d=T("loadingEcho",m(!1)),f=m([]),l=m([]),t=m([]),i=Q();let c=!0;A(o,()=>{if(o.change==!1){let s={};s[a.rowKey]=o.value.join(","),d.value=c,c=!1,b(s,!0).then().finally(()=>{d.value=c})}l.value=o.value},{immediate:!0});function g(s,r){return K(this,null,function*(){if(l.value=s,a.showSelected&&w(l).length!==w(r).length){let{records:h}=yield e({code:w(l).join(","),pageSize:w(l).length});t.value=h}else t.value=r})}const S={type:a.isRadioSelection?"radio":"checkbox",columnWidth:20,selectedRowKeys:l,onChange:g,preserveSelectedRowKeys:!0},_={dataIndex:"index",width:50};function b(s,r){return K(this,null,function*(){let{records:h}=yield e(s);if(f.value=h,r){let p=[];h.forEach(V=>{p.push({label:V[a.labelKey],value:V[a.rowKey]})}),n.value=p}})}function I(){return K(this,null,function*(){let{records:s}=yield e({code:o.value.join(","),pageSize:o.value.length});l.value=o.value,t.value=s})}function B(s){return K(this,null,function*(){s&&a.showSelected&&I()})}function u(s){let r=[],h=[];if(t.value.forEach(p=>{r.push({label:p[a.labelKey],value:p[a.rowKey]})}),l.value.forEach(p=>{h.push(p)}),n.value=r,a.maxSelectCount&&h.length>a.maxSelectCount)return i.createMessage.warning(`最多只能选择${a.maxSelectCount}条数据`),!1;s&&s(r,h)}function y(s){l.value=l.value.filter(r=>r!=s[a.rowKey]),t.value=t.value.filter(r=>r[a.rowKey]!==s[a.rowKey])}function x(){l.value=[],t.value=[]}return[{onSelectChange:g,getDataSource:b,visibleChange:B,selectOptions:n,selectValues:o,rowSelection:S,indexColumnProps:_,checkedKeys:l,selectRows:t,dataSource:f,getSelectResult:u,handleDeleteSelected:y,reset:x}]}const ue=F({name:"UserSelectModal",components:{BasicModal:ee,BasicTable:X(()=>Z(()=>import("./BasicTable-d7a55d3a.js"),["js/BasicTable-d7a55d3a.js","js/BasicTable.vue_vue_type_style_index_0_lang-22fb7d8c.js","js/vue-705b7309.js","js/jeecg-online-vendor-e26fc0e5.js","js/antd-vue-vendor-cce59da1.js","js/tinymce-vendor-6e169cb2.js","js/lodash-es-vendor-5fc8fca4.js","assets/jeecg-online-vendor-0a2b6c82.css","js/index-ea73cedc.js","js/codemirror-vendor-3f45d0f3.js","js/echarts-vendor-6c8e2159.js","js/vxe-table-vendor-cc7eb3b4.js","assets/index-5575dab6.css","js/BasicForm-af127472.js","js/componentMap-49086925.js","js/useFormItem-701320d6.js","js/index-9c776ac3.js","js/BasicModal-706c423f.js","js/useWindowSizeFn-5fa808c9.js","assets/BasicModal-1e1b2ed9.css","assets/index-361bf2db.css","js/JUpload.vue_vue_type_style_index_0_lang-fca6de33.js","assets/JUpload-ffbeea34.css","js/download-5aaa5ea2.js","js/base64Conver-fa2fe1af.js","js/index-071741d3.js","assets/index-399aa0e3.css","js/index-96b618b7.js","js/useCountdown-910c0305.js","assets/index-15cc10f8.css","js/JAddInput-f981b8f0.js","js/areaDataUtil-213a6b13.js","js/props-d916a2a4.js","js/JSelectBiz-52839998.js","assets/JSelectBiz-ba37f0a8.css","js/index-f4a08334.js","js/index-b7f613fe.js","js/bem-f204c89d.js","js/props-dec3c169.js","js/useContextMenu-cafc8f96.js","assets/useContextMenu-6fcaad79.css","assets/index-a95e0833.css","js/depart.api-35875297.js","assets/JAddInput-1390b0cb.css","js/JSelectDept-89a20b68.js","assets/JSelectDept-c7c08f5d.css","js/JPopup-c3fe6e18.js","assets/JPopup-8672837c.css","js/index-4d36a575.js","assets/index-600d2c21.css","assets/componentMap-524c5264.css","js/BasicForm.vue_vue_type_style_index_0_lang-e085be35.js","assets/BasicForm-384f4697.css","js/useForm-027be146.js","js/injectionKey-69710956.js","assets/BasicTable-d7493b42.css"]),{loading:!0})},props:U(k({},oe),{modalTitle:{type:String,default:"选择用户"}}),emits:["register","getSelectResult"],setup(e,{emit:a,refs:n}){const o=m({x:!1}),d=m(),[f,{closeModal:l}]=ae(()=>{window.innerWidth<900?o.value={x:900}:o.value={x:!1},setTimeout(()=>{d.value&&d.value.setSelectedRowKeys(_.value||[])},800)}),t=P(),i={canResize:!1,bordered:!0,size:"small"},c=Object.assign({},w(e),w(t),i),[{rowSelection:g,visibleChange:S,selectValues:_,indexColumnProps:b,getSelectResult:I,handleDeleteSelected:B,selectRows:u}]=ce(j,c),y=m(e.params),x={baseColProps:{xs:24,sm:8,md:6,lg:8,xl:6,xxl:6},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8},schemas:[{label:"账号",field:"username",component:"JInput"},{label:"姓名",field:"realname",component:"JInput"}]},s=[{title:"用户账号",dataIndex:"username",width:120,align:"left"},{title:"用户姓名",dataIndex:"realname",width:120},{title:"性别",dataIndex:"sex_dictText",width:50},{title:"手机号码",dataIndex:"phone",width:120},{title:"邮箱",dataIndex:"email"},{title:"状态",dataIndex:"status_dictText",width:80}],r={pagination:!1,showIndexColumn:!1,scroll:{y:390},size:"small",canResize:!1,bordered:!0,rowKey:"id",columns:[{title:"用户姓名",dataIndex:"realname",width:40},{title:"操作",dataIndex:"action",align:"center",width:40,slots:{customRender:"action"}}]};function h(){I((p,V)=>{a("getSelectResult",p,V),l()})}return{handleOk:h,searchInfo:y,register:f,indexColumnProps:b,visibleChange:S,getBindValue:c,getUserList:j,formConfig:x,columns:s,rowSelection:g,selectRows:u,selectedTable:r,handleDeleteSelected:B,tableScroll:o,tableRef:d}}}),re=["onClick"];function de(e,a,n,o,d,f){const l=C("BasicTable"),t=C("a-col"),i=C("Icon"),c=C("a-row"),g=C("BasicModal");return G(),H("div",null,[v(g,O(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:"900px",wrapClassName:"j-user-select-modal",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{default:R(()=>[v(c,null,{default:R(()=>[v(t,{span:e.showSelected?18:24},{default:R(()=>[v(l,O({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getUserList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps}),{tableTitle:R(()=>[]),_:1},16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps"])]),_:1},8,["span"]),v(t,{span:e.showSelected?6:0},{default:R(()=>[v(l,O(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:R(({record:S})=>[le("a",{href:"javascript:void(0)",onClick:_=>e.handleDeleteSelected(S)},[v(i,{icon:"ant-design:delete-outlined"})],8,re)]),_:1},16,["dataSource"])]),_:1},8,["span"])]),_:1})]),_:1},16,["onRegister","title","onOk","onVisibleChange"])])}const fe=J(ue,[["render",de]]),me=F({name:"JSelectUser",components:{UserSelectModal:fe,JSelectBiz:se},inheritAttrs:!1,props:{value:M.oneOfType([M.string,M.array]),labelKey:{type:String,default:"realname"},rowKey:{type:String,default:"username"},params:{type:Object,default:()=>{}}},emits:["options-change","change","update:value"],setup(e,{emit:a}){const n=m(),[o,{openModal:d}]=te(),[f]=ie(e,"value","change",n),l=m([]);let t=D({value:[],change:!1});const i=m(!1);$("selectOptions",l),$("selectValues",t),$("loadingEcho",i);const c=m(!1),g=P();ne(()=>{e.value&&_(),e.value||(t.value=[])}),A(t,()=>{t&&(f.value=t.value)});function S(){c.value=!0,d(!0,{isUpdate:!1})}function _(){let u=e.value?e.value:[];u&&typeof u=="string"&&u!="null"&&u!="undefined"?(f.value=u.split(","),t.value=u.split(",")):t.value=u}function b(u,y){l.value=u,f.value=y,t.value=y,a("update:value",y.join(","))}const I=Object.assign({},w(e),w(g));function B(u){a("update:value",u)}return{state:f,attrs:g,selectOptions:l,getBindValue:I,selectValues:t,loadingEcho:i,tag:c,regModal:o,setValue:b,handleOpen:S,handleChange:B}}});function he(e,a,n,o,d,f){const l=C("JSelectBiz"),t=C("UserSelectModal");return G(),H("div",null,[v(l,O({onChange:e.handleChange,onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs),null,16,["onChange","onHandleOpen","loading"]),v(t,O({rowKey:e.rowKey,onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue),null,16,["rowKey","onRegister","onGetSelectResult"])])}const be=J(me,[["render",he],["__scopeId","data-v-615d1586"]]);export{fe as U,be as n,ce as u};
