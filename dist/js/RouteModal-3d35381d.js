var K=(h,O,V)=>new Promise((P,T)=>{var B=i=>{try{x(V.next(i))}catch(v){T(v)}},I=i=>{try{x(V.throw(i))}catch(v){T(v)}},x=i=>i.done?P(i.value):Promise.resolve(i.value).then(B,I);x((V=V.apply(h,O)).next())});import{d as be,r as z,M as Re,l as C,e as Ve,u as n,V as c,a7 as s,ac as w,aa as r,f as a,a8 as p,ab as b,F as _,E as y,ae as R,ad as D,a9 as te,W as U,af as xe,n as ae}from"./vue-50733b77.js";import{u as Ue,B as Oe}from"./index-52f25951.js";import{ap as F}from"./jeecg-online-vendor-d3e1865b.js";import{cT as N,cA as Be,cL as j,co as Ie}from"./antd-vue-vendor-c5335947.js";const qe=h=>F.get({url:"/sys/gatewayRoute/list",params:h}),$e=h=>F.post({url:"/sys/gatewayRoute/updateAll",params:h}),Ee=(h,O)=>F.delete({url:"/sys/gatewayRoute/delete",data:h},{joinParamsToUrl:!0}).then(()=>{O()}),ze={key:0},De={key:1},Pe={key:2},Te={key:3},He={class:"btn",style:{"padding-top":"10px"}},Le={class:"btn",style:{"padding-top":"10px"}},Me=be({__name:"RouteModal",emits:["register","success"],setup(h,{emit:O}){const V=z({xs:{span:24},sm:{span:5}}),P=z({xs:{span:24},sm:{span:16}}),T=Re(),B=C(!0),I=C(),x=C();let i=z({inputVisible:!1,inputValue:""});const v=C(0),$=C(-1),ne={routerId:[{required:!0,message:"routerId不能为空",trigger:"blur"}],name:[{required:!0,message:"路由名称不能为空",trigger:"blur"}],uri:[{required:!0,message:"uri不能为空",trigger:"blur"}]},S=["Path","Host","Method","After","Before","Between","RemoteAddr"],H=[{key:1,name:"限流过滤器"}],le=C([{name:"Path",args:[]},{name:"Header",args:{header:"",regexp:""}},{name:"Query",args:{param:"",regexp:""}},{name:"Method",args:[]},{name:"Host",args:[]},{name:"Cookie",args:{name:"",regexp:""}},{name:"After",args:[]},{name:"Before",args:[]},{name:"Between",args:[]},{name:"RemoteAddr",args:[]}]),q=C();let u=z({});const[re,{setDrawerProps:L,closeDrawer:ue}]=Ue(e=>K(this,null,function*(){B.value=!!(e!=null&&e.isUpdate),L({confirmLoading:!1}),ie(),n(B)&&(u=Object.assign(u,e.record))})),se=Ve(()=>n(B)?"编辑路由":"新增路由");function oe(e,l){let d=e.args.filter(m=>m!==l);e.args=d}function ie(){u=Object.assign(u,{id:"",routerId:"",name:"",uri:"",status:1,predicates:[],filters:[]})}function de(e){u.predicates.push({args:e.args,name:e.name})}function pe(e,l,d){l[d]=e.target.value}function ce(e,l,d,m){v.value=m,$.value=d,i.inputValue=l,ae(()=>{x.value[0].focus()})}function fe(e,l){i.inputValue="",i.inputVisible=!0,v.value=l,ae(()=>{I.value[0].focus()})}function E(e){}function J(e,l){e.predicates.splice(l,1)}function me(e,l){e.args.splice(l,1)}function ge(e,l){e.filters.splice(l,1)}function ve(e){e.args.push({key:"key"+e.args.length+1,value:""})}function _e(e){e.key==0&&u.filters.push({args:[{key:"name",value:"default"},{key:"fallbackUri",value:"forward:/fallback"}],name:"Hystrix",title:H[0].name}),e.key==1&&u.filters.push({args:[{key:"key-resolver",value:"#{@ipKeyResolver}"},{key:"redis-rate-limiter.replenishRate",value:20},{key:"redis-rate-limiter.burstCapacity",value:20}],name:"RequestRateLimiter",title:H[0].name})}function Q(e){let l=e.args;const d=i.inputValue;d&&l.indexOf(d)===-1&&(e.args=[...l,i.inputValue]),i.inputVisible=!1,i.inputValue="",$.value=-1,v.value=-1}function W(e,l,d){i.inputValue&&(e.args[d]=i.inputValue),$.value=-1,v.value=-1}function Ae(){}function ye(){return K(this,null,function*(){yield q.value.validate().then(()=>{try{L({confirmLoading:!0});let e=Object.assign({},u,{predicates:JSON.stringify(u.predicates),filters:JSON.stringify(u.filters)});$e({router:e}).then(()=>{ue(),O("success")})}finally{L({confirmLoading:!1})}})})}return(e,l)=>{const d=c("a-input"),m=c("a-form-item"),ke=c("a-switch"),M=c("a-divider"),G=c("a-tag"),X=c("a-col"),he=c("a-row"),Y=c("a-menu-item"),Z=c("a-menu"),A=c("a-button"),ee=c("a-dropdown"),Ce=c("a-form-item-rest"),we=c("a-form");return s(),w(n(Oe),xe(e.$attrs,{onRegister:n(re),title:se.value,width:"30%",onOk:ye,destroyOnClose:"",showFooter:""}),{default:r(()=>[a(we,{ref_key:"formRef",ref:q,"label-col":V,"wrapper-col":P,model:n(u),rules:ne},{default:r(()=>[a(m,{label:"路由ID",name:"routerId"},{default:r(()=>[a(d,{value:n(u).routerId,"onUpdate:value":l[0]||(l[0]=t=>n(u).routerId=t),placeholder:"路由唯一ID"},null,8,["value"])]),_:1}),a(m,{label:"路由名称",name:"name"},{default:r(()=>[a(d,{value:n(u).name,"onUpdate:value":l[1]||(l[1]=t=>n(u).name=t),placeholder:"路由名称"},null,8,["value"])]),_:1}),a(m,{label:"路由URI",name:"uri"},{default:r(()=>[a(d,{value:n(u).uri,"onUpdate:value":l[2]||(l[2]=t=>n(u).uri=t),placeholder:"路由URL"},null,8,["value"])]),_:1}),a(m,{label:"路由状态",name:"status"},{default:r(()=>[a(ke,{"default-checked":"","checked-value":1,"un-checked-value":0,checked:n(u).status,"onUpdate:checked":l[3]||(l[3]=t=>n(u).status=t)},null,8,["checked"])]),_:1}),a(m,{name:"predicates",label:"路由条件"},{default:r(()=>[(s(!0),p(_,null,b(n(u).predicates,(t,k)=>(s(),p("div",null,[S.includes(t.name)?(s(),p(_,{key:0},[a(M,null,{default:r(()=>[y(R(t.name)+" ",1),a(n(N),{size:"22",onClick:o=>J(n(u),k)},null,8,["onClick"])]),_:2},1024),D("div",null,[(s(!0),p(_,null,b(t.args,(o,f)=>(s(),p(_,null,[f==$.value&&k==v.value?(s(),w(d,{key:0,ref_for:!0,ref_key:"inputRef2",ref:x,type:"text",size:"small",style:{width:"190px"},value:n(i).inputValue,"onUpdate:value":l[4]||(l[4]=g=>n(i).inputValue=g),onChange:E,onBlur:g=>W(t,o,f),onKeyup:te(g=>W(t,o,f),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),w(G,{key:o,style:{"margin-bottom":"2px"},closable:!0,onClose:()=>oe(t,o),onClick:g=>ce(t,o,f,k)},{default:r(()=>[y(R(o),1)]),_:2},1032,["onClose","onClick"]))],64))),256)),n(i).inputVisible&&k==v.value?(s(),w(d,{key:0,ref_for:!0,ref_key:"inputRef",ref:I,type:"text",size:"small",style:{width:"100px"},value:n(i).inputValue,"onUpdate:value":l[5]||(l[5]=o=>n(i).inputValue=o),onChange:E,onBlur:o=>Q(t),onKeyup:te(o=>Q(t),["enter"])},null,8,["value","onBlur","onKeyup"])):(s(),w(G,{key:1,style:{background:"#fff",borderstyle:"dashed","margin-bottom":"2px"},onClick:o=>fe(t,k)},{default:r(()=>[a(n(Be),{size:"22"}),y(" 新建"+R(t.name),1)]),_:2},1032,["onClick"]))])],64)):U("",!0),S.includes(t.name)?U("",!0):(s(),p(_,{key:1},[a(M,null,{default:r(()=>[y(R(t.name)+" ",1),a(n(N),{size:"22",onClick:o=>J(n(u),k)},null,8,["onClick"])]),_:2},1024),D("div",null,[(s(!0),p(_,null,b(t.args,(o,f)=>(s(),w(he,null,{default:r(()=>[a(X,{span:5,style:{"margin-top":"8px"}},{default:r(()=>[f=="header"?(s(),p("span",ze,"Header名称")):U("",!0),f=="regexp"?(s(),p("span",De,"参数值")):U("",!0),f=="param"?(s(),p("span",Pe,"参数名")):U("",!0),f=="name"?(s(),p("span",Te,"参数名")):U("",!0)]),_:2},1024),a(X,{span:18},{default:r(()=>[a(d,{defaultValue:o,placeholder:"参数值",style:{width:"70%","margin-right":"8px","margin-top":"3px"},onChange:g=>pe(g,t.args,f)},null,8,["defaultValue","onChange"])]),_:2},1024)]),_:2},1024))),256))])],64))]))),256)),D("p",He,[a(ee,null,{overlay:r(()=>[a(Z,null,{default:r(()=>[(s(!0),p(_,null,b(le.value,t=>(s(),w(Y,{key:t.name,onClick:k=>de(t)},{default:r(()=>[y(R(t.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:r(()=>[a(A,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:r(()=>[y(" 添加路由条件 "),a(n(j),{size:22})]),_:1})]),_:1})])]),_:1}),a(m,{name:"predicates",label:"过滤器"},{default:r(()=>[(s(!0),p(_,null,b(n(u).filters,(t,k)=>(s(),p("div",null,[a(M,null,{default:r(()=>[y(R(t.name)+" ",1),a(n(N),{size:"22",onClick:o=>ge(n(u),k)},null,8,["onClick"])]),_:2},1024),(s(!0),p(_,null,b(t.args,(o,f)=>(s(),p("div",{key:o.key},[a(Ce,null,{default:r(()=>[a(d,{value:o.key,"onUpdate:value":g=>o.key=g,placeholder:"参数键",style:{width:"45%","margin-right":"8px"}},null,8,["value","onUpdate:value"]),a(d,{value:o.value,"onUpdate:value":g=>o.value=g,placeholder:"参数值",style:{width:"40%","margin-right":"8px","margin-top":"3px"}},null,8,["value","onUpdate:value"])]),_:2},1024),a(n(Ie),{size:22,onClick:g=>me(t,f)},null,8,["onClick"])]))),128)),a(A,{type:"dashed",style:{"margin-left":"28%",width:"37%","margin-top":"5px"},size:"small",onClick:o=>ve(t)},{default:r(()=>[a(n(j),{size:22}),y(" 添加参数 ")]),_:2},1032,["onClick"])]))),256)),D("p",Le,[a(ee,null,{overlay:r(()=>[a(Z,{onClick:_e},{default:r(()=>[(s(),p(_,null,b(H,t=>a(Y,{key:t.key,name:t.name},{default:r(()=>[y(R(t.name),1)]),_:2},1032,["name"])),64))]),_:1})]),default:r(()=>[a(A,{type:"dashed",style:{"margin-left":"8px",width:"100%"}},{default:r(()=>[y(" 添加过滤器 "),a(n(j))]),_:1})]),_:1})])]),_:1})]),_:1},8,["label-col","wrapper-col","model"])]),_:1},16,["onRegister","title"])}}}),Je=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{Je as R,Me as _,Ee as d,qe as g};
