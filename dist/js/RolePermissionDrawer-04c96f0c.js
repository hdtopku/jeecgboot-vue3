var k=(f,D,d)=>new Promise((p,c)=>{var _=n=>{try{s(d.next(n))}catch(u){c(u)}},v=n=>{try{s(d.throw(n))}catch(u){c(u)}},s=n=>n.done?p(n.value):Promise.resolve(n.value).then(_,v);s((d=d.apply(f,D)).next())});import{d as z,l as i,V as g,a7 as S,ac as P,aa as t,E as l,f as a,u as o,ae as G,W as H,af as J,a5 as Q,a6 as U,ad as b}from"./vue-ebecda47.js";import{a as X,u as Y,B as Z}from"./index-5c1c038a.js";import{_ as ee}from"./index-097af6f9.js";import{P as te}from"./index-85cfc899.js";import ae from"./RoleDataRuleDrawer-48756899.js";import{m as oe,n as T,o as le}from"./role.api-b91d30ca.js";import{_ as se}from"./jeecg-online-vendor-cfb58502.js";import"./antd-vue-vendor-b75e8c06.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-cd7703c8.js";import"./bem-311698ef.js";import"./vxe-table-vendor-4aae63bf.js";import"./props-13a58630.js";import"./useContextMenu-eb481e60.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";const A=f=>(Q("data-v-ce6058ab"),f=f(),U(),f),ne=A(()=>b("div",{class:"line"},null,-1)),re=A(()=>b("div",{class:"line"},null,-1)),ie=z({__name:"RolePermissionDrawer",emits:["register"],setup(f,{emit:D}){const d=i([]),p=i([]),c=i([]),_=i([]),v=i([]),s=i(""),n=i(null),u=i(!1),w=i([]),h=i(!0),[B,{openDrawer:N}]=X(),[V,{setDrawerProps:R,closeDrawer:I}]=Y(e=>k(this,null,function*(){yield L(),R({confirmLoading:!1,loading:!0}),s.value=e.roleId;const r=yield oe();d.value=r.treeList,p.value=r.ids,w.value=r.ids;const m=yield T({roleId:o(s)});c.value=m,_.value=m,R({loading:!1})}));function $(e){c.value=e.checked?e.checked:e}function E(e){e&&e.length>0&&(v.value=e),N(!0,{functionId:o(v)[0],roleId:o(s)})}function L(){d.value=[],p.value=[],c.value=[],_.value=[],v.value=[],s.value=""}function j(){const e=o(n);if(!e)throw new Error("tree is null!");return e}function x(e){return k(this,null,function*(){let r={roleId:o(s),permissionIds:o(j().getCheckedKeys()).join(","),lastpermissionIds:o(_).join(",")};if(u.value===!1&&(yield q(r)),e)I();else{const m=yield T({roleId:o(s)});_.value=m}})}function q(e){return k(this,null,function*(){u.value=!0,yield le(e),setTimeout(()=>{u.value=!1},500)})}function F({key:e}){e==="checkAll"?c.value=p.value:e==="cancelCheck"?c.value=[]:e==="openAll"?w.value=p.value:e==="closeAll"?w.value=[]:e==="relation"?h.value=!1:h.value=!0}return(e,r)=>{const m=g("Icon"),y=g("a-menu-item"),M=g("a-menu"),O=g("a-dropdown"),K=g("a-button");return S(),P(o(Z),J(e.$attrs,{onRegister:o(V),width:"650px",destroyOnClose:"",showFooter:""}),{title:t(()=>[l(" 角色权限配置 "),a(O,null,{overlay:t(()=>[a(M,{onClick:F},{default:t(()=>[a(y,{key:"checkAll"},{default:t(()=>[l("选择全部")]),_:1}),a(y,{key:"cancelCheck"},{default:t(()=>[l("取消选择")]),_:1}),ne,a(y,{key:"openAll"},{default:t(()=>[l("展开全部")]),_:1}),a(y,{key:"closeAll"},{default:t(()=>[l("折叠全部")]),_:1}),re,a(y,{key:"relation"},{default:t(()=>[l("层级关联")]),_:1}),a(y,{key:"standAlone"},{default:t(()=>[l("层级独立")]),_:1})]),_:1})]),default:t(()=>[a(m,{icon:"ant-design:more-outlined",class:"more-icon"})]),_:1})]),footer:t(()=>[a(o(te),{title:"确定放弃编辑？",onConfirm:o(I),okText:"确定",cancelText:"取消"},{default:t(()=>[l("取消")]),_:1},8,["onConfirm"]),a(K,{onClick:r[0]||(r[0]=C=>x(!1)),type:"primary",loading:u.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:t(()=>[l("仅保存")]),_:1},8,["loading"]),a(K,{onClick:r[1]||(r[1]=C=>x(!0)),type:"primary",loading:u.value},{default:t(()=>[l("保存并关闭")]),_:1},8,["loading"])]),default:t(()=>[a(o(ee),{ref_key:"treeRef",ref:n,checkable:"",treeData:d.value,checkedKeys:c.value,expandedKeys:w.value,selectedKeys:v.value,checkStrictly:h.value,clickRowToExpand:!1,title:"所拥有的的权限",onCheck:$,onSelect:E},{title:t(({slotTitle:C,ruleFlag:W})=>[l(G(C)+" ",1),W?(S(),P(m,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):H("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys","checkStrictly"]),a(ae,{onRegister:o(B)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});const xe=se(ie,[["__scopeId","data-v-ce6058ab"]]);export{xe as default};
