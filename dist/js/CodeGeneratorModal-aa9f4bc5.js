import{bW as ee,ad as w}from"./jeecg-online-vendor-12004772.js";import{B as te}from"./BasicForm-030e7c21.js";import"./componentMap-90ab712d.js";import{u as oe}from"./useForm-ae9e1cbd.js";import"./JAddInput-dff0b84f.js";import{aj as T,A as ae,E as L,aP as R}from"./index-6916e394.js";import{B as le}from"./index-a882524d.js";import{b as ie}from"./useSchemas-fa1fd633.js";import re from"./CodeFileListModal-3a5090c3.js";import se from"./FileSelectModal-14dcc02b.js";import"./antd-vue-vendor-1561c1ba.js";import"./CodeFileViewModal-3eec2c93.js";import{d as ne,k as f,e as E,r as C,n as ue,U as m,aV as k,as as me,f as g,bi as S,ar as ce,aQ as pe,V as de,F as fe}from"./vue-c7e3516e.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./BasicForm.vue_vue_type_style_index_0_lang-8cb333b2.js";import"./BasicModal-b901e352.js";import"./useWindowSizeFn-581ed1a8.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./useFormItem-cc50e63d.js";import"./JUpload.vue_vue_type_style_index_0_lang-5851070a.js";import"./download-fc124faf.js";import"./base64Conver-4e359726.js";import"./index-d83c9bcd.js";import"./index-6d615beb.js";import"./useCountdown-61c82faf.js";import"./index-fcc2460e.js";import"./areaDataUtil-13d415af.js";import"./useSelectBiz-f95680cd.js";import"./props-18305405.js";import"./index-3ce15f67.js";import"./bem-2be191b9.js";import"./props-c3781b9d.js";import"./useContextMenu-1b1215cd.js";import"./useTreeBiz-cda2af6e.js";import"./index-c5567c31.js";import"./depart.api-de6ffddd.js";import"./validator-a64fcad8.js";import"./user.api-ea86029c.js";var N=(t,u,i)=>new Promise((c,b)=>{var h=a=>{try{r(i.next(a))}catch(o){b(o)}},n=a=>{try{r(i.throw(a))}catch(o){b(o)}},r=a=>a.done?c(a.value):Promise.resolve(a.value).then(h,n);r((i=i.apply(t,u)).next())});const ge=ne({name:"CodeGenerator",components:{BasicForm:te,BasicModal:le,FileSelectModal:se,CodeFileListModal:re},emits:["register"],setup(t){const u="JEECG_ONL_PROJECT_PATH",i=f(!0),c=f(),b=E(()=>i.value?800:1200),h=f("\u4EE3\u7801\u751F\u6210"),n=f(!1),r=f(""),a=C({projectPath:"",packageStyle:"service",jspMode:"",jformType:"1",tableName_tmp:"",ftlDescription:"",entityName:"",codeTypes:"controller,service,dao,mapper,entity,vue"}),o=C({}),F=f([]),p=C({dataSource:[],columns:[{title:"\u5B50\u8868\u540D",key:"tableName",type:T.input,disabled:!0,validateRules:[{required:!0,message:"\u8BF7\u8F93\u5165${title}"}]},{title:"\u5B50\u8868\u5B9E\u4F53",key:"entityName",type:T.input,validateRules:[{required:!0,message:"\u8BF7\u8F93\u5165${title}"}]},{title:"\u529F\u80FD\u8BF4\u660E",key:"ftlDescription",type:T.input,validateRules:[{required:!0,message:"\u8BF7\u8F93\u5165${title}"}]}]}),M=E(()=>p.dataSource.length>0),{formSchemas:D}=ie(t,{onProjectPathChange:X,onProjectPathSearch:z,jspModeOptions:F},i),[O,{resetFields:V,setFieldsValue:B,validate:G}]=oe({schemas:D,showActionButtonGroup:!1,labelAlign:"right"}),[$,{closeModal:P}]=ae(e=>N(this,null,function*(){yield V(),r.value=e.code,n.value=!1,p.dataSource=[],F.value=[],x(),Object.assign(o,a),J()}));function J(){return N(this,null,function*(){let{main:e,sub:l,jspModeList:d,projectPath:s}=yield w.get({url:"/online/cgform/head/tableInfo",params:{code:r.value}}),v=[];for(let y of d){const{code:j,note:Z}=y;j=="many"||v.push({label:Z,value:j})}F.value=v,e.isTree=="Y"?o.jspMode="tree":o.jspMode=v[0].value,i.value=e.tableType==1,h.value="\u4EE3\u7801\u751F\u6210\u3010"+e.tableName+"\u3011",o.projectPath||(o.projectPath=s,window.localStorage.setItem(u,s)),o.jformType=e.tableType+"",o.tableName_tmp=e.tableName,o.ftlDescription=e.tableTxt;let _=R(e.tableName);o.entityName=_.substring(0,1).toUpperCase()+_.substring(1),yield ue(),B(o),l&&l.length>0&&(p.dataSource=l.map(y=>({tableName:y.tableName,entityName:Y(y.tableName),ftlDescription:y.tableTxt})))})}const[I,{openModal:A}]=L();function H(){return N(this,null,function*(){try{const e=yield G();let l=Object.assign({},e,{code:r.value,tableName:e.tableName_tmp});if(M.value){if(yield c.value.validateTable())return;l.subList=c.value.getTableData()}n.value=!0;let d=yield q(l);A(!0,{codeList:d.codeList,pathKey:d.pathKey,tableName:e.tableName_tmp}),P()}catch(e){}finally{n.value=!1}})}function q(e){return new Promise((l,d)=>{w.post({url:"/online/cgform/api/codeGenerate",params:e},{isTransformResponse:!1}).then(s=>{if(s.success){let v=s.result,_=s.message;l({codeList:v,pathKey:_})}else this.$message.error(s.message),d(s.message)})})}function K(){P()}const[U,W]=L();function z(){W.openModal(!0,{})}function Q(e){window.localStorage.setItem(u,e),B({projectPath:e})}function Y(e){let l=R(e);return l.substring(0,1).toUpperCase()+l.substring(1)}function x(){let e=window.localStorage.getItem(u);e&&(a.projectPath=e)}function X(e){e.target.value&&window.localStorage.setItem(u,e.target.value)}return{title:h,modalWidth:b,confirmLoading:n,subTable:p,showSubTable:M,onSubmit:H,onCancel:K,onFileSelect:Q,registerFileSelectModal:U,subTableRef:c,registerForm:O,registerModal:$,registerCodeFileListModal:I}}});function be(t,u,i,c,b,h){const n=m("BasicForm"),r=m("JVxeTable"),a=m("a-card"),o=m("a-spin"),F=m("BasicModal"),p=m("FileSelectModal"),M=m("code-file-list-modal");return k(),me(fe,null,[g(F,{onRegister:t.registerModal,title:t.title,width:t.modalWidth,confirmLoading:t.confirmLoading,okText:"\u5F00\u59CB\u751F\u6210",cancelText:"\u53D6\u6D88",onOk:t.onSubmit,onCancel:t.onCancel},{default:S(()=>[g(o,{spinning:t.confirmLoading},{default:S(()=>[g(n,{onRegister:t.registerForm},null,8,["onRegister"]),t.showSubTable?(k(),ce(a,{key:0,title:"\u5B50\u8868\u4FE1\u606F",size:"small"},{default:S(()=>[g(r,pe({ref:"subTableRef",rowNumber:"",maxHeight:580},t.subTable),null,16)]),_:1})):de("",!0)]),_:1},8,["spinning"])]),_:1},8,["onRegister","title","width","confirmLoading","onOk","onCancel"]),g(p,{onRegister:t.registerFileSelectModal,onSelect:t.onFileSelect},null,8,["onRegister","onSelect"]),g(M,{onRegister:t.registerCodeFileListModal},null,8,["onRegister"])],64)}var it=ee(ge,[["render",be]]);export{it as default};
