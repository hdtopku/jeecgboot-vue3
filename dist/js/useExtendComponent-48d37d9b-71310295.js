var et=Object.defineProperty;var tt=(n,e,t)=>e in n?et(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ie=(n,e,t)=>(tt(n,typeof e!="symbol"?e+"":e,t),t);import{a as add,Q}from"./componentMap-49086925.js";import{B as useModalInner,p as propTypes,z as useModal,d as useDebounceFn,g as getFileAccessHttpUrl,V as ne$1}from"./index-ea73cedc.js";import{B as BasicModal}from"./index-9c776ac3.js";import{aF as usePermissionStore,U as h,aG as MinusCircleFilled,aH as replaceAll,b as defHttp,f as filterMultiDictText,ag as importViewsFile,s as useUserStore,ab as ae,ac as zt,ad as Qt,B as getToken,ae as goJmReportViewPage,u as useMessage}from"./jeecg-online-vendor-e26fc0e5.js";import{B as BasicForm}from"./BasicForm-af127472.js";import{u as useForm}from"./useForm-027be146.js";import"./JAddInput-f981b8f0.js";import"./JSelectUser-2142310a.js";import"./JSelectDept-89a20b68.js";import"./JPopup-c3fe6e18.js";import{U as UploadTypeEnum,c as createImgPreview}from"./JUpload.vue_vue_type_style_index_0_lang-fca6de33.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-8b152429.js";import{d as duplicateCheck}from"./user.api-7d781741.js";import{C as CustomExpression}from"./customExpression-62f5afd1.js";import K from"./BasicTable-d7a55d3a.js";import"./useTable-5917148d.js";import{useListPage}from"./useListPage-2d6ddbd7.js";import{k as ref,r as reactive,w as watch,J as toRaw,e as computed,u as unref,a4 as useRouter,n as nextTick,s as watchEffect,q as h$1,X as markRaw,a2 as defineAsyncComponent,U as resolveComponent,a5 as openBlock,a9 as createBlock,a6 as createElementBlock,f as createVNode,d as defineComponent,a7 as withCtx,E as createTextVNode,ab as toDisplayString,V as createCommentVNode,ag as mergeProps,aa as createBaseVNode,F as Fragment,a8 as renderList,am as normalizeClass}from"./vue-705b7309.js";import{R as REGION_DATA}from"./areaDataUtil-213a6b13.js";import v from"./LinkTableListPiece-34266919-8b805b02.js";import z from"./OnlineSelectCascade-c7baf52b-f3a78ed9.js";import S from"./JModalTip-abe1515a-5122e323.js";import{V as PlusOutlined,E as EditOutlined,_,cm as Button}from"./antd-vue-vendor-cce59da1.js";class Area{constructor(e){Ie(this,"all");e||(e=REGION_DATA);let t=[];const o=e[86];Object.keys(o).map(c=>{t.push({id:c,text:o[c],pid:"86",index:1});const l=e[c];Object.keys(l).map(i=>{t.push({id:i,text:l[i],pid:c,index:2});const C=e[i];C&&Object.keys(C).map(b=>{t.push({id:b,text:C[b],pid:i,index:3})})})}),this.all=t}get pca(){return this.all}getCode(e){if(!e||e.length==0)return"";for(let t of this.all)if(t.text===e)return t.id}getText(e,t=3){if(!e||e.length==0)return"";let o=[];return this.getAreaBycode(e,o,t),o.join("/")}getRealCode(e){let t=[];return this.getPcode(e,t,3),t}getPcode(e,t,o){for(let c of this.all)c.id===e&&c.index==o&&(t.unshift(e),c.pid!="86"&&this.getPcode(c.pid,t,--o))}getAreaBycode(e,t,o){for(let c of this.all)c.id===e&&c.index==o&&(t.unshift(c.text),c.pid!="86"&&this.getAreaBycode(c.pid,t,--o))}}const jeecgAreaData=new Area,getAreaTextByCode=function(n){let e=3;return n&&n.includes(",")&&(e=n.split(",").length,n=n.substr(n.lastIndexOf(",")+1)),jeecgAreaData.getText(n,e)};var je=Object.defineProperty,We=Object.defineProperties,Je=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,Te=(n,e,t)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ne=(n,e)=>{for(var t in e||(e={}))He.call(e,t)&&Te(n,t,e[t]);if(ve)for(var t of ve(e))Ue.call(e,t)&&Te(n,t,e[t]);return n},pe=(n,e)=>We(n,Je(e)),J=(n,e,t)=>new Promise((o,c)=>{var l=b=>{try{C(t.next(b))}catch(D){c(D)}},i=b=>{try{C(t.throw(b))}catch(D){c(D)}},C=b=>b.done?o(b.value):Promise.resolve(b.value).then(l,i);C((t=t.apply(n,e)).next())});const SUBMIT_FLOW_KEY="jeecg_submit_form_and_flow",SUBMIT_FLOW_ID="flow_submit_id",ONL_FORM_TABLE_NAME="online_form_table_name",VALIDATE_FAILED="validate-failed",SETUP="setup",ENHANCEJS="EnhanceJS",FORM_VIEW_TO_QUERY_VIEW={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},POP_CONTAINER=".jeecg-online-modal .ant-modal-content",ONL_AUTH_PRE="online_";class IFormSchema{constructor(e,t){this._data=t,this.field=e,this.label=t.title,this.hidden=!1,this.order=t.order||999,this.required=!1,this.onlyValidator="",this.setFieldsValue="",this.hasChange=!0,e.indexOf("@")>0?this.pre=e.substring(0,e.indexOf("@")+1):this.pre="",this.schemaProp={},this.searchForm=!1,this.disabled=!1,this.popContainer="",this.handleWidgetAttr(t),this.inPopover=!1,this.labelLength=4,this.initLabelLength()}getFormItemSchema(){let e=this.getItem();return this.addDefaultChangeEvent(e),e}getItem(){let e={field:this.field,label:this.label,labelLength:this.labelLength,component:"Input",itemProps:{labelCol:{class:"online-form-label"}}},t=this.getRule();return t.length>0&&this.onlyValidator&&(e.rules=t),this.hidden===!0&&(e.show=!1),e}setFormRef(e){this.formRef=e}isHidden(){return this.hidden=!0,this}isRequired(e){return e&&e.length>0&&e.indexOf(this.field)>=0&&(this.required=!0),this}initLabelLength(){let e=this.getExtendData();e&&e.labelLength&&(this.labelLength=e.labelLength)}getExtendData(){let e={},{fieldExtendJson:t}=this._data;if(t&&typeof t=="string")try{let o=JSON.parse(t);e=ne({},o)}catch(o){}return e}getRelatedHideFields(){return[]}getPlaceholder(){return"请输入"+this.label}setOnlyValidateFun(e){e&&(this.onlyValidator=(t,o)=>J(this,null,function*(){let c=yield e(t,o);return c?Promise.reject(c):Promise.resolve()}))}getRule(){let e=[];const{view:t,errorInfo:o,pattern:c,type:l}=this._data;if(this.required===!0){let i=this.getPlaceholder();o&&(i=o),t=="sel_depart"||t=="sel_user"?this.schemaProp.required=!0:e.push({required:!0,message:i})}if(t=="sel_user"&&c==="only"&&this.onlyValidator&&e.push({validator:this.onlyValidator}),t==="list"||t==="radio"||t==="markdown"||t==="pca"||t.indexOf("sel")>=0||t==="time"||t.indexOf("upload")>=0||t.indexOf("file")>=0||t.indexOf("image")>=0)return e;if(c)if(c==="only")this.onlyValidator&&e.push({validator:this.onlyValidator});else if(c==="z")l=="number"||l=="integer"||e.push({pattern:/^-?\d+$/,message:"请输入整数"});else{let i=o||"正则表达式不正确";e.push({pattern:c,message:i})}return e}addDefaultChangeEvent(e){this.hasChange&&(e.componentProps||(e.componentProps={}),this.disabled==!0&&(e.componentProps.disabled=!0),e.componentProps.hasOwnProperty("onChange")||(e.componentProps.onChange=(t,o)=>{t instanceof Event&&(t=t.target.value),t instanceof Array&&(t=t.join(",")),!this.formRef||!this.formRef.value||!this.formRef.value.$formValueChange||this.formRef.value.$formValueChange(this.field,t,o)})),Object.keys(this.schemaProp).map(t=>{e[t]=this.schemaProp[t]})}noChange(){this.hasChange=!1}updateField(e){this.field=e}setFunctionForFieldValue(e){e&&(this.setFieldsValue=e)}asSearchForm(){this.searchForm=!0}getModalAsContainer(){let e=this.getPopContainer();return document.querySelector(e)}getPopContainer(){return this.searchForm===!0?"body":this.inPopover===!0?`.${this.popContainer}`:this.popContainer?`.${this.popContainer} .ant-modal-content`:POP_CONTAINER}handleWidgetAttr(e){e.ui&&e.ui.widgetattrs&&e.ui.widgetattrs.disabled==!0&&(this.disabled=!0)}setCustomPopContainer(e){this.popContainer=e}getLinkFieldInfo(){return""}setOtherInfo(e){}isInPopover(){this.inPopover=!0}}class InputWidget extends IFormSchema{getItem(){let e=super.getItem();return this.hidden===!0&&(e.show=!1),e}}var DateFormat=(n=>(n.datetime="YYYY-MM-DD HH:mm:ss",n.date="YYYY-MM-DD",n))(DateFormat||{});class DateWidget extends IFormSchema{constructor(e,t){super(e,t),this.format=DateFormat[t.view],this.showTime=t.view!="date"}getItem(){let e=super.getItem();return Object.assign({},e,{component:"DatePicker",componentProps:{placeholder:`请选择${this.label}`,showTime:this.showTime,valueFormat:this.format,style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()}})}}class SelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum,t.type),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.multi=t.multi||!1}getItem(){let e=super.getItem(),t=this.getFormComponent(),o=this.getComponentProps();return Object.assign({},e,{component:t,componentProps:o})}getFormComponent(){return this.options.length>0?"Select":"JDictSelectTag"}getComponentProps(){let e={allowClear:!0,mode:this.multi===!0?"multiple":"combobox",style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()};if(this.options.length>0)e.options=this.options;else if(!this.dictTable)e.dictCode=this.dictCode;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e}getOptions(e,t){if(!e||e.length==0)return[];let o=t=="number",c=[];for(let l of e){let i=l.value;o&&(i=parseInt(i)),c.push({value:i,label:l.title})}return c}}class PasswordWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputPassword"})}}class FileWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e=this.getExtendData();return e&&e.uploadnum?{maxCount:Number(e.uploadnum)}:{}}}class ImageWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JUpload",componentProps:t})}getComponentProps(){let e={fileType:UploadTypeEnum.image},t=this.getExtendData();return t&&t.uploadnum&&(e.maxCount=Number(t.uploadnum)),e}}class TextAreaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"InputTextArea",componentProps:{autoSize:{minRows:4,maxRows:10}}})}}class SelectMultiWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectMultiple",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};{let e={};if(!this.dictTable)e.dictCode=this.dictCode;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e.triggerChange=!0,e.popContainer=this.getPopContainer(),e}}}class SelectSearchWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=encodeURI(`${t.dictTable},${t.dictText},${t.dictCode}`)}getItem(){let e=super.getItem(),t=this.getPopContainer();return Object.assign({},e,{component:"JSearchSelect",componentProps:{dict:this.dict,pageSize:6,async:!0,popContainer:t}})}}class PopupWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.multi=t.popupMulti,this.fieldConfig=this.getFieldConfig(t)}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JPopup",componentProps:t})}getComponentProps(){let e={code:this.code,multi:this.multi,fieldConfig:this.fieldConfig};return this.formRef?e.formElRef=this.formRef:e.setFieldsValue=this.setFieldsValue,this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}getFieldConfig(e){let{destFields:t,orgFields:o}=e;if(!t||t.length==0)return[];let c=t.split(","),l=o.split(","),i=[];const C=this.pre;for(let b=0;b<c.length;b++)i.push({target:C+c[b],source:l[b]});return i}}class TreeCategoryWidget extends IFormSchema{constructor(e,t){super(e,t),this.multi=!1,this.pid=t.pidValue,this.pcode=t.pcode,this.textField=t.textField}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{componentProps:t,component:"JCategorySelect"})}getComponentProps(){let e={placeholder:"请选择"+this.label};if(this.pcode)e.pcode=this.pcode;else{let t=this.pid||"EMPTY_PID";e.pid=t}return this.textField?pe(ne({loadTriggleChange:!0,multiple:this.multi},e),{back:this.textField,onChange:(t,o)=>{this.formRef&&(this.formRef.value.setFieldsValue(o),this.formRef.value.$formValueChange(this.field,t))}}):ne({multiple:this.multi},e)}getRelatedHideFields(){let e=[];return this.textField&&e.push(this.textField),e}}class SelectDepartWidget extends IFormSchema{getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectDept",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={checkStrictly:!0,showButton:!1};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.multiple=!1),e.multiSelect===!0&&(t.multiple=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class SelectUserWidget extends IFormSchema{constructor(e,t){super(e,t),this.showButton=t.showButton!==!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectUser",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={showSelected:!1,allowClear:!0,isRadioSelection:!1,showButton:this.showButton};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.isRadioSelection=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class EditorWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JEditor",componentProps:{options:{auto_focus:!1}}})}}class MarkdownWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JMarkdownEditor",componentProps:{}})}}class PcaWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"JAreaSelect"})}}class TreeSelectWidget extends IFormSchema{constructor(e,t){super(e,t),this.dict=t.dict,this.pidField=t.pidField,this.pidValue=t.pidValue}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JTreeSelect",componentProps:{dict:this.dict,pidField:this.pidField,pidValue:this.pidValue}})}}class RadioWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JDictSelectTag",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};if(this.dictTable){let e=`${this.dictTable},${this.dictText},${this.dictCode}`;return{dictCode:encodeURI(e),type:"radio"}}else return{dictCode:this.dictCode,type:"radio"}}}class CheckboxWidget extends IFormSchema{constructor(e,t){super(e,t),this.options=this.getOptions(t.enum)}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JCheckbox",componentProps:{options:this.options,triggerChange:!0}})}getOptions(e){if(!e||e.length==0)return[];let t=[];for(let o of e)t.push({value:o.value,label:o.title});return t}}class SwitchWidget extends IFormSchema{constructor(e,t){super(e,t),this.hasChange=!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSwitch",componentProps:t})}getComponentProps(){let{fieldExtendJson:e}=this._data,t=["Y","N"];if(e&&typeof e=="string"){let o=JSON.parse(e);o.length==2&&(t=o)}return{options:t}}}class TimeWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"TimePicker",componentProps:{placeholder:`请选择${this.label}`,valueFormat:"HH:mm:ss",getPopupContainer:t=>this.getModalAsContainer(),style:{width:"100%"}}})}}class LinkDownWidget extends IFormSchema{constructor(e,t){super(e,t);const{dictTable:o,dictText:c,dictCode:l,pidField:i,idField:C,origin:b,condition:D}=t;this.table=o,this.txt=c,this.store=l,this.idField=C,this.pidField=i,this.origin=b,this.condition=D,this.options=[],this.next=t.next||"",this.type=t.type}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"OnlineSelectCascade",componentProps:t})}getComponentProps(){let e={table:this.table,txt:this.txt,store:this.store,pidField:this.pidField,idField:this.idField,origin:this.origin,pidValue:"-1",style:{width:"100%"},onChange:t=>{this.valueChange(t)},onNext:t=>{this.nextOptionsChange(t)}};return this._data.origin===!0&&(e.condition=this.condition),e}nextOptionsChange(e){return J(this,null,function*(){this.formRef&&this.next&&(yield this.formRef.value.updateSchema({field:this.next,componentProps:{pidValue:e}}))})}valueChange(e){return J(this,null,function*(){if(!this.formRef||!this.next)return;let t=this.formRef.value;t.$formValueChange(this.field,e),yield t.setFieldsValue({[this.next]:""})})}}class SlotWidget extends IFormSchema{constructor(e,t){super(e,t),this.slot=""}getItem(){let e=super.getItem(),t=this.slot;return Object.assign({},e,{slot:t})}groupDate(){return this.slot="groupDate",this}groupDatetime(){return this.slot="groupDatetime",this}groupNumber(){return this.slot="groupNumber",this}}class NumberWidget extends IFormSchema{constructor(e,t){super(e,t),this.dbPointLength=t.dbPointLength}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"InputNumber",componentProps:t})}getComponentProps(){const e={style:{width:"100%"}};return this.dbPointLength>=0&&(e.precision=this.dbPointLength),e}}class LinkTableWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.view=t.view,this.componentString="",this.linkFields=[]}getItem(){let e=super.getItem();const t=this.getComponentProps();return Object.assign({},e,{component:this.componentString,componentProps:t})}getComponentProps(){let e={textField:this.dictText,tableName:this.dictTable,valueField:this.dictCode},t=this.getExtendData();if(t.multiSelect?e.multi=!0:e.multi=!1,t.imageField?e.imageField=t.imageField:e.imageField="",t.showType=="select"){this.componentString="LinkTableSelect";let o=this.getPopContainer();e.popContainer=o}else this.componentString="LinkTableCard";return this.linkFields.length>0&&(e.linkFields=this.linkFields),e}setOtherInfo(e){this.linkFields=e}}class LinkTableFieldWidget extends IFormSchema{constructor(e,t){super(e,t),this.dictTable=t.dictTable,this.dictText=t.dictText}getItem(){let e=super.getItem();return Object.assign({},e,{componentProps:{readOnly:!0,allowClear:!1,disabled:!0,style:{background:"none",color:"rgba(0, 0, 0, 0.85)",border:"none"}}})}getLinkFieldInfo(){return[this.dictTable,`${this.field},${this.dictText}`]}}class LinkTableForQueryWidget extends IFormSchema{constructor(e,t){super(e,t),this.code=t.code,this.titleField=t.titleField,this.multi=t.multi||!1}getItem(){let e=super.getItem();return Object.assign({},e,{component:"LinkTableForQuery",componentProps:{code:this.code,multi:this.multi,field:this.titleField,style:{width:"100%"}}})}}class CascaderPcaForQueryWidget extends IFormSchema{getItem(){let e=super.getItem();return Object.assign({},e,{component:"CascaderPcaForQuery",componentProps:{style:{width:"100%"}}})}}class SelectUser2Widget extends IFormSchema{constructor(e,t){super(e,t),this.multi=t.multi===!0,this.store=t.store||"",this.query=t.query||!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"UserSelect",componentProps:t})}getComponentProps(){let e={multi:this.multi,store:this.store,query:this.query};return this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}}class RangeWidget extends IFormSchema{constructor(e,t){super(e,t);let o=t.view;this.format=t.format,this.datetime=!1,o==="rangeNumber"?this.componentType="JRangeNumber":o==="rangeTime"?this.componentType="RangeTime":(this.componentType="RangeDate",t.datetime===!0&&(this.datetime=!0))}getItem(){let e=super.getItem();return Object.assign({},e,{component:this.componentType,componentProps:{datetime:this.datetime,format:this.format,getPopupContainer:t=>this.getModalAsContainer()}})}}class FormSchemaFactory{static createFormSchema(e,t){switch(t.view){case"password":return new PasswordWidget(e,t);case"list":return new SelectWidget(e,t);case"radio":return new RadioWidget(e,t);case"checkbox":return new CheckboxWidget(e,t);case"date":case"datetime":return new DateWidget(e,t);case"time":return new TimeWidget(e,t);case"file":return new FileWidget(e,t);case"image":return new ImageWidget(e,t);case"textarea":return new TextAreaWidget(e,t);case"list_multi":return new SelectMultiWidget(e,t);case"sel_search":return new SelectSearchWidget(e,t);case"popup":return new PopupWidget(e,t);case"cat_tree":return new TreeCategoryWidget(e,t);case"sel_depart":return new SelectDepartWidget(e,t);case"sel_user":return new SelectUserWidget(e,t);case"umeditor":return new EditorWidget(e,t);case"markdown":return new MarkdownWidget(e,t);case"pca":return new PcaWidget(e,t);case"link_down":return new LinkDownWidget(e,t);case"sel_tree":return new TreeSelectWidget(e,t);case"switch":return new SwitchWidget(e,t);case"link_table":return new LinkTableWidget(e,t);case"link_table_field":return new LinkTableFieldWidget(e,t);case"slot":return new SlotWidget(e,t);case"LinkTableForQuery":return new LinkTableForQueryWidget(e,t);case"CascaderPcaForQuery":return new CascaderPcaForQueryWidget(e,t);case"select_user2":return new SelectUser2Widget(e,t);case"rangeDate":case"rangeTime":case"rangeNumber":return new RangeWidget(e,t);case"hidden":return new InputWidget(e,t).isHidden();default:return t.type=="number"?new NumberWidget(e,t):new InputWidget(e,t)}}static createSlotFormSchema(e,t){let o=new SlotWidget(e,t),c=t.view;if(c=="date")o.groupDate();else if(c=="datetime")o.groupDatetime();else{let l=t.type;(l=="number"||l=="integer")&&o.groupNumber()}return o}static createIdField(){return{label:"",field:"id",component:"Input",show:!1}}}var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var dayjs_min={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(commonjsGlobal,function(){var t=1e3,o=6e4,c=36e5,l="millisecond",i="second",C="minute",b="hour",D="day",I="week",O="month",$="quarter",T="year",A="date",B="Invalid Date",N=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,P=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,V={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(u){var a=["th","st","nd","rd"],r=u%100;return"["+u+(a[(r-20)%10]||a[r]||a[0])+"]"}},k=function(u,a,r){var p=String(u);return!p||p.length>=a?u:""+Array(a+1-p.length).join(r)+u},U={s:k,z:function(u){var a=-u.utcOffset(),r=Math.abs(a),p=Math.floor(r/60),m=r%60;return(a<=0?"+":"-")+k(p,2,"0")+":"+k(m,2,"0")},m:function u(a,r){if(a.date()<r.date())return-u(r,a);var p=12*(r.year()-a.year())+(r.month()-a.month()),m=a.clone().add(p,O),F=r-m<0,E=a.clone().add(p+(F?-1:1),O);return+(-(p+(r-m)/(F?m-E:E-m))||0)},a:function(u){return u<0?Math.ceil(u)||0:Math.floor(u)},p:function(u){return{M:O,y:T,w:I,d:D,D:A,h:b,m:C,s:i,ms:l,Q:$}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(u){return u===void 0}},Y="en",L={};L[Y]=V;var j=function(u){return u instanceof M},f=function u(a,r,p){var m;if(!a)return Y;if(typeof a=="string"){var F=a.toLowerCase();L[F]&&(m=F),r&&(L[F]=r,m=F);var E=a.split("-");if(!m&&E.length>1)return u(E[0])}else{var q=a.name;L[q]=a,m=q}return!p&&m&&(Y=m),m||!p&&Y},x=function(u,a){if(j(u))return u.clone();var r=typeof a=="object"?a:{};return r.date=u,r.args=arguments,new M(r)},y=U;y.l=f,y.i=j,y.w=function(u,a){return x(u,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var M=function(){function u(r){this.$L=f(r.locale,null,!0),this.parse(r)}var a=u.prototype;return a.parse=function(r){this.$d=function(p){var m=p.date,F=p.utc;if(m===null)return new Date(NaN);if(y.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var E=m.match(N);if(E){var q=E[2]-1||0,Z=(E[7]||"0").substring(0,3);return F?new Date(Date.UTC(E[1],q,E[3]||1,E[4]||0,E[5]||0,E[6]||0,Z)):new Date(E[1],q,E[3]||1,E[4]||0,E[5]||0,E[6]||0,Z)}}return new Date(m)}(r),this.$x=r.x||{},this.init()},a.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},a.$utils=function(){return y},a.isValid=function(){return this.$d.toString()!==B},a.isSame=function(r,p){var m=x(r);return this.startOf(p)<=m&&m<=this.endOf(p)},a.isAfter=function(r,p){return x(r)<this.startOf(p)},a.isBefore=function(r,p){return this.endOf(p)<x(r)},a.$g=function(r,p,m){return y.u(r)?this[p]:this.set(m,r)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(r,p){var m=this,F=!!y.u(p)||p,E=y.p(r),q=function(W,G){var re=y.w(m.$u?Date.UTC(m.$y,G,W):new Date(m.$y,G,W),m);return F?re:re.endOf(D)},Z=function(W,G){return y.w(m.toDate()[W].apply(m.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(G)),m)},X=this.$W,ee=this.$M,se=this.$D,ce="set"+(this.$u?"UTC":"");switch(E){case T:return F?q(1,0):q(31,11);case O:return F?q(1,ee):q(0,ee+1);case I:var ue=this.$locale().weekStart||0,me=(X<ue?X+7:X)-ue;return q(F?se-me:se+(6-me),ee);case D:case A:return Z(ce+"Hours",0);case b:return Z(ce+"Minutes",1);case C:return Z(ce+"Seconds",2);case i:return Z(ce+"Milliseconds",3);default:return this.clone()}},a.endOf=function(r){return this.startOf(r,!1)},a.$set=function(r,p){var m,F=y.p(r),E="set"+(this.$u?"UTC":""),q=(m={},m[D]=E+"Date",m[A]=E+"Date",m[O]=E+"Month",m[T]=E+"FullYear",m[b]=E+"Hours",m[C]=E+"Minutes",m[i]=E+"Seconds",m[l]=E+"Milliseconds",m)[F],Z=F===D?this.$D+(p-this.$W):p;if(F===O||F===T){var X=this.clone().set(A,1);X.$d[q](Z),X.init(),this.$d=X.set(A,Math.min(this.$D,X.daysInMonth())).$d}else q&&this.$d[q](Z);return this.init(),this},a.set=function(r,p){return this.clone().$set(r,p)},a.get=function(r){return this[y.p(r)]()},a.add=function(r,p){var m,F=this;r=Number(r);var E=y.p(p),q=function(ee){var se=x(F);return y.w(se.date(se.date()+Math.round(ee*r)),F)};if(E===O)return this.set(O,this.$M+r);if(E===T)return this.set(T,this.$y+r);if(E===D)return q(1);if(E===I)return q(7);var Z=(m={},m[C]=o,m[b]=c,m[i]=t,m)[E]||1,X=this.$d.getTime()+r*Z;return y.w(X,this)},a.subtract=function(r,p){return this.add(-1*r,p)},a.format=function(r){var p=this,m=this.$locale();if(!this.isValid())return m.invalidDate||B;var F=r||"YYYY-MM-DDTHH:mm:ssZ",E=y.z(this),q=this.$H,Z=this.$m,X=this.$M,ee=m.weekdays,se=m.months,ce=m.meridiem,ue=function(G,re,le,te){return G&&(G[re]||G(p,F))||le[re].slice(0,te)},me=function(G){return y.s(q%12||12,G,"0")},W=ce||function(G,re,le){var te=G<12?"AM":"PM";return le?te.toLowerCase():te};return F.replace(P,function(G,re){return re||function(le){switch(le){case"YY":return String(p.$y).slice(-2);case"YYYY":return y.s(p.$y,4,"0");case"M":return X+1;case"MM":return y.s(X+1,2,"0");case"MMM":return ue(m.monthsShort,X,se,3);case"MMMM":return ue(se,X);case"D":return p.$D;case"DD":return y.s(p.$D,2,"0");case"d":return String(p.$W);case"dd":return ue(m.weekdaysMin,p.$W,ee,2);case"ddd":return ue(m.weekdaysShort,p.$W,ee,3);case"dddd":return ee[p.$W];case"H":return String(q);case"HH":return y.s(q,2,"0");case"h":return me(1);case"hh":return me(2);case"a":return W(q,Z,!0);case"A":return W(q,Z,!1);case"m":return String(Z);case"mm":return y.s(Z,2,"0");case"s":return String(p.$s);case"ss":return y.s(p.$s,2,"0");case"SSS":return y.s(p.$ms,3,"0");case"Z":return E}return null}(G)||E.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(r,p,m){var F,E=this,q=y.p(p),Z=x(r),X=(Z.utcOffset()-this.utcOffset())*o,ee=this-Z,se=function(){return y.m(E,Z)};switch(q){case T:F=se()/12;break;case O:F=se();break;case $:F=se()/3;break;case I:F=(ee-X)/6048e5;break;case D:F=(ee-X)/864e5;break;case b:F=ee/c;break;case C:F=ee/o;break;case i:F=ee/t;break;default:F=ee}return m?F:y.a(F)},a.daysInMonth=function(){return this.endOf(O).$D},a.$locale=function(){return L[this.$L]},a.locale=function(r,p){if(!r)return this.$L;var m=this.clone(),F=f(r,p,!0);return F&&(m.$L=F),m},a.clone=function(){return y.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},u}(),d=M.prototype;return x.prototype=d,[["$ms",l],["$s",i],["$m",C],["$H",b],["$W",D],["$M",O],["$y",T],["$D",A]].forEach(function(u){d[u[1]]=function(a){return this.$g(a,u[0],u[1])}}),x.extend=function(u,a){return u.$i||(u(a,M,x),u.$i=!0),x},x.locale=f,x.isDayjs=j,x.unix=function(u){return x(1e3*u)},x.en=L[Y],x.Ls=L,x.p={},x})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;const dayjs=getDefaultExportFromCjs(dayjs_minExports),ceKeys=Object.keys(CustomExpression),ceJoin=ceKeys.join(","),$CE$=ceKeys.map(n=>CustomExpression[n]),normalRegExp=/#{([^}]+)?}/g,customRegExp=/{{([^}]+)?}}/g,fillRuleRegExp=/\${([^}]+)?}/g,ACTION_TYPES={ADD:"add",EDIT:"edit",DETAIL:"detail",RELOAD:"reload"};function initDefValueConfig(n,e,t){hasEffectiveValue(e.defVal)&&t.push({field:n,type:e.type,value:e.defVal})}function initSubTableDefValueConfig(n,e){hasEffectiveValue(n.fieldDefaultValue)&&e.push({field:n.key,type:n.type,value:n.fieldDefaultValue})}function loadFormFieldsDefVal(n,e,t){return J(this,null,function*(){if(Array.isArray(n)&&n.length>0){let o={};for(let c of n){let{value:l,type:i,field:C}=c;l=yield handleDefaultValue(l,ACTION_TYPES.ADD,t||{}),i==="number"&&l&&(l=Number.parseFloat(l)),o[C]=l}e(o)}})}function loadOneFieldDefVal(n,e,t){return J(this,null,function*(){let{defVal:o,type:c}=e;if(hasEffectiveValue(o)){let l=yield handleDefaultValue(o,ACTION_TYPES.ADD,{});c==="number"&&l&&(l=Number.parseFloat(l)),t[n]=l}})}function hasEffectiveValue(n){return!!(n||n===0)}function handleDefaultValue(n,e,t){return J(this,null,function*(){if(n!=null&&checkExpressionType(n)){let o=yield getDefaultValue(n,e,t);if(o!=null)return o}return n})}function checkExpressionType(n){let e=0,t=0,o=0;if(n.replace(fillRuleRegExp,()=>o++),o>1)return`${n}`,!1;n.replace(normalRegExp,()=>e++),n.replace(customRegExp,()=>t++);let c=e+t;return o>0&&c>0?(`${n}`,!1):!0}function getRegExpMap(n,e){let t=new Map;return n.replace(e,function(o,c){return t.set(o,c.trim()),o}),t}function getDefaultValue(n,e,t){return J(this,null,function*(){return(e===ACTION_TYPES.ADD||e===ACTION_TYPES.RELOAD)&&fillRuleRegExp.test(n)?yield executeRegExp(n,fillRuleRegExp,executeFillRuleExpression,[t]):e===ACTION_TYPES.ADD?(n=yield executeRegExp(n,normalRegExp,executeNormalExpression),n=yield executeRegExp(n,customRegExp,executeCustomExpression),n):null})}function executeRegExp(n,e,t){return J(this,arguments,function*(o,c,l,i=[]){let C=getRegExpMap(o,c);for(let b of C.keys()){let D=C.get(b),I=yield l.apply(null,[D,b,...i]);if(b===o)return I;o=replaceAll(o,b,I)}return o})}function executeNormalExpression(n,e){return J(this,null,function*(){switch(n){case"date":return dayjs().format("YYYY-MM-DD");case"time":return dayjs().format("HH:mm:ss");case"datetime":return dayjs().format("YYYY-MM-DD HH:mm:ss");default:let t=getUserInfoByExpression(n);return t!=null?t:e}})}function getUserInfoByExpression(n){let e=useUserStore().getUserInfo;if(e)switch(n){case"sysUserId":return e.id;case"sysUserCode":case"sys_user_code":return e.username;case"sysUserName":return e.realname;case"sysOrgCode":case"sys_org_code":return e.orgCode}return null}function executeCustomExpression(expression,origin){return J(this,null,function*(){let fn=eval(`(function (${ceJoin}){ return ${expression} })`);try{return fn.apply(null,$CE$)}catch(n){return origin}})}function executeFillRuleExpression(n,e,t){return J(this,null,function*(){let o=`/sys/fillRule/executeRuleByCode/${n}`,c={};typeof t=="function"?c=t():t&&(c=ne({},t));let{success:l,message:i,result:C}=yield defHttp.put({url:o,params:c},{isTransformResponse:!1});return l?C:(`${n}${i}`,e)})}function logWarn(n){}function logError(n){}const LINK_DOWN="link_down",LINK_TABLE_FIELD="link_table_field",LINK_TABLE="link_table";function useFormItems(n,e){useExtendComponent();const t=n.modalClass,o=ref([]),c=ref(""),l=ref({}),i=reactive({}),C=ref(!1),b=ref([]),D=ref({}),I={},O=ref([]),$=reactive({}),T=ref("");T.value={sm:24,xs:24,md:12,lg:12,xl:12,xxl:12};function A(k,U,Y){clearObj($),$[c.value]=[];let L=[],j=[],f=[],x={},y={};Object.keys(k).map(d=>{const u=k[d];if(u.view=="tab"){C.value=!0,$[d]=[];let a={key:d,foreignKey:u.foreignKey,describe:u.describe,relationType:u.relationType,requiredFields:u.required||[],order:u.order,id:u.id};u.relationType==1?(I[d]=ref(null),a.properties=u.properties):(B(u),I[d]=ref(),a.columns=u.columns,x[d]=[]),L.push(a),handleSubTableButtonAuth(d,u)}else if(initDefValueConfig(d,u,$[c.value]),u.view===LINK_DOWN){let a=handleLinkDown(u,d);for(let r of a){i[r.key]=!0,i[r.key+"_load"]=!0;let p=FormSchemaFactory.createFormSchema(r.key,r);Y&&p.setOnlyValidateFun(Y),p.isRequired(U),p.setFormRef(e),p.handleWidgetAttr(u);let m=getFieldIndex(j,r.key);m==-1?j.push(p):j[m]=p}}else if(i[d]=!0,i[d+"_load"]=!0,getFieldIndex(j,d)==-1){let a=FormSchemaFactory.createFormSchema(d,u);if(Y&&a.setOnlyValidateFun(Y),a.isRequired(U),a.setFormRef(e),j.push(a),f.push(...a.getRelatedHideFields()),u.view===LINK_TABLE_FIELD){let r=a.getLinkFieldInfo();r&&(y[r[0]]?y[r[0]].push(r[1]):y[r[0]]=[r[1]])}}}),j.sort(function(d,u){return d.order-u.order});let M=[];M.push(FormSchemaFactory.createIdField());for(let d of j)d.view&&d.view==LINK_TABLE&&y[d.field]&&d.setOtherInfo(y[d.field]),f.indexOf(d.field)>=0&&d.isHidden(),t&&d.setCustomPopContainer(t),M.push(d.getFormItemSchema());o.value=M,L.sort(function(d,u){return d.order-u.order}),b.value=L,D.value=x}watch(i,k=>{let U=e.value,Y=[],L=toRaw(k);Object.keys(L).map(j=>{if(!j.endsWith("_load")){let f={field:j,show:L[j]},x=j+"_load";L.hasOwnProperty(x)&&(f.ifShow=L[x]),Y.push(f)}}),U&&U.updateSchema(Y)},{immediate:!1});function B(k){useOnlineVxeTableColumns(k,U=>{initSubTableDefValueConfig(U,$[k.key])})}watch(()=>n.formTemplate,()=>{T.value=N()},{immediate:!0});function N(){let k=n.formTemplate;return k==2?{sm:24,xs:24,md:12,lg:12,xl:12,xxl:12}:k==3?{sm:24,xs:24,md:8,lg:8,xl:8,xxl:8}:k==4?{sm:24,xs:24,md:6,lg:6,xl:6,xxl:6}:{sm:24,xs:24,md:24,lg:24,xl:24,xxl:24}}function P(k,U){return new Promise(Y=>{U||Y("");let L={tableName:c.value.replace(/\$\d+/,""),fieldName:k.field,fieldVal:U},j=l.value;j.id&&(L.dataId=j.id),duplicateCheck(L).then(f=>{f.success?Y(""):Y(f.message)}).catch(f=>{Y(f)})})}function V(k){return Object.keys(k).map(U=>{k[U]&&k[U]instanceof Array&&(k[U]=k[U].join(","))}),k}return{formSchemas:o,defaultValueFields:$,tableName:c,dbData:l,checkOnlyFieldValue:P,createFormSchemas:A,fieldDisplayStatus:i,subTabInfo:b,hasSubTable:C,subDataSource:D,baseColProps:T,changeDataIfArray2String:V,linkDownList:O,refMap:I}}function useOnlineVxeTableColumns(n,e){const t={inputNumber:"input-number",sel_depart:"depart-select",sel_user:"user-select",list_multi:"select-multiple",input_pop:"textarea",sel_search:"select-search","select-dict-search":"selectDictSearch"};n.columns.forEach(l=>{l.type==="radio"?l.type="select":t[l.type]?l.type=t[l.type]:l.type==="popup"&&o(l),l.type==="depart-select"&&(l.checkStrictly=!0),l.type==="user-select"&&c(l),l.type==="pca"&&(l.width="230px"),(l.width==120||l.width=="120px")&&(l.type=="image"||l.type=="file")&&(l.width="130px"),l.width||(l.width="200px"),e&&e(l)});function o(l){let{destFields:i,orgFields:C}=l,b=[];if(!(!i||i.length==0)){let D=i.split(","),I=C.split(",");for(let O=0;O<D.length;O++)b.push({target:D[O],source:I[O]})}l.fieldConfig=b}function c(l){let i=l.fieldExtendJson,C=!1;if(i)try{JSON.parse(i).multiSelect===!1&&(C=!0)}catch(b){}l.isRadioSelection=C}}function useOnlineFormContext(){let n={};const e={addSubRows:"<m> 一对多子表，新增自定义行",changeOptions:"<m> 改变下拉框选项",clearSubRows:"<m> 清空一对多子表行",clearThenAddRows:"<m> 清空一对多子表行，然后新增自定义行",executeMainFillRule:"<m> 刷新主表的增值规制值",executeSubFillRule:"<m> 刷新子表的增值规制值",getFieldsValue:"<m> 获取表单控件的值",getSubTableInstance:"<m> 获取子表实例",isUpdate:"<p> 判断是否为编辑模式",loading:"<p> 页面加载状态",onlineFormRef:"<p> 当前表单ref对象",refMap:"<p> 子表ref对象map",setFieldsValue:"<m> 设置表单控件的值",sh:"<p> 表单控件的显示隐藏状态",subActiveKey:"<p> 子表激活tab，对应子表表名",subFormHeight:"<p> 一对一子表表单高度",submitFlowFlag:"<p> 是否提交流程状态",subTableHeight:"<p> 一对多子表表格高度",tableName:"<p> 当前表名",triggleChangeValues:"<m> 修改多个表单值",triggleChangeValue:"<m> 修改表单值",updateSchema:"<m> 修改表单控件配置"},t=new Proxy(e,{get(l,i){return Reflect.get(n,i)}});function o(l,i){n[l]=i}function c(l){Object.keys(l).map(i=>{n[i]=l[i]})}return o("$nextTick",nextTick),o("addObject2Context",o),{onlineFormContext:t,addObject2Context:o,resetContext:c}}function handleLinkDown(n,e){const{config:{table:t,key:o,txt:c,linkField:l,idField:i,pidField:C,condition:b},others:D,order:I,title:O}=n;let $={dictTable:t,dictText:c,dictCode:o,pidField:C,idField:i,view:LINK_DOWN,type:n.type},T=[],A=ne({key:e,title:O,order:I,condition:b,origin:!0},$);if(l&&l.length>0){let B=l.split(",");A.next=B[0];for(let N=0;N<B.length;N++)for(let P of D)if(P.field==B[N]){let V=ne({key:P.field,title:P.title,order:P.order,origin:!1},$);N+1<B.length&&(V.next=B[N+1]),T.push(V)}}return T.push(A),T}function getFieldIndex(n,e){let t=-1;for(let o=0;o<n.length;o++)if(n[o].field===e){t=o;break}return t}function getRefPromise(n){return new Promise(e=>{(function t(){let o=n.value;o?e(o):setTimeout(()=>{t()},100)})()})}function clearObj(n){Object.keys(n).map(e=>{delete n[e]})}const permissionStore=usePermissionStore();function handleSubTableButtonAuth(n,e){let t=e.hideButtons,o=ONL_AUTH_PRE+n+":";t||(t=[]),permissionStore.setOnlineSubTableAuth(o,t)}function getDetailFormSchemas(n){const e=ref([]),t={},o=reactive({}),c=ref(!1),l=ref([]),i=ref({}),C=computed(()=>{let $=n.formTemplate;return $=="2"?12:$=="3"?8:$=="4"?6:24});function b($){let T=[],A=[],B={};Object.keys($).map(N=>{const P=$[N];if(P.view=="tab"){c.value=!0;let V={key:N,foreignKey:P.foreignKey,describe:P.describe,relationType:P.relationType,requiredFields:P.required||[],order:P.order};P.relationType==1?(t[N]=ref(null),V.properties=P.properties):(D(P),t[N]=ref(),V.columns=P.columns,B[N]=[],o[N]=!1),T.push(V)}else if(P.view===LINK_DOWN){let V=O(P,N);for(let k of V){let U=I(A,k.key),Y={field:k.key,label:k.title,view:k.view,order:k.order,dictTable:k.dictTable,linkField:k.linkField||""};U==-1?A.push(Y):A[U]=Y}}else if(P.view!="hidden"&&I(A,N)==-1){let V=Object.assign({field:N,label:P.title},_(P,["view","order","fieldExtendJson","dictTable","dictText","dictCode","dict"]));if(P.view=="file"&&(V.span=24,V.isFile=!0),P.view=="image"&&(V.span=24,V.isImage=!0),P.view=="link_table"&&P.fieldExtendJson)try{let k=JSON.parse(P.fieldExtendJson);k.showType!="select"&&(V.isCard=!0),k.multiSelect==!0&&(V.multi=!0)}catch(k){}(P.view=="umeditor"||P.view=="markdown")&&(V.isHtml=!0,V.span=24),A.push(V)}}),A.sort(function(N,P){return N.order-P.order}),T.sort(function(N,P){return N.order-P.order}),l.value=T;for(let N=0;N<A.length;N++){let P=A[N];if((P.isFile===!0||P.isImage===!0||P.isHtml===!0)&&N>0){let V=A[N-1],k=V.span||C.value;V.span=k}}e.value=A,i.value=B}function D($){useOnlineVxeTableColumns($)}function I($,T){let A=-1;for(let B=0;B<$.length;B++)if($[B].field===T){A=B;break}return A}function O($,T){let A=[];const{config:{table:B,key:N,txt:P,linkField:V},order:k,title:U,others:Y}=$;let L={view:"link_down",order:k,title:U,dictTable:JSON.stringify({table:B,key:N,txt:P})};if(A.push(Object.assign({},{linkField:V,key:T},L)),V){let j=V.split(",");for(let f of j){let x="";for(let y of Y)y.field==f&&(x=y.title);A.push(Object.assign({},{key:f},L,{title:x}))}}return A}return{detailFormSchemas:e,hasSubTable:c,subTabInfo:l,refMap:t,showStatus:o,createFormSchemas:b,formSpan:C,subDataSource:i}}function useEnhance(onlineTableContext,isList=!0){let EnhanceJS=reactive({});const getAction=(n,e)=>defHttp.get({url:n,params:e},{isTransformResponse:!1}),postAction=(n,e)=>defHttp.post({url:n,params:e},{isTransformResponse:!1}),putAction=(n,e)=>defHttp.put({url:n,params:e},{isTransformResponse:!1}),deleteAction=(n,e)=>defHttp.delete({url:n,params:e},{isTransformResponse:!1});isList===!0?(onlineTableContext._getAction=getAction,onlineTableContext._postAction=postAction,onlineTableContext._putAction=putAction,onlineTableContext._deleteAction=deleteAction):(onlineTableContext.addObject2Context("_getAction",getAction),onlineTableContext.addObject2Context("_postAction",postAction),onlineTableContext.addObject2Context("_putAction",putAction),onlineTableContext.addObject2Context("_deleteAction",deleteAction));function initCgEnhanceJs(str){if(str){let Obj=eval("("+str+")");return new Obj(getAction,postAction,deleteAction)}else return{}}function triggerJsFun(n,e){EnhanceJS&&EnhanceJS[e]&&EnhanceJS[e](n)}function customBeforeSubmit(n,e){return EnhanceJS&&EnhanceJS.beforeSubmit?EnhanceJS.beforeSubmit(n,e):Promise.resolve()}function beforeDelete(n,e){return EnhanceJS&&EnhanceJS.beforeDelete?EnhanceJS.beforeDelete(n,e):Promise.resolve()}return isList===!0&&onlineTableContext&&(onlineTableContext.beforeDelete=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeDelete?e.beforeDelete(onlineTableContext,n):Promise.resolve()},onlineTableContext.beforeEdit=n=>{const e=onlineTableContext.EnhanceJS;return e&&e.beforeEdit?e.beforeEdit(onlineTableContext,n):Promise.resolve()}),{EnhanceJS,initCgEnhanceJs,customBeforeSubmit,beforeDelete,triggerJsFun}}const baseUrl="/online/cgform/api/subform",_sfc_main$5={name:"OnlineSubForm",components:{BasicForm,Loading:ne$1},props:{properties:{type:Object,required:!0},mainId:{type:String,default:""},table:{type:String,default:""},formTemplate:{type:Number,default:1},requiredFields:{type:Array,default:[]},isUpdate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["formChange"],setup(n,{emit:e}){const t=ref(null),o=ref(!1),{formSchemas:c,defaultValueFields:l,changeDataIfArray2String:i,tableName:C,dbData:b,checkOnlyFieldValue:D,fieldDisplayStatus:I,createFormSchemas:O,baseColProps:$}=useFormItems(n,t),[T,{setProps:A,validate:B,resetFields:N,setFieldsValue:P,getFieldsValue:V}]=useForm({schemas:c,showActionButtonGroup:!1,baseColProps:$});watch(()=>n.table,()=>{C.value=n.table},{immediate:!0}),watch(()=>n.properties,d=>{o.value=!1,k(),O(n.properties,n.requiredFields,D),o.value=!0},{deep:!0,immediate:!0}),watch(()=>n.mainId,d=>{setTimeout(()=>{Y()},100)},{immediate:!0}),watch(()=>n.disabled,d=>{A({disabled:d})});function k(){return J(this,null,function*(){let d=yield getRefPromise(t);d.$formValueChange=(u,a)=>{let r={[u]:a};e("formChange",r)}})}function U(){if(unref(n.isUpdate)===!1){let d=toRaw(l[C.value]);loadFormFieldsDefVal(d,u=>{P(u)})}}function Y(){return J(this,null,function*(){yield getRefPromise(o),yield N(),U();const{table:d,mainId:u}=n;if(!d||!u)return;let a=yield L(d,u);b.value=a,yield P(a)})}function L(d,u){let a=`${baseUrl}/${d}/${u}`;return new Promise((r,p)=>{defHttp.get({url:a},{isTransformResponse:!1}).then(m=>{m.success?r(m.result):p()})}).finally(()=>{b.value=""})}function j(){return new Promise((d,u)=>{B().then(()=>{let a=V();a=i(a),d(a)}).catch(a=>{u(a)})})}function f(){let d=V();return d.id||(d.id="sub-change-temp-id"),{row:d,target:M}}function x(d){P(d)}function y(){let d=V(),u=toRaw(l[C.value]);loadFormFieldsDefVal(u,a=>{P(a)},d)}const M={onlineFormRef:t,baseColProps:$,formSchemas:c,registerForm:T,setFieldsValue:P,getFieldsValue:V,getFormEvent:f,setValues:x,getAll:j,executeFillRule:y,sh:I};return M}};function _sfc_render$5(n,e,t,o,c,l){const i=resolveComponent("BasicForm");return openBlock(),createBlock(i,{ref:"onlineFormRef",onRegister:n.registerForm},null,8,["onRegister"])}const OnlineSubForm=h(_sfc_main$5,[["render",_sfc_render$5]]),OnlineSubForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlineSubForm},Symbol.toStringTag,{value:"Module"})),urlObject={optPre:"/online/cgform/api/form/",urlButtonAction:"/online/cgform/api/doButton"},_sfc_main$4={name:"OnlinePopForm",components:{BasicForm,Loading:ne$1,OnlineSubForm,PrinterOutlined:ae,DiffOutlined:zt,FormOutlined:Qt},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},modalClass:{type:String,default:""},request:{type:Boolean,default:!0},isVxeTableData:{type:Boolean,default:!1}},emits:["success","rendered","dataChange"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),[o,{openModal:c}]=useModal(),l=ref(""),i=ref(null),C=ref(!0),b=ref(!1),D=ref(1),I=ref(!1),O=ref(!1),$=reactive({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{onlineFormContext:T,resetContext:A}=useOnlineFormContext(),{formSchemas:B,defaultValueFields:N,changeDataIfArray2String:P,tableName:V,dbData:k,checkOnlyFieldValue:U,hasSubTable:Y,subTabInfo:L,refMap:j,subDataSource:f,baseColProps:x,createFormSchemas:y,fieldDisplayStatus:M}=useFormItems(n,i);let{EnhanceJS:d,initCgEnhanceJs:u}=useEnhance(T,!1);const[a,{setProps:r,validate:p,resetFields:m,setFieldsValue:F,updateSchema:E,getFieldsValue:q,scrollToField:Z}]=useForm({schemas:B,showActionButtonGroup:!1,baseColProps:x}),X=ref(!1);function ee(){let s=n.disabled;X.value=s,r({disabled:s})}function se(s,g,w){return J(this,null,function*(){yield m(),k.value="";let R=unref(s);O.value=R,R&&(yield ue(g)),yield nextTick(()=>{!R&&w&&F(w),ce(),xe("js","loaded"),ee()})})}function ce(){if(unref(O)===!1){let s=toRaw(N[V.value]);loadFormFieldsDefVal(s,g=>{F(g)})}}function ue(s){return J(this,null,function*(){let g=yield W(s.id);(!g||Object.keys(g).length==0)&&(g=ne({},toRaw(s))),k.value=Object.assign({},g);let w=me.value,R=_(g,...w);n.isVxeTableData===!0&&(R=Object.assign({},R,s)),yield F(R)})}let me=computed(()=>{let s=B.value,g=[];for(let w of s)g.push(w.field);return g});function W(s){let g=`${urlObject.optPre}${n.id}/${s}`;return new Promise((w,R)=>{defHttp.get({url:g},{isTransformResponse:!1}).then(oe=>{oe.success?w(oe.result):(R(),t.warning(oe.message))}).catch(()=>{R()})})}function G(s){return J(this,null,function*(){D.value=s.head.tableType,V.value=s.head.tableName,C.value=s.head.tableType==1,re(s.head.extConfigJson),y(s.schema.properties,s.schema.required,U),d=u(s.enhanceJs),e("rendered",$);let g=yield getRefPromise(i);g.$formValueChange=(w,R,oe)=>{Re(w,R),oe&&F(oe)}})}function re(s){let g={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};s&&(g=JSON.parse(s)),Object.keys(g).map(w=>{$[w]=g[w]})}function le(){C.value===!0?ge():te()}function te(){H().then(s=>{be(s)})}function H(){let s={};return new Promise((g,w)=>{p().then(R=>g(R),({errorFields:R})=>{R&&R.length>0&&Z(R[0][0]),w(VALIDATE_FAILED)})}).then(g=>(Object.assign(s,P(g)),de())).then(g=>(Object.assign(s,g),Promise.resolve(s))).catch(g=>((g===VALIDATE_FAILED||(g==null?void 0:g.code)===VALIDATE_FAILED)&&(t.warning("校验未通过"),g.key&&ie(g.key)),Promise.reject(null)))}function ie(s){let g=L.value;for(let w=0;w<g.length;w++)if(s==g[w].key){Ce.value=w+"";break}}function de(){return new Promise((s,g)=>J(this,null,function*(){let w={};try{let R=L.value;for(let oe=0;oe<R.length;oe++){let fe=R[oe].key,he=j[fe].value;if(he instanceof Array&&(he=he[0]),R[oe].relationType==1)try{let ke=yield he.getAll();w[fe]=[],w[fe].push(ke)}catch(ke){throw{code:VALIDATE_FAILED,key:fe}}else{if(yield he.fullValidateTable())throw{code:VALIDATE_FAILED,key:fe};w[fe]=he.getTableData()}}}catch(R){g(R)}s(w)}))}function ge(){return J(this,null,function*(){try{let s=yield p();s=Object.assign({},k.value,s),s=P(s),b.value=!0,be(s)}finally{b.value=!1}})}function be(s){Le(Oe,s).then(()=>{Ge(s)}).catch(g=>{t.warning(g)})}function ye(s,g,w){g&&w?w.setValues?w.setValues(s):w.setValues([{rowKey:g,values:s}]):F(s)}function Pe(s,g){let w={};w[s]=g,F(w)}const Ce=ref("0"),Fe=ref(300),Se=ref(340);function De(s){if(O.value===!0){let g=k.value;return Me(g,s)}return""}function Me(s,g){if(s){let w=s[g];return!w&&w!==0&&(w=s[g.toLowerCase()],!w&&w!==0&&(w=s[g.toUpperCase()])),w}return""}function Ee(s,g){if(d&&d[g+"_onlChange"]){let w=d[g+"_onlChange"](),R=Object.keys(s)[0];if(w[R]){let oe=j[g].value;oe instanceof Array&&(oe=oe[0]);let fe=oe.getFormEvent(),he=ne({column:{key:R},value:s[R]},fe);w[R].call(T,T,he)}}}function $e(s,g){if(d&&d[g+"_onlChange"]){let w=d[g+"_onlChange"](T);w[s.column.key]&&w[s.column.key].call(T,T,s)}}function Ve(s,g){}function Ae(s){return"online_"+s+":"}function Re(s,g){return J(this,null,function*(){if(k.value[s]!=g&&e("dataChange",s),!d||!d.onlChange||!s)return!1;let w=d.onlChange();if(w[s]){let R={row:yield q(),column:{key:s},value:g};w[s].call(T,T,R)}})}function xe(s,g){if(s=="js")d&&d[g]&&d[g].call(T,T);else if(s=="action"){let w=k.value,R={formId:n.id,buttonCode:g,dataId:w.id,uiFormData:Object.assign({},w)};defHttp.post({url:`${urlObject.urlButtonAction}`,params:R},{isTransformResponse:!1}).then(oe=>{oe.success?t.success("处理完成!"):t.warning("处理失败!")})}}function _e(s){let g=j[s].value,w=[...g.getNewDataWithId(),...f.value[s]];if(!w||w.length==0)return!1;let R=[];for(let oe of w)R.push(oe.id);g.removeRowsById(R)}function we(s,g){if(!g)return!1;let w=j[s].value;typeof g=="object"?w.addRows(g,!0):t.error("添加子表数据,参数不识别!")}function Ne(s,g){_e(s),we(s,g)}function Be(s,g){!g&&g.length<=0&&(g=[]),g.map(w=>{w.hasOwnProperty("label")||(w.label=w.text)}),E({field:s,componentProps:{options:g}})}function Le(s,g){return d&&d.beforeSubmit?d.beforeSubmit(s,g):Promise.resolve()}function Ye(s,g){let w=toRaw(M);s&&s.length>0?Object.keys(w).map(R=>{!R.endsWith("_load")&&s.indexOf(R)<0&&(M[R]=!1)}):g&&g.length>0&&Object.keys(w).map(R=>{g.indexOf(R)>=0&&(M[R]=!1)})}function Ke(s){return J(this,null,function*(){yield m(),k.value="",O.value=!0,yield ue(s),yield nextTick(()=>{xe("js","loaded")})})}function qe(s){let g=j[s].value;return g instanceof Array&&(g=g[0]),g}function ze(){let s=$.reportPrintUrl,g=k.value.id,w=getToken();goJmReportViewPage(s,g,w)}function Qe(s){l.value=s.id,c(!0)}function Ze(s){}function Ge(s){if(Object.keys(s).map(g=>{Array.isArray(s[g])&&s[g].length==0&&(s[g]="")}),n.request==!1)e("success",s);else{let g=`${urlObject.optPre}${n.id}?tabletype=${D.value}`;I.value===!0&&(s[SUBMIT_FLOW_KEY]=1);let w=O.value===!0?"put":"post";defHttp.request({url:g,method:w,params:s},{isTransformResponse:!1}).then(R=>{R.success?(R.result&&(s.id||(s.id=R.result)),e("success",s),k.value=s,O.value=!0,t.success("操作成功!")):t.warning(R.message)}).finally(()=>{b.value=!1})}}function Xe(){return J(this,null,function*(){let s=k.value,g=me.value,w=_(s,...g);if(s)yield F(w);else{let R={};for(let oe of g)R[oe]="";yield F(R)}})}let Oe={tableName:V,loading:b,subActiveKey:Ce,onlineFormRef:i,getFieldsValue:q,setFieldsValue:F,submitFlowFlag:I,subFormHeight:Fe,subTableHeight:Se,refMap:j,triggleChangeValues:ye,triggleChangeValue:Pe,sh:M,clearSubRows:_e,addSubRows:we,clearThenAddRows:Ne,changeOptions:Be,isUpdate:O,getSubTableInstance:qe};return A(Oe),{tableName:V,onlineFormRef:i,registerForm:a,loading:b,subActiveKey:Ce,hasSubTable:Y,subTabInfo:L,refMap:j,subFormHeight:Fe,getSubTableForeignKeyValue:De,isUpdate:O,handleSubFormChange:Ee,subTableHeight:Se,onlineFormDisabled:X,subDataSource:f,getSubTableAuthPre:Ae,handleAdded:Ve,handleValueChange:$e,openSubFormModalForAdd:Qe,openSubFormModalForEdit:Ze,registerVxeFormModal:o,vxeTableId:l,show:se,createRootProperties:G,handleSubmit:le,sh:M,handleCgButtonClick:xe,handleCustomFormSh:Ye,handleCustomFormEdit:Ke,dbData:k,onOpenReportPrint:ze,onlineExtConfigJson:$,recoverFormData:Xe}}},_hoisted_1$3=["id"];function _sfc_render$4(n,e,t,o,c,l){const i=resolveComponent("BasicForm");return openBlock(),createElementBlock("div",{id:o.tableName+"_form"},[createVNode(i,{ref:"onlineFormRef",onRegister:o.registerForm},null,8,["onRegister"])],8,_hoisted_1$3)}const OnlinePopForm=h(_sfc_main$4,[["render",_sfc_render$4]]),OnlinePopForm$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopForm},Symbol.toStringTag,{value:"Module"}));function useAutoModal(n,{emit:e}={},t){const o=ref(null),c=ref(!1),l=ref(1),i=ref([]),C=ref(!1),b=ref(0),D=ref(!1),I=ref(""),O=ref(!1),$=ref(!1),T=ref(!0),A=reactive({}),B=ref(!0),N=ref(""),P=ref(!0),V=ref(!1),{popModalFixedWidth:k,resetBodyStyle:U,popBodyStyle:Y}=useFixedHeightModal(),L=ref(!1),j=ref(""),f={handleOpenModal:H=>{}},x=ref(""),y=ref(""),M=ref(!1);let d={};const u=computed(()=>N.value||(unref(c)===!0?"详情":unref($)===!0?"编辑":"新增")),[a,{setModalProps:r,closeModal:p}]=useModalInner(H=>J(this,null,function*(){N.value="",V.value=!1,n===!0?yield f.handleOpenModal(H):yield E(H),U(),t&&t()})),m=ref(!1);function F(){return J(this,null,function*(){return yield getRefPromise(m),L.value})}function E(H){return J(this,null,function*(){r({confirmLoading:!1}),$.value=H.isUpdate,c.value=H.disableSubmit||!1,(H==null?void 0:H.hideSub)===!0&&(B.value=!1),H!=null&&H.title&&(N.value=H.title),H!=null&&H.record?y.value=H.record.id:y.value="",yield nextTick(()=>J(this,null,function*(){yield getRefPromise(C),Z(),yield o.value.show(H==null?void 0:H.isUpdate,H==null?void 0:H.record,H==null?void 0:H.param)}))})}function q(H){C.value=!0,b.value=H.modalMinWidth,H.modelFullscreen==1?r({defaultFullscreen:!0}):r({defaultFullscreen:!1}),d=H}function Z(){let H=y.value;d.commentStatus==1&&H?(M.value=!0,r({defaultFullscreen:!0})):M.value=!1}const X=800,ee=1100,se=computed(()=>{let H=200*(l.value-1),ie=(unref(T)?X:ee)+H;ie=ce(ie);let de=b.value;return de&&ie<de&&(ie=de),ie});function ce(H){let ie=A.modalMinWidth;if(ie!=null&&ie!=="")try{if(ie=Number.parseInt(ie),H<ie)return ie}catch(de){}return H}function ue(H,ie){o.value.handleCgButtonClick(H,ie)}function me(){O.value=!0,setTimeout(()=>{O.value=!1},1500),o.value.handleSubmit()}function W(){p()}function G(H,ie={}){let de=`/online/cgform/api/getFormItem/${H}`;return new Promise((ge,be)=>{defHttp.get({url:de,params:ie},{isTransformResponse:!1}).then(ye=>{ye.success?ge(ye.result):be(ye.message)}).catch(()=>{be()})})}function re(H,ie){return J(this,null,function*(){let de=yield G(H,ie),ge=de.head.formTemplate;l.value=ge?Number(ge):1,i.value=de.cgButtonList,D.value=de.head.isTree==="Y",I.value=de.head.treeParentIdField||"",x.value=de.head.tableName,j.value=de.head.themeTemplate,de.form_disable_update===!0?L.value=!0:L.value=!1,m.value=!0,e&&e("formConfig",de),yield nextTick(()=>J(this,null,function*(){yield(yield getRefPromise(o)).createRootProperties(de)}))})}function le(H){H[ONL_FORM_TABLE_NAME]=x.value,e("success",H),P.value==!0&&p(),V.value=!1,P.value=!0}function te(){o.value&&o.value.onCloseModal()}return{title:u,modalWidth:se,registerModal:a,closeModal:p,modalObject:f,onCloseEvent:te,cgButtonList:i,handleCgButtonClick:ue,disableSubmit:c,handleSubmit:me,submitLoading:O,handleCancel:W,successThenClose:P,handleSuccess:le,topTipVisible:V,handleFormConfig:re,onlineFormCompRef:o,formTemplate:l,isTreeForm:D,pidFieldName:I,renderSuccess:q,formRendered:C,isUpdate:$,showSub:B,themeTemplate:j,tableName:x,formDataId:y,enableComment:M,popBodyStyle:Y,popModalFixedWidth:k,getFormStatus:F}}function useFixedHeightModal(){const n=ref(800);let e=window.innerWidth-300;e<800&&(e=800),n.value=e;const t=ref({});function o(){let c=window.innerHeight-210;t.value={height:c+"px",overflowY:"auto"}}return{popModalFixedWidth:n,popBodyStyle:t,resetBodyStyle:o}}const _sfc_main$3=defineComponent({name:"OnlinePopModal",props:{id:{type:String,default:""},showFields:{type:Array,default:()=>[]},hideFields:{type:Array,default:()=>[]},topTip:{type:Boolean,default:!1},request:{type:Boolean,default:!0},saveClose:{type:Boolean,default:!1},isVxeTableData:{type:Boolean,default:!1},formTableType:{type:String,default:""}},components:{BasicModal,OnlinePopForm,JModalTip:S,Button},emits:["success","register","formConfig"],setup(n,{emit:e}){const{title:t,registerModal:o,cgButtonList:c,handleCgButtonClick:l,disableSubmit:i,handleSubmit:C,submitLoading:b,handleCancel:D,handleFormConfig:I,onlineFormCompRef:O,formTemplate:$,isTreeForm:T,pidFieldName:A,renderSuccess:B,formRendered:N,handleSuccess:P,topTipVisible:V,successThenClose:k,isUpdate:U,popBodyStyle:Y,popModalFixedWidth:L,getFormStatus:j}=useAutoModal(!1,{emit:e});watch(()=>n.id,f,{immediate:!0});function f(){return J(this,null,function*(){if(N.value=!1,!n.id)return;let a={};n.formTableType&&(a.tabletype=n.formTableType),yield I(n.id,a)})}function x(){n.saveClose===!1&&(k.value=!1),C()}function y(){V.value=!1,O.value.recoverFormData()}function M(){V.value=!0}const d=computed(()=>U.value?n.topTip:!1),u=computed(()=>{if(U.value==!0)return null;{let a=b.value;return[h$1(Button,{type:"primary",loading:a,onClick:C},()=>"确定"),h$1(Button,{onClick:D},()=>"关闭")]}});return{title:t,topTipVisible:V,handleSaveData:x,handleRecover:y,onlineFormCompRef:O,renderSuccess:B,registerModal:o,handleSubmit:C,handleSuccess:P,handleCancel:D,formTemplate:$,disableSubmit:i,cgButtonList:c,handleCgButtonClick:l,isTreeForm:T,pidFieldName:A,submitLoading:b,handleDataChange:M,isUpdate:U,showTopTip:d,modalFooter:u,popBodyStyle:Y,popModalFixedWidth:L,getFormStatus:j}}});function _sfc_render$3(n,e,t,o,c,l){const i=resolveComponent("j-modal-tip"),C=resolveComponent("online-pop-form"),b=resolveComponent("BasicModal");return openBlock(),createBlock(b,mergeProps({width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle},n.$attrs,{footer:n.modalFooter,cancelText:"关闭",onRegister:n.registerModal,wrapClassName:"jeecg-online-pop-modal",onOk:n.handleSubmit}),{title:withCtx(()=>[createTextVNode(toDisplayString(n.title)+" ",1),n.showTopTip?(openBlock(),createBlock(i,{key:0,visible:n.topTipVisible,onSave:n.handleSaveData,onCancel:n.handleRecover},null,8,["visible","onSave","onCancel"])):createCommentVNode("",!0)]),default:withCtx(()=>[createVNode(C,{ref:"onlineFormCompRef",id:n.id,disabled:n.disableSubmit,"form-template":n.formTemplate,isTree:n.isTreeForm,pidField:n.pidFieldName,request:n.request,isVxeTableData:n.isVxeTableData,onRendered:n.renderSuccess,onSuccess:n.handleSuccess,onDataChange:n.handleDataChange,"modal-class":"jeecg-online-pop-modal"},null,8,["id","disabled","form-template","isTree","pidField","request","isVxeTableData","onRendered","onSuccess","onDataChange"])]),_:1},16,["width","bodyStyle","footer","onRegister","onOk"])}const OnlinePopModal=h(_sfc_main$3,[["render",_sfc_render$3]]),OnlinePopModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopModal},Symbol.toStringTag,{value:"Module"}));function queryTableData(n,e){const t="/online/cgform/api/getData/"+n;return defHttp.get({url:t,params:e})}function queryTableColumns(n,e){const t="/online/cgform/api/getColumns/"+n;return defHttp.get({url:t,params:e})}function useLinkTable(n){const e=ref("1"),t=ref({}),o=ref({}),c=ref(""),l=reactive({add:!0,update:!0}),i=computed(()=>n.textField?n.textField.split(","):[]),C=ref([]),b=computed(()=>{let f=C.value;return n.multi==!0?f.slice(0,3):f.slice(0,6)});watchEffect(()=>J(this,null,function*(){if(n.tableName){let f=n.valueField||"",x=n.textField||"",y=[];if(f&&y.push(f),x){let d=x.split(",");c.value=d[0];for(let u of d)y.push(u)}let M=n.imageField||"";M&&y.push(M),t.value={linkTableSelectFields:y.join(",")},yield T(),yield A()}}));const D=computed(()=>{let f=n.textField||"",x=[],y="";if(f){let M=f.split(",");y=M[0];for(let d=0;d<M.length;d++)d>0&&x.push(M[d])}return{others:x,labelField:y}}),I=ref([]),O=ref([]),$=ref({});function T(){return J(this,null,function*(){let f=t.value;const x=yield queryTableColumns(n.tableName,f);if(O.value=x.columns,x.columns){let y=n.imageField,M=x.columns.filter(d=>d.dataIndex!=c.value&&d.dataIndex!=y);C.value=M}if($.value=x.dictOptions,x.hideColumns){let y=x.hideColumns;y.indexOf("add")>=0?l.add=!1:l.add=!0,y.indexOf("update")>=0?l.update=!1:l.update=!0}})}function A(){return J(this,null,function*(){let f=N(),x=(yield queryTableData(n.tableName,f)).records,y=[],{others:M,labelField:d}=D.value,u=n.imageField;if(x&&x.length>0)for(let a of x){let r=ne({},a);B(r);let p=Object.assign({},_(r,M),{id:r.id,label:r[d],value:r[n.valueField]});u&&(p[u]=r[u]),y.push(p)}y.push({}),I.value=y})}function B(f){let x=O.value,y=$.value;for(let M of x){const{dataIndex:d,customRender:u}=M;(f[d]||f[d]===0)&&u&&u==d&&y[u]&&(f[d]=filterMultiDictText(y[u],f[d]))}}function N(){return Object.assign({pageSize:10,pageNo:e.value},t.value,o.value)}function P(f){if(!f)o.value={};else{let x=i.value,y=[],M=[];for(let d=0;d<x.length;d++)d<=1&&(M.push(x[d]),y.push({field:x[d],rule:"like",val:f}));y.superQueryMatchType="or",y.superQueryParams=encodeURI(JSON.stringify(y)),o.value=y}}function V(f){return J(this,null,function*(){if(!f)return[];let x=n.valueField,y=pe(ne({},t.value),{pageSize:10,pageNo:e.value});y.superQueryMatchType="and";let M=[{field:x,rule:"in",val:f}];y.superQueryParams=encodeURI(JSON.stringify(M));let d=(yield queryTableData(n.tableName,y)).records,u=[];if(d&&d.length>0)for(let a of d){let r=ne({},a);B(r),u.push(r)}return u})}function k(f,x){if(!f||f.length==0)return!1;let y=x.split(",");if(y.length!=f.length)return!1;let M=!0;for(let d of f){let u=d[n.valueField];y.indexOf(u)<0&&(M=!1)}return M}function U(f){Object.keys(f).map(x=>{f[x]instanceof Array&&(f[x]=f[x].join(","))})}function Y(f,x,y){if(y||(y={}),x&&x.length>0)for(let M of x){let d=M.split(","),u=d[0],a=d[1];if(f[u])f[u].push(y[a]);else{let r=y[a]||"";f[u]=[r]}}}function L(f){if(n.imageField){let x=f[n.imageField];return getFileAccessHttpUrl(x)}return""}const j=computed(()=>!!n.imageField);return{pageNo:e,otherColumns:C,realShowColumns:b,selectOptions:I,reloadTableLinkOptions:A,textFieldArray:i,addQueryParams:P,tableColumns:O,transData:B,mainContentField:c,loadOne:V,compareData:k,formatData:U,initFormData:Y,getImageSrc:L,showImage:j,auths:l}}const _sfc_main$2={name:"LinkTableSelect",components:{PlusOutlined,EditOutlined,OnlinePopModal},props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number,propTypes.array]),linkFields:propTypes.array.def([]),imageField:propTypes.string.def("")},emits:["change","update:value"],setup(n,{emit:e}){const t=ref([]),{auths:o,mainContentField:c,textFieldArray:l,selectOptions:i,reloadTableLinkOptions:C,addQueryParams:b,formatData:D,initFormData:I,getImageSrc:O,showImage:$}=useLinkTable(n),[T,{openModal:A}]=useModal(),B=computed(()=>n.tableName),N=computed(()=>n.multi===!0?{mode:"multiple"}:{});function P(f){f==null||f.stopPropagation(),f==null||f.preventDefault(),A(!0,{})}function V(f,x){f==null||f.stopPropagation(),f==null||f.preventDefault(),o.update!=!1&&A(!0,{isUpdate:!0,record:x})}function k(f){return J(this,null,function*(){yield C();let x=f[n.valueField];t.value=x})}function U(f){b(f),C()}function Y(f){L(f),f||(b(),C())}function L(f){let x={},y=n.linkFields,M=[];if(!f)I(x,y);else{let d=toRaw(i.value),u=toRaw(f);u instanceof Array?M=[...u]:n.multi==!0?M=u.split(","):M=[u];let a=d.filter(r=>M.indexOf(r[n.valueField])>=0);if(a&&a.length>0){let r=ne({},a[0]);if(a.length>1)for(let m=1;m<a.length;m++)r=j(r,a[m]);let p=c.value;r[p]=r.label,I(x,y,r)}}D(x),e("change",M.join(",")||"",x),e("update:value",M.join(",")||"")}function j(f,x){let y={};return Object.keys(f).map(M=>{y[M]=(f[M]||"")+","+(x[M]||"")}),y}return watch(()=>n.value,f=>J(this,null,function*(){f?(n.multi==!0?t.value=f.split(","):t.value=f,n.linkFields&&n.linkFields.length>0&&L(f)):t.value=[]}),{immediate:!0}),watch(()=>i.value,f=>{f&&f.length>0&&n.linkFields&&n.linkFields.length>0&&t.value&&t.value.length>0&&L(t.value)}),{selectValue:t,selectOptions:i,registerPopModal:T,popTableName:B,textFieldArray:l,handleClickAdd:P,handleClickEdit:V,getFormData:k,handleSearch:useDebounceFn(U,800),handleChange:Y,bindValue:N,showImage:$,getImageSrc:O,auths:o}}},_hoisted_1$2={key:1,class:"online-select-item"},_hoisted_2$2={key:0,class:"left-avatar"},_hoisted_3$2=["src"],_hoisted_4$2={class:"right-content"},_hoisted_5$2={class:"label"},_hoisted_6$2={class:"others"},_hoisted_7$1={class:"other-item ellipsis"};function _sfc_render$2(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("EditOutlined"),b=resolveComponent("a-select"),D=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createVNode(b,mergeProps({value:o.selectValue,"onUpdate:value":e[1]||(e[1]=I=>o.selectValue=I),style:{width:"100%"},placeholder:"请选择","option-label-prop":"label",dropdownClassName:"table-link-select",allowClear:"","show-search":""},o.bindValue,{options:o.selectOptions,"filter-option":!1,"not-found-content":null,onSearch:o.handleSearch,onChange:o.handleChange}),{option:withCtx(I=>[!I.value&&o.auths.add?(openBlock(),createElementBlock("div",{key:0,class:"opt-add",onClick:e[0]||(e[0]=(...O)=>o.handleClickAdd&&o.handleClickAdd(...O))},[createVNode(i),createTextVNode(" 记录 ")])):(openBlock(),createElementBlock("div",_hoisted_1$2,[o.showImage?(openBlock(),createElementBlock("div",_hoisted_2$2,[o.getImageSrc(I)?(openBlock(),createElementBlock("img",{key:0,src:o.getImageSrc(I),alt:""},null,8,_hoisted_3$2)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[o.auths.update?(openBlock(),createBlock(C,{key:0,onClick:O=>o.handleClickEdit(O,I)},null,8,["onClick"])):createCommentVNode("",!0),createTextVNode(" "+toDisplayString(I.label),1)]),createBaseVNode("div",_hoisted_6$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.textFieldArray,O=>(openBlock(),createElementBlock("div",_hoisted_7$1,toDisplayString(I[O]),1))),256))])])]))]),_:1},16,["value","options","onSearch","onChange"]),createVNode(D,{id:o.popTableName,onRegister:o.registerPopModal,onSuccess:o.getFormData,topTip:""},null,8,["id","onRegister","onSuccess"])])}const LinkTableSelect=h(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-e9a2adfa"]]),LinkTableSelect$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableSelect},Symbol.toStringTag,{value:"Module"}));function useTableColumns(onlineTableContext,extConfigJson){let router=useRouter();const columns=ref([]),dictOptionInfo=ref({}),selectedKeys=ref([]),rowSelection=ref(null);let enableScrollBar=ref(!0),tableScroll=computed(()=>{if(enableScrollBar.value!=!0)return{x:!1}});const[registerOnlineHrefModal,{openModal:openOnlineHrefModal}]=useModal(),hrefMainTableId=ref(""),[registerPopModal,{openModal:openPopModal}]=useModal(),popTableId=ref("");function handleColumnResult(n,e="checkbox"){dictOptionInfo.value=n.dictOptions,n.checkboxFlag=="Y"?rowSelection.value={selectedRowKeys:selectedKeys,onChange:onSelectChange,type:e}:rowSelection.value=null,enableScrollBar.value=n.scrollFlag==1;let t=n.columns;t.forEach(i=>{i.fieldExtendJson&&JSON.parse(i.fieldExtendJson).isFixed&&(i.fixed="left"),Object.keys(i).map(C=>{i[C]==null&&delete i[C]})});let o=n.fieldHrefSlots;const c={};o.forEach(i=>c[i.slotName]=i);let l=[];if(l=handleColumnHrefAndDict(t,c),bpmStatusFilter(l),onlineTableContext.isTree()===!0){let i=n.textField,C=-1;for(let b=0;b<l.length;b++)if(l[b].dataIndex==i){C=b;break}if(C>0){let b=l.splice(C,1);l.unshift(b[0])}l.length>0&&(l[0].align="left")}columns.value=l,onlineTableContext.reloadTable()}function onSelectChange(n,e){selectedKeys.value=n,onlineTableContext.selectedRows=toRaw(e),onlineTableContext.selectedRowKeys=toRaw(n)}function handleColumnHrefAndDict(n,e){for(let t of n){let{customRender:o,hrefSlotName:c,fieldType:l}=t;if(l=="date"||l=="Date")t.customRender=({text:i})=>i?i.length>10?i.substring(0,10):i:"";else if(l=="link_table")t.customRender=({text:i,record:C})=>{if(!i)return"";if(onlineTableContext.isPopList===!0)return C[t.dataIndex+"_dictText"];{let b=(i+"").split(","),D=[];C[t.dataIndex+"_dictText"]&&(D=C[t.dataIndex+"_dictText"].split(","));let I=[];for(let O=0;O<b.length;O++){let $=h$1(v,{id:b[O],text:D[O],onTab:T=>handleClickLinkTable(T,c)});I.push($)}return I.length==0?"":h$1("div",{style:{overflow:"hidden"}},I)}};else{if(!c&&t.scopedSlots&&t.scopedSlots.customRender&&e.hasOwnProperty(t.scopedSlots.customRender)&&(c=t.scopedSlots.customRender),o||c){let i=o,C="_replace_text_";t.ellipsis=!0,t.customRender=({text:b,record:D})=>{let I=b;if(i)if(i.startsWith(C)){let O=i.replace(C,"");I=D[O]}else I=filterMultiDictText(unref(dictOptionInfo)[i],b+"");if(t.showLength&&I&&I.length>t.showLength&&(I=I.substr(0,t.showLength)+"..."),c){let O=e[c];if(O)return h$1("a",{onClick:()=>handleClickFieldHref(O,D)},I)}return I}}if(t.scopedSlots){t.ellipsis=!0;let i=t.scopedSlots;t.slots=i,delete t.scopedSlots}}}return n}function handleClickFieldHref(field,record){let href=field.href,urlPattern=/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/,compPattern=/\.vue(\?.*)?$/,jsPattern=/{{([^}]+)}}/g;if(typeof href=="string")if(href.startsWith("ONLINE:")){let n=href.split(":");hrefMainTableId.value=n[1];let e=n[2];openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:record[e]}})}else href=href.trim().replace(/\${([^}]+)?}/g,(n,e)=>record[e]),jsPattern.test(href)&&(href=href.replace(jsPattern,function(text,s0){try{return eval(s0)}catch(n){return text}})),urlPattern.test(href)?window.open(href,"_blank"):compPattern.test(href)?openHrefCompModal(href):router.push(href)}const dialogStyle={top:0,left:0,height:"100%",margin:0,padding:0},hrefComponent=reactive({model:{title:"",okText:"关闭",width:"100%",visible:!1,destroyOnClose:!0,style:dialogStyle,bodyStyle:{padding:"8px",height:"calc(100vh - 108px)",overflow:"auto",overflowX:"hidden"},cancelButtonProps:{style:{display:"none"}}},on:{ok:()=>hrefComponent.model.visible=!1,cancel:()=>hrefComponent.model.visible=!1},is:null,params:{}});function openHrefCompModal(n){let e=n.indexOf("?"),t=n;if(e!==-1){t=n.substring(0,e);let o=n.substring(e+1,n.length).split("&"),c={};o.forEach(l=>{let i=l.split("=");c[i[0]]=i[1]}),hrefComponent.params=c}else hrefComponent.params={};hrefComponent.model.visible=!0,hrefComponent.model.title="操作",hrefComponent.is=markRaw(defineAsyncComponent(()=>importViewsFile(t)))}let fixedAction="left";onlineTableContext.isTree()&&(fixedAction="right");const actionColumn=reactive({title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:fixedAction,align:"center",width:150});watch(()=>extConfigJson==null?void 0:extConfigJson.value,()=>{var n,e;((n=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:n.tableFixedAction)===1&&(actionColumn.fixed=((e=extConfigJson==null?void 0:extConfigJson.value)==null?void 0:e.tableFixedActionType)||"right",onlineTableContext.isTree()&&(actionColumn.fixed="right"))});function bpmStatusFilter(n){let e=!1;for(let t=0;t<n.length;t++)if(n[t].dataIndex.toLowerCase()=="bpm_status"){e=!0;break}return onlineTableContext.hasBpmStatus=e,e}function downloadRowFile(n){if(!n)return;n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(",")));let e=getFileAccessHttpUrl(n);window.open(e)}function getImgView(n){return n&&n.indexOf(",")>0&&(n=n.substring(0,n.indexOf(","))),getFileAccessHttpUrl(n)}function getPcaText(n){return n?getAreaTextByCode(n):""}function getFormatDate(n){if(!n)return"";let e=n;return e.length>10&&(e=e.substring(0,10)),e}watch(selectedKeys,()=>{onlineTableContext.selectedRowKeys=toRaw(selectedKeys.value)}),onlineTableContext.clearSelectedRow=()=>{selectedKeys.value=[],onlineTableContext.selectedRows=[],onlineTableContext.selectedRowKeys=[]};function viewOnlineCellImage(n){if(n){let e=[],t=n.split(",");for(let o of t)o&&e.push(getFileAccessHttpUrl(o));createImgPreview({imageList:e})}}const onlinePopModalRef=ref();function handleClickLinkTable(n,e){return J(this,null,function*(){popTableId.value=e,(yield onlinePopModalRef.value.getFormStatus())==!0?(hrefMainTableId.value=e,openOnlineHrefModal(!0,{isUpdate:!0,disableSubmit:!0,hideSub:!0,record:{id:n}})):openPopModal(!0,{isUpdate:!0,record:{id:n}})})}return{columns,actionColumn,selectedKeys,rowSelection,enableScrollBar,tableScroll,downloadRowFile,getImgView,getPcaText,getFormatDate,handleColumnResult,onSelectChange,hrefComponent,viewOnlineCellImage,hrefMainTableId,registerOnlineHrefModal,registerPopModal,openPopModal,openOnlineHrefModal,onlinePopModalRef,popTableId}}const _sfc_main$1=defineComponent({name:"OnlinePopListModal",props:{id:{type:String,default:""},multi:{type:Boolean,default:!1},addAuth:{type:Boolean,default:!0}},components:{BasicModal,BasicTable:K,TableAction:Q,PlusOutlined,OnlinePopModal},emits:["success","register"],setup(n,{emit:e}){const{createMessage:t}=useMessage(),{popModalFixedWidth:o,resetBodyStyle:c,popBodyStyle:l}=useFixedHeightModal(),i=ref(""),C=ref(800),[b,{closeModal:D}]=useModalInner(()=>{i.value="",E.value=[],q.value=[],m({current:1}),p(),c()}),[I,{openModal:O}]=useModal();function $(){D()}const T=computed(()=>{const W=E.value;return!(W&&W.length>0)}),A=ref(!1);function B(){A.value=!0;let W=toRaw(q.value);W&&W.length>0&&(e("success",W),D()),setTimeout(()=>{A.value=!1},200)}function N(W){const G="/online/cgform/api/getData/"+n.id;return defHttp.get({url:G,params:W})}function P(W){return W.column="id",new Promise((G,re)=>J(this,null,function*(){const le=yield N(W);G(le)}))}const V={isPopList:!0,reloadTable(){},isTree(){return!1}},k=ref({}),{columns:U,downloadRowFile:Y,getImgView:L,getPcaText:j,getFormatDate:f,handleColumnResult:x,hrefComponent:y,viewOnlineCellImage:M}=useTableColumns(V,k);function d(){const W="/online/cgform/api/getColumns/"+n.id;return new Promise((G,re)=>{defHttp.get({url:W},{isTransformResponse:!1}).then(le=>{le.success?G(le.result):(t.warning(le.message),re())})})}const u=ref("");watch(()=>n.id,()=>J(this,null,function*(){let W=yield d();x(W),u.value=W.description}),{immediate:!0});const{tableContext:a}=useListPage({designScope:"process-design",pagination:!0,tableProps:{title:"",api:P,clickToRowSelect:!0,columns:U,showTableSetting:!1,immediate:!1,canResize:!1,showActionColumn:!1,actionColumn:{dataIndex:"action",slots:{customRender:"action"}},useSearchForm:!1,beforeFetch:W=>ce(W)}}),[r,{reload:p,setPagination:m},{rowSelection:F,selectedRowKeys:E,selectedRows:q}]=a;watch(()=>n.multi,W=>{W==!0?F.type="checkbox":F.type="radio"},{immediate:!0});function Z(W){return[{label:"编辑",onClick:X.bind(null,W)}]}function X(W){}function ee(){p()}const se=["int","double","Date","Datetime","BigDecimal"];function ce(W){let G=i.value;if(!G)return W.superQueryMatchType="or",W.superQueryParams="",W;let re=U.value,le=[];if(re&&re.length>0)for(let te of re)te.dbType&&(te.dbType=="string"?le.push({field:te.dataIndex,type:te.dbType.toLowerCase(),rule:"like",val:G}):te.dbType=="Date"?G.length==10&&le.push({field:te.dataIndex,type:te.dbType.toLowerCase(),rule:"eq",val:G}):te.dbType=="Datetime"?G.length==19&&le.push({field:te.dataIndex,type:te.dbType.toLowerCase(),rule:"eq",val:G}):se.indexOf(te.dbType)&&le.push({field:te.dataIndex,type:te.dbType.toLowerCase(),rule:"eq",val:G}));return W.superQueryMatchType="or",W.superQueryParams=encodeURI(JSON.stringify(le)),W}function ue(){O(!0,{})}function me(W){e("success",[W]),D()}return{registerModal:b,modalWidth:C,handleCancel:$,submitDisabled:T,submitLoading:A,handleSubmit:B,registerTable:r,getTableAction:Z,searchText:i,onSearch:ee,downloadRowFile:Y,getImgView:L,getPcaText:j,getFormatDate:f,hrefComponent:y,viewOnlineCellImage:M,rowSelection:F,modalTitle:u,registerPopModal:I,handleAdd:ue,reload:p,popModalFixedWidth:o,popBodyStyle:l,handleDataSave:me}}}),_hoisted_1$1={style:{display:"inline-block",width:"calc(100% - 140px)","text-align":"left"}},_hoisted_2$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_3$1={key:0,style:{"font-size":"12px","font-style":"italic"}},_hoisted_4$1=["src","onClick"],_hoisted_5$1=["innerHTML"],_hoisted_6$1=["title"];function _sfc_render$1(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("a-button"),b=resolveComponent("a-input-search"),D=resolveComponent("TableAction"),I=resolveComponent("BasicTable"),O=resolveComponent("BasicModal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock(Fragment,null,[createVNode(O,{onRegister:n.registerModal,width:n.popModalFixedWidth,dialogStyle:{top:"70px"},bodyStyle:n.popBodyStyle,title:n.modalTitle,wrapClassName:"jeecg-online-pop-list-modal"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[n.addAuth?(openBlock(),createBlock(C,{key:0,style:{"border-radius":"50px"},type:"primary",onClick:n.handleAdd},{default:withCtx(()=>[createVNode(i),createTextVNode("新增记录")]),_:1},8,["onClick"])):createCommentVNode("",!0)]),createVNode(C,{key:"back",onClick:n.handleCancel},{default:withCtx(()=>[createTextVNode("关闭")]),_:1},8,["onClick"]),createVNode(C,{disabled:n.submitDisabled,key:"submit",type:"primary",onClick:n.handleSubmit,loading:n.submitLoading},{default:withCtx(()=>[createTextVNode("确定")]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[createVNode(I,{onRegister:n.registerTable,rowSelection:n.rowSelection},{tableTitle:withCtx(()=>[createVNode(b,{value:n.searchText,"onUpdate:value":e[0]||(e[0]=T=>n.searchText=T),onSearch:n.onSearch,placeholder:"请输入关键词，按回车搜索",style:{width:"240px"}},null,8,["value","onSearch"])]),action:withCtx(({record:T})=>[createVNode(D,{actions:n.getTableAction(T)},null,8,["actions"])]),fileSlot:withCtx(({text:T})=>[T?(openBlock(),createBlock(C,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:A=>n.downloadRowFile(T)},{default:withCtx(()=>[createTextVNode(" 下载 ")]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_2$1,"无文件"))]),imgSlot:withCtx(({text:T})=>[T?(openBlock(),createElementBlock("img",{key:1,src:n.getImgView(T),alt:"图片不存在",class:"online-cell-image",onClick:A=>n.viewOnlineCellImage(T)},null,8,_hoisted_4$1)):(openBlock(),createElementBlock("span",_hoisted_3$1,"无图片"))]),htmlSlot:withCtx(({text:T})=>[createBaseVNode("div",{innerHTML:T},null,8,_hoisted_5$1)]),pcaSlot:withCtx(({text:T})=>[createBaseVNode("div",{title:n.getPcaText(T)},toDisplayString(n.getPcaText(T)),9,_hoisted_6$1)]),dateSlot:withCtx(({text:T})=>[createBaseVNode("span",null,toDisplayString(n.getFormatDate(T)),1)]),_:1},8,["onRegister","rowSelection"])]),_:1},8,["onRegister","width","bodyStyle","title"]),createVNode($,{id:n.id,onRegister:n.registerPopModal,onSuccess:n.handleDataSave,topTip:""},null,8,["id","onRegister","onSuccess"])],64)}const OnlinePopListModal=h(_sfc_main$1,[["render",_sfc_render$1]]),OnlinePopListModal$1=Object.freeze(Object.defineProperty({__proto__:null,default:OnlinePopListModal},Symbol.toStringTag,{value:"Module"})),_sfc_main={name:"LinkTableCard",props:{valueField:propTypes.string.def(""),textField:propTypes.string.def(""),tableName:propTypes.string.def(""),multi:propTypes.bool.def(!1),value:propTypes.oneOfType([propTypes.string,propTypes.number]),linkFields:propTypes.array.def([]),disabled:propTypes.bool.def(!1),detail:propTypes.bool.def(!1),imageField:propTypes.string.def("")},components:{PlusOutlined,MinusCircleFilled,OnlinePopListModal,OnlinePopModal},emits:["change","update:value"],setup(n,{emit:e}){const t=computed(()=>n.tableName),[o,{openModal:c}]=useModal(),[l,{openModal:i}]=useModal(),C=ref([]),b=ref([]),D=computed(()=>!(n.disabled==!0||n.multi===!1&&b.value.length>0)),{auths:I,otherColumns:O,realShowColumns:$,tableColumns:T,textFieldArray:A,transData:B,loadOne:N,compareData:P,formatData:V,initFormData:k,getImageSrc:U,showImage:Y}=useLinkTable(n),L=computed(()=>n.multi===!0?12:24),j=computed(()=>n.multi===!0?24:12);function f(p){if(p&&A.value.length>0){let m=A.value[0];return p[m]}}function x(p){p==null||p.stopPropagation(),p==null||p.preventDefault()}function y(p,m){x(p),I.update!=!1&&n.disabled==!1&&i(!0,{isUpdate:!0,record:m})}function M(p){c(!0,{})}function d(p){let m=b.value;for(let F of p){let E=ne({},F);B(E),m.push(E)}b.value=m,r()}function u(p){let m=b.value;for(let F=0;F<m.length;F++)if(m[F].id===p.id){let E=ne({},p);B(E),m.splice(F,1,E)}b.value=m,r()}function a(p,m){x(p);let F=b.value;F&&F.length>m&&(F.splice(m,1),b.value=F),r()}function r(){let p=b.value,m=[],F={},E=n.linkFields;if(p.length>0)for(let Z=0;Z<p.length;Z++)m.push(p[Z][n.valueField]),k(F,E,p[Z]);else k(F,E);let q=m.join(",");V(F),e("change",q,F),e("update:value",q)}return watch(()=>n.value,p=>J(this,null,function*(){if(p){if(P(b.value,p)===!1){let m=yield N(p);b.value=m}n.linkFields&&n.linkFields.length>0&&r()}else b.value=[]}),{immediate:!0}),{popTableName:t,selectRecords:b,otherColumns:O,realShowColumns:$,showButton:D,selectValue:C,handleAddRecord:M,handleDeleteRecord:a,getMainContent:f,itemSpan:L,columnSpan:j,tableColumns:T,addCard:d,registerListModal:o,registerFormModal:l,handleClickEdit:y,updateCardData:u,getImageSrc:U,showImage:Y,auths:I}}},_hoisted_1={class:"table-link-card"},_hoisted_2={style:{width:"100%",height:"100%"}},_hoisted_3={key:0,class:"card-button"},_hoisted_4=["onClick"],_hoisted_5={key:0,class:"card-delete"},_hoisted_6={class:"card-inner"},_hoisted_7={class:"card-main-content"},_hoisted_8={class:"other-content"},_hoisted_9={class:"label ellipsis"},_hoisted_10={class:"text ellipsis"},_hoisted_11={key:0,class:"card-item-image"},_hoisted_12=["src"];function _sfc_render(n,e,t,o,c,l){const i=resolveComponent("PlusOutlined"),C=resolveComponent("a-button"),b=resolveComponent("minus-circle-filled"),D=resolveComponent("a-col"),I=resolveComponent("a-row"),O=resolveComponent("online-pop-list-modal"),$=resolveComponent("online-pop-modal");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[o.showButton?(openBlock(),createElementBlock("div",_hoisted_3,[createVNode(C,{onClick:o.handleAddRecord},{default:withCtx(()=>[createVNode(i),createTextVNode("记 录")]),_:1},8,["onClick"])])):createCommentVNode("",!0),createVNode(I,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.selectRecords,(T,A)=>(openBlock(),createBlock(D,{span:o.itemSpan},{default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["card-item",{"disabled-chunk":t.detail==!0}]),onClick:B=>o.handleClickEdit(B,T)},[createBaseVNode("div",{class:normalizeClass(["card-item-left",{"show-right-image":o.showImage}])},[t.disabled==!1?(openBlock(),createElementBlock("span",_hoisted_5,[createVNode(b,{onClick:B=>o.handleDeleteRecord(B,A)},null,8,["onClick"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,toDisplayString(o.getMainContent(T)),1),createBaseVNode("div",_hoisted_8,[createVNode(I,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(o.realShowColumns,B=>(openBlock(),createBlock(D,{span:o.columnSpan},{default:withCtx(()=>[createBaseVNode("span",_hoisted_9,toDisplayString(B.title),1),createBaseVNode("span",_hoisted_10,toDisplayString(T[B.dataIndex]),1)]),_:2},1032,["span"]))),256))]),_:2},1024)])])],2),o.showImage?(openBlock(),createElementBlock("div",_hoisted_11,[o.getImageSrc(T)?(openBlock(),createElementBlock("img",{key:0,src:o.getImageSrc(T),alt:""},null,8,_hoisted_12)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_4)]),_:2},1032,["span"]))),256))]),_:1})])]),createVNode(O,{onRegister:o.registerListModal,multi:t.multi,id:o.popTableName,addAuth:o.auths.add,onSuccess:o.addCard},null,8,["onRegister","multi","id","addAuth","onSuccess"]),createVNode($,{id:o.popTableName,onRegister:o.registerFormModal,onSuccess:o.updateCardData,topTip:""},null,8,["id","onRegister","onSuccess"])])}const LinkTableCard=h(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-447ec75a"]]),LinkTableCard$1=Object.freeze(Object.defineProperty({__proto__:null,default:LinkTableCard},Symbol.toStringTag,{value:"Module"})),componentKeyMap={};function useExtendComponent(){n("OnlineSelectCascade",z),n("LinkTableSelect",LinkTableSelect),n("LinkTableCard",LinkTableCard);function n(t,o){componentKeyMap[t]||(add(t,o),componentKeyMap[t]=1)}function e(t){t.component=="LinkTableCard"&&(t.component="LinkTableSelect",t.componentProps.popContainer="body")}return{addComponent:n,linkTableCard2Select:e}}const useExtendComponent48d37d9b=Object.freeze(Object.defineProperty({__proto__:null,E:ENHANCEJS,F:FormSchemaFactory,L:LINK_DOWN,O:OnlinePopModal,S:SETUP,V:VALIDATE_FAILED,a:useTableColumns,b:useExtendComponent,c:FORM_VIEW_TO_QUERY_VIEW,d:getFieldIndex,e:useAutoModal,f:OnlineSubForm,g:getRefPromise,h:handleLinkDown,i:useOnlineFormContext,j:useFormItems,k:loadFormFieldsDefVal,l:loadOneFieldDefVal,m:SUBMIT_FLOW_KEY,n:SUBMIT_FLOW_ID,o:ONL_FORM_TABLE_NAME,p:getDetailFormSchemas,q:LinkTableCard,r:OnlineSubForm$1,s:OnlinePopForm$1,t:OnlinePopModal$1,u:useEnhance,v:LinkTableSelect$1,w:OnlinePopListModal$1,x:LinkTableCard$1},Symbol.toStringTag,{value:"Module"}));export{ENHANCEJS as E,FormSchemaFactory as F,LinkTableCard as L,OnlineSubForm as O,SUBMIT_FLOW_KEY as S,VALIDATE_FAILED as V,OnlinePopModal as a,useOnlineFormContext as b,useFormItems as c,useEnhance as d,SUBMIT_FLOW_ID as e,ONL_FORM_TABLE_NAME as f,getRefPromise as g,getDetailFormSchemas as h,getAreaTextByCode as i,FORM_VIEW_TO_QUERY_VIEW as j,loadOneFieldDefVal as k,loadFormFieldsDefVal as l,LINK_DOWN as m,handleLinkDown as n,getFieldIndex as o,useTableColumns as p,useAutoModal as q,SETUP as r,useExtendComponent48d37d9b as s,useExtendComponent as u};
