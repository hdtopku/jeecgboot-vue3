var ce=Object.defineProperty;var J=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var H=(a,u,c)=>u in a?ce(a,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[u]=c,Q=(a,u)=>{for(var c in u||(u={}))de.call(u,c)&&H(a,c,u[c]);if(J)for(var c of J(u))fe.call(u,c)&&H(a,c,u[c]);return a};import{d as T,e as x,r as me,k as E,s as ge,f as r,u as d,E as pe,m as ve,a5 as P,a6 as R,v as K,A as Z,aa as y,F as ie,w as ee,V as te,a7 as ne,ab as ae,W as se,a9 as he,ag as we,am as be,n as _e,S as xe}from"./vue-5a09445c.js";import{p as v,m as re,t as D,aB as Ce,E as Le,g as j}from"./index-797f995b.js";import{x as ye,aE as Ie,u as ue,af as Se}from"./jeecg-online-vendor-a84f26e2.js";/* empty css              */import{bm as oe,c3 as ke,cQ as Ne,cR as $e}from"./antd-vue-vendor-04f0af1d.js";T({name:"ImagePreview",components:{Image:oe,PreviewGroup:oe.PreviewGroup},props:{functional:v.bool,imageList:{type:Array}},setup(a){const{prefixCls:u}=re("image-preview"),c=x(()=>{const{imageList:l}=a;return l?l.map(n=>ye(n)?{src:n,placeholder:!1}:n):[]});return{prefixCls:u,getImageList:c}}});const Ae="/assets/resume-8f27866b.svg",Oe="/assets/p-rotate-cb8bbfc3.svg",Ue="/assets/scale-44abde22.svg",Me="/assets/unscale-c552f416.svg",Pe="/assets/unrotate-ef6a2daf.svg";var $=function(a){return a[a.LOADING=0]="LOADING",a[a.DONE=1]="DONE",a[a.FAIL=2]="FAIL",a}($||{});const Ee={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},h="img-preview",De=T({name:"ImagePreview",props:Ee,emits:["img-load","img-error"],setup(a,{expose:u,emit:c}){const l=new Map,n=me({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:$.LOADING,currentIndex:0,moveX:0,moveY:0,show:a.show}),I=E(null),b=E(null);function S(){i();const{index:e,imageList:s}=a;if(!s||!s.length)throw new Error("imageList is undefined");n.currentIndex=e,L(s[e])}function C(){n.imgScale=1,n.imgRotate=0,n.imgTop=0,n.imgLeft=0}function i(){const e=d(I);e&&(e.onmousewheel=m,document.body.addEventListener("DOMMouseScroll",m),document.ondragstart=function(){return!1})}const f=x(()=>{var s;const e=(s=a==null?void 0:a.scaleStep)!=null?s:0;return(e!=null?e:0>0)?e/100:n.imgScale/10});function m(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&w(f.value),e.delta<0&&w(-f.value)}function w(e){n.imgScale<=.2&&e<0||(n.imgScale+=e)}function g(e){n.imgRotate+=e}function k(){const e=d(b);e&&(e.onmousemove=null)}function L(e){n.status=$.LOADING;const s=new Image;s.src=e,s.onload=o=>{if(n.currentUrl!==e){const p=o.composedPath();if(a.rememberState){l.set(n.currentUrl,{scale:n.imgScale,top:n.imgTop,left:n.imgLeft,rotate:n.imgRotate});const _=l.get(e);_?(n.imgScale=_.scale,n.imgTop=_.top,n.imgRotate=_.rotate,n.imgLeft=_.left):(C(),a.defaultWidth&&(n.imgScale=a.defaultWidth/p[0].naturalWidth))}else a.defaultWidth&&(n.imgScale=a.defaultWidth/p[0].naturalWidth);p&&c("img-load",{index:n.currentIndex,dom:p[0],url:e})}n.currentUrl=e,n.status=$.DONE},s.onerror=o=>{const p=o.composedPath();p&&c("img-error",{index:n.currentIndex,dom:p[0],url:e}),n.status=$.FAIL}}function A(e){e&&e.stopPropagation(),O()}function O(){n.show=!1,document.body.removeEventListener("DOMMouseScroll",m),document.ondragstart=null}function U(){C()}u({resume:U,close:O,prev:N.bind(null,"left"),next:N.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(n.imgScale=e)},setRotate:e=>{n.imgRotate=e}});function N(e){const{currentIndex:s}=n,{imageList:o}=a;e==="left"&&(n.currentIndex--,s<=0&&(n.currentIndex=o.length-1)),e==="right"&&(n.currentIndex++,s>=o.length-1&&(n.currentIndex=0)),L(o[n.currentIndex])}function V(e){e=e||window.event,n.moveX=e.clientX,n.moveY=e.clientY;const s=d(b);s&&(s.onmousemove=W)}function W(e){e=e||window.event,e.preventDefault();const s=e.clientX-n.moveX,o=e.clientY-n.moveY;n.imgLeft+=s,n.imgTop+=o,n.moveX=e.clientX,n.moveY=e.clientY}const G=x(()=>{const{imgScale:e,imgRotate:s,imgTop:o,imgLeft:p}=n;return{transform:`scale(${e}) rotate(${s}deg)`,marginTop:`${o}px`,marginLeft:`${p}px`,maxWidth:a.defaultWidth?"unset":"100%"}}),F=x(()=>{const{imageList:e}=a;return e.length>1});ge(()=>{a.show&&S(),a.imageList&&C()});const X=e=>{a.maskClosable&&e.target&&e.target.classList.contains(`${h}-content`)&&A(e)},M=()=>r("div",{class:`${h}__close`,onClick:A},[r(ke,{class:`${h}__close-icon`},null)]),B=()=>{if(!d(F))return null;const{currentIndex:e}=n,{imageList:s}=a;return r("div",{class:`${h}__index`},[e+1,pe(" / "),s.length])},Y=()=>r("div",{class:`${h}__controller`},[r("div",{class:`${h}__controller-item`,onClick:()=>w(-f.value)},[r("img",{src:Me},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>w(f.value)},[r("img",{src:Ue},null)]),r("div",{class:`${h}__controller-item`,onClick:U},[r("img",{src:Ae},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>g(-90)},[r("img",{src:Pe},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>g(90)},[r("img",{src:Oe},null)])]),t=e=>d(F)?r("div",{class:[`${h}__arrow`,e],onClick:()=>N(e)},[e==="left"?r(Ne,null,null):r($e,null,null)]):null;return()=>n.show&&r("div",{class:h,ref:I,onMouseup:k,onClick:X},[r("div",{class:`${h}-content`},[r("img",{style:d(G),class:[`${h}-image`,n.status===$.DONE?"":"hidden"],ref:b,src:n.currentUrl,onMousedown:V},null),M(),B(),Y(),t("left"),t("right")])])}});let z=null;function Fe(a){var l;if(!Ie)return;const u={},c=document.createElement("div");return Object.assign(u,{show:!0,index:0,scaleStep:100},a),z=r(De,u),ve(z,c),document.body.appendChild(c),(l=z.component)==null?void 0:l.exposed}var q=(a=>(a.all="all",a.image="image",a.file="file",a))(q||{});const Be={class:"upload-download-handler"},Re={class:"upload-mover-handler"},Te=T({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(a){const u=a,{createMessage:c}=ue(),l=x(()=>d(u.fileList));function n(){let i=S();if(i===-1){c.warn("移动失败："+i);return}if(i===0){b(i,d(l).length-1);return}b(i,i-1)}function I(){let i=S();if(i===-1){c.warn("移动失败："+i);return}if(i==d(l).length-1){b(i,0);return}b(i,i+1)}function b(i,f){if(i!==f){let m=[...d(l)],w=m[i];m[i]=m[f],m[f]=w,u.emitValue(m.map(g=>g.url).join(","))}}function S(){var f,m;const i=(m=(f=u.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:m.src;if(i){const w=d(l);for(let g=0;g<w.length;g++){let k=w[g].url;const L=i.replace(window.location.origin,"");if(k===L||encodeURI(k)===L)return g}}return-1}function C(){var f,m;const i=(m=(f=u.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:m.src;window.open(i)}return(i,f)=>(P(),R(ie,null,[K(y("div",Be,[y("a",{class:"download",title:"下载",onClick:C},[r(d(D),{icon:"ant-design:download"})])],512),[[Z,a.download]]),K(y("div",Re,[y("a",{title:"向前移动",onClick:n},[r(d(D),{icon:"ant-design:arrow-left"})]),y("a",{title:"向后移动",onClick:I},[r(d(D),{icon:"ant-design:arrow-right"})])],512),[[Z,a.mover&&l.value.length>1]])],64))}}),Ve={key:0},We={class:"ant-upload-text"},le="ant-upload-list-item",Je=T({__name:"JUpload",props:{value:v.oneOfType([v.string,v.array]),text:v.string.def("上传"),fileType:v.string.def(q.all),bizPath:v.string.def("temp"),returnUrl:v.bool.def(!0),maxCount:v.number.def(0),buttonVisible:v.bool.def(!0),multiple:v.bool.def(!0),mover:v.bool.def(!0),download:v.bool.def(!0),removeConfirm:v.bool.def(!1),beforeUpload:v.func,disabled:v.bool.def(!1),replaceLastOne:v.bool.def(!1)},emits:["change","update:value"],setup(a,{expose:u,emit:c}){const l=a,{createMessage:n,createConfirm:I}=ue(),{prefixCls:b}=re("j-upload"),S=Se(),C=Ce(),i=E([]),f=E(!0),m=E(),w=x(()=>l.maxCount>0&&i.value.length>=l.maxCount),g=x(()=>l.fileType===q.image),k=x(()=>l.disabled===!0?!0:w.value===!0?l.replaceLastOne!==!0:!1),L=x(()=>{const t=Object.assign({},l,d(S));return t.name="file",t.listType=g.value?"picture-card":"text",t.class=[t.class,{"upload-disabled":l.disabled}],t.data=Q({biz:l.bizPath},t.data),t.beforeUpload||(t.beforeUpload=V),g.value&&!t.accept&&(t.accept="image/*"),t});ee(()=>l.value,t=>{Array.isArray(t)?l.returnUrl?U(t.join(",")):N(t):l.returnUrl?U(t):t&&N(JSON.parse(t))},{immediate:!0}),ee(i,()=>_e(()=>A()),{immediate:!0});function A(){if(!g.value)return;const t=m.value?m.value.getElementsByClassName(le):null;if(!(!t||t.length===0))for(const e of t)e.getAttribute("data-has-actions")==="true"||e.addEventListener("mouseover",O)}function O(t){const s=(()=>{for(const _ of t.path){if(_.classList.contains(le))return _;if(_.classList.contains(`${b}-container`))return null}return null})();if(!s)return;const o=s.getElementsByClassName("ant-upload-list-item-actions");if(!o||o.length===0)return;const p=document.createElement("div");p.className="upload-actions-container",xe(Te,{element:s,fileList:i,mover:l.mover,download:l.download,emitValue:M}).mount(p),o[0].appendChild(p),s.setAttribute("data-has-actions","true"),s.removeEventListener("mouseover",O)}function U(t){if(!t||t.length==0){i.value=[];return}let e=[];for(const s of t.split(",")){let o=j(s);e.push({uid:B(),name:Y(s),status:"done",url:o,response:{status:"history",message:s}})}i.value=e}function N(t){if(!t||t.length==0){i.value=[];return}let e=[];for(const s of t){let o=j(s.filePath);e.push({uid:B(),name:s.fileName,url:o,status:"done",response:{status:"history",message:s.filePath}})}i.value=e}function V(t){return f.value=!0,g.value&&t.type.indexOf("image")<0?(n.warning("请上传图片"),f.value=!1,!1):typeof l.beforeUpload=="function"?l.beforeUpload(t):!0}function W(){return l.removeConfirm?new Promise(t=>{I({title:"删除",content:`确定要删除这${g.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>t(!0),onCancel:()=>t(!1)})}):!0}function G(t){!t.file.status&&f.value===!1&&t.fileList.pop();let e=t.fileList;if(l.maxCount>0&&e.length>=l.maxCount)if(l.maxCount-e.length>=0)e=e.slice(-l.maxCount);else return;if(t.file.status==="done"){let s=[];t.file.response.success?s=e.map(o=>{if(o.response){let p=o.response.message;o.url=j(p)}return o}):(s=e.filter(o=>o.uid!=t.file.uid),n.error(`${t.file.name} 上传失败.`)),e=s}else t.file.status==="error"&&n.error(`${t.file.name} 上传失败.`);if(i.value=e,t.file.status==="done"||t.file.status==="removed")if(l.returnUrl)F();else{let s=[];for(const o of e)if(o.status==="done"){let p={fileName:o.name,filePath:o.response.message,fileSize:o.size};s.push(p)}else return;M(JSON.stringify(s))}}function F(){let t=i.value,e="";(!t||t.length==0)&&(e="");let s=[];for(const o of t)if(o.status==="done")s.push(o.response.message);else return;s.length>0&&(e=s.join(",")),M(e)}function X(t){g.value?Fe({imageList:[t.url],maskClosable:!0}):window.open(t.url)}function M(t){c("change",t),c("update:value",t)}function B(){return"-"+parseInt(Math.random()*1e4+1,10)}function Y(t){if(t.lastIndexOf("\\")>=0){let e=new RegExp("\\\\","g");t=t.replace(e,"/")}return t.substring(t.lastIndexOf("/")+1)}return u({addActionsListener:A}),(t,e)=>{const s=te("a-button"),o=te("a-upload");return P(),R("div",{ref_key:"containerRef",ref:m,class:be(`${d(b)}-container`)},[r(o,we({headers:d(C),multiple:a.multiple,action:d(Le),fileList:i.value,disabled:a.disabled},L.value,{onRemove:W,onChange:G,onPreview:X}),{default:ne(()=>[g.value?(P(),R(ie,{key:0},[w.value?se("",!0):(P(),R("div",Ve,[r(d(D),{icon:"ant-design:plus-outlined"}),y("div",We,ae(a.text),1)]))],64)):a.buttonVisible?(P(),he(s,{key:1,disabled:k.value},{default:ne(()=>[r(d(D),{icon:"ant-design:upload-outlined"}),y("span",null,ae(a.text),1)]),_:1},8,["disabled"])):se("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{q as U,Je as _,Fe as c};
