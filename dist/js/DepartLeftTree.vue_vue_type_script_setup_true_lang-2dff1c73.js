var f=(l,_,c)=>new Promise((r,t)=>{var s=n=>{try{o(c.next(n))}catch(d){t(d)}},u=n=>{try{o(c.throw(n))}catch(d){t(d)}},o=n=>n.done?r(n.value):Promise.resolve(n.value).then(s,u);o((c=c.apply(l,_)).next())});import{b as k}from"./jeecg-online-vendor-7e3ae2e6.js";import{s as F}from"./depart.user.api-bdf56c8f.js";import{d as V,c as N,k as i,U as p,a5 as m,a9 as x,a7 as K,f as T,a6 as P,F as U,V as j,q as C}from"./vue-249e5fad.js";const L=l=>k.get({url:"/sys/sysDepart/queryDepartTreeSync",params:l}),z=l=>k.get({url:"/sys/user/queryByOrgCodeForAddressList",params:l}),G=l=>k.get({url:"/sys/position/list",params:l}),J=V({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(l,{expose:_,emit:c}){N("prefixCls");const r=i(!1),t=i([]),s=i([]),u=i([]),o=i(!1),n=i(null),d=i("");function h(){return f(this,null,function*(){try{r.value=!0,t.value=[];const e=yield L();Array.isArray(e)&&(t.value=e),s.value.length===0&&w()}finally{r.value=!1}})}h();function R(e){return f(this,null,function*(){try{const a=yield L({pid:e.dataRef.id});if(a.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=a,s.value.length>0){let y=[];for(let v of s.value)a.findIndex(g=>g.id===v)!==-1&&y.push(v);y.length>0&&(s.value=[...s.value])}t.value=[...t.value]}catch(a){}return Promise.resolve()})}function w(){let e=t.value[0];e&&(e.isLeaf||(s.value=[e.key]),A())}function A(){return f(this,null,function*(){yield C(),o.value=!0,yield C(),o.value=!1})}function D(e,a){u.value=[e],a&&(n.value=a,c("select",a))}function B(e){return f(this,null,function*(){if(e)try{r.value=!0,t.value=[];let a=yield F({keyWord:e});Array.isArray(a)&&(t.value=a),w()}finally{r.value=!1}else h();d.value=e})}function S(e,a){e.length>0&&u.value[0]!==e[0]?D(e[0],a.selectedNodes[0]):D(u.value[0])}return _({loadRootTreeData:h}),(e,a)=>{const y=p("a-input-search"),v=p("a-tree"),g=p("a-empty"),b=p("a-spin"),q=p("a-card");return m(),x(q,{bordered:!1,style:{height:"100%"}},{default:K(()=>[T(b,{spinning:r.value},{default:K(()=>[T(y,{placeholder:"按部门名称搜索…",style:{"margin-bottom":"10px"},onSearch:B,allowClear:""}),t.value.length>0?(m(),P(U,{key:0},[o.value?j("",!0):(m(),x(v,{key:0,showLine:"",clickRowToExpand:!1,treeData:t.value,selectedKeys:u.value,"load-data":R,expandedKeys:s.value,"onUpdate:expandedKeys":a[0]||(a[0]=E=>s.value=E),onSelect:S},null,8,["treeData","selectedKeys","expandedKeys"]))],64)):(m(),x(g,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"])]),_:1})}}});export{J as _,z as l,G as p};
