var y=(c,o,r)=>new Promise((g,f)=>{var b=n=>{try{i(r.next(n))}catch(p){f(p)}},l=n=>{try{i(r.throw(n))}catch(p){f(p)}},i=n=>n.done?g(n.value):Promise.resolve(n.value).then(b,l);i((r=r.apply(c,o)).next())});import{g as w,h as M,b as S,u as F}from"./jeecg-online-vendor-231813f7.js";import{a4 as I,a3 as P,k as T,r as A}from"./vue-5a09445c.js";import{F as C}from"./index-ebe32d90.js";const H=c=>{const o="/sys/annountCement/vue3List";return S.get({url:o,params:c})};function q(){const{createMessage:c}=F();w("rangeDate");const o=T([]),r=T(1);let g=10;const f=A({fromUser:"",rangeDateKey:"",rangeDate:[],starFlag:""});function b(){let{fromUser:e,rangeDateKey:t,rangeDate:a,starFlag:d}=f,s={fromUser:e,starFlag:d,rangeDateKey:t,beginDate:"",endDate:"",pageNo:r.value,pageSize:g};return t=="zdy"&&(s.beginDate=a[0]+" 00:00:00",s.endDate=a[1]+" 23:59:59"),s}const l=T(!1);function i(){return y(this,null,function*(){if(l.value===!0)return;let e=b();const t=yield H(e);if(!t||t.length<=0){l.value=!0;return}t.length<g&&(l.value=!0),r.value=r.value+1;let a=o.value;a.push(...t),o.value=a})}function n(){o.value=[],r.value=1,l.value=!1}function p(e){return y(this,null,function*(){const t="/sys/sysAnnouncementSend/edit";let a="1";e.starFlag==a&&(a="0");const d={starFlag:a,id:e.sendId},s=yield S.put({url:t,params:d},{isTransformResponse:!1});s.success===!0||c.warning(s.message)})}const v=T(!1);function u(){return y(this,null,function*(){v.value=!0,yield i(),v.value=!1})}function m(e){return e.readFlag!=="1"}function D(e){return e.busType=="email"?"邮件提醒:":e.busType=="bpm"?"流程催办:":e.busType=="bpm_cc"?"流程抄送:":e.busType=="bpm_task"?"流程任务:":e.msgCategory=="2"?"系统消息:":e.msgCategory=="1"?"通知公告:":""}return{messageList:o,reset:n,loadData:i,loadEndStatus:l,searchParams:f,updateStarMessage:p,onLoadMore:u,noRead:m,getMsgCategory:D}}function x(c,o){const r=w("messageHref"),g=I(),f=M(),b=P(),{close:l,closeSameRoute:i}=C();function n(u,m){return y(this,null,function*(){!u.busType||u.busType=="msg_node"?m?m():yield v(u):yield p(u)})}function p(u){return y(this,null,function*(){const{busType:m,busId:D,msgAbstract:e}=u;let t=r.filter(s=>s.value===m);if(!t||t.length==0)return;let a=t[0].text;a=a.replace("{DETAIL_ID}",D);let d={detailId:D};if(e)try{let s=JSON.parse(e);Object.keys(s).map(h=>{d[h]=s[h]})}catch(s){}f.setMessageHrefParams(d),b.path.indexOf(a)>=0?(yield l(),yield g.replace({path:a,query:{time:new Date().getTime()}})):(i(a),yield g.push({path:a}))})}function v(u){return y(this,null,function*(){c("detail",u)})}return{goPage:n}}export{x as a,q as u};
