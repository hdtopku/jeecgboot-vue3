import{U as O,ai as P,b as j}from"./jeecg-online-vendor-88d7be55.js";import{B as q}from"./index-378f1f74.js";import{B as z}from"./index-b6e19f4a.js";import"./componentMap-ac4d3a60.js";import"./BasicForm.vue_vue_type_style_index_0_lang-ad90633d.js";import{aa as H}from"./antd-vue-vendor-cce59da1.js";import{Q as Y}from"./JAddInput-079a6c33.js";import"./JSelectUser-b7290477.js";import"./JSelectDept-52bb52e5.js";import"./JPopup-4aed0a12.js";import{d as Q,k as g,r as I,U as p,a5 as M,a9 as T,a7 as f,f as v,E as D,aa as K,an as Z,V as $}from"./vue-705b7309.js";import"./tinymce-vendor-6e169cb2.js";import"./lodash-es-vendor-5fc8fca4.js";import"./BasicModal-93f24ffc.js";import"./useWindowSizeFn-b9945b41.js";import"./codemirror-vendor-3f45d0f3.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-60c6a8c7.js";import"./useFormItem-faf326fe.js";import"./JUpload.vue_vue_type_style_index_0_lang-72743f30.js";import"./download-827e9970.js";import"./base64Conver-fa2fe1af.js";import"./index-99de6536.js";import"./index-a24a9872.js";import"./useCountdown-5da1361d.js";import"./index-4802827d.js";import"./areaDataUtil-6588b720.js";import"./props-4069293e.js";import"./JSelectBiz-53a9985e.js";import"./index-2ccd691b.js";import"./index-4eb07c8e.js";import"./bem-eb26b268.js";import"./props-dec3c169.js";import"./useContextMenu-430f82bc.js";import"./depart.api-880d8784.js";var E=(a,m,s)=>new Promise((C,h)=>{var w=i=>{try{d(s.next(i))}catch(l){h(l)}},x=i=>{try{d(s.throw(i))}catch(l){h(l)}},d=i=>i.done?C(i.value):Promise.resolve(i.value).then(w,x);d((s=s.apply(a,m)).next())});const X=Q({name:"CodeFileViewModal",components:{BasicModal:q,InfoCircleTwoTone:P,JCodeEditor:Y},emits:["download","register","close"],setup(a,{emit:m}){const s=g([]),C=g(""),h=g([]),w=g(!1),x=window.innerHeight-160,d=g("java"),i=g("");let l=I({});const[_,{closeModal:V}]=z(e=>E(this,null,function*(){l=I({}),i.value="",s.value=e.codeList,C.value=e.pathKey,y(),w.value=!0}));function y(){let e=U(),n=e[0];k(n,e);let o=[];const t=function(c){if(c.children){let r=c.children;r.length==1?t(r[0]):r.length>1&&o.push(c)}};t(n),h.value=o,setTimeout(()=>{L(n)},300)}function L(e){return E(this,null,function*(){const n=function(t){if(t.isLeaf===!0)return t;if(t.children)return n(t.children[0])};let o=n(e);if(o&&o.isLeaf===!0){let t=o.path;l[t]||(yield S(t)),d.value=F(t),i.value=l[t]}})}function k(e,n){for(let o of n)e.key==o.pid&&(e.children||(e.children=[]),e.children.push(o),k(o,n))}function N(e,n){let o=0,t="";for(;o<=n;)t+=e[o],o++;return t}function U(){let e=[],n=[],o=s.value;for(let t of o){let c=t.replace(new RegExp("\\\\","g"),"/").replace("生成成功：","").trim();if(c){let r=c.split("/");for(let u=0;u<r.length;u++){let R=r[u],b=N(r,u);if(R){let B={title:R,key:b};if(R!=0){let G=N(r,u-1);G&&(B.pid=G)}u==r.length-1&&(B.isLeaf=!0,B.path=c),(n.indexOf(b)<0||u==r.length-1)&&(e.push(B),n.push(b))}}}}return e}function W(){V(),m("close")}function A(){m("download")}function F(e){return e.endsWith("xml")?"application/xml":e.endsWith("sql")?"text/x-sql":e.endsWith("vue")?"text/x-vue":e.endsWith("ts")?"text/typescript":"text/x-java"}function J(e,n){return E(this,null,function*(){let o=n.node.dataRef;if(o.isLeaf){let t=o.path;l[t]||(yield S(t)),d.value=F(t),i.value=l[t]}})}function S(e){return new Promise(n=>{let o={path:encodeURI(e),pathKey:C.value};j.get({url:"/online/cgform/api/codeView",params:o},{isTransformResponse:!1}).then(t=>{if(!t||t.size===0){H.warning("文件下载失败");return}let c=new Blob([t]),r=new FileReader;r.readAsText(c,"utf8"),r.onload=function(){let u=this.result;l[e]=u,n(1)}})})}return{registerModal:_,codeList:s,onDownloadGenerateCode:A,handleClose:W,treeData:h,showCodeContent:J,activeCodeContent:i,expandStatus:w,height:x,language:d}}});function ee(a,m,s,C,h,w){const x=p("info-circle-two-tone"),d=p("a-directory-tree"),i=p("a-col"),l=p("JCodeEditor"),_=p("a-empty"),V=p("a-row"),y=p("a-button"),L=p("BasicModal");return M(),T(L,{onRegister:a.registerModal,okText:"",cancelText:"关闭",width:1200,defaultFullscreen:!0,canFullscreen:!1,onOk:a.onDownloadGenerateCode},{title:f(()=>[v(x),D(" 代码在线预览 ")]),footer:f(()=>[v(y,{onClick:a.handleClose},{default:f(()=>[D("关闭")]),_:1},8,["onClick"]),v(y,{type:"primary",onClick:a.onDownloadGenerateCode},{default:f(()=>[D("下载到本地")]),_:1},8,["onClick"])]),default:f(()=>[K("div",null,[v(V,null,{default:f(()=>[v(i,{span:6,gutter:3,style:{"border-right":"1px solid #eee"}},{default:f(()=>[K("div",{style:Z({height:a.height+"px",overflowY:"auto"})},[a.treeData.length?(M(),T(d,{key:0,defaultExpandAll:!0,"tree-data":a.treeData,onSelect:a.showCodeContent},null,8,["tree-data","onSelect"])):$("",!0)],4)]),_:1}),v(i,{span:18,gutter:3},{default:f(()=>[a.activeCodeContent?(M(),T(l,{key:0,value:a.activeCodeContent,"onUpdate:value":m[0]||(m[0]=k=>a.activeCodeContent=k),theme:"idea",language:a.language,fullScreen:!1,lineNumbers:!0,height:a.height+"px","language-change":!0},null,8,["value","language","height"])):(M(),T(_,{key:1,style:{"margin-top":"50px"},description:"请选择左侧文件，显示详细代码"}))]),_:1})]),_:1})])]),_:1},8,["onRegister","onOk"])}const Ge=O(X,[["render",ee]]);export{Ge as default};
