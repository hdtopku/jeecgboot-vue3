import{V as ee,b as R}from"./jeecg-online-vendor-f8ebd627.js";import{B as te}from"./BasicForm-ac34d48e.js";import"./componentMap-ba94d61e.js";import{u as oe}from"./useForm-a39fb19e.js";import"./JAddInput-ff8a2196.js";import"./JSelectUser-d28baf37.js";import"./JSelectDept-6a5d3f49.js";import"./JPopup-03bf28d5.js";import{J as N,B as ae,z as k,V as x}from"./index-23d562e3.js";import"./cron-parser-vendor-c9873295.js";import{B as ie}from"./index-0d8c6dee.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-eaa23dad.js";import{T as re}from"./useSchemas-fc8d97ce-6ceacf91.js";import le from"./CodeFileListModal-4831ce3d-a6f36e5c.js";import se from"./FileSelectModal-64aaf623-21580c74.js";import"./antd-vue-vendor-04f0af1d.js";import{d as ne,k as g,e as B,r as C,V as p,a5 as _,a6 as me,f,a7 as w,a9 as pe,ag as ce,W as ue,F as de,n as ge}from"./vue-5a09445c.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./BasicForm.vue_vue_type_style_index_0_lang-492c189b.js";import"./BasicModal-984237cb.js";import"./useWindowSizeFn-123149fd.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./useFormItem-3b7d78e2.js";/* empty css              */import"./download-a7e2eae4.js";import"./base64Conver-fa2fe1af.js";import"./index-c70b6345.js";import"./index-94b582d6.js";import"./useCountdown-577483f4.js";import"./useFormItemSingle-55ffe2e1.js";import"./JUpload.vue_vue_type_style_index_0_lang-53f5b66c.js";import"./index-7c5ea69b.js";import"./index-d11886bb.js";import"./areaDataUtil-1a45154e.js";import"./props-57077bfd.js";import"./JSelectBiz-eead536a.js";import"./index-56ed0801.js";import"./index-5ea00b35.js";import"./bem-5ff749b6.js";import"./props-17f0c5eb.js";import"./useContextMenu-d4796678.js";import"./depart.api-ee845ad8.js";import"./validator-3e3aef60.js";import"./user.api-2e564f12.js";import"./CodeFileViewModal-5990dac4-69de06f6.js";var F=(t,m,r)=>new Promise((c,b)=>{var h=a=>{try{l(r.next(a))}catch(o){b(o)}},s=a=>{try{l(r.throw(a))}catch(o){b(o)}},l=a=>a.done?c(a.value):Promise.resolve(a.value).then(h,s);l((r=r.apply(t,m)).next())});const fe=ne({name:"CodeGenerator",components:{BasicForm:te,BasicModal:ie,FileSelectModal:se,CodeFileListModal:le},emits:["register"],setup(t){const m="JEECG_ONL_PROJECT_PATH",r=g(!0),c=g(),b=B(()=>r.value?800:1200),h=g("代码生成"),s=g(!1),l=g(""),a=C({projectPath:"",packageStyle:"service",jspMode:"",jformType:"1",tableName_tmp:"",ftlDescription:"",entityName:"",codeTypes:"controller,service,dao,mapper,entity,vue"}),o=C({}),v=g([]),u=C({dataSource:[],columns:[{title:"子表名",key:"tableName",type:N.input,disabled:!0,validateRules:[{required:!0,message:"请输入${title}"}]},{title:"子表实体",key:"entityName",type:N.input,validateRules:[{required:!0,message:"请输入${title}"}]},{title:"功能说明",key:"ftlDescription",type:N.input,validateRules:[{required:!0,message:"请输入${title}"}]}]}),M=B(()=>u.dataSource.length>0),{formSchemas:V}=re(t,{onProjectPathChange:X,onProjectPathSearch:z,jspModeOptions:v},r),[I,{resetFields:O,setFieldsValue:j,validate:D}]=oe({schemas:V,showActionButtonGroup:!1,labelAlign:"right"}),[G,{closeModal:L}]=ae(e=>F(this,null,function*(){yield O(),l.value=e.code,s.value=!1,u.dataSource=[],v.value=[],Q(),Object.assign(o,a),J()}));function J(){return F(this,null,function*(){let{main:e,sub:i,jspModeList:d,projectPath:n}=yield R.get({url:"/online/cgform/head/tableInfo",params:{code:l.value}}),y=[];for(let T of d){const{code:P,note:Z}=T;P=="many"||y.push({label:Z,value:P})}v.value=y,e.isTree=="Y"?o.jspMode="tree":o.jspMode=y[0].value,r.value=e.tableType==1,h.value="代码生成【"+e.tableName+"】",o.projectPath||(o.projectPath=n,window.localStorage.setItem(m,n)),o.jformType=e.tableType+"",o.tableName_tmp=e.tableName,o.ftlDescription=e.tableTxt;let S=x(e.tableName);o.entityName=S.substring(0,1).toUpperCase()+S.substring(1),yield ge(),j(o),i&&i.length>0&&(u.dataSource=i.map(T=>({tableName:T.tableName,entityName:Y(T.tableName),ftlDescription:T.tableTxt})))})}const[$,{openModal:E}]=k();function K(){return F(this,null,function*(){try{const e=yield D();let i=Object.assign({},e,{code:l.value,tableName:e.tableName_tmp});if(M.value){if(yield c.value.validateTable())return;i.subList=c.value.getTableData()}s.value=!0;let d=yield q(i);E(!0,{codeList:d.codeList,pathKey:d.pathKey,tableName:e.tableName_tmp}),L()}catch(e){}finally{s.value=!1}})}function q(e){return new Promise((i,d)=>{R.post({url:"/online/cgform/api/codeGenerate",params:e},{isTransformResponse:!1}).then(n=>{if(n.success){let y=n.result,S=n.message;i({codeList:y,pathKey:S})}else this.$message.error(n.message),d(n.message)})})}function A(){L()}const[H,W]=k();function z(){W.openModal(!0,{})}function U(e){window.localStorage.setItem(m,e),j({projectPath:e})}function Y(e){let i=x(e);return i.substring(0,1).toUpperCase()+i.substring(1)}function Q(){let e=window.localStorage.getItem(m);e&&(a.projectPath=e)}function X(e){e.target.value&&window.localStorage.setItem(m,e.target.value)}return{title:h,modalWidth:b,confirmLoading:s,subTable:u,showSubTable:M,onSubmit:K,onCancel:A,onFileSelect:U,registerFileSelectModal:H,subTableRef:c,registerForm:I,registerModal:G,registerCodeFileListModal:$}}});function be(t,m,r,c,b,h){const s=p("BasicForm"),l=p("JVxeTable"),a=p("a-card"),o=p("a-spin"),v=p("BasicModal"),u=p("FileSelectModal"),M=p("code-file-list-modal");return _(),me(de,null,[f(v,{onRegister:t.registerModal,title:t.title,width:t.modalWidth,confirmLoading:t.confirmLoading,okText:"开始生成",cancelText:"取消",onOk:t.onSubmit,onCancel:t.onCancel},{default:w(()=>[f(o,{spinning:t.confirmLoading},{default:w(()=>[f(s,{onRegister:t.registerForm},null,8,["onRegister"]),t.showSubTable?(_(),pe(a,{key:0,title:"子表信息",size:"small"},{default:w(()=>[f(l,ce({ref:"subTableRef",rowNumber:"",maxHeight:580},t.subTable),null,16)]),_:1})):ue("",!0)]),_:1},8,["spinning"])]),_:1},8,["onRegister","title","width","confirmLoading","onOk","onCancel"]),f(u,{onRegister:t.registerFileSelectModal,onSelect:t.onFileSelect},null,8,["onRegister","onSelect"]),f(M,{onRegister:t.registerCodeFileListModal},null,8,["onRegister"])],64)}const ct=ee(fe,[["render",be]]);export{ct as default};
