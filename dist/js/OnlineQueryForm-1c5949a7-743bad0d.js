import"./index-2b71c6a1.js";import{l as O,r as se,w as M,J as R,a5 as ne,a6 as ue,ad as I,V as k,a7 as q,a8 as L,f as c,aa as b,E,ae as pe,W}from"./vue-86253b15.js";import{q as me,ap as ce,bB as de}from"./jeecg-online-vendor-bc5d810e.js";import{u as fe,j as A,k as he,F as N,m as ge,n as ye,o as J,g as ve}from"./useExtendComponent-48d37d9b-6b127188.js";import"./componentMap-804f169d.js";import"./index-4de4eaa0.js";import"./antd-vue-vendor-371529c2.js";import"./index-5f3b36bb.js";import"./lodash-es-vendor-04a44d0a.js";import"./index-074f8af6.js";import"./user.api-26c541a7.js";import"./customExpression-62f5afd1.js";import"./index-4e790dc8.js";import"./useListPage-6cefed71.js";import"./JUpload-5d01fa2e.js";import"./LinkTableListPiece-34266919-a0ea3d74.js";import"./OnlineSelectCascade-c7baf52b-df6d9a07.js";import"./JModalTip-abe1515a-86febb51.js";import{B as be,u as we}from"./useForm-61401b42.js";import"./JAddInput-eb55e093.js";import"./areaDataUtil-c66543dc.js";import"./tinymce-vendor-7c917b36.js";import"./useFormItem-48d9339b.js";import"./vxe-table-vendor-6a8d95c4.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./JSelectUser-43c751df.js";import"./props-edbd03b5.js";import"./JSelectBiz-4759b897.js";import"./index-6c9d1f87.js";import"./BasicModal-8033a6fa.js";import"./useWindowSizeFn-0b39b13a.js";import"./index-6021b022.js";import"./bem-6904c165.js";import"./props-3eac2fce.js";import"./useContextMenu-368c1b38.js";import"./depart.api-b7cb4c93.js";import"./JSelectDept-1fac1b66.js";import"./JPopup-1441d476.js";import"./JEllipsis-08edf142.js";import"./BasicTable-c5288ffa.js";import"./injectionKey-69710956.js";import"./index-7eb57de2.js";import"./download-dda5b956.js";import"./base64Conver-fa2fe1af.js";import"./index-c842bec9.js";import"./index-f5da07b2.js";import"./useCountdown-7a164eb2.js";import"./useFormItemSingle-1ae794f9.js";import"./cron-parser-vendor-8edbe50a.js";import"./index-8967d44c.js";import"./index-d90d28d1.js";var Fe=Object.defineProperty,$=Object.getOwnPropertySymbols,Se=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,z=(s,a,i)=>a in s?Fe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,Q=(s,a)=>{for(var i in a||(a={}))Se.call(a,i)&&z(s,i,a[i]);if($)for(var i of $(a))xe.call(a,i)&&z(s,i,a[i]);return s},Y=(s,a,i)=>new Promise((u,w)=>{var C=h=>{try{y(i.next(h))}catch(S){w(S)}},F=h=>{try{y(i.throw(h))}catch(S){w(S)}},y=h=>h.done?u(h.value):Promise.resolve(h.value).then(C,F);y((i=i.apply(s,a)).next())});const _e={name:"OnlineQueryForm",components:{BasicForm:be},props:{id:{type:String,default:""}},emits:["search","loaded"],setup(s,{emit:a}){const i="/online/cgform/api/getQueryInfoVue3/",u=O(null),w=O([]),C=O({xs:24,sm:24,md:12,lg:6,xl:6}),F=O(!1),y=O(!1),h=O({}),S=O([]),{createMessage:U}=me(),{linkTableCard2Select:B}=fe(),d=se({config:{},cache:{},param:{},status:!1});M(()=>d.status,t=>Y(this,null,function*(){const{config:e,cache:l,param:v}=R(d);let _=Object.assign({},e,l,v);yield G(_)}),{immediate:!0,deep:!0});function n(t,e){return Y(this,null,function*(){d.cache=Q({},t),d.param=Q({},e),d.status=!d.status})}M(()=>s.id,t=>{t?f():w.value=[]},{immediate:!0});function p(t){return Y(this,null,function*(){let e=[],l={},v=Object.keys(t);for(let r of v){const o=t[r];r==="sys_org_code"&&(o.fieldExtendJson||(o.fieldExtendJson='{"store":"orgCode"}'));let m=o.view;if(A[m]&&(o.view=A[m]),yield he(r,o,l),o.mode=="group"&&(m=="date"||m=="datetime"||m=="number")){let x=N.createSlotFormSchema(r,o);e.push(x)}else if(o.view===ge){let x=ye(o,r);for(let D of x){let V=N.createFormSchema(D.key,D),j=J(e,D.key);j==-1?e.push(V):e[j]=V}}else if(J(e,r)==-1){let x=N.createFormSchema(r,o);e.push(x)}}e.sort(function(r,o){return r.order-o.order});let _=[];e.length>2&&(F.value=!0);let g=[];for(let r=0;r<e.length;r++){let o=e[r];o.setFormRef(u),o.noChange(),o.asSearchForm(),r>1&&(g.push(o.field),o.isHidden());let m=o.getFormItemSchema();o.slot=="groupDatetime"&&(m.colProps={xs:24,sm:24,md:12,lg:8,xl:8}),B(m),_.push(m)}S.value=g,w.value=_,d.config=Q({},l),d.status=!d.status})}function f(){return Y(this,null,function*(){let t=yield Z(),e=X(t);a("loaded",t);let{formProperties:l,hasField:v}=K(e,t);if(v==!1){w.value=[];return}yield p(l)})}function G(t){return Y(this,null,function*(){yield ve(u),yield H(t),Object.keys(t).length>0&&P()})}function K(t,e){const{searchFieldList:l,joinQuery:v,table:_}=e;let g=!1,r={};return t&&Object.keys(t).map(o=>{l.indexOf(o)>=0&&(v==!0?o.indexOf("@")<0?(r[_+"@"+o]=t[o],g=!0):(r[o]=t[o],g=!0):o.indexOf("@")<0&&(r[o]=t[o],g=!0))}),{formProperties:r,hasField:g}}function X(t){const{properties:e,searchFieldList:l,joinQuery:v,table:_}=t;let g={},r=1;return Object.keys(e).map(o=>{let m=e[o];if(m.view=="table"){let x=m.properties,D=r*100;Object.keys(x).map(V=>{let j=x[V];j.order=D+Number(j.order);let ie=o+"@"+V;g[ie]=j}),r++}else m.order=Number(m.order),g[o]=m}),g}function Z(){let t=`${i}${s.id}`;return new Promise(e=>{ce.get({url:t},{isTransformResponse:!1}).then(l=>{l.success?e(l.result):(e(!1),U.warning(l.message))}).catch(()=>{U.warning("获取查询条件失败!"),e(!1)})})}const[ee,{resetFields:te,setFieldsValue:H,updateSchema:oe,getFieldsValue:re}]=we({schemas:w,showActionButtonGroup:!1,baseColProps:C,autoSubmitOnEnter:!0,submitFunc(){P()}});function P(){let t=re(),e=Object.assign({},R(d.param),le(t));a("search",e,!0)}function ae(){return Y(this,null,function*(){yield te();const{config:t,param:e}=R(d);let l=Object.assign({},t,e);Object.keys(l).length>0&&(yield H(l)),a("search",l,!1)})}function le(t){return Object.keys(t).map(e=>{t[e]&&t[e]instanceof Array&&(t[e]=t[e].join(","))}),t}return M(()=>y.value,t=>{let e=S.value;if(e&&e.length>0){let l=[];for(let v of e)l.push({field:v,show:t});oe(l)}},{immediate:!1}),{onlineQueryFormRef:u,registerForm:ee,initDefaultValues:n,toggleButtonShow:F,toggleSearchStatus:y,doSearch:P,resetSearch:ae,queryParams:h,formSchemas:w}}},T=s=>(ne("data-v-90f5c109"),s=s(),ue(),s),Oe={key:0,class:"jeecg-basic-table-form-container p-0"},ke=T(()=>I("span",{class:"group-query-string"},"~",-1)),je=T(()=>I("span",{class:"group-query-string"},"~",-1)),Ye=T(()=>I("span",{class:"group-query-string"},"~",-1)),De={style:{float:"left",overflow:"hidden","margin-left":"10px"},class:"table-page-search-submitButtons"};function Ve(s,a,i,u,w,C){const F=k("a-date-picker"),y=k("a-form-item-rest"),h=k("a-input-number"),S=k("a-button"),U=k("a-icon"),B=k("a-col"),d=k("BasicForm");return u.formSchemas&&u.formSchemas.length>0?(q(),L("div",Oe,[c(d,{ref:"onlineQueryFormRef",onRegister:u.registerForm},{groupDate:b(({model:n,field:p})=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"开始日期",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"]),ke,c(y,null,{default:b(()=>[c(F,{showTime:!1,valueFormat:"YYYY-MM-DD",placeholder:"结束日期",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{width:"calc(50% - 15px)","min-width":"100px"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupDatetime:b(({model:n,field:p})=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),je,c(y,null,{default:b(()=>[c(F,{showTime:!0,valueFormat:"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{"min-width":"100px",width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),groupNumber:b(({model:n,field:p})=>[c(h,{placeholder:"开始值",value:n[p+"_begin"],"onUpdate:value":f=>n[p+"_begin"]=f,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"]),Ye,c(y,null,{default:b(()=>[c(h,{placeholder:"结束值",value:n[p+"_end"],"onUpdate:value":f=>n[p+"_end"]=f,style:{width:"calc(50% - 15px)"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),formFooter:b(()=>[c(B,{md:6,sm:8},{default:b(()=>[I("span",De,[c(S,{preIcon:"ant-design:search",type:"primary",onClick:u.doSearch},{default:b(()=>[E("查询")]),_:1},8,["onClick"]),c(S,{preIcon:"ant-design:reload",type:"primary",onClick:u.resetSearch,style:{"margin-left":"8px"}},{default:b(()=>[E("重置")]),_:1},8,["onClick"]),u.toggleButtonShow?(q(),L("a",{key:0,onClick:a[0]||(a[0]=n=>u.toggleSearchStatus=!u.toggleSearchStatus),style:{"margin-left":"8px"}},[E(pe(u.toggleSearchStatus?"收起":"展开")+" ",1),c(U,{type:u.toggleSearchStatus?"up":"down"},null,8,["type"])])):W("",!0)])]),_:1})]),_:1},8,["onRegister"])])):W("",!0)}const Dt=de(_e,[["render",Ve],["__scopeId","data-v-90f5c109"]]);export{Dt as default};
