var v=(m,f,o)=>new Promise((u,d)=>{var s=t=>{try{n(o.next(t))}catch(l){d(l)}},e=t=>{try{n(o.throw(t))}catch(l){d(l)}},n=t=>t.done?u(t.value):Promise.resolve(t.value).then(s,e);n((o=o.apply(m,f)).next())});import{ad as T}from"./jeecg-online-vendor-12004772.js";import{validateFormModelAndTables as g,VALIDATE_FAILED as b}from"./vxeUtils-ea9dc7d4.js";import{k as F,u as w}from"./vue-c7e3516e.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";function k(m,f,o,u,d,s){const e=F();function n(r,a,c,h){c.loading=!0,T.get({url:r,params:a},{isTransformResponse:!1}).then(y=>{let{result:p}=y;y.success&&p&&(Array.isArray(p)?c.dataSource=p:Array.isArray(p.records)&&(c.dataSource=p.records)),typeof h=="function"&&h(y)}).finally(()=>{c.loading=!1})}function t(r){var a,c;(c=(a=o[r])==null?void 0:a.value)==null||c.resetScrollTop(0)}function l(){let r=Object.values(o);return Promise.all(r)}function A(){l().then(r=>{let a=e.value.getFieldsValue();return g(e.value.validate,a,r,e.value.getProps,!1)}).then(r=>s&&typeof s=="function"?s(r):i(r)).then(r=>{if(typeof f!="function")throw D("classifyIntoFormData");let a=f(r);return m(a)}).catch(r=>{r.error===b&&(r.paneKey?u.value=r.paneKey:u.value=r.index==null?w(u):d.value[r.index])})}function i(r){return new Promise(a=>{a(r)})}function D(r){return`${r} \u672A\u5B9A\u4E49\u6216\u4E0D\u662F\u4E00\u4E2A\u51FD\u6570`}return[t,A,n,e]}function G(m,f){function o(){return v(this,null,function*(){let e={},n=Object.keys(f),t="";for(let l=0;l<n.length;l++){t=n[l];let A=f[t].value;if(A.isForm){let i=yield s(A,t);i&&(e[t+"List"]=[i])}else{let i=yield d(A,t);i&&i.length>0&&(e[t+"List"]=i)}}return e})}function u(e){return e&&Object.keys(e).map(n=>{e[n]instanceof Array&&(e[n]=e[n].join(","))}),e}function d(e,n){return v(this,null,function*(){return(yield e.validateTable())?(m.value=n,e.resetScrollTop(0),Promise.reject(1)):e.getTableData()})}function s(e,n){return v(this,null,function*(){try{let t=yield e.getFormData();return u(t),t}catch(t){return m.value=n,Promise.reject(t)}})}return{getSubFormAndTableData:o,transformData:u}}export{k as useJvxeMethod,G as useValidateAntFormAndTable};
