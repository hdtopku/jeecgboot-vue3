import{aj as E}from"./index-fde9c72f.js";import{u as Y}from"./useTableSync-9b111e9e.js";import{bW as $}from"./jeecg-online-vendor-bf2efbcb.js";import"./pick-51214243.js";import"./_flatRest-34ab130c.js";import"./isArray-b183d537.js";import"./toString-8deea73b.js";import"./_arrayPush-ae8b790e.js";import{d as x,k as B,U as k,aV as K,ar as W,aQ as X,g as Q}from"./vue-c7e3516e.js";import"./lodash-es-vendor-42c8d3d4.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./cgform.data-e49498ca.js";var q=Object.defineProperty,j=Object.defineProperties,J=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,L=(e,t,a)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,S=(e,t)=>{for(var a in t||(t={}))Z.call(t,a)&&L(e,a,t[a]);if(C)for(var a of C(t))z.call(t,a)&&L(e,a,t[a]);return e},F=(e,t)=>j(e,J(t));const ee=["ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONNECTION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","ENCLOSED","ESCAPED","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","GOTO","GRANT","GROUP","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERVAL","INTO","IS","ITERATE","JOIN","KEY","KEYS","KILL","LABEL","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MATCH","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NULL","NUMERIC","ON","OPTIMIZE","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","PRECISION","PRIMARY","PROCEDURE","PURGE","RAID0","RANGE","READ","READS","REAL","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STRAIGHT_JOIN","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","WHEN","WHERE","WHILE","WITH","WRITE","X509","XOR","YEAR_MONTH","ZEROFILL"],te=x({name:"DBAttributeTable",props:{actionButton:{type:Boolean,default:!0}},emits:["added","removed","inserted","dragged","syncDbType"],setup(e,{emit:t}){const a=Q(),I=B(!1),s=B([{title:"\u5B57\u6BB5\u540D\u79F0",key:"dbFieldName",width:140,type:E.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[a-zA-Z]{1}(?!_)[a-zA-Z0-9_\\$]+$/,message:"\u547D\u540D\u89C4\u5219\uFF1A\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001$\u7B26\u53F7\u7EC4\u6210\uFF1B\u5FC5\u987B\u4EE5\u5B57\u6BCD\u5F00\u5934\uFF1B\u4E0D\u80FD\u4EE5\u5355\u4E2A\u5B57\u6BCD\u52A0\u4E0B\u6ED1\u7EBF\u5F00\u5934"},{unique:!0,message:"${title}\u4E0D\u80FD\u91CD\u590D"},{handler({cellValue:u},i){ee.includes(u.toUpperCase())?i(!1,u+"\u662F\u5173\u952E\u5B57\uFF0C\u4E0D\u80FD\u4F5C\u4E3A\u5B57\u6BB5\u540D\u79F0\u4F7F\u7528\uFF01"):i(!0)}},{handler:D}],disabled:!e.actionButton},{title:"\u5B57\u6BB5\u5907\u6CE8",key:"dbFieldTxt",width:140,type:E.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u5B57\u6BB5\u957F\u5EA6",key:"dbLength",width:120,type:E.inputNumber,defaultValue:32,placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}],disabled:!e.actionButton},{title:"\u5C0F\u6570\u70B9",key:"dbPointLength",width:100,type:E.inputNumber,defaultValue:0,placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}],disabled:!e.actionButton},{title:"\u9ED8\u8BA4\u503C",key:"dbDefaultVal",width:140,type:E.input,defaultValue:"",disabled:!e.actionButton},{title:"\u5B57\u6BB5\u7C7B\u578B",key:"dbType",width:140,type:E.select,options:[{title:"String",value:"string"},{title:"Integer",value:"int"},{title:"Double",value:"double"},{title:"Date",value:"Date"},{title:"Datetime",value:"Datetime"},{title:"BigDecimal",value:"BigDecimal"},{title:"Text",value:"Text"},{title:"Blob",value:"Blob"}],defaultValue:"string",placeholder:"\u8BF7\u9009\u62E9${title}",disabled:!e.actionButton,validateRules:[{required:!0,message:"\u8BF7\u9009\u62E9${title}"}]},{title:"\u4E3B\u952E",key:"dbIsKey",width:80,type:E.checkbox,align:"center",customValue:["1","0"],defaultChecked:!1,disabled:!e.actionButton},{title:"\u5141\u8BB8\u7A7A\u503C",key:"dbIsNull",width:80,type:E.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"\u540C\u6B65\u6570\u636E\u5E93",key:"dbIsPersist",minWidth:80,type:E.checkbox,customValue:["1","0"],defaultChecked:!0,disabled:!e.actionButton},{title:"orderNum",key:"orderNum",type:E.hidden}]);let n=[];const T=Y(s),{tableRef:A,loading:R,dataSource:c,tableHeight:f,tableProps:m,setDataSource:p,validateData:b}=T;function g(){t("added",a)}function h(u){n=n.concat(u.deleteRows.map(i=>i.id)),t("removed",F(S({},u),{removeIds:n,target:a}))}function U(u){t("dragged",{oldIndex:u.oldIndex,newIndex:u.newIndex,target:a})}function _(u){t("inserted",F(S({},u),{target:a}))}function y(){return n}function v(u){let{type:i,row:d,col:o,value:l,target:r}=u;i===E.select&&o.key==="dbType"&&((l==="Date"||l==="Datetime")&&t("syncDbType",{row:d,value:l,target:a}),l==="Blob"||l==="Text"||l==="Date"?r.setValues([{rowKey:d.id,values:{dbLength:"0"}}]):l==="int"||l==="double"||l==="BigDecimal"?r.setValues([{rowKey:d.id,values:{dbLength:"10"}}]):d.dbLength==="0"&&r.setValues([{rowKey:d.id,values:{dbLength:"32"}}]))}function M(u,i,d){return u==="has_child"||u==="id"&&d===0}function P(u){A.value.pushRows(u),I.value||t("added",a)}function V(u){return A.value.removeRowsById(u)}function H(){I.value=!0,R.value=!0}function w(){I.value=!1,R.value=!1,t("added",a)}function D({cellValue:u,row:i},d){const{tables:o}=T;if(o){let r=o.dbTable.value.tableRef.dataSource.filter(N=>N.id===i.id);(!r||r.length<=0)&&d(!0);let O=r[0].dbFieldName;O==u&&d(!0);let G=o.idxTable.value.tableRef.getTableData();for(let N of G)N.indexField.split(",").indexOf(O)>=0&&d(!1,"\u5F53\u524D\u5B57\u6BB5\u5B58\u5728\u7D22\u5F15\u914D\u7F6E\uFF0C\u8BF7\u5148\u5220\u9664\u7D22\u5F15\u518D\u4FEE\u6539\u5B57\u6BB5")}d(!0)}return{tableRef:A,loading:R,columns:s,dataSource:c,setDataSource:p,addBatchBegin:H,addBatchEnd:w,tableAddLine:P,tableHeight:f,tableProps:m,tableDeleteLines:V,handleAdded:g,handleRemoved:h,handleDragged:U,handleInserted:_,handleValueChange:v,handleDisabledDbFieldName:M,validateData:b,getRemoveIds:y,validateExistIndex:D}}});function ue(e,t,a,I,s,n){const T=k("JVxeTable");return K(),W(T,X({ref:"tableRef",rowNumber:"",rowSelection:"",dragSort:"",keyboardEdit:"",sortKey:"orderNum",addButtonSettings:"",loading:e.loading,columns:e.columns,dataSource:e.dataSource,toolbar:e.actionButton,maxHeight:e.tableHeight.normal,disabledRows:{dbFieldName:e.handleDisabledDbFieldName}},e.tableProps,{onAdded:e.handleAdded,onRemoved:e.handleRemoved,onDragged:e.handleDragged,onInserted:e.handleInserted,onValueChange:e.handleValueChange}),null,16,["loading","columns","dataSource","toolbar","maxHeight","disabledRows","onAdded","onRemoved","onDragged","onInserted","onValueChange"])}var Se=$(te,[["render",ue]]);export{Se as default};
