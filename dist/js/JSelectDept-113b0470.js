var ne=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var U=(e,a,l)=>a in e?ne(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,G=(e,a)=>{for(var l in a||(a={}))ue.call(a,l)&&U(e,l,a[l]);if(P)for(var l of P(a))ce.call(a,l)&&U(e,l,a[l]);return e},Q=(e,a)=>oe(e,se(a));var R=(e,a,l)=>new Promise((g,m)=>{var p=n=>{try{o(l.next(n))}catch(u){m(u)}},r=n=>{try{o(l.throw(n))}catch(u){m(u)}},o=n=>n.done?g(n.value):Promise.resolve(n.value).then(p,r);o((l=l.apply(e,a)).next())});import{B as ie}from"./index-9ca8f863.js";import{ar as re,p as B,B as de,R as fe,O as he,z as me}from"./index-26fb0584.js";import{af as x,D as ee}from"./jeecg-online-vendor-9cc54e36.js";import{t as ve}from"./props-c570bc09.js";import{_ as pe}from"./index-93698215.js";import{c as N,k as h,r as te,e as ye,w as A,u as E,n as W,d as le,V as C,a5 as j,a6 as ae,f as S,a7 as k,a9 as X,E as $,W as Y,ag as F,p as H,s as ge,J as Z}from"./vue-5a09445c.js";import{S as ke}from"./antd-vue-vendor-04f0af1d.js";import{J as Se}from"./JSelectBiz-292f2b27.js";import{useRuleFormItem as Ce}from"./useFormItem-43cba0e8.js";function Ee(e,a,l,g){const m=N("selectOptions",h([])),p=N("selectValues",te({})),r=N("loadingEcho",h(!1)),o=h([]),n=h([]),u=h([]),y=h(!1),w=ye(()=>g.multiple?l.checkStrictly:!0);let D=!0;A(p,({value:t})=>{t&&y.value==!1&&t.length>0&&(r.value=D,D=!1,L(null,t.join(",")).finally(()=>{r.value=!1}))},{immediate:!0});function d(){const t=E(e);if(!t)throw new Error("tree is null!");return t}function O(){W(()=>{l.defaultExpandLevel&&l.defaultExpandLevel>0&&d().filterByLevel(l.defaultExpandLevel),n.value=p.value}).then()}function b(t,s){if(l.checkable==!1){n.value=l.checkStrictly?t.checked:t;const{selectedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function V(t,s){if(l.checkable==!0){if(!g.multiple){if(s.checked){n.value=[s.node.eventKey];let v=l.rowKey,q=s.checkedNodes.find(T=>T[v]===s.node.eventKey);u.value=[q]}else n.value=[],u.value=[];return}n.value=l.checkStrictly?t.checked:t;const{checkedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function f(t){return R(this,null,function*(){d().checkAll(t),yield W(),n.value=d().getCheckedKeys(),t?K():u.value=[]})}function K(){let t="";E(n).length>0&&(t=n.value.join(",")),a({ids:t}).then(s=>{u.value=s})}function J(t){d().expandAll(t)}function L(t,s){return R(this,null,function*(){let c={},i="";t&&(i=t.eventKey,c.pid=t.value),s&&(i="",c.ids=s);let v=yield a(c),q=v;if(l.serverTreeData||(v=re(v,l,i),v.length==0&&t&&M(i,o.value)),y.value==!0){if(!t)o.value=v;else return new Promise(T=>{if(!t.children){T();return}const _=E(e);_&&(_.updateNodeByKey(t.eventKey,{children:v}),_.setExpandedKeys([t.eventKey,..._.getExpandedKeys()])),T()});O()}else{const T=[];q.forEach(_=>{T.push({label:_[l.titleKey],value:_[l.rowKey]})}),m.value=T}})}function M(t,s){if(s&&s.length>0)for(let c of s)if(c.key==t){c.child||(c.isLeaf=!0);break}else M(t,c.children)}function I(t){const s=[],c=[];u.value.forEach(i=>{s.push({label:i[l.labelKey],value:i[l.rowKey]})}),n.value.forEach(i=>{c.push(i)}),m.value=s,t&&t(s,c)}function z(t){return R(this,null,function*(){t?(y.value=!0,yield L(null,null)):y.value=!1})}return[{visibleChange:z,selectOptions:m,selectValues:p,onLoadData:L,onCheck:V,onSelect:b,checkALL:f,expandAll:J,checkedKeys:n,selectRows:u,treeData:o,getCheckStrictly:w,getSelectTreeData:I}]}const we=le({name:"DeptSelectModal",components:{BasicModal:ie,BasicTree:pe},props:Q(G({},ve),{modalTitle:{type:String,default:"部门选择"},value:B.oneOfType([B.string,B.array])}),emits:["register","getSelectResult"],setup(e,{emit:a,refs:l}){const[g,{closeModal:m}]=de(),p=x(),r=h(null);let o=e.value===""?[]:e.value,n=Object.assign({},E(e),E(p),{value:o},{disabled:!1});const u=ke(n,"multiple"),y=s(),[{visibleChange:w,checkedKeys:D,getCheckStrictly:d,getSelectTreeData:O,onCheck:b,onLoadData:V,treeData:f,checkALL:K,expandAll:J,onSelect:L}]=Ee(r,y,u,e),M=h(e.params),I=h([]),z={key:e.rowKey};function t(){O((c,i)=>{a("getSelectResult",c,i),m()})}function s(){let c=e.sync?fe:he;return i=>c(Object.assign({},i,{primaryKey:e.rowKey}))}return{tree:I,handleOk:t,searchInfo:M,treeRef:r,treeData:f,onCheck:b,onSelect:L,checkALL:K,expandAll:J,fieldNames:z,checkedKeys:D,register:g,getBindValue:u,getCheckStrictly:d,visibleChange:w,onLoadData:V}}});function De(e,a,l,g,m,p){const r=C("BasicTree"),o=C("a-menu-item"),n=C("a-menu"),u=C("Icon"),y=C("a-button"),w=C("a-dropdown"),D=C("BasicModal");return j(),ae("div",null,[S(D,F(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:"500px",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{insertFooter:k(()=>[S(w,{placement:"top"},{overlay:k(()=>[S(n,null,{default:k(()=>[e.multiple?(j(),X(o,{key:"1",onClick:a[0]||(a[0]=d=>e.checkALL(!0))},{default:k(()=>[$("全部勾选")]),_:1})):Y("",!0),e.multiple?(j(),X(o,{key:"2",onClick:a[1]||(a[1]=d=>e.checkALL(!1))},{default:k(()=>[$("取消全选")]),_:1})):Y("",!0),S(o,{key:"3",onClick:a[2]||(a[2]=d=>e.expandAll(!0))},{default:k(()=>[$("展开全部")]),_:1}),S(o,{key:"4",onClick:a[3]||(a[3]=d=>e.expandAll(!1))},{default:k(()=>[$("折叠全部")]),_:1})]),_:1})]),default:k(()=>[S(y,{style:{float:"left"}},{default:k(()=>[$(" 树操作 "),S(u,{icon:"ant-design:up-outlined"})]),_:1})]),_:1})]),default:k(()=>[S(r,F({ref:"treeRef",treeData:e.treeData,"load-data":e.sync==!1?null:e.onLoadData},e.getBindValue,{onSelect:e.onSelect,onCheck:e.onCheck,fieldNames:e.fieldNames,checkedKeys:e.checkedKeys,multiple:e.multiple,checkStrictly:e.getCheckStrictly}),null,16,["treeData","load-data","onSelect","onCheck","fieldNames","checkedKeys","multiple","checkStrictly"])]),_:1},16,["onRegister","title","onOk","onVisibleChange"])])}const Ke=ee(we,[["render",De]]),Te=le({name:"JSelectDept",components:{DeptSelectModal:Ke,JSelectBiz:Se},inheritAttrs:!1,props:{value:B.oneOfType([B.string,B.array]),multiple:B.bool.def(!0)},emits:["options-change","change","select","update:value"],setup(e,{emit:a,refs:l}){const g=h(),[m,{openModal:p}]=me(),[r]=Ce(e,"value","change",g),o=h([]);let n=te({value:[]});const u=h(!1);H("selectOptions",o),H("selectValues",n),H("loadingEcho",u);const y=h(!1),w=x();ge(()=>{e.value&&d()}),A(()=>e.value,()=>{d()}),A(n,()=>{n&&(r.value=n.value)}),A(o,()=>{o&&a("select",Z(E(o)),Z(E(n)))});function D(){y.value=!0,p(!0,{isUpdate:!1})}function d(){let f=e.value?e.value:[];f&&typeof f=="string"?(r.value=f.split(","),n.value=f.split(",")):n.value=f}function O(f,K){o.value=f,r.value=K,n.value=K,a("update:value",K.join(","))}const b=Object.assign({},E(e),E(w));function V(f){a("update:value",f)}return{state:r,attrs:w,selectOptions:o,selectValues:n,loadingEcho:u,getBindValue:b,tag:y,regModal:m,setValue:O,handleOpen:D,handleChange:V}}});function _e(e,a,l,g,m,p){const r=C("JSelectBiz"),o=C("DeptSelectModal");return j(),ae("div",null,[S(r,F({onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs,{onChange:e.handleChange}),null,16,["onHandleOpen","loading","onChange"]),S(o,F({onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{multiple:e.multiple}),null,16,["onRegister","onGetSelectResult","multiple"])])}const Fe=ee(Te,[["render",_e],["__scopeId","data-v-a8d1e27c"]]);export{Fe as o};
