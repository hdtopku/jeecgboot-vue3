import{U as V,b as y,u as k}from"./jeecg-online-vendor-216a3b98.js";import{d as B,k as h,w as m,U as S,a5 as v,a9 as w,a7 as b,a6 as O,F as $,a8 as P,aa as M,ab as N}from"./vue-249e5fad.js";import"./antd-vue-vendor-31afcf32.js";import"./tinymce-vendor-676f8393.js";import"./lodash-es-vendor-c1987ca1.js";var R=(t,o,s)=>new Promise((u,a)=>{var f=n=>{try{d(s.next(n))}catch(r){a(r)}},p=n=>{try{d(s.throw(n))}catch(r){a(r)}},d=n=>n.done?u(n.value):Promise.resolve(n.value).then(f,p);d((s=s.apply(t,o)).next())});const x="/online/cgform/api/querySelectOptions",T=B({name:"OnlineSelectCascade",props:{table:{type:String,default:""},txt:{type:String,default:""},store:{type:String,default:""},idField:{type:String,default:""},pidField:{type:String,default:""},pidValue:{type:String,default:"-1"},origin:{type:Boolean,default:!1},condition:{type:String,default:""},value:{type:String,default:""},isNumber:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"}},emits:["change","next"],setup(t,{emit:o}){const{createMessage:s}=k(),u=h(""),a=h([]),f=h(!0);function p(e){let l=e||"";o("change",l),g(l)}m(()=>t.condition,e=>{f.value=!0,e&&n()},{immediate:!0}),m(()=>t.pidValue,e=>{e==="-1"?a.value=[]:n()}),m(()=>t.value,(e,l)=>{e?u.value=e:(u.value=[],l&&(o("change",""),o("next","-1"))),e&&!l&&d(e)},{immediate:!0});function d(e){return R(this,null,function*(){if(t.idField===t.store)o("next",e);else if(t.origin===!0)yield F(),g(e);else{let l=yield C();g(e,l)}})}function n(){let e=r();t.origin===!0?e.condition=t.condition:e.pidValue=t.pidValue,a.value=[],y.get({url:x,params:e},{isTransformResponse:!1}).then(l=>{l.success?a.value=[...l.result]:s.warning("联动组件数据加载失败,请检查配置!")})}function r(){return{table:t.table,txt:t.txt,key:t.store,idField:t.idField,pidField:t.pidField}}function C(){return new Promise(e=>{if(!t.value)u.value=[],e([]);else{let l=r();t.isNumber===!0?l.condition=`${t.store} = ${t.value}`:l.condition=`${t.store} = '${t.value}'`,y.get({url:x,params:l},{isTransformResponse:!1}).then(i=>{i.success?e(i.result):(s.warning("联动组件数据加载失败,请检查配置!"),e([]))})}})}function F(){return new Promise(e=>{(function l(i){i>10&&e([]);let c=a.value;c&&c.length>0?e(c):setTimeout(()=>{l(i++)},300)})(0)})}function g(e,l=[]){if(e&&e.length>0){(!l||l.length==0)&&(l=a.value);let i=l.filter(c=>c.store===e);if(i&&i.length>0){let c=i[0].id;o("next",c)}}}return{selectedValue:u,dictOptions:a,handleChange:p}}}),U=["title"];function _(t,o,s,u,a,f){const p=S("a-select-option"),d=S("a-select");return v(),w(d,{placeholder:t.placeholder,value:t.selectedValue,onChange:t.handleChange,allowClear:"",style:{width:"100%"}},{default:b(()=>[(v(!0),O($,null,P(t.dictOptions,(n,r)=>(v(),w(p,{key:r,value:n.store},{default:b(()=>[M("span",{style:{display:"inline-block",width:"100%"},title:n.label},N(n.label),9,U)]),_:2},1032,["value"]))),128))]),_:1},8,["placeholder","value","onChange"])}const L=V(T,[["render",_]]);export{L as default};
