var y=(m,d,l)=>new Promise((r,g)=>{var u=t=>{try{o(l.next(t))}catch(p){g(p)}},c=t=>{try{o(l.throw(t))}catch(p){g(p)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(u,c);o((l=l.apply(m,d)).next())});import{bq as T,br as E,ac as M,bs as A}from"./jeecg-online-vendor-bf2efbcb.js";import{q as x}from"./page.api-265971d0.js";import{B as P}from"./index-8cf3aabb.js";import S from"./PasswordModal-1303f7a0.js";import{A as R}from"./index-fde9c72f.js";import{d as V,k as i,u as n,n as F,U as N,aV as h,as as O,f as C,bi as U,at as q,ar as J,V as L,aQ as W,F as $}from"./vue-c7e3516e.js";const G={id:"dragEngineBox",style:{height:"100vh","overflow-y":"auto"}},Z=V({__name:"DragPageModal",props:{lowAppId:{type:String},isLowApp:{type:Boolean,default:!0}},emits:["success","register","close"],setup(m,{emit:d}){const l={padding:"0",height:window.innerHeight+"px"},r=i(""),g=i(""),u=i(!0),c=i(),o=i({componentData:[],name:"",coverUrl:"",backgroundColor:"",backgroundImage:"",designType:100,theme:"default",style:"default",updateCount:null}),[t,{setModalProps:p,closeModal:v}]=R(a=>y(this,null,function*(){p({showCancelBtn:!1,showOkBtn:!1}),u.value=!1,r.value=a.record.id,_(a.record),g.value=`\u9875\u9762\u8BBE\u8BA1 [${a.record.name}]`;const e=yield x({id:n(r)});if(e.success){o.value.name=e.result.name,o.value.coverUrl=e.result.coverUrl;let s=e.result.template?JSON.parse(e.result.template):[];o.value.componentData=s,o.value.backgroundColor=e.result.backgroundColor,o.value.backgroundImage=e.result.backgroundImage,o.value.designType=e.result.designType,o.value.style=e.result.style||"default",o.value.theme=e.result.theme||"default",o.value.updateCount=e.result.updateCount}setTimeout(()=>{F(()=>{u.value=!0})},300)}));function _(a){const e=a.protectionCode;let s=T(E.DRAG_CACHE_PREFIX+n(r));e&&e.length>0&&!s&&(c.value.showModal("design",a),c.value.extraMsg="")}function k(){v(),d("success"),d("close")}function I(a){d("success")}function B(a){let e=document.getElementById("dragEngineBox");b(e,a)}function b(a,e){let s=a.scrollTop;const f=()=>{let w=e-s;s=s+w/10,Math.abs(w)<1?a.scrollTo(0,e):(a.scrollTo(0,s),setTimeout(f,20))};f()}function D(a){window.open(a,"_blank")}return(a,e)=>{const s=N("DragEngine");return h(),O($,null,[C(n(P),W(a.$attrs,{footer:null,wrapClassName:"drag-design-process-modal",style:{top:"0",padding:"0"},onRegister:n(t),bodyStyle:l,canFullscreen:!1,closable:!1,defaultFullscreen:"",destroyOnClose:""}),{default:U(()=>[q("div",G,[u.value?(h(),J(s,{key:0,dragData:o.value,pageId:r.value,token:n(M)(),tenantId:n(A)(),lowAppId:m.lowAppId,isLowApp:!1,onSave:I,onClose:k,onScroll:B,onOpenWindow:D},null,8,["dragData","pageId","token","tenantId","lowAppId"])):L("",!0)])]),_:1},16,["onRegister"]),C(S,{ref_key:"passwordRef",ref:c,onClosed:n(v)},null,8,["onClosed"])],64)}}});export{Z as _};
