var T=Object.defineProperty;var v=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var w=(e,o,s)=>o in e?T(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,x=(e,o)=>{for(var s in o||(o={}))U.call(o,s)&&w(e,s,o[s]);if(v)for(var s of v(o))_.call(o,s)&&w(e,s,o[s]);return e};var b=(e,o,s)=>new Promise((c,l)=>{var u=a=>{try{d(s.next(a))}catch(m){l(m)}},g=a=>{try{d(s.throw(a))}catch(m){l(m)}},d=a=>a.done?c(a.value):Promise.resolve(a.value).then(u,g);d((s=s.apply(e,o)).next())});import{B as L}from"./index-9ca8f863.js";import{B as M}from"./BasicForm-e7d3537f.js";import"./componentMap-42aebfee.js";import{u as S}from"./useForm-b8bb8b05.js";import"./JAddInput-6e8b52df.js";import"./JSelectUser-9d666511.js";import"./JSelectDept-113b0470.js";import"./JPopup-746d3c0b.js";import{B as R}from"./index-26fb0584.js";import"./cron-parser-vendor-b0ab0fe2.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-8153fc9b.js";import{b as i}from"./jeecg-online-vendor-9cc54e36.js";import{M as F}from"./antd-vue-vendor-04f0af1d.js";import{d as D,k as f,e as O,u as r,a5 as A,a9 as E,a7 as H,f as j,ag as K}from"./vue-5a09445c.js";const ne=[{title:"分类名称",dataIndex:"name",width:350,align:"left"},{title:"分类编码",dataIndex:"code"}],le=[{label:"名称",field:"name",component:"Input",colProps:{span:6}},{label:"编码",field:"code",component:"Input",colProps:{span:6}}],N=[{label:"",field:"id",component:"Input",show:!1},{label:"父级节点",field:"pid",component:"TreeSelect",componentProps:{fieldNames:{value:"key"},dropdownStyle:{maxHeight:"50vh"},getPopupContainer:()=>document.body},show:({values:e})=>e.pid!=="0",dynamicDisabled:({values:e})=>!!e.id},{label:"分类名称",field:"name",required:!0,component:"Input"}],ie="/sys/category/exportXls",ce="/sys/category/importExcel",pe=e=>i.get({url:"/sys/category/rootList",params:e}),de=(e,o)=>i.delete({url:"/sys/category/delete",params:e},{joinParamsToUrl:!0}).then(()=>{o()}),me=(e,o)=>{F.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>i.delete({url:"/sys/category/deleteBatch",data:e},{joinParamsToUrl:!0}).then(()=>{o()})})},V=(e,o)=>{let s=o?"/sys/category/edit":"/sys/category/add";return i.post({url:s,params:e})},q=e=>i.get({url:"/sys/category/loadTreeRoot",params:e}),ue=e=>i.get({url:"/sys/category/childList",params:e}),fe=e=>i.get({url:"/sys/category/getChildListBatch",params:e},{isTransformResponse:!1}),ge=D({__name:"CategoryModal",emits:["register","success"],setup(e,{emit:o}){const s=f(!0),c=f([]),l=f([]),u=f(!1),[g,{resetFields:d,setFieldsValue:a,validate:m,updateSchema:B}]=S({schemas:N,showActionButtonGroup:!1,labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[C,{setModalProps:y,closeModal:P}]=R(t=>b(this,null,function*(){yield d(),c.value=[],y({confirmLoading:!1,minHeight:80}),s.value=!!(t!=null&&t.isUpdate),u.value=!(t!=null&&t.isUpdate)&&t.record&&t.record.id,t!=null&&t.record&&(yield a(x({},t.record))),l.value=yield q({async:!1,pcode:""}),B({field:"pid",componentProps:{treeData:l}})})),k=O(()=>r(s)?"编辑字典":"新增字典");function h(t,n){if(t&&n&&n.length>0)for(let p=0;p<n.length;p++)n[p].key==t&&r(c).indexOf(t)<0?(c.value.push(n[p].key),h(n[p].parentId,r(l))):h(t,n[p].children)}function I(){return b(this,null,function*(){try{let t=yield m();y({confirmLoading:!0}),yield V(t,s.value),P(),yield h(t.pid,r(l)),o("success",{isUpdate:r(s),isSubAdd:r(u),values:x({},t),expandedArr:r(c).reverse()})}finally{y({confirmLoading:!1})}})}return(t,n)=>(A(),E(r(L),K(t.$attrs,{onRegister:r(C),destroyOnClose:"",title:k.value,onOk:I}),{default:H(()=>[j(r(M),{onRegister:r(g)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{ge as _,ce as a,me as b,ne as c,fe as d,ue as e,de as f,ie as g,pe as l,le as s};
