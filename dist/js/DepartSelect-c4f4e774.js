var E=(m,k,c)=>new Promise((f,h)=>{var x=l=>{try{D(c.next(l))}catch(s){h(s)}},T=l=>{try{D(c.throw(l))}catch(s){h(s)}},D=l=>l.done?f(l.value):Promise.resolve(l.value).then(x,T);D((c=c.apply(m,k)).next())});import{B as ue}from"./index-a882524d.js";import{g as le,h as se}from"./depart.api-de6ffddd.js";import{o as oe}from"./tenant.api-6740e12d.js";import{c as ne,l as re,_ as ie}from"./jeecg-online-vendor-12004772.js";import{d as ce,k as r,w as fe,U as v,aV as _,ar as b,bi as a,f as i,E as C,ad as R,as as $,a_ as q,F as Q,V as W,aQ as X,u as e,aX as de,aW as pe,at as G,ag as j}from"./vue-c7e3516e.js";import"./BasicModal-b901e352.js";import"./index-6916e394.js";import"./lodash-es-vendor-42c8d3d4.js";import"./antd-vue-vendor-1561c1ba.js";import"./tinymce-vendor-40778af9.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./useWindowSizeFn-581ed1a8.js";const J=m=>(de("data-v-9b9f3ad3"),m=m(),pe(),m),ve=J(()=>G("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5C5E\u79DF\u6237",-1)),me=J(()=>G("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5728\u90E8\u95E8",-1)),_e=ce({__name:"DepartSelect",props:{title:{type:String,default:"\u90E8\u95E8\u9009\u62E9"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(m,{expose:k}){const c=m,f=ne(),{createMessage:h,notification:x}=re(),T={labelCol:{span:4},wrapperCol:{span:18}},D={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},l=r(""),s=r(!1),B=r(""),d=r(),N=r([]),w=r(""),p=r(!1),y=r(""),g=r(""),U=r([]),S=r(""),I=r(!1);function K(){return E(this,null,function*(){yield A(),yield O(),e(s)&&e(p)?l.value="\u5207\u6362\u79DF\u6237\u548C\u90E8\u95E8":e(s)?l.value=e(B)&&e(B).length>0?`\u79DF\u6237\u5207\u6362\uFF08\u5F53\u524D\u79DF\u6237 :${e(B)}\uFF09`:c.title:e(p)&&(l.value=e(y)&&e(y).length>0?`\u90E8\u95E8\u5207\u6362\uFF08\u5F53\u524D\u90E8\u95E8 :${e(y)}\uFF09`:c.title),(e(s)||e(p))&&(I.value=!0)})}function A(){return E(this,null,function*(){const t=yield le();if(!t.list||t.list.length==0)return;let u=t.list.filter(n=>n.orgCode==t.orgCode);U.value=t.list,g.value=u&&u.length>0?t.orgCode:"",y.value=u&&u.length>0?u[0].departName:"",p.value=!0})}function O(){return E(this,null,function*(){const t=yield oe();if(!t.list||t.list.length==0)return;let u=f.getTenant,n=t.list.filter(F=>F.id==u);B.value=n&&n.length>0?n[0].name:"",N.value=t.list,d.value=u,s.value=!0})}function Y(){return E(this,null,function*(){if(e(s)&&e(d)==null)return w.value="error",!1;if(e(p)&&!e(g))return S.value="error",!1;Z().then(()=>{e(s)&&f.setTenant(e(d)),h.success("\u5207\u6362\u6210\u529F"),window.location.reload()}).catch(t=>{}).finally(()=>{e(s)&&f.setTenant(e(d)),L()})})}function Z(){return new Promise((t,u)=>E(this,null,function*(){if(!e(p))t();else{const n=yield se({username:f.getUserInfo.username,orgCode:e(g),loginTenantId:e(d)});if(n.userInfo){const F=n.userInfo;f.setUserInfo(F),t()}else ee(n),f.logout(),u()}}))}function ee(t){x.error({message:"\u767B\u5F55\u5931\u8D25",description:((t.response||{}).data||{}).message||t.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function L(){te()}function te(){l.value="",s.value=!1,B.value="",d.value="",N.value=[],w.value="",p.value=!1,y.value="",g.value="",U.value=[],S.value="",I.value=!1}return fe(()=>c.username,t=>{t&&A()}),k({show:K}),(t,u)=>{const n=v("a-avatar"),F=v("a-tooltip"),M=v("Icon"),V=v("a-select-option"),z=v("a-select"),H=v("a-form-item"),ae=v("a-form"),P=v("a-button");return _(),b(e(ue),X(D,{title:l.value,visible:I.value,"onUpdate:visible":u[2]||(u[2]=o=>I.value=o),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(P,{onClick:L},{default:a(()=>[C("\u5173\u95ED")]),_:1}),i(P,{onClick:Y,type:"primary"},{default:a(()=>[C("\u786E\u8BA4")]),_:1})]),default:a(()=>[i(ae,X({ref:"formRef"},T,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[s.value?(_(),b(H,{key:0,"validate-status":w.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(n,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[C(" \u79DF\u6237 ")]),_:1})]),_:1})]),default:a(()=>[i(z,{value:d.value,"onUpdate:value":u[0]||(u[0]=o=>d.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:R({"valid-error":w.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(Q,null,q(N.value,o=>(_(),b(V,{key:o.id,value:o.id},{default:a(()=>[C(j(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):W("",!0),p.value?(_(),b(H,{key:1,"validate-status":S.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(n,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[C(" \u90E8\u95E8 ")]),_:1})]),_:1})]),default:a(()=>[i(z,{value:g.value,"onUpdate:value":u[1]||(u[1]=o=>g.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:R({"valid-error":S.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(Q,null,q(U.value,o=>(_(),b(V,{key:o.orgCode,value:o.orgCode},{default:a(()=>[C(j(o.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):W("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const Ue=ie(_e,[["__scopeId","data-v-9b9f3ad3"]]);export{Ue as default};
