var D=(u,r,n)=>new Promise((c,p)=>{var o=s=>{try{g(n.next(s))}catch(f){p(f)}},y=s=>{try{g(n.throw(s))}catch(f){p(f)}},g=s=>s.done?c(s.value):Promise.resolve(s.value).then(o,y);g((n=n.apply(u,r)).next())});import{av as F,u as S,ad as h}from"./jeecg-online-vendor-12004772.js";import{bF as T,bE as E,k as b,r as w}from"./vue-c7e3516e.js";import{aq as C}from"./index-6916e394.js";const M=u=>{const r="/sys/annountCement/vue3List";return h.get({url:r,params:u})};function L(){F("rangeDate");const u=b([]),r=b(1);let n=10;const c=w({fromUser:"",rangeDateKey:"",rangeDate:[],starFlag:""});function p(){let{fromUser:e,rangeDateKey:t,rangeDate:a,starFlag:d}=c,i={fromUser:e,starFlag:d,rangeDateKey:t,beginDate:"",endDate:"",pageNo:r.value,pageSize:n};return t=="zdy"&&(i.beginDate=a[0]+" 00:00:00",i.endDate=a[1]+" 23:59:59"),i}const o=b(!1);function y(){return D(this,null,function*(){if(o.value===!0)return;let e=p();const t=yield M(e);if(!t||t.length<=0){o.value=!0;return}t.length<n&&(o.value=!0),r.value=r.value+1;let a=u.value;a.push(...t),u.value=a})}function g(){u.value=[],r.value=1,o.value=!1}function s(e){const t="/sys/sysAnnouncementSend/edit";let a="1";e.starFlag==a&&(a="0");const d={starFlag:a,id:e.sendId};h.put({url:t,params:d})}const f=b(!1);function l(){return D(this,null,function*(){f.value=!0,yield y(),f.value=!1})}function m(e){return e.readFlag!=="1"}function v(e){return e.busType=="email"?"\u90AE\u4EF6\u63D0\u9192:":e.busType=="bpm"?"\u6D41\u7A0B\u50AC\u529E:":e.busType=="bpm_task"?"\u6D41\u7A0B\u4EFB\u52A1:":e.msgCategory=="2"?"\u7CFB\u7EDF\u6D88\u606F:":e.msgCategory=="1"?"\u901A\u77E5\u516C\u544A:":""}return{messageList:u,reset:g,loadData:y,loadEndStatus:o,searchParams:c,updateStarMessage:s,onLoadMore:l,noRead:m,getMsgCategory:v}}function q(u){const r=F("messageHref"),n=T(),c=S(),p=E(),{close:o,closeSameRoute:y}=C();function g(l,m){return D(this,null,function*(){l.busType?yield s(l):m?m():yield f(l)})}function s(l){return D(this,null,function*(){const{busType:m,busId:v,msgAbstract:e}=l;let t=r.filter(i=>i.value===m);if(!t||t.length==0)return;let a=t[0].text;a=a.replace("{DETAIL_ID}",v);let d={detailId:v};if(e)try{let i=JSON.parse(e);Object.keys(i).map(A=>{d[A]=i[A]})}catch(i){}c.setMessageHrefParams(d),p.path.indexOf(a)>=0?(yield o(),yield n.replace({path:a,query:{time:new Date().getTime()}})):(y(a),yield n.push({path:a}))})}function f(l){return D(this,null,function*(){u("detail",l)})}return{goPage:g}}export{L as a,q as u};
