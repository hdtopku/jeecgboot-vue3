var v=(m,f,o)=>new Promise((i,d)=>{var s=t=>{try{n(o.next(t))}catch(l){d(l)}},e=t=>{try{n(o.throw(t))}catch(l){d(l)}},n=t=>t.done?i(t.value):Promise.resolve(t.value).then(s,e);n((o=o.apply(m,f)).next())});import{b}from"./jeecg-online-vendor-885afdd4.js";import{validateFormModelAndTables as g,VALIDATE_FAILED as D}from"./vxeUtils-60da8bb1.js";import{k as F,u as w}from"./vue-bcbaddf9.js";import"./antd-vue-vendor-a78909e6.js";import"./tinymce-vendor-676f8393.js";import"./vxe-table-vendor-9edfd3ae.js";import"./lodash-es-vendor-9b741fb8.js";function G(m,f,o,i,d,s){const e=F();function n(r,a,c,h){c.loading=!0,b.get({url:r,params:a},{isTransformResponse:!1}).then(y=>{let{result:A}=y;y.success&&A&&(Array.isArray(A)?c.dataSource=A:Array.isArray(A.records)&&(c.dataSource=A.records)),typeof h=="function"&&h(y)}).finally(()=>{c.loading=!1})}function t(r){var a,c;(c=(a=o[r])==null?void 0:a.value)==null||c.resetScrollTop(0)}function l(){let r=Object.values(o);return Promise.all(r)}function p(){l().then(r=>{let a=e.value.getFieldsValue();return g(e.value.validate,a,r,e.value.getProps,!1)}).then(r=>s&&typeof s=="function"?s(r):u(r)).then(r=>{if(typeof f!="function")throw T("classifyIntoFormData");let a=f(r);return m(a)}).catch(r=>{r.error===D&&(r.paneKey?i.value=r.paneKey:i.value=r.index==null?w(i):d.value[r.index])})}function u(r){return new Promise(a=>{a(r)})}function T(r){return`${r} 未定义或不是一个函数`}return[t,p,n,e]}function I(m,f){function o(){return v(this,null,function*(){let e={},n=Object.keys(f),t="";for(let l=0;l<n.length;l++){t=n[l];let p=f[t].value;if(p.isForm){let u=yield s(p,t);u&&(e[t+"List"]=[u])}else{let u=yield d(p,t);u&&u.length>0&&(e[t+"List"]=u)}}return e})}function i(e){return e&&Object.keys(e).map(n=>{e[n]instanceof Array&&(e[n]=e[n].join(","))}),e}function d(e,n){return v(this,null,function*(){return(yield e.validateTable())?(m.value=n,e.resetScrollTop(0),Promise.reject(1)):e.getTableData()})}function s(e,n){return v(this,null,function*(){try{let t=yield e.getFormData();return i(t),t}catch(t){return m.value=n,Promise.reject(t)}})}return{getSubFormAndTableData:o,transformData:i}}export{G as useJvxeMethod,I as useValidateAntFormAndTable};
