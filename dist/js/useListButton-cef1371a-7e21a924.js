import{E as A,r as we}from"./useExtendComponent-48d37d9b-71310295.js";import{k as b,a3 as Se,t as Ce,r as ie,J as k,n as pe}from"./vue-705b7309.js";import{B as De,ae as Oe,b as x,u as ye,ah as Pe,j as xe}from"./jeecg-online-vendor-e26fc0e5.js";import{o as Ee,z as B,n as be}from"./index-ea73cedc.js";import{u as Fe,G as Re}from"./OnlineForm-630a22c2-623c3349.js";import"./index-9c776ac3.js";import{e as de}from"./constant-fe20103a-44089532.js";import{_ as ke,ab as Me}from"./antd-vue-vendor-cce59da1.js";var Ue=Object.defineProperty,je=Object.defineProperties,Ne=Object.getOwnPropertyDescriptors,fe=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable,me=(a,i,u)=>i in a?Ue(a,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[i]=u,j=(a,i)=>{for(var u in i||(i={}))Be.call(i,u)&&me(a,u,i[u]);if(fe)for(var u of fe(i))Ie.call(i,u)&&me(a,u,i[u]);return a},ue=(a,i)=>je(a,Ne(i)),H=(a,i,u)=>new Promise((f,T)=>{var C=g=>{try{p(u.next(g))}catch(v){T(v)}},D=g=>{try{p(u.throw(g))}catch(v){T(v)}},p=g=>g.done?f(g.value):Promise.resolve(g.value).then(C,D);p((u=u.apply(a,i)).next())});const $e={acceptHrefParams:"<p> 跳转时获取的参数信息",currentPage:"<p> 当前页数",currentTableName:"<p> 当前表名",description:"<p> 当前表描述",hasChildrenField:"<p> 是否有子节点的字段名，仅树形表单下有效",isDesForm:"<p> xx",isTree:"<m> 是否是树形表单 ",loadData:"<m> 加载列表数据",pageSize:"<p> 每一页显示条数",queryParam:"<p> 查询条件对象，每次点击查询后才会更新此数据",selectedRowKeys:"<p> 选中的行的id数组",sortField:"<p> 排序字段",sortType:"<p> 排序规则",total:"<p> 总页数",foreignKeyValue:"<p> Erp一对多子表外键选中对应主表字段的值",isErpSubTable:"<p> 是否Erp一对多子表",foreignKeyField:"<p> Erp一对多子表外键字段",themeTemplate:"<p> 主题模板"},Qe={getColumns:"/online/cgform/api/getColumns/",getQueryInfo:"/online/cgform/api/getQueryInfo/",getData:"/online/cgform/api/getData/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",buttonAction:"/online/cgform/api/doButton",exportXls:"/online/cgform/api/exportXlsOld/",importXls:"/online/cgform/api/importXls/",startProcess:"/act/process/extActProcess/startMutilProcess",getErpColumns:"/online/cgform/api/getErpColumns/"};let ge={sortField:"id",sortType:"asc",currentPage:1,pageSize:10,total:0,selectedRowKeys:[],queryParam:{},acceptHrefParams:{},description:"",currentTableName:"",isDesForm:!1,desFormCode:"",cache:!1,isTree:!1,hasChildrenField:""};const Le={current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(a,i)=>i[0]+"-"+i[1]+" 共"+a+"条",showQuickJumper:!0,showSizeChanger:!0,total:0},{createMessage:N,createErrorModal:_e}=ye();function We(a={}){var i;const u=(i=a.code)!=null?i:"",f=b(u),T=Se(),C=b(),D=b(),p=b(!1),g=b([]),v=b(!0),I=b();let m={};const h={execButtonEnhance:function(e,t){if(l[A][e])if(we===e)w(e);else{let o=k(t);return l[A][e].call(l,l,o)}else if(l[A][e+"_hook"])if(t){let o=k(t);w(e+"_hook",o)}else w(e+"_hook")},isTree:function(e){return typeof e=="boolean"?(l.isTreeTable=e,e):l.isTreeTable}};function w(e,t){let o=l[A][e].toLocaleString().match(Re);if(o.length>1){let r=o[1];q(r,t)}}const l=new Proxy($e,{get(e,t){if(typeof h[t]=="function")return h[t];{let o=m[f.value];return Reflect.get(o,t)}},set(e,t,o){let r=X();return Reflect.set(typeof o=="function"?h:r,t,o)},deleteProperty(e,t){return t===f.value?(delete m[t],!0):!1}}),{executeJsEnhanced:q}=Fe({},l);function V(){let e=T.params.id;return e||(e=""),e}Ee(()=>{!u&&K()}),Ce(()=>{delete m[f.value]});function X(){let e=m[f.value];if(!e){a.themeTemplate==de&&(ge.pageSize=5);let t=Object.assign({},ge,{onlineUrl:Qe});e=JSON.parse(JSON.stringify(t)),m[f.value]=e}return e}function $(){let e={},t=T.query;t&&(Object.keys(t).map(o=>{e[o]=t[o]}),l.acceptHrefParams=e)}function Q(e=""){let t;return e==de?t=`${l.onlineUrl.getErpColumns}${f.value}`:t=`${l.onlineUrl.getColumns}${f.value}`,new Promise((o,r)=>{x.get({url:t},{isTransformResponse:!1}).then(s=>{s.success?o(s.result):(N.warning(s.message),r())}).catch(()=>{r()})})}function E(){return new Promise((e,t)=>{let o=`${l.onlineUrl.getData}${f.value}`;l.isTree()===!0&&(o=`${l.onlineUrl.getTreeData}${f.value}`);let r=L();l.isErpSubTable===!0&&(r[l.foreignKeyField]=l.foreignKeyValue,delete r.hasQuery),x.get({url:o,params:r},{isTransformResponse:!1}).then(s=>{s.success?(_(s.result),e(!0)):(s.message==="NO_DB_SYNC"?_e({title:"数据库未同步",content:"请先同步数据库再查看此页面！",onOk:()=>Pe.back()}):N.warning(s.message),t(!1))}).catch(()=>{let s="请求列表数据异常!";N.warning(s),t(!1)})})}function L(){const{sortField:e,sortType:t,acceptHrefParams:o,queryParam:r}=l;let s={};l.isTree()===!0?s.hasQuery="false":s.hasQuery="true";let c=Object.assign({},s,o,r,{column:e,order:t});p.value?(c.pageNo=p.value.current,c.pageSize=p.value.pageSize):c.pageSize=-521;let d=ne();return c.superQueryMatchType=d.matchType||"",c.superQueryParams=d.params||"",be(c)}function _(e){let t=0;Number(e.total)>0?(l.isTree()===!0?(g.value=F(e.records),pe(()=>{J(g.value)})):g.value=e.records,t=Number(e.total)):g.value=[],p.value&&(p.value=ue(j({},p.value),{total:t}))}function W(e,t,o){o&&o.order?(l.sortField=o.field,l.sortType=o.order=="ascend"?"asc":"desc"):(l.sortField="id",l.sortType="asc"),p.value&&(p.value=e),E()}function Y(e){l.description=e.description,l.currentTableName=e.currentTableName,l.isDesForm=e.isDesForm,l.desFormCode=e.desFormCode,l.ID=f.value;let{acceptHrefParams:t,queryParam:o,superQuery:r,currentPage:s,pageSize:c}=l;$(),o?C.value&&C.value.initDefaultValues(o,t):l.queryParam={},r?D.value&&D.value.initDefaultValues(r):l.superQuery={params:"",matchType:""},e.paginationFlag=="Y"?p.value=ue(j({},Le),{current:s,pageSize:c}):p.value=!1}function G(){return H(this,null,function*(){v.value=!0,yield pe(),v.value=!1})}const O={loadData:E,getLoadDataParams:L,reloadTable:G};Object.keys(O).map(e=>{l[e]=O[e]});let Z=b(!1);function ee(){return H(this,null,function*(){p.value&&(p.value=ue(j({},p.value),{current:1})),l.clearSelectedRow(),yield E()})}function F(e){if(e)return e.map(t=>{let o=l.hasChildrenField;if(t[o]=="1"){let r={id:t.id+"_loadChild",name:"loading...",isLoading:!0};r.jeecg_row_key=r.id,t.children=[r]}return t})}const R=b([]);function te(e){R.value=e}function J(e){let t=R.value;if(t.length>0){const{sortField:o,sortType:r,pidField:s}=l;let c=Object.assign({},{column:o,order:r});c.hasQuery="in";let d=Object.assign({});d.rule="in",d.type="text",d.val=t.join(","),d.field=s,d=[d],c.superQueryParams=encodeURI(JSON.stringify(d)),c.superQueryMatchType="and",c.batchFlag="true";let P=`${l.onlineUrl.getTreeData}${f.value}`;x.get({url:P,params:c},{isTransformResponse:!1}).then(y=>{if(y.success&&y.result.records&&y.result.records.length>0){let ve=y.result.records;const se=new Map;for(let U of ve){let S=U[s];if(t.join(",").includes(S)){let z=se.get(S);z==null&&(z=[]),z.push(U),se.set(S,z)}}let Te=se,ce=U=>{U&&U.forEach(S=>{t.includes(S.id)&&(S.children=F(Te.get(S.id)),ce(S.children))})};ce(e)}}).catch(()=>{let y="loadDataByExpandedRows请求列表数据异常!";N.warning(y)})}else return Promise.resolve()}function ne(){if(!l.superQuery)return{};const{superQuery:{params:e,matchType:t},currentTableName:o}=l;let r=o+"@",s=[];if(e.length>0)for(let d of e){let P=j({},d),y=P.field;y.startsWith(r)&&(P.field=y.replace(r,"")),s.push(P)}let c=s.length>0?JSON.stringify(s):"";return{params:encodeURIComponent(c),matchType:t}}const M=b(!1);function oe(e,t){l.superQuery={params:e,matchType:t},e.length==0?M.value=!1:M.value=!0,E()}const[re,{openModal:ae}]=B();function le(e){if(e||(e={}),!e.row){let t=l.selectedRows;if(!t||t.length==0||t.length>1){N.warning("请选择一条数据");return}e.row=t[0]}e.code=f.value,ae(!0,e)}l.openCustomModal=le;function K(){let e=V();f.value=e}!u&&K();function n(e){let t=e.head.extConfigJson;t&&(I.value=JSON.parse(t))}return j({ID:f,onlineQueryFormOuter:C,superQueryButtonRef:D,loading:Z,reload:ee,dataSource:g,pagination:p,tableReloading:v,handleSpecialConfig:Y,onlineTableContext:l,handleChangeInTable:W,getColumnList:Q,getTreeDataByResult:F,expandedRowKeys:R,handleExpandedRowsChange:te,onlineExtConfigJson:I,handleFormConfig:n,superQueryStatus:M,handleSuperQuery:oe,registerCustomModal:re},O)}const he="onl_";function Ye(a,i){const u={add:!0,addSub:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0,detail:!0,super_query:!0,bpm:!0},[f,{openModal:T}]=B(),[C,{openModal:D}]=B(),[p,{openModal:g}]=B(),[v,{openModal:I}]=B(),{createMessage:m}=ye(),h=ie(u),w=ie([]),l=ie([]);function q(n){if(w.length=0,l.length=0,n&&n.length>0)for(let e=0;e<n.length;e++){let t=ke(n[e],"buttonCode","buttonName","buttonStyle","optType","exp","buttonIcon");t.buttonStyle=="button"?l.push(t):t.buttonStyle=="link"&&w.push(t)}}function V(n){Object.keys(h).forEach(e=>{h[e]=!0}),n&&n.length>0&&Object.keys(h).forEach(e=>{n.indexOf(e)>=0&&(h[e]=!1)})}function X(n){let e={isUpdate:!1};n&&(e.param=n),T(!0,e)}function $(n){a.beforeEdit(n).then(()=>{T(!0,{isUpdate:!0,record:n})}).catch(e=>{m.warning(e)})}const Q=n=>({label:"删除",popConfirm:{title:"是否删除？",confirm:E.bind(null,n)}});function E(n){a.beforeDelete(n).then(()=>{R(n.id)}).catch(e=>{m.warning(e)})}function L(n){let e=O(n),t=e&&(e=="1"||e=="3"||e=="4")||!e;return k(h.update)===!0&&t?[{label:"编辑",onClick:$.bind(null,n)}]:[]}function _(n){return{label:"提交流程",popConfirm:{title:"确认提交流程吗？",confirm:F.bind(null,n)}}}function W(n){return{label:"审批进度",onClick:Y.bind(null,n)}}function Y(n){const{currentTableName:e}=a;let t=he+e,o=n.id;I(!0,{flowCode:t,dataId:o})}function G(n){let e=[];if(k(h.detail)===!0&&e.push({label:"详情",onClick:Z.bind(null,n)}),a.hasBpmStatus===!0&&k(h.bpm)===!0){let s=O(n);!s||s=="1"?e.push(_(n)):e.push(W(n))}if(i.value){let{reportPrintShow:s,reportPrintUrl:c}=i.value;s&&c&&e.push({label:"打印",onClick(){let d=c,P=n.id,y=De();Oe(d,P,y)}})}let t=O(n),o=t&&t=="1"||!t;k(h.delete)===!0&&o&&e.push(Q(n));let r=w;if(r&&r.length>0)for(let s of r)K(s.exp||"",n)===!0&&e.push({label:s.buttonName,onClick:J.bind(null,n,s.buttonCode,s.optType)});return e}function O(n){const e="bpm_status";let t=n[e];return t||(t=n[e.toUpperCase()]),t}function Z(n){g(!0,{isUpdate:!0,disableSubmit:!0,record:n})}function ee(n){const{currentTableName:e,onlineUrl:{startProcess:t}}=a;let o={url:t,params:{flowCode:he+e,id:n.id,formUrl:"modules/bpm/task/form/OnlineFormDetail",formUrlMobile:"check/onlineForm/detail"}},r={isTransformResponse:!1};return new Promise((s,c)=>{x.post(o,r).then(d=>{d.success?(s(d),m.success(d.message)):(c(),m.warning(d.message))})})}function F(n){return H(this,null,function*(){yield ee(n),a.loadData()})}function R(n){let e=`${a.onlineUrl.optPre}${a.ID}/${n}`;return new Promise((t,o)=>{x.delete({url:e},{isTransformResponse:!1}).then(r=>{r.success?(m.success(r.message),a.loadData(),t(!0)):(m.warning(r.message),o())})})}function te(){let n=a.selectedRowKeys;if(n.length<=0)return m.warning("请选择一条记录！"),!1;{let e=[];n.forEach(function(o){let r=o;r&&r.endsWith("_loadChild")&&(r=r.replace("_loadChild","")),e.indexOf(r)<0&&e.push(r)});let t=e.join(",");Me.confirm({title:"确认删除",content:"是否删除选中数据",okText:"确认",cancelText:"取消",onOk:()=>H(this,null,function*(){yield R(t),a.clearSelectedRow()})})}}function J(n,e,t){if(t=="js")a.execButtonEnhance(e,n);else if(t=="action"){let o={formId:a.ID,buttonCode:e,dataId:n.id},r=`${a.onlineUrl.buttonAction}`;x.post({url:r,params:o},{isTransformResponse:!1}).then(s=>{s.success?(a.loadData(),m.success("处理完成!")):m.warning(s.message)})}}function ne(n){a.execButtonEnhance(n)}function M(n){let e=a.selectedRowKeys;if(!e||e.length==0)return m.warning("请先选中一条记录"),!1;let t=e.join(","),o={formId:a.ID,buttonCode:n,dataId:t},r=`${a.onlineUrl.buttonAction}`;x.post({url:r,params:o},{isTransformResponse:!1}).then(s=>{s.success?(a.loadData(),a.clearSelectedRow(),m.success("处理完成!")):m.warning(s.message)})}function oe(){D(!0)}const re=()=>`${a.onlineUrl.importXls}${a.ID}`,{handleExportXlsx:ae}=xe();function le(){let n=a.getLoadDataParams(),e=a.selectedRowKeys;e&&e.length>0&&(n.selections=e.join(",")),a.isErpSubTable===!0&&a.foreignKeyField&&a.foreignKeyValue&&(n[a.foreignKeyField]=a.foreignKeyValue);let t=JSON.stringify(be(n)),o=`${a.onlineUrl.exportXls}${a.ID}`;const r=a.description;return ae(r,o,{paramsStr:t})}function K(n,e){if(!n||n=="")return!0;let t=n.split("#"),o=e[t[0]],r=t[1].toLowerCase();return r==="eq"?o==t[2]:r==="ne"?o!=t[2]:r==="empty"?t[2]==="true"?!o||o=="":o&&o.length>0:r==="in"?t[2].split(",").indexOf(String(o))>=0:!1}return{buttonSwitch:h,cgLinkButtonList:w,cgTopButtonList:l,importUrl:re,registerModal:f,handleAdd:X,handleEdit:$,handleBatchDelete:te,registerImportModal:C,onImportExcel:oe,onExportExcel:le,getDropDownActions:G,getActions:L,cgButtonJsHandler:ne,cgButtonActionHandler:M,cgButtonLinkHandler:J,initButtonList:q,initButtonSwitch:V,getDeleteButton:Q,handleSubmitFlow:F,getSubmitFlowButton:_,registerDetailModal:p,registerBpmModal:v}}export{We as l,Ye as o};
