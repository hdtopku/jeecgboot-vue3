import{bW as Q,b$ as q,ac as G,c1 as X,ad as Y,l as Z}from"./jeecg-online-vendor-bf2efbcb.js";import{aN as $}from"./index-fde9c72f.js";import ee from"./DetailForm-da227b43.js";import te from"./OnlineSubFormDetail-7b3cba51.js";import{h as oe}from"./useExtendComponent-f3ffbcdf.js";import"./JUpload.vue_vue_type_style_index_0_lang-3f4c90f3.js";import"./BasicForm.vue_vue_type_style_index_0_lang-aeaafe88.js";import"./componentMap-a6d21ad6.js";import"./antd-vue-vendor-1561c1ba.js";import"./JAddInput-2cbbbde9.js";import"./index-8cf3aabb.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-0a69d004.js";import"./pick-51214243.js";import"./_flatRest-34ab130c.js";import"./isArray-b183d537.js";import"./toString-8deea73b.js";import"./_arrayPush-ae8b790e.js";import"./BasicTable.vue_vue_type_style_index_0_lang-b7d11241.js";import"./useTable-7e303edd.js";import"./LinkTableListPiece-50f8f8cc.js";import"./OnlineSelectCascade-dee0bae8.js";import{k as d,r as re,U as u,aV as p,as as y,f as v,V,ar as P,bi as B,F as ne,a_ as ae,af as ie,R as le}from"./vue-c7e3516e.js";import"./tinymce-vendor-40778af9.js";import"./lodash-es-vendor-42c8d3d4.js";import"./codemirror-vendor-96aab763.js";import"./echarts-vendor-b30c7238.js";import"./html2canvas-vendor-654dcb8a.js";import"./vxe-table-vendor-8bace23a.js";import"./BasicForm-83ba9c88.js";import"./useForm-fa63344e.js";import"./user.api-dd1b3184.js";import"./_commonjsHelpers-938fab4e.js";import"./customExpression-e22f3cce.js";import"./BasicTable-29c6504d.js";import"./useFormItem-4a12ff45.js";import"./BasicModal-ff8f2086.js";import"./useWindowSizeFn-e5cad7ae.js";import"./download-c8889ed9.js";import"./base64Conver-4e359726.js";import"./index-ee020524.js";import"./index-53e807bd.js";import"./useCountdown-473e4dcc.js";import"./areaDataUtil-b2642a1f.js";import"./useSelectBiz-c744cf20.js";import"./props-8e8dbf4f.js";import"./index-d4783a30.js";import"./bem-deccd0b6.js";import"./props-c3781b9d.js";import"./useContextMenu-c0be0b5c.js";import"./useTreeBiz-faf9875a.js";import"./index-63ed9c18.js";import"./depart.api-25dc3d39.js";import"./index-ed4be6fa.js";import"./injectionKey-5da932b3.js";import"./useListPage-5049b37a.js";import"./JModalTip-b651c0e6.js";var me=Object.defineProperty,D=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,J=(i,a,r)=>a in i?me(i,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[a]=r,ue=(i,a)=>{for(var r in a||(a={}))se.call(a,r)&&J(i,r,a[r]);if(D)for(var r of D(a))pe.call(a,r)&&J(i,r,a[r]);return i},x=(i,a,r)=>new Promise((o,g)=>{var S=m=>{try{s(r.next(m))}catch(c){g(c)}},b=m=>{try{s(r.throw(m))}catch(c){g(c)}},s=m=>m.done?o(m.value):Promise.resolve(m.value).then(S,b);s((r=r.apply(i,a)).next())});const ce={name:"OnlineFormDetail",components:{DetailForm:ee,Loading:$,PrinterOutlined:q,OnlineSubFormDetail:te},props:{id:{type:String,default:""},formTemplate:{type:Number,default:1},disabled:{type:Boolean,default:!1},isTree:{type:Boolean,default:!1},pidField:{type:String,default:""},submitTip:{type:Boolean,default:!0},showSub:{type:Boolean,default:!0}},emits:["success","rendered"],setup(i,{emit:a}){const{createMessage:r}=Z(),o=d(""),g=d(!0),S=d(!1),b=d(1),s=d({}),m=d(300),c=d(340),h=re({reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:0,modalMinWidth:""}),{detailFormSchemas:T,hasSubTable:w,subTabInfo:k,refMap:l,showStatus:_,subDataSource:C,createFormSchemas:N,formSpan:E}=oe(i);function I(e){let t={reportPrintShow:0,reportPrintUrl:"",joinQuery:0,modelFullscreen:1,modalMinWidth:""};e&&(t=JSON.parse(e)),Object.keys(t).map(n=>{h[n]=t[n]})}function R(e){return x(this,null,function*(){b.value=e.head.tableType,o.value=e.head.tableName,g.value=e.head.tableType==1,I(e.head.extConfigJson),N(e.schema.properties),a("rendered",h)})}function j(e,t){return x(this,null,function*(){yield L(t),F(!0)})}function M(e){let t=`/online/cgform/api/detail/${i.id}/${e}`;return new Promise((n,f)=>{Y.get({url:t},{isTransformResponse:!1}).then(O=>{O.success?n(O.result):(f(),r.warning(O.message))}).catch(()=>{f()})})}function F(e){Object.keys(_).map(t=>{_[t]=e})}function H(){F(!1),setTimeout(()=>{F(!0)},300)}function L(e){return x(this,null,function*(){let t=yield M(e.id);s.value=ue({},t),U(t)})}function U(e){e||(e={});let t=Object.keys(C.value);if(t&&t.length>0){let n={};for(let f of t)n[f]=e[f]||[];C.value=n}}function z(e){return"online_"+e+":"}function K(){let e=h.reportPrintUrl,t=s.value;if(t){let n=t.id,f=G();X(e,n,f)}}function W(e){let t=s.value;return A(t,e)}function A(e,t){if(e){let n=e[t];return!n&&n!==0&&(n=e[t.toLowerCase()],!n&&n!==0&&(n=e[t.toUpperCase()])),n}return""}return{detailFormSchemas:T,formData:s,formSpan:E,tableName:o,loading:S,hasSubTable:w,subTabInfo:k,subFormHeight:m,subTableHeight:c,refMap:l,onTabChange:H,subDataSource:C,getSubTableAuthPre:z,show:j,createRootProperties:R,onOpenReportPrint:K,onlineExtConfigJson:h,getSubTableForeignKeyValue:W,showStatus:_}}},fe=["id"],de={key:0,style:{"text-align":"right",position:"absolute",top:"15px",right:"20px","z-index":"999"}},he={key:1};function ge(i,a,r,o,g,S){const b=u("PrinterOutlined"),s=u("detail-form"),m=u("online-sub-form-detail"),c=u("JVxeTable"),h=u("a-spin"),T=u("a-tab-pane"),w=u("a-tabs"),k=u("Loading");return p(),y("div",{id:o.tableName+"_form"},[!!o.formData.id&&!!o.onlineExtConfigJson.reportPrintShow?(p(),y("div",de,[v(b,{title:"\u6253\u5370",onClick:o.onOpenReportPrint,style:{"font-size":"16px"}},null,8,["onClick"])])):V("",!0),v(s,{schemas:o.detailFormSchemas,data:o.formData,span:o.formSpan},null,8,["schemas","data","span"]),o.hasSubTable&&r.showSub?(p(),P(w,{key:1,onChange:o.onTabChange},{default:B(()=>[(p(!0),y(ne,null,ae(o.subTabInfo,(l,_)=>(p(),P(T,{tab:l.describe,key:_+"",forceRender:!0},{default:B(()=>[l.relationType==1?(p(),y("div",{key:0,style:ie({"overflow-y":"auto","overflow-x":"hidden","max-height":o.subFormHeight+"px"})},[v(m,{table:l.key,"form-template":r.formTemplate,"main-id":o.getSubTableForeignKeyValue(l.foreignKey),properties:l.properties},null,8,["table","form-template","main-id","properties"])],4)):(p(),y("div",he,[o.showStatus[l.key]?(p(),P(c,{key:0,ref_for:!0,ref:o.refMap[l.key],toolbar:"","keep-source":"","row-number":"","row-selection":"",height:o.subTableHeight,disabled:!0,columns:l.columns,dataSource:o.subDataSource[l.key],authPre:o.getSubTableAuthPre(l.key)},null,8,["height","columns","dataSource","authPre"])):(p(),P(h,{key:1,spinning:!0}))]))]),_:2},1032,["tab"]))),128))]),_:1},8,["onChange"])):V("",!0),v(k,{loading:o.loading,absolute:!1},null,8,["loading"]),le(i.$slots,"bottom")],8,fe)}var yt=Q(ce,[["render",ge]]);export{yt as default};
