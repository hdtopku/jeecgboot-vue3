import _e from"./BasicTable-8d926e13.js";import{Q as He}from"./componentMap-954cd91c.js";import{k as P,w as Ke,U as c,a5 as i,a6 as S,f,V as g,a9 as u,a7 as a,E as y,F as J,a8 as Pe,ab as F,t as Je,A as Ve,aa as A,am as Ne,ad as qe,ae as ze,af as Ue,ag as je,ah as We}from"./vue-249e5fad.js";import"./useTable-096734bf.js";import{U as $e,u as Ge,b as Xe}from"./jeecg-online-vendor-ef755ff7.js";import Ye from"./OnlineAutoModal-2a146238-ee31a34e.js";import Ze from"./OnlineDetailModal-f967f080-304ae20d.js";import eo from"./OnlineCustomModal-456a85a6-99c9441d.js";import{x as oo}from"./JImportModal-fd58de46.js";import{l as to,o as no}from"./useListButton-cef1371a-65267113.js";import{d as lo,p as io,g as ao}from"./useExtendComponent-48d37d9b-cf359578.js";import ro from"./OnlineQueryForm-1c5949a7-21836b66.js";import so from"./SuperQuery-3821f984-fc9232d4.js";import{s as co}from"./constant-fe20103a-44089532.js";import"./index-1c1dc92f.js";import"./index-12df1add.js";import"./BasicForm.vue_vue_type_style_index_0_lang-cef173f8.js";import"./antd-vue-vendor-31afcf32.js";import"./JAddInput-0d73042c.js";import"./JSelectUser-ef2d6619.js";import"./JSelectDept-3b235dbd.js";import"./JPopup-10c26cf4.js";import"./CommentPanel-f82aa847.js";import"./DetailForm-e4538e7a-144e6082.js";import"./JUpload.vue_vue_type_style_index_0_lang-30d4d8b5.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-0e50a01b.js";import"./LinkTableListPiece-34266919-673e897d.js";import"./BasicTable.vue_vue_type_style_index_0_lang-81a2e0f2.js";import"./BasicForm-16b0dbe3.js";import"./lodash-es-vendor-c1987ca1.js";import"./BasicModal-e6e1e190.js";import"./useWindowSizeFn-8e659aab.js";import"./tinymce-vendor-676f8393.js";import"./echarts-vendor-6c8e2159.js";import"./vxe-table-vendor-0b109a77.js";import"./useForm-a6f4b45a.js";import"./injectionKey-69710956.js";import"./useFormItem-7623fae7.js";import"./download-219035f9.js";import"./base64Conver-fa2fe1af.js";import"./index-4d91db79.js";import"./index-2f5742f5.js";import"./useCountdown-da2dd22b.js";import"./areaDataUtil-ce3f5a88.js";import"./props-e09496a2.js";import"./JSelectBiz-a8f462b6.js";import"./index-228eef18.js";import"./codemirror-vendor-7570b8a9.js";import"./index-6c18513e.js";import"./bem-fb1a73a6.js";import"./props-7b44416e.js";import"./useContextMenu-82899327.js";import"./depart.api-0ee34edf.js";import"./index-860d67ba.js";import"./OnlineForm-630a22c2-aed2eeb6.js";import"./user.api-3b019f77.js";import"./customExpression-62f5afd1.js";import"./useListPage-9709a9d6.js";import"./OnlineSelectCascade-c7baf52b-67dc0daa.js";import"./JModalTip-abe1515a-182b54f7.js";import"./OnlineFormDetail-1b216792-f331b76a.js";import"./OnlineSubFormDetail-0aa4966c-f58e3330.js";import"./SuperQueryValComponent.vue_vue_type_script_lang-e3ad7ee8-be58fde9.js";var O=(e,x,p)=>new Promise((l,T)=>{var C=s=>{try{r(p.next(s))}catch(h){T(h)}},m=s=>{try{r(p.throw(s))}catch(h){T(h)}},r=s=>s.done?l(s.value):Promise.resolve(s.value).then(C,m);r((p=p.apply(e,x)).next())});const uo={name:"DefaultOnlineList",components:{BasicTable:_e,TableAction:He,OnlineAutoModal:Ye,JImportModal:oo,OnlineQueryForm:ro,OnlineSuperQuery:so,OnlineCustomModal:eo,OnlineDetailModal:Ze},setup(){const{createMessage:e}=Ge(),x=P(),{ID:p,onlineTableContext:l,onlineQueryFormOuter:T,loading:C,reload:m,dataSource:r,pagination:s,handleSpecialConfig:h,getColumnList:v,handleChangeInTable:D,loadData:B,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,registerCustomModal:o,getTreeDataByResult:w,expandedRowKeys:d,handleExpandedRowsChange:V,tableReloading:N,onlineExtConfigJson:Q,handleFormConfig:q}=to();if(!p.value){e.warning("地址错误, 配置ID不存在!");return}l.isTree(!0);let{initCgEnhanceJs:z}=lo(l);const{buttonSwitch:U,cgLinkButtonList:j,cgTopButtonList:W,importUrl:$,registerModal:G,handleAdd:_,handleEdit:X,handleBatchDelete:Y,registerImportModal:Z,onImportExcel:ee,onExportExcel:oe,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleSubmitFlow:ie,getDropDownActions:ae,getActions:re,initButtonList:se,initButtonSwitch:de,registerDetailModal:ce}=no(l,Q),{columns:ue,actionColumn:pe,selectedKeys:me,rowSelection:ge,enableScrollBar:he,tableScroll:fe,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,handleColumnResult:Se,hrefComponent:xe,viewOnlineCellImage:Te}=io(l,Q);Ke(p,()=>{ke()},{immediate:!0});function ke(){return O(this,null,function*(){C.value=!0;let t=yield v(co);Re(t),yield B(),C.value=!1,l.execButtonEnhance("setup")})}function Re(t){let n=z(t.enhanceJs);l.EnhanceJS=n,se(t.cgButtonList),de(t.hideColumns),Se(t),h(t),l.hasChildrenField=t.hasChildrenField,l.pidField=t.pidField}function Ie(t,n){l.queryParam=t,n===!0?m():H()}function Fe(t){return O(this,null,function*(){yield ao(k),k.value.init(t)})}function ve(t,n){let b=d.value;if(t){if(De(n.id),n.children.length>0&&n.children[0].isLoading===!0){let R=l.hasChildrenField;const{sortField:Ae,sortType:Oe}=l;let M=Object.assign({},{column:Ae,order:Oe});M[l.pidField]=n.id,M[R]=n[R];let Qe=`${l.onlineUrl.getTreeData}${l.ID}`;Xe.get({url:Qe,params:M},{isTransformResponse:!1}).then(I=>{I.success?Number(I.result.total)>0?n.children=w(I.result.records):(n.children="",n.hasChildrenField="0"):e.warning(I.message)}).catch(()=>{e.warning("加载子节点失败!")})}}else{let R=b.indexOf(n.id);R>=0&&(d.value=b.splice(R,1))}}function De(t){let n=d.value;n&&n.indexOf(t)<0&&n.push(t),d.value=n}function H(){return O(this,null,function*(){l.isTree()===!0&&(d.value=[],x.value.collapseAll()),m()})}function Be(t){if(K.value===!0){let n=t[l.pidField];if(n){let b=d.value;b.indexOf(n)<0&&b.push(n),d.value=b}}m()}const Ee=t=>({label:"添加下级",onClick:Le.bind(null,t)}),K=P(!1);function Le(t){K.value=!0;let n={[l.pidField]:t.id};_(n)}function Me(t){let n=ae(t);return n.unshift(Ee(t)),n}return{ID:p,onlineQueryFormOuter:T,queryWithCondition:Ie,onQueryFormLoaded:Fe,reload:m,superQueryButtonRef:k,superQueryStatus:E,handleSuperQuery:L,loading:C,columns:ue,actionColumn:pe,dataSource:r,pagination:s,rowSelection:ge,selectedKeys:me,tableScroll:fe,enableScrollBar:he,handleChangeInTable:D,buttonSwitch:U,handleAdd:_,handleEdit:X,onImportExcel:ee,onExportExcel:oe,cgTopButtonList:W,cgLinkButtonList:j,cgButtonJsHandler:te,cgButtonActionHandler:ne,cgButtonLinkHandler:le,handleBatchDelete:Y,downloadRowFile:ye,getImgView:Ce,getPcaText:we,getFormatDate:be,getActions:re,getTreeDropDownActions:Me,registerModal:G,registerCustomModal:o,registerImportModal:Z,importUrl:$,handleFormConfig:q,tableReloading:N,handleSubmitFlow:ie,hrefComponent:xe,viewOnlineCellImage:Te,onlineTreeTableRef:x,handlerFormSuccess:Be,searchReset:H,handleExpand:ve,expandedRowKeys:d,handleExpandedRowsChange:V,registerDetailModal:ce}}},po={class:"p-2"},mo={key:0,style:{"font-size":"12px","font-style":"italic"}},go={key:0,style:{"font-size":"12px","font-style":"italic"}},ho=["src","onClick"],fo=["innerHTML"],yo=["title"];function Co(e,x,p,l,T,C){const m=c("online-query-form"),r=c("a-button"),s=c("online-super-query"),h=c("TableAction"),v=c("BasicTable"),D=c("OnlineAutoModal"),B=c("JImportModal"),k=c("a-modal"),E=c("online-custom-modal"),L=c("online-detail-modal");return i(),S("div",po,[f(m,{ref:"onlineQueryFormOuter",id:e.ID,onSearch:e.queryWithCondition,onLoaded:e.onQueryFormLoaded},null,8,["id","onSearch","onLoaded"]),e.tableReloading?g("",!0):(i(),u(v,{key:0,ref:"onlineTreeTableRef",isTreeTable:!0,expandedRowKeys:e.expandedRowKeys,onExpandedRowsChange:e.handleExpandedRowsChange,onExpand:e.handleExpand,rowKey:"jeecg_row_key",canResize:!0,bordered:!0,showIndexColumn:!1,loading:e.loading,columns:e.columns,dataSource:e.dataSource,pagination:e.pagination,rowSelection:e.rowSelection,actionColumn:e.actionColumn,showTableSetting:!0,clickToRowSelect:!1,scroll:e.tableScroll,onTableRedo:e.reload,class:Ne({"j-table-force-nowrap":e.enableScrollBar}),onChange:e.handleChangeInTable},{tableTitle:a(()=>[e.buttonSwitch.add?(i(),u(r,{key:0,preIcon:"ant-design:plus-outlined",type:"primary",onClick:e.handleAdd},{default:a(()=>[y("新增")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.import?(i(),u(r,{key:1,preIcon:"ant-design:import-outlined",type:"primary",onClick:e.onImportExcel},{default:a(()=>[y("导入")]),_:1},8,["onClick"])):g("",!0),e.buttonSwitch.export?(i(),u(r,{key:2,preIcon:"ant-design:export-outlined",type:"primary",onClick:e.onExportExcel},{default:a(()=>[y(" 导出")]),_:1},8,["onClick"])):g("",!0),e.cgTopButtonList&&e.cgTopButtonList.length>0?(i(!0),S(J,{key:3},Pe(e.cgTopButtonList,(o,w)=>(i(),S(J,null,[o.optType=="js"?(i(),u(r,{key:"cgbtn"+w,onClick:d=>e.cgButtonJsHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:a(()=>[y(F(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):o.optType=="action"?(i(),u(r,{key:"cgbtn"+w,onClick:d=>e.cgButtonActionHandler(o.buttonCode),type:"primary",preIcon:o.buttonIcon?"ant-design:"+o.buttonIcon:""},{default:a(()=>[y(F(o.buttonName),1)]),_:2},1032,["onClick","preIcon"])):g("",!0)],64))),256)):g("",!0),e.buttonSwitch.batch_delete?Je((i(),u(r,{key:4,preIcon:"ant-design:delete-outlined",onClick:e.handleBatchDelete},{default:a(()=>[y(" 批量删除")]),_:1},8,["onClick"])),[[Ve,e.selectedKeys.length>0]]):g("",!0),e.buttonSwitch.super_query?(i(),u(s,{key:5,ref:"superQueryButtonRef",online:"",status:e.superQueryStatus,onSearch:e.handleSuperQuery},null,8,["status","onSearch"])):g("",!0)]),fileSlot:a(({text:o})=>[o?(i(),u(r,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download",size:"small",onClick:w=>e.downloadRowFile(o)},{default:a(()=>[y(" 下载 ")]),_:2},1032,["onClick"])):(i(),S("span",mo,"无文件"))]),imgSlot:a(({text:o})=>[o?(i(),S("img",{key:1,src:e.getImgView(o),alt:"图片不存在",class:"online-cell-image",onClick:w=>e.viewOnlineCellImage(o)},null,8,ho)):(i(),S("span",go,"无图片"))]),htmlSlot:a(({text:o})=>[A("div",{innerHTML:o},null,8,fo)]),pcaSlot:a(({text:o})=>[A("div",{title:e.getPcaText(o)},F(e.getPcaText(o)),9,yo)]),dateSlot:a(({text:o})=>[A("span",null,F(e.getFormatDate(o)),1)]),action:a(({record:o})=>[f(h,{actions:e.getActions(o),dropDownActions:e.getTreeDropDownActions(o)},null,8,["actions","dropDownActions"])]),_:1},8,["expandedRowKeys","onExpandedRowsChange","onExpand","loading","columns","dataSource","pagination","rowSelection","actionColumn","scroll","onTableRedo","class","onChange"])),f(D,{id:e.ID,onRegister:e.registerModal,onSuccess:e.handlerFormSuccess,onFormConfig:e.handleFormConfig},null,8,["id","onRegister","onSuccess","onFormConfig"]),f(B,{onRegister:e.registerImportModal,url:e.importUrl(),onOk:e.reload,online:""},null,8,["onRegister","url","onOk"]),f(k,je(e.hrefComponent.model,We(e.hrefComponent.on)),{default:a(()=>[(i(),u(qe(e.hrefComponent.is),ze(Ue(e.hrefComponent.params)),null,16))]),_:1},16),f(E,{onRegister:e.registerCustomModal,onSuccess:e.reload},null,8,["onRegister","onSuccess"]),f(L,{id:e.ID,onRegister:e.registerDetailModal},null,8,["id","onRegister"])])}const vt=$e(uo,[["render",Co]]);export{vt as default};
