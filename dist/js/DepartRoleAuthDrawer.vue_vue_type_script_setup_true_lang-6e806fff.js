var w=(I,a,l)=>new Promise((c,i)=>{var s=t=>{try{r(l.next(t))}catch(d){i(d)}},u=t=>{try{r(l.throw(t))}catch(d){i(d)}},r=t=>t.done?c(t.value):Promise.resolve(t.value).then(s,u);r((l=l.apply(I,a)).next())});import{_ as P}from"./index-6c18513e.js";import{u as A,a as O,B as U}from"./index-cc65de79.js";import"./jeecg-online-vendor-ef755ff7.js";import{_ as z}from"./DepartRoleDataRuleDrawer.vue_vue_type_script_setup_true_lang-9edaecab.js";import{a as G,b as H,c as J}from"./depart.user.api-d18f6f8d.js";import{d as M,k as o,U as f,a5 as m,a6 as Q,f as y,a7 as p,E as W,aa as C,a9 as h,u as _,ab as X,V as Y,F as Z}from"./vue-249e5fad.js";const re=M({__name:"DepartRoleAuthDrawer",emits:["register"],setup(I){const a=o(!1),l=o(""),c=o(""),i=o([]),s=o([]),u=o([]),r=o([]),t=o([]),d=o([]),K=o(!0),[b,{closeDrawer:B}]=A(e=>{c.value=e.record.id,l.value=e.record.departId,R()}),[F,S]=O();function R(){return w(this,null,function*(){try{a.value=!0;const{ids:e,treeList:n}=yield G({departId:l.value});e.length>0?(d.value=e,r.value=e,i.value=n,s.value=yield H({roleId:c.value}),u.value=[s.value]):g()}finally{a.value=!1}})}function g(){i.value=[],r.value=[],s.value=[],u.value=[],a.value=!1}function T(e){K.value?s.value=e.checked:s.value=e}function V(e){r.value=e}function E(e,{selectedNodes:n}){var v;if((v=n[0])!=null&&v.ruleFlag){let k=e[0];S.openDrawer(!0,{roleId:c,departId:l,functionId:k})}t.value=[]}function N(){g(),B()}function $(){g()}function x(e){return w(this,null,function*(){try{a.value=!0;let n={roleId:c.value,permissionIds:s.value.join(","),lastpermissionIds:u.value.join(",")};yield J(n),e&&N()}finally{a.value=!1,e||R()}})}return(e,n)=>{const v=f("Icon"),k=f("a-empty"),j=f("a-spin"),q=f("a-button");return m(),Q(Z,null,[y(_(U),{title:"部门角色权限配置",width:650,loading:a.value,showFooter:"",okText:"保存并关闭",onOk:n[1]||(n[1]=D=>x(!0)),onClose:$,onRegister:_(b)},{centerFooter:p(()=>[y(q,{type:"primary",loading:a.value,ghost:"",onClick:n[0]||(n[0]=D=>x(!1))},{default:p(()=>[W("仅保存")]),_:1},8,["loading"])]),default:p(()=>[C("div",null,[y(j,{spinning:a.value},{default:p(()=>[i.value.length>0?(m(),h(_(P),{key:0,title:"所拥有的部门权限",toolbar:"",checkable:"",treeData:i.value,checkedKeys:s.value,selectedKeys:t.value,expandedKeys:r.value,checkStrictly:K.value,clickRowToExpand:!1,onCheck:T,onExpand:V,onSelect:E},{title:p(({slotTitle:D,ruleFlag:L})=>[C("span",null,X(D),1),L?(m(),h(v,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):Y("",!0)]),_:1},8,["treeData","checkedKeys","selectedKeys","expandedKeys","checkStrictly"])):(m(),h(k,{key:1,description:"无可配置部门权限"}))]),_:1},8,["spinning"])])]),_:1},8,["loading","onRegister"]),y(z,{onRegister:_(F)},null,8,["onRegister"])],64)}}});export{re as _};
