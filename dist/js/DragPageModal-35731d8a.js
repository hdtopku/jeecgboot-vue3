var y=(i,r,d)=>new Promise((g,s)=>{var m=o=>{try{n(d.next(o))}catch(c){s(c)}},u=o=>{try{n(d.throw(o))}catch(c){s(c)}},n=o=>o.done?g(o.value):Promise.resolve(o.value).then(m,u);n((d=d.apply(i,r)).next())});import{d as E,l as p,V as M,a7 as h,a8 as x,f as C,aa as A,ad as P,ac as S,u as l,W as R,af as F,F as N,n as V}from"./vue-86253b15.js";import{ao as O,an as U,bd as W,be as q}from"./jeecg-online-vendor-bc5d810e.js";import{q as J}from"./page.api-9e058fb4.js";import{B as L}from"./index-5f3b36bb.js";import $ from"./PasswordModal-9d6dc099.js";import{E as G}from"./index-4de4eaa0.js";import"./antd-vue-vendor-371529c2.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-04a44d0a.js";import"./vxe-table-vendor-6a8d95c4.js";import"./BasicModal-8033a6fa.js";import"./useWindowSizeFn-0b39b13a.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";const H={id:"dragEngineBox",style:{height:"100vh","overflow-y":"auto"}},de=E({__name:"DragPageModal",props:{lowAppId:{type:String},isLowApp:{type:Boolean,default:!0}},emits:["success","register","close"],setup(i,{emit:r}){const d=i,g={padding:"0",height:window.innerHeight+"px"},s=p(""),m=p(""),u=p(!0),n=p(),o=p({componentData:[],name:"",coverUrl:"",backgroundColor:"",backgroundImage:"",designType:100,theme:"default",style:"default",updateCount:null}),[c,{setModalProps:I,closeModal:v}]=G(a=>y(this,null,function*(){I({showCancelBtn:!1,showOkBtn:!1}),u.value=!1,s.value=a.record.id,_(a.record),m.value=`页面设计 [${a.record.name}]`;const e=yield J({id:l(s)});if(e.success){o.value.name=e.result.name,o.value.coverUrl=e.result.coverUrl;let t=e.result.template?JSON.parse(e.result.template):[];o.value.componentData=t,o.value.backgroundColor=e.result.backgroundColor,o.value.backgroundImage=e.result.backgroundImage,o.value.designType=e.result.designType,o.value.style=e.result.style||"default",o.value.theme=e.result.theme||"default",o.value.updateCount=e.result.updateCount}setTimeout(()=>{V(()=>{u.value=!0})},300)}));function _(a){const e=a.protectionCode;let t=W(q.DRAG_CACHE_PREFIX+l(s));e&&e.length>0&&!t&&(n.value.showModal("design",a),n.value.extraMsg="")}function k(){v(),r("success"),r("close")}function B(a){r("success")}function b(a){let e=document.getElementById("dragEngineBox");D(e,a)}function D(a,e){let t=a.scrollTop;const f=()=>{let w=e-t;t=t+w/10,Math.abs(w)<1?a.scrollTo(0,e):(a.scrollTo(0,t),setTimeout(f,20))};f()}function T(a){window.open(a,"_blank")}return(a,e)=>{const t=M("DragEngine");return h(),x(N,null,[C(l(L),F(a.$attrs,{footer:null,wrapClassName:"drag-design-process-modal",style:{top:"0",padding:"0"},onRegister:l(c),bodyStyle:g,canFullscreen:!1,closable:!1,defaultFullscreen:"",destroyOnClose:""}),{default:A(()=>[P("div",H,[u.value?(h(),S(t,{key:0,dragData:o.value,pageId:s.value,token:l(O)(),tenantId:l(U)(),lowAppId:i.lowAppId,isLowApp:!1,onSave:B,onClose:k,onScroll:b,onOpenWindow:T},null,8,["dragData","pageId","token","tenantId","lowAppId"])):R("",!0)])]),_:1},16,["onRegister"]),C($,{ref_key:"passwordRef",ref:n,onClosed:l(v)},null,8,["onClosed"])],64)}}});export{de as default};
