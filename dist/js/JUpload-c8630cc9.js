var ce=Object.defineProperty;var J=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var H=(a,u,c)=>u in a?ce(a,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[u]=c,K=(a,u)=>{for(var c in u||(u={}))de.call(u,c)&&H(a,c,u[c]);if(J)for(var c of J(u))fe.call(u,c)&&H(a,c,u[c]);return a};import{d as T,e as L,V as Q,a7 as M,a8 as R,ak as me,f as r,aa as Z,R as Ye,F as ie,ab as je,ac as ge,ai as qe,af as pe,as as ze,r as ve,l as D,u as d,s as he,E as _e,q as we,v as ee,B as te,ad as x,w as ne,n as be,S as Le,ae,W as se}from"./vue-50733b77.js";import{p as v,m as re,t as F,T as ye,g as j,V as Ce}from"./index-b34ff7bc.js";import{i as xe,_ as Ke,b6 as Ie,q as ue,ar as Se}from"./jeecg-online-vendor-d3e1865b.js";import{ck as oe,co as $e,cm as ke,cn as Ne}from"./antd-vue-vendor-c5335947.js";import"./index-fa22fec6.js";const et=T({name:"ImagePreview",components:{Image:oe,PreviewGroup:oe.PreviewGroup},props:{functional:v.bool,imageList:{type:Array}},setup(a){const{prefixCls:u}=re("image-preview"),c=L(()=>{const{imageList:l}=a;return l?l.map(n=>xe(n)?{src:n,placeholder:!1}:n):[]});return{prefixCls:u,getImageList:c}}});const Oe="/assets/resume-8f27866b.svg",Ue="/assets/p-rotate-cb8bbfc3.svg",Ae="/assets/scale-44abde22.svg",Pe="/assets/unscale-c552f416.svg",Me="/assets/unrotate-ef6a2daf.svg";var N=function(a){return a[a.LOADING=0]="LOADING",a[a.DONE=1]="DONE",a[a.FAIL=2]="FAIL",a}(N||{});const De={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},h="img-preview",Fe=T({name:"ImagePreview",props:De,emits:["img-load","img-error"],setup(a,{expose:u,emit:c}){const l=new Map,n=ve({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:N.LOADING,currentIndex:0,moveX:0,moveY:0,show:a.show}),I=D(null),w=D(null);function S(){i();const{index:e,imageList:s}=a;if(!s||!s.length)throw new Error("imageList is undefined");n.currentIndex=e,C(s[e])}function y(){n.imgScale=1,n.imgRotate=0,n.imgTop=0,n.imgLeft=0}function i(){const e=d(I);e&&(e.onmousewheel=m,document.body.addEventListener("DOMMouseScroll",m),document.ondragstart=function(){return!1})}const f=L(()=>{var s;const e=(s=a==null?void 0:a.scaleStep)!=null?s:0;return(e!=null?e:0>0&&e<100)?e/100:n.imgScale/10});function m(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&_(f.value),e.delta<0&&_(-f.value)}function _(e){n.imgScale<=.2&&e<0||(n.imgScale+=e)}function g(e){n.imgRotate+=e}function $(){const e=d(w);e&&(e.onmousemove=null)}function C(e){n.status=N.LOADING;const s=new Image;s.src=e,s.onload=o=>{if(n.currentUrl!==e){const p=o.composedPath();if(a.rememberState){l.set(n.currentUrl,{scale:n.imgScale,top:n.imgTop,left:n.imgLeft,rotate:n.imgRotate});const b=l.get(e);b?(n.imgScale=b.scale,n.imgTop=b.top,n.imgRotate=b.rotate,n.imgLeft=b.left):(y(),a.defaultWidth&&(n.imgScale=a.defaultWidth/p[0].naturalWidth))}else a.defaultWidth&&(n.imgScale=a.defaultWidth/p[0].naturalWidth);p&&c("img-load",{index:n.currentIndex,dom:p[0],url:e})}n.currentUrl=e,n.status=N.DONE},s.onerror=o=>{const p=o.composedPath();p&&c("img-error",{index:n.currentIndex,dom:p[0],url:e}),n.status=N.FAIL}}function O(e){e&&e.stopPropagation(),U()}function U(){n.show=!1,document.body.removeEventListener("DOMMouseScroll",m),document.ondragstart=null}function A(){y()}u({resume:A,close:U,prev:k.bind(null,"left"),next:k.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(n.imgScale=e)},setRotate:e=>{n.imgRotate=e}});function k(e){const{currentIndex:s}=n,{imageList:o}=a;e==="left"&&(n.currentIndex--,s<=0&&(n.currentIndex=o.length-1)),e==="right"&&(n.currentIndex++,s>=o.length-1&&(n.currentIndex=0)),C(o[n.currentIndex])}function V(e){e=e||window.event,n.moveX=e.clientX,n.moveY=e.clientY;const s=d(w);s&&(s.onmousemove=W)}function W(e){e=e||window.event,e.preventDefault();const s=e.clientX-n.moveX,o=e.clientY-n.moveY;n.imgLeft+=s,n.imgTop+=o,n.moveX=e.clientX,n.moveY=e.clientY}const G=L(()=>{const{imgScale:e,imgRotate:s,imgTop:o,imgLeft:p}=n;return{transform:`scale(${e}) rotate(${s}deg)`,marginTop:`${o}px`,marginLeft:`${p}px`,maxWidth:a.defaultWidth?"unset":"100%"}}),B=L(()=>{const{imageList:e}=a;return e.length>1});he(()=>{a.show&&S(),a.imageList&&y()});const X=e=>{a.maskClosable&&e.target&&e.target.classList.contains(`${h}-content`)&&O(e)},P=()=>r("div",{class:`${h}__close`,onClick:O},[r($e,{class:`${h}__close-icon`},null)]),E=()=>{if(!d(B))return null;const{currentIndex:e}=n,{imageList:s}=a;return r("div",{class:`${h}__index`},[e+1,_e(" / "),s.length])},Y=()=>r("div",{class:`${h}__controller`},[r("div",{class:`${h}__controller-item`,onClick:()=>_(-f.value)},[r("img",{src:Pe},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>_(f.value)},[r("img",{src:Ae},null)]),r("div",{class:`${h}__controller-item`,onClick:A},[r("img",{src:Oe},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>g(-90)},[r("img",{src:Me},null)]),r("div",{class:`${h}__controller-item`,onClick:()=>g(90)},[r("img",{src:Ue},null)])]),t=e=>d(B)?r("div",{class:[`${h}__arrow`,e],onClick:()=>k(e)},[e==="left"?r(ke,null,null):r(Ne,null,null)]):null;return()=>n.show&&r("div",{class:h,ref:I,onMouseup:$,onClick:X},[r("div",{class:`${h}-content`},[r("img",{style:d(G),class:[`${h}-image`,n.status===N.DONE?"":"hidden"],ref:w,src:n.currentUrl,onMousedown:V},null),P(),E(),Y(),t("left"),t("right")])])}});let q=null;function Be(a){var l;if(!Ie)return;const u={},c=document.createElement("div");return Object.assign(u,{show:!0,index:0,scaleStep:100},a),q=r(Fe,u),we(q,c),document.body.appendChild(c),(l=q.component)==null?void 0:l.exposed}var z=(a=>(a.all="all",a.image="image",a.file="file",a))(z||{});const Ee={class:"upload-download-handler"},Re={class:"upload-mover-handler"},Te=T({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(a){const u=a,{createMessage:c}=ue(),l=L(()=>d(u.fileList));function n(){let i=S();if(i===-1){c.warn("移动失败："+i);return}if(i===0){w(i,d(l).length-1);return}w(i,i-1)}function I(){let i=S();if(i===-1){c.warn("移动失败："+i);return}if(i==d(l).length-1){w(i,0);return}w(i,i+1)}function w(i,f){if(i!==f){let m=[...d(l)],_=m[i];m[i]=m[f],m[f]=_,u.emitValue(m.map(g=>g.url).join(","))}}function S(){var f,m;const i=(m=(f=u.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:m.src;if(i){const _=d(l);for(let g=0;g<_.length;g++){let $=_[g].url;const C=i.replace(window.location.origin,"");if($===C||encodeURI($)===C)return g}}return-1}function y(){var f,m;const i=(m=(f=u.element)==null?void 0:f.getElementsByTagName("img")[0])==null?void 0:m.src;window.open(i)}return(i,f)=>(M(),R(ie,null,[ee(x("div",Ee,[x("a",{class:"download",title:"下载",onClick:y},[r(d(F),{icon:"ant-design:download"})])],512),[[te,a.download]]),ee(x("div",Re,[x("a",{title:"向前移动",onClick:n},[r(d(F),{icon:"ant-design:arrow-left"})]),x("a",{title:"向后移动",onClick:I},[r(d(F),{icon:"ant-design:arrow-right"})])],512),[[te,a.mover&&l.value.length>1]])],64))}}),Ve={key:0},We={class:"ant-upload-text"},le="ant-upload-list-item",tt=T({__name:"JUpload",props:{value:v.oneOfType([v.string,v.array]),text:v.string.def("上传"),fileType:v.string.def(z.all),bizPath:v.string.def("temp"),returnUrl:v.bool.def(!0),maxCount:v.number.def(0),buttonVisible:v.bool.def(!0),multiple:v.bool.def(!0),mover:v.bool.def(!0),download:v.bool.def(!0),removeConfirm:v.bool.def(!1),beforeUpload:v.func,disabled:v.bool.def(!1),replaceLastOne:v.bool.def(!1)},emits:["change","update:value"],setup(a,{expose:u,emit:c}){const l=a,{createMessage:n,createConfirm:I}=ue(),{prefixCls:w}=re("j-upload"),S=Se(),y=ye(),i=D([]),f=D(!0),m=D(),_=L(()=>l.maxCount>0&&i.value.length>=l.maxCount),g=L(()=>l.fileType===z.image),$=L(()=>l.disabled===!0?!0:_.value===!0?l.replaceLastOne!==!0:!1),C=L(()=>{const t=Object.assign({},l,d(S));return t.name="file",t.listType=g.value?"picture-card":"text",t.class=[t.class,{"upload-disabled":l.disabled}],t.data=K({biz:l.bizPath},t.data),t.beforeUpload||(t.beforeUpload=V),g.value&&!t.accept&&(t.accept="image/*"),t});ne(()=>l.value,t=>{Array.isArray(t)?l.returnUrl?A(t.join(",")):k(t):l.returnUrl?A(t):t&&k(JSON.parse(t))},{immediate:!0}),ne(i,()=>be(()=>O()),{immediate:!0});function O(){if(!g.value)return;const t=m.value?m.value.getElementsByClassName(le):null;if(!(!t||t.length===0))for(const e of t)e.getAttribute("data-has-actions")==="true"||e.addEventListener("mouseover",U)}function U(t){const s=(()=>{for(const b of t.path){if(b.classList.contains(le))return b;if(b.classList.contains(`${w}-container`))return null}return null})();if(!s)return;const o=s.getElementsByClassName("ant-upload-list-item-actions");if(!o||o.length===0)return;const p=document.createElement("div");p.className="upload-actions-container",Le(Te,{element:s,fileList:i,mover:l.mover,download:l.download,emitValue:P}).mount(p),o[0].appendChild(p),s.setAttribute("data-has-actions","true"),s.removeEventListener("mouseover",U)}function A(t){if(!t||t.length==0){i.value=[];return}let e=[];for(const s of t.split(",")){let o=j(s);e.push({uid:E(),name:Y(s),status:"done",url:o,response:{status:"history",message:s}})}i.value=e}function k(t){if(!t||t.length==0){i.value=[];return}let e=[];for(const s of t){let o=j(s.filePath);e.push({uid:E(),name:s.fileName,url:o,status:"done",response:{status:"history",message:s.filePath}})}i.value=e}function V(t){return f.value=!0,g.value&&t.type.indexOf("image")<0?(n.warning("请上传图片"),f.value=!1,!1):typeof l.beforeUpload=="function"?l.beforeUpload(t):!0}function W(){return l.removeConfirm?new Promise(t=>{I({title:"删除",content:`确定要删除这${g.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>t(!0),onCancel:()=>t(!1)})}):!0}function G(t){!t.file.status&&f.value===!1&&t.fileList.pop();let e=t.fileList;if(l.maxCount>0&&e.length>=l.maxCount)if(l.maxCount-e.length>=0)e=e.slice(-l.maxCount);else return;if(t.file.status==="done"){let s=[];t.file.response.success?s=e.map(o=>{if(o.response){let p=o.response.message;o.url=j(p)}return o}):(s=e.filter(o=>o.uid!=t.file.uid),n.error(`${t.file.name} 上传失败.`)),e=s}else t.file.status==="error"&&n.error(`${t.file.name} 上传失败.`);if(i.value=e,t.file.status==="done"||t.file.status==="removed")if(l.returnUrl)B();else{let s=[];for(const o of e)if(o.status==="done"){let p={fileName:o.name,filePath:o.response.message,fileSize:o.size};s.push(p)}else return;P(JSON.stringify(s))}}function B(){let t=i.value,e="";(!t||t.length==0)&&(e="");let s=[];for(const o of t)if(o.status==="done")s.push(o.response.message);else return;s.length>0&&(e=s.join(",")),P(e)}function X(t){g.value?Be({imageList:[t.url],maskClosable:!0}):window.open(t.url)}function P(t){c("change",t),c("update:value",t)}function E(){return"-"+parseInt(Math.random()*1e4+1,10)}function Y(t){if(t.lastIndexOf("\\")>=0){let e=new RegExp("\\\\","g");t=t.replace(e,"/")}return t.substring(t.lastIndexOf("/")+1)}return u({addActionsListener:O}),(t,e)=>{const s=Q("a-button"),o=Q("a-upload");return M(),R("div",{ref_key:"containerRef",ref:m,class:me(`${d(w)}-container`)},[r(o,pe({headers:d(y),multiple:a.multiple,action:d(Ce),fileList:i.value,disabled:a.disabled},C.value,{onRemove:W,onChange:G,onPreview:X}),{default:Z(()=>[g.value?(M(),R(ie,{key:0},[_.value?se("",!0):(M(),R("div",Ve,[r(d(F),{icon:"ant-design:plus-outlined"}),x("div",We,ae(a.text),1)]))],64)):a.buttonVisible?(M(),ge(s,{key:1,disabled:$.value},{default:Z(()=>[r(d(F),{icon:"ant-design:upload-outlined"}),x("span",null,ae(a.text),1)]),_:1},8,["disabled"])):se("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{z as U,tt as _,Be as c};
