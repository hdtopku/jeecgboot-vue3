var N=Object.defineProperty,V=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var C=(i,a,s)=>a in i?N(i,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[a]=s,A=(i,a)=>{for(var s in a||(a={}))P.call(a,s)&&C(i,s,a[s]);if(T)for(var s of T(a))q.call(a,s)&&C(i,s,a[s]);return i},B=(i,a)=>V(i,j(a));var f=(i,a,s)=>new Promise((c,m)=>{var v=n=>{try{g(s.next(n))}catch(d){m(d)}},y=n=>{try{g(s.throw(n))}catch(d){m(d)}},g=n=>n.done?c(n.value):Promise.resolve(n.value).then(v,y);g((s=s.apply(i,a)).next())});import{b as G,c as O,d as H}from"./UserSetting.api-12a988ce.js";import{t as J,s as K,u as Q}from"./jeecg-online-vendor-a80da268.js";import{m as R}from"./index-0f5326ee.js";import{bx as X,bC as Y,bD as Z,M as ee}from"./antd-vue-vendor-04f0af1d.js";import{d as L,k as u,o as se,a5 as b,a6 as U,aa as o,f as F,an as M,u as l,ab as h,W as E,am as te}from"./vue-5a09445c.js";const ae=o("div",{class:"my-account"},"第三方APP",-1),ne={class:"account-row-item"},ie=o("div",{class:"account-label gray-75"},"钉钉绑定",-1),le=o("span",{class:"gray-75",style:{"margin-left":"12px"}},"钉钉",-1),oe={key:0,class:"gray-75",style:{"margin-left":"8px"}},ce={class:"account-row-item"},re=o("div",{class:"account-label gray-75"},"账号绑定",-1),de=o("span",{class:"gray-75",style:{"margin-left":"12px"}},"微信",-1),ue={key:0,class:"gray-75",style:{"margin-left":"8px"}},ge=L({name:"we-chat-ding-setting"}),ve=L(B(A({},ge),{setup(i){const{prefixCls:a}=R("j-user-tenant-setting-container");X({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),J();const s=u({}),c=u({}),m=u({}),v=K(),y=u(""),g=u("");u({});const{createMessage:n}=Q(),d=u(""),_=u("");function k(){return f(this,null,function*(){let e=yield G({thirdType:"wechat_open,dingtalk,wechat_enterprise"});if(s.value="",c.value="",m.value="",e&&e.result){let t=e.result;for(let r=0;r<t.length;r++)D(t[r])}})}function S(){let e=l(c);e.sysUserId?I({sysUserId:e.sysUserId,id:e.id},"钉钉"):x("dingtalk")}function z(){let e=l(s);e.sysUserId?I({sysUserId:e.sysUserId,id:e.id},"微信"):x("wechat_open")}function x(e){let t=`${v.uploadUrl}/sys/thirdLogin/render/${e}`;l(d)&&(d.value.close(),window.removeEventListener("message",l(_),!1)),d.value=window.open(t,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),y.value=e,_.value=function(r){return f(this,null,function*(){let p=r.data;if(typeof p=="string")if(p==="登录失败")w();else if(p.includes("绑定手机号")){let $=p.split(",");g.value=$[1],yield W()}else p&&n.warning("该敲敲云账号已被其它第三方账号绑定,请解绑或绑定其它敲敲云账号");else w();window.removeEventListener("message",l(_),!1),d.value=""})},window.addEventListener("message",l(_),!1)}function W(){return f(this,null,function*(){if(!l(g)){w();return}let e={thirdUserUuid:l(g),thirdType:l(y)};yield O(e).then(t=>{t.success?t.result&&D(t.result):n.warning(t.message)}).catch(t=>{n.warning(t.message)})})}function w(){n.warning("第三方账号绑定异常")}function D(e){let t=e.thirdType;t=="wechat_open"?s.value=e:t=="dingtalk"?c.value=e:t=="wechat_enterprise"&&(m.value=e)}function I(e,t){return f(this,null,function*(){ee.confirm({title:"解绑"+t,content:"确定要解绑吗",okText:"确认",cancelText:"取消",onOk:()=>f(this,null,function*(){yield H(e).then(r=>{r.success?(k(),n.success(r.message)):n.warning(r.message)})})})})}return se(()=>{k()}),(e,t)=>(b(),U("div",{class:te([`${l(a)}`])},[ae,o("div",ne,[ie,o("span",null,[F(l(Y),{style:M(c.value.sysUserId?{color:"#007FFF"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),le,c.value.realname?(b(),U("span",oe,h("已绑定："+c.value.realname),1)):E("",!0),o("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:S},h(c.value.sysUserId?"解绑":"绑定"),1)])]),o("div",ce,[re,o("span",null,[F(l(Z),{style:M(s.value.sysUserId?{color:"#1ec563"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),de,s.value.realname?(b(),U("span",ue,h("已绑定："+s.value.realname),1)):E("",!0),o("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:z},h(s.value.sysUserId?"解绑":"绑定"),1)])])],2))}}));export{ve as _};
