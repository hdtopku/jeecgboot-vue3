var b=(m,N,c)=>new Promise((f,k)=>{var U=s=>{try{C(c.next(s))}catch(o){k(o)}},B=s=>{try{C(c.throw(s))}catch(o){k(o)}},C=s=>s.done?f(s.value):Promise.resolve(s.value).then(U,B);C((c=c.apply(m,N)).next())});import{d as le,l as u,w as se,V as v,a7 as _,ac as I,aa as a,f as i,E as h,ak as R,a8 as $,ab as W,ae as j,F as A,W as G,af as J,u as e,a5 as oe,a6 as ne,ad as K}from"./vue-86253b15.js";import{B as re}from"./index-5f3b36bb.js";import{g as ue,h as ie}from"./depart.api-b7cb4c93.js";import{v as ce}from"./tenant.api-933f4905.js";import{u as fe,q as de,_ as pe}from"./jeecg-online-vendor-bc5d810e.js";import"./BasicModal-8033a6fa.js";import"./antd-vue-vendor-371529c2.js";import"./tinymce-vendor-7c917b36.js";import"./index-4de4eaa0.js";import"./lodash-es-vendor-04a44d0a.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./vxe-table-vendor-6a8d95c4.js";import"./useWindowSizeFn-0b39b13a.js";const O=m=>(oe("data-v-9b9f3ad3"),m=m(),ne(),m),ve=O(()=>K("span",null,"您隶属于多租户，请选择当前所属租户",-1)),me=O(()=>K("span",null,"您隶属于多部门，请选择当前所在部门",-1)),_e=le({__name:"DepartSelect",props:{title:{type:String,default:"部门选择"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(m,{expose:N}){const c=m,f=fe(),{createMessage:k,notification:U}=de(),B={labelCol:{span:4},wrapperCol:{span:18}},C={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},s=u(""),o=u(!1),w=u(""),d=u(),L=u([]),x=u(""),p=u(!1),S=u(""),g=u(""),M=u([]),T=u(""),D=u(!1);function Q(){return b(this,null,function*(){yield F(),yield X(),e(o)&&e(p)?s.value="切换租户和部门":e(o)?s.value=e(w)&&e(w).length>0?`租户切换（当前租户 :${e(w)}）`:c.title:e(p)&&(s.value=e(S)&&e(S).length>0?`部门切换（当前部门 :${e(S)}）`:c.title),(e(o)||e(p))&&(D.value=!0)})}function F(){return b(this,null,function*(){const t=yield ue();if(!t.list||t.list.length==0)return;let l=t.list.filter(r=>r.orgCode==t.orgCode);M.value=t.list,g.value=l&&l.length>0?t.orgCode:"",S.value=l&&l.length>0?l[0].departName:"",p.value=!0})}function X(){return b(this,null,function*(){const t=yield ce();if(!t.list||t.list.length==0)return;let l=f.getTenant,r=t.list.filter(y=>y.id==l);w.value=r&&r.length>0?r[0].name:"",L.value=t.list,d.value=l,o.value=!0})}function Y(){return b(this,null,function*(){if(e(o)&&e(d)==null)return x.value="error",!1;if(e(p)&&!e(g))return T.value="error",!1;Z().then(()=>{e(o)&&f.setTenant(e(d)),k.success("切换成功"),window.location.reload()}).catch(t=>{}).finally(()=>{e(o)&&f.setTenant(e(d)),V()})})}function Z(){return new Promise((t,l)=>b(this,null,function*(){if(!e(p))t();else{const r=yield ie({username:f.getUserInfo.username,orgCode:e(g),loginTenantId:e(d)});if(r.userInfo){const y=r.userInfo;f.setUserInfo(y),t()}else ee(r),f.logout(),l()}}))}function ee(t){U.error({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})}function V(){te()}function te(){s.value="",o.value=!1,w.value="",d.value="",L.value=[],x.value="",p.value=!1,S.value="",g.value="",M.value=[],T.value="",D.value=!1}return se(()=>c.username,t=>{t&&F()}),N({show:Q}),(t,l)=>{const r=v("a-avatar"),y=v("a-tooltip"),z=v("Icon"),q=v("a-select-option"),E=v("a-select"),H=v("a-form-item"),ae=v("a-form"),P=v("a-button");return _(),I(e(re),J(C,{title:s.value,visible:D.value,"onUpdate:visible":l[2]||(l[2]=n=>D.value=n),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(P,{onClick:V},{default:a(()=>[h("关闭")]),_:1}),i(P,{onClick:Y,type:"primary"},{default:a(()=>[h("确认")]),_:1})]),default:a(()=>[i(ae,J({ref:"formRef"},B,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[o.value?(_(),I(H,{key:0,"validate-status":x.value},{label:a(()=>[i(y,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(r,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[h(" 租户 ")]),_:1})]),_:1})]),default:a(()=>[i(E,{value:d.value,"onUpdate:value":l[0]||(l[0]=n=>d.value=n),placeholder:"请选择登录部门",class:R({"valid-error":x.value=="error"})},{suffixIcon:a(()=>[i(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(A,null,W(L.value,n=>(_(),I(q,{key:n.id,value:n.id},{default:a(()=>[h(j(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):G("",!0),p.value?(_(),I(H,{key:1,"validate-status":T.value},{label:a(()=>[i(y,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(r,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[h(" 部门 ")]),_:1})]),_:1})]),default:a(()=>[i(E,{value:g.value,"onUpdate:value":l[1]||(l[1]=n=>g.value=n),placeholder:"请选择登录部门",class:R({"valid-error":T.value=="error"})},{suffixIcon:a(()=>[i(z,{icon:"ant-design:gold-outline"})]),default:a(()=>[(_(!0),$(A,null,W(M.value,n=>(_(),I(q,{key:n.orgCode,value:n.orgCode},{default:a(()=>[h(j(n.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):G("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const Le=pe(_e,[["__scopeId","data-v-9b9f3ad3"]]);export{Le as default};
