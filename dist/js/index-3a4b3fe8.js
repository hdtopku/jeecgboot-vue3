var et=Object.defineProperty,at=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var A=(t,o,n)=>o in t?et(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,j=(t,o)=>{for(var n in o||(o={}))ot.call(o,n)&&A(t,n,o[n]);if(G)for(var n of G(o))nt.call(o,n)&&A(t,n,o[n]);return t},U=(t,o)=>at(t,st(o));var N=(t,o,n)=>new Promise((d,g)=>{var v=e=>{try{i(n.next(e))}catch(r){g(r)}},y=e=>{try{i(n.throw(e))}catch(r){g(r)}},i=e=>e.done?d(e.value):Promise.resolve(e.value).then(v,y);i((n=n.apply(t,o)).next())});import{d as H,l as R,e as S,u as D,w as it,a5 as Et,a6 as Ht,V as l,a7 as p,ac as _,ak as K,aa as f,a8 as h,F as $,ab as rt,aq as lt,f as c,ad as P,E as ct,ae as O,W as k,r as pt,o as dt,g as ut,af as mt}from"./vue-ebecda47.js";import{c0 as F,bO as C,bD as gt,bW as L,bp as yt,dx as ft,c1 as q,bX as vt}from"./antd-vue-vendor-b75e8c06.js";import{m as W,F as V}from"./index-85cfc899.js";import{ap as X,aq as _t,_ as J,u as ht,m as bt,ao as kt,bU as Ct}from"./jeecg-online-vendor-cfb58502.js";import{T as wt}from"./index-ae3841ab.js";import Mt from"./DetailModal-52308bcb.js";import St from"./DynamicNotice-c4958ca6.js";import"./index-e91e8b28.js";import{connectWebSocket as Dt,onWebSocket as Tt}from"./useWebSocket-54d03caf.js";import{r as Bt}from"./mynews.api-7f720a8d.js";import jt from"./SysMessageModal-3a18fc5c.js";import"./tinymce-vendor-7c917b36.js";import"./lodash-es-vendor-cd7703c8.js";import"./codemirror-vendor-9b2dceac.js";import"./echarts-vendor-ba343549.js";import"./vxe-table-vendor-4aae63bf.js";import"./BasicModal-7e6e7ae9.js";import"./useWindowSizeFn-50bd5ea0.js";import"./JSelectUser-94adcf4d.js";import"./props-c57324f9.js";import"./JSelectBiz-4fc2f082.js";import"./useFormItem-ba20c4de.js";import"./SysMessageList-5a672376.js";import"./useSysMessage-86682ac6.js";var Y=(t=>(t.L="L",t.M="M",t.H="H",t))(Y||{});const Nt=[{key:"1",name:"通知",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"你收到了 14 份新周报",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"你推荐的 曲妮妮 已通过第三轮面试",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"这种模板可以区分多种通知类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"标题可以设置自动显示省略号，本例中标题行数已设为1行，如果内容超过1行将自动截断并支持tooltip显示完整标题。",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"系统消息",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"曲丽丽 评论了你",description:"描述信息描述信息描述信息",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"朱偏右 回复了你",description:"这种模板用于提醒谁与你发生了互动",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"标题",description:"请将鼠标移动到此处，以便测试超长的消息在此处将如何处理。本例中设置的描述最大行数为2，超过2行的描述内容将被省略并且可以通过tooltip查看完整内容",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}];const Pt=t=>X.get({url:"/sys/annountCement/listByUser",params:t}),E=(t,o)=>X.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:j({anntId:t},o)});const Rt=H({components:{[F.name]:F,[C.name]:C,[C.Item.name]:C.Item,AListItemMeta:C.Item.Meta,ATypographyParagraph:gt.Paragraph,[L.name]:L,Time:wt},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(t,{emit:o}){const{prefixCls:n}=W("header-notify-list"),d=R(t.currentPage||1),g=S(()=>{const{pageSize:e,list:r}=t;if(e===!1)return[];let u=_t(e)?e:5;return r.slice(u*(D(d)-1),u*D(d))});it(()=>t.currentPage,e=>{d.value=e});const v=S(()=>!!t.onTitleClick),y=S(()=>{const{list:e,pageSize:r}=t;return r>0&&e&&e.length>r?{total:e.length,pageSize:r,current:D(d),onChange(u){d.value=u,o("update:currentPage",u)}}:!1});function i(e){t.onTitleClick&&t.onTitleClick(e)}return{prefixCls:n,getPagination:y,getData:g,handleTitleClick:i,isTitleClickable:v,PriorityTypes:Y}}});const zt={class:"title"},It={key:0,class:"extra"},Gt={key:2},At={key:0,class:"description"},Ut={class:"datetime"};function $t(t,o,n,d,g,v){const y=l("a-typography-paragraph"),i=l("a-tag"),e=l("a-avatar"),r=l("Icon"),u=l("Time"),T=l("a-list-item-meta"),b=l("a-list-item"),w=l("a-list");return p(),_(w,{class:K(t.prefixCls),pagination:t.getPagination},{default:f(()=>[(p(!0),h($,null,rt(t.getData,s=>(p(),_(b,{key:s.id,class:"list-item",onClick:z=>t.handleTitleClick(s),style:lt({cursor:t.isTitleClickable?"pointer":""})},{default:f(()=>[c(T,null,{title:f(()=>[P("div",zt,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!s.titleDelete,ellipsis:t.$props.titleRows&&t.$props.titleRows>0?{rows:t.$props.titleRows,tooltip:!!s.title}:!1,content:s.title},null,8,["delete","ellipsis","content"]),s.extra?(p(),h("div",It,[c(i,{class:"tag",color:s.color},{default:f(()=>[ct(O(s.extra),1)]),_:2},1032,["color"])])):k("",!0)])]),avatar:f(()=>[s.avatar?(p(),_(e,{key:0,class:"avatar",src:s.avatar},null,8,["src"])):s.priority?(p(),h($,{key:1},[s.priority===t.PriorityTypes.L?(p(),_(e,{key:0,class:"avatar priority-L",title:"一般消息"},{icon:f(()=>[c(r,{icon:"entypo:info"})]),_:1})):k("",!0),s.priority===t.PriorityTypes.M?(p(),_(e,{key:1,class:"avatar priority-M",title:"重要消息"},{icon:f(()=>[c(r,{icon:"bi:exclamation-lg"})]),_:1})):k("",!0),s.priority===t.PriorityTypes.H?(p(),_(e,{key:2,class:"avatar priority-H",title:"紧急消息"},{icon:f(()=>[c(r,{icon:"ant-design:warning-filled"})]),_:1})):k("",!0)],64)):(p(),h("span",Gt,O(s.avatar),1))]),description:f(()=>[P("div",null,[s.description?(p(),h("div",At,[c(y,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:t.$props.descRows&&t.$props.descRows>0?{rows:t.$props.descRows,tooltip:!!s.description}:!1,content:s.description},null,8,["ellipsis","content"])])):k("",!0),P("div",Ut,[c(u,{value:s.datetime,title:s.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const Ot=J(Rt,[["render",$t],["__scopeId","data-v-f011ee3f"]]),Ft=H({components:{Popover:yt,BellOutlined:ft,Tabs:q,TabPane:q.TabPane,Badge:vt,NoticeList:Ot,DetailModal:Mt,DynamicNotice:St,SysMessageModal:jt},setup(){const{prefixCls:t}=W("header-notify"),o=ut(),n=ht(),d=bt(),g=pt({path:"",formData:{}}),[v,y]=V(),i=R(Nt),e=S(()=>{let a=0;for(let m=0;m<i.value.length;m++)a+=i.value[m].count;return a}),[r,{openModal:u}]=V();function T(){for(let a=0;a<i.value.length;a++)i.value[a].count=0;u(!0,{})}const b=R(!1);dt(()=>{Z()});function w(a){return U(j({},a),{title:a.titile,description:a.msgAbstract,datetime:a.sendTime})}function s(){return N(this,null,function*(){try{let{anntMsgList:a,sysMsgList:m,anntMsgTotal:M,sysMsgTotal:B}=yield Pt({pageSize:5});i.value[0].list=a.map(w),i.value[1].list=m.map(w),i.value[0].count=M,i.value[1].count=B}catch(a){}})}s();function z(a){var m;try{E(a.id),s()}catch(M){}a.openType==="component"?(g.path=a.openPage,g.formData={id:a.busId},(m=o.refs.dynamicNoticeRef)==null||m.detail(a.openPage)):y.openModal(!0,{record:a,isUpdate:!0}),b.value=!1}function Z(){var I;let a=kt(),m=Ct(a),M=D(n.getUserInfo).id+"_"+m,B=((I=d.domainUrl)==null?void 0:I.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+M;Dt(B),Tt(Q)}function Q(a){(a.cmd==="topic"||a.cmd==="user")&&setTimeout(()=>{s()},1e3)}function x(){b.value=!1,Bt({},s)}function tt(a){return N(this,null,function*(){try{yield E(a),yield s()}catch(m){}})}return{prefixCls:t,listData:i,count:e,clickBadge:T,registerMessageModal:r,reloadCount:tt,onNoticeClick:z,onEmptyNotify:x,numberStyle:{},popoverVisible:b,registerDetail:v,dynamicNoticeProps:g}}});function Lt(t,o,n,d,g,v){const y=l("BellOutlined"),i=l("Badge"),e=l("DynamicNotice"),r=l("DetailModal"),u=l("sys-message-modal");return p(),h("div",{class:K(t.prefixCls)},[c(i,{count:t.count,overflowCount:9,offset:[-4,10],numberStyle:t.numberStyle,onClick:t.clickBadge},{default:f(()=>[c(y)]),_:1},8,["count","numberStyle","onClick"]),c(e,mt({ref:"dynamicNoticeRef"},t.dynamicNoticeProps),null,16),c(r,{onRegister:t.registerDetail},null,8,["onRegister"]),c(u,{onRegister:t.registerMessageModal,onRefresh:t.reloadCount},null,8,["onRegister","onRefresh"])],2)}const ye=J(Ft,[["render",Lt]]);export{ye as default};
