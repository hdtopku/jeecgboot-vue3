import{k as R,w as ae,V as d,a5 as S,a6 as ie,aa as g,a9 as x,a7 as o,f as a,E as f,W as ye,am as ne,v as re,A as se,F as ue,a8 as ge,ab as be,j as ke,r as de,a3 as Ce,J as ce,ap as Se,aq as we}from"./vue-5a09445c.js";import{B as _e}from"./index-5effa088.js";import{z as Oe,B as Fe,L as le}from"./index-0f5326ee.js";import{V as Me,W as Ie,u as fe}from"./jeecg-online-vendor-a80da268.js";import{u as Te,F as xe}from"./useExtendComponent-48d37d9b-bf2a5eb0.js";import{G as Re}from"./SuperQueryValComponent.vue_vue_type_script_lang-e3ad7ee8-0aa3c1ba.js";import"./componentMap-3d0064b3.js";import"./BasicForm.vue_vue_type_style_index_0_lang-92cda8aa.js";import{bq as De,bI as je,bJ as Ve,bK as Pe,bL as qe,bA as Ee,bM as Le,M as Ne}from"./antd-vue-vendor-04f0af1d.js";import"./JAddInput-7a10c45b.js";import"./JSelectUser-0b713614.js";import"./JSelectDept-a5c54ddb.js";import"./JPopup-cd3c8a0f.js";import"./cron-parser-vendor-278b5be3.js";import"./JEllipsis.vue_vue_type_script_setup_true_lang-d40bf8e2.js";import"./JUpload.vue_vue_type_style_index_0_lang-c2f2a386.js";import"./JUploadModal.vue_vue_type_script_setup_true_lang-18270bc5.js";import"./BasicTable.vue_vue_type_style_index_0_lang-370f2588.js";import"./useTable-e785b2d6.js";import"./LinkTableListPiece-34266919-92c59f43.js";import"./BasicModal-588c46fe.js";import"./useWindowSizeFn-31e0259d.js";import"./tinymce-vendor-e2919cb0.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";import"./BasicForm-862341ae.js";import"./useForm-3526c2e4.js";import"./user.api-99a0b5cb.js";import"./customExpression-62f5afd1.js";import"./BasicTable-0c3b97e4.js";import"./useFormItem-742dfe7c.js";/* empty css              */import"./download-d03a8b78.js";import"./base64Conver-fa2fe1af.js";import"./index-eae03fd6.js";import"./index-73ed1f2f.js";import"./useCountdown-85782a4d.js";import"./useFormItemSingle-373c20d8.js";import"./areaDataUtil-1f845736.js";import"./props-4cb7d255.js";import"./JSelectBiz-bd869605.js";import"./index-21f376b3.js";import"./index-14b4b10a.js";import"./bem-8d785cce.js";import"./props-17f0c5eb.js";import"./useContextMenu-16ff3db3.js";import"./depart.api-19a655aa.js";import"./index-b484e0e9.js";import"./index-42cdfb26.js";import"./injectionKey-69710956.js";import"./useListPage-5c54d46c.js";import"./OnlineSelectCascade-c7baf52b-c8fd8464.js";import"./JModalTip-abe1515a-31977e16.js";var Qe=Object.defineProperty,Ae=Object.defineProperties,Be=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,me=(p,r,v)=>r in p?Qe(p,r,{enumerable:!0,configurable:!0,writable:!0,value:v}):p[r]=v,ve=(p,r)=>{for(var v in r||(r={}))Ue.call(r,v)&&me(p,v,r[v]);if(pe)for(var v of pe(r))Je.call(r,v)&&me(p,v,r[v]);return p},he=(p,r)=>Ae(p,Be(r));const We={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},Ge="JSuperQuerySaved_";function He(){const{linkTableCard2Select:p}=Te(),{createMessage:r}=fe(),v=R(),e=de({values:[]}),D=R("and"),[te,{setModalProps:Q}]=Fe(()=>{Q({confirmLoading:!1})}),A=Object.assign({},{link_down:"text"},We);function b(){}function K(){}function $(t,l,n){n.val=l}const j=R({}),V=R([]);function m(t){let{allFields:l,treeData:n}=w(t);j.value=l,V.value=n}function B(t){let l={field:void 0,rule:"eq",val:"",key:le(16)};t===!1?(e.values=[],e.values.push(l)):t===!0?e.values.length==0&&e.values.push(l):e.values.splice(++t,0,l)}function O(t){let l=ce(e.values),n=-1;for(let i=0;i<l.length;i++)if(t.key==l[i].key){n=i;break}n!=-1&&e.values.splice(n,1)}const U={field:"val",label:"测试",component:"Input"};function J(t,l){let n=j.value[t.field];if(!n)return U;A[n.view]&&(n.view=A[n.view]);let i=xe.createFormSchema(t.field,n);i.noChange(),i.asSearchForm(),i.updateField(t.field+l);const h=C=>{t.val=C[t.field]};i.setFunctionForFieldValue(h);let c=i.getFormItemSchema();return["empty","not_empty"].includes(t.rule)&&(c.componentProps=he(ve({},c.componentProps),{disabled:!0})),p(c),c}const W=R(""),P=Ie(),k=de({visible:!1,title:"",content:"",saveCode:""}),z=R(!1),q=Ce();ae(()=>q.fullPath,t=>{G()});const y=R([]);ae(()=>y.value,t=>{let l=[];t&&t.length>0&&t.map(n=>{let i=le(16);l.push({title:n.title,slots:{icon:"custom"},value:i})}),W.value=l},{immediate:!0,deep:!0});function G(){let t=Ge+q.fullPath;k.saveCode=t;let l=P.get(t);l&&l instanceof Array&&(y.value=l)}G();function X(){let t=F();if(!t){r.warning("空条件不能保存");return}let l=JSON.stringify(t);Y(l)}function Y(t){k.visible=!0,k.title="",k.content=t}function N(){let{title:t,content:l,saveCode:n}=k,i=H(t);i>=0?Ne.confirm({title:"提示",content:`${t} 已存在，是否覆盖？`,okText:"确认",cancelText:"取消",onOk:()=>{y.value.splice(i,1,{content:l,title:t,type:D.value}),P.set(n,y.value),k.visible=!1,r.success("保存成功")}}):(y.value.push({content:l,title:t,type:D.value}),P.set(n,y.value),k.visible=!1,r.success("保存成功"))}function H(t){let l=y.value,n=-1;for(let i=0;i<l.length;i++)if(l[i].title==t){n=i;break}return n}function F(t=!1){var l;let n=e.values;if(!n||n.length==0)return!1;let i=[],h=j.value;for(let c of n){let C=["empty","not_empty"].includes(c.rule);if(c.field&&(C||c.val||c.val===0)&&c.rule){let E=h[c.field],L=(l=E==null?void 0:E.formatValue)!=null?l:_=>_,I=ce(c.val);I instanceof Array?I=I.map(_=>L(_)).join(","):I=L(I);let T={field:Z(c),rule:c.rule,val:I};if(t===!0){let _=h[c.field];_&&(T.type=_.view,T.dbType=_.type)}i.push(T)}}return i.length==0?!1:i}function Z(t){let l=t.field;return l.indexOf("@")>0&&(l=l.replace("@",",")),l}function ee(t,{node:l}){let n=l.dataRef.title,i=y.value.filter(h=>h.title==n);if(i&&i.length>0){let{content:h,type:c}=i[0],C=JSON.parse(h),E=[];for(let L of C)E.push(Object.assign({},{key:le(16)},L));e.values=E,D.value=c}}function s(t){let l=H(t);l>=0&&(y.value.splice(l,1),P.set(k.saveCode,y.value))}function w(t){let l={},n=1,i=[];return t.properties&&(t=t.properties),Object.keys(t).map(h=>{let c=t[h];if(c.view=="table"){let C=c.properties||c.fields,E=n*100,L={title:c.title,value:h,disabled:!0,children:[],order:E};Object.keys(C).map(I=>{let T=C[I];T.order=E+T.order;let _=h+"@"+I;l[_]=T,L.children.push({title:T.title,value:_,isLeaf:!0,order:T.order})}),u(L),i.push(L),n++}else{let C=h;l[C]=c,i.push({title:c.title,value:C,isLeaf:!0,order:c.order})}}),u(i),{allFields:l,treeData:i}}function u(t){(t.children||t).sort(function(l,n){return l.order-n.order})}function M(t){const{params:l,matchType:n}=t;if(l){let i=[];for(let h of l)i.push(Object.assign({},{key:le(16)},h));e.values=i,n.value=n}}return{formRef:v,init:m,dynamicRowValues:e,matchType:D,registerModal:te,handleSubmit:b,handleCancel:K,handleSave:X,doSaveQueryInfo:N,saveInfo:k,saveTreeData:W,handleRemoveSaveInfo:s,handleTreeSelect:ee,fieldTreeData:V,addOne:B,removeOne:O,setFormModel:$,getSchema:J,loading:z,getQueryInfo:F,initDefaultValues:M}}const Ke={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1},online:{type:Boolean,default:!1}},components:{BasicModal:_e,MinusCircleOutlined:De,PlusOutlined:je,OnlineSuperQueryValComponent:Re,FileTextOutlined:Ve,CloseCircleOutlined:Pe,AppstoreTwoTone:qe,Divider:Ee},emits:["search"],setup(p,{emit:r}){const[v,e]=Oe(),{createMessage:D}=fe(),te=R(!0);function Q(){e.closeModal()}function A(){if(p.online===!0){let u=N(!0);u&&u.length>0?(r("search",u,m.value),Q()):D.warning("空条件无法查询！")}else{let u=N(!0);if(u&&u.length>0){let M=b(u);r("search",M)}else D.warning("空条件无法查询！")}}function b(u){let M=[];for(let t of u){let l=t.field,n=t.val;n instanceof Array&&(n=n.join(",")),M.push(he(ve({},t),{field:l,val:n}))}return M.length>0?F.value=!0:F.value=!1,{superQueryMatchType:m.value,superQueryParams:encodeURI(JSON.stringify(M))}}function K(){V.values=[],q(!1);let u=b([]);r("search",u)}const{formRef:$,init:j,dynamicRowValues:V,matchType:m,registerModal:B,handleSave:O,doSaveQueryInfo:U,saveInfo:J,saveTreeData:W,handleTreeSelect:P,handleRemoveSaveInfo:k,fieldTreeData:z,addOne:q,removeOne:y,setFormModel:G,getSchema:X,loading:Y,getQueryInfo:N,initDefaultValues:H}=He(),F=R(!1);ae(()=>p.status,u=>{F.value=u},{immediate:!0});function Z(){e.openModal(),q(!0)}function ee(){return document.getElementsByClassName("jee-super-query-form")[0]}function s(u){}function w(u){u.val=""}return ae(()=>p.config,u=>{u&&j(u)},{immediate:!0}),{formRef:$,registerFormModal:v,init:j,handleChangeField:w,dynamicRowValues:V,matchType:m,historyCollapsed:te,registerModal:B,handleSubmit:A,handleCancel:Q,handleSave:O,handleReset:K,doSaveQueryInfo:U,saveInfo:J,saveTreeData:W,handleTreeSelect:P,handleRemoveSaveInfo:k,fieldTreeData:z,addOne:q,removeOne:y,setFormModel:G,getSchema:X,loading:Y,onFinish:s,getPopupContainer:ee,superQueryFlag:F,handleOpen:Z,initDefaultValues:H,simpleImage:Le.PRESENTED_IMAGE_SIMPLE}}},oe=p=>(Se("data-v-b1c9d7e2"),p=p(),we(),p),$e={class:"j-super-query-button"},ze=oe(()=>g("span",null,"已有高级查询条件生效",-1)),Xe=oe(()=>g("span",null,"高级查询",-1)),Ye={style:{float:"left"}},Ze={slot:"description"},et=oe(()=>g("span",null,"没有任何查询条件",-1)),tt=oe(()=>g("div",null,"保存的查询",-1)),lt=["title"],at={class:"icon-cancle"},ot={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function nt(p,r,v,e,D,te){const Q=d("divider"),A=d("AppstoreTwoTone"),b=d("a-button"),K=d("a-button-group"),$=d("a-tooltip"),j=d("a-divider"),V=d("a-empty"),m=d("a-select-option"),B=d("a-select"),O=d("a-form-item"),U=d("a-col"),J=d("a-row"),W=d("a-tree-select"),P=d("online-super-query-val-component"),k=d("PlusOutlined"),z=d("MinusCircleOutlined"),q=d("a-space"),y=d("a-form"),G=d("close-circle-outlined"),X=d("file-text-outlined"),Y=d("a-tree"),N=d("Icon"),H=d("a-card"),F=d("BasicModal"),Z=d("a-input"),ee=d("a-modal");return S(),ie(ue,null,[g("div",$e,[e.superQueryFlag?(S(),x($,{key:0,mouseLeaveDelay:.2},{title:o(()=>[ze,a(Q,{type:"vertical",style:{"background-color":"#fff"}}),g("a",{onClick:r[0]||(r[0]=(...s)=>e.handleReset&&e.handleReset(...s))},"清空")]),default:o(()=>[a(K,null,{default:o(()=>[a(b,{type:"primary",onClick:e.handleOpen},{default:o(()=>[a(A,{spin:!0}),Xe]),_:1},8,["onClick"])]),_:1})]),_:1})):(S(),x(b,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:e.handleOpen},{default:o(()=>[f(" 高级查询 ")]),_:1},8,["onClick"]))]),(S(),x(ke,{to:"body"},[a(F,{title:"高级查询构造器",canFullscreen:!1,width:750,onRegister:e.registerFormModal,onOk:e.handleSubmit},{footer:o(()=>[g("div",Ye,[a(b,{loading:e.loading,onClick:e.handleReset},{default:o(()=>[f("重置")]),_:1},8,["loading","onClick"]),a(b,{loading:e.loading,onClick:e.handleSave},{default:o(()=>[f("保存查询")]),_:1},8,["loading","onClick"])]),a(b,{key:"submit",type:"primary",onClick:e.handleSubmit},{default:o(()=>[f("确定")]),_:1},8,["onClick"]),a(b,{key:"back",onClick:e.handleCancel},{default:o(()=>[f("关闭")]),_:1},8,["onClick"])]),default:o(()=>[e.dynamicRowValues.values.length==0?(S(),x(V,{key:0},{default:o(()=>[g("div",Ze,[et,a(j,{type:"vertical"}),g("a",{onClick:r[1]||(r[1]=s=>e.addOne(-1))},"点击新增")])]),_:1})):ye("",!0),a(J,{class:ne("j-super-query-modal-content")},{default:o(()=>[a(U,{sm:24,md:24},{default:o(()=>[re(a(J,null,{default:o(()=>[a(U,{md:12,xs:24},{default:o(()=>[a(O,{label:"匹配模式",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:o(()=>[a(B,{value:e.matchType,"onUpdate:value":r[2]||(r[2]=s=>e.matchType=s),getPopupContainer:s=>s.parentNode,style:{width:"100%"}},{default:o(()=>[a(m,{value:"and"},{default:o(()=>[f("AND（所有条件匹配）")]),_:1}),a(m,{value:"or"},{default:o(()=>[f("OR（任意一个匹配）")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[se,e.dynamicRowValues.values.length>0]]),re(a(y,{ref:"formRef",class:ne("jee-super-query-form"),model:e.dynamicRowValues,onFinish:e.onFinish},{default:o(()=>[(S(!0),ie(ue,null,ge(e.dynamicRowValues.values,(s,w)=>(S(),x(q,{key:s.key,style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:o(()=>[a(O,{name:["values",w,"field"],style:{width:"150px"}},{default:o(()=>[a(W,{style:{width:"100%"},placeholder:"请选择字段",value:s.field,"onUpdate:value":u=>s.field=u,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},onChange:u=>e.handleChangeField(s),"tree-data":e.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),a(O,{name:["values",w,"rule"],style:{width:"100px"}},{default:o(()=>[a(B,{style:{width:"100%"},placeholder:"请选择匹配规则",value:s.rule,"onUpdate:value":u=>s.rule=u},{default:o(()=>[a(m,{value:"eq"},{default:o(()=>[f("等于")]),_:1}),a(m,{value:"like"},{default:o(()=>[f("模糊")]),_:1}),a(m,{value:"right_like"},{default:o(()=>[f("以..开始")]),_:1}),a(m,{value:"left_like"},{default:o(()=>[f("以..结尾")]),_:1}),a(m,{value:"in"},{default:o(()=>[f("在...中")]),_:1}),a(m,{value:"ne"},{default:o(()=>[f("不等于")]),_:1}),a(m,{value:"gt"},{default:o(()=>[f("大于")]),_:1}),a(m,{value:"ge"},{default:o(()=>[f("大于等于")]),_:1}),a(m,{value:"lt"},{default:o(()=>[f("小于")]),_:1}),a(m,{value:"le"},{default:o(()=>[f("小于等于")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),a(O,{name:["values",w,"val"],style:{width:"300px"}},{default:o(()=>[a(P,{style:{width:"100%"},schema:e.getSchema(s,w),formModel:s,setFormModel:(u,M)=>{e.setFormModel(u,M,s)},onSubmit:e.handleSubmit},null,8,["schema","formModel","setFormModel","onSubmit"])]),_:2},1032,["name"]),a(O,null,{default:o(()=>[a(b,{onClick:u=>e.addOne(w),style:{"margin-right":"6px"}},{default:o(()=>[a(k)]),_:2},1032,["onClick"]),a(b,{onClick:u=>e.removeOne(s)},{default:o(()=>[a(z)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["model","onFinish"]),[[se,e.dynamicRowValues.values.length>0]])]),_:1})]),_:1}),a(H,{class:ne(["j-super-query-history-card",{collapsed:e.historyCollapsed}]),bordered:!1},{title:o(()=>[tt]),default:o(()=>[e.saveTreeData.length===0?(S(),x(V,{key:0,class:"j-super-query-history-empty",image:e.simpleImage,description:"没有保存的查询"},null,8,["image"])):(S(),x(Y,{key:1,class:"j-super-query-history-tree",treeData:e.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:e.handleTreeSelect},{title:o(({title:s})=>[g("div",null,[g("span",{title:s},be(s.length>10?s.substring(0,10)+"...":s),9,lt),g("span",at,[a(G,{onClick:w=>e.handleRemoveSaveInfo(s)},null,8,["onClick"])])])]),custom:o(()=>[a(X)]),_:1},8,["treeData","onSelect"])),g("div",{class:"collapse-box",onClick:r[3]||(r[3]=s=>e.historyCollapsed=!e.historyCollapsed)},[e.historyCollapsed?(S(),x(N,{key:0,icon:"ant-design:caret-left"})):(S(),x(N,{key:1,icon:"ant-design:caret-right"}))])]),_:1},8,["class"])]),_:1},8,["onRegister","onOk"])])),a(ee,{title:"请输入保存的名称",visible:e.saveInfo.visible,onCancel:r[5]||(r[5]=s=>e.saveInfo.visible=!1),onOk:e.doSaveQueryInfo},{default:o(()=>[g("div",ot,[a(Z,{value:e.saveInfo.title,"onUpdate:value":r[4]||(r[4]=s=>e.saveInfo.title=s),style:{width:"90%"},placeholder:"请输入保存的名称"},null,8,["value"])])]),_:1},8,["visible","onOk"])],64)}const rl=Me(Ke,[["render",nt],["__scopeId","data-v-b1c9d7e2"]]);export{rl as default};
