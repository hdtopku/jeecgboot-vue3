var q=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var P=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Y.call(t,n)&&P(e,n,t[n]);if(j)for(var n of j(t))Z.call(t,n)&&P(e,n,t[n]);return e},A=(e,t)=>Q(e,X(t));var U=(e,t,n)=>new Promise((s,u)=>{var f=c=>{try{a(n.next(c))}catch(r){u(r)}},l=c=>{try{a(n.throw(c))}catch(r){u(r)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(f,l);a((n=n.apply(e,t)).next())});import{u as ee,as as te,A as ae,af as J,D}from"./jeecg-online-vendor-a84f26e2.js";import{B as le}from"./index-5e1edea3.js";import{B as ne,T as F,p as $,z as se}from"./index-797f995b.js";import{c as E,k as m,r as G,w as M,u as y,d as H,V as b,a5 as N,a6 as W,f as w,a7 as R,ag as V,aa as oe,p as k,s as ie}from"./vue-5a09445c.js";import{s as ce}from"./props-6ce5d664.js";import{J as ue}from"./JSelectBiz-9c436f80.js";import{useRuleFormItem as re}from"./useFormItem-51923232.js";function de(e,t){const n=E("selectOptions",m([])),s=E("selectValues",G({value:[],change:!1})),u=E("loadingEcho",m(!1)),f=m([]),l=m([]),a=m([]),c=ee();let r=!0;M(s,()=>{if(s.change==!1){let o={};o[t.rowKey]=s.value.join(","),u.value=r,r=!1,_(o,!0).then().finally(()=>{u.value=r})}l.value=s.value},{immediate:!0});function g(o,d){return U(this,null,function*(){if(l.value=o,t.showSelected&&y(l).length!==y(d).length){let{records:v}=yield e({code:y(l).join(","),pageSize:y(l).length});a.value=v}else a.value=d})}const S={type:t.isRadioSelection?"radio":"checkbox",columnWidth:20,selectedRowKeys:l,onChange:g,preserveSelectedRowKeys:!0},I={dataIndex:"index",width:50};function _(o,d){return U(this,null,function*(){let{records:v}=yield e(o);if(f.value=v,d){let p=[];v.forEach(h=>{p.push({label:h[t.labelKey],value:h[t.rowKey]})}),n.value=p}})}function x(){return U(this,null,function*(){let{records:o}=yield e({code:s.value.join(","),pageSize:s.value.length});l.value=s.value,a.value=o})}function B(o){return U(this,null,function*(){o&&t.showSelected&&x()})}function K(o){let d=[],v=[];if(a.value.forEach(p=>{d.push({label:p[t.labelKey],value:p[t.rowKey]})}),l.value.forEach(p=>{v.push(p)}),n.value=d,t.maxSelectCount&&v.length>t.maxSelectCount)return c.createMessage.warning(`最多只能选择${t.maxSelectCount}条数据`),!1;o&&o(d,v)}function i(o){l.value=l.value.filter(d=>d!=o[t.rowKey]),a.value=a.value.filter(d=>d[t.rowKey]!==o[t.rowKey])}function C(){l.value=[],a.value=[]}return[{onSelectChange:g,getDataSource:_,visibleChange:B,selectOptions:n,selectValues:s,rowSelection:S,indexColumnProps:I,checkedKeys:l,selectRows:a,dataSource:f,getSelectResult:K,handleDeleteSelected:i,reset:C}]}const fe=H({name:"UserSelectModal",components:{BasicModal:le,BasicTable:te(()=>ae(()=>import("./BasicTable-398af8bc.js"),["js/BasicTable-398af8bc.js","js/BasicTable.vue_vue_type_style_index_0_lang-dd06c6a1.js","js/vue-5a09445c.js","js/jeecg-online-vendor-a84f26e2.js","js/antd-vue-vendor-04f0af1d.js","js/tinymce-vendor-e2919cb0.js","js/vxe-table-vendor-c5aaa9d2.js","js/lodash-es-vendor-70833b4a.js","assets/jeecg-online-vendor-cee2ba5d.css","js/index-797f995b.js","js/codemirror-vendor-f458506d.js","js/echarts-vendor-6c8e2159.js","assets/index-fe1627ce.css","js/BasicForm-43f63892.js","js/componentMap-4f24d9c4.js","js/useFormItem-51923232.js","js/index-5e1edea3.js","js/BasicModal-02606f87.js","js/useWindowSizeFn-76d4329b.js","assets/BasicModal-1e1b2ed9.css","assets/index-361bf2db.css","js/download-1a51d657.js","js/base64Conver-fa2fe1af.js","js/index-4f7c087f.js","assets/index-399aa0e3.css","js/index-898bd182.js","js/useCountdown-e194c426.js","js/useFormItemSingle-950ee32c.js","assets/index-15cc10f8.css","js/JAddInput-7275d351.js","js/areaDataUtil-994dc62e.js","js/props-6ce5d664.js","js/JSelectBiz-9c436f80.js","assets/JSelectBiz-ba37f0a8.css","js/index-86570f8b.js","js/index-8f3c0498.js","js/bem-05093d2d.js","js/props-17f0c5eb.js","js/useContextMenu-3014907a.js","assets/useContextMenu-6fcaad79.css","assets/index-a95e0833.css","js/depart.api-71c168b0.js","assets/JAddInput-4d25ca38.css","js/JSelectDept-f9e74791.js","assets/JSelectDept-2ce3f5d2.css","js/JPopup-5cac5270.js","assets/JPopup-00750b3f.css","js/cron-parser-vendor-df2efc7b.js","js/JEllipsis.vue_vue_type_script_setup_true_lang-cd7c9198.js","js/JUpload.vue_vue_type_style_index_0_lang-b42545d1.js","assets/JUpload-b67dde08.css","assets/index-0a01c8ed.css","js/index-60a41ace.js","js/index-f2355824.js","assets/index-d42612fa.css","assets/componentMap-11d05ddc.css","js/BasicForm.vue_vue_type_style_index_0_lang-56b5d203.js","assets/BasicForm-9101c3b7.css","js/useForm-56054a7d.js","js/injectionKey-69710956.js","assets/BasicTable-0e5f0b32.css"]),{loading:!0})},props:A(T({},ce),{modalTitle:{type:String,default:"选择用户"},excludeUserIdList:{type:Array,default:[]}}),emits:["register","getSelectResult"],setup(e,{emit:t,refs:n}){const s=m({x:!1}),u=m(),[f,{closeModal:l}]=ne(()=>{window.innerWidth<900?s.value={x:900}:s.value={x:!1},setTimeout(()=>{u.value&&u.value.setSelectedRowKeys(I.value||[])},800)}),a=J(),c={canResize:!1,bordered:!0,size:"small"},r=Object.assign({},y(e),y(a),c),[{rowSelection:g,visibleChange:S,selectValues:I,indexColumnProps:_,getSelectResult:x,handleDeleteSelected:B,selectRows:K}]=de(F,r),i=m(e.params);M(g.selectedRowKeys,h=>{u.value&&u.value.setSelectedRowKeys(h)});const C={baseColProps:{xs:24,sm:8,md:6,lg:8,xl:6,xxl:6},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8},schemas:[{label:"账号",field:"username",component:"JInput"},{label:"姓名",field:"realname",component:"JInput"}]},o=[{title:"用户账号",dataIndex:"username",width:120,align:"left"},{title:"用户姓名",dataIndex:"realname",width:120},{title:"性别",dataIndex:"sex_dictText",width:50},{title:"手机号码",dataIndex:"phone",width:120},{title:"邮箱",dataIndex:"email"},{title:"状态",dataIndex:"status_dictText",width:80}],d={pagination:!1,showIndexColumn:!1,scroll:{y:390},size:"small",canResize:!1,bordered:!0,rowKey:"id",columns:[{title:"用户姓名",dataIndex:"realname",width:40},{title:"操作",dataIndex:"action",align:"center",width:40,slots:{customRender:"action"}}]};function v(){x((h,O)=>{t("getSelectResult",h,O),l()})}function p(h){let O=e.excludeUserIdList;if(!O)return h;let z=[];if(O.length>0&&h&&h.length>0){for(let L of h)O.indexOf(L.id)<0&&z.push(T({},L));return z}return h}return{handleOk:v,searchInfo:i,register:f,indexColumnProps:_,visibleChange:S,getBindValue:r,getUserList:F,formConfig:C,columns:o,rowSelection:g,selectRows:K,selectedTable:d,handleDeleteSelected:B,tableScroll:s,tableRef:u,afterFetch:p}}}),me=["onClick"];function he(e,t,n,s,u,f){const l=b("BasicTable"),a=b("a-col"),c=b("Icon"),r=b("a-row"),g=b("BasicModal");return N(),W("div",null,[w(g,V(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:e.showSelected?"1200px":"900px",wrapClassName:"j-user-select-modal",onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{default:R(()=>[w(r,null,{default:R(()=>[w(a,{span:e.showSelected?18:24},{default:R(()=>[w(l,V({ref:"tableRef",columns:e.columns,scroll:e.tableScroll},e.getBindValue,{useSearchForm:!0,formConfig:e.formConfig,api:e.getUserList,searchInfo:e.searchInfo,rowSelection:e.rowSelection,indexColumnProps:e.indexColumnProps,afterFetch:e.afterFetch}),{tableTitle:R(()=>[]),_:1},16,["columns","scroll","formConfig","api","searchInfo","rowSelection","indexColumnProps","afterFetch"])]),_:1},8,["span"]),w(a,{span:e.showSelected?6:0},{default:R(()=>[w(l,V(e.selectedTable,{dataSource:e.selectRows,useSearchForm:!0,formConfig:{showActionButtonGroup:!1,baseRowStyle:{minHeight:"40px"}}}),{action:R(({record:S})=>[oe("a",{href:"javascript:void(0)",onClick:I=>e.handleDeleteSelected(S)},[w(c,{icon:"ant-design:delete-outlined"})],8,me)]),_:1},16,["dataSource"])]),_:1},8,["span"])]),_:1})]),_:1},16,["onRegister","title","width","onOk","onVisibleChange"])])}const ge=D(fe,[["render",he]]),ve=H({name:"JSelectUser",components:{UserSelectModal:ge,JSelectBiz:ue},inheritAttrs:!1,props:{value:$.oneOfType([$.string,$.array]),labelKey:{type:String,default:"realname"},rowKey:{type:String,default:"username"},params:{type:Object,default:()=>{}},excludeUserIdList:{type:Array,default:()=>[]}},emits:["options-change","change","update:value"],setup(e,{emit:t}){const n=m(),[s,{openModal:u}]=se(),[f]=re(e,"value","change",n),l=m([]);let a=G({value:[],change:!1});const c=m(!1);k("selectOptions",l),k("selectValues",a),k("loadingEcho",c);const r=m(!1),g=J();ie(()=>{e.value&&_(),e.value||(a.value=[])}),M(a,()=>{a&&(f.value=a.value)});const S=m([]);M(()=>e.excludeUserIdList,i=>{S.value=i},{immediate:!0});function I(){r.value=!0,u(!0,{isUpdate:!1})}function _(){let i=e.value?e.value:[];i&&typeof i=="string"&&i!="null"&&i!="undefined"?(f.value=i.split(","),a.value=i.split(",")):a.value=i}function x(i,C){l.value=i,f.value=C,a.value=C,t("update:value",C.join(","))}const B=Object.assign({},y(e),y(g));function K(i){t("update:value",i)}return{state:f,attrs:g,selectOptions:l,getBindValue:B,selectValues:a,loadingEcho:c,tag:r,regModal:s,setValue:x,handleOpen:I,excludeUserIdList:S,handleChange:K}}});function pe(e,t,n,s,u,f){const l=b("JSelectBiz"),a=b("UserSelectModal");return N(),W("div",null,[w(l,V({onChange:e.handleChange,onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs),null,16,["onChange","onHandleOpen","loading"]),w(a,V({rowKey:e.rowKey,onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{excludeUserIdList:e.excludeUserIdList}),null,16,["rowKey","onRegister","onGetSelectResult","excludeUserIdList"])])}const xe=D(ve,[["render",pe],["__scopeId","data-v-00f5e96f"]]);export{ge as U,xe as n,de as u};
