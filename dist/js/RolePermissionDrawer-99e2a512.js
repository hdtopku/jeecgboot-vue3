var w=(f,C,d)=>new Promise((p,c)=>{var _=n=>{try{s(d.next(n))}catch(u){c(u)}},v=n=>{try{s(d.throw(n))}catch(u){c(u)}},s=n=>n.done?p(n.value):Promise.resolve(n.value).then(_,v);s((d=d.apply(f,C)).next())});import{a as z,u as G,B as H}from"./index-d3889e2f.js";import{_ as J}from"./index-5ea00b35.js";import{ab as Q}from"./index-23d562e3.js";import{_ as U}from"./RoleDataRuleDrawer.vue_vue_type_script_setup_true_lang-c0710ce1.js";import{n as X,o as S,p as Y}from"./role.api-74e2f3fe.js";import{d as Z,k as i,V as g,a5 as b,a9 as T,a7 as t,E as l,f as a,u as o,ab as ee,W as te,ag as ae,ap as oe,aq as le,aa as P}from"./vue-5a09445c.js";import{D as se}from"./jeecg-online-vendor-f8ebd627.js";import"./antd-vue-vendor-04f0af1d.js";import"./tinymce-vendor-e2919cb0.js";import"./bem-5ff749b6.js";import"./vxe-table-vendor-c5aaa9d2.js";import"./lodash-es-vendor-70833b4a.js";import"./props-17f0c5eb.js";import"./useContextMenu-d4796678.js";import"./codemirror-vendor-f458506d.js";import"./echarts-vendor-6c8e2159.js";const A=f=>(oe("data-v-ce6058ab"),f=f(),le(),f),ne=A(()=>P("div",{class:"line"},null,-1)),re=A(()=>P("div",{class:"line"},null,-1)),ie=Z({__name:"RolePermissionDrawer",emits:["register"],setup(f,{emit:C}){const d=i([]),p=i([]),c=i([]),_=i([]),v=i([]),s=i(""),n=i(null),u=i(!1),k=i([]),h=i(!0),[B,{openDrawer:N}]=z(),[V,{setDrawerProps:R,closeDrawer:I}]=G(e=>w(this,null,function*(){yield E(),R({confirmLoading:!1,loading:!0}),s.value=e.roleId;const r=yield X();d.value=r.treeList,p.value=r.ids,k.value=r.ids;const m=yield S({roleId:o(s)});c.value=m,_.value=m,R({loading:!1})}));function $(e){c.value=e.checked?e.checked:e}function q(e){e&&e.length>0&&(v.value=e),N(!0,{functionId:o(v)[0],roleId:o(s)})}function E(){d.value=[],p.value=[],c.value=[],_.value=[],v.value=[],s.value=""}function L(){const e=o(n);if(!e)throw new Error("tree is null!");return e}function x(e){return w(this,null,function*(){let r={roleId:o(s),permissionIds:o(L().getCheckedKeys()).join(","),lastpermissionIds:o(_).join(",")};if(u.value===!1&&(yield j(r)),e)I();else{const m=yield S({roleId:o(s)});_.value=m}})}function j(e){return w(this,null,function*(){u.value=!0,yield Y(e),setTimeout(()=>{u.value=!1},500)})}function F({key:e}){e==="checkAll"?c.value=p.value:e==="cancelCheck"?c.value=[]:e==="openAll"?k.value=p.value:e==="closeAll"?k.value=[]:e==="relation"?h.value=!1:h.value=!0}return(e,r)=>{const m=g("Icon"),y=g("a-menu-item"),M=g("a-menu"),O=g("a-dropdown"),K=g("a-button");return b(),T(o(H),ae(e.$attrs,{onRegister:o(V),width:"650px",destroyOnClose:"",showFooter:""}),{title:t(()=>[l(" 角色权限配置 "),a(O,null,{overlay:t(()=>[a(M,{onClick:F},{default:t(()=>[a(y,{key:"checkAll"},{default:t(()=>[l("选择全部")]),_:1}),a(y,{key:"cancelCheck"},{default:t(()=>[l("取消选择")]),_:1}),ne,a(y,{key:"openAll"},{default:t(()=>[l("展开全部")]),_:1}),a(y,{key:"closeAll"},{default:t(()=>[l("折叠全部")]),_:1}),re,a(y,{key:"relation"},{default:t(()=>[l("层级关联")]),_:1}),a(y,{key:"standAlone"},{default:t(()=>[l("层级独立")]),_:1})]),_:1})]),default:t(()=>[a(m,{icon:"ant-design:more-outlined",class:"more-icon"})]),_:1})]),footer:t(()=>[a(o(Q),{title:"确定放弃编辑？",onConfirm:o(I),okText:"确定",cancelText:"取消"},{default:t(()=>[l("取消")]),_:1},8,["onConfirm"]),a(K,{onClick:r[0]||(r[0]=D=>x(!1)),type:"primary",loading:u.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:t(()=>[l("仅保存")]),_:1},8,["loading"]),a(K,{onClick:r[1]||(r[1]=D=>x(!0)),type:"primary",loading:u.value},{default:t(()=>[l("保存并关闭")]),_:1},8,["loading"])]),default:t(()=>[a(o(J),{ref_key:"treeRef",ref:n,checkable:"",treeData:d.value,checkedKeys:c.value,expandedKeys:k.value,selectedKeys:v.value,checkStrictly:h.value,clickRowToExpand:!1,title:"所拥有的的权限",onCheck:$,onSelect:q},{title:t(({slotTitle:D,ruleFlag:W})=>[l(ee(D)+" ",1),W?(b(),T(m,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):te("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys","checkStrictly"]),a(U,{onRegister:o(B)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});const xe=se(ie,[["__scopeId","data-v-ce6058ab"]]);export{xe as default};
